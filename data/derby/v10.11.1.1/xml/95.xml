<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:08:48 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-95/DERBY-95.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-95] NPE when passing in url instead of database name to EmbeddedXADataSource</title>
                <link>https://issues.apache.org/jira/browse/DERBY-95</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When passing in a url (e.g. jdbc:derby:mydb) instead of just the database name (e.g. mydb) the XADataSource gives a NullPointerException.&lt;/p&gt;

&lt;p&gt;It should either handle this a little more gracefully &amp;amp; give an error, or accept the url (like EmbeddedDataSource does).&lt;/p&gt;</description>
                <environment></environment>
        <key id="28866">DERBY-95</key>
            <summary>NPE when passing in url instead of database name to EmbeddedXADataSource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shreyas">Shreyas Kaushik</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Dec 2004 23:11:59 +0000</created>
                <updated>Wed, 12 Jul 2006 02:40:37 +0100</updated>
                            <resolved>Sat, 12 Feb 2005 01:54:35 +0000</resolved>
                                                    <fixVersion>10.0.2.1</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="56385" author="myrna" created="Wed, 8 Dec 2004 14:53:34 +0000"  >&lt;p&gt;stack from test case is:&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.jdbc.EmbeddedXADataSource.setupResourceAdapter(EmbeddedXADataSource.java)&lt;br/&gt;
	at org.apache.derby.jdbc.EmbeddedXADataSource.getXAConnection(EmbeddedXADataSource.java)&lt;br/&gt;
	at xaurl.runTests(xaurl.java:51)&lt;br/&gt;
	at xaurl.main(xaurl.java:26)&lt;/p&gt;
</comment>
                            <comment id="57006" author="shreyas" created="Thu, 23 Dec 2004 09:50:11 +0000"  >&lt;p&gt;The part of the code that causes this NPE to come up is in the setupResourceAdapter method in the EmbeddedXADataSource.java, the fragment is here,&lt;/p&gt;

&lt;p&gt;if (requestPassword) &lt;/p&gt;
{
    getConnection(user, password).close();
}

&lt;p&gt;Since the url passed is not a valid databaseName ( it considers the entire string as the database) it cannot establish a connection so the call to getConnection() returns null and calling close throws a NPE.&lt;/p&gt;

&lt;p&gt;This can be resolved by checking if the connection handle returned by a call to the getConnection() method is null or not. If it is not null do the processing that is currently happening( closing of the connection in this case) , if it is null then throw a SQLException saying the database doesn&apos;t exist.&lt;/p&gt;

&lt;p&gt;The same case also needs to be taken care of in the code fragment following the above code fragment as well.&lt;/p&gt;</comment>
                            <comment id="57017" author="djd" created="Thu, 23 Dec 2004 17:06:30 +0000"  >&lt;p&gt;I think the fix is a little more involved that Shreyas indicated.&lt;br/&gt;
getConnection() should not return null, so the getConnection().close() is correct. &lt;/p&gt;

&lt;p&gt;Investigation needs to be made as to why getConnection() is returning null, rather than throwing an exception.&lt;/p&gt;</comment>
                            <comment id="57065" author="shreyas" created="Mon, 27 Dec 2004 06:08:06 +0000"  >&lt;p&gt;The getConnection() method returns null because the url is of the format as shown below:&lt;/p&gt;

&lt;p&gt;&quot;jdbc:derby:jdbc:derby:databaseName=testdb&quot;.&lt;/p&gt;

&lt;p&gt;As said in my previous comment it treats the entire string passed to the setDatabaseName as a valid database and tries to establish a connection to that. The url is built in the update() method in the EmbeddedXADataSource.java where it just appends the databaseName that is set previously to the Protocol string, hence the error.&lt;/p&gt;

&lt;p&gt;   So we need to figure out what needs to be done here, specify/document that a valid databaseName should be passed to the setDatabaseName() if it is not passed a SQLException is thrown saying no DB exists. Alternatively, try and verify/ validate whatever is passed as argument( i feel the first approach is the way to go ) and take action accordingly.&lt;/p&gt;

&lt;p&gt;  In the second case the extra effort of validation is required.&lt;/p&gt;</comment>
                            <comment id="57308" author="djd" created="Thu, 6 Jan 2005 00:26:46 +0000"  >&lt;p&gt;EmbeddedXADataSource.getConnection() should not be returning null, as it implements the XADataSource.getConnection() contract.&lt;/p&gt;

&lt;p&gt;As Shreyas says it is returning null because the formed JDBC URL is not handled by Derby.&lt;/p&gt;

&lt;p&gt;My guess is that EmbeddedDriver.getConnection() method is (correctly) returning null as it does not handle that URL. Thus somehow that null is making EmbeddedXADataSource.getConnection() return null, which is strange as the two methods have different return types. So I think the DataSource implementations probably don&apos;t handle a null from EmbeddedDriver.getConnection() correctly.&lt;/p&gt;</comment>
                            <comment id="57371" author="shreyas" created="Fri, 7 Jan 2005 15:15:16 +0000"  >&lt;p&gt;The EmbeddedXADataSource.getConnection() does not return null, the call to this methods throws a NPE because the EmbeddedDriver.getConnection() returns null and an attempt is made to close the connection assuming that it will not return a null.&lt;/p&gt;

&lt;p&gt;Here an NPE needs to be caught becuase the EmbeddedDriver.getConnection can return null when&lt;/p&gt;

&lt;p&gt;  1) A database does not exist ( Url is valid )&lt;br/&gt;
  2) The Url is invalid ( which is the case here )&lt;/p&gt;

&lt;p&gt; After this NPE is caught we need to throw a SQLException saying that the DB doesn&apos;t exist. &lt;/p&gt;

&lt;p&gt; I hope everyone is ok with this approach, please comment and kindly vote for the suggested fix.&lt;/p&gt;</comment>
                            <comment id="57448" author="shreyas" created="Mon, 10 Jan 2005 14:15:08 +0000"  >&lt;p&gt;Agree with Dan&apos;s comments. Attaching the diff for the patching of this issue. &lt;/p&gt;

&lt;p&gt;The output with this patch will look like this, instead of throwing a NPE.&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.sql.SQLException: Database not available&lt;/p&gt;

&lt;p&gt;If this change is ok please accept the propsed patch.&lt;/p&gt;</comment>
                            <comment id="57449" author="shreyas" created="Mon, 10 Jan 2005 14:16:00 +0000"  >&lt;p&gt;Proposed patch for fixing this&lt;/p&gt;</comment>
                            <comment id="57472" author="djd" created="Tue, 11 Jan 2005 00:06:29 +0000"  >&lt;p&gt;The patch does not address the underlying bug that getConnection() is returning null when it can not according to its contract (from DataSource). I assume if such a database name was set in EmbeddedDataSource, then its getConnection() method would return null (as it&apos;s the method that EmbeddedXADataSource inherits). Thus I think the references to EmbeddedXADataSource are misleading, the bug is actually in EmbeddedDataSource.&lt;/p&gt;</comment>
                            <comment id="57577" author="shreyas" created="Thu, 13 Jan 2005 20:19:18 +0000"  >&lt;p&gt;Attaching the latest patch as per Dan&apos;s comments so that the getConnection() method in EmbeddedDataSource does not return null. It will throw a SQLException if the driver is not able to connect to the database.&lt;/p&gt;

&lt;p&gt;Also attaching the latest diff.&lt;/p&gt;</comment>
                            <comment id="57940" author="djd" created="Sun, 23 Jan 2005 00:58:19 +0000"  >&lt;p&gt;Fixed with svn revision 126038 from Shreyas Kaushik &amp;lt;Shreyas.Kaushik@Sun.COM&amp;gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="18595" name="Derby-95.diff" size="1252" author="shreyas" created="Mon, 10 Jan 2005 14:16:00 +0000"/>
                            <attachment id="18624" name="Derby-95_latest.diff" size="3319" author="shreyas" created="Thu, 13 Jan 2005 20:21:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 23 Dec 2004 09:50:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21769</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy15mv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40563</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>