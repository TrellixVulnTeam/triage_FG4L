<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:25:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1582/DERBY-1582.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1582] REVOKE statement does not generate a warning when no privileges are revoked.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1582</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;SQL 2003 standard, section 12.7 &amp;lt;revoke statement&amp;gt;, item 17 under general rules indicates the statement completes with the condition &apos;warning ? privilege not revoked.&apos; when no matching privilege is revoked.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12346593">DERBY-1582</key>
            <summary>REVOKE statement does not generate a warning when no privileges are revoked.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="deepa">Deepa Remesh</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jul 2006 06:17:45 +0100</created>
                <updated>Wed, 30 Aug 2006 07:45:21 +0100</updated>
                            <resolved>Wed, 30 Aug 2006 07:45:08 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12426999" author="deepa" created="Wed, 9 Aug 2006 19:48:04 +0100"  >&lt;p&gt;Attaching a patch &apos;d1582_v1.diff&apos; which raises a warning when no privileges are revoked by the revoke statement.&lt;/p&gt;

&lt;p&gt;This patch adds checks for revoke of table and routine permissions. It checks return value of DataDictionary.addRemovePermissionsDescriptor method which returns true if revoke has removed a privilege. The new SQLState and warning added are:&lt;br/&gt;
WARNING 01006: Privilege not revoked.&lt;br/&gt;
Tests are in lang/grantRevokeDDL.sql.&lt;/p&gt;

&lt;p&gt;It is not very clear to me from the spec how the following case should be handled - revoking permissions from dba (user who is the owner of the database). dba has &quot;implicit&quot; permissions on all objects and we cannot revoke privileges from dba. With the current patch we will get the above warning when we revoke any privilge from dba. I am thinking this behaviour is okay. It would be helpful if someone can confirm this.&lt;/p&gt;

&lt;p&gt;I am running derbyall with the patch now. Meantime, any feedback is appreciated.&lt;/p&gt;</comment>
                            <comment id="12427054" author="djd" created="Thu, 10 Aug 2006 00:23:20 +0100"  >&lt;p&gt;I get a conflict on the applying the patch, in RoutinePrivilegeInfo, due to changes for DEBRY-1643. Thinking it was strange you would have to modify that file I looked closer and saw that this code fragment and the resulting adding the warning is repeated and probably should be pushed up into the super-class.&lt;/p&gt;

&lt;p&gt;+			if (dd.addRemovePermissionsDescriptor( grant, routinePermsDesc, grantee, tc)) {					&lt;br/&gt;
+				privileges_revoked = true;&lt;br/&gt;
+				dd.getDependencyManager().invalidateFor(routinePermsDesc, DependencyManager.REVOKE_EXECUTE_PRIVILEGE, lcc);&lt;/p&gt;


&lt;p&gt;Something like&lt;/p&gt;

&lt;p&gt;void addRemovePermissionsDescriptor(PermissionsDescritpor pd, String grantee, TransactionController tc)&lt;/p&gt;</comment>
                            <comment id="12427063" author="deepa" created="Thu, 10 Aug 2006 01:37:19 +0100"  >&lt;p&gt;Thanks Dan for looking at the patch.&lt;/p&gt;

&lt;p&gt;From what I had tried, I had found that we have to keep track if any privilege is revoked in TablePrivilegeInfo itself as addRemovePermissionsDescriptor is called multiple times in TablePrivilegeInfo.executeGrantRevoke method. Because of this, we need to track whether or not any privilege is revoked for table and routine separately. And we cannot move the whole check to super class.&lt;/p&gt;

&lt;p&gt;I think I should have added a common method to check and raise a warning if needed. I&apos;ll upload a revised patch.&lt;/p&gt;

&lt;p&gt;Please let me know if this doesn&apos;t sound okay.&lt;/p&gt;</comment>
                            <comment id="12427272" author="deepa" created="Thu, 10 Aug 2006 18:08:22 +0100"  >&lt;p&gt;Thanks Satheesh for clarifying that we cannot revoke privileges from the database owner.&lt;/p&gt;

&lt;p&gt;I was reworking the patch and adding some more tests for this to lang/grantRevokeDDL.sql. I am adding cases where we specify more than one grantees/actions in the revoke statement. I would like to confirm my understanding of when to raise warnings when there are multiple grantees/actions ? This is the relevant part from the SQL spec:&lt;br/&gt;
&quot;&lt;br/&gt;
17) If the &amp;lt;revoke statement&amp;gt; is a &amp;lt;revoke privileges statement&amp;gt;, then:&lt;br/&gt;
a) For every combination of &amp;lt;grantee&amp;gt; and &amp;lt;action&amp;gt; on O specified in &amp;lt;privileges&amp;gt;, if there&lt;br/&gt;
is no corresponding privilege descriptor in the set of identified privilege descriptors, then a&lt;br/&gt;
completion condition is raised: warning ? privilege not revoked.&lt;br/&gt;
b) If ALL PRIVILEGES was specified, then for each &amp;lt;grantee&amp;gt;, if no privilege descriptors were&lt;br/&gt;
identified, then a completion condition is raised: warning ? privilege not revoked.&lt;br/&gt;
&quot;&lt;/p&gt;

&lt;p&gt;Does this mean:&lt;br/&gt;
1) raise a warning if we find that at least one of the grantee/action combination or at least one grantee if it is &quot;revoke ALL PRIVILEGES&quot; did not have a matching privilege descriptor.&lt;br/&gt;
2) raise a warning if we have not found any privilege descriptors that are revoked after looking at all combinations&lt;br/&gt;
3) something else ?&lt;/p&gt;

&lt;p&gt;I think it is 1)  and creating the new patch based on this. Is this understanding correct? &lt;/p&gt;</comment>
                            <comment id="12429115" author="deepa" created="Fri, 18 Aug 2006 21:23:18 +0100"  >&lt;p&gt;Attaching a revised patch &apos;d1582_v2.diff&apos; which raises a warning when no privileges are revoked by the revoke statement for a grantee. This patch handles the case when multiple grantees are specified and raises a warning for each grantee. &lt;/p&gt;

&lt;p&gt;The warning raised is:&lt;br/&gt;
&quot;WARNING 01006: Privilege not revoked from &amp;lt;grantee&amp;gt;.&quot; &lt;br/&gt;
With the patch, we will be getting the same warning message in both these scenarios:&lt;br/&gt;
1) When no matching privilege is found&lt;br/&gt;
2)  When a privilege is found but it cannot be revoked (cases like revoke privileges from database owner, self privilege revocation, revoke privilege from object owner)&lt;br/&gt;
Is this okay? Or do we need to differentiate the warning messages in these cases?&lt;/p&gt;

&lt;p&gt;The patch does not raise warnings in the following cases. I am trying to handle these cases plus add few more tests in a separate patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;When multiple privilege actions on a table are revoked from a user and the user does not have privilege for one of the actions on the table&lt;br/&gt;
create table t1 (c11 int, c12 int);&lt;br/&gt;
grant select, insert on t1 to deepa;&lt;br/&gt;
revoke select,insert,update on t1 from deepa;&lt;br/&gt;
The above revoke statement should raise a warning as user does not have update privilege on the table. &lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;When multiple columns are specified in the column list and the user does not have the privilege on one of the columns.&lt;br/&gt;
grant select(c11) on t1 to deepa;&lt;br/&gt;
revoke select(c11,c12) on t1 from deepa;&lt;br/&gt;
The above revoke statement should raise a warning as user does not have select privilege on column c12. &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With this patch, I ran grant/revoke tests. I had run derbyall earlier but have made small changes after that and will re-run it tonight. Please take a look at this and provide feedback. Thanks.&lt;/p&gt;</comment>
                            <comment id="12429134" author="mamtas" created="Fri, 18 Aug 2006 22:45:26 +0100"  >&lt;p&gt;Deepa, your patch looks good to me. Just couple suggestion for the tests&lt;br/&gt;
1)You have some -ve test case for revoke table as follows&lt;br/&gt;
+-- This should raise warnings for bar&lt;br/&gt;
+revoke insert on satheesh.tsat from foo, bar;&lt;br/&gt;
+-- This should raise warnings for both foo and bar&lt;br/&gt;
+revoke insert on satheesh.tsat from foo, bar;&lt;/p&gt;

&lt;p&gt;It will be nice to have similar -ve test case for revoke routine.. from mulitple users RESTRICT. ie have couple users in single revoke routine and some or all of those users do not have the privilege granted to them&lt;/p&gt;

&lt;p&gt;2)I am not sure if you have tests for : When a privilege is found but it cannot be revoked (cases like revoke privileges from database owner, self privilege revocation, revoke privilege from object owner) &lt;/p&gt;
</comment>
                            <comment id="12429279" author="deepa" created="Sun, 20 Aug 2006 18:43:19 +0100"  >&lt;p&gt;With v2 patch, derbyall ran with no new failures. But the test additions conflict with changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1538&quot; title=&quot;Unexpected behavior on self privilege revocation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1538&quot;&gt;&lt;del&gt;DERBY-1538&lt;/del&gt;&lt;/a&gt;. Unchecking patch available flag till check and upload new patch.&lt;/p&gt;</comment>
                            <comment id="12429509" author="deepa" created="Mon, 21 Aug 2006 20:37:14 +0100"  >&lt;p&gt;Attaching patch &apos;d1582_v2_with_tests.diff&apos; which raises a warning when no privileges are revoked by the revoke statement for a grantee. This patch handles the case when multiple grantees are specified and raises a warning for each grantee. It is same as the earlier v2 patch. It only adds additional tests suggested by Mamta. &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1538&quot; title=&quot;Unexpected behavior on self privilege revocation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1538&quot;&gt;&lt;del&gt;DERBY-1538&lt;/del&gt;&lt;/a&gt; has handled the cases and added the tests I mentioned in &quot;2) When a privilege is found but it cannot be revoked&quot;. So I have only added additional tests for revoking routine privileges. derbyall ran with no new failures.&lt;/p&gt;

&lt;p&gt;Please take a look at this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="12430037" author="mamtas" created="Wed, 23 Aug 2006 17:24:05 +0100"  >&lt;p&gt;Deepa, the test changes look good. Thanks for adding more tests.&lt;/p&gt;</comment>
                            <comment id="12430255" author="rhillegas" created="Thu, 24 Aug 2006 15:25:13 +0100"  >&lt;p&gt;Assign to 10.2 and bump urgency.&lt;/p&gt;</comment>
                            <comment id="12430274" author="rhillegas" created="Thu, 24 Aug 2006 16:57:03 +0100"  >&lt;p&gt;Thanks for the patch, Deepa, and thanks for the review, Mamta. I have committed d1582_v2.diff at subversion revision 434408.&lt;/p&gt;</comment>
                            <comment id="12430276" author="rhillegas" created="Thu, 24 Aug 2006 16:57:29 +0100"  >&lt;p&gt;Turning off patch-available bit.&lt;/p&gt;</comment>
                            <comment id="12430603" author="rhillegas" created="Fri, 25 Aug 2006 21:03:52 +0100"  >&lt;p&gt;Ported &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1582&quot; title=&quot;REVOKE statement does not generate a warning when no privileges are revoked.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1582&quot;&gt;&lt;del&gt;DERBY-1582&lt;/del&gt;&lt;/a&gt; (434408) to 10.2 at subversion revision 436921.&lt;/p&gt;</comment>
                            <comment id="12431494" author="mamtas" created="Wed, 30 Aug 2006 07:45:08 +0100"  >&lt;p&gt;In order for Deepa to resolve remaining items for this Jira entry, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1782&quot; title=&quot;When a privilege is revoked at table level, Derby should only drop objects that require that particular privilege and not all the objects that require some form of privilege on that table.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1782&quot;&gt;DERBY-1782&lt;/a&gt; should get fixed. I am closing this issue and relating it to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1782&quot; title=&quot;When a privilege is revoked at table level, Derby should only drop objects that require that particular privilege and not all the objects that require some form of privilege on that table.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1782&quot;&gt;DERBY-1782&lt;/a&gt; so we don&apos;t loose the association of the 2 jira entries.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12348900">DERBY-1782</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12312336">DERBY-464</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12338512" name="d1582_v1.diff" size="12013" author="deepa" created="Wed, 9 Aug 2006 19:48:04 +0100"/>
                            <attachment id="12338513" name="d1582_v1.status" size="666" author="deepa" created="Wed, 9 Aug 2006 19:48:04 +0100"/>
                            <attachment id="12339137" name="d1582_v2.diff" size="11412" author="deepa" created="Fri, 18 Aug 2006 21:23:18 +0100"/>
                            <attachment id="12339138" name="d1582_v2.status" size="640" author="deepa" created="Fri, 18 Aug 2006 21:23:18 +0100"/>
                            <attachment id="12339264" name="d1582_v2_with_tests.diff" size="12391" author="deepa" created="Mon, 21 Aug 2006 20:37:14 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Aug 2006 18:48:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22577</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy14q7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40416</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>