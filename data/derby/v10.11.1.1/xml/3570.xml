<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:50:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3570/DERBY-3570.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3570] Implement DETERMINISTIC keyword for procedures and functions</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3570</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;We will need DETERMINISTIC functions when we implement generated columns (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-481&quot; title=&quot;implement SQL generated columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-481&quot;&gt;&lt;del&gt;DERBY-481&lt;/del&gt;&lt;/a&gt;). The syntax and behavior of the DETERMINISTIC keyword are defined in the functional spec attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-481&quot; title=&quot;implement SQL generated columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-481&quot;&gt;&lt;del&gt;DERBY-481&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12392338">DERBY-3570</key>
            <summary>Implement DETERMINISTIC keyword for procedures and functions</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Mar 2008 12:41:04 +0000</created>
                <updated>Thu, 3 Oct 2013 08:04:21 +0100</updated>
                            <resolved>Mon, 17 Nov 2008 18:40:41 +0000</resolved>
                                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12633660" author="rhillegas" created="Tue, 23 Sep 2008 10:15:45 +0100"  >&lt;p&gt;Attaching derby-3570-01-aa-introduceDeterminismField.diff. This allocates a bit in RoutineAliasInfo so that we can record whether a routine is deterministic. If this patch seems ok and is checked in, then the actual persistent representation of this information can be changed. I believe that Dan expressed an interest in reworking this (see the comments on the related &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-481&quot; title=&quot;implement SQL generated columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-481&quot;&gt;&lt;del&gt;DERBY-481&lt;/del&gt;&lt;/a&gt; issue). Regression tests run cleanly for me. Touches the following files:&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/catalog/types/RoutineAliasInfo.java&lt;/p&gt;

&lt;p&gt;Allocates a bit out of the sqlAllowed field in order to record whether a routine is deterministic and changes the constructors to allow callers to declare whether a routine is deterministic. To rework the internal bits of this class, just look for the field sqlOptions.&lt;/p&gt;


&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/catalog/DataDictionaryImpl.java&lt;/p&gt;

&lt;p&gt;Uses the new determinism-aware constructors of RoutineAliasInfo. All system procedures are created as non-deterministic. All system functions are created as deterministic except for RANDOM and RAND.&lt;/p&gt;


&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/compile/CreateAliasNode.java&lt;br/&gt;
M      java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj&lt;/p&gt;

&lt;p&gt;All user-created routines are marked as the default right now, that is, as non-deterministic.&lt;/p&gt;


&lt;p&gt;A      java/testing/org/apache/derbyTesting/functionTests/tests/lang/GeneratedColumnsTest.java&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/_Suite.java&lt;/p&gt;

&lt;p&gt;A small test which verifies that, by default, user-created routines are non-deterministic and that all system procedures are non-deterministic.&lt;/p&gt;</comment>
                            <comment id="12633736" author="knutanders" created="Tue, 23 Sep 2008 15:03:18 +0100"  >&lt;p&gt;I haven&apos;t tested the patch, but it looks good to me. Since it changes the stored format of the routines slightly, it may be a good idea to add a test case in the upgrade tests to verify that a routine created on Derby 10.4 works and is flagged as non-deterministic after an upgrade to Derby&amp;gt;=10.5.&lt;/p&gt;</comment>
                            <comment id="12633969" author="dagw" created="Wed, 24 Sep 2008 00:27:19 +0100"  >&lt;p&gt;In RoutineAliasInfo, you set aside 4 bits for sqlAllowed, but isn&apos;t that information encoded in 2 bits&lt;br/&gt;
(int values 0--3)? Also, the legend says bits 0-4; I guess you mean 1-4 (or 0-3) since you mask with 0x10)?&lt;/p&gt;</comment>
                            <comment id="12634524" author="rhillegas" created="Thu, 25 Sep 2008 17:03:48 +0100"  >&lt;p&gt;Thanks for the feedback Knut and Dag. Attaching derby-3570-01-ab-introduceDeterminismField.diff. This changes the previous patch as follows:&lt;/p&gt;

&lt;p&gt;1) Fixes the comments on the sqlOptions field as Dag recommended.&lt;/p&gt;

&lt;p&gt;A couple other issues:&lt;/p&gt;

&lt;p&gt;2) It&apos;s true that the SQL modes in sqlOptions could be described by only 2 bits. I gave a couple other bits to that field to account for future expansion.&lt;/p&gt;

&lt;p&gt;3) I do intend to add upgrade tests for this work. They will be easier to add once I introduce some more language. The crude checks which I perform in GeneratedColumnTest right now can&apos;t be performed in the upgrade tests easily because I get a ClassCastException when I try to retrieve a RoutineAliasDescriptor out of a down-rev database.&lt;/p&gt;</comment>
                            <comment id="12634525" author="rhillegas" created="Thu, 25 Sep 2008 17:07:05 +0100"  >&lt;p&gt;Committed derby-3570-01-ab-introduceDeterminismField.diff at subversion revision 699009. At this point I believe that Dan and I can work independently on this issue. That is, I can add the DETERMINISITIC keyword to the parser while Dan restructures the innards of RoleAliasInfo.&lt;/p&gt;</comment>
                            <comment id="12635063" author="rhillegas" created="Sat, 27 Sep 2008 00:18:20 +0100"  >&lt;p&gt;Attaching derby-3570-02-aa-grammar.diff. This patch adds the DETERMINISTIC clause to the CREATE FUNCTION/PROCEDURE statements. Touches the following files:&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj&lt;/p&gt;

&lt;p&gt;Adds a new non-reserved keyword, DETERMINISTIC. Adds new clauses to the CREATE FUNCTION/PROCEDURE statements.&lt;/p&gt;


&lt;p&gt;M      java/engine/org/apache/derby/catalog/types/RoutineAliasInfo.java&lt;/p&gt;

&lt;p&gt;Changes the toString() method to emit a DETERMINISTIC clause when the routine is deterministic. This, in turn, causes the dblook output to faithfully reproduce the DDL for deterministic routines.&lt;/p&gt;


&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/GeneratedColumnsTest.java&lt;/p&gt;

&lt;p&gt;Adds positive and negative tests for the new DDL.&lt;/p&gt;


&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/Changes10_5.java&lt;/p&gt;

&lt;p&gt;Verifies that the new clauses are recognized only after hard upgrade to 10.5.&lt;/p&gt;


&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/tools/dblook_makeDB.sql&lt;/p&gt;

&lt;p&gt;Adds routines with DETERMINISTIC and NOT DETERMINISTIC clauses to verify that dblook faithfully emits DDL for  these routines.&lt;/p&gt;


&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/master/DerbyNet/dblook_test_net.out&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/master/DerbyNet/dblook_test_net_territory.out&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/master/dblook_test_territory.out&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/dblook_test_net.out&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/master/DerbyNetClient/dblook_test_net_territory.out&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/master/dblook_test.out&lt;/p&gt;

&lt;p&gt;Canons accompanying the new ddl added to dblook_makeDB.sql.&lt;/p&gt;
</comment>
                            <comment id="12636619" author="rhillegas" created="Fri, 3 Oct 2008 13:45:30 +0100"  >&lt;p&gt;Committed derby-3570-02-aa-grammar.diff at subversion revision 701367.&lt;/p&gt;</comment>
                            <comment id="12636663" author="dagw" created="Fri, 3 Oct 2008 16:53:57 +0100"  >&lt;p&gt;Patch derby-3570-02-aa-grammar.diff looks good, found only this little Javadoc&lt;br/&gt;
error: &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&amp;lt;p&amp;gt;...&lt;/li&gt;
	&lt;li&gt;&amp;lt;/p&amp;gt;&lt;br/&gt;
     *&lt;/li&gt;
	&lt;li&gt;&amp;lt;/p&amp;gt;&lt;br/&gt;
____^&lt;/li&gt;
	&lt;li&gt;Also test that, by default, user-defined routines are created as NOT DETERMINISTIC.&lt;/li&gt;
	&lt;li&gt;&amp;lt;/p&amp;gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;before test case test_001_determinism_of_stored_system_routines.&lt;/p&gt;</comment>
                            <comment id="12636664" author="rhillegas" created="Fri, 3 Oct 2008 17:10:14 +0100"  >&lt;p&gt;Thanks, Dag. I corrected the javadoc problem with subversion revision 701425.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12312855">DERBY-481</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12672012">DERBY-6368</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12390724" name="derby-3570-01-aa-introduceDeterminismField.diff" size="42220" author="rhillegas" created="Tue, 23 Sep 2008 10:15:45 +0100"/>
                            <attachment id="12390930" name="derby-3570-01-ab-introduceDeterminismField.diff" size="42220" author="rhillegas" created="Thu, 25 Sep 2008 17:03:47 +0100"/>
                            <attachment id="12391071" name="derby-3570-02-aa-grammar.diff" size="23569" author="rhillegas" created="Sat, 27 Sep 2008 00:18:20 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 23 Sep 2008 14:03:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30907</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0pl3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37963</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>