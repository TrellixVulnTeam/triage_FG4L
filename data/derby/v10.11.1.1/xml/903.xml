<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:31:08 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-903/DERBY-903.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-903] Remove use of String(byte[]) and String(byte[], int, int) constructors in testing leading to non-portable behaviour</title>
                <link>https://issues.apache.org/jira/browse/DERBY-903</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;These constructors use the Java default platform encoding to convert the bytes to a String, this typically leads to bugs on platforms with different encodings.&lt;/p&gt;

&lt;p&gt;Replace with code using fixed conversion, or alternative mechanisms. &lt;br/&gt;
If the call is required its use should be commented as to why it is required.&lt;/p&gt;

&lt;p&gt;org.apache.derbyTesting.functionTests.tests.jdbcapi.blobclob4BLOB&lt;br/&gt;
org.apache.derbyTesting.functionTests.tests.jdbcapi.resultset&lt;br/&gt;
org.apache.derbyTesting.functionTests.tests.lang.coalesceTests&lt;br/&gt;
org.apache.derbyTesting.functionTests.tests.store.streamingColumn&lt;/p&gt;

&lt;p&gt;I generated this list using the Java search in eclipse for references to the constructors&lt;br/&gt;
String(byte[])&lt;br/&gt;
String(byte[],int,int) (no occurrences in java/testing)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12328367">DERBY-903</key>
            <summary>Remove use of String(byte[]) and String(byte[], int, int) constructors in testing leading to non-portable behaviour</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Feb 2006 06:03:02 +0000</created>
                <updated>Thu, 13 Dec 2007 09:04:46 +0000</updated>
                            <resolved>Fri, 28 Apr 2006 03:19:23 +0100</resolved>
                                    <version>10.1.3.1</version>
                                    <fixVersion>10.1.3.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12366183" author="myrna" created="Mon, 13 Feb 2006 19:39:20 +0000"  >&lt;p&gt;This patch fixes the occurrence of the constructors as reported, and in addition, fixes the 4 tests to use&lt;br/&gt;
fixed strings so the test passes with a different encoding in the following cases:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;string.getBytes()&lt;br/&gt;
       especially frequent in the blobclob4BLOB test, where it is used to obtain a number of bytes to insert into a blob. &lt;br/&gt;
       Using this without the encoding causes problems with other encodings.&lt;/li&gt;
	&lt;li&gt;change to use FileInputStream and InputStreamReader for subtest clobNegativeTest_Derby265 of blobclob4BLOB. (see also comment in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-575&quot; title=&quot;test blobclob4BLOB fails on OS 390&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-575&quot;&gt;&lt;del&gt;DERBY-575&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12366185" author="myrna" created="Mon, 13 Feb 2006 19:55:46 +0000"  >&lt;p&gt;I ran all 4 tests with jdk15, embedded, DerbyNet and DerbyNetClient.&lt;br/&gt;
coalesceTests and streamingColumn don&apos;t normally run with network server, but the result with and without the patch was the same with the default encoding, and now work the same way with -DderbyTesting.encoding=UTF-16 (need the improved patch for test harness from &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-683&quot; title=&quot;Use correct encoding for ClobOutputStream on client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-683&quot;&gt;&lt;del&gt;DERBY-683&lt;/del&gt;&lt;/a&gt; for this).&lt;/p&gt;

&lt;p&gt;The only noticeable thing here is that with DerbyNetClient, streamingColumn generates an odd error in subtest &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-500&quot; title=&quot;Update/Select failure when BLOB/CLOB fields updated in several rows by PreparedStatement using setBinaryStream and setCharacterStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-500&quot;&gt;&lt;del&gt;DERBY-500&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
&quot;End-of-Stream prematurely reached while reading Reader, parameter #4. Remaining data has been padded with 0x0. &quot;&lt;br/&gt;
However, again, this occurs with or without my changes to the test.&lt;/p&gt;

</comment>
                            <comment id="12366565" author="fuzzylogic" created="Thu, 16 Feb 2006 09:03:36 +0000"  >&lt;p&gt;Hi Myrna,&lt;/p&gt;

&lt;p&gt;I took a look at the latest patch for this, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-903&quot; title=&quot;Remove use of String(byte[]) and String(byte[], int, int) constructors in testing leading to non-portable behaviour&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-903&quot;&gt;&lt;del&gt;DERBY-903&lt;/del&gt;&lt;/a&gt;_021306.diff.  It looks good, except it&apos;s not clear to me that the diff in resultset.java would actually be encoding-safe. It looks like adding the contents of getBytes.toString() to the StringBuffer would be the same as new String(getBytes()), although this code is in an exception handler, so it&apos;s not clear to me from the code or the output that this code is ever reached. Let me know if you want to take a closer look at that, otherwise I&apos;ll go ahead and commit and you can follow up later.&lt;/p&gt;</comment>
                            <comment id="12366571" author="myrna" created="Thu, 16 Feb 2006 09:48:48 +0000"  >&lt;p&gt;Hi Andrew,&lt;/p&gt;

&lt;p&gt;Thx for looking at this.&lt;/p&gt;

&lt;p&gt;I would say, if no one objects, to go ahead with this change at this point, I will make a follow up patch to clean that bit up.&lt;/p&gt;

&lt;p&gt;The same construct is used in coalesceTests...The code doesn&apos;t get used in either test. It looks like it was copied out of metadata test, but I don&apos;t think it&apos;s done like this there (anymore), it&apos;s a odd piece of code. &lt;/p&gt;

</comment>
                            <comment id="12366673" author="myrna" created="Fri, 17 Feb 2006 05:29:47 +0000"  >&lt;p&gt;attaching follow up patch &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-903&quot; title=&quot;Remove use of String(byte[]) and String(byte[], int, int) constructors in testing leading to non-portable behaviour&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-903&quot;&gt;&lt;del&gt;DERBY-903&lt;/del&gt;&lt;/a&gt;_2006_02_16.diff &amp;amp; .stat which modify test resultset.java and coalesceTests.java to only print out a descriptive message if error 22005 is seen (currently not the case in either test). Also removed no longer needed UnsupportedEncodingException from dumpRS() in coalesceTests.&lt;/p&gt;

&lt;p&gt;tested only these two tests (in normally running framework configuration, with jdk14 &amp;amp; jdk15) and (using &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-683&quot; title=&quot;Use correct encoding for ClobOutputStream on client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-683&quot;&gt;&lt;del&gt;DERBY-683&lt;/del&gt;&lt;/a&gt; test patch) with derbyTesting.encoding=UTF-16 with jdk15.&lt;/p&gt;</comment>
                            <comment id="12367296" author="fuzzylogic" created="Wed, 22 Feb 2006 09:59:22 +0000"  >&lt;p&gt;Committed followup patch with revision 379643.&lt;/p&gt;</comment>
                            <comment id="12376296" author="myrna" created="Wed, 26 Apr 2006 01:14:13 +0100"  >&lt;p&gt;reopening for making a 10.1 version - with 10.1 tests streamingColumn and blobclob4BLOB  fails with 10.1 on zOS because of this usage. &lt;br/&gt;
Note that resultset and coalesceTests are ok, and blobclob4BLOB needs further work apart from back porting this change (see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-575&quot; title=&quot;test blobclob4BLOB fails on OS 390&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-575&quot;&gt;&lt;del&gt;DERBY-575&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;
</comment>
                            <comment id="12376476" author="myrna" created="Wed, 26 Apr 2006 20:09:08 +0100"  >&lt;p&gt;patch for 10.1 - &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-903&quot; title=&quot;Remove use of String(byte[]) and String(byte[], int, int) constructors in testing leading to non-portable behaviour&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-903&quot;&gt;&lt;del&gt;DERBY-903&lt;/del&gt;&lt;/a&gt;_101_20060426.* &lt;/p&gt;

&lt;p&gt;I&apos;ve run the affected tests on windows and zOS.&lt;br/&gt;
blobclob4BLOB still fails on zOS because of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-575&quot; title=&quot;test blobclob4BLOB fails on OS 390&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-575&quot;&gt;&lt;del&gt;DERBY-575&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
The other tests pass.&lt;/p&gt;</comment>
                            <comment id="12376636" author="fuzzylogic" created="Thu, 27 Apr 2006 12:54:30 +0100"  >&lt;p&gt;Committed 10.1 patch with revision 397394.&lt;/p&gt;</comment>
                            <comment id="12551304" author="fuzzylogic" created="Thu, 13 Dec 2007 09:04:46 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12317041">DERBY-575</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12325106">DERBY-658</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12322916" name="DERBY-903_021306.diff" size="16248" author="myrna" created="Mon, 13 Feb 2006 19:39:20 +0000"/>
                            <attachment id="12322915" name="DERBY-903_021306.stat" size="361" author="myrna" created="Mon, 13 Feb 2006 19:39:20 +0000"/>
                            <attachment id="12325899" name="DERBY-903_101_20060426.diff" size="10905" author="myrna" created="Wed, 26 Apr 2006 20:09:08 +0100"/>
                            <attachment id="12325898" name="DERBY-903_101_20060426.stat" size="184" author="myrna" created="Wed, 26 Apr 2006 20:09:08 +0100"/>
                            <attachment id="12323073" name="DERBY-903_followup1_2006_02_16.diff" size="1942" author="myrna" created="Fri, 17 Feb 2006 05:29:47 +0000"/>
                            <attachment id="12323072" name="DERBY-903_followup1_2006_02_16.stat" size="177" author="myrna" created="Fri, 17 Feb 2006 05:29:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 13 Feb 2006 19:39:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22200</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy10fb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39719</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>