<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:07:58 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4835/DERBY-4835.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4835] Trigger plan does not recompile with upgrade from 10.5.3.0 to 10.6.1.0 causing  java.lang.NoSuchMethodError</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4835</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Trigger plan does not recompile on upgrade from 10.5.3.0 to 10.6.1.0  causing the following exception  the first time the trigger is fired after upgrade.&lt;/p&gt;

&lt;p&gt;ATABASE = wombat), (DRDAID = null), Failed Statement is: INSERT INTO tidlggls(blt_number,create_date,update_date,propagation_date,glossary_status,&lt;br/&gt;
     time_stamp,min_max_size )&lt;br/&gt;
 VALUES ( (select max(blt_number) from tidlrblt), CURRENT_DATE,&lt;br/&gt;
CURRENT_DATE, CURRENT_DATE, &apos;00&apos; , CURRENT_TIMESTAMP, (select min_max_size from tidlrblt where blt_number = (select max(blt_number) from tidlrblt)))&lt;/p&gt;

&lt;p&gt;java.lang.NoSuchMethodError: org/apache/derby/iapi/sql/execute/ResultSetFactory.getProjectRestrictResultSet(Lorg/apache/derby/iapi/sql/execute/NoPutResultSet;Lorg/apache/derby/iapi/services/loader/GeneratedMethod;Lorg/apache/derby/iapi/services/loader/GeneratedMethod;ILorg/apache/derby/iapi/services/loader/GeneratedMethod;IZZDD)Lorg/apache/derby/iapi/sql/execute/NoPutResultSet;&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.exe.acf81e0010x012bx823cxd0d3x00000026c4a00.g0(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.exe.acf81e0010x012bx823cxd0d3x00000026c4a00.execute(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.GenericActivationHolder.execute(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.GenericPreparedStatement.executeSubStatement(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.Main.go(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.tools.ij.Main.main(Unknown Source)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.tools.ij.main(Unknown Source)&lt;/p&gt;

&lt;p&gt;Cleanup action completed&lt;/p&gt;

&lt;p&gt;To reproduce, run the attached script 10_5_3_work.sql with the 10.5.3.0  release and then connect with 10.6.1.0 and insert into the table with the trigger:&lt;/p&gt;

&lt;p&gt;connect &apos;jdbc:derby:wombat;upgrade=true&apos;;&lt;/p&gt;

&lt;p&gt;INSERT INTO tidlrblt(BLT,BLT_SIZE,MIN_MAX_SIZE) VALUES(&apos;Mamatha Testing2&apos;, 15, 20);&lt;br/&gt;
ERROR XJ001: Java exception: &apos;org/apache/derby/iapi/sql/execute/ResultSetFactory&lt;br/&gt;
.getProjectRestrictResultSet(Lorg/apache/derby/iapi/sql/execute/NoPutResultSet;L&lt;br/&gt;
org/apache/derby/iapi/services/loader/GeneratedMethod;Lorg/apache/derby/iapi/ser&lt;br/&gt;
vices/loader/GeneratedMethod;ILorg/apache/derby/iapi/services/loader/GeneratedMe&lt;br/&gt;
thod;IZZDD)Lorg/apache/derby/iapi/sql/execute/NoPutResultSet;: java.lang.NoSuchM&lt;br/&gt;
ethodError&apos;.&lt;/p&gt;


&lt;p&gt;I think this may be related to the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1107&quot; title=&quot;For existing databases JDBC metadata queries do not get updated properly  between maintenance versions.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1107&quot;&gt;&lt;del&gt;DERBY-1107&lt;/del&gt;&lt;/a&gt; change in handleMinorRevisionChange which has the code:&lt;br/&gt;
if (fromVersion.majorVersionNumber &amp;gt;= DataDictionary.DD_VERSION_DERBY_10_5)&lt;br/&gt;
				bootingDictionary.updateMetadataSPSes(tc);&lt;br/&gt;
			else&lt;br/&gt;
				bootingDictionary.clearSPSPlans();&lt;/p&gt;

&lt;p&gt;Likely, clearSPSPlans() should not be in the else clause but rather executed unconditionally.&lt;/p&gt;

&lt;p&gt;To work around the issue, after connecting with 10.6.1, drop and recreate the trigger as in workaround.sql&lt;/p&gt;



</description>
                <environment></environment>
        <key id="12476689">DERBY-4835</key>
            <summary>Trigger plan does not recompile with upgrade from 10.5.3.0 to 10.6.1.0 causing  java.lang.NoSuchMethodError</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Oct 2010 17:05:13 +0100</created>
                <updated>Tue, 7 Jun 2011 09:29:32 +0100</updated>
                            <resolved>Fri, 15 Oct 2010 19:13:00 +0100</resolved>
                                    <version>10.6.1.0</version>
                                    <fixVersion>10.5.3.2</fixVersion>
                    <fixVersion>10.6.2.4</fixVersion>
                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12918562" author="kmarsden" created="Wed, 6 Oct 2010 17:08:01 +0100"  >&lt;p&gt;scripts to recreate the issue. &lt;br/&gt;
Run 10_5_3_work.sql with 10.5.3.0 release&lt;br/&gt;
Run 10_6_1_work.sql with 10.6.1.0 release&lt;/p&gt;

&lt;p&gt;workaround.sql contains the commands to drop and recreate the trigger with 10.6 which will work around the problem.&lt;/p&gt;</comment>
                            <comment id="12918625" author="mikem" created="Wed, 6 Oct 2010 19:43:19 +0100"  >&lt;p&gt;will it be necessary to bump the version number once this fix is applied to catch cases where users have already passed through the &quot;bad&quot; upgrade path in order to force it through the minor upgrade path code again?&lt;/p&gt;</comment>
                            <comment id="12918685" author="kmarsden" created="Wed, 6 Oct 2010 22:02:45 +0100"  >&lt;p&gt;Yes Mike, you are right.  The last digit should be bumped on the branches when this is backported so that upgrade gets triggered.&lt;/p&gt;</comment>
                            <comment id="12919395" author="mamtas" created="Fri, 8 Oct 2010 23:15:00 +0100"  >&lt;p&gt;Attaching a patch to fix the problem.&lt;/p&gt;

&lt;p&gt;The problem was that the clearing of stored statements during the upgrade was conditional. The clearing should happen &lt;br/&gt;
unconditionally during upgrade. Unconditional clearing of SPSes has fixed the problem with this jira.&lt;/p&gt;

&lt;p&gt;Also, added a test in upgrade suite for triggers. The test has been added to BasicSetup.java which will ensure that this trigger&lt;br/&gt;
test will automatically get run with even future releases.&lt;/p&gt;

&lt;p&gt;If there are no objections, I will go ahead and commit this early next week and backport it to 10.6 and 10.5 releases(10.5 is when the SPS clearing became conditional at the uprgrade time.)&lt;/p&gt;</comment>
                            <comment id="12919398" author="mamtas" created="Fri, 8 Oct 2010 23:39:03 +0100"  >&lt;p&gt;Wanted to mention that I have verified that the new test for trigger will fail as part of the upgrade suite if the accompanying code changes are not made. So, the patch has the needed test coverage for the code changes.&lt;/p&gt;</comment>
                            <comment id="12919414" author="knutanders" created="Sat, 9 Oct 2010 00:14:19 +0100"  >&lt;p&gt;Thanks for writing the fix and the test case, Mamta.&lt;/p&gt;

&lt;p&gt;Does the patch also fix the case where a database is first upgraded to 10.6.&lt;span class=&quot;error&quot;&gt;&amp;#91;12&amp;#93;&lt;/span&gt; and then to 10.6.3? Or would the users still need to drop and recreate the triggers in that case?&lt;/p&gt;</comment>
                            <comment id="12919507" author="mamtas" created="Sat, 9 Oct 2010 17:14:09 +0100"  >&lt;p&gt;Knut, I plan to backport this change to 10.6 this upcoming week. If the user upgrades to that release, then they don&apos;t need to drop and recreate the triggers. &lt;/p&gt;</comment>
                            <comment id="12919627" author="knutanders" created="Sun, 10 Oct 2010 19:11:52 +0100"  >&lt;p&gt;Thanks Mamta. My question was a bit unclear. Here&apos;s what I meant to ask:&lt;/p&gt;

&lt;p&gt;After this fix has been backported to 10.6 and goes into a release (let&apos;s say 10.6.3.x), will it also fix the upgrade path 10.5.x -&amp;gt; 10.6.2.1 -&amp;gt; 10.6.3.x? Or will it only fix upgrades directly from 10.5.x to 10.6.3.x?&lt;/p&gt;</comment>
                            <comment id="12919912" author="mamtas" created="Mon, 11 Oct 2010 18:20:40 +0100"  >&lt;p&gt;Yes, if the user upgraded from 10.6.2.1-&amp;gt;10.6.3.x, that will fix the trigger problem because they will get invalidated during the upgrade. I double checked that by trying it here in my codeline. ie I created the db with 10.5.x, upgraded it to 10.6.2.1 and saw the trigger fail. Backported the change to my 10.6 codeline and bumped the release number and then upgraded the db again with those changes and the trigger worked fine.&lt;/p&gt;</comment>
                            <comment id="12920014" author="kmarsden" created="Mon, 11 Oct 2010 23:23:20 +0100"  >&lt;p&gt;I removed the scripts from the user case and am replacing with a link to the email thread.&lt;br/&gt;
&lt;a href=&quot;http://old.nabble.com/Problem!-tt29737134.html#a29894020&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://old.nabble.com/Problem!-tt29737134.html#a29894020&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Mamta did not need the user case to put a test in the regression suite, so no Apache grant is needed.&lt;/p&gt;
</comment>
                            <comment id="12921478" author="mamtas" created="Fri, 15 Oct 2010 19:13:00 +0100"  >&lt;p&gt;Thanks to Mamatha for providing a stand alone test case.&lt;/p&gt;

&lt;p&gt;Also, credit for the jira really goes to Kathey since she pointed out exactly what part of the code needed to be fixed. &lt;/p&gt;

&lt;p&gt;The fix now is in all the affected releases so I will go ahead and resolve the issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12500771">DERBY-5105</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12509398">DERBY-5263</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12456739" name="DERBY4835_patch1_diff.txt" size="2842" author="mamtas" created="Fri, 8 Oct 2010 23:15:00 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 6 Oct 2010 18:43:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24487</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    <customfieldvalue key="10427"><![CDATA[Workaround attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0g3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36425</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>