<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:36:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3050/DERBY-3050.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3050] Convert groupBy.sql tests to JUnit and include them in GroupByTest.java</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3050</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;There are currently 3 sets of GROUP BY tests:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;GroupByExpressionTest.java&lt;/li&gt;
	&lt;li&gt;GroupByTest.java&lt;/li&gt;
	&lt;li&gt;groupBy.sql&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The first two tests are JUnit tests; the groupBy.sql tests are old-style harness tests,&lt;br/&gt;
although they are now run in the JUnit framework using the LangScripts technique.&lt;/p&gt;

&lt;p&gt;This sub-task proposes to convert the groupBy.sql tests to JUnit tests, and to include&lt;br/&gt;
them directly into GroupByTest.java.&lt;/p&gt;

&lt;p&gt;The &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2151&quot; title=&quot;&amp;quot;Fixer-upper&amp;quot; utility to help convert ij canon-based tests to JUnit.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2151&quot;&gt;&lt;del&gt;DERBY-2151&lt;/del&gt;&lt;/a&gt; conversion tool can be used to assist in the conversion process.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12377492">DERBY-3050</key>
            <summary>Convert groupBy.sql tests to JUnit and include them in GroupByTest.java</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12317141">DERBY-581</parent>
                                    <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="bryanpendleton">Bryan Pendleton</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Sep 2007 21:26:55 +0100</created>
                <updated>Thu, 24 Jan 2008 15:13:51 +0000</updated>
                            <resolved>Wed, 23 Jan 2008 18:03:55 +0000</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12524869" author="kmarsden" created="Tue, 4 Sep 2007 21:39:56 +0100"  >&lt;p&gt;Thanks Bryan for converting these tests.  In using the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2152&quot; title=&quot;Support diagnostic vti tables that take parameters, such as SpaceTable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2152&quot;&gt;&lt;del&gt;DERBY-2152&lt;/del&gt;&lt;/a&gt; conversion tool, can you double check that it does not omit  the fail assert method after a method call in a try-catch block when the statement is expected to fail.  e.g. instead of &lt;/p&gt;

&lt;p&gt;try &lt;/p&gt;
{
  s.execute(command);
}
&lt;p&gt;catch (SQLException e)&lt;/p&gt;
{
   assertSQLState(&quot;42502&quot;, e);
}&lt;br/&gt;
 &lt;br/&gt;
&lt;br/&gt;
It should be:&lt;br/&gt;
&lt;br/&gt;
try {
  s.execute(command);
  fail(&quot;Command expected to fail&quot; + command);
}&lt;br/&gt;
catch (SQLException e){
   assertSQLState(&quot;42502&quot;, e);
}
</comment>
                            <comment id="12524890" author="bryanpendleton" created="Tue, 4 Sep 2007 22:55:25 +0100"  >&lt;p&gt;Thanks Kathey, I&apos;ll have a look. In the converted code that I&apos;ve looked at so far,&lt;br/&gt;
the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2151&quot; title=&quot;&amp;quot;Fixer-upper&amp;quot; utility to help convert ij canon-based tests to JUnit.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2151&quot;&gt;&lt;del&gt;DERBY-2151&lt;/del&gt;&lt;/a&gt; tool seems to generate code like:&lt;/p&gt;

&lt;p&gt;          assertStatementError(&quot;42Y35&quot;, st,&lt;br/&gt;
            &quot;select * from t1 having 1 between 1 and 2&quot;);&lt;/p&gt;

&lt;p&gt;which seems to neatly avoid the problem you are concerned about, since&lt;br/&gt;
assertStatementError does the right thing.&lt;/p&gt;</comment>
                            <comment id="12525539" author="bryanpendleton" created="Thu, 6 Sep 2007 23:15:07 +0100"  >&lt;p&gt;Attached is convertToJUnit.&lt;span class=&quot;error&quot;&gt;&amp;#91;stat,diff&amp;#93;&lt;/span&gt;, a patch proposal.&lt;/p&gt;

&lt;p&gt;I took groupBy.sql and ran it through the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2151&quot; title=&quot;&amp;quot;Fixer-upper&amp;quot; utility to help convert ij canon-based tests to JUnit.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2151&quot;&gt;&lt;del&gt;DERBY-2151&lt;/del&gt;&lt;/a&gt; converter, and it produced a nearly perfect file. (Wow!) I took the resulting file and merged the code into the existing GroupByTest.java, to make a (much larger) GroupByTest.java which tests GROUP BY processing in JUnit. I also removed the old groupBy.sql and its master files, and removed it from langScripts.&lt;/p&gt;

&lt;p&gt;The new GroupByTest runs cleanly as a standalone JUnit test, and my overall runs of derbyall and suites.All were also clean.&lt;/p&gt;

&lt;p&gt;Please have a look if you have a chance.&lt;/p&gt;</comment>
                            <comment id="12525779" author="mkhettry" created="Fri, 7 Sep 2007 18:09:20 +0100"  >&lt;p&gt;A few thoughts on the test case.&lt;/p&gt;

&lt;p&gt;1. The testcase creates and drops the fixtures (tables t1,t2) that it needs If the test fails, the tables will not be dropped causing potential problems if others add more tests to this suite. It may be better to move the table creation to a setUp method or better still to a oneTimeSetup or atleast dropping the tables in a finally block.&lt;/p&gt;

&lt;p&gt;2. Do you think its worth the effort to break up the new test case testGroupBy into smaller test cases? There are several advantages to small test cases-- for one, if you encounter a failure, it does not hide other problems down the test case. Second it can quickly clue you to the nature of the failure. The comments in the test provide a handy way to split up the test case; i.e.     &lt;/p&gt;

&lt;p&gt;        // ?s in group by&lt;br/&gt;
        // group by on long varchar type&lt;br/&gt;
        // having clause cannot contain column references which &lt;br/&gt;
        // are not grouping columns&lt;/p&gt;

&lt;p&gt;If a test case called testParamInGroupBy fails, the person investigating the failure has a &lt;b&gt;lot&lt;/b&gt; more to go by then a failure in testGroupBy.&lt;/p&gt;
</comment>
                            <comment id="12525791" author="bryanpendleton" created="Fri, 7 Sep 2007 18:54:42 +0100"  >&lt;p&gt;Thanks, these are great suggestions! I will have a look at improving the code accordingly.&lt;/p&gt;</comment>
                            <comment id="12560015" author="bryanpendleton" created="Thu, 17 Jan 2008 18:09:45 +0000"  >&lt;p&gt;Sorry, I kind of lost track of this issue. I intend to resume work on this and&lt;br/&gt;
try to get it done for 10.4.&lt;/p&gt;</comment>
                            <comment id="12560845" author="bryanpendleton" created="Sun, 20 Jan 2008 19:09:24 +0000"  >&lt;p&gt;Attached is a new version of &apos;convertToJunit.diff&apos;.&lt;/p&gt;

&lt;p&gt;This version substantially revises GroupByTest.java&lt;br/&gt;
to address Manish&apos;s suggestions regarding test case&lt;br/&gt;
organization. I have broken the monolithic test case&lt;br/&gt;
generated by the conversion tool into a dozen sub-tests,&lt;br/&gt;
according to boundaries that seemed reasonable to me.&lt;/p&gt;

&lt;p&gt;I also:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;consolidated all the table creation/population logic&lt;br/&gt;
   into setUp() and the drop logic into tearDown()&lt;/li&gt;
	&lt;li&gt;revised the existing test cases in GroupByTest to match&lt;/li&gt;
	&lt;li&gt;removed the line which was setting autocommit to&lt;br/&gt;
   false, and simply had all the tests run in autocommit mode.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The .stat file is unchanged; this patch deletes 4 files and modifies 2.&lt;/p&gt;

&lt;p&gt;I&apos;m still a beginner at this process of converting the old-style&lt;br/&gt;
IJ script tests to JUnit, so there are probably more things&lt;br/&gt;
I&apos;ve missed. So, please have a look at this new patch and&lt;br/&gt;
provide more feedback!&lt;/p&gt;</comment>
                            <comment id="12560846" author="bryanpendleton" created="Sun, 20 Jan 2008 19:10:41 +0000"  >&lt;p&gt;Set patchAvailable flag to request more feedback.&lt;/p&gt;

&lt;p&gt;I haven&apos;t yet run the complete test suites with this patch, but&lt;br/&gt;
GroupByTest by itself runs correctly in my environment.&lt;/p&gt;

&lt;p&gt;If people are generally comfortable with this patch, I&apos;ll move&lt;br/&gt;
ahead with more complete testing.&lt;/p&gt;</comment>
                            <comment id="12560852" author="djd" created="Sun, 20 Jan 2008 19:29:24 +0000"  >&lt;p&gt;&amp;gt; &apos;m still a beginner at this process of converting the old-style IJ script tests to JUnit ...&lt;/p&gt;

&lt;p&gt;Just a reminder that setup and tearDown is executed once per fixture (each testXXX method) not once per class.&lt;br/&gt;
From a quick look at the test fixtures it seems they do not modify the data, thus would it make more sense to perform&lt;br/&gt;
the setup using the facilities of CleanDatabaseTestSetup? Ie. CleanDatabaseTestSetup.decorateSQL. Then no test specific&lt;br/&gt;
code is needed for cleanup.&lt;/p&gt;

&lt;p&gt;Usuallly test classes do not need instance variables for JDBC objects (e.g Statements and ResultSets). They provide almost no benefit and have the downside that either code is needed to clean them up (assign the fields to null) or they continue to use memory after the test has finished.&lt;/p&gt;

&lt;p&gt;Such fields provide no benefit because the object in the field (e.g. a Statement) is not shared across fixtures, each fixture is represented by a unique instance of the class, thus with N fixutures N Statements will be created rather than the one that might be assumed by using a field. Since the Statement is local to the fixture it becomes cleaner to keep it locally scoped in the testXXX() fixture method, passing it into utility methods as required. &lt;br/&gt;
The only benefit can be sharing a Statement object across a testXXX fixuture method and setup/teardown methods. Since Statement objects are not expensive to create then I think this is of dubious value, I think it&apos;s clearer for someone reading the test later to understand the code with a locally scoped object rather than an instance object.&lt;/p&gt;</comment>
                            <comment id="12560865" author="bryanpendleton" created="Sun, 20 Jan 2008 20:20:13 +0000"  >&lt;p&gt;Thanks Dan!&lt;/p&gt;

&lt;p&gt;Updating the test to use CleanDatabaseTestSetup has the&lt;br/&gt;
added benefit that the test now runs in 9 seconds, where it&lt;br/&gt;
was taking close to a minute before. Very nice.&lt;/p&gt;

&lt;p&gt;In addition to using CleanDatabaseTestSetup, I also made&lt;br/&gt;
the Statement and ResultSet variables local to the test case.&lt;/p&gt;</comment>
                            <comment id="12561201" author="bryanpendleton" created="Tue, 22 Jan 2008 02:25:44 +0000"  >&lt;p&gt;&apos;afterMergeWith3257.diff&apos; is an updated patch, which&lt;br/&gt;
resolves the merge with the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3257&quot; title=&quot;SELECT with HAVING clause containing OR conditional incorrectly return 1 row - should return 2 rows - works correctly with 10.2 DB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3257&quot;&gt;&lt;del&gt;DERBY-3257&lt;/del&gt;&lt;/a&gt; patch.&lt;/p&gt;

&lt;p&gt;I also ran junit-all and derbyall and I&apos;ve got 100% pass rate.&lt;/p&gt;

&lt;p&gt;If there are no further comments, I&apos;ll commit this patch later this week.&lt;/p&gt;</comment>
                            <comment id="12561748" author="bryanpendleton" created="Wed, 23 Jan 2008 18:03:55 +0000"  >&lt;p&gt;Committed to the trunk as revision 614596.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12375845">DERBY-3002</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12373713" name="afterMergeWith3257.diff" size="140929" author="bryanpendleton" created="Tue, 22 Jan 2008 02:25:44 +0000"/>
                            <attachment id="12365296" name="convertToJUnit.diff" size="136476" author="bryanpendleton" created="Thu, 6 Sep 2007 23:15:07 +0100"/>
                            <attachment id="12365295" name="convertToJUnit.stat" size="523" author="bryanpendleton" created="Thu, 6 Sep 2007 23:15:07 +0100"/>
                            <attachment id="12373634" name="convertToJunit.diff" size="140959" author="bryanpendleton" created="Sun, 20 Jan 2008 20:20:13 +0000"/>
                            <attachment id="12373630" name="convertToJunit.diff" size="140155" author="bryanpendleton" created="Sun, 20 Jan 2008 19:09:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 4 Sep 2007 20:39:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30710</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0znr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39595</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>