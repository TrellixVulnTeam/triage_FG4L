<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:39:43 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1786/DERBY-1786.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1786] a crash during re-encryption of an existing  database with lot of tables can make database unrecoverable on a  next boot.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1786</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;While running reencryt  crash/recovery functional test  with  1000 tables (&amp;gt;2000 containers) , I hit a following boot failire. &lt;/p&gt;

&lt;p&gt;ERROR XJ040: Failed to start database &apos;wombat_pwd_en&apos;, see the next exception fo&lt;br/&gt;
r details.&lt;br/&gt;
ERROR XSTB0: An exception was thrown during transaction abort.&lt;br/&gt;
java.sql.SQLException: Failed to start database &apos;wombat_pwd_en&apos;, see the next ex&lt;/p&gt;

&lt;p&gt;============= begin nested exception, level (1) ===========&lt;/p&gt;

&lt;p&gt;ERROR XSRS4: Error renaming file (during backup) from E:\suresht\adhoctests\reencryption\dbs\wombat_pwd_en\seg0\c340.dat to E:\suresht\adhoctests\reencryption\dbs\wombat_pwd_en\seg0\n340.dat.&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;/p&gt;

&lt;p&gt;After bit of  debugging ; my suspicion  is this problem is happening becuase of more than one log file switch during re-encryption and current &lt;br/&gt;
re-encryption recovery code does not seem to handle it correctly. &lt;/p&gt;

</description>
                <environment></environment>
        <key id="12348956">DERBY-1786</key>
            <summary>a crash during re-encryption of an existing  database with lot of tables can make database unrecoverable on a  next boot.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tsuresh">Suresh Thalamati</assignee>
                                    <reporter username="tsuresh">Suresh Thalamati</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Aug 2006 23:54:38 +0100</created>
                <updated>Thu, 13 Dec 2007 09:05:12 +0000</updated>
                            <resolved>Mon, 18 Sep 2006 18:06:20 +0100</resolved>
                                    <version>10.2.1.6</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12431749" author="rhillegas" created="Thu, 31 Aug 2006 00:48:28 +0100"  >&lt;p&gt;Hi Suresh,&lt;/p&gt;

&lt;p&gt;Do you think this is a regression from 10.1.3? Thanks-Rick&lt;/p&gt;</comment>
                            <comment id="12431756" author="tsuresh" created="Thu, 31 Aug 2006 01:23:29 +0100"  >&lt;p&gt;Hi Rick, &lt;/p&gt;

&lt;p&gt;This is related to new feature (re-encryption(&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1156&quot; title=&quot;allow the encrypting of an existing unencrypted db and allow the re-encrypting of an existing encrypted db&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1156&quot;&gt;&lt;del&gt;DERBY-1156&lt;/del&gt;&lt;/a&gt;)). not a regression.  User will hit this issue only if  &lt;br/&gt;
user does  (re)encryption of an existing database and  if  there is a power outage in a small-window of work. &lt;br/&gt;
I will try to fix this for 10.2  , so that I can sleep in peace &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


&lt;p&gt;/suresh&lt;/p&gt;
</comment>
                            <comment id="12434077" author="tsuresh" created="Tue, 12 Sep 2006 08:05:40 +0100"  >&lt;p&gt;The problem was when transaction log spans more than one log file during (re)&lt;br/&gt;
encryption of the database and if there is a crash just before switching the&lt;br/&gt;
database to use the new encryption properties; On recovery checkpoint in the&lt;br/&gt;
first log file is used as reference and the next log file is assumed to have&lt;br/&gt;
the commit log record for (re) encryption and deleted incorrectly to force the&lt;br/&gt;
roll-back , which lead to the incomplete rollback of re-encryption. And that&lt;br/&gt;
caused recovery failures on next (re) encryption crashed. &lt;/p&gt;

&lt;p&gt;This patch fixes the problem by ensuring there a checkpoint record in the&lt;br/&gt;
last log file before creating a new log file with new encryption properties&lt;br/&gt;
and writing the commit log record. Log is also flushed before making the&lt;br/&gt;
transaction log use the new encryption key to avoid any part of old log &lt;br/&gt;
records in the buffers getting encrypted with the new encryption key. &lt;br/&gt;
While working on this problem , I noticed error message thrown incase of &lt;br/&gt;
re-encryption failures are confusing, added a new error message to indicate &lt;br/&gt;
failures specific to (re) encryption. &lt;/p&gt;


&lt;p&gt;/suresh&lt;/p&gt;</comment>
                            <comment id="12434220" author="tsuresh" created="Tue, 12 Sep 2006 18:22:55 +0100"  >&lt;p&gt;Committed derby-1786.diff  to trunk;  revision 442647.&lt;/p&gt;</comment>
                            <comment id="12435533" author="tsuresh" created="Mon, 18 Sep 2006 18:06:11 +0100"  >&lt;p&gt;committed  to 10.2 as part of meg-merge done by Rick. on revision  446700.&lt;/p&gt;</comment>
                            <comment id="12551414" author="fuzzylogic" created="Thu, 13 Dec 2007 09:05:12 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12339907" name="ASF.LICENSE.NOT.GRANTED--stk.txt" size="7953" author="tsuresh" created="Wed, 30 Aug 2006 23:54:38 +0100"/>
                            <attachment id="12340626" name="derby-1786.diff" size="24454" author="tsuresh" created="Tue, 12 Sep 2006 08:05:40 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 30 Aug 2006 23:48:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22705</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0zzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39650</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>