<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:28:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3266/DERBY-3266.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3266] Not possible for non-db-owner to create a temporary table. &quot;Get ERROR 42507: User &apos;USERB&apos; can not perform the operation in schema &apos;SESSION&apos;.&quot;</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3266</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;It seems that only the owner of a database may create tempoary tables in that db.&lt;br/&gt;
This is not helpful as many other users may want to run a query on that db that relies upon the creation of temporary tables.&lt;/p&gt;

&lt;p&gt;I would expect non-db-owners to be able create temporay tables.&lt;/p&gt;

&lt;p&gt;The problem is demonstrated with:&lt;/p&gt;

&lt;p&gt;derby.properties like this:&lt;/p&gt;

&lt;p&gt;derby.connection.requireAuthentication=true&lt;br/&gt;
derby.authentication.provider=BUILTIN&lt;br/&gt;
derby.database.sqlAuthorization=TRUE&lt;br/&gt;
derby.user.usera=pwd&lt;br/&gt;
derby.fullAccessUsers=usera&lt;br/&gt;
derby.drda.host=192.168.1.50&lt;/p&gt;

&lt;p&gt;Start the network server and run up &apos;ij&apos;.&lt;br/&gt;
ij&amp;gt;connect &apos;jdbc:derby://192.168.1.50:1527/TEST1;user=usera;password=pwd;create=true;&apos;;&lt;br/&gt;
ij&amp;gt; declare global temporary table t11(a int) on commit preserve rows&lt;br/&gt;
not logged;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;/p&gt;

&lt;p&gt;All good so far.&lt;/p&gt;

&lt;p&gt;Now try this (while still connected as usera):&lt;br/&gt;
ij&amp;gt; call SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(&apos;derby.user.userb&apos;,&apos;pwd&apos;);&lt;br/&gt;
Statement executed.&lt;br/&gt;
ij&amp;gt;  call SYSCS_UTIL.SYSCS_SET_USER_ACCESS(&apos;userb&apos;,&apos;FULLACCESS&apos;);&lt;br/&gt;
Statement executed.&lt;br/&gt;
ij&amp;gt; disconnect;&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby://192.168.1.50:1527/TEST1;user=userb;password=pwd;&apos;;&lt;br/&gt;
ij&amp;gt; declare global temporary table t1(a int) on commit preserve rows not logged;&lt;br/&gt;
ERROR 42507: User &apos;USERB&apos; can not perform the operation in schema &apos;SESSION&apos;.&lt;/p&gt;

&lt;p&gt;SYSINFO:&lt;br/&gt;
========&lt;/p&gt;

&lt;p&gt;------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.6.0_02-ea&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
Java home:       /usr/java/jdk1.6.0_02/jre&lt;br/&gt;
Java classpath:  /home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derby.jar:/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derbynet.jar:/home/ajvok/derby/db-derby-&lt;br/&gt;
10.3.1.4-bin/lib/derbytools.jar:/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derbyclient.jar:/home/ajvok/derby/local/sp1.jar&lt;br/&gt;
OS name:         Linux&lt;br/&gt;
OS architecture: i386&lt;br/&gt;
OS version:      2.6.17-5mdv&lt;br/&gt;
Java user name:  ajvok&lt;br/&gt;
Java user home:  /home/ajvok&lt;br/&gt;
Java user dir:   /home/ajvok/derby/local&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
java.specification.version: 1.6&lt;br/&gt;
--------- Derby Information --------&lt;br/&gt;
JRE - JDBC: Java SE 6 - JDBC 4.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derby.jar&amp;#93;&lt;/span&gt; 10.3.1.4 - (561794)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derbytools.jar&amp;#93;&lt;/span&gt; 10.3.1.4 - (561794)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derbynet.jar&amp;#93;&lt;/span&gt; 10.3.1.4 - (561794)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/ajvok/derby/db-derby-10.3.1.4-bin/lib/derbyclient.jar&amp;#93;&lt;/span&gt; 10.3.1.4 - (561794)&lt;br/&gt;
------------------------------------------------------&lt;br/&gt;
----------------- Locale Information -----------------&lt;br/&gt;
Current Locale :  [English/United Kingdom &lt;span class=&quot;error&quot;&gt;&amp;#91;en_GB&amp;#93;&lt;/span&gt;]&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;cs&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;de_DE&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;es&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;fr&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;hu&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;it&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ja_JP&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ko_KR&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;pl&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;pt_BR&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ru&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;zh_CN&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;zh_TW&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.1.4 - (561794)&lt;br/&gt;
------------------------------------------------------&lt;/p&gt;</description>
                <environment>Linux 2.6.17-5mdv</environment>
        <key id="12384280">DERBY-3266</key>
            <summary>Not possible for non-db-owner to create a temporary table. &quot;Get ERROR 42507: User &apos;USERB&apos; can not perform the operation in schema &apos;SESSION&apos;.&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="ajvok">adam jvok</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Dec 2007 03:44:55 +0000</created>
                <updated>Fri, 21 Jan 2011 17:51:13 +0000</updated>
                            <resolved>Wed, 15 Oct 2008 02:34:21 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12549986" author="johnemb" created="Mon, 10 Dec 2007 09:41:19 +0000"  >&lt;p&gt;It&apos;s important to note that this is only an issue when sqlAuthorization is enabled in Derby (this is not clear from this issue&apos;s Summary or Description).&lt;/p&gt;

&lt;p&gt;It seems to me that this is an area that was overlooked when the SQL Authorization (GRANT/REVOKE) feature was implemented. The functional spec attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-464&quot; title=&quot;Enhance Derby by adding grant/revoke support. Grant/Revoke provide finner level of privileges than currently provided by Derby that is especially useful in network configurations.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-464&quot;&gt;&lt;del&gt;DERBY-464&lt;/del&gt;&lt;/a&gt; says:&lt;/p&gt;

&lt;p&gt;&quot;The owner of the database may create any schema with any owner (authorization). Other users may only create schemas whose name is the same as their user name and that are owned by the user. For example, if user angelica does not own the database then she can only create a schema with name and authorization angelica.&quot;&lt;/p&gt;

&lt;p&gt;It seems that operations in the SESSION schema is a special case which should probably be handled a bit differently.&lt;/p&gt;</comment>
                            <comment id="12637176" author="myrna" created="Mon, 6 Oct 2008 19:55:51 +0100"  >&lt;p&gt;I wonder what would be an appropriate way to handle this.&lt;br/&gt;
Does anyone know if the SQL spec has any details regarding this? I&apos;ll go poke  around, but if anyone has pointers...&lt;/p&gt;

&lt;p&gt;Without knowing what the SQL spec says (if anything), I can think of 2 ways of dealing with this:&lt;br/&gt;
1. allow anyone with FULLACCESS to create temp tables&lt;br/&gt;
2. add a separate table privilege, like CREATE_TEMP_TABLE&lt;br/&gt;
Any other approaches? &lt;/p&gt;</comment>
                            <comment id="12637279" author="dagw" created="Mon, 6 Oct 2008 23:22:44 +0100"  >&lt;p&gt;3. Create one SESSION schema per user (lazily created, only if needed), to be owned by that session&apos;s user.&lt;/p&gt;

</comment>
                            <comment id="12637291" author="dagw" created="Mon, 6 Oct 2008 23:56:11 +0100"  >&lt;p&gt;This note in the refman may point to a solution:&lt;/p&gt;

&lt;p&gt;&quot;Multiple connections can define declared global temporary tables with the same name because each connection has its own unique table descriptor for it.&quot;&lt;/p&gt;

&lt;p&gt;This indicates that even if users share writeaccess to the same SESSION schema, it will be safe, since&lt;br/&gt;
they see their own session local tables only...?&lt;/p&gt;</comment>
                            <comment id="12637295" author="dagw" created="Tue, 7 Oct 2008 00:08:25 +0100"  >&lt;p&gt;Complicating the issue is the fact that SESSION may also be a physical schema containing&lt;br/&gt;
normal tables although discouraged), and you don&apos;t want to give non-authorized user blanket access to&lt;br/&gt;
those...&lt;/p&gt;</comment>
                            <comment id="12637334" author="dagw" created="Tue, 7 Oct 2008 02:00:48 +0100"  >&lt;p&gt;Uploading an experimental patch that seems to solve the issue,&lt;br/&gt;
by omitting the privilege checks iff the table is a temporary table (but they&lt;br/&gt;
still apply for persistent tables in schema SESSION, if any).&lt;/p&gt;

&lt;p&gt;Ij run after applying it (dag is owner, knut is ordinary user):&lt;/p&gt;

&lt;p&gt;java -Dij.exceptionTrace=true org.apache.derby.tools.ij&lt;br/&gt;
ij version 10.5&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:wombat;user=knut;password=anders&apos;;&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select * from session.t;&lt;br/&gt;
ERROR 42502: User &apos;KNUT&apos; does not have SELECT permission on column &apos;I&apos; of table &apos;SESSION&apos;.&apos;T&apos;.&lt;/p&gt;

&lt;p&gt;ij&amp;gt; declare global temporary table t ( i int) on commit preserve rows not logged;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into session.t values 1,2,3;&lt;br/&gt;
3 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select * from session.t;&lt;br/&gt;
I          &lt;br/&gt;
-----------&lt;br/&gt;
1          &lt;br/&gt;
2          &lt;br/&gt;
3          &lt;/p&gt;

&lt;p&gt;3 rows selected&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:wombat;user=dag;password=wanvik&apos;;&lt;br/&gt;
ij(CONNECTION1)&amp;gt; select * from session.t;&lt;br/&gt;
I          |J          &lt;br/&gt;
-----------------------&lt;br/&gt;
0          |0          &lt;br/&gt;
1          |1          &lt;/p&gt;

&lt;p&gt;2 rows selected&lt;/p&gt;</comment>
                            <comment id="12637754" author="dagw" created="Wed, 8 Oct 2008 03:39:06 +0100"  >&lt;p&gt;Uploading a new version of this patch, which now also allows dropping&lt;br/&gt;
the temporary tabel for non-dbo users. I also added a test case&lt;br/&gt;
to GrantRevokeDDLTest: testGlobalTempTables.&lt;/p&gt;

&lt;p&gt;Ideally, the entire declareGlobalTempTableJavaJDBC30 should be converted to JUnit and run for dbo and non-dbo, but I am afraid that &apos;s out fo scope for me now.&lt;/p&gt;

&lt;p&gt;Running regressions now, please review.&lt;/p&gt;</comment>
                            <comment id="12638356" author="rhillegas" created="Thu, 9 Oct 2008 19:40:28 +0100"  >&lt;p&gt;Thanks for the patch, Dag. It looks small and targetted and it looks like a good, incremental improvement to me.&lt;/p&gt;</comment>
                            <comment id="12638451" author="dagw" created="Fri, 10 Oct 2008 01:15:37 +0100"  >&lt;p&gt;Thanks for reviewing this, Rick!&lt;br/&gt;
I&apos;ll let this sit for some days, in case others have any feedback on this. If none, I plan to commit it.&lt;br/&gt;
I haven&apos;t dealt with the temporary tables code before, so, if someone familiar with that part of the code would&lt;br/&gt;
have a look, that would be great.&lt;/p&gt;</comment>
                            <comment id="12638503" author="ajvok" created="Fri, 10 Oct 2008 07:57:40 +0100"  >&lt;p&gt;Dag-&lt;/p&gt;

&lt;p&gt;From a quick test, your patch seems to do the trick - thank you very much.&lt;/p&gt;

&lt;p&gt;I figured, as I reported this issue, I ought test it.&lt;/p&gt;

&lt;p&gt;Now extra pleased as I&apos;ve not only got your fix but it forced me into my first time building of derby.&lt;/p&gt;

&lt;p&gt;Thanks. -Adam.&lt;/p&gt;</comment>
                            <comment id="12638580" author="dagw" created="Fri, 10 Oct 2008 17:10:03 +0100"  >&lt;p&gt;Thanks for testing this, Adam, glad it helps. Have fun building Derby! &lt;br/&gt;
Maybe we&apos;ll see your first patch soon? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; If you didn&apos;t see it already, you may want to have a look at&lt;br/&gt;
&lt;a href=&quot;http://wiki.apache.org/db-derby/ForNewDevelopers&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/ForNewDevelopers&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12639687" author="dagw" created="Wed, 15 Oct 2008 02:34:21 +0100"  >&lt;p&gt;Committed patch #2 as svn 704762, resolving.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12417126">DERBY-4101</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12391596" name="derby-3266-1.diff" size="5379" author="dagw" created="Tue, 7 Oct 2008 02:00:48 +0100"/>
                            <attachment id="12391597" name="derby-3266-1.stat" size="227" author="dagw" created="Tue, 7 Oct 2008 02:00:48 +0100"/>
                            <attachment id="12391699" name="derby-3266-2.diff" size="8173" author="dagw" created="Wed, 8 Oct 2008 03:39:06 +0100"/>
                            <attachment id="12391700" name="derby-3266-2.stat" size="317" author="dagw" created="Wed, 8 Oct 2008 03:39:06 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 10 Dec 2007 09:41:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23533</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0lun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37358</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>