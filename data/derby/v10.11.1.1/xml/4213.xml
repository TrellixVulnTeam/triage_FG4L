<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:44:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4213/DERBY-4213.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4213] sttest needs to be adjusted to not run out of disk space</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4213</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;After eliminating some NullPointerExceptions for 10.5.1.1 (which I noticed with 10.5.1.0 testing but had also been present with 10.4.2.0) the sttest runs out of disk space before all threads are done. &lt;br/&gt;
Before, with the NPEs, the test would run its course in a day or two.&lt;br/&gt;
The test should be adjusted, with perhaps more deletes, so that it will no longer run out of disk space.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12424567">DERBY-4213</key>
            <summary>sttest needs to be adjusted to not run out of disk space</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 May 2009 23:54:52 +0100</created>
                <updated>Mon, 5 Jul 2010 17:39:37 +0100</updated>
                            <resolved>Fri, 21 Aug 2009 21:47:01 +0100</resolved>
                                    <version>10.5.1.1</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12717434" author="myrna" created="Mon, 8 Jun 2009 22:31:46 +0100"  >&lt;p&gt;I had hoped that recent fixes to the compress code might have taken care of this, but I ran sttest and the database  still grew to like 40 G within the first day and filled the disk. Interestingly, there were no errors when the disk got full, instead, processing just stopped...&lt;/p&gt;</comment>
                            <comment id="12718592" author="myrna" created="Thu, 11 Jun 2009 20:14:16 +0100"  >&lt;p&gt;I took a quick look at the class system/sttest/utils/CompressTable.java, to see why this wasn&apos;t improved by the fix for the in-place compress, and it&apos;s because this class doesn&apos;t use in place compress.&lt;br/&gt;
Instead, it uses the syntax:&lt;br/&gt;
	s.execute(&quot;alter table Datatypes compress&quot;);&lt;/p&gt;

&lt;p&gt;Perhaps this improves enough if we implement inplace compress in this class.&lt;/p&gt;
</comment>
                            <comment id="12744785" author="myrna" created="Wed, 19 Aug 2009 00:50:21 +0100"  >&lt;p&gt;I tried to replace the section in utils/CompressTable.java which looks like it tries to compress the Datatypes table, with a call to SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE(.,.,.,.,.), but so far, I don&apos;t see the compress being called.&lt;br/&gt;
However, I notice that although there&apos;s code that deletes rows being call, but only very, very few rows actually get deleted - most of the deletes find no rows to delete.&lt;br/&gt;
At which point I don&apos;t think compress would do much anyway.&lt;/p&gt;

&lt;p&gt;I&apos;m take a closer look at the delete rows code.&lt;/p&gt;</comment>
                            <comment id="12745719" author="myrna" created="Fri, 21 Aug 2009 00:15:07 +0100"  >&lt;p&gt;I&apos;m attaching a patch which tries to address the growth of the database in sttest by the following:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;adjust the compress() method with syntax that works (using SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE) and hang it in the test.&lt;br/&gt;
   The method Sttest.compress wasn&apos;t used before.&lt;br/&gt;
   As I didn&apos;t think it mattered much where this was called, but I didn&apos;t want it very often, I hung this right after a Memcheck.&lt;/li&gt;
	&lt;li&gt;adjust the delete code to pick rows by doing select id from Datatypes where id &amp;gt;= &amp;lt;randomnumber&amp;gt; and if there is no suitable row in the database, try with a different random number.&lt;br/&gt;
   Before, it was using the exact random number, and it was adding the resulting id value to the list, resulting in lots of attempts to delete a row with id &apos;0&apos;.&lt;br/&gt;
  Now, the likelihood of finding a row is much better, and so more rows actually get deleted.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With this code, the database stays fairly small in my test runs (granted, I built with both targetmin and targetmax smaller).&lt;/p&gt;

&lt;p&gt;Some comments:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I also updated the utils/CompressTable with working syntax for in-place-compress, however, as far as I can tell, this class, or its methods, are not used anywhere.&lt;/li&gt;
	&lt;li&gt;Sometimes, (especially with smaller targetmin/max) the code that builds a list of rows to be deleted, will end up with a number of identical ids to be deleted. I figured this was ok, it&apos;s still better than hoping for a random number to exist in the database.&lt;/li&gt;
	&lt;li&gt;I noticed various minor inconsistencies that I don&apos;t intend to address at this time, for instance:&lt;/li&gt;
	&lt;li&gt;there are (still) some unused objects floating around.&lt;/li&gt;
	&lt;li&gt;sometimes, the message &apos;hit targetmax with &amp;lt;rowcount&amp;gt; ...&apos; has a null date. I didn&apos;t look into this as it seemed unrelated to my changes.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review is welcome, but I plan to commit this fairly soon...If there are no comments on this patch, I&apos;ll commit it tomorrow and backport to 10.5.&lt;/p&gt;</comment>
                            <comment id="12746215" author="myrna" created="Fri, 21 Aug 2009 21:47:01 +0100"  >&lt;p&gt;I committed the patch to trunk (revision 806699) and backported to 10.5 (revision 806715).&lt;br/&gt;
It&apos;s always possible to adjust this further if anyone has comments, but for now, I&apos;m resolving the issue, and as I logged it, I&apos;m closing it too.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12417191" name="DERBY-4213.diff1" size="6175" author="myrna" created="Fri, 21 Aug 2009 00:15:07 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31163</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0pzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38027</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>