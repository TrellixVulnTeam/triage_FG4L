<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:26:48 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-212/DERBY-212.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-212] Optimize some specific methods in Network Server to improve performance</title>
                <link>https://issues.apache.org/jira/browse/DERBY-212</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In reviewing the Network Server Code and profiling there were &lt;br/&gt;
several areas that showed potential for providing performance &lt;br/&gt;
improvement.&lt;/p&gt;

&lt;p&gt;Functions that need optimizing to prevent unneeded object &lt;br/&gt;
creation and excessive decoding&lt;br/&gt;
parsePKGNAMCSN()&lt;br/&gt;
parseSQLDTA_work()&lt;br/&gt;
buildDB2CursorName()&lt;/p&gt;


&lt;p&gt;In DDMWriter and DDMReader, use System Routines in &lt;br/&gt;
java.util.Arrays and System.arrayCopy instead of &lt;br/&gt;
writing code to do functions like copy arrays and &lt;br/&gt;
pad strings.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="31587">DERBY-212</key>
            <summary>Optimize some specific methods in Network Server to improve performance</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dyret">Dyre Tjeldvoll</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Apr 2005 11:35:13 +0100</created>
                <updated>Fri, 21 Jan 2011 18:13:39 +0000</updated>
                            <resolved>Wed, 25 Oct 2006 13:35:22 +0100</resolved>
                                    <version>10.1.1.0</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="12360406" author="knutanders" created="Wed, 14 Dec 2005 17:35:16 +0000"  >&lt;p&gt;The method buildDB2CursorName() mentioned in the description of this&lt;br/&gt;
issue seems to have disappeared from the code. A comment in&lt;br/&gt;
DRDAConnThread.parsePKGNAMCSN() says&lt;/p&gt;

&lt;p&gt;  // Note: This string is parsed by DRDAStatement.buildDB2CursorName()&lt;/p&gt;

&lt;p&gt;but there is no such method in DRDAStatement. There is however a&lt;br/&gt;
method called extractPkgcnstknStr() which parses the string returned&lt;br/&gt;
by parsePKGNAMCSN() and seems to take a lot of resources.&lt;/p&gt;</comment>
                            <comment id="12360828" author="dyret" created="Tue, 20 Dec 2005 00:19:55 +0000"  >&lt;p&gt;Knut and I have looked at this, and Knut has patch for much of this that will be ready soon.&lt;/p&gt;</comment>
                            <comment id="12360840" author="dyret" created="Tue, 20 Dec 2005 02:12:14 +0000"  >&lt;p&gt;Added performance as a component&lt;/p&gt;</comment>
                            <comment id="12361125" author="knutanders" created="Fri, 23 Dec 2005 02:29:32 +0000"  >&lt;p&gt;I have uploaded a patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-212&quot; title=&quot;Optimize some specific methods in Network Server to improve performance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-212&quot;&gt;&lt;del&gt;DERBY-212&lt;/del&gt;&lt;/a&gt;-parsePKGNAMCSN.diff) which changes&lt;br/&gt;
the following files:&lt;/p&gt;

&lt;p&gt;M      java/drda/org/apache/derby/impl/drda/DDMWriter.java&lt;br/&gt;
A      java/drda/org/apache/derby/impl/drda/DRDAString.java&lt;br/&gt;
A      java/drda/org/apache/derby/impl/drda/Pkgnamcsn.java&lt;br/&gt;
M      java/drda/org/apache/derby/impl/drda/DRDAStatement.java&lt;br/&gt;
M      java/drda/org/apache/derby/impl/drda/Database.java&lt;br/&gt;
M      java/drda/org/apache/derby/impl/drda/DRDAConnThread.java&lt;br/&gt;
M      java/drda/org/apache/derby/impl/drda/DDMReader.java&lt;/p&gt;

&lt;p&gt;The patch only addresses the reported problems in&lt;br/&gt;
parsePKGNAMCSN(). This method parses a PKGNAMCSN object and returns a&lt;br/&gt;
string with all the fields concatenated. When other parts of the code&lt;br/&gt;
need one of the fields, a StringTokenizer has to be used to fetch the&lt;br/&gt;
field. This approach leads to a lot of unnecessary object allocation&lt;br/&gt;
and string parsing.&lt;/p&gt;

&lt;p&gt;What the patch does is basically:&lt;/p&gt;

&lt;p&gt;  1) Instead of returning a string from parsePKGNAMCSN(), an object of&lt;br/&gt;
     type Pkgnamcsn is returned. This object has accessor methods&lt;br/&gt;
     which are much cheaper than the methods in StringTokenizer.&lt;/p&gt;

&lt;p&gt;  2) Since the strings read in parsePKGNAMCSN() often are repeated,&lt;br/&gt;
     reusing the strings seemed like a good idea. To achieve this, the&lt;br/&gt;
     class DRDAString was implemented. That class stores a byte array&lt;br/&gt;
     and can return the array as a string. Strings are cached to avoid&lt;br/&gt;
     allocation and decoding if the byte array has not&lt;br/&gt;
     changed. Pkgnamcsn objects are also cached, so a new one is only&lt;br/&gt;
     allocated when one of its fields has changed.&lt;/p&gt;

&lt;p&gt;  3) In Database.java, a substring of the original PKGNAMCSN string&lt;br/&gt;
     was used as a hash key. With this patch, a new internal class&lt;br/&gt;
     StmtKey is added to Database. That class implements equals() and&lt;br/&gt;
     hashCode() in a way that enables its use as a hash key instead of&lt;br/&gt;
     the substring that was used originally. Caching is also&lt;br/&gt;
     implemented to avoid allocating new StmtKey objects when an old&lt;br/&gt;
     one can be reused.&lt;/p&gt;

&lt;p&gt;Derbyall ran without errors.&lt;/p&gt;

&lt;p&gt;I have also attached graphs showing the performance improvements. The&lt;br/&gt;
graphs show the throughput of 1-100 clients running read-only load&lt;br/&gt;
(select one row from a table which is in the page cache). The file&lt;br/&gt;
throughput.png shows the throughput as transactions per second with&lt;br/&gt;
and without the patch, and throughput-normalized.png shows the&lt;br/&gt;
increase in percent for different number of clients. The graphs&lt;br/&gt;
indicate a speedup of 5-8% with this particular load.&lt;/p&gt;

&lt;p&gt;Could someone please review and comment on the patch?&lt;/p&gt;</comment>
                            <comment id="12362209" author="knutanders" created="Mon, 9 Jan 2006 23:58:21 +0000"  >&lt;p&gt;I have uploaded a new patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-212&quot; title=&quot;Optimize some specific methods in Network Server to improve performance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-212&quot;&gt;&lt;del&gt;DERBY-212&lt;/del&gt;&lt;/a&gt;-parsePKGNAMCSN-2.diff) where I&lt;br/&gt;
have tried to address Bryan&apos;s review comments.&lt;/p&gt;

&lt;p&gt;% svn stat&lt;/p&gt;

&lt;p&gt;M      java/drda/org/apache/derby/impl/drda/DDMWriter.java&lt;br/&gt;
A      java/drda/org/apache/derby/impl/drda/DRDAString.java&lt;br/&gt;
A      java/drda/org/apache/derby/impl/drda/Pkgnamcsn.java&lt;br/&gt;
M      java/drda/org/apache/derby/impl/drda/DRDAResultSet.java&lt;br/&gt;
M      java/drda/org/apache/derby/impl/drda/DRDAStatement.java&lt;br/&gt;
A      java/drda/org/apache/derby/impl/drda/ConsistencyToken.java&lt;br/&gt;
M      java/drda/org/apache/derby/impl/drda/Database.java&lt;br/&gt;
M      java/drda/org/apache/derby/impl/drda/DRDAConnThread.java&lt;br/&gt;
M      java/drda/org/apache/derby/impl/drda/DDMReader.java&lt;/p&gt;

&lt;p&gt;Changes from the previous patch:&lt;/p&gt;

&lt;p&gt;  1) The autoTrim variable in DRDAString was removed. Instead,&lt;br/&gt;
     DDMReader.readString() has an extra argument, unpad, which&lt;br/&gt;
     specifies whether trailing padding characters should be removed.&lt;/p&gt;

&lt;p&gt;  2) DRDAString was simplified:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Support for converting between different CcsidManagers (and&lt;br/&gt;
       caching of them) was removed.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;A new byte array is generated each time the length of a string&lt;br/&gt;
       changes, removing the need for an internal length field.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;setBytes() (and DDMReader.readString()) no longer returns a&lt;br/&gt;
       boolean value to indicate whether the string value has&lt;br/&gt;
       changed. Instead, DRDAString has a new method, wasModified(),&lt;br/&gt;
       which returns true if the last call to setBytes() actually&lt;br/&gt;
       modified the string.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  3) Variable names in DRDAConnThread, Pkgnamcsn and DRDAStatement&lt;br/&gt;
     were made more consistent (pkgsn instead of secnumber and&lt;br/&gt;
     sectionNumber).&lt;/p&gt;

&lt;p&gt;  4) Pkgnamcsn.getPkgcnstknStr() was renamed to getPkgcnstkn() and now&lt;br/&gt;
     returns an object of type ConsistencyToken instead of a&lt;br/&gt;
     string. ConsistencyToken is a new class in this patch.&lt;/p&gt;

&lt;p&gt;  5) StmtKey is not an inner class in Database. It was moved to&lt;br/&gt;
     Pkgnamcsn and renamed to StatementKey. This change made the&lt;br/&gt;
     implementation of the class simpler, and it removed the need for&lt;br/&gt;
     caching the previous statement key in the Database class.&lt;/p&gt;

&lt;p&gt;I have run derbyall successfully. Comments are welcome. Thanks!&lt;/p&gt;</comment>
                            <comment id="12362531" author="knutanders" created="Thu, 12 Jan 2006 20:06:42 +0000"  >&lt;p&gt;Reopening the issue since my patch didn&apos;t address everything mentioned&lt;br/&gt;
in the description. Dyre has started optimizing parseSQLDTA_work(), so&lt;br/&gt;
I reassign the issue to him.&lt;/p&gt;</comment>
                            <comment id="12444650" author="dyret" created="Wed, 25 Oct 2006 13:35:22 +0100"  >&lt;p&gt;All subtasks have been closed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12321824" name="DERBY-212-parsePKGNAMCSN-2.diff" size="39597" author="knutanders" created="Mon, 9 Jan 2006 23:58:21 +0000"/>
                            <attachment id="12321528" name="throughput-normalized.png" size="4125" author="knutanders" created="Fri, 23 Dec 2005 02:29:32 +0000"/>
                            <attachment id="12321527" name="throughput.png" size="3816" author="knutanders" created="Fri, 23 Dec 2005 02:29:32 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12327675">DERBY-814</subtask>
                            <subtask id="12327676">DERBY-815</subtask>
                            <subtask id="12327678">DERBY-816</subtask>
                            <subtask id="12327795">DERBY-823</subtask>
                            <subtask id="12327821">DERBY-825</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10362"><![CDATA[Performance]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 14 Dec 2005 17:35:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29439</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0k4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37080</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>