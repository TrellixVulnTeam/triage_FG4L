<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:38:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4355/DERBY-4355.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4355] Implement CROSS JOIN</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4355</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Implement the CROSS JOIN syntax&lt;/p&gt;

&lt;p&gt;SELECT * from t1 CROSS JOIN t2;&lt;/p&gt;

&lt;p&gt;as an alternative syntax to&lt;/p&gt;

&lt;p&gt;SELECT * FROM t1, t2; &lt;/p&gt;

&lt;p&gt;This should be pretty straight forward and ease the migration of SQL code to Derby.&lt;/p&gt;
</description>
                <environment>any</environment>
        <key id="12433314">DERBY-4355</key>
            <summary>Implement CROSS JOIN</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="bernt">Bernt M. Johnsen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Aug 2009 09:55:26 +0100</created>
                <updated>Fri, 21 Jan 2011 17:52:33 +0000</updated>
                            <resolved>Fri, 11 Sep 2009 13:16:49 +0100</resolved>
                                    <version>10.6.1.0</version>
                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12744531" author="knutanders" created="Tue, 18 Aug 2009 15:53:49 +0100"  >&lt;p&gt;For the record, CROSS JOIN is feature F401-04 in SQL:2003. &lt;a href=&quot;http://wiki.apache.org/db-derby/SQLvsDerbyFeatures&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/SQLvsDerbyFeatures&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12750683" author="knutanders" created="Wed, 2 Sep 2009 22:45:30 +0100"  >&lt;p&gt;Here&apos;s an untested patch that adds support for CROSS JOIN in the parser, and that seems to be enough to get it working.&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t1(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t1 values 1,2;&lt;br/&gt;
2 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create table t2(x char(1));&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t2 values &apos;a&apos;,&apos;b&apos;;&lt;br/&gt;
2 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select * from t1 cross join t2;&lt;br/&gt;
X          |X   &lt;br/&gt;
----------------&lt;br/&gt;
1          |a   &lt;br/&gt;
1          |b   &lt;br/&gt;
2          |a   &lt;br/&gt;
2          |b   &lt;/p&gt;

&lt;p&gt;4 rows selected&lt;/p&gt;</comment>
                            <comment id="12750738" author="dagw" created="Thu, 3 Sep 2009 00:43:39 +0100"  >&lt;p&gt;Very cool! Thanks for this finding, Knut! Hope the tests prove that we can add this feature to our list!&lt;/p&gt;

&lt;p&gt;Nit: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;sqlgrammar.jj&lt;br/&gt;
  The argument: &lt;br/&gt;
     &quot;onClause, // should be null&quot; &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   I think I&apos;d prefer to do it the other way around, i.e.&lt;br/&gt;
     &quot;null, // onClause not used for cross join&quot;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;messages.xml:&lt;br/&gt;
  :&lt;br/&gt;
  &amp;lt;name&amp;gt;42Y14&amp;lt;/name&amp;gt;&lt;br/&gt;
               &amp;lt;text&amp;gt;A join specification is not allowed with the &apos;
{0}
&lt;p&gt;&apos; clause.&amp;lt;/text&amp;gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Why not say &quot;Cross join&quot; rather than &quot;a join&quot;? Do you foresee that the error message will be used for other kind of joins later?&lt;/p&gt;</comment>
                            <comment id="12750741" author="knutanders" created="Thu, 3 Sep 2009 01:11:24 +0100"  >&lt;p&gt;Thanks Dag. I&apos;ll make the suggested change to sqlgrammar.jj. We have already checked that onClause and usingClause are null at that point, so it should be safe both ways.&lt;/p&gt;

&lt;p&gt;As to the parameterized message, I think join specifications (ON/USING) are not allowed for natural joins either, so the message may be reused if/when we implement natural join.&lt;/p&gt;</comment>
                            <comment id="12750743" author="knutanders" created="Thu, 3 Sep 2009 01:14:27 +0100"  >&lt;p&gt;For the new message (42Y14) I basically followed the pattern for 42Y11, which is the message for missing join specification used by inner join and left/right outer join. One thing to notice with the existing message, is that without the patch, the join specification is required in the grammar, so skipping the ON clause in one of the currently supported join types will never cause an exception with the specialized error message (42Y11) to be thrown. Instead, a cryptic EOF error will be raised by the parser if the ON clause is missing. Now that the patch has made the join specification optional in the grammar, one unintended side effect is that the EOF error is not raised by the parser, and the clearer specialized message is shown instead.&lt;/p&gt;

&lt;p&gt;So currently on trunk, we have this:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select * from t1 join t2;&lt;br/&gt;
ERROR 42X01: Syntax error: Encountered &quot;&amp;lt;EOF&amp;gt;&quot; at line 1, column 24.&lt;br/&gt;
Issue the &apos;help&apos; command for general information on IJ command syntax.&lt;br/&gt;
Any unrecognized commands are treated as potential SQL commands and executed directly.&lt;br/&gt;
Consult your DBMS server reference documentation for details of the SQL syntax supported by your server.&lt;/p&gt;

&lt;p&gt;With the patch, we get this:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select * from t1 join t2;&lt;br/&gt;
ERROR 42Y11: A join specification is required with the &apos;INNER JOIN&apos; clause.&lt;/p&gt;

&lt;p&gt;This will certainly cause failures in the regression tests because the canons expect the EOF message for negative join tests, but it looks like an improvement to me.&lt;/p&gt;</comment>
                            <comment id="12751213" author="dagw" created="Fri, 4 Sep 2009 00:11:23 +0100"  >&lt;p&gt;&amp;gt; This will certainly cause failures in the regression tests because&lt;br/&gt;
&amp;gt;  the canons expect the EOF message for negative join tests, but it&lt;br/&gt;
&amp;gt;  looks like an improvement to me.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;A newbie might wonder why the message says INNER when that keyword was&lt;br/&gt;
not used, perhaps (your example). But that info is lost in the parser, so it&apos;s ok.&lt;/p&gt;
</comment>
                            <comment id="12751435" author="bernt" created="Fri, 4 Sep 2009 12:51:36 +0100"  >&lt;p&gt;Well, it is an INNER JOIN, although the INNER keyword is optional. Any user fluent enough in SQL to write an inner join without the optional keyword and with the following ON or USING clause should know that.&lt;/p&gt;</comment>
                            <comment id="12751869" author="knutanders" created="Sun, 6 Sep 2009 11:14:21 +0100"  >&lt;p&gt;The patch has two possible compatibility issues that warrant a release note:&lt;/p&gt;

&lt;p&gt;1) It will make CROSS a reserved keyword, so existing (non-portable) code that uses CROSS as an identifier would need to quote it.&lt;/p&gt;

&lt;p&gt;2) Making the join specification optional changes the SQLState for some syntax errors.&lt;/p&gt;

&lt;p&gt;I&apos;ve created a separate issue for (2), &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4369&quot; title=&quot;Give a more useful error message when join specification is missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4369&quot;&gt;&lt;del&gt;DERBY-4369&lt;/del&gt;&lt;/a&gt;, so that we get two separate release notes.&lt;/p&gt;</comment>
                            <comment id="12752548" author="knutanders" created="Tue, 8 Sep 2009 15:49:14 +0100"  >&lt;p&gt;Attaching cross_v2.diff with updates to make it apply after &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4369&quot; title=&quot;Give a more useful error message when join specification is missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4369&quot;&gt;&lt;del&gt;DERBY-4369&lt;/del&gt;&lt;/a&gt;. It also adds a test cases to JoinTest. I&apos;m assuming that the underlying join machinery is tested by the existing tests, so the new test cases focus on checking that the syntax is accepted. They do check that the results are correct, but they don&apos;t do all sorts of combinations with different data types, nullability, indexes and so on.&lt;/p&gt;

&lt;p&gt;One problem that I found, was that this query is not accepted (it&apos;s commented out in the test for now):&lt;/p&gt;

&lt;p&gt;  select * from t1 a inner join t2 b cross join t2 c on 1=1&lt;/p&gt;

&lt;p&gt;This results in an SQLSyntaxErrorException: A join specification is not allowed with the &apos;CROSS JOIN&apos; clause.&lt;/p&gt;

&lt;p&gt;It works if parentheses are added, like this:&lt;/p&gt;

&lt;p&gt;  select * from t1 a inner join (t2 b cross join t2 c) on 1=1&lt;/p&gt;

&lt;p&gt;However, I do believe that it should be accepted without parentheses too. The problem is that the patch adds CROSS JOIN in the parser&apos;s qualifiedJoin rule, where an ON clause right after any kind of join will be consumed. The parser therefore incorrectly believes that the ON clause is part of the cross join and raises an error. Splitting out a separate rule for cross join (which is also how it is defined in the SQL standard) will prevent the ON clause from being seen when parsing the the cross join, and it will be seen as part of the inner join instead. I will post an updated patch with this issue fixed.&lt;/p&gt;</comment>
                            <comment id="12752736" author="knutanders" created="Tue, 8 Sep 2009 21:49:44 +0100"  >&lt;p&gt;Another problem with the current patch:&lt;/p&gt;

&lt;p&gt;In the standard, the syntax for cross (and natural) join is defined with a &amp;lt;table reference&amp;gt; on the left side of the join operator and a &amp;lt;table factor&amp;gt; on the right side. This asymmetry is to get the correct join order without parentheses. The other joins are defined with a &amp;lt;table reference&amp;gt; on both sides (their join order will be unambiguous thanks to the ON/USING clauses). Since the current patch wired CROSS into the syntax rule for the other joins, it has &amp;lt;table reference&amp;gt; on both sides too.&lt;/p&gt;

&lt;p&gt;This leads to the following query&lt;/p&gt;

&lt;p&gt;  select * from t1 cross join t2 right join t3 on x2=x3&lt;/p&gt;

&lt;p&gt;being parsed as if it said&lt;/p&gt;

&lt;p&gt;  select * from t1 cross join (t2 right join t3 on x2=x3)&lt;/p&gt;

&lt;p&gt;whereas it should have been parsed as&lt;/p&gt;

&lt;p&gt;  select * from (t1 cross join t2) right join t3 on x2=x3&lt;/p&gt;

&lt;p&gt;This makes the query return wrong results. Given the tables defined below:&lt;/p&gt;

&lt;p&gt;create table t1(x1 int);&lt;br/&gt;
create table t2(x2 int);&lt;br/&gt;
create table t3(x3 int);&lt;/p&gt;

&lt;p&gt;insert into t1 values (1);&lt;br/&gt;
insert into t2 values (2);&lt;br/&gt;
insert into t3 values (3);&lt;/p&gt;

&lt;p&gt;We see that the two supposedly equivalent queries return different results with the patch:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select * from t1 cross join t2 right join t3 on x2=x3;&lt;br/&gt;
X1         |X2         |X3         &lt;br/&gt;
-----------------------------------&lt;br/&gt;
1          |NULL       |3          &lt;/p&gt;

&lt;p&gt;1 row selected&lt;br/&gt;
ij&amp;gt; select * from (t1 cross join t2) right join t3 on x2=x3;&lt;br/&gt;
X1         |X2         |X3         &lt;br/&gt;
-----------------------------------&lt;br/&gt;
NULL       |NULL       |3          &lt;/p&gt;

&lt;p&gt;1 row selected&lt;/p&gt;

&lt;p&gt;I&apos;ll add this as a test case in the final patch.&lt;/p&gt;</comment>
                            <comment id="12753244" author="knutanders" created="Wed, 9 Sep 2009 21:24:50 +0100"  >&lt;p&gt;Here&apos;s an updated patch (v3) which addresses the issues mentioned in the previous comments.&lt;/p&gt;

&lt;p&gt;Changes from the previous revision of the patch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The right side of a cross join is now a &amp;lt;table factor&amp;gt; and not a &amp;lt;table reference&amp;gt;. The current grammar doesn&apos;t separate between &amp;lt;table reference&amp;gt; and &amp;lt;table factor&amp;gt;, so the patch splits out some of the code from the current &amp;lt;table reference&amp;gt; rule into a new &amp;lt;table factor&amp;gt; rule. This split also made some duplicated code go away, so the patch actually removes more code from the parser than it adds.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Added test cases for the queries the previous patch didn&apos;t handle correctly.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Removed a test case from lang/db2Compatibility.sql which verified that a simple cross join failed with syntax error.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All the regression tests ran cleanly. The patch is ready for review.&lt;/p&gt;</comment>
                            <comment id="12753337" author="bryanpendleton" created="Thu, 10 Sep 2009 01:10:47 +0100"  >&lt;p&gt;Seems like a nice feature addition, with a clean implementation, and lots of good new added tests.&lt;/p&gt;

&lt;p&gt;I couldn&apos;t think of any additional tests to add; thanks for taking the time to put such a&lt;br/&gt;
thorough set of tests together!&lt;/p&gt;

&lt;p&gt;+1 to commit from me.&lt;/p&gt;</comment>
                            <comment id="12753496" author="knutanders" created="Thu, 10 Sep 2009 09:12:16 +0100"  >&lt;p&gt;Thanks for looking at the patch, Bryan!&lt;/p&gt;

&lt;p&gt;I&apos;ve committed it to trunk with revision 813293, and I will post a suggestion for a release note shortly.&lt;/p&gt;</comment>
                            <comment id="12754108" author="knutanders" created="Fri, 11 Sep 2009 13:15:30 +0100"  >&lt;p&gt;Attaching a release note about the new reserved keyword.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12435321">DERBY-4374</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12434932">DERBY-4369</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12418439" name="cross.diff" size="5024" author="knutanders" created="Wed, 2 Sep 2009 22:45:30 +0100"/>
                            <attachment id="12418913" name="cross_v2.diff" size="13574" author="knutanders" created="Tue, 8 Sep 2009 15:49:14 +0100"/>
                            <attachment id="12419084" name="cross_v3.diff" size="21373" author="knutanders" created="Wed, 9 Sep 2009 21:24:50 +0100"/>
                            <attachment id="12419085" name="cross_v3.stat" size="330" author="knutanders" created="Wed, 9 Sep 2009 21:28:18 +0100"/>
                            <attachment id="12419298" name="releaseNote.html" size="4597" author="knutanders" created="Fri, 11 Sep 2009 13:15:30 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 18 Aug 2009 14:53:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31205</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0kzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37218</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>