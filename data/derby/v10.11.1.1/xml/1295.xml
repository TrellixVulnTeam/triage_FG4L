<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:54:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1295/DERBY-1295.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1295] Result sets of type TYPE_SCROLL_INSENSITIVE should not implicitly close due to positioning in autocommit mode</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1295</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The new JDBC 4 specification allows implementations to automatically&lt;br/&gt;
close result sets of type FORWARD_ONLY when ResultSet#next returns&lt;br/&gt;
false:&lt;/p&gt;

&lt;p&gt;(quote from JDBC preliminary spec):&lt;/p&gt;

&lt;p&gt;&amp;gt; 16.2.5 Closing a ResultSet Object&lt;br/&gt;
&amp;gt;       :&lt;br/&gt;
&amp;gt; NOTE: Some JDBC driver implementations may also implicitly close the&lt;br/&gt;
&amp;gt; ResultSet when the ResultSet type is TYPE_FORWARD_ONLY and the next&lt;br/&gt;
&amp;gt; method of ResultSet returns false.&lt;/p&gt;

&lt;p&gt;This implies that other result set type are not free to do this.&lt;/p&gt;

&lt;p&gt;Currently, Derby will also implicitly close result sets of type&lt;br/&gt;
TYPE_SCROLL_INSENSITIVE, if autocommit is enabled. &lt;/p&gt;

&lt;p&gt;Quote from Derby Developer&apos;s Guide, subsection &quot;Using autocommit&quot;:&lt;/p&gt;

&lt;p&gt;&amp;gt; Using auto-commit &lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; A new connection to a Derby database is in auto-commit mode by&lt;br/&gt;
&amp;gt; default, as specified by the JDBC standard. Auto-commit mode means&lt;br/&gt;
&amp;gt; that when a statement is completed, the method commit is called on&lt;br/&gt;
&amp;gt; that statement automatically. Auto-commit in effect makes every SQL&lt;br/&gt;
&amp;gt; statement a transaction. The commit occurs when the statement&lt;br/&gt;
&amp;gt; completes or the next statement is executed, whichever comes&lt;br/&gt;
&amp;gt; first. In the case of a statement returning a ResultSet , the&lt;br/&gt;
&amp;gt; statement completes when the last row of the ResultSet has been&lt;br/&gt;
****************************************&lt;br/&gt;
&amp;gt; retrieved or the ResultSet has been closed explicitly.&lt;/p&gt;

&lt;p&gt;This seems to indicate that result set always closes when the last row&lt;br/&gt;
has been seen, however, it seems the implementation only does this&lt;br/&gt;
when autocommit is enabled.  I will attach a repro.&lt;/p&gt;

&lt;p&gt;Anyway, this should be corrected for JDBC4 compliancy. Scrollable&lt;br/&gt;
result sets should never close implicitly due to positioning,&lt;br/&gt;
autocommit or not.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12333244">DERBY-1295</key>
            <summary>Result sets of type TYPE_SCROLL_INSENSITIVE should not implicitly close due to positioning in autocommit mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fernanda">Fernanda Pizzorno</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 May 2006 22:37:26 +0100</created>
                <updated>Tue, 30 Jun 2009 17:12:53 +0100</updated>
                            <resolved>Fri, 9 Jun 2006 02:34:26 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                            <comments>
                            <comment id="12378068" author="dagw" created="Sat, 6 May 2006 00:06:29 +0100"  >&lt;p&gt;Repro for embedded; it seems not to happen for client,&lt;br/&gt;
maybe because the next is handled locally when already on last row.&lt;/p&gt;</comment>
                            <comment id="12413947" author="dagw" created="Wed, 31 May 2006 08:25:25 +0100"  >&lt;p&gt;This behavior is also mentioned in the reference manual (src/ref/rrefjdbc77156.dita):&lt;/p&gt;

&lt;p&gt;  &quot;Note: When working with scrolling insensitive ResultSets when&lt;br/&gt;
  auto-commit mode is turned on, the only positioning method that&lt;br/&gt;
  can close the ResultSet automatically is the next() method.&quot;&lt;/p&gt;</comment>
                            <comment id="12414377" author="fernanda" created="Fri, 2 Jun 2006 16:39:18 +0100"  >&lt;p&gt;The attached file derby-1295.diff adds a check in EmbedResultSet.java so that only forward only result sets will close due to positioning, and a new test (jdbcapi/ScrollResultSetTest.junit). I have successfully run derbyall with this patch. Can someone please review it?&lt;/p&gt;

&lt;p&gt;Thank you in advance!&lt;/p&gt;</comment>
                            <comment id="12414545" author="dagw" created="Sat, 3 Jun 2006 08:17:49 +0100"  >&lt;p&gt;Changing this might  possibly impact an existing application if it&lt;br/&gt;
relies on auto-close of the result as described. &lt;/p&gt;</comment>
                            <comment id="12414907" author="kmarsden" created="Tue, 6 Jun 2006 12:55:32 +0100"  >&lt;p&gt;Thanks for marking this Existing Application Impact &amp;amp;  Release Note Needed and thinking about existing users.&lt;/p&gt;

&lt;p&gt;I agree it would be good to document. the change.  I think it is not  likely to show up  as a regression in a user application as I don&apos;t think there are too many cases where an app would  have functionality depending on auto-close of the result.  Ultimately I think  they can  still rely on garbage collection to perform that function.  &lt;/p&gt;
</comment>
                            <comment id="12415143" author="andreask" created="Wed, 7 Jun 2006 21:58:59 +0100"  >&lt;p&gt;Thanks for contributing this patch.&lt;br/&gt;
I have added a subtask to fix the documentation issue.&lt;/p&gt;

&lt;p&gt;Here are some minor review comments:&lt;/p&gt;

&lt;p&gt;1. I think the patch could improve on the existing nesting of if-else statements , instead it introduces one more level:&lt;/p&gt;

&lt;p&gt;if (!onRow &amp;amp;&amp;amp; (position == NEXT)) {&lt;br/&gt;
	if (forMetaData &amp;amp;&amp;amp; (lcc.getActivationCount() &amp;gt; 1)) {&lt;br/&gt;
	} else if (owningStmt != null)&lt;br/&gt;
		if (owningStmt.getResultSetType() == TYPE_FORWARD_ONLY) &lt;/p&gt;
{
			owningStmt.resultSetClosing(this);
		}
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;One could use one if statment:&lt;br/&gt;
if (position == NEXT &amp;amp;&amp;amp; !onRow &amp;amp;&amp;amp; &lt;br/&gt;
        !(forMetaData &amp;amp;&amp;amp; (lcc.getActivationCount() &amp;gt; 1)) &amp;amp;&amp;amp;&lt;br/&gt;
        owningStmt!=null &amp;amp;&amp;amp; &lt;br/&gt;
        owningStmt.getResultSetType() == TYPE_FORWARD_ONLY) &lt;/p&gt;
{
        
        owningStmt.resultSetClosing(this);
}

&lt;p&gt;or, if you do not want to touch too much of the exisiting structure:&lt;/p&gt;

&lt;p&gt;if (!onRow &amp;amp;&amp;amp; (position == NEXT)) {&lt;/p&gt;

&lt;p&gt;    if (forMetaData &amp;amp;&amp;amp; (lcc.getActivationCount() &amp;gt; 1)) {&lt;br/&gt;
    } else if (owningStmt != null &amp;amp;&amp;amp; owningStmt.getResultSetType() == TYPE_FORWARD_ONLY) &lt;/p&gt;
{
        owningStmt.resultSetClosing(this);
    }

&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;2. &lt;br/&gt;
The constructor of ScrollResultSetTest has a javadoc comment which should be fixed:&lt;br/&gt;
+    /** Creates a new instance of SURBaseTest */&lt;br/&gt;
+    public ScrollResultSetTest(String name) &lt;/p&gt;
{
+        super(name);
+    }</comment>
                            <comment id="12415305" author="fernanda" created="Thu, 8 Jun 2006 17:40:19 +0100"  >&lt;p&gt;I am attaching a new patch (derby-1295v2.diff) addressing the review comments. Can someone please review it?&lt;/p&gt;

&lt;p&gt;Thank you in advance.&lt;/p&gt;</comment>
                            <comment id="12415306" author="andreask" created="Thu, 8 Jun 2006 17:50:31 +0100"  >&lt;p&gt;Patch looks good - I will run some test and commit if successful.&lt;/p&gt;</comment>
                            <comment id="12415329" author="andreask" created="Thu, 8 Jun 2006 19:57:45 +0100"  >&lt;p&gt;Some preliminary testing results:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;When running the new test, without the patch, the test failed as expected in embedded&lt;/li&gt;
	&lt;li&gt;I also found that the test did not fail when running in DerbyNetClient (also expected)&lt;/li&gt;
	&lt;li&gt;When running in DerbyNet, I found it failing with:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;1) testNextOnLastRowForwardOnly(org.apache.derbyTesting.functionTests.tests.jdbcapi.ScrollResultSetTest)junit.framework.ComparisonFailure: expected:&amp;lt;null&amp;gt; but was:&amp;lt;XCL16&amp;gt;&lt;br/&gt;
(assertEquals has been called with parameters in wrong order: expected is XCL16, not &amp;lt;null&amp;gt;)&lt;/p&gt;

&lt;p&gt;Instead of disabling the test in DerbyNet, the test code can use the method usingDerbyNet() to disable checking the SQL state. &lt;br/&gt;
In addition, use the method assertSQLState(..) instead of assertEquals(..), and move the sql state string constant into the recently introduced file SQLStateConstants.&lt;/p&gt;

&lt;p&gt;I have made these changes in my sandbox, and my intention is now to  upload the updated patch, run derbyall and commit.&lt;/p&gt;</comment>
                            <comment id="12415341" author="andreask" created="Thu, 8 Jun 2006 20:30:26 +0100"  >&lt;p&gt;Attaching patch derby-1295 with minor update of testcode as commented above.&lt;/p&gt;</comment>
                            <comment id="12415397" author="andreask" created="Fri, 9 Jun 2006 02:34:26 +0100"  >&lt;p&gt;Committed revision 412831.&lt;/p&gt;</comment>
                            <comment id="12435483" author="fernanda" created="Mon, 18 Sep 2006 14:57:59 +0100"  >&lt;p&gt;Release note for this issue:&lt;/p&gt;


&lt;p&gt;PROBLEM&lt;br/&gt;
SCROLL_INSENSITIVE result sets in auto commit mode close implicitly when calling the ResultSet.next() method while positioned on the last row.&lt;/p&gt;

&lt;p&gt;SYMPTOMS&lt;br/&gt;
Calling the ResultSet.next() method when positioned on the last row of a result set of type SCROLL_INSENSITIVE in auto commit mode causes the result set to be closed.&lt;/p&gt;

&lt;p&gt;CAUSE&lt;br/&gt;
The JDBC specification allows a JDBC driver to implicitly close a ResultSet when the ResultSet type is TYPE_FORWARD_ONLY and the next method of ResultSet returns false. Derby also implicitly closes result sets of type SCROLL_INSENSITIVE when the ResultSet.next() method returns false in auto commit mode.&lt;/p&gt;

&lt;p&gt;SOLUTION&lt;br/&gt;
The behavior of SCROLL_INSENSITIVE result sets in auto commit mode has been changed to comply with the JDBC4 specification. SCROLL_INSENSITIVE result sets are not implicitly closed when calling the ResultSet.next() method in auto commit mode while positioned on the last row.&lt;/p&gt;

&lt;p&gt;WORKAROUND&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12326315" name="Main.java" size="6783" author="dagw" created="Sat, 6 May 2006 00:06:29 +0100"/>
                            <attachment id="12334940" name="derby-1295.diff" size="10353" author="fernanda" created="Fri, 2 Jun 2006 16:39:18 +0100"/>
                            <attachment id="12334941" name="derby-1295.stat" size="580" author="fernanda" created="Fri, 2 Jun 2006 16:39:18 +0100"/>
                            <attachment id="12335190" name="derby-1295v2.diff" size="10357" author="fernanda" created="Thu, 8 Jun 2006 17:40:19 +0100"/>
                            <attachment id="12335191" name="derby-1295v2.stat" size="580" author="fernanda" created="Thu, 8 Jun 2006 17:40:19 +0100"/>
                            <attachment id="12335206" name="derby-1295v3.diff" size="10513" author="andreask" created="Thu, 8 Jun 2006 20:30:26 +0100"/>
                            <attachment id="12335207" name="derby-1295v3.stat" size="584" author="andreask" created="Thu, 8 Jun 2006 20:30:26 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12344064">DERBY-1385</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 2 Jun 2006 15:39:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22418</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ufr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38749</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>