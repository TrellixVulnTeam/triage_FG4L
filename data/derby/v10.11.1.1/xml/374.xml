<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:10:25 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-374/DERBY-374.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-374] Invalid URL with Derby Client when connecting to Network Server causes protocol exception.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-374</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If using the Derby Client to connect to the Derby Network Server, there are some cases where an invalid URL will cause a protocol exception instead of throwing a proper error.  The two cases I&apos;ve found are as follow:&lt;/p&gt;

&lt;p&gt;1) Use of a colon to separate attributes:&lt;/p&gt;

&lt;p&gt;When connecting to the server with JCC, a colon is required to demarcate the Derby attributes from the JCC attributes. For the Derby Client, however, the colon is not a valid part of the URL, so use of it should return an error.  However, the result is a protocol exception:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; connect &apos;jdbc:derby://localhost:1528/sample:user=someUsr;password=somePwd&apos;;&lt;br/&gt;
agentThread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_9,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR (no SQLState): A communication error has been detected. Communication protocol being used: Reply.fill(). Communication API being used: InputStream.read(). Location where the error was detected:&lt;br/&gt;
insufficient data. Communication function detecting the error: *. Protocol specific error codes(s) TCP/IP SOCKETS&lt;/p&gt;

&lt;p&gt;2) Use of double-quotes to specify a full path to a database.&lt;/p&gt;

&lt;p&gt;The use of double-quotes around a database path is required when connecting to the server with JCC, but should be optional when using the Derby Client.  However,  attempts to use the double-quotes doesn&apos;t work--on the contrary, it throws a protocol exception:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; connect &apos;jdbc:derby://localhost:1528/&quot;C:/myDBs/sample&quot;&apos;;&lt;br/&gt;
agentThread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_11,5,main&amp;#93;&lt;/span&gt;&lt;br/&gt;
ERROR (no SQLState): A communication error has been detected. Communication protocol being used: Reply.fill(). Communication API being used: InputStream.read(). Location where the error was detected:&lt;br/&gt;
insufficient data. Communication function detecting the error: *. Protocol specific error codes(s) TCP/IP SOCKETS&lt;/p&gt;

&lt;p&gt;Without quotes, the above example will work as expected.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if the problem is with the Derby client or the Network Server (more investigation required).&lt;/p&gt;</description>
                <environment>Network Server running with Derby client on Windows 2000.</environment>
        <key id="12311498">DERBY-374</key>
            <summary>Invalid URL with Derby Client when connecting to Network Server causes protocol exception.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="deepa">Deepa Remesh</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Sun, 19 Jun 2005 17:01:09 +0100</created>
                <updated>Wed, 24 May 2006 05:26:49 +0100</updated>
                            <resolved>Wed, 12 Oct 2005 05:29:34 +0100</resolved>
                                    <version>10.1.1.0</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.2.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12314694" author="fuzzylogic" created="Thu, 30 Jun 2005 06:49:31 +0100"  >&lt;p&gt;Moving to 10.2.&lt;/p&gt;</comment>
                            <comment id="12329504" author="deepa" created="Fri, 16 Sep 2005 11:58:59 +0100"  >&lt;p&gt;The patch fixes the first case 1) Use of a colon to separate attributes. ClientDriver.java now checks for &quot;:&quot; in the database name and attributes part of URL. A &quot;:&quot; is accepted if the database name is specified as an absolute path on Windows (C:/myDBs/sample). In all other cases, it will give &quot;Invalid database url syntax&quot;.&lt;/p&gt;

&lt;p&gt;I think case 2) Use of double-quotes to specify a full path to a database is not valid. This is not supported by Derby embedded driver.&lt;/p&gt;

&lt;p&gt;Ran derbyall with Sun JDK 1.4.2. No failures.&lt;/p&gt;</comment>
                            <comment id="12329560" author="army" created="Sat, 17 Sep 2005 01:26:14 +0100"  >&lt;p&gt;If case 2 is invalid, wouldn&apos;t it be more appropriate for the code to catch it and print a reasonale error message than to throw a protocol exception?&lt;/p&gt;

&lt;p&gt;If you use double-quotes in embedded Derby you get a reasonable error:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; connect &apos;jdbc:derby:&quot;C:/myDBs/sample&quot;&apos;;&lt;br/&gt;
ERROR 08001: No suitable driver&lt;/p&gt;

&lt;p&gt;It seems like we should either throw a similar error for the client or else throw the same &quot;Invalid database url syntax&quot; error that we throw in case 1.  I think either would be better than the protocol exception since the protocol exception doesn&apos;t give any indication as to what went wrong...&lt;/p&gt;</comment>
                            <comment id="12329578" author="deepa" created="Sat, 17 Sep 2005 06:44:52 +0100"  >&lt;p&gt;Submitting patch derby-374-patch2.diff. Added additional check to look for double quotes in the database name and attributes part of URL and  throw &quot;Invalid database url syntax&quot;.  &lt;/p&gt;</comment>
                            <comment id="12329867" author="deepa" created="Tue, 20 Sep 2005 01:08:35 +0100"  >&lt;p&gt;Resubmitting the patch as derby-374-patch3.diff with changes to master file. The previous patch was using backslash as path separator in the master file. As pointed out by Knut, this would fail in non-windows environments. &lt;/p&gt;</comment>
                            <comment id="12330708" author="deepa" created="Thu, 29 Sep 2005 03:45:54 +0100"  >&lt;p&gt;Attaching a patch derby-374-patch.diff for network server and client to handle invalid URLs. This patch does the following:&lt;/p&gt;

&lt;p&gt;1. Network server used to give NPE when InternalDriver returns null connection for certain malformed URLs. With this patch, network server checks for null connections returned by InternalDriver and returns RDBAFLRM and SQLCARD with null SQLException. I spoke to Kathey about how to pass null SQLCARDs.&lt;br/&gt;
2. The client parses the SQLCARD and if finds null SQLException, it sets connectionNull variable in NetConnection to true. &lt;br/&gt;
3. ClientDriver connect method, which calls the constructor of NetConnection, gets back an object with connectionNull set to true. And it inturn returns null connection.&lt;br/&gt;
4. Added tests to checkDriver.java for more Client URLs.&lt;/p&gt;

&lt;p&gt;Army, This patch handles the URLs you mentioned. Does this look okay to you? &lt;/p&gt;</comment>
                            <comment id="12330818" author="army" created="Fri, 30 Sep 2005 02:31:30 +0100"  >&lt;p&gt;I applied the patch to my local codeline and the resultant behavior looks good to me.  If you can confirm that you&apos;ve run the nightlies with this latest patch and everything ran as expected, then I give a +1 to commit.  Thanks for following through with this, Deepa.  &lt;/p&gt;</comment>
                            <comment id="12330824" author="deepa" created="Fri, 30 Sep 2005 02:48:39 +0100"  >&lt;p&gt;Army, Thanks for reviewing the patch. I have run derbyall with this patch using Sun jdk 1.4.2. No failures. &lt;/p&gt;</comment>
                            <comment id="12331009" author="kmarsden" created="Sat, 1 Oct 2005 14:33:25 +0100"  >&lt;p&gt;I committed this change to the trunk.  Thanks too for cleaning up the ACCRDB failure code in Network Server.&lt;/p&gt;

&lt;p&gt;Date: Fri Sep 30 21:30:43 2005&lt;br/&gt;
New Revision: 292917&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=292917&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=292917&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12331190" author="kmarsden" created="Tue, 4 Oct 2005 02:45:11 +0100"  >&lt;p&gt;I was thinking with this change that it would be good to check the problem url using the &lt;/p&gt;

&lt;p&gt;1)  10.1 client with the 10.2 server&lt;br/&gt;
2) 10.2 client with the 10.1 server.&lt;/p&gt;

&lt;p&gt;Just to make sure it doesn&apos;t introduce a hang or anything worse than the protcol error we were getting before.&lt;br/&gt;
Deepa, would you mind checking that out?&lt;/p&gt;</comment>
                            <comment id="12331521" author="deepa" created="Fri, 7 Oct 2005 04:56:14 +0100"  >&lt;p&gt;In my local codeline, I merged this patch to 10.1 and ran derbyall on WinXP with Sun jdk1.4.2. No failures. The merge command I used is:&lt;br/&gt;
svn merge -r 292916:292917 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please merge this to 10.1 branch.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;br/&gt;
Results of the url test suggested by Kathey (copying to JIRA entry from the mailing list for reference):&lt;br/&gt;
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;br/&gt;
I tried all the Client URLs added in the test jdbcapi/checkDriver.java.&lt;/p&gt;

&lt;p&gt;With 10.1 server and 10.2 client : behaviour same as before this patch. (protocol error)&lt;br/&gt;
With 10.2 server and 10.1 client: Instead of protocol error, client throws a SQLException with null message. ij displays:&lt;br/&gt;
ERROR      : DERBY SQL error: SQLCODE: -1, SQLSTATE:      , SQLERRMC: null&lt;br/&gt;
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/p&gt;</comment>
                            <comment id="12331535" author="kmarsden" created="Fri, 7 Oct 2005 08:41:59 +0100"  >&lt;p&gt;Committed this to 10.1&lt;/p&gt;

&lt;p&gt;Date: Thu Oct  6 15:28:44 2005&lt;br/&gt;
New Revision: 306942&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=306942&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=306942&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12331632" author="deepa" created="Sat, 8 Oct 2005 10:27:00 +0100"  >&lt;p&gt;The attached patch &quot;derby374_test_changes.diff&quot; removes client URLs, which behave differently on Windows and non-Windows systems, from the test &lt;br/&gt;
jdbcapi/checkDriver.java. &lt;/p&gt;

&lt;p&gt;svn status output:&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\checkDriver.java&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\master\DerbyNetClient\checkDriver.out&lt;/p&gt;

&lt;p&gt;I ran the test checkDriver.java with DerbyNetClient framework on Windows. I don&apos;t have access to any non-windows machine. I would appreciate if someone can run this test on a non-windows machine to confirm. The patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-374&quot; title=&quot;Invalid URL with Derby Client when connecting to Network Server causes protocol exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-374&quot;&gt;&lt;del&gt;DERBY-374&lt;/del&gt;&lt;/a&gt; was merged to 10.1 branch also. So please commit this test change to trunk as well as 10.1 branch.&lt;/p&gt;

&lt;p&gt;The test for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-374&quot; title=&quot;Invalid URL with Derby Client when connecting to Network Server causes protocol exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-374&quot;&gt;&lt;del&gt;DERBY-374&lt;/del&gt;&lt;/a&gt; has to cover a case where the embedded driver returns a null connection to network server. This is still being covered by the test. For the removed client urls, I am thinking of some way they can be added back to the test.&lt;/p&gt;</comment>
                            <comment id="12331633" author="kmarsden" created="Sat, 8 Oct 2005 11:42:52 +0100"  >&lt;p&gt;Checked test change into trunk: &lt;br/&gt;
Disable some tests which are failing on unix until a cross platform solution&lt;br/&gt;
can be found&lt;/p&gt;

&lt;p&gt;Date: Fri Oct  7 18:31:35 2005&lt;br/&gt;
New Revision: 307231&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=307231&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=307231&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and 10.1&lt;/p&gt;

&lt;p&gt;Date: Fri Oct  7 18:40:13 2005&lt;br/&gt;
New Revision: 307232&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=307232&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=307232&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12331827" author="deepa" created="Wed, 12 Oct 2005 05:29:34 +0100"  >&lt;p&gt;Checked that the changes are in trunk (10.2) and 10.1 branch.  svn revisions are:&lt;br/&gt;
10.2 - 292917, 307231 &lt;br/&gt;
10.1 - 306942, 307232&lt;/p&gt;

&lt;p&gt;Also created a sub-task for adding the removed URLs back to the test (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-617&quot; title=&quot;Add more client URLs to the test jdbcapi/checkDriver.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-617&quot;&gt;DERBY-617&lt;/a&gt;). &lt;/p&gt;</comment>
                            <comment id="12413001" author="army" created="Wed, 24 May 2006 05:26:49 +0100"  >&lt;p&gt;Fix for this has been in 10.1 and 10.2 since last October, so I&apos;m marking it as closed.  Thanks Deepa!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12314610" name="derby-374-patch.diff" size="12795" author="deepa" created="Thu, 29 Sep 2005 03:45:53 +0100"/>
                            <attachment id="12314611" name="derby-374-patch.status" size="510" author="deepa" created="Thu, 29 Sep 2005 03:45:54 +0100"/>
                            <attachment id="12314773" name="derby374_test_changes.diff" size="2682" author="deepa" created="Sat, 8 Oct 2005 10:27:00 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 30 Jun 2005 05:49:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21922</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy16cn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40679</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>