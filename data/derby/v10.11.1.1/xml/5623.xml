<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:09:58 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5623/DERBY-5623.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5623] Loosen up synchronization in FileMonitor</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5623</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When opening a large number of databases in parallel, many threads get stuck for a long time in FileMonitor, as reported in this thread on derby-user:&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/db-derby-user/201202.mbox/%3CCAEQ8c00vx0yFrwWyjm%3Dt_Yd%2BuuKGOL%3DSgpYfQuYghOOPgdN8-w%40mail.gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/db-derby-user/201202.mbox/%3CCAEQ8c00vx0yFrwWyjm%3Dt_Yd%2BuuKGOL%3DSgpYfQuYghOOPgdN8-w%40mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The synchronization in FileMonitor is only needed because the monitor instance is also used as a shared PrivilegedExceptionAction instance. Since all databases share one FileMonitor instance, threads that access any of these methods are serialized. If each method created its own PrivilegedAction or PrivilegedExceptionAction instance instead of using the monitor&apos;s run() method, these methods wouldn&apos;t need synchronization.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12543310">DERBY-5623</key>
            <summary>Loosen up synchronization in FileMonitor</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Feb 2012 08:54:03 +0000</created>
                <updated>Tue, 24 Jul 2012 18:28:05 +0100</updated>
                            <resolved>Thu, 23 Feb 2012 09:33:06 +0000</resolved>
                                    <version>10.8.2.2</version>
                                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13212384" author="sits" created="Tue, 21 Feb 2012 05:40:36 +0000"  >&lt;p&gt;Patch file to remove synchronisation in FileMonitor.&lt;/p&gt;</comment>
                            <comment id="13212496" author="knutanders" created="Tue, 21 Feb 2012 10:17:45 +0000"  >&lt;p&gt;Thanks for the patch, David. I had played with a similar patch myself (see the attached file, d5623-1.diff). My patch differs a little from your patch:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It preserves the synchronization in getDaemonThread(). Without synchronization in that method, I saw occasional IllegalThreadStateExceptions when booting and shutting down databases concurrently in many threads.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It uses PrivilegedAction instead of PrivilegedExceptionAction for the actions that don&apos;t throw checked exceptions, which made the exception handling simpler.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All the regression tests passed with this patch.&lt;/p&gt;

&lt;p&gt;I also ran an application that booted 1000 databases in 20 threads on a machine with 8 cores, and the patch seemed to speed it up by 3-4%. It was primarily the removal of synchronization in getJVMProperty() that contributed to the speed-up.&lt;/p&gt;

&lt;p&gt;Although the speed-up is modest (at least in my environment) the patches remove more lines of code than they add, which is a good thing in itself.&lt;/p&gt;</comment>
                            <comment id="13212968" author="sits" created="Tue, 21 Feb 2012 21:28:08 +0000"  >&lt;p&gt;Great - sounds good.&lt;/p&gt;</comment>
                            <comment id="13214501" author="knutanders" created="Thu, 23 Feb 2012 09:33:06 +0000"  >&lt;p&gt;I committed the patch with revision 1292724. Marking the issue as resolved.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12515341" name="d5623-1.diff" size="8088" author="knutanders" created="Tue, 21 Feb 2012 10:17:45 +0000"/>
                            <attachment id="12515325" name="derby-diff.txt" size="9212" author="sits" created="Tue, 21 Feb 2012 05:40:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10362"><![CDATA[Performance]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 21 Feb 2012 05:40:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228556</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0apr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35554</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>