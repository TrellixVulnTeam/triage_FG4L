<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:12:46 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6408/DERBY-6408.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6408] EXISTS returns NULL instead of FALSE</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6408</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The reference manual topic on Boolean expressions - &lt;a href=&quot;http://db.apache.org/derby/docs/10.10/ref/rrefsqlj23075.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/10.10/ref/rrefsqlj23075.html&lt;/a&gt; - says that EXISTS should return FALSE if the subquery returns no rows. In reality, it returns NULL:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; values exists(select * from t);&lt;br/&gt;
1    &lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;NULL &lt;/p&gt;

&lt;p&gt;1 row selected&lt;/p&gt;

&lt;p&gt;SQL:2011, part 2, 8.10 &amp;lt;exists predicate&amp;gt; also says that FALSE is the correct result if the cardinality is 0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12678185">DERBY-6408</key>
            <summary>EXISTS returns NULL instead of FALSE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Nov 2013 09:27:51 +0000</created>
                <updated>Wed, 21 Jan 2015 00:23:10 +0000</updated>
                            <resolved>Mon, 3 Mar 2014 12:50:35 +0000</resolved>
                                    <version>10.7.1.1</version>
                    <version>10.8.3.3</version>
                    <version>10.9.2.2</version>
                    <version>10.10.1.1</version>
                                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13817157" author="knutanders" created="Fri, 8 Nov 2013 09:53:33 +0000"  >&lt;p&gt;Possibly related problem (I think both this query and the EXISTS query in the bug description will be flattened into an EXISTS join, as explained in &lt;a href=&quot;http://db.apache.org/derby/docs/10.10/tuning/ctuntransform25868.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/10.10/tuning/ctuntransform25868.html&lt;/a&gt;):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ij&amp;gt; values 1 in (select 2 from sysibm.sysdummy1);
1    
-----
NULL 

1 row selected
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It should have returned FALSE, not NULL.&lt;/p&gt;</comment>
                            <comment id="13905848" author="mikem" created="Wed, 19 Feb 2014 18:48:49 +0000"  >&lt;p&gt;10.2 get following syntax error:&lt;br/&gt;
ij version 10.2&lt;br/&gt;
CONNECTION0* -  jdbc:derby:wombat&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;= current connection&lt;br/&gt;
ij&amp;gt; create table t(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; values exists(select * from t);&lt;br/&gt;
ERROR 42X80: VALUES clause must contain at least one element. Empty elements are not allowed.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13905855" author="mikem" created="Wed, 19 Feb 2014 18:52:24 +0000"  >&lt;p&gt;tried and also reproduced against latest 10.9 branch:&lt;br/&gt;
ij version 10.9&lt;br/&gt;
CONNECTION0* -  jdbc:derby:wombat&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;= current connection&lt;br/&gt;
ij&amp;gt; create table t(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; values exists(select * from t);&lt;br/&gt;
1
&lt;hr /&gt;
&lt;p&gt;NULL&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;1 row selected&lt;/p&gt;</comment>
                            <comment id="13905860" author="mikem" created="Wed, 19 Feb 2014 18:54:01 +0000"  >&lt;p&gt;tried and reproduced against latest 10.8 branch:&lt;br/&gt;
ij version 10.8&lt;br/&gt;
CONNECTION0* -  jdbc:derby:wombat&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;= current connection&lt;br/&gt;
ij&amp;gt; create table t(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; values exists(select * from t);&lt;br/&gt;
1
&lt;hr /&gt;
&lt;p&gt;NULL&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;1 row selected&lt;/p&gt;</comment>
                            <comment id="13905865" author="mikem" created="Wed, 19 Feb 2014 18:55:57 +0000"  >&lt;p&gt;tried and reproduced against latest 10.7 branch:&lt;br/&gt;
ij version 10.7&lt;br/&gt;
CONNECTION0* -  jdbc:derby:wombat&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;= current connection&lt;br/&gt;
ij&amp;gt; create table t(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; values exists(select * from t);&lt;br/&gt;
1
&lt;hr /&gt;
&lt;p&gt;NULL&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;1 row selected&lt;/p&gt;</comment>
                            <comment id="13905872" author="mikem" created="Wed, 19 Feb 2014 18:59:12 +0000"  >&lt;p&gt;10.6, 10.5 and 10.2 all get the following syntax issue.  Goting to assume some 10.7 change introduced the behavior change.  Seems like both behaviors are wrong, so not marking it as a regression for now,&lt;br/&gt;
but would be open if anyone has a different opinion.&lt;/p&gt;

&lt;p&gt;ij version 10.6&lt;br/&gt;
CONNECTION0* -  jdbc:derby:wombat&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;= current connection&lt;br/&gt;
ij&amp;gt; create table t(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; values exists(select * from t);&lt;br/&gt;
ERROR 42X80: VALUES clause must contain at least one element. Empty elements are not allowed.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13906879" author="knutanders" created="Thu, 20 Feb 2014 11:38:37 +0000"  >&lt;p&gt;I think the syntax is not supported in 10.6 and earlier because the boolean data type was not introduced until 10.7. EXISTS returns a boolean.&lt;/p&gt;</comment>
                            <comment id="13912933" author="knutanders" created="Wed, 26 Feb 2014 14:03:28 +0000"  >&lt;p&gt;I think there are at least two problems that need to be fixed:&lt;/p&gt;

&lt;p&gt;1) SubqueryNode.preprocess() wraps some subqueries in an IsNullNode to avoid NULLs. It does that with NOT EXISTS subqueries, but not with plain EXISTS subqueries. It should probably do that with EXISTS too.&lt;/p&gt;

&lt;p&gt;2) SubqueryList.preprocess() calls preprocess() on all its SubqueryNodes, but it does not update the list with the values returned by SubqueryNode.preprocess(), so the IsNullNode added in (1) will be lost. This part of the problem probably only affects VALUES statements, since SubqueryList.preprocess() is only called from RowResultSetNode.preprocess().&lt;/p&gt;</comment>
                            <comment id="13914376" author="knutanders" created="Thu, 27 Feb 2014 10:56:18 +0000"  >&lt;p&gt;Attaching d6408-1a.diff with a fix for this bug. It makes the following changes:&lt;/p&gt;

&lt;p&gt;RowResultSetNode.java:&lt;/p&gt;

&lt;p&gt;Make the preprocess() method invoke preprocess() on the result column list instead of the subquery list. It will still end up preprocessing the subqueries, but now the IsNullNode added by SubqueryNode.preprocess() will not be lost.&lt;/p&gt;

&lt;p&gt;SubqueryList.java:&lt;/p&gt;

&lt;p&gt;Remove the broken (and now unused) preprocess() method so that no one gets tempted to use it.&lt;/p&gt;

&lt;p&gt;SubqueryNode.java:&lt;/p&gt;

&lt;p&gt;Make sure that EXISTS subqueries are wrapped in an IsNullNode, not only NOT EXISTS subqueries.&lt;/p&gt;

&lt;p&gt;ValueNode.java:&lt;/p&gt;

&lt;p&gt;Enhance the genIsNullTree() method so that it can produce both IS NULL and IS NOT NULL nodes.&lt;/p&gt;

&lt;p&gt;master/schemas.out:&lt;/p&gt;

&lt;p&gt;Update canon which expected EXISTS to return NULL.&lt;/p&gt;

&lt;p&gt;lang/ExistsWithSubqueriesTest.java:&lt;/p&gt;

&lt;p&gt;Add test case that verifies the fix.&lt;/p&gt;

&lt;p&gt;lang/GrantRevokeDDLTest.java:&lt;/p&gt;

&lt;p&gt;Update assert that expects NULL instead of FALSE. (It was when writing this test case the bug was originally discovered.)&lt;/p&gt;</comment>
                            <comment id="13914425" author="knutanders" created="Thu, 27 Feb 2014 11:41:06 +0000"  >&lt;p&gt;All the regression tests passed. The patch is ready for review. Thanks.&lt;/p&gt;</comment>
                            <comment id="13915425" author="mamtas" created="Fri, 28 Feb 2014 03:39:02 +0000"  >&lt;p&gt;Knut,I looked through the patch and the changes look good to me. Following is my understanding of the patch. There were 2 issues&lt;br/&gt;
1)we were calling IsNullNode only on NOT EXISTS but never called it for EXISTS. Because of that NULL returned from EXISTS never got converted to a IsNullNode. The patch now makes sure that IsNullNode gets called for both EXISTS and NOT EXISTS.&lt;br/&gt;
2)even when we were calling IsNullNode on NOT EXISTS query, the returned node was getting ignored. The patch handles the ignoring of the node by calling the pre processing on result set columns rather than subquery so the returned IsNullNode node will be part of the generated tree for the query.&lt;/p&gt;</comment>
                            <comment id="13918021" author="knutanders" created="Mon, 3 Mar 2014 12:49:48 +0000"  >&lt;p&gt;Thanks for looking at the patch, Mamta. Your understanding of the patch sounds correct.&lt;/p&gt;</comment>
                            <comment id="13918022" author="jira-bot" created="Mon, 3 Mar 2014 12:50:09 +0000"  >&lt;p&gt;Commit 1573548 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1573548&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1573548&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6408&quot; title=&quot;EXISTS returns NULL instead of FALSE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6408&quot;&gt;&lt;del&gt;DERBY-6408&lt;/del&gt;&lt;/a&gt;: EXISTS returns NULL instead of FALSE&lt;/p&gt;

&lt;p&gt;Make sure EXISTS subqueries are wrapped in an IsNullNode to convert&lt;br/&gt;
NULL to a BOOLEAN. Before, only NOT EXISTS subqueries were wrapped.&lt;/p&gt;

&lt;p&gt;Make RowResultSetNode.preprocess() invoke preprocess() on the result&lt;br/&gt;
columns instead of directly on the subquery nodes. Calling it directly&lt;br/&gt;
on the subquery nodes prevented the result columns from seeing the&lt;br/&gt;
added IsNullNode.&lt;/p&gt;</comment>
                            <comment id="13918765" author="mikem" created="Mon, 3 Mar 2014 23:54:22 +0000"  >&lt;p&gt;once this has been tested for awhile in trunk would this fix be appropriate for backport to 10.10?&lt;/p&gt;</comment>
                            <comment id="13919134" author="knutanders" created="Tue, 4 Mar 2014 08:34:40 +0000"  >&lt;p&gt;Yes, I think this fix would be safe to backport to 10.10.&lt;/p&gt;</comment>
                            <comment id="13919136" author="jira-bot" created="Tue, 4 Mar 2014 08:35:15 +0000"  >&lt;p&gt;Commit 1573935 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1573935&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1573935&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6409&quot; title=&quot;Wrong result from quantified comparison&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6409&quot;&gt;&lt;del&gt;DERBY-6409&lt;/del&gt;&lt;/a&gt;: Wrong result from quantified comparison&lt;/p&gt;

&lt;p&gt;Add test case to verify that the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6408&quot; title=&quot;EXISTS returns NULL instead of FALSE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6408&quot;&gt;&lt;del&gt;DERBY-6408&lt;/del&gt;&lt;/a&gt; fixed this bug too.&lt;/p&gt;</comment>
                            <comment id="13920815" author="jira-bot" created="Wed, 5 Mar 2014 13:02:49 +0000"  >&lt;p&gt;Commit 1574464 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1574464&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1574464&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6408&quot; title=&quot;EXISTS returns NULL instead of FALSE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6408&quot;&gt;&lt;del&gt;DERBY-6408&lt;/del&gt;&lt;/a&gt;: Fix typo in comment&lt;/p&gt;</comment>
                            <comment id="13920888" author="jira-bot" created="Wed, 5 Mar 2014 14:30:17 +0000"  >&lt;p&gt;Commit 1574505 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1574505&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1574505&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6408&quot; title=&quot;EXISTS returns NULL instead of FALSE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6408&quot;&gt;&lt;del&gt;DERBY-6408&lt;/del&gt;&lt;/a&gt;: EXISTS returns NULL instead of FALSE&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6409&quot; title=&quot;Wrong result from quantified comparison&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6409&quot;&gt;&lt;del&gt;DERBY-6409&lt;/del&gt;&lt;/a&gt;: Wrong result from quantified comparison&lt;/p&gt;

&lt;p&gt;Backported revisions 1573548, 1573935, 1574464 from trunk.&lt;/p&gt;</comment>
                            <comment id="14284758" author="myrna" created="Wed, 21 Jan 2015 00:23:10 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12678189">DERBY-6409</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12678189">DERBY-6409</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12714167">DERBY-6577</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12695601">DERBY-6481</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12631501" name="d6408-1a.diff" size="12612" author="knutanders" created="Thu, 27 Feb 2014 10:56:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10367"><![CDATA[Deviation from standard]]></customfieldvalue>
    <customfieldvalue key="10366"><![CDATA[Wrong query result]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 19 Feb 2014 18:48:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357560</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzjhfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357850</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>