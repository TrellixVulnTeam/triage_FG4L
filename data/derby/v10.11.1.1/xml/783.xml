<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:39:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-783/DERBY-783.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-783] Enhance ALTER TABLE syntax to allow users to change the next value to be generated for an identity column</title>
                <link>https://issues.apache.org/jira/browse/DERBY-783</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Derby allows a user to change the interval between consecutive values of the identity column using ALTER TABLE. But there is no way to change the next value to be generated for an identity column. Such a support in Derby will be very handy for tables with identity column defined as GENERATED BY DEFAULT and with a unique key defined on them. Column defined with GENERATED BY DEFAULT allows system to generate values for them or allows the user to manually supply the value for them. A column defined this way is very useful when the user might want to import some data into the generated column manually. But this can create problems when the system generated values conflict with manually inserted values.&lt;/p&gt;

&lt;p&gt;eg&lt;br/&gt;
autocommit on;&lt;br/&gt;
create table tauto(i int generated by default as identity, k int); &lt;br/&gt;
create unique index tautoInd on tauto&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;; &lt;br/&gt;
insert into tauto(k) values 1,2;  &amp;#8211; let system generate values for the identity column&lt;br/&gt;
&amp;#8211; now do few manual inserts into identity column&lt;br/&gt;
insert into tauto values (3,3); &lt;br/&gt;
insert into tauto values (4,4); &lt;br/&gt;
insert into tauto values (5,5); &lt;br/&gt;
insert into tauto values (6,6); &lt;br/&gt;
insert into tauto values (7,7); &lt;br/&gt;
insert into tauto values (8,8); &lt;br/&gt;
&amp;#8211; notice that identity column at this point has used 1 through 8&lt;br/&gt;
&amp;#8211; now if the user wants to let the system generate a value, system will generate 3 but that is already used and hence&lt;br/&gt;
&amp;#8211; insert will throw unique key failure exception. System has consumed 3 at this point.&lt;br/&gt;
insert into tauto(k) values 9;&lt;br/&gt;
&amp;#8211; the insert above will continue to fail with the unique key failure exceptions until system has consumed all the values till 8&lt;br/&gt;
&amp;#8211; If we add ALTER TABLE syntax to allow changing the next value to be generated, then user can simply use that to change&lt;br/&gt;
&amp;#8211; next value to be generated to 9 after the manual inserts above and then insert into tauto(k) values 9 will not fail&lt;/p&gt;

&lt;p&gt;SQL standard syntax for changing the next generated value&lt;br/&gt;
ALTER TABLE &amp;lt;tablename&amp;gt; ALTER &amp;lt;columnName&amp;gt; RESTART WITH integer-constant&lt;/p&gt;</description>
                <environment></environment>
        <key id="12327007">DERBY-783</key>
            <summary>Enhance ALTER TABLE syntax to allow users to change the next value to be generated for an identity column</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="mamtas">Mamta A. Satoor</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Dec 2005 17:12:48 +0000</created>
                <updated>Wed, 1 Jul 2009 01:34:34 +0100</updated>
                            <resolved>Fri, 27 Jan 2006 09:14:50 +0000</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                            <comments>
                            <comment id="12361600" author="mamtas" created="Tue, 3 Jan 2006 19:17:22 +0000"  >&lt;p&gt;I have attached a review package for this feature to the JIRA entry. Following is a brief description of the changes involved.&lt;/p&gt;

&lt;p&gt;Changed sqlgrammar.jj to add parser support for ALTER TABLE &amp;lt;tablename&amp;gt; ALTER &amp;lt;columnName&amp;gt; RESTART WITH integer-constant&lt;br/&gt;
Also, added another element to the array which keeps track of autoincrement information in the parser. This 4th element will record if the autoincrement column is getting added or it is getting altered for INCREMENT BY value change or it is getting altered for RESTART WITH value change. This information is required later in the compile and execute phase.&lt;/p&gt;

&lt;p&gt;In the compile phase, this information is used to see if a user is trying to sneak in a value of 0 for INCREMENT BY. A value of 0 for INCREMENT BY should be caught at the time of autoincrement column add or at the time of autoincrement column alter to change the INCREMENT BY value. At the time of autoincrement column alter to change the RESTART WITH value,  the INCREMENT BY value should not be checked. This is done in ColumnDefinitionNode.java. TableElementList generates ColumnInfo which needs to keep track of autoincrement column change status from ColumnDefinitionNode. This infromation in ColumnInfo will be used at execute time.&lt;/p&gt;

&lt;p&gt;In the execute phase, we need to know which columns of SYSCOLUMNS table need to be changed for an ALTER TABLE command on the autoincrement column. In the past, we only allowed to change the INCREMENT BY criteria of an autoincrement column but with this feature, it is possible for a user to change the start with value of autoincrement column and leave the INCREMENT BY unchanged. This autoincrement column change information is passed to the execute phase via ColumnInfo.&lt;/p&gt;

&lt;p&gt;In order to provide this distinction between ALTER BY..INCREMENT BY.. and ALTER BY..RESTART WITH.., I have had to add a variable in ColumnDefinitionNode.java, ColumnInfo.java and ColumnDescriptor.java. The value of the variable in each of these classes depend on what parser recorded for the autoincrement column status ie adding an autoincrement column/changing INCREMENT BY of the autoincrement column/changing RESTART WITH of the autoincrement column.&lt;/p&gt;

&lt;p&gt;Hope this information along with the comments in the code will help in the code review. Please let me know if you have any comments.&lt;/p&gt;

&lt;p&gt;The svn stat changes for this feature is as follows&lt;br/&gt;
M      java\engine\org\apache\derby\impl\sql\compile\QueryTreeNode.java&lt;br/&gt;
M      java\engine\org\apache\derby\impl\sql\compile\ColumnDefinitionNode.java&lt;br/&gt;
M      java\engine\org\apache\derby\impl\sql\compile\CreateSchemaNode.java&lt;br/&gt;
M      java\engine\org\apache\derby\impl\sql\compile\sqlgrammar.jj&lt;br/&gt;
M      java\engine\org\apache\derby\impl\sql\compile\TableElementList.java&lt;br/&gt;
M      java\engine\org\apache\derby\impl\sql\compile\CreateViewNode.java&lt;br/&gt;
M      java\engine\org\apache\derby\impl\sql\compile\ModifyColumnNode.java&lt;br/&gt;
M      java\engine\org\apache\derby\impl\sql\execute\ColumnInfo.java&lt;br/&gt;
M      java\engine\org\apache\derby\impl\sql\execute\CreateTableConstantAction.java&lt;br/&gt;
M      java\engine\org\apache\derby\impl\sql\execute\AlterTableConstantAction.java&lt;br/&gt;
M      java\engine\org\apache\derby\impl\sql\catalog\SYSCOLUMNSRowFactory.java&lt;br/&gt;
M      java\engine\org\apache\derby\iapi\sql\dictionary\ColumnDescriptor.java&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\tests\lang\autoincrement.sql&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\master\autoincrement.out&lt;/p&gt;

&lt;p&gt;I have modified autoincrement.sql to add tests for RESTART WITH. The derbyall suite ran fine on my Windows XP machine with&lt;br/&gt;
Sun&apos;s jdk142.&lt;/p&gt;</comment>
                            <comment id="12363002" author="mamtas" created="Wed, 18 Jan 2006 02:29:31 +0000"  >&lt;p&gt;Attaching a new review package because few files have changed since the time the last review package was generated. Can a commiter please commit this?&lt;/p&gt;</comment>
                            <comment id="12363621" author="mamtas" created="Mon, 23 Jan 2006 15:39:14 +0000"  >&lt;p&gt;Attaching a patch to put RESTART in non-reserved list method in the parser. Also, added couple test cases to make sure RESTART can be used as object names in Derby.&lt;/p&gt;</comment>
                            <comment id="12363975" author="mamtas" created="Thu, 26 Jan 2006 01:37:25 +0000"  >&lt;p&gt;The patch Derby783AlterTableRestartWith012506.txt sets the autoIncrementStart in SYSCOLUMNS t to new value provided by RESTART WITH. &lt;/p&gt;

&lt;p&gt;svn stat&lt;br/&gt;
M      java\engine\org\apache\derby\impl\sql\catalog\SYSCOLUMNSRowFactory.java&lt;br/&gt;
M      java\testing\org\apache\derbyTesting\functionTests\master\autoincrement.out&lt;/p&gt;</comment>
                            <comment id="12364142" author="mamtas" created="Fri, 27 Jan 2006 07:01:56 +0000"  >&lt;p&gt;Here is the patch (Derby783AlterTableRestartWith012606.txt) with commented code removed.&lt;/p&gt;</comment>
                            <comment id="12364157" author="bandaram" created="Fri, 27 Jan 2006 08:39:10 +0000"  >&lt;p&gt;New changes submitted to set START value in the catalog to RESTART option of ALTER table is committed.&lt;/p&gt;

&lt;p&gt;Sending        java\engine\org\apache\derby\impl\sql\catalog\SYSCOLUMNSRowFactory.java&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\autoincrement.out&lt;br/&gt;
Transmitting file data ..&lt;br/&gt;
Committed revision 372660.&lt;/p&gt;</comment>
                            <comment id="12364164" author="mamtas" created="Fri, 27 Jan 2006 09:14:49 +0000"  >&lt;p&gt;All the code changes for this are checked in. There is a subtask open for documentation&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12321651" name="Derby783AlterTableRestartWith010306.txt" size="36946" author="mamtas" created="Tue, 3 Jan 2006 19:17:22 +0000"/>
                            <attachment id="12322031" name="Derby783AlterTableRestartWith011706.txt" size="36946" author="mamtas" created="Wed, 18 Jan 2006 02:29:31 +0000"/>
                            <attachment id="12322240" name="Derby783AlterTableRestartWith012206.txt" size="2425" author="mamtas" created="Mon, 23 Jan 2006 15:39:14 +0000"/>
                            <attachment id="12322352" name="Derby783AlterTableRestartWith012506.txt" size="2374" author="mamtas" created="Thu, 26 Jan 2006 01:37:25 +0000"/>
                            <attachment id="12322395" name="Derby783AlterTableRestartWith012606.txt" size="2221" author="mamtas" created="Fri, 27 Jan 2006 07:01:56 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12328060">DERBY-869</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 27 Jan 2006 08:39:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29703</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0szz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38516</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>