<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:33:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4048/DERBY-4048.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4048] Update Statistics code in AlterTableConstantAction should use execute transaction rather than compile transaction</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4048</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-269&quot; title=&quot;Provide some way to update index cardinality statistics (e.g. reimplement update statistics)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-269&quot;&gt;&lt;del&gt;DERBY-269&lt;/del&gt;&lt;/a&gt; provided a new stored procedure SYSCS_UTIL.SYSCS_UPDATE_STATISTICS to update the statistics. The code to do the work was added in AlterTableConstantAction and the name of new method in that class is updateStatistics(Activation activation). This code was copied from an existing unused class execute/UpdateStatisticsConstantAction.java(that unused class has been removed from Derby code).&lt;/p&gt;

&lt;p&gt;The copied code in AlterTableConstantAction:updateStatistics gets compile transaction as shown below to do the work of updating the statistics. &lt;br/&gt;
TransactionController tc = lcc.getTransactionCompile();&lt;br/&gt;
The javadoc for LangaugeConnectionContext for getTransactionCompile says following&lt;br/&gt;
	/**&lt;br/&gt;
		Get the transaction controller to use with this language connection&lt;br/&gt;
		context at compile time.&lt;br/&gt;
	 */&lt;br/&gt;
	TransactionController getTransactionCompile();&lt;/p&gt;

&lt;p&gt;I think we should be using TransactionController tc = lcc.getTransactionExecute() to do the work since we are not in the compile phase. The rest of the code in AlterTableConstantAction uses lcc.getTransactionExecute to get the transaction controller. &lt;/p&gt;

&lt;p&gt;I will make the changes in AlterTableConstantAction.updateStatistics to use getTransactionExecute and will run the existing tests to make sure nothing breaks.&lt;/p&gt;

&lt;p&gt;I ran into this issue of getTransactionExecute vs getTransactionCompile while working on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3788&quot; title=&quot;Provide a zero-admin way of updating the statisitcs of an index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3788&quot;&gt;&lt;del&gt;DERBY-3788&lt;/del&gt;&lt;/a&gt; (provide a zero-admin way of updating the statistics). While trying to run the statistics inline duirn the compile phase of a SELECT query, I ran into exception that statistics can&apos;t be updated because we are in read-only mode. But if I change the AlterTableConstantAction to use getTransactionExecute, then I do not run into the read-only mode exception.&lt;/p&gt;

&lt;p&gt;Please let me know if anyone has any comments on this. I will run the existing tests and if no failures, then I will go ahead and commit the change of using getTransactionExecute  rather than getTransactionCompile in AlterTableConstantAction:updateStatistics&lt;/p&gt;</description>
                <environment></environment>
        <key id="12414001">DERBY-4048</key>
            <summary>Update Statistics code in AlterTableConstantAction should use execute transaction rather than compile transaction</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="mamtas">Mamta A. Satoor</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Feb 2009 15:19:01 +0000</created>
                <updated>Fri, 21 Jan 2011 17:52:17 +0000</updated>
                            <resolved>Thu, 5 Feb 2009 14:59:35 +0000</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12670561" author="mamtas" created="Wed, 4 Feb 2009 23:56:25 +0000"  >&lt;p&gt;I have the very simple change attached as a patch here. When I try to run the junit tests (through the ui and through just the text interface), I keep running into outofmemory errors towards the end of junit All suite (specifically databasemetadata, upgrade, encryption, after these, the ui just freezes and I can&apos;t see what else might be going on). I was wondering if anyone has spare cycles to try this patch on their machine. In the mean time, I will fire the derbyall tests. Thanks&lt;/p&gt;</comment>
                            <comment id="12670598" author="mamtas" created="Thu, 5 Feb 2009 01:42:02 +0000"  >&lt;p&gt;derbyall ran fine with jdk15 on my machine. Hoping someone can try my patch and run &lt;b&gt;junit tests&lt;/b&gt; to see if everything runs fine on their machine.&lt;/p&gt;</comment>
                            <comment id="12670738" author="olesolberg" created="Thu, 5 Feb 2009 12:41:40 +0000"  >&lt;p&gt;I have run .suites.All with the patch and saw no issues.&lt;br/&gt;
(java -Xmx256M -XX:MaxPermSize=128M ... junit.textui.TestRunner ....suites.All)&lt;/p&gt;</comment>
                            <comment id="12670763" author="mamtas" created="Thu, 5 Feb 2009 14:47:33 +0000"  >&lt;p&gt;Thanks for trying the patch, Ole. I will go ahead and commit it.&lt;/p&gt;</comment>
                            <comment id="12670764" author="mamtas" created="Thu, 5 Feb 2009 14:49:05 +0000"  >&lt;p&gt;BTW, I was running junit suite as follows&lt;br/&gt;
java -Xmx1024m -cp &apos;../../tools/java/junit.jar;../../classes&apos; junit.swingui.TestRunner -noloading org.apache.derbyTesting.functionTests.suites.All&lt;/p&gt;</comment>
                            <comment id="12670768" author="mamtas" created="Thu, 5 Feb 2009 14:59:35 +0000"  >&lt;p&gt;Committed the changes with revision 741118. Will reopen the issue if any issues are discovered. The junit tests ran fine on Ole&apos;s machine and derbyall ran fine on my machine,&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12399496" name="DERBY4048_useExecuteTran_diff.txt" size="708" author="mamtas" created="Wed, 4 Feb 2009 23:56:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Feb 2009 12:41:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31113</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0l6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37251</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>