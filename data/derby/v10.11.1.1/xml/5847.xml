<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:10:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5847/DERBY-5847.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5847] Clean up IDE warnings in DRDAConnThread</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5847</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When I open DRDAConnThread in NetBeans, I see 49 warnings. Most of them are harmless (like static fields accessed via an instance, suggestions about using StringBuilder instead of StringBuffer, or using System.arraycopy() instead of for loops). Others indicate real problems, like the use of != to compare SQL states in writeSQLDIAGGRP().&lt;/p&gt;

&lt;p&gt;We should clean up the warnings so that it&apos;s easier to notice new warnings about potential problems.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12597489">DERBY-5847</key>
            <summary>Clean up IDE warnings in DRDAConnThread</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Jul 2012 18:06:12 +0100</created>
                <updated>Tue, 24 Jul 2012 18:31:12 +0100</updated>
                            <resolved>Fri, 20 Jul 2012 07:14:51 +0100</resolved>
                                    <version>10.10.1.1</version>
                                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13407262" author="knutanders" created="Thu, 5 Jul 2012 17:44:25 +0100"  >&lt;p&gt;Attaching a first patch, d5847-1a-string-equality.patch, that makes writeSQLDIAGGRP() use String.equals() instead of != to compare SQL states. It also removes an unused sqlState variable. All tests passed with the patch.&lt;/p&gt;</comment>
                            <comment id="13407440" author="kmarsden" created="Thu, 5 Jul 2012 21:01:24 +0100"  >&lt;p&gt;linking &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-436&quot; title=&quot;clean up imports and static field references in DRDA classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-436&quot;&gt;&lt;del&gt;DERBY-436&lt;/del&gt;&lt;/a&gt; which was filed for the static field references and imports in all of the DRDA classes.  These two issues intersect wrt DRDAConnThread.&lt;/p&gt;
</comment>
                            <comment id="13408108" author="knutanders" created="Fri, 6 Jul 2012 17:05:13 +0100"  >&lt;p&gt;Turns out this is a moving target. Just upgraded to NetBeans 7.2, and then the number of warnings in that file increased to 434. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I disabled the warnings for missing curly braces in if/else/for/while statements, and then it went down to 71, which is more manageable.&lt;/p&gt;</comment>
                            <comment id="13409384" author="knutanders" created="Mon, 9 Jul 2012 13:27:01 +0100"  >&lt;p&gt;Committed the 1a patch to trunk with revision 1359098.&lt;/p&gt;</comment>
                            <comment id="13409390" author="knutanders" created="Mon, 9 Jul 2012 13:34:50 +0100"  >&lt;p&gt;Attaching d5847-2a-unnecessary-return.patch which cleans up another batch of warnings. The patch removes return statements at the end of void methods, as they are not needed.&lt;/p&gt;

&lt;p&gt;Committed revision 1359110.&lt;/p&gt;</comment>
                            <comment id="13409406" author="knutanders" created="Mon, 9 Jul 2012 13:56:12 +0100"  >&lt;p&gt;Attaching d5847-3a-static-fields-and-imports.patch which fixes the references to static fields and organizes the imports alphabetically. This is also a partial fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-436&quot; title=&quot;clean up imports and static field references in DRDA classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-436&quot;&gt;&lt;del&gt;DERBY-436&lt;/del&gt;&lt;/a&gt; (partial since it only touches DRDAConnThread, whereas that issue is for all the DRDA classes).&lt;/p&gt;

&lt;p&gt;Somewhat related, but not actually addressing any warnings, the patch also replaces references to fields in JDBC30Translation with java.sql.ParameterMetaData, as the ParameterMetaData interface has been available on the minimum compiler level for the DRDA code for quite a while now.&lt;/p&gt;

&lt;p&gt;Regression tests ran cleanly with the patch.&lt;/p&gt;</comment>
                            <comment id="13410196" author="knutanders" created="Tue, 10 Jul 2012 11:01:05 +0100"  >&lt;p&gt;Committed the 3a patch with revision 1359559.&lt;/p&gt;</comment>
                            <comment id="13410280" author="knutanders" created="Tue, 10 Jul 2012 13:04:16 +0100"  >&lt;p&gt;Attaching d5847-4a-unused-assignment.patch which fixes warnings about values that are assigned to variables, but never used.&lt;/p&gt;

&lt;p&gt;This is typically code where the declaration of a variable happens before it is assigned its intended value, and the declaration temporarily assigns a value that indicates it&apos;s unused (like null, 0, -1). It is better to leave the variables uninitialized in this case, as then the compiler will be able to detect and tell us if there are code paths where it&apos;s possible that the variable is not initialized before it&apos;s used.&lt;/p&gt;

&lt;p&gt;The patch cleans up the warnings by removing the unused assignments and, if possible, moving the declaration to where the first real assignment happens.&lt;/p&gt;

&lt;p&gt;All tests ran cleanly. Committed revision 1359624.&lt;/p&gt;</comment>
                            <comment id="13410290" author="knutanders" created="Tue, 10 Jul 2012 13:27:35 +0100"  >&lt;p&gt;The patch d5847-5a-performance-warnings.patch addresses a batch of warnings that NetBeans classifies as performance warnings. None of the warnings appear to be in particularly performance critical code, but they still look like good suggestions, I think. Three different kinds of warnings are addressed by the patch:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;System.arraycopy() should be used instead of manual loops where possible.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;StringBuilder should be used instead of StringBuffer if synchronization is not required.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String concatenation should not happen in the arguments to StringBuffer.append(). Instead, there should be multiple calls to append().&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The patch changes the code as suggested. In addition, it eliminates the use of StringBuffer in convertToHexString() by using the utility method StringUtil.toHexString().&lt;/p&gt;

&lt;p&gt;Tests passed. Committed revision 1359635.&lt;/p&gt;</comment>
                            <comment id="13410368" author="knutanders" created="Tue, 10 Jul 2012 15:14:19 +0100"  >&lt;p&gt;Attaching four patches that address various warnings. I&apos;ll keep them as separate patches so that it&apos;s easier to review the changes, or back out parts of them later if some of the changes cause problems. The regression tests passed.&lt;/p&gt;

&lt;p&gt;Here&apos;s what the patches do:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;d5847-6a-obsolete-collection.patch:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Replace use of obsolete collection class Vector with ArrayList. No synchronization is needed, as far as I can see, since the vectors are private to a single server thread.&lt;/p&gt;

&lt;p&gt;Also converted two of the original Vector fields (errorManagers and errorManagersLevel) to local variables, as they are never used outside of the method where they are created.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;d5847-7a-sync-on-non-final.patch:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;NetBeans warns about synchronization on some non-final fields: timeSliceSync, logConnectionsSync and closeSync, which protect the fields timeSlice, logConnections and close, respectively.&lt;/p&gt;

&lt;p&gt;The easiest fix would be to make the *Sync fields final. However, the synchronization objects are only used in set/get methods to ensure that writes in one thread are seen by reads in other threads. For this purpose, using volatile fields would be sufficient, and the extra fields with synchronization objects could be removed. The patch therefore declares timeSlice, logConnections and close volatile, and it removes the timeSliceSync, logConnectionsSync and closeSync fields.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;d5847-8a-misc.patch:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This patch fixes three warnings:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;An if statement had been disabled by prepending &quot;false &amp;amp;&amp;amp;&quot; to the condition, so it never evaluated to true. A warning was shown because the code in the body of the if statement was unreachable. The patch comments out the code, and also adds a comment about why the code was disabled in the first place.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;An unnecessary bit shift operation was removed (shift bits 0 positions to the left is a no-op).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;A local variable in setDatabase() hid a field and was renamed from rdbnam to dbname.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;d5847-9a-this-leak.patch:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The warning that it addresses is about the constructor leaking a reference to &quot;this&quot;. That is, the constructor calls a method and passes &quot;this&quot; as an argument. The problem is that the method to which &quot;this&quot; is passed sees a not yet fully initialized instance. This may or may not be a problem depending on which parts of the state the method needs to access, but it&apos;s best avoided.&lt;/p&gt;

&lt;p&gt;The patch changes the name and signature of the method that receives the reference to &quot;this&quot;, from NetworkServerControlImpl.setUniqueThreadName(Thread thrd, String newName) to NetworkServerControlImpl.getUniqueThreadName(String base). The new method returns a unique thread name instead of setting the name of thread. The constructor could therefore pass the returned value to the super constructor instead of passing a reference to itself to the setUniqueThreadName() method. In addition to silencing the warning, this approach has the advantages that it&apos;s less code and the thread name doesn&apos;t have to be set twice per thread.&lt;/p&gt;

&lt;p&gt;A similar change had to be made to ClientThread&apos;s constructor, since NetworkServerControlImpl.setUniqueThreadName() was also used there.&lt;/p&gt;</comment>
                            <comment id="13410377" author="knutanders" created="Tue, 10 Jul 2012 15:29:21 +0100"  >&lt;p&gt;I just noticed a small, but unintentional, change caused by the 9a patch. Previously, threads would have underscores in their names (like DRDAConnThread_3), whereas they now have hyphens (DRDAConnThread-3). Patch 9b changes the names back to the old format. Rerunning tests...&lt;/p&gt;</comment>
                            <comment id="13410378" author="bryanpendleton" created="Tue, 10 Jul 2012 15:30:22 +0100"  >&lt;p&gt;Regarding &quot;if&quot; statements which are never executed, my preference is to delete the if statement&lt;br/&gt;
entirely, rather than commenting it out with more comments. We can always recover the old&lt;br/&gt;
code from Subversion should we need it.&lt;/p&gt;</comment>
                            <comment id="13410393" author="knutanders" created="Tue, 10 Jul 2012 15:47:31 +0100"  >&lt;p&gt;Thanks, Bryan. In general, I agree that it&apos;s better to delete unused code. But in this particular case, I felt that the code had some value documenting the fact that the protocol requires us to send a specific reply message, but because of a bug we cannot do that. (Assuming that the protocol actually requires a RDBUPDRM here, but I haven&apos;t checked that.) On the other hand, it might be OK to remove the code and just insert a comment saying that we&apos;re violating the protocol.&lt;/p&gt;</comment>
                            <comment id="13411089" author="bryanpendleton" created="Wed, 11 Jul 2012 01:15:36 +0100"  >&lt;p&gt;Ah, I see. Either way seems good, then. I guess I have a slight preference toward removing the&lt;br/&gt;
code and replacing it with a command describing the issue, but I&apos;m fine with commenting out&lt;br/&gt;
the code too. Thanks for the explanation.&lt;/p&gt;</comment>
                            <comment id="13411427" author="knutanders" created="Wed, 11 Jul 2012 13:09:55 +0100"  >&lt;p&gt;Replacing the 8a-misc patch with d5847-8b-misc.patch. The new version removes the dead code and adds the following comment:&lt;/p&gt;

&lt;p&gt;            // The protocol wants us to send RDBUPDRM here, but we don&apos;t do&lt;br/&gt;
            // that because it used to cause protocol errors. &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5847&quot; title=&quot;Clean up IDE warnings in DRDAConnThread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5847&quot;&gt;&lt;del&gt;DERBY-5847&lt;/del&gt;&lt;/a&gt; has&lt;br/&gt;
            // some discussion about this issue.&lt;/p&gt;

&lt;p&gt;It&apos;s a bit vague, since we don&apos;t know exactly which errors the code caused.&lt;/p&gt;

&lt;p&gt;For the record, I tried to enable the code and ran some statements that exercised the path. That is, the following commands in ij:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; connect &apos;jdbc:derby://localhost/db;create=true&apos;;&lt;br/&gt;
ij&amp;gt; create table t (x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; prepare ps as &apos;insert into t values 1,2,3&apos;;&lt;br/&gt;
ij&amp;gt; execute ps;&lt;br/&gt;
3 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; execute ps;&lt;br/&gt;
3 rows inserted/updated/deleted&lt;/p&gt;

&lt;p&gt;I verified that RDBUPDRM was sent on the &quot;execute ps&quot; statements, and no protocol error was seen.&lt;/p&gt;

&lt;p&gt;I also repeated the experiment using the JCC driver (had to make the changes in a 10.8 server to get it to run, as trunk rejects JCC after &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5565&quot; title=&quot;Network Server should reject client connections that are not Derby Network Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5565&quot;&gt;&lt;del&gt;DERBY-5565&lt;/del&gt;&lt;/a&gt;). Same result there; RDBUPDRM was sent, and the JCC client happily accepted it.&lt;/p&gt;

&lt;p&gt;So it may be OK to start sending RDBUPDRM now. But there&apos;s also a chance that there&apos;s some other usage pattern that will trigger the mentioned protocol error. Since there are no known problems caused by the lack of the RDBUPDRM, and this issue is about silencing warnings, I&apos;ll just leave it like that for now.&lt;/p&gt;</comment>
                            <comment id="13411431" author="knutanders" created="Wed, 11 Jul 2012 13:19:25 +0100"  >&lt;p&gt;Committed d5847-6a-obsolete-collection.patch to trunk with revision 1360133.&lt;br/&gt;
Committed d5847-7a-sync-on-non-final.patch to trunk with revision 1360134.&lt;br/&gt;
Committed d5847-8b-misc.patch to trunk with revision 1360135.&lt;br/&gt;
Committed d5847-9b-this-leak.patch to trunk with revision 1360137.&lt;/p&gt;

&lt;p&gt;Now the only warnings left to clean up in this file are:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;345 if/else statements without braces&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;10 for loops without braces&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1 missing @Override annotation&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The latter cannot be fixed without starting to compile the DRDA code with source level 1.5. That&apos;s probably a good idea anyway, since the DRDA code on trunk isn&apos;t supported on earlier Java versions.&lt;/p&gt;</comment>
                            <comment id="13418645" author="knutanders" created="Thu, 19 Jul 2012 21:32:10 +0100"  >&lt;p&gt;Here&apos;s a patch (d5847-10a-overrides-and-braces.patch) that cleans up the last batch of warnings that I see in my environment.&lt;/p&gt;

&lt;p&gt;The patch adds an @Override annotation to the run() method, and addresses the warnings about missing braces by adding braces or using existing helper methods (like getDbName(), System.arraycopy() and Math.min()/max()) that make it possible to eliminate the if/else statements and for loops that lack braces. It also collapses an if/else statement in writeFdocaVal() with special cases for Byte, Short an Integer into a single statement that uses the common super-class Number.&lt;/p&gt;

&lt;p&gt;All the regression tests passed with the patch.&lt;/p&gt;</comment>
                            <comment id="13418952" author="knutanders" created="Fri, 20 Jul 2012 07:14:51 +0100"  >&lt;p&gt;Committed revision 1363661.&lt;/p&gt;

&lt;p&gt;I don&apos;t see any more warnings in this file, so marking the issue as resolved.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12311895">DERBY-436</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12537241" name="d5847-10a-overrides-and-braces.patch" size="109543" author="knutanders" created="Thu, 19 Jul 2012 21:32:10 +0100"/>
                            <attachment id="12535221" name="d5847-1a-string-equality.patch" size="1639" author="knutanders" created="Thu, 5 Jul 2012 17:44:25 +0100"/>
                            <attachment id="12535659" name="d5847-2a-unnecessary-return.patch" size="1831" author="knutanders" created="Mon, 9 Jul 2012 13:34:50 +0100"/>
                            <attachment id="12535663" name="d5847-3a-static-fields-and-imports.patch" size="11395" author="knutanders" created="Mon, 9 Jul 2012 13:56:12 +0100"/>
                            <attachment id="12535812" name="d5847-4a-unused-assignment.patch" size="8528" author="knutanders" created="Tue, 10 Jul 2012 13:04:16 +0100"/>
                            <attachment id="12535815" name="d5847-5a-performance-warnings.patch" size="5245" author="knutanders" created="Tue, 10 Jul 2012 13:27:35 +0100"/>
                            <attachment id="12535829" name="d5847-6a-obsolete-collection.patch" size="2071" author="knutanders" created="Tue, 10 Jul 2012 15:14:19 +0100"/>
                            <attachment id="12535830" name="d5847-7a-sync-on-non-final.patch" size="3451" author="knutanders" created="Tue, 10 Jul 2012 15:14:19 +0100"/>
                            <attachment id="12535831" name="d5847-8a-misc.patch" size="2761" author="knutanders" created="Tue, 10 Jul 2012 15:14:19 +0100"/>
                            <attachment id="12536019" name="d5847-8b-misc.patch" size="2346" author="knutanders" created="Wed, 11 Jul 2012 13:09:55 +0100"/>
                            <attachment id="12535832" name="d5847-9a-this-leak.patch" size="5251" author="knutanders" created="Tue, 10 Jul 2012 15:14:19 +0100"/>
                            <attachment id="12535837" name="d5847-9b-this-leak.patch" size="5305" author="knutanders" created="Tue, 10 Jul 2012 15:29:21 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Jul 2012 20:01:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245865</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0am7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35538</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>