<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:31:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-273/DERBY-273.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-273] The derbynet/dataSourcePermissions_net.java test fails intermittently</title>
                <link>https://issues.apache.org/jira/browse/DERBY-273</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The test fails in the derbyall/derbynetclientmats/derbynetmats suite stack with the following diff:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;Start: dataSourcePermissions_net jdk1.4.2 DerbyNetClient derbynetmats:derbynetmats 2005-05-11 04:24:11 ***&lt;br/&gt;
17a18,19&lt;br/&gt;
&amp;gt; org.apache.derby.iapi.services.context.ShutdownException: &lt;br/&gt;
&amp;gt; agentThread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_2,5,derby.daemons&amp;#93;&lt;/span&gt;&lt;br/&gt;
Test Failed.&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>1.4.2 JVM (both Sun and IBM)&lt;br/&gt;
1.5.0_02  JVM (sun)</environment>
        <key id="32498">DERBY-273</key>
            <summary>The derbynet/dataSourcePermissions_net.java test fails intermittently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="naka">Tomohito Nakayama</assignee>
                                    <reporter username="jackklebanoff">Jack Klebanoff</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 May 2005 07:53:08 +0100</created>
                <updated>Thu, 2 May 2013 03:28:57 +0100</updated>
                            <resolved>Sat, 25 Feb 2006 16:14:49 +0000</resolved>
                                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="65999" author="kmarsden" created="Mon, 23 May 2005 06:58:54 +0100"  >&lt;p&gt;When network server closes a session, it tries to perform a rollback on the connection before closing the connection. If it encounters an exception during rollback it treats the exception as an unexpected exception and prints the error to the console. &lt;/p&gt;

&lt;p&gt;However, in this case, the database has been intentionally shut down and the error on rollback is expected. Network Server should treat an error on rollback, when closing a session, as an expected exception if the database has been intentionally shut down. &lt;/p&gt;

&lt;p&gt;The intermittent nature of this diff seems to be related to when the session for the disconnected client that shutdown the database gets cleaned up. &lt;/p&gt;

&lt;p&gt;When the test fails, this is the trace in the tmp file: &lt;/p&gt;

&lt;p&gt;org.apache.derby.iapi.services.context.ShutdownException: &lt;br/&gt;
at org.apache.derby.iapi.services.context.ContextManager.checkInterrupt(ContextManager.java:374) &lt;br/&gt;
at org.apache.derby.iapi.services.context.ContextManager.popContext(ContextManager.java:152) &lt;br/&gt;
at org.apache.derby.iapi.services.context.ContextImpl.popMe(ContextImpl.java:80) &lt;br/&gt;
at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.resetSavepoints(GenericLanguageConnectionContext.java:1309) &lt;br/&gt;
at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.doRollback(GenericLanguageConnectionContext.java:1288) &lt;br/&gt;
at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.userRollback(GenericLanguageConnectionContext.java:1199) &lt;br/&gt;
at org.apache.derby.impl.jdbc.TransactionResourceImpl.rollback(TransactionResourceImpl.java:244) &lt;br/&gt;
agentThread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_3,5,derby.daemons&amp;#93;&lt;/span&gt; &lt;br/&gt;
at org.apache.derby.impl.jdbc.EmbedConnection.rollback(EmbedConnection.java:894) &lt;br/&gt;
at org.apache.derby.impl.drda.Database.close(Database.java:352) &lt;br/&gt;
at org.apache.derby.impl.drda.Session.close(Session.java:110) &lt;br/&gt;
at org.apache.derby.impl.drda.DRDAConnThread.closeSession(DRDAConnThread.java:6803) &lt;br/&gt;
at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:241) &lt;br/&gt;
EXPECTED SHUTDOWN DERBY SQL error: SQLCODEWhen network server closes a session, it tries to perform a rollback on the connection before closing the connection. If it encounters an exception during rollback it treats the exception as an unexpected exception and prints the error to the console. &lt;/p&gt;

&lt;p&gt;However, in this case, the database has been intentionally shut down and the error on rollback is expected. Network Server should treat an error on rollback, when closing a session, as an expected exception if the database has been intentionally shut down. &lt;/p&gt;

&lt;p&gt;The intermittent nature of this diff seems to be related to when the session for the disconnected client that shutdown the database gets cleaned up. &lt;/p&gt;

&lt;p&gt;When the test fails, this is the trace in the tmp file: &lt;/p&gt;

&lt;p&gt;org.apache.derby.iapi.services.context.ShutdownException: &lt;br/&gt;
at org.apache.derby.iapi.services.context.ContextManager.checkInterrupt(ContextManager.java:374) &lt;br/&gt;
at org.apache.derby.iapi.services.context.ContextManager.popContext(ContextManager.java:152) &lt;br/&gt;
at org.apache.derby.iapi.services.context.ContextImpl.popMe(ContextImpl.java:80) &lt;br/&gt;
at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.resetSavepoints(GenericLanguageConnectionContext.java:1309) &lt;br/&gt;
at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.doRollback(GenericLanguageConnectionContext.java:1288) &lt;br/&gt;
at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.userRollback(GenericLanguageConnectionContext.java:1199) &lt;br/&gt;
at org.apache.derby.impl.jdbc.TransactionResourceImpl.rollback(TransactionResourceImpl.java:244) &lt;br/&gt;
agentThread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_3,5,derby.daemons&amp;#93;&lt;/span&gt; &lt;br/&gt;
at org.apache.derby.impl.jdbc.EmbedConnection.rollback(EmbedConnection.java:894) &lt;br/&gt;
at org.apache.derby.impl.drda.Database.close(Database.java:352) &lt;br/&gt;
at org.apache.derby.impl.drda.Session.close(Session.java:110) &lt;br/&gt;
at org.apache.derby.impl.drda.DRDAConnThread.closeSession(DRDAConnThread.java:6803) &lt;br/&gt;
at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:241) &lt;br/&gt;
EXPECTED SHUTDOWN DERBY SQL error: SQLCODE: -1, SQLSTATE: 08006 ...&lt;/p&gt;</comment>
                            <comment id="12312740" author="naka" created="Mon, 6 Jun 2005 21:32:18 +0100"  >&lt;p&gt;I have started to survey ...&lt;/p&gt;


&lt;p&gt;My first question was &quot;What is ShutdownException ?&quot;&lt;/p&gt;

&lt;p&gt;JavaDoc told &quot;A ShutdownException is a runtime exception that is used to notify code that the system has/is being shut down. &quot;&lt;br/&gt;
&lt;a href=&quot;http://incubator.apache.org/derby/javadoc/engine/org/apache/derby/iapi/services/context/ShutdownException.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://incubator.apache.org/derby/javadoc/engine/org/apache/derby/iapi/services/context/ShutdownException.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Grepping whole code ,I found ShutdownException was thrown only from next two part.&lt;br/&gt;
./engine/org/apache/derby/iapi/services/context/ContextManager.java:374:			throw new ShutdownException();&lt;br/&gt;
./engine/org/apache/derby/iapi/services/context/ContextService.java:124:			throw new ShutdownException();&lt;/p&gt;

&lt;p&gt;Reading each class, I found that these part are executed only when ContextManager or ContextService is in state of shutdown or  stopped.&lt;/p&gt;

&lt;p&gt;These codes completely match explanation in JavaDoc.&lt;br/&gt;
Each object is in state of shutdown , and ShutdownException happens.&lt;/p&gt;


&lt;p&gt;Then, next question arise.&lt;br/&gt;
Why there happens situation of  system has/is being shut down during running in  DRDAConnThread as reported ?&lt;/p&gt;

&lt;p&gt;I think reading dataSourcePermissions_net will give me answer.&lt;/p&gt;</comment>
                            <comment id="12312889" author="naka" created="Wed, 8 Jun 2005 00:33:02 +0100"  >&lt;p&gt;I have read the dataSourcePermissions_net.&lt;/p&gt;

&lt;p&gt;dataSourcePermissions_net  executes network version of test executed in dataSourcePermissions.&lt;br/&gt;
Content of tests was implemented in dataSourcePermissions.runTest().&lt;/p&gt;

&lt;p&gt;In the test, &lt;br/&gt;
there exist  parts where it is repeated , to create connection to database named wombat and to shut down database via the connection.&lt;/p&gt;

&lt;p&gt;Reported exception seems to happen in this repeating part.&lt;br/&gt;
...see &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/20380/derbyall_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/20380/derbyall_diff.txt&lt;/a&gt; also.&lt;/p&gt;

&lt;p&gt;I suspect there exists remaining previous thread concerning with that database , when shutting down the database... &lt;br/&gt;
Then ShutdownException is thrown from previous working thread , I wonder.&lt;/p&gt;</comment>
                            <comment id="12313153" author="naka" created="Thu, 9 Jun 2005 21:31:46 +0100"  >&lt;p&gt;In my previous comment, I wrote as next.&lt;/p&gt;

&lt;p&gt;&amp;gt;In the test, &lt;br/&gt;
&amp;gt;there exist parts where it is repeated , to create connection to database named wombat and to shut down database via the connection.&lt;/p&gt;

&lt;p&gt;This is incorrect.&lt;br/&gt;
Database was shutdown via &quot;another&quot; connection using &quot;jdbc:derby:;shutdown=true&quot;, &lt;br/&gt;
though there exists another connections .&lt;/p&gt;

&lt;p&gt;Well ...&lt;br/&gt;
Now I think ShutdownException thrown by rollback process should be treated as Exception.&lt;br/&gt;
User should not shutdown Database if there remain connections ....&lt;br/&gt;
Then, Exception in test result itself was truly Exception. &lt;/p&gt;

&lt;p&gt;And futhermore, connection should be surely closed , &lt;br/&gt;
though Database was earlier closed and Exception happens in rollback ....&lt;/p&gt;</comment>
                            <comment id="12313361" author="naka" created="Sat, 11 Jun 2005 16:54:25 +0100"  >&lt;p&gt;I read code org.apache.derby.impl.drda.Database#close();&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/repos/asf/incubator/derby/code/trunk/java/drda/org/apache/derby/impl/drda/Database.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/incubator/derby/code/trunk/java/drda/org/apache/derby/impl/drda/Database.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Documentation comment for this method said &lt;br/&gt;
&quot;Close the connection and clean up the statement table.&quot;.&lt;/p&gt;

&lt;p&gt;Reading the code , I found there are next processing&lt;/p&gt;

&lt;p&gt;1:if stmtTable exists, call every DRDAStatement.close() in stmtTable.&lt;br/&gt;
2:if conn exists&lt;br/&gt;
	2-1:call conn.rollback() &lt;br/&gt;
	2-2:call conn.close().&lt;/p&gt;

&lt;p&gt;If exception happens in conn.rollback() of 2-1 ,&lt;br/&gt;
conn.close() of 2-2 would be not called as Kathey suggested in previous mail.&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/db-derby-dev/200506.mbox/%3c42A65E51.6010800@sbcglobal.net%3e&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/db-derby-dev/200506.mbox/%3c42A65E51.6010800@sbcglobal.net%3e&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;I think conn.close() should be called in finally clause in this method.&lt;/p&gt;</comment>
                            <comment id="12313385" author="naka" created="Sun, 12 Jun 2005 20:32:05 +0100"  >&lt;p&gt;Consequently, there exists two matter to do.&lt;/p&gt;

&lt;p&gt;modify-1: &lt;br/&gt;
Modify scenario of dataSourcePermissions not to shutdown when connection exists.&lt;br/&gt;
This will supress errors in test.&lt;/p&gt;

&lt;p&gt;modify-2: &lt;br/&gt;
Modify how conn.rollback() is called in org.apache.derby.impl.drda.Database#close() ,&lt;br/&gt;
and make it sure for connection to be closed in exceptional state.&lt;/p&gt;

&lt;p&gt;Now problem exits in modify-2.&lt;br/&gt;
How can this to be tested ?&lt;br/&gt;
The modify-2 can be confirmed under exceptional state that happens indeterministically ...&lt;/p&gt;

</comment>
                            <comment id="12313462" author="naka" created="Mon, 13 Jun 2005 23:21:48 +0100"  >&lt;p&gt;Regarding modify-1, there was a wrong guess in my previous thought.&lt;/p&gt;

&lt;p&gt;I thought database was shutdown before closing connection , then connection remains in the dataSourcePermissions test.&lt;br/&gt;
However, I found connection was closed before shutting down database in the test.&lt;/p&gt;


&lt;p&gt;To know why connection remains, &lt;br/&gt;
I read the code around DRDAConnThread.&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/repos/asf/incubator/derby/code/trunk/java/drda/org/apache/derby/impl/drda/DRDAConnThread.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/incubator/derby/code/trunk/java/drda/org/apache/derby/impl/drda/DRDAConnThread.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In last part of DRDAConnThread#run() ,&lt;br/&gt;
I found  closing connection at server was caused by DRDAProtocolException that stands for disconnection.&lt;/p&gt;

&lt;p&gt;This exeption was caused in DDMReader and DDMWriter , calling DRDAConnThread#markCommunicationsFailure when catching IOException.&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/repos/asf/incubator/derby/code/trunk/java/drda/org/apache/derby/impl/drda/DDMReader.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/incubator/derby/code/trunk/java/drda/org/apache/derby/impl/drda/DDMReader.java&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/repos/asf/incubator/derby/code/trunk/java/drda/org/apache/derby/impl/drda/DDMWriter.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/incubator/derby/code/trunk/java/drda/org/apache/derby/impl/drda/DDMWriter.java&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;I guess client close the connection one-sidely and &lt;br/&gt;
DRDAProtocolException representing disconnection happens in server , &lt;br/&gt;
and rollback and close connection at server follows .&lt;/p&gt;

&lt;p&gt;Because client is one-side player , client doesn&apos;t know wheter server finished work of closing connection .&lt;/p&gt;


&lt;p&gt;Then ... how to ensure finishing closing connection before shutting down database ...? &lt;/p&gt;</comment>
                            <comment id="12313468" author="kmarsden" created="Mon, 13 Jun 2005 23:47:47 +0100"  >&lt;p&gt;I have two ideas, neither of which seem ideal but maybe they will give you a better idea.&lt;/p&gt;

&lt;p&gt;1) If the exception is intermittent but not harmful you could specify an alternate consoleWriter when you call NetworkServerControl.start().  This way the exception does not print to System.out.  &lt;br/&gt;
This would mean that dataSourcePermissions_net.java would suffer the same deficiencey as the other tests, that the console is not monitored properly by the test.&lt;/p&gt;


&lt;p&gt;2) The NetworkServerControl method getRuntimeInfo will show the connection info from the server&apos;s perspective.  You could alternately sleep for a few seconds and call this method to see the connections from the server perspective.  The output is a string that would need to be parsed. It has output that looks like:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Connection Threads : 2&lt;/li&gt;
	&lt;li&gt;Active Sessions : 2&lt;/li&gt;
	&lt;li&gt;Waiting  Sessions : 0&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;And always includes one session for the runtimeinfo request.&lt;/p&gt;


</comment>
                            <comment id="12313814" author="naka" created="Thu, 16 Jun 2005 20:43:17 +0100"  >&lt;p&gt;The alternate plans ....&lt;/p&gt;

&lt;p&gt;alternate-plan-1:&lt;br/&gt;
Not to output message of exception to STDOUT&lt;/p&gt;

&lt;p&gt;alternate-plan-2:&lt;br/&gt;
In the test program , wait to session closed seeing return value of &lt;br/&gt;
NetworkServerControl#getRuntimeInfo&lt;/p&gt;

&lt;p&gt;alternate-plan-3:&lt;br/&gt;
Modify shutdown process to wait session closed. &lt;/p&gt;


&lt;p&gt;I think &lt;/p&gt;

&lt;p&gt;alternate-plan-1 have problem that&lt;br/&gt;
the message of exception should be shown to the user.&lt;/p&gt;

&lt;p&gt;alternate-plan-3 have problem that &lt;br/&gt;
If it was failed to close session, shutdown will fail.&lt;/p&gt;


&lt;p&gt;I think direction of alternation-2 would be best.&lt;br/&gt;
I will survey one more how to detect all session was closed.&lt;/p&gt;</comment>
                            <comment id="12314045" author="naka" created="Mon, 20 Jun 2005 22:44:18 +0100"  >&lt;p&gt;To accomplish plan-2,&lt;br/&gt;
count of session need to be polled to know wheter all session was closed ...&lt;/p&gt;

&lt;p&gt;There are next two option.&lt;/p&gt;

&lt;p&gt;option1:&lt;br/&gt;
Adding NetworkServerControl#getCountOfSession() method , which retrieve count of sessions from NetworkServerControl.&lt;/p&gt;

&lt;p&gt;option2:&lt;br/&gt;
Using getRuntimeInfo() method and parse result of it.&lt;/p&gt;

&lt;p&gt;In a glance , option1 seems to be straight answer.&lt;br/&gt;
However , NetworkServerControl#getCountOfSession() have wrong impact to make confusion in future.&lt;br/&gt;
Because count of session would be vary after the value is retrieved , accessd by other threads.&lt;/p&gt;

&lt;p&gt;I think count of session is very private information in NetworkServerControl , &lt;br/&gt;
and should not be retrieved directly from NetworkServerControl.&lt;/p&gt;


&lt;p&gt;I think it is moderate to take option2 ,&lt;br/&gt;
regarding user checking state of connection seeing getRuntimeInfo ...&lt;/p&gt;
</comment>
                            <comment id="12316930" author="naka" created="Thu, 28 Jul 2005 02:09:18 +0100"  >&lt;p&gt;Summary of what I knew in this issue ever ...&lt;/p&gt;

&lt;p&gt;The phenomena found in this issue happens when closing connection falls on shutting down database. &lt;br/&gt;
To make the phenomena not happen , it is needed to ensure closure of connection before shutting down database. &lt;br/&gt;
However, it is impossible to close  connection in ConnectionPool only using jdbc interface.&lt;/p&gt;

&lt;p&gt;Then, I think connection managment mechanism outside jdbc is needed to solve this issue ....&lt;/p&gt;
</comment>
                            <comment id="12317096" author="naka" created="Fri, 29 Jul 2005 01:13:39 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-273&quot; title=&quot;The derbynet/dataSourcePermissions_net.java test fails intermittently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-273&quot;&gt;&lt;del&gt;DERBY-273&lt;/del&gt;&lt;/a&gt; is one of cases , of which it is needed to ensure to close Connection.&lt;/p&gt;</comment>
                            <comment id="12317911" author="kmarsden" created="Sun, 7 Aug 2005 23:54:27 +0100"  >&lt;p&gt;I have not been able to follow this thread closely, but I don&apos;t think I understand how Connection Pooling relates to this problem.   Can you post a bit of java code or a standalone java program that demonstrates the issue?&lt;/p&gt;</comment>
                            <comment id="12320335" author="naka" created="Sun, 28 Aug 2005 15:50:11 +0100"  >&lt;p&gt;To ignore errors in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-273&quot; title=&quot;The derbynet/dataSourcePermissions_net.java test fails intermittently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-273&quot;&gt;&lt;del&gt;DERBY-273&lt;/del&gt;&lt;/a&gt;, test in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-511&quot; title=&quot;Test of shutting down database when active connections alive.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-511&quot;&gt;&lt;del&gt;DERBY-511&lt;/del&gt;&lt;/a&gt; is to be added.&lt;/p&gt;</comment>
                            <comment id="12362240" author="kmarsden" created="Tue, 10 Jan 2006 04:24:22 +0000"  >&lt;p&gt;In this test an intentional shutdown causes the close of the connection by network server to encounter an error that prints to the console.  It appears it may be  the same issue as  &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-273&quot; title=&quot;The derbynet/dataSourcePermissions_net.java test fails intermittently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-273&quot;&gt;&lt;del&gt;DERBY-273&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12364835" author="mikem" created="Thu, 2 Feb 2006 03:01:04 +0000"  >&lt;p&gt;It seems this issue is on the high side of &quot;intermittent&quot;  I saw it fail twice last night, 1/31 - build 373975&lt;br/&gt;
Environment:&lt;br/&gt;
Generating report for RunSuite derbyall  null null null true &lt;br/&gt;
------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.5.0_02&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
Java home:       d:\dev\src\jdk15\jre&lt;br/&gt;
Java classpath:  d:/dev/src/classes/derby.jar;d:/dev/src/classes/derbyLocale_zh_TW.jar;d:/dev/src/classes/derbyLocale_zh_CN.jar;d:/dev/src/classes/derbyLocale_pt_BR.jar;d:/dev/src/classes/derbyLocale_ko_KR.jar;d:/dev/src/classes/derbyLocale_ja_JP.jar;d:/dev/src/classes/derbyLocale_it.jar;d:/dev/src/classes/derbyLocale_fr.jar;d:/dev/src/classes/derbyLocale_es.jar;d:/dev/src/classes/derbyLocale_de_DE.jar;d:/dev/src/classes/derbytools.jar;d:/dev/src/classes/derbynet.jar;d:/dev/src/classes/derbyclient.jar;;d:/dev/src/classes/derbyTesting.jar;d:/dev/src/classes/maps.jar;d:/dev/src/classes/functionTests.jar;d:/dev/src/tools/java/junit.jar;d:/dev/src/tools/java/jndi/fscontext.jar;d:/dev/src/tools/java/RmiJdbc.jar;d:/dev/src/drda/jcc/2.4/db2jcc.jar;d:/dev/src/drda/jcc/2.4/db2jcc_license_c.jar&lt;br/&gt;
OS name:         Windows 2000&lt;br/&gt;
OS architecture: x86&lt;br/&gt;
OS version:      5.0&lt;br/&gt;
Java user name:  cloudtst&lt;br/&gt;
Java user home:  C:\Documents and Settings\cloudtst&lt;br/&gt;
Java user dir:   D:\dev\src\JarResults.2006-01-31\jdk15_derbyall&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
java.specification.version: 1.5&lt;br/&gt;
--------- Derby Information --------&lt;br/&gt;
JRE - JDBC: J2SE 5.0 - JDBC 3.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;D:\dev\src\classes\derby.jar&amp;#93;&lt;/span&gt; 10.2.0.0 alpha - (373975)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;D:\dev\src\classes\derbytools.jar&amp;#93;&lt;/span&gt; 10.2.0.0 alpha - (373975)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;D:\dev\src\classes\derbynet.jar&amp;#93;&lt;/span&gt; 10.2.0.0 alpha - (373975)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;D:\dev\src\classes\derbyclient.jar&amp;#93;&lt;/span&gt; 10.2.0.0 alpha - (373975)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;D:\dev\src\drda\jcc\2.4\db2jcc.jar&amp;#93;&lt;/span&gt; 2.4 - (17)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;D:\dev\src\drda\jcc\2.4\db2jcc_license_c.jar&amp;#93;&lt;/span&gt; 2.4 - (17)&lt;br/&gt;
------------------------------------------------------&lt;br/&gt;
diff: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;
			&lt;ul&gt;
				&lt;li&gt;
				&lt;ul&gt;
					&lt;li&gt;
					&lt;ul&gt;
						&lt;li&gt;
						&lt;ul&gt;
							&lt;li&gt;
							&lt;ul&gt;
								&lt;li&gt;
								&lt;ul&gt;
									&lt;li&gt;Diff file derbyall/derbynetclientmats/DerbyNetClient/derbynetmats/derbynetmats/dataSourcePermissions_net.diff&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
			&lt;li&gt;Start: dataSourcePermissions_net jdk1.5.0_02 DerbyNetClient derbynetmats:derbynetmats 2006-02-01 01:44:45 ***&lt;br/&gt;
21a22,23&lt;br/&gt;
&amp;gt; org.apache.derby.iapi.services.context.ShutdownException: &lt;br/&gt;
&amp;gt; agentThread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_4,5,derby.daemons&amp;#93;&lt;/span&gt;&lt;br/&gt;
Test Failed.&lt;/li&gt;
			&lt;li&gt;End:   dataSourcePermissions_net jdk1.5.0_02 DerbyNetClient derbynetmats:derbynetmats 2006-02-01 01:45:28 ***
			&lt;ul&gt;
				&lt;li&gt;
				&lt;ul&gt;
					&lt;li&gt;
					&lt;ul&gt;
						&lt;li&gt;
						&lt;ul&gt;
							&lt;li&gt;
							&lt;ul&gt;
								&lt;li&gt;
								&lt;ul&gt;
									&lt;li&gt;Diff file derbyall/derbynetclientmats/DerbyNetClient/derbynetmats/jdbc20/batchUpdate.diff&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Second failure:&lt;br/&gt;
evironment:&lt;br/&gt;
Generating report for RunSuite derbynetmats  null null DerbyNet true &lt;br/&gt;
------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.5.0_02&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
Java home:       d:\dev\src\jdk15\jre&lt;br/&gt;
Java classpath:  d:/dev/src/classes/derby.jar;d:/dev/src/classes/derbytools.jar;d:/dev/src/classes/derbynet.jar;d:/dev/src/classes/derbyclient.jar;d:/dev/src/classes/functionTests.jar;d:/dev/src/classes/derbyTesting.jar;d:/dev/src/tools/java/jndi/fscontext.jar;d:/dev/src/drda/jcc/2.6/db2jcc.jar;d:/dev/src/drda/jcc/2.6/db2jcc_license_c.jar;d:/dev/src/tools/java/junit.jar;d:/dev/src/classes/derbyLocale_zh_TW.jar;d:/dev/src/classes/derbyLocale_zh_CN.jar;d:/dev/src/classes/derbyLocale_pt_BR.jar;d:/dev/src/classes/derbyLocale_ko_KR.jar;d:/dev/src/classes/derbyLocale_ja_JP.jar;d:/dev/src/classes/derbyLocale_it.jar;d:/dev/src/classes/derbyLocale_fr.jar;d:/dev/src/classes/derbyLocale_es.jar;d:/dev/src/classes/derbyLocale_de_DE.jar;&lt;br/&gt;
OS name:         Windows 2000&lt;br/&gt;
OS architecture: x86&lt;br/&gt;
OS version:      5.0&lt;br/&gt;
Java user name:  cloudtst&lt;br/&gt;
Java user home:  C:\Documents and Settings\cloudtst&lt;br/&gt;
Java user dir:   D:\dev\src\JarResults.2006-01-31\jdk15_derbynetmats_jcc_2.6&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
java.specification.version: 1.5&lt;br/&gt;
--------- Derby Information --------&lt;br/&gt;
JRE - JDBC: J2SE 5.0 - JDBC 3.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;D:\dev\src\classes\derby.jar&amp;#93;&lt;/span&gt; 10.2.0.0 alpha - (373975)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;D:\dev\src\classes\derbytools.jar&amp;#93;&lt;/span&gt; 10.2.0.0 alpha - (373975)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;D:\dev\src\classes\derbynet.jar&amp;#93;&lt;/span&gt; 10.2.0.0 alpha - (373975)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;D:\dev\src\classes\derbyclient.jar&amp;#93;&lt;/span&gt; 10.2.0.0 alpha - (373975)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;D:\dev\src\drda\jcc\2.6\db2jcc.jar&amp;#93;&lt;/span&gt; 2.6 - (90)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;D:\dev\src\drda\jcc\2.6\db2jcc_license_c.jar&amp;#93;&lt;/span&gt; 2.6 - (90)&lt;br/&gt;
------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Diff:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;
			&lt;ul&gt;
				&lt;li&gt;
				&lt;ul&gt;
					&lt;li&gt;
					&lt;ul&gt;
						&lt;li&gt;
						&lt;ul&gt;
							&lt;li&gt;
							&lt;ul&gt;
								&lt;li&gt;
								&lt;ul&gt;
									&lt;li&gt;Diff file derbynetmats/DerbyNet/derbynetmats/dataSourcePermissions_net.diff&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
			&lt;li&gt;Start: dataSourcePermissions_net jdk1.5.0_02 DerbyNet derbynetmats:derbynetmats 2006-02-01 04:32:29 ***&lt;br/&gt;
38a39,40&lt;br/&gt;
&amp;gt; org.apache.derby.iapi.services.context.ShutdownException: &lt;br/&gt;
&amp;gt; agentThread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_6,5,derby.daemons&amp;#93;&lt;/span&gt;&lt;br/&gt;
Test Failed.&lt;/li&gt;
			&lt;li&gt;End:   dataSourcePermissions_net jdk1.5.0_02 DerbyNet derbynetmats:derbynetmats 2006-02-01 04:33:05 ***
			&lt;ul&gt;
				&lt;li&gt;
				&lt;ul&gt;
					&lt;li&gt;
					&lt;ul&gt;
						&lt;li&gt;
						&lt;ul&gt;
							&lt;li&gt;
							&lt;ul&gt;
								&lt;li&gt;
								&lt;ul&gt;
									&lt;li&gt;Diff file derbynetmats/DerbyNet/derbynetmats/updatableResultSet.diff&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12366485" author="naka" created="Wed, 15 Feb 2006 23:20:14 +0000"  >&lt;p&gt;Description of patch :&lt;br/&gt;
   Alter where derbynet/dataSourcePermissions_net.java print ShutdownException from System.out to shutdown.log.&lt;/p&gt;

&lt;p&gt;Test :&lt;br/&gt;
   Execute derbyall and found no error.&lt;/p&gt;</comment>
                            <comment id="12366965" author="naka" created="Sun, 19 Feb 2006 23:39:00 +0000"  >&lt;p&gt;The patch committed.&lt;/p&gt;

&lt;p&gt;Sending        java/drda/org/apache/derby/drda/NetworkServerControl.java&lt;br/&gt;
Sending        java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/dataSourcePermissions_net.java&lt;br/&gt;
Transmitting file data ..&lt;br/&gt;
Committed revision 378903.&lt;/p&gt;</comment>
                            <comment id="12366969" author="kmarsden" created="Mon, 20 Feb 2006 02:23:50 +0000"  >&lt;p&gt;I noticed that the patch for this issue added a new method to the public API.&lt;/p&gt;

&lt;p&gt;I think if  the public API is being changed we should &lt;br/&gt;
1) Add a  new Jira issue for that so people know what is being added and can comment&lt;br/&gt;
2) Understand why  we need a new public method in the API&lt;br/&gt;
3) Have javadoc for the api call.&lt;/p&gt;


&lt;p&gt;I almost missed this all together because it was not mentioned in the patch comments.&lt;br/&gt;
I thought it was just a test modification.  When i updated my client I saw NetworkServerControl had changed so took a look.&lt;/p&gt;

</comment>
                            <comment id="12367020" author="naka" created="Mon, 20 Feb 2006 20:08:03 +0000"  >&lt;p&gt;I was not conscious for modification of public API.&lt;br/&gt;
I think it is possible to go on alternative way ,which does not need new method.&lt;/p&gt;

&lt;p&gt;I will submit patch again for this issue.&lt;/p&gt;</comment>
                            <comment id="12367047" author="naka" created="Tue, 21 Feb 2006 01:22:50 +0000"  >&lt;p&gt;Writing and testing the new patch, I found manipulating log writer which exists in NetworkServerControlImpl seems to be insufficient...&lt;br/&gt;
I could find error was printed to *.out file, though stream for file was passed via constructor.&lt;/p&gt;

&lt;p&gt;Now, I&apos;m trying to utilize System.setOut and System.setErr instead.&lt;br/&gt;
This method seems to work well.&lt;/p&gt;</comment>
                            <comment id="12367048" author="kmarsden" created="Tue, 21 Feb 2006 01:31:31 +0000"  >&lt;p&gt;So are you saying that you start the server with the NetworkServerControl method&lt;br/&gt;
	public void start(PrintWriter consoleWriter) throws Exception&lt;/p&gt;

&lt;p&gt;but messages are still going to System.out and System.err?&lt;/p&gt;</comment>
                            <comment id="12367073" author="kmarsden" created="Tue, 21 Feb 2006 04:53:05 +0000"  >&lt;p&gt;I don&apos;t think for this test any of the console output needs to go to System.out.  The test is not for testing the console output.&lt;br/&gt;
I think that it would be sufficient just start with an alternate console, e.g. DerbyNet.out and all the console output can go there.  &lt;br/&gt;
I don&apos;t  understand why we need code to alter destination stream before and after shutting down network server&lt;/p&gt;
</comment>
                            <comment id="12367337" author="naka" created="Wed, 22 Feb 2006 22:12:55 +0000"  >&lt;p&gt;Description of the patch :&lt;br/&gt;
   Alter output before and after shutting down database and &lt;br/&gt;
   escape ShutDownException was printed to console.&lt;br/&gt;
   This modification was done in derbynet/dataSourcePermissions_net.java and derbynet/testSecMec.java which is subclass of former.&lt;/p&gt;

&lt;p&gt;Test:&lt;br/&gt;
   Execute derbynet/dataSourcePermissions_net.java and Shutting down exception was printed to altered log file.&lt;br/&gt;
   I did same test on derbynet/testSecMec.java. &lt;br/&gt;
   However ShutdownException was not recorded in both of log file and console.&lt;br/&gt;
   It seems that problematic ShutdownException was not happen.&lt;/p&gt;
</comment>
                            <comment id="12367494" author="naka" created="Thu, 23 Feb 2006 20:51:11 +0000"  >&lt;p&gt;Committed &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-273&quot; title=&quot;The derbynet/dataSourcePermissions_net.java test fails intermittently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-273&quot;&gt;&lt;del&gt;DERBY-273&lt;/del&gt;&lt;/a&gt;_2.patch&lt;/p&gt;

&lt;p&gt;Sending        java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/dataSourcePermissions_net.java&lt;br/&gt;
Sending        java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/testSecMec.java&lt;br/&gt;
Transmitting file data ..&lt;br/&gt;
Committed revision 380099.&lt;/p&gt;</comment>
                            <comment id="12551272" author="fuzzylogic" created="Thu, 13 Dec 2007 09:04:39 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12327439">DERBY-803</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12312741">DERBY-478</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12313454">DERBY-511</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12322999" name="DERBY-273.patch" size="1567" author="naka" created="Wed, 15 Feb 2006 23:20:14 +0000"/>
                            <attachment id="12323265" name="DERBY-273_2.patch" size="9023" author="naka" created="Wed, 22 Feb 2006 22:12:55 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12311736">DERBY-397</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 23 May 2005 05:58:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21870</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0vxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38992</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>