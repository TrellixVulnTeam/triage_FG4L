<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:34:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6283/DERBY-6283.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6283] indexStat daemon processing tables over and over even when there are no changes in the tables in soft upgraded database.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6283</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt; currently requires hard upgrade.  A soft upgrade database with an orphaned stat row, that can be caused by something like &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5681&quot; title=&quot;When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5681&quot;&gt;&lt;del&gt;DERBY-5681&lt;/del&gt;&lt;/a&gt;, will cause DERBY to spin eating up 100% of a cpu and possibly all the disk bandwith of the disk where the database is located.&lt;/p&gt;

&lt;p&gt;We should implement a fix that can be applied to soft upgraded databases if at all possible.&lt;/p&gt;

&lt;p&gt;In soft upgraded databases we can no use the work around of dropping the statistics as it is not available&lt;br/&gt;
to soft upgraded db&apos;s with version &amp;lt; 10.9.  The only current workaround is to disable background stats&lt;br/&gt;
completely.  Dropping and recreating the suspect table may also work.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12655383">DERBY-6283</key>
            <summary>indexStat daemon processing tables over and over even when there are no changes in the tables in soft upgraded database.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikem">Mike Matrigali</assignee>
                                    <reporter username="mikem">Mike Matrigali</reporter>
                        <labels>
                            <label>derby_triage10_11</label>
                    </labels>
                <created>Fri, 28 Jun 2013 17:54:38 +0100</created>
                <updated>Wed, 21 Jan 2015 00:23:14 +0000</updated>
                            <resolved>Mon, 4 Nov 2013 21:34:14 +0000</resolved>
                                    <version>10.8.3.3</version>
                    <version>10.9.2.2</version>
                    <version>10.10.2.0</version>
                    <version>10.11.1.1</version>
                                    <fixVersion>10.8.3.3</fixVersion>
                    <fixVersion>10.9.2.2</fixVersion>
                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13695563" author="mikem" created="Fri, 28 Jun 2013 17:57:18 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt; fixes this issue for hard upgraded databases, but not for soft upgraded dbs.&lt;/p&gt;</comment>
                            <comment id="13695565" author="mikem" created="Fri, 28 Jun 2013 18:00:34 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt; handled &quot;orphaned&quot; stat entries as the first type of disposable stat.  &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3790&quot; title=&quot;Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3790&quot;&gt;&lt;del&gt;DERBY-3790&lt;/del&gt;&lt;/a&gt; added a second kind of disposable stat, those with a single column and unique key.  I believe some of soft vs hard logic really applies to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3790&quot; title=&quot;Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3790&quot;&gt;&lt;del&gt;DERBY-3790&lt;/del&gt;&lt;/a&gt; and should not apply to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13695575" author="mikem" created="Fri, 28 Jun 2013 18:17:34 +0100"  >&lt;p&gt;Would like to get consensus on the following:&lt;br/&gt;
1) should we always drop orphaned stats, even in soft upgraded databases (I believe yes)&lt;br/&gt;
2) should we not drop orphan stats, if the keep disposable stats flag is set (I can see arguments both ways)&lt;/p&gt;</comment>
                            <comment id="13695626" author="kmarsden" created="Fri, 28 Jun 2013 19:21:07 +0100"  >&lt;p&gt;I think the orphan stats should always be removed in soft upgrade and with the flag. It is cleanup from a bug that can cause pretty serious consequences. I can&apos;t imagine why anyone would want them. The flag to me seems more relevant to the second kind of disposable stat in case something went wrong, &lt;/p&gt;</comment>
                            <comment id="13705918" author="mikem" created="Thu, 11 Jul 2013 16:34:16 +0100"  >&lt;p&gt;This patch makes the system always delete orphaned stats,&lt;br/&gt;
even in soft upgrade mode.&lt;/p&gt;

&lt;p&gt;Running full set of tests now on this patch.  A previous patch with the same code changes passed all tests except upgrade tests.  just running the upgrade tests passed also.  I think I have fixed these by changes to the test to make it understand&lt;br/&gt;
that orphaned stats are not deleted in soft upgrade. &lt;/p&gt;</comment>
                            <comment id="13706076" author="jira-bot" created="Thu, 11 Jul 2013 19:26:04 +0100"  >&lt;p&gt;Commit 1502319 from mikem@apache.org&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1502319&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1502319&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6283&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables in soft upgraded database.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6283&quot;&gt;&lt;del&gt;DERBY-6283&lt;/del&gt;&lt;/a&gt; indexStat daemon processing tables over and over even when there are no changes in the tables in soft upgraded database.&lt;/p&gt;

&lt;p&gt;Changed system to always drop orphaned stats during update statistics call.  &lt;/p&gt;

&lt;p&gt;Without this change soft upgraded systems running on 10.8 or higher derby &lt;br/&gt;
software, that had an orphaned statistic would spin forever in the index &lt;br/&gt;
stat daemon due to the same problem fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt; for hard &lt;br/&gt;
upgraded databases.&lt;/p&gt;</comment>
                            <comment id="13706079" author="mikem" created="Thu, 11 Jul 2013 19:27:35 +0100"  >&lt;p&gt;all tests passed for posted diff, and I have committed fix to trunk.  If anyone has time to review and has comments, I will address those in a subsequent checkin.&lt;br/&gt;
I plan to backport this change to 10.10, 10.9 and 10.8.&lt;/p&gt;</comment>
                            <comment id="13706351" author="kmarsden" created="Thu, 11 Jul 2013 23:27:35 +0100"  >&lt;p&gt;Thanks Mike, I verified the trunk fix with a 10.3 user database that had disposable stats.  The repro does repeated selects on the problematic table. Without the fix and soft upgrade, the rows did not get dropped and the index stat daemon repeatedly invoked. With the fix, the rows were deleted and after updating the stats the first time index stat daemon did not invoke again.&lt;/p&gt;</comment>
                            <comment id="13707437" author="jira-bot" created="Fri, 12 Jul 2013 22:59:43 +0100"  >&lt;p&gt;Commit 1502706 from mikem@apache.org&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1502706&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1502706&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6283&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables in soft upgraded database.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6283&quot;&gt;&lt;del&gt;DERBY-6283&lt;/del&gt;&lt;/a&gt; indexStat daemon processing tables over and over even when there are no changes in the tables in soft upgraded database.&lt;/p&gt;

&lt;p&gt;backported change #1502319 from trunk to 10.10, some manual merging was &lt;br/&gt;
required.&lt;/p&gt;

&lt;p&gt;Changed system to always drop orphaned stats during update statistics call.&lt;/p&gt;

&lt;p&gt;Without this change soft upgraded systems running on 10.8 or higher derby&lt;br/&gt;
software, that had an orphaned statistic would spin forever in the index&lt;br/&gt;
stat daemon due to the same problem fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt; for hard&lt;br/&gt;
upgraded databases.&lt;/p&gt;</comment>
                            <comment id="13707946" author="mamtas" created="Sun, 14 Jul 2013 05:17:40 +0100"  >&lt;p&gt;Mike, I reviewed the patch and here is my understanding of the patch&lt;br/&gt;
1)We will pick up single-column unique indexes stats(this is the existing behavior and not touched by this jira) for disposing &lt;br/&gt;
   a)if we are dealing with a 10.9 or higher version db and &lt;br/&gt;
   b)if Property.STORAGE_AUTO_INDEX_STATS_DEBUG_KEEP_DISPOSABLE_STATS is set to FALSE or not set at all&lt;br/&gt;
2)we will dispose off all the stats which are not attached to any indexes for the given conglomerate(this is the new behavior with this jira) irrespective of what happens with single-column unique index stats&lt;/p&gt;

&lt;p&gt;Just two little nit-picks on the patch and an existing comment&lt;br/&gt;
1)Did you mean to write more in the comment below? It looks unfinished&lt;br/&gt;
            //  This loop looks for statistic entries to delete.  It deletes&lt;br/&gt;
            //  those entries that don&apos;t have a matching conglomerate in the&lt;br/&gt;
2)Also, does this existing comment still make sense? The above loop will include single column unique index if we are dealing with 10.9 and higher db and if we are not being asked to keep the stats for single column unique index through Property.STORAGE_AUTO_INDEX_STATS_DEBUG_KEEP_DISPOSABLE_STATS flag.&lt;br/&gt;
        // Note that the algorithm would drop valid statistics entries if&lt;br/&gt;
        // working on a subset of the table conglomerates/indexes.&lt;br/&gt;
        // The above loop has populated &quot;cds&quot; with only existing indexes that&lt;br/&gt;
        // are not single column unique.&lt;/p&gt;</comment>
                            <comment id="13714076" author="jira-bot" created="Fri, 19 Jul 2013 22:09:02 +0100"  >&lt;p&gt;Commit 1505021 from mikem@apache.org in branch &apos;code/branches/10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1505021&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1505021&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6283&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables in soft upgraded database.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6283&quot;&gt;&lt;del&gt;DERBY-6283&lt;/del&gt;&lt;/a&gt; indexStat daemon processing tables over and over even when there are&lt;br/&gt;
no changes in the tables in soft upgraded database.&lt;/p&gt;

&lt;p&gt;backported change #1502319 from trunk to 10.8, some manual merging was&lt;br/&gt;
required.&lt;/p&gt;

&lt;p&gt;Changed system to always drop orphaned stats during update statistics call.&lt;/p&gt;

&lt;p&gt;Without this change soft upgraded systems running on 10.8 or higher derby&lt;br/&gt;
software, that had an orphaned statistic would spin forever in the index&lt;br/&gt;
stat daemon due to the same problem fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt; for hard&lt;br/&gt;
upgraded databases.&lt;/p&gt;</comment>
                            <comment id="13714166" author="jira-bot" created="Fri, 19 Jul 2013 23:25:45 +0100"  >&lt;p&gt;Commit 1505054 from mikem@apache.org in branch &apos;code/branches/10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1505054&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1505054&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6283&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables in soft upgraded database.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6283&quot;&gt;&lt;del&gt;DERBY-6283&lt;/del&gt;&lt;/a&gt; indexStat daemon processing tables over and over even when there are&lt;br/&gt;
no changes in the tables in soft upgraded database.&lt;/p&gt;

&lt;p&gt;backported change #1502319 from trunk to 10.8, some manual merging was&lt;br/&gt;
required.&lt;/p&gt;

&lt;p&gt;Changed system to always drop orphaned stats during update statistics call.&lt;/p&gt;

&lt;p&gt;Without this change soft upgraded systems running on 10.8 or higher derby&lt;br/&gt;
software, that had an orphaned statistic would spin forever in the index&lt;br/&gt;
stat daemon due to the same problem fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt; for hard&lt;br/&gt;
upgraded databases.&lt;/p&gt;</comment>
                            <comment id="13718586" author="mikem" created="Wed, 24 Jul 2013 18:10:31 +0100"  >&lt;p&gt;fixed in trunk, and backported to 10.10, 10.9, and 10.8.&lt;/p&gt;</comment>
                            <comment id="13736878" author="kmarsden" created="Mon, 12 Aug 2013 15:00:01 +0100"  >&lt;p&gt;Can this issue be resolved?  Looks like it was fixed and backported through 10.8.&lt;/p&gt;
</comment>
                            <comment id="13800146" author="kmarsden" created="Sun, 20 Oct 2013 15:59:58 +0100"  >&lt;p&gt;Mike, can this issue be resolved? Looks like it was fixed and backported through 10.8.&lt;/p&gt;</comment>
                            <comment id="14284766" author="myrna" created="Wed, 21 Jan 2015 00:23:14 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12548851">DERBY-5680</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12548973">DERBY-5681</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12400684">DERBY-3790</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12591859" name="derby-6283.diff" size="13055" author="mikem" created="Thu, 11 Jul 2013 16:34:16 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10362"><![CDATA[Performance]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 28 Jun 2013 18:21:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335658</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzfqpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335982</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>