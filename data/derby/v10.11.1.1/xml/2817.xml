<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:56 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2817/DERBY-2817.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2817] Error messages for deadlocks contain less information than in 10.2</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2817</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In 10.2, an error message for a deadlock would look like this:&lt;/p&gt;

&lt;p&gt;ERROR 40001: A lock could not be obtained due to a deadlock, cycle of locks and waiters is:&lt;br/&gt;
Lock : ROW, T, (1,8)&lt;br/&gt;
  Waiting XID : &lt;/p&gt;
{235, S}
&lt;p&gt; , APP, select * from t where id = 2&lt;br/&gt;
  Granted XID : &lt;/p&gt;
{238, X}
&lt;p&gt; &lt;br/&gt;
Lock : ROW, T, (1,7)&lt;br/&gt;
  Waiting XID : &lt;/p&gt;
{238, S}
&lt;p&gt; , APP, select * from t where id = 1&lt;br/&gt;
  Granted XID : &lt;/p&gt;
{235, X}
&lt;p&gt; &lt;br/&gt;
. The selected victim is XID : 235.&lt;/p&gt;

&lt;p&gt;On trunk, the same deadlock would be reported as&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: A lock could not be obtained due to a deadlock, cycle of locks and waiters is:&lt;br/&gt;
Lock : ROW, T, (1,8)&lt;br/&gt;
  Waiting XID : &lt;/p&gt;
{org.apache.derby.impl.services.locks.LockSpace@94884d, S}
&lt;p&gt; &lt;br/&gt;
  Granted XID : &lt;/p&gt;
{org.apache.derby.impl.services.locks.LockSpace@da6bf4, X}
&lt;p&gt; &lt;br/&gt;
Lock : ROW, T, (1,7)&lt;br/&gt;
  Waiting XID : &lt;/p&gt;
{org.apache.derby.impl.services.locks.LockSpace@da6bf4, S}
&lt;p&gt; &lt;br/&gt;
  Granted XID : &lt;/p&gt;
{org.apache.derby.impl.services.locks.LockSpace@94884d, X}
&lt;p&gt; &lt;br/&gt;
. The selected victim is XID : org.apache.derby.impl.services.locks.LockSpace@94884d.&lt;/p&gt;

&lt;p&gt;That is, the transaction id and the failing statement are not shown.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12371619">DERBY-2817</key>
            <summary>Error messages for deadlocks contain less information than in 10.2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Jun 2007 12:34:14 +0100</created>
                <updated>Tue, 30 Jun 2009 16:55:40 +0100</updated>
                            <resolved>Fri, 15 Jun 2007 15:00:36 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12504677" author="knutanders" created="Thu, 14 Jun 2007 13:10:57 +0100"  >&lt;p&gt;The attached patch makes trunk print the same deadlock messages as 10.2. I haven&apos;t run any of the regression tests yet, but I plan to do so and commit the fix for 10.3.&lt;/p&gt;</comment>
                            <comment id="12504826" author="mikem" created="Thu, 14 Jun 2007 18:06:21 +0100"  >&lt;p&gt;Good catch, I think fix for this should go into 10.3 &amp;#8211; this is critical for supporting customers who get these errors (actually most often customers can help themselves given this info).  &lt;/p&gt;

&lt;p&gt;Has anyone checked the error for a lock timeout where we print the entire lock list.  &lt;/p&gt;

&lt;p&gt;Also has anyone written a junit test to look at actual text of error message, I agree in most cases that is a bad idea, but some test that verifies the above&lt;br/&gt;
information seems like we won&apos;t miss this kind of bug.  Unfortunately it is not straight forward as the message includes some transactions id&apos;s and I think there is also a problem in that the order of locks is JVM specific.&lt;/p&gt;</comment>
                            <comment id="12504922" author="knutanders" created="Thu, 14 Jun 2007 22:20:05 +0100"  >&lt;p&gt;Committed deadlock.diff with revision 547408.&lt;br/&gt;
I will also check the timeouts which dump all locks and see if I can write a test which verifies that the information is present.&lt;/p&gt;</comment>
                            <comment id="12505141" author="knutanders" created="Fri, 15 Jun 2007 11:42:29 +0100"  >&lt;p&gt;The lock dump looks OK:&lt;/p&gt;

&lt;p&gt;java.sql.SQLTransactionRollbackException: A lock could not be obtained within the time requested.  The lockTable dump is: &lt;br/&gt;
2007-06-15 10:41:29.037 GMT&lt;br/&gt;
XID       |TYPE         |MODE|LOCKCOUNT|LOCKNAME                                                                        |STATE|TABLETYPE / LOCKOBJ                   |INDEXNAME / CONTAINER_ID / (MODE for LATCH only)  |TABLENAME / CONGLOM_ID                |&lt;br/&gt;
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;The following row is the victim ***&lt;br/&gt;
org.apache|ROW          |S   |0        |(1,7)                                                                           |WAIT |T                                     |NULL                                              |T                                     |&lt;/li&gt;
			&lt;li&gt;The above row is the victim ***&lt;br/&gt;
org.apache|ROW          |S   |1        |(1,8)                                                                           |GRANT|T                                     |NULL                                              |T                                     |&lt;br/&gt;
org.apache|ROW          |S   |1        |(1,1)                                                                           |GRANT|T                                     |SQL070615124121720                                |T                                     |&lt;br/&gt;
org.apache|ROW          |S   |1        |(1,1)                                                                           |GRANT|T                                     |SQL070615124121720                                |T                                     |&lt;br/&gt;
org.apache|TABLE        |IX  |2        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     |&lt;br/&gt;
org.apache|TABLE        |IS  |1        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     |&lt;br/&gt;
org.apache|TABLE        |IS  |1        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     |&lt;br/&gt;
org.apache|ROW          |X   |3        |(1,7)                                                                           |GRANT|T                                     |NULL                                              |T                                     |&lt;br/&gt;
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12505144" author="knutanders" created="Fri, 15 Jun 2007 11:46:08 +0100"  >&lt;p&gt;Sorry, I was too quick in my previous comment. The lock table dump does not look OK.&lt;/p&gt;</comment>
                            <comment id="12505160" author="knutanders" created="Fri, 15 Jun 2007 12:26:13 +0100"  >&lt;p&gt;SYSCS_DIAG.LOCK_TABLE shows the XID correctly.&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select * from syscs_diag.lock_table;&lt;br/&gt;
XID            |TYPE |MODE|TABLENAME                                                                                                                       |LOCKNAME            |STATE|TABLETYPE|LOCK&amp;amp;|INDEXNAME                                                                                                                       &lt;br/&gt;
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;br/&gt;
180            |TABLE|IX  |T                                                                                                                               |Tablelock           |GRANT|T        |2    |NULL                                                                                                                            &lt;br/&gt;
180            |ROW  |X   |T                                                                                                                               |(1,7)               |GRANT|T        |3    |NULL                                                                                                                            &lt;/p&gt;

&lt;p&gt;2 rows selected&lt;/p&gt;</comment>
                            <comment id="12505162" author="knutanders" created="Fri, 15 Jun 2007 12:38:33 +0100"  >&lt;p&gt;Attached patch (timeout.diff) makes the error message that is printed on lock timeout with derby.locks.deadlockTrace=true contain the transaction id instead of the class name of the compatibility space object. Example:&lt;/p&gt;

&lt;p&gt;java.sql.SQLTransactionRollbackException: A lock could not be obtained within the time requested.  The lockTable dump is: &lt;br/&gt;
2007-06-15 11:34:06.748 GMT&lt;br/&gt;
XID       |TYPE         |MODE|LOCKCOUNT|LOCKNAME                                                                        |STATE|TABLETYPE / LOCKOBJ                   |INDEXNAME / CONTAINER_ID / (MODE for LATCH only)  |TABLENAME / CONGLOM_ID                |&lt;br/&gt;
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;The following row is the victim ***&lt;br/&gt;
174       |ROW          |S   |0        |(1,7)                                                                           |WAIT |T                                     |NULL                                              |T                                     |&lt;/li&gt;
			&lt;li&gt;The above row is the victim ***&lt;br/&gt;
171       |ROW          |S   |1        |(1,8)                                                                           |GRANT|T                                     |NULL                                              |T                                     |&lt;br/&gt;
174       |ROW          |S   |1        |(1,1)                                                                           |GRANT|T                                     |SQL070615133359510                                |T                                     |&lt;br/&gt;
171       |ROW          |S   |1        |(1,1)                                                                           |GRANT|T                                     |SQL070615133359510                                |T                                     |&lt;br/&gt;
171       |TABLE        |IX  |2        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     |&lt;br/&gt;
174       |TABLE        |IS  |1        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     |&lt;br/&gt;
171       |TABLE        |IS  |1        |Tablelock                                                                       |GRANT|T                                     |NULL                                              |T                                     |&lt;br/&gt;
171       |ROW          |X   |3        |(1,7)                                                                           |GRANT|T                                     |NULL                                              |T                                     |&lt;br/&gt;
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12505164" author="knutanders" created="Fri, 15 Jun 2007 12:41:34 +0100"  >&lt;p&gt;Committed timeout.diff with 547640.&lt;/p&gt;</comment>
                            <comment id="12505241" author="knutanders" created="Fri, 15 Jun 2007 15:00:36 +0100"  >&lt;p&gt;I logged a separate issue for the test so that this one can be closed for 10.3.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12371760">DERBY-2829</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12359716" name="deadlock.diff" size="840" author="knutanders" created="Thu, 14 Jun 2007 13:10:57 +0100"/>
                            <attachment id="12359842" name="timeout.diff" size="956" author="knutanders" created="Fri, 15 Jun 2007 12:38:33 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 14 Jun 2007 17:06:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23267</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0uzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38839</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>