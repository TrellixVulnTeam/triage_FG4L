<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:15:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5278/DERBY-5278.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5278] AssertionFailedError in IndexSplitDeadlockTest.testBTreeForwardScan_fetchRows_resumeAfterWait_unique_split()</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5278</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;This failure has been seen occasionally (three times so far) on Java 1.4.2_30 on Linux. Examples:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.4/testing/testlog/lin/1095760-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.4/testing/testlog/lin/1095760-suitesAll_diff.txt&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.4/testing/testlog/lin/1102361-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.4/testing/testlog/lin/1102361-suitesAll_diff.txt&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.4/testing/testlog/lin/1133954-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.4/testing/testlog/lin/1133954-suitesAll_diff.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1) testBTreeForwardScan_fetchRows_resumeAfterWait_unique_split(org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest)junit.framework.AssertionFailedError: expected:&amp;lt;0&amp;gt; but was:&amp;lt;-299&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest.testBTreeForwardScan_fetchRows_resumeAfterWait_unique_split(IndexSplitDeadlockTest.java:397)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;/p&gt;</description>
                <environment>java version &amp;quot;1.4.2_30&amp;quot;&lt;br/&gt;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.4.2_30-b04)&lt;br/&gt;
Java HotSpot(TM) Client VM (build 1.4.2_30-b04, mixed mode)&lt;br/&gt;
&lt;br/&gt;
Red Hat Enterprise Linux Server release 5.1 (Tikanga)</environment>
        <key id="12510436">DERBY-5278</key>
            <summary>AssertionFailedError in IndexSplitDeadlockTest.testBTreeForwardScan_fetchRows_resumeAfterWait_unique_split()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jun 2011 14:04:28 +0100</created>
                <updated>Tue, 25 Oct 2011 18:09:25 +0100</updated>
                            <resolved>Fri, 17 Jun 2011 12:25:00 +0100</resolved>
                                    <version>10.8.1.2</version>
                    <version>10.9.1.0</version>
                                    <fixVersion>10.8.2.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13050317" author="knutanders" created="Thu, 16 Jun 2011 10:41:55 +0100"  >&lt;p&gt;The test case that fails runs in two threads that need to do the operations in a specific order. Currently, the threads use Thread.sleep() to ensure the ordering. This may break if the timing isn&apos;t quite what we expect.&lt;/p&gt;

&lt;p&gt;It looks like the assert failure happens because the helper thread has started inserting new rows into the table too early. It should wait until the main thread has started an index scan and got blocked on a lock that the helper thread is holding.&lt;/p&gt;

&lt;p&gt;The attached patch (sync.diff) makes the threads synchronize using an object on which they call wait/notify to tell the other thread that they&apos;re in the expected state. This should be more reliable than Thread.sleep(), and it should also make the test run slightly faster in the common case, since the sleep time is probably higher than needed on most machines.&lt;/p&gt;

&lt;p&gt;Now the helper thread will know that the main thread is ready to start the index scan before it goes ahead inserting more rows. And the main thread knows that the helper thread has obtained the required lock before it starts the index scan. There&apos;s still one sleep() call in the test case to ensure that the index scan has actually started before the helper thread begins inserting, but since both threads are in a well-known state when sleep() is called, it should be much more likely to work as intended.&lt;/p&gt;</comment>
                            <comment id="13050995" author="knutanders" created="Fri, 17 Jun 2011 12:25:00 +0100"  >&lt;p&gt;Committed revision 1136844.&lt;/p&gt;</comment>
                            <comment id="13052563" author="knutanders" created="Tue, 21 Jun 2011 14:35:52 +0100"  >&lt;p&gt;Merged to 10.8. Committed revision 1138003.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12525358">DERBY-5440</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12482768" name="sync.diff" size="3519" author="knutanders" created="Thu, 16 Jun 2011 10:41:55 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24753</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0f1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36257</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>