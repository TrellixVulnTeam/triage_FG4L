<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5336/DERBY-5336.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5336] Repeated database creation causes OutOfMemoryError</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5336</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Repeatedly creating, querying, updating, and shutting down a database or databases eventually causes OutOfMemoryError.&lt;/p&gt;

&lt;p&gt;Java source reproducing the problem is attached.&lt;/p&gt;</description>
                <environment>Windows 7 64-bit, jdk1.6.0_26</environment>
        <key id="12514127">DERBY-5336</key>
            <summary>Repeated database creation causes OutOfMemoryError</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="psiolent">Aja Walker</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Jul 2011 22:23:00 +0100</created>
                <updated>Mon, 17 Jun 2013 10:19:33 +0100</updated>
                            <resolved>Tue, 23 Aug 2011 10:23:49 +0100</resolved>
                                    <version>10.8.1.2</version>
                                    <fixVersion>10.8.2.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13065544" author="psiolent" created="Thu, 14 Jul 2011 22:23:39 +0100"  >&lt;p&gt;Attached source code for reproducing the error.&lt;/p&gt;</comment>
                            <comment id="13068333" author="knutanders" created="Wed, 20 Jul 2011 13:42:59 +0100"  >&lt;p&gt;I&apos;m able to reproduce the OOME on trunk. It looks like the objects belonging to the stopped database instances are still referenced from the index statistics update daemon and cannot be freed.&lt;/p&gt;

&lt;p&gt;Disabling automatic update of index statistics seems to work around the problem. If I run the repro with -Dderby.storage.indexStats.auto=false, I don&apos;t see the OOME.&lt;/p&gt;

&lt;p&gt;I&apos;m marking this bug as a regression, since the OOME is not seen with 10.7.1.1.&lt;/p&gt;</comment>
                            <comment id="13081568" author="kristwaa" created="Tue, 9 Aug 2011 12:13:27 +0100"  >&lt;p&gt;Seems the context used by the istat deamon isn&apos;t removed when the database is shut down.&lt;br/&gt;
I&apos;m running regression tests on a possible fix.&lt;/p&gt;

&lt;p&gt;On a related note, I&apos;m wondering if the context class loader should be set to null for the istat daemon thread?&lt;/p&gt;</comment>
                            <comment id="13081581" author="kristwaa" created="Tue, 9 Aug 2011 12:54:31 +0100"  >&lt;p&gt;Aja,&lt;/p&gt;

&lt;p&gt;I see that you didn&apos;t tick the grant license radio button when uploading the repro.&lt;br/&gt;
Do you mind doing that, such that I can copy most of your repro code to add a regression test for this bug?&lt;/p&gt;

&lt;p&gt;Of course, you can also modify the repro to fit the Derby test framework yourself if you want to &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; (the test should go into the low memory suite)&lt;/p&gt;</comment>
                            <comment id="13081583" author="kristwaa" created="Tue, 9 Aug 2011 12:59:54 +0100"  >&lt;p&gt;Attached patch 1a, which removes the istat daemon context by invoking the cleanup code in the system context.&lt;/p&gt;

&lt;p&gt;Tests passed on Linux and Solaris 11 using Java 6.&lt;br/&gt;
Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="13081855" author="psiolent" created="Tue, 9 Aug 2011 20:14:55 +0100"  >&lt;p&gt;Attaching the repro source with the license box ticked this time.&lt;/p&gt;</comment>
                            <comment id="13082250" author="kristwaa" created="Wed, 10 Aug 2011 10:28:15 +0100"  >&lt;p&gt;Thanks, Aja.&lt;/p&gt;

&lt;p&gt;Attaching patch 2a, where I copied Aja&apos;s repro and modified it to fit with the Derby test framework (JUnit based):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;switched from DriverManager to DataSource&lt;/li&gt;
	&lt;li&gt;replaced commons io call to delete directory&lt;/li&gt;
	&lt;li&gt;added an extra sanity check&lt;/li&gt;
	&lt;li&gt;added test as testRepeatedDatabaseCreationWithAutoStats in memory.MemoryLeakFixesTest. Should be run with &apos;ant junit-lowmem&apos; (after building Derby), which uses a 16 MB heap.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The test failed when run without the fix, it succeeded with patch 1a applied.&lt;br/&gt;
Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="13089364" author="kristwaa" created="Tue, 23 Aug 2011 10:23:49 +0100"  >&lt;p&gt;Committed patches 1a and 2a to trunk with revision 1160593.&lt;br/&gt;
Backported to 10.8 with revision 1160595.&lt;/p&gt;

&lt;p&gt;I don&apos;t expect more work on this issue.&lt;/p&gt;</comment>
                            <comment id="13108871" author="kmarsden" created="Tue, 20 Sep 2011 19:05:06 +0100"  >&lt;p&gt;The test  testRepeadedDatabaseCreationWithAutoStats has a lot of verbosity with -Dderby.test.trace=true&lt;/p&gt;

&lt;p&gt;testRepeatedDatabaseCreationWithAutoStats &amp;#8211; 0&lt;br/&gt;
&amp;#8211; 1&lt;br/&gt;
&amp;#8211; 2&lt;br/&gt;
&amp;#8211; 3&lt;br/&gt;
&amp;#8211; 4&lt;br/&gt;
&amp;#8211; 5&lt;br/&gt;
&amp;#8211; 6&lt;br/&gt;
&amp;#8211; 7&lt;br/&gt;
&amp;#8211; 8&lt;br/&gt;
&amp;#8211; 9&lt;br/&gt;
&amp;#8211; 10&lt;br/&gt;
&amp;#8211; 11&lt;br/&gt;
&amp;#8211; 12&lt;br/&gt;
&amp;#8211; 13&lt;/p&gt;

&lt;p&gt;Should this traceit call be prntln  so it just prnts with -Dderby.tests.debug=true ?&lt;br/&gt;
       while (iter &amp;lt; 50) {&lt;/p&gt;

&lt;p&gt;            traceit(&quot;-- &quot; + iter++);&lt;/p&gt;

</comment>
                            <comment id="13109511" author="kristwaa" created="Wed, 21 Sep 2011 14:57:26 +0100"  >&lt;p&gt;Yes. I did so with revision 1173647 (trunk only so far).&lt;/p&gt;

&lt;p&gt;I think it may be wise to also reduce the number of iterations, as the test takes a while to complete.&lt;/p&gt;</comment>
                            <comment id="13113138" author="myrna" created="Fri, 23 Sep 2011 04:40:31 +0100"  >&lt;p&gt;Did you plan to backport this latest fix to the 10.8 branch also? If not I&apos;ll do it...&lt;/p&gt;</comment>
                            <comment id="13113235" author="kristwaa" created="Fri, 23 Sep 2011 09:00:32 +0100"  >&lt;p&gt;Thanks for noticing, Myrna.&lt;br/&gt;
Backported to 10.8 with revision 1174576.&lt;/p&gt;</comment>
                            <comment id="13685281" author="knutanders" created="Mon, 17 Jun 2013 10:19:33 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12526018">DERBY-5447</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12523171">DERBY-5412</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12527746">DERBY-5472</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12486511" name="DerbyOutOfMemoryErrorRepro.java" size="2758" author="psiolent" created="Thu, 14 Jul 2011 22:23:39 +0100"/>
                            <attachment id="12489873" name="LicensedRepro.java" size="2743" author="psiolent" created="Tue, 9 Aug 2011 20:14:55 +0100"/>
                            <attachment id="12489834" name="derby-5336-1a-remove_context_on_stop.diff" size="817" author="kristwaa" created="Tue, 9 Aug 2011 12:59:54 +0100"/>
                            <attachment id="12489958" name="derby-5336-2a-regression_test.diff" size="4866" author="kristwaa" created="Wed, 10 Aug 2011 10:28:15 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10365"><![CDATA[Crash]]></customfieldvalue>
    <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 20 Jul 2011 12:42:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24778</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    <customfieldvalue key="10427"><![CDATA[Workaround attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0esn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36215</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>