<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:24:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4403/DERBY-4403.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4403] Assert failure (sane) or NullPointerException (insane) when attempting to GROUP BY expression containing scalar subquery</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4403</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The following is not caught by the error checking (or maybe it is supposed to work?):&lt;/p&gt;

&lt;p&gt;select sum&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from t group by j + (select j from t where i=1)&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: Java exception: &apos;ASSERT FAILED dummySubqueryList.size() is expected to be 0: org.apache.derby.shared.common.sanity.AssertFailure&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)&lt;br/&gt;
	... 16 more&lt;br/&gt;
Caused by: org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED dummySubqueryList.size() is expected to be 0&lt;br/&gt;
	at org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:120)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.GroupByList.bindGroupByColumns(GroupByList.java:220)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.SelectNode.bindExpressions(SelectNode.java:629)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bindExpressions(DMLStatementNode.java:227)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.DMLStatementNode.bind(DMLStatementNode.java:140)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.CursorNode.bindStatement(CursorNode.java:249)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:319)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:824)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:606)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12437666">DERBY-4403</key>
            <summary>Assert failure (sane) or NullPointerException (insane) when attempting to GROUP BY expression containing scalar subquery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                            <label>derby_triage10_5_2</label>
                    </labels>
                <created>Fri, 9 Oct 2009 02:15:23 +0100</created>
                <updated>Mon, 6 Oct 2014 18:21:33 +0100</updated>
                            <resolved>Thu, 2 Oct 2014 19:04:09 +0100</resolved>
                                    <version>10.2.1.6</version>
                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                    <version>10.3.2.1</version>
                    <version>10.3.3.0</version>
                    <version>10.4.1.3</version>
                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                    <version>10.5.2.0</version>
                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                    <version>10.6.2.1</version>
                    <version>10.7.1.1</version>
                                    <fixVersion>10.10.2.1</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12981411" author="dagw" created="Thu, 13 Jan 2011 18:48:50 +0000"  >&lt;p&gt;In 10.0 and 10.1 I see this error message instead:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select sum&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from t group by j + (select j from t where i=1) ;&lt;br/&gt;
ERROR 42X01: Syntax error: Encountered &quot;+&quot; at line 1, column 33.&lt;/p&gt;</comment>
                            <comment id="13922290" author="knutanders" created="Thu, 6 Mar 2014 10:45:10 +0000"  >&lt;p&gt;With production jars, I see a NullPointerException instead:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ij&amp;gt; create table t(i int, j int);
0 rows inserted/updated/deleted
ij&amp;gt; insert into t values (1,2);
1 row inserted/updated/deleted
ij&amp;gt; select sum(i) from t group by j + (select j from t where i=1);
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The failing assert seems to predate &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-883&quot; title=&quot;Enhance GROUP BY clause to support expressions instead of just column references.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-883&quot;&gt;&lt;del&gt;DERBY-883&lt;/del&gt;&lt;/a&gt;, which added support for expressions in the GROUP BY list. I think it would make sense to disallow subqueries in the GROUP BY list and throw a syntax error. Expressions in GROUP BY is an extension to the SQL standard, and an equivalent, standard-compliant query could be expressed as a nested query, so I think it&apos;s not worth the trouble to enhance the non-standard syntax with subquery support.&lt;/p&gt;

&lt;p&gt;The portable equivalent of the the failing query would be something like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select sum(x) from (select i, j + (select j from t where i=1) from t) s(x,y) group by y
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Derby does seem to accept this variant.&lt;/p&gt;</comment>
                            <comment id="13922366" author="knutanders" created="Thu, 6 Mar 2014 11:51:28 +0000"  >&lt;p&gt;The attached patch makes the problematic query fail with a syntax error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ij&amp;gt; select sum(i) from t group by j + (select j from t where i=1);
ERROR 42Y26: Subqueries are not allowed in the GROUP BY list.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The new error message uses the same SQLState as the error message for aggregates in the GROUP BY list, since I didn&apos;t see any need to distinguish between those two conditions. The actual message is different, though.&lt;/p&gt;

&lt;p&gt;I&apos;m running regression tests on the patch.&lt;/p&gt;</comment>
                            <comment id="13922435" author="knutanders" created="Thu, 6 Mar 2014 12:39:09 +0000"  >&lt;p&gt;All tests passed.&lt;/p&gt;</comment>
                            <comment id="13923758" author="jira-bot" created="Fri, 7 Mar 2014 10:34:26 +0000"  >&lt;p&gt;Commit 1575226 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1575226&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1575226&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4403&quot; title=&quot;Assert failure (sane) or NullPointerException (insane) when attempting to GROUP BY expression containing scalar subquery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4403&quot;&gt;&lt;del&gt;DERBY-4403&lt;/del&gt;&lt;/a&gt;: Disallow subqueries in the GROUP BY list&lt;/p&gt;

&lt;p&gt;Queries that were grouped by subqueries used to fail with a&lt;br/&gt;
NullPointerException or an assert failure. Make them fail with a&lt;br/&gt;
proper syntax error instead.&lt;/p&gt;</comment>
                            <comment id="14147085" author="mikem" created="Thu, 25 Sep 2014 00:29:56 +0100"  >&lt;p&gt;temp assigning to myself for 10.10 backport.&lt;/p&gt;</comment>
                            <comment id="14148239" author="jira-bot" created="Thu, 25 Sep 2014 21:16:51 +0100"  >&lt;p&gt;Commit 1627645 from mikem@apache.org in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1627645&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1627645&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4403&quot; title=&quot;Assert failure (sane) or NullPointerException (insane) when attempting to GROUP BY expression containing scalar subquery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4403&quot;&gt;&lt;del&gt;DERBY-4403&lt;/del&gt;&lt;/a&gt;: Disallow subqueries in the GROUP BY list&lt;/p&gt;

&lt;p&gt;backporting change #1575226 from trunk to 10.10 branch.  merged clean.&lt;/p&gt;

&lt;p&gt;Queries that were grouped by subqueries used to fail with a&lt;br/&gt;
NullPointerException or an assert failure. Make them fail with a&lt;br/&gt;
proper syntax error instead.&lt;/p&gt;</comment>
                            <comment id="14156894" author="mikem" created="Thu, 2 Oct 2014 19:04:03 +0100"  >&lt;p&gt;backported to 10.10, reassigining original owner.  no plans at present to backport to other releases, but it could be if someone wanted to.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12746192">DERBY-6759</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12328186">DERBY-883</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12633102" name="d4403-1a.diff" size="4021" author="knutanders" created="Thu, 6 Mar 2014 11:51:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 6 Mar 2014 10:45:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24234</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ilz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36833</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>