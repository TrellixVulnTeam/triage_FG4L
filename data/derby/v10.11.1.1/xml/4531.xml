<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:11:09 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4531/DERBY-4531.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4531] Client setCharacterStream closes its Reader argument stream in finalizer</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4531</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The javadoc for PreparedStatement.setCharacterStream does not specify that the stream passed in will be closed, only that it will read to the number of characters specified.&lt;br/&gt;
For the embedded driver, the stream is not closed after execution; the client driver, however, will close the stream when the internal stream object EncodedInputStream is garbage collected, which can happen any time after the statement has been executed.&lt;br/&gt;
I am not sure this a bug vs. the JDBC specification, but it would be nice to harmonize client and embedded behavior on this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12454927">DERBY-4531</key>
            <summary>Client setCharacterStream closes its Reader argument stream in finalizer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                            <label>derby_backport_reject_10_6</label>
                    </labels>
                <created>Mon, 1 Feb 2010 15:07:12 +0000</created>
                <updated>Wed, 20 Feb 2013 16:45:16 +0000</updated>
                            <resolved>Tue, 15 Mar 2011 20:23:18 +0000</resolved>
                                    <version>10.2.1.6</version>
                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                    <version>10.3.2.1</version>
                    <version>10.3.3.0</version>
                    <version>10.4.1.3</version>
                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                    <version>10.5.2.0</version>
                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12828129" author="dagw" created="Mon, 1 Feb 2010 15:11:38 +0000"  >&lt;p&gt;The client driver does not similarly close an InputStream given as as argument to setBinaryStream.&lt;/p&gt;</comment>
                            <comment id="12828288" author="dagw" created="Mon, 1 Feb 2010 21:55:55 +0000"  >&lt;p&gt;This behavior was introduced in 10.2 with svn 414562, so marking&lt;br/&gt;
as regression until somebody convinces me this is not a bug &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12828294" author="dagw" created="Mon, 1 Feb 2010 22:05:53 +0000"  >&lt;p&gt;Derby will throw if the stream does not hold the exact amount of data specified in setCharacterStream, so one might argue that keeping the stream open doesn&apos;t accomplish much. Still, I think that since the API does not prescribe closing the stream, a driver should refrain from doing it.&lt;/p&gt;</comment>
                            <comment id="12828297" author="dagw" created="Mon, 1 Feb 2010 22:10:06 +0000"  >&lt;p&gt;Attaching a repro.&lt;/p&gt;</comment>
                            <comment id="12861792" author="kristwaa" created="Wed, 28 Apr 2010 13:47:08 +0100"  >&lt;p&gt;Attached patch 1a, which is a work-around for an intermittent test failure caused by the client driver closing the stream in the finalizer.&lt;/p&gt;

&lt;p&gt;Committed to trunk with revision 938972.&lt;br/&gt;
I plan to back-port this to the 10.6 branch.&lt;/p&gt;</comment>
                            <comment id="12861798" author="rhillegas" created="Wed, 28 Apr 2010 14:10:41 +0100"  >&lt;p&gt;Some additional discussion of this issue can be found on this email thread: &lt;a href=&quot;http://old.nabble.com/instability-in-StreamingColumnTest-tt28369553.html#a28369553&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://old.nabble.com/instability-in-StreamingColumnTest-tt28369553.html#a28369553&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12865970" author="dagw" created="Tue, 11 May 2010 00:01:46 +0100"  >&lt;p&gt;Uploading a patch that removes the finalizer close. Regrressions ran ok. I have asked Lance to comment on the JDBC semantics, and I intend to hold back commit until we agree that this change is the right way to go.&lt;br/&gt;
It does change behavior, so I mark it with release note needed.&lt;/p&gt;</comment>
                            <comment id="12881194" author="kristwaa" created="Tue, 22 Jun 2010 14:12:23 +0100"  >&lt;p&gt;Any feedback that will allow us to move forward on this issue yet?&lt;/p&gt;</comment>
                            <comment id="12881195" author="dagw" created="Tue, 22 Jun 2010 14:23:59 +0100"  >&lt;p&gt;No, not yet. If I don&apos;t get any, the community should decide what to do with this one. I am inclined to commit it (i.e. the driver should not close the stream).&lt;/p&gt;</comment>
                            <comment id="12899549" author="dagw" created="Tue, 17 Aug 2010 20:56:48 +0100"  >&lt;p&gt;Lance informs me that the spec is silent on this, but that the JDBC 3.0 book says: &lt;/p&gt;

&lt;p&gt;&quot;length - the number of bytes to be read from the stream &amp;amp; sent to the database.  Note that if the stream contains more or less bytes than are specified in length, an exception is thrown&quot;.&lt;/p&gt;

&lt;p&gt;If we want to go this way, we would need to change both drivers, increasing potential for breaking existing apps that supply too long streams.&lt;br/&gt;
Any thoughts on which way to go? Lance said he&apos;s check what other vendors do. &lt;/p&gt;</comment>
                            <comment id="12899643" author="dagw" created="Wed, 18 Aug 2010 00:05:59 +0100"  >&lt;p&gt;Apparently, there is no consensus among the vendors. I propose to commit the current patch for now to get alignment between the drivers. Then, if we later decide to move to the restrictive behavior if/when this is clarified in the spec, we could do it to both drivers.&lt;/p&gt;</comment>
                            <comment id="12899997" author="dagw" created="Wed, 18 Aug 2010 20:54:28 +0100"  >&lt;p&gt;Attaching a new rev of the patch which makes the client driver behave like the embedded driver in this respect: derby-4531b.&lt;/p&gt;

&lt;p&gt;It adds a regression test. At least on my box with Sun JDK 1.6.0_16, the new test fails for the client driver prior to the patch proper, but as always when explicitly calling gc, YMMV. With the full patch the test should work reliably in any case.&lt;/p&gt;

&lt;p&gt;Running full regressions.&lt;/p&gt;</comment>
                            <comment id="12900493" author="dagw" created="Thu, 19 Aug 2010 23:16:14 +0100"  >&lt;p&gt;Committed derby-4531b as svn 987331.&lt;/p&gt;</comment>
                            <comment id="12900497" author="dagw" created="Thu, 19 Aug 2010 23:23:24 +0100"  >&lt;p&gt;Since this patch removes the regression, I don&apos;t believe we require a release note, so unsetting that flag, and closing.&lt;/p&gt;</comment>
                            <comment id="13007145" author="kmarsden" created="Tue, 15 Mar 2011 20:22:57 +0000"  >&lt;p&gt;reopen to add derby_backport_reject label&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12633221">DERBY-6082</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12434439" name="Repro.java" size="14621" author="dagw" created="Mon, 1 Feb 2010 22:10:05 +0000"/>
                            <attachment id="12443078" name="derby-4531-1a-test_workaround.diff" size="2089" author="kristwaa" created="Wed, 28 Apr 2010 13:47:08 +0100"/>
                            <attachment id="12444156" name="derby-4531.diff" size="547" author="dagw" created="Tue, 11 May 2010 00:01:46 +0100"/>
                            <attachment id="12452443" name="derby-4531b.diff" size="3027" author="dagw" created="Wed, 18 Aug 2010 20:54:27 +0100"/>
                            <attachment id="12452444" name="derby-4531b.stat" size="161" author="dagw" created="Wed, 18 Aug 2010 20:54:28 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10363"><![CDATA[Embedded/Client difference]]></customfieldvalue>
    <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 28 Apr 2010 12:47:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24320</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0hdr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36634</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>