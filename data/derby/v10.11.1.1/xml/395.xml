<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:10:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-395/DERBY-395.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-395] Server-side &quot;trace on&quot; and &quot;trace off&quot; commands do not appear to be working correctly.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-395</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Documentation in the Server &amp;amp; Admin guide talks about a &quot;derby.drda.traceAll&quot; system property and two trace commands available from the NetworkServerControl API: &quot;trace on&quot; and &quot;trace off&quot;.   The &quot;trace on&quot; command is supposed to turn tracing on for all server sessions, unless a specific session number is passed in via the &quot;-s&quot; parameter.  Similarly, the &quot;trace off&quot; command is supposed to turn tracing off for all server sessions, unless a specific session number is passed in via the &quot;-s&quot; parameter.&lt;/p&gt;

&lt;p&gt;However, I&apos;ve noticed the following behavior, which appears to be incorrect.&lt;/p&gt;

&lt;p&gt;1) if the server is started with derby.drda.traceAll=true, then subsequent attempts to turn tracing off do not work.  For example:&lt;/p&gt;

&lt;p&gt;// Start the server with &apos;traceAll&apos; set to true.&lt;br/&gt;
&amp;gt; java -Dderby.drda.traceAll=true org.apache.derby.drda.NetworkServerControl start&lt;br/&gt;
Server is ready to accept connections on port 1527.&lt;/p&gt;

&lt;p&gt;// Try to turn tracing off.&lt;br/&gt;
&amp;gt; java org.apache.derby.drda.NetworkServerControl trace off&lt;br/&gt;
Trace turned off for all sessions.&lt;/p&gt;

&lt;p&gt;But then, despite the message saying that trace was turned off, tracing is still enabled for all connections thereafter: if I connect three more times, I will see a &apos;ServerX.trace&apos; file for each connection.&lt;/p&gt;

&lt;p&gt;2) If the server is started with derby.drda.traceAll=false, then attempts to turn tracing on &lt;em&gt;only&lt;/em&gt; affect the connection that enables tracing; tracing will NOT be done for any subsequent connections.  For ex:&lt;/p&gt;

&lt;p&gt;// Start the server with &apos;traceAll&apos; set to false (which is also the default)&lt;br/&gt;
&amp;gt; java -Dderby.drda.traceAll=false org.apache.derby.drda.NetworkServerControl start&lt;br/&gt;
Server is ready to accept connections on port 1527.&lt;/p&gt;

&lt;p&gt;// Turn tracing on.&lt;br/&gt;
&amp;gt; java org.apache.derby.drda.NetworkServerControl trace on&lt;br/&gt;
Trace turned on for all sessions.&lt;/p&gt;

&lt;p&gt;Now I see a &apos;ServerX.trace&apos; for the connection that was made to turn tracing on.  However, if I then connect three more times, I will &lt;em&gt;not&lt;/em&gt; see any &apos;ServerX.trace&apos; files for those connections.&lt;/p&gt;</description>
                <environment>Running Derby Network Server with either JCC or Derby client.</environment>
        <key id="12311724">DERBY-395</key>
            <summary>Server-side &quot;trace on&quot; and &quot;trace off&quot; commands do not appear to be working correctly.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Jun 2005 10:24:49 +0100</created>
                <updated>Wed, 24 May 2006 05:33:16 +0100</updated>
                            <resolved>Mon, 1 May 2006 01:05:09 +0100</resolved>
                                    <version>10.0.2.2</version>
                    <version>10.1.1.0</version>
                                    <fixVersion>10.1.3.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12364291" author="bryanpendleton" created="Sat, 28 Jan 2006 12:15:07 +0000"  >&lt;p&gt;I believe that the issue here is that ClientThread.java was mistakenly maintaining its own private cache of the values of the derby.drda.traceDirectory and derby.drda.traceAll settings. The NetworkServerControl commands are properly changing the master values in NetworkServerControlImpl, but since ClientThread.java never re-fetched the updated values, the updates didn&apos;t seem to &quot;take&quot;.&lt;/p&gt;

&lt;p&gt;I don&apos;t see any reason why ClientThread.java needs to maintain its own cache of these values, so I think the following change should do the trick. I&apos;ve successfully tested the bug scenarios using this change and they seem to work well; I&apos;m running derbyall just in case, though I don&apos;t think it touches any of these code paths. Assuming it runs clean, I&apos;ll attach the diff to this issue.&lt;/p&gt;

&lt;p&gt;Index: java/drda/org/apache/derby/impl/drda/ClientThread.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; java/drda/org/apache/derby/impl/drda/ClientThread.java      (revision 373059)&lt;br/&gt;
+++ java/drda/org/apache/derby/impl/drda/ClientThread.java      (working copy)&lt;br/&gt;
@@ -30,8 +30,6 @@&lt;br/&gt;
        ServerSocket serverSocket;&lt;br/&gt;
        private int timeSlice;&lt;br/&gt;
        private int connNum;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private String traceDir;&lt;/li&gt;
	&lt;li&gt;private boolean traceAll;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                ClientThread (NetworkServerControlImpl nsi, ServerSocket ss) &lt;/p&gt;
{

@@ -42,8 +40,6 @@
                        parent=nsi;
                        serverSocket=ss;
                        timeSlice=nsi.getTimeSlice();
-                       traceDir=parent.getTraceDirectory();
-                       traceAll=parent.getTraceAll();
                }

&lt;p&gt;                public void run()&lt;br/&gt;
@@ -88,7 +84,8 @@&lt;/p&gt;

&lt;p&gt;                                //create a new Session for this session&lt;br/&gt;
                                clientSession = new Session(connNum, clientSocket,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;traceDir, traceAll);&lt;br/&gt;
+                                       parent.getTraceDirectory(),&lt;br/&gt;
+                                       parent.getTraceAll());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                                //add to Session list&lt;br/&gt;
                                parent.addToSessionTable(new Integer(connNum), clientSession);&lt;/p&gt;</comment>
                            <comment id="12364318" author="bryanpendleton" created="Sun, 29 Jan 2006 01:58:46 +0000"  >&lt;p&gt;Attached is a proposed fix. derbyall passed. I put a small comment in the code. I didn&apos;t add any new tests, which is unfortunate, but I didn&apos;t have any brilliant inside about an easy way to add such tests. Testing with the server tracing is already somewhat of a PITA because the server tracing interacts poorly with things like the security manager. Suggestions for clean ways to add some tests here would be appreciated.&lt;/p&gt;

&lt;p&gt;This is a very low priority bug, but if a committer has some time to check it, that would be great. The repro instructions in the bug description are very clear; it&apos;s just a matter of verifying that you can reproduce the problem without the patch, then verifying that the patch resolves the problem for you.&lt;/p&gt;</comment>
                            <comment id="12364322" author="kmarsden" created="Sun, 29 Jan 2006 02:04:26 +0000"  >&lt;p&gt;Thanks Bryan,&lt;/p&gt;

&lt;p&gt;I&apos;ll look into committing this patch&lt;/p&gt;</comment>
                            <comment id="12364362" author="kmarsden" created="Sun, 29 Jan 2006 14:56:02 +0000"  >&lt;p&gt;Verified manually that bug ws fixed and checked in.&lt;/p&gt;

&lt;p&gt;Date: Sat Jan 28 21:54:06 2006&lt;br/&gt;
New Revision: 373291&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=373291&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=373291&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12377127" author="bryanpendleton" created="Sun, 30 Apr 2006 06:09:43 +0100"  >&lt;p&gt;Reopening to merge fix to 10.1&lt;/p&gt;</comment>
                            <comment id="12377170" author="bryanpendleton" created="Mon, 1 May 2006 01:05:09 +0100"  >&lt;p&gt;Merged the fix from the trunk to the 10.1 branch. The merge was clean and the testing was successful.&lt;/p&gt;

&lt;p&gt;The change is in revision 398382:&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewcvs?rev=398382&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=398382&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12413003" author="army" created="Wed, 24 May 2006 05:33:16 +0100"  >&lt;p&gt;Verified fix manually and it has been ported to 10.1.  So I&apos;m marking it closed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12322453" name="svn.status" size="62" author="bryanpendleton" created="Sun, 29 Jan 2006 01:58:46 +0000"/>
                            <attachment id="12322452" name="svn_jan_27_2006.diff" size="1265" author="bryanpendleton" created="Sun, 29 Jan 2006 01:58:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 28 Jan 2006 12:15:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21931</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy16cf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40678</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>