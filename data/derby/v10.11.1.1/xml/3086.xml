<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:47:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3086/DERBY-3086.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3086] The server policy needs to grant derbynet.jar more permissions so that sysinfo and drda tracing will work</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3086</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;More permissions need to be granted to derbynet.jar in the server.policy file. David van Couvering reports that if you bring up the server and run the following command:&lt;/p&gt;

&lt;p&gt;java -jar derbyrun.jar server sysinfo&lt;/p&gt;

&lt;p&gt;then you get security exceptions as the sysinfo code, running inside the network jarball tries to read user.dir, user.home, user.name, java.home, and java.class.path.&lt;/p&gt;

&lt;p&gt;Kathey Marsden reports that  if you try to run the network server with drda tracing turned on, then you get security exceptions when the server tries to open the trace log file.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12379056">DERBY-3086</key>
            <summary>The server policy needs to grant derbynet.jar more permissions so that sysinfo and drda tracing will work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Sep 2007 20:44:25 +0100</created>
                <updated>Fri, 21 Jan 2011 18:50:18 +0000</updated>
                            <resolved>Tue, 20 Nov 2007 23:54:04 +0000</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.2.1</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12530477" author="kmarsden" created="Wed, 26 Sep 2007 17:14:40 +0100"  >&lt;p&gt;Marking as a regression since these operations worked without error on 10.2&lt;/p&gt;</comment>
                            <comment id="12540301" author="rhillegas" created="Mon, 5 Nov 2007 23:53:22 +0000"  >&lt;p&gt;Attaching derby-3086-04-morePermissions-aa.diff. This adds more permissions to server.policy and template.policy to facilitate server tracing and sysinfo when a security manager is installed.&lt;/p&gt;

&lt;p&gt;One thing that puzzles me is the fact that sysinfo lives in 3 jar files: derbytools.jar, derby.jar, and derbynet.jar. That means that identical permissions have to be granted to all three code domains--because you don&apos;t know what order the jars will appear in the classpath. Is this duplication really necessary? Is it a bug that sysinfo lives in 3 jars instead of just one?&lt;/p&gt;

&lt;p&gt;This patch touches the following files. Tests must be added later:&lt;/p&gt;

&lt;p&gt;M      java/tools/org/apache/derby/impl/tools/sysinfo/Main.java&lt;/p&gt;

&lt;p&gt;Adds privileged blocks around system calls.&lt;/p&gt;

&lt;p&gt;M      java/drda/org/apache/derby/drda/NetworkServerControl.java&lt;/p&gt;

&lt;p&gt;Sets derby.drda.traceDirectory if it isn&apos;t already set. This allows us to parameterize the corresponding permission grant.&lt;/p&gt;

&lt;p&gt;M      java/drda/org/apache/derby/drda/server.policy&lt;br/&gt;
M      java/drda/org/apache/derby/drda/template.policy&lt;/p&gt;

&lt;p&gt;Additional permission grants.&lt;/p&gt;
</comment>
                            <comment id="12540307" author="kmarsden" created="Tue, 6 Nov 2007 00:10:13 +0000"  >&lt;p&gt;Thanks Rick for looking at this issue.  I think requiring write access to this property is going to introduce an incompatible change.&lt;/p&gt;

&lt;p&gt;+        if ( PropertyUtil.getSystemProperty( Property.DRDA_PROP_TRACEDIRECTORY ) == null )&lt;br/&gt;
+        &lt;/p&gt;
{ System.setProperty( Property.DRDA_PROP_TRACEDIRECTORY, PropertyUtil.getSystemProperty( Property.SYSTEM_HOME_PROPERTY ) ); }
&lt;p&gt;+&lt;/p&gt;

&lt;p&gt;The reason sysinfo is in all the jars I believe is so that if you have any of the jars in your classpath, you will get valid sysinfo output.  For example a client configuration would require only derbyclient.jar so would need access to sysinfo through that jar.&lt;/p&gt;




</comment>
                            <comment id="12540437" author="rhillegas" created="Tue, 6 Nov 2007 13:48:31 +0000"  >&lt;p&gt;Thanks for the quick feedback, Kathey. It looks as though I need to grant the sysinfo permissions to derbyclient.jar as well.&lt;/p&gt;

&lt;p&gt;Could you explain the incompatibility which you see is being introduced? I didn&apos;t understand your concern. Here is a little more information which may help: The code which sets DRDA_PROP_TRACEDIRECTORY is called before the security manager is installed, so there is no need to grant write access to that property. Thanks.&lt;/p&gt;</comment>
                            <comment id="12540457" author="rhillegas" created="Tue, 6 Nov 2007 15:30:55 +0000"  >&lt;p&gt;I see that sysinfo is in the following jars:&lt;/p&gt;

&lt;p&gt;derby.jar&lt;br/&gt;
derbyclient.jar&lt;br/&gt;
derbynet.jar&lt;br/&gt;
derbytools.jar&lt;br/&gt;
derbytesting.jar&lt;/p&gt;

&lt;p&gt;Why is sysinfo in derbytesting.jar? Thanks.&lt;/p&gt;</comment>
                            <comment id="12540488" author="kmarsden" created="Tue, 6 Nov 2007 17:13:33 +0000"  >&lt;p&gt;Rick said:&lt;/p&gt;

&lt;p&gt;&amp;gt;Could you explain the incompatibility which you see is &amp;gt;being introduced? I didn&apos;t understand your concern. Here &amp;gt;is a little more information which may help: The code &amp;gt;which sets DRDA_PROP_TRACEDIRECTORY is called &amp;gt;before the security manager is installed, so there is no &amp;gt;need to grant write access to that property.&lt;/p&gt;

&lt;p&gt;Looking more closely I see this is set only if installing the security manager. My concern was that if I used my own policy file it would fall over trying to set this property, but I tried it and that does not seem to be the case. If I use my own policy file it does not enter this code at all, so I think the change is ok after all.&lt;/p&gt;</comment>
                            <comment id="12540551" author="rhillegas" created="Tue, 6 Nov 2007 20:31:26 +0000"  >&lt;p&gt;Attaching derby-3086-01-morePermissions-ab.diff. This adds the following to the previous patch:&lt;/p&gt;

&lt;p&gt;1) Grants the sysinfo permissions to derbyclient.jar and derbytesting.jar as well.&lt;/p&gt;

&lt;p&gt;2) Adds regression test cases for sysinfo and tracing permissions to SecureServerTest&lt;/p&gt;

&lt;p&gt;I would appreciate it if Kathey and David could verify that this patch fixes the problems they were seeing. Thanks.&lt;/p&gt;</comment>
                            <comment id="12540755" author="rhillegas" created="Wed, 7 Nov 2007 14:30:00 +0000"  >&lt;p&gt;Attaching derby-3086-01-morePermissions-ac.diff. This makes a slight change to the previous patch. To improve readability, I have removed the redundant permission grants from template.policy and I have expanded the comment on the remaining sysinfo grants (given to derbynet.jar), explaining that the sysinfo grants need to be given to the first jar file on the classpath which contains the sysinfo classes.&lt;/p&gt;

&lt;p&gt;Committed at subversion revision 592758.&lt;/p&gt;</comment>
                            <comment id="12541127" author="djd" created="Thu, 8 Nov 2007 20:30:30 +0000"  >&lt;p&gt;Rick&amp;gt; Is it a bug that sysinfo lives in 3 jars instead of just one?&lt;/p&gt;

&lt;p&gt;Sysinfo could be dropped from derbynet.jar because derbynet.jar automatically includes derby.jar.&lt;/p&gt;</comment>
                            <comment id="12543577" author="rhillegas" created="Mon, 19 Nov 2007 14:43:25 +0000"  >&lt;p&gt;Ported 592758 from trunk to 10.3 branch at subversion revision 596309.&lt;/p&gt;</comment>
                            <comment id="12543910" author="rhillegas" created="Tue, 20 Nov 2007 14:44:34 +0000"  >&lt;p&gt;Resolving this issue because it has been ported to 10.3.&lt;/p&gt;</comment>
                            <comment id="12543980" author="djd" created="Tue, 20 Nov 2007 18:13:40 +0000"  >&lt;p&gt;Two issues:&lt;/p&gt;

&lt;p&gt;+grant codeBase &quot;$&lt;/p&gt;
{derby.install.url}derbyclient.jar&quot;&lt;br/&gt;
+grant codeBase &quot;${derby.install.url}
&lt;p&gt;derbytesting.jar&quot;&lt;/p&gt;

&lt;p&gt;1) Policy file modified by this change assumes that derbyTesting.jar lives in the same folder as the other Derby jars, this is not true for a release.&lt;/p&gt;

&lt;p&gt;2) The name of the testing jar is derbyTesting.jar, not derbytesting.jar&lt;/p&gt;</comment>
                            <comment id="12544057" author="rhillegas" created="Tue, 20 Nov 2007 20:46:39 +0000"  >&lt;p&gt;Thanks for catching this, Dan. Attaching derby-3082-02-removeDerbyTesting-aa.diff. This patch removes the derbyTesting grants from the server policy file. It turns out that the sysinfo class in derbyTesting lives in a different package than the production sysinfo in the other jar files. So it would not be the class resolved by the production invocations of sysinfo.&lt;/p&gt;</comment>
                            <comment id="12544119" author="rhillegas" created="Tue, 20 Nov 2007 23:42:51 +0000"  >&lt;p&gt;Committed derby-3082-02-removeDerbyTesting.aa.diff at subversion revision 596880.&lt;/p&gt;</comment>
                            <comment id="12544121" author="rhillegas" created="Tue, 20 Nov 2007 23:53:17 +0000"  >&lt;p&gt;Ported 596880 from trunk to 10.3 branch at subversion revision 596882.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12379806">DERBY-3110</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12368999" name="derby-3086-01-morePermissions-aa.diff" size="10336" author="rhillegas" created="Mon, 5 Nov 2007 23:53:22 +0000"/>
                            <attachment id="12369048" name="derby-3086-01-morePermissions-ab.diff" size="17357" author="rhillegas" created="Tue, 6 Nov 2007 20:31:25 +0000"/>
                            <attachment id="12369105" name="derby-3086-01-morePermissions-ac.diff" size="14717" author="rhillegas" created="Wed, 7 Nov 2007 14:30:00 +0000"/>
                            <attachment id="12369914" name="derby-3086-02-removeDerbyTesting-aa.diff" size="2515" author="rhillegas" created="Tue, 20 Nov 2007 20:46:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 26 Sep 2007 16:14:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23422</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0jhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36974</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>