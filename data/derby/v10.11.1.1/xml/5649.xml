<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:29:07 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5649/DERBY-5649.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5649] make improvements to nstest so it&apos;s easier to run/analyze/debug</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5649</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The system test nstest ran into a number of error situations during the 10.8.2 QA cycle. However, some are known, some were found to be pre-existing situations (although intermittent, so we&apos;ve been lucky/unlucky not to run into them). Some errors are expected. And some problems were indeed new.&lt;br/&gt;
However, the test output is very wordy and it&apos;s complicated identifying real issues and sorting through the messages.&lt;br/&gt;
It would be helpful to clean this up some.&lt;/p&gt;

&lt;p&gt;I found the following areas for easy improvement:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;InitThread messages and Intializer.java: exited add_one_row: 1 rows&lt;br/&gt;
	seems like this is really the same message. &lt;br/&gt;
	If we eliminate one, we&apos;ll have limited that part of the output by 50%.&lt;/li&gt;
	&lt;li&gt;TesterThreads - seems to send one message re &apos;attempting to&apos;, one for fail/success.&lt;br/&gt;
   	Again, if we eliminate the &apos;attempted to&apos; messages, we&apos;d have made the output smaller.&lt;/li&gt;
	&lt;li&gt;db_util.pick_one - seems also unnecessary - can this be combined with the&lt;br/&gt;
   insert / update / delete messages that are using the picked row?&lt;/li&gt;
	&lt;li&gt;ERROR 22003 -&amp;gt; The resulting value is ourside the range for data type DECIMAL/NUMERIC(5,0)&lt;br/&gt;
	The column is t_decimal(decimal), i.e. a decimal(5,0). The value it&apos;s attempting to insert is clearly &lt;br/&gt;
        not suitable. From the code (in dbUtil) it does not look like this was intended to be a negative test.&lt;br/&gt;
        Eliminating the error (and its corresponding stack prints) would probably make the output considerably smaller&lt;br/&gt;
        and make looking for interesting errors easier.&lt;/li&gt;
	&lt;li&gt;There seems to be a section that can be used as a smaller test case, but you need to comment out the &apos;normal&apos; settings, and uncomment out these settings. It would make more sense to make the small configuration as an option.&lt;/li&gt;
	&lt;li&gt;With a small configuration, the backup thread would run on when all other tests are done, because it has the same&lt;br/&gt;
   value for MAX_ITERATIONS, but in contrast to the tester threads, the backup threads runs every 10 minutes.&lt;br/&gt;
   Thus, when all other threads are done, the backup threads continue until 50x10 minutes have passed (plus the time it takes to actually do the backup, re-encrypt, restore). So it would make more sense to finish the backup threads if there is no further activity to the database.&lt;/li&gt;
	&lt;li&gt;there are some typos and strange line-spacings making some comments hard to read.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12546175">DERBY-5649</key>
            <summary>make improvements to nstest so it&apos;s easier to run/analyze/debug</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Mar 2012 00:58:56 +0000</created>
                <updated>Thu, 1 Nov 2012 21:10:46 +0000</updated>
                            <resolved>Fri, 16 Mar 2012 00:21:53 +0000</resolved>
                                    <version>10.9.1.0</version>
                                    <fixVersion>10.8.3.0</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13228123" author="myrna" created="Tue, 13 Mar 2012 01:40:46 +0000"  >&lt;p&gt;Also found two e.printStackTrace(); calls in DbUtil. One should do.&lt;/p&gt;</comment>
                            <comment id="13228126" author="myrna" created="Tue, 13 Mar 2012 01:45:54 +0000"  >&lt;p&gt;Attaching a patch with a number of these minor improvements.&lt;/p&gt;

&lt;p&gt;The small nstest configuration now runs in about 20 minutes on my slow machine.&lt;br/&gt;
I will run some more experiments and if all OK, I&apos;ll add a comment about it to the README.txt and commit.&lt;/p&gt;</comment>
                            <comment id="13228129" author="myrna" created="Tue, 13 Mar 2012 01:46:38 +0000"  >&lt;p&gt;Note that for this patch, I kept the indentation to match the original code.&lt;/p&gt;</comment>
                            <comment id="13228226" author="kristwaa" created="Tue, 13 Mar 2012 05:36:15 +0000"  >&lt;p&gt;I had a quick look at the patch, +1 on the cleanup.&lt;/p&gt;

&lt;p&gt;A few comments/questions:&lt;br/&gt;
 o the comments in setSmallConfig look a bit odd, did you intend to remove the public static int part?&lt;br/&gt;
 o missing space in &apos;(&quot;FAIL: &quot; + thread_id + &quot; inserted &quot; + rowsAdded + &quot;rows&quot;);&apos;?&lt;br/&gt;
 o where printouts are commented out, can they be deleted or does it make sense to control them with a debug flag (similar to BaseTestCase.println)?&lt;br/&gt;
   (the flag doesn&apos;t have to be tied to a property)&lt;br/&gt;
 o you say you want to stick with the indentation of the original code, but spaces crept in next to tabs in a few places&lt;/p&gt;</comment>
                            <comment id="13229419" author="myrna" created="Wed, 14 Mar 2012 17:42:34 +0000"  >&lt;p&gt;Committed to trunk with revision 1300658 and backported to 10.8 with revision 1300682.&lt;/p&gt;</comment>
                            <comment id="13229485" author="myrna" created="Wed, 14 Mar 2012 18:40:27 +0000"  >&lt;p&gt;I don&apos;t intend to do more work on this at this time.&lt;/p&gt;</comment>
                            <comment id="13230649" author="myrna" created="Thu, 15 Mar 2012 22:32:41 +0000"  >&lt;p&gt;I&apos;m reopening this, to adjust the test a little more;&lt;br/&gt;
There&apos;s an option to run without a backup thread by setting the property -Dderby.nstest.backupRestore=false, but when you do this, the test runs into an ArrayIndexOutOfBounds error on creating the tester threads, which then confuses the workings of the main method so it won&apos;t finish cleanly.&lt;br/&gt;
In that case, the Memcheck keeps going, so just to be on the safe side, I&apos;ll add a check for remaining test threads in the Memcheck. &lt;/p&gt;

&lt;p&gt;While I&apos;m add it, I&apos;ll remove some commented-out settings that appear to be left behind from previous configuration attempts.&lt;/p&gt;</comment>
                            <comment id="13230748" author="myrna" created="Fri, 16 Mar 2012 00:21:40 +0000"  >&lt;p&gt;I made changes for this with revision 1301290 to trunk and 1301294 to 10.8.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12431519">DERBY-4321</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12518138" name="DERBY-5649.diff1" size="23901" author="myrna" created="Tue, 13 Mar 2012 01:45:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 13 Mar 2012 05:36:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231333</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0c13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35767</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>