<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:37:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3613/DERBY-3613.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3613] SELECT DISTINCT field FROM TABLE_NAME GROUP BY field,  field2</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3613</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Query &apos;SELECT DISTINCT field FROM TABLE_NAME GROUP BY field,  field2&apos;  not work ok.&lt;br/&gt;
 Distinct is ignored !!!&lt;/p&gt;</description>
                <environment>Windows XP</environment>
        <key id="12393750">DERBY-3613</key>
            <summary>SELECT DISTINCT field FROM TABLE_NAME GROUP BY field,  field2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="kusartur">Artur Ku&#347;</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Apr 2008 14:28:30 +0100</created>
                <updated>Fri, 21 Jan 2011 17:51:53 +0000</updated>
                            <resolved>Fri, 25 Apr 2008 15:09:47 +0100</resolved>
                                    <version>10.3.2.1</version>
                                    <fixVersion>10.4.2.0</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12587984" author="bryanpendleton" created="Fri, 11 Apr 2008 15:20:28 +0100"  >&lt;p&gt;Can you provide an example SQL script, perhaps a captured IJ session,&lt;br/&gt;
which shows the specific tables, statements, and data you are using, &lt;br/&gt;
the results you get, and the results you expect?&lt;/p&gt;</comment>
                            <comment id="12588001" author="kusartur" created="Fri, 11 Apr 2008 16:31:53 +0100"  >&lt;p&gt;Simple :&lt;/p&gt;

&lt;p&gt;CREATE TABLE tabla_name(field varchar(10), field2 varchar(10 ));&lt;br/&gt;
INSERT INTO  tabla_name VALUES(&apos;first&apos;, &apos;first&apos;);&lt;br/&gt;
INSERT INTO  tabla_name VALUES(&apos;first&apos;, &apos;second&apos;);&lt;br/&gt;
SELECT DISTINCT field FROM tabla_name GROUP BY field,  field2.&lt;/p&gt;

&lt;p&gt;I expect only one 1 row, but I get two rows.&lt;br/&gt;
Why??&lt;/p&gt;</comment>
                            <comment id="12588003" author="bryanpendleton" created="Fri, 11 Apr 2008 16:37:46 +0100"  >&lt;p&gt;I believe you get two rows because the results have been partitioned&lt;br/&gt;
into two groups, as you specified in the GROUP BY.&lt;/p&gt;

&lt;p&gt;Within each group you are getting only one distinct value of &apos;field&apos;,&lt;br/&gt;
but there are two groups total.&lt;/p&gt;</comment>
                            <comment id="12588004" author="kusartur" created="Fri, 11 Apr 2008 16:42:03 +0100"  >&lt;p&gt;Thanks.&lt;br/&gt;
It is very funny. &lt;br/&gt;
Oracle, MSDE and Postgres returns only one rows.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
JavaDB is worse ??&lt;/p&gt;
</comment>
                            <comment id="12588007" author="bryanpendleton" created="Fri, 11 Apr 2008 16:54:14 +0100"  >&lt;p&gt;Derby might be interpreting the standards incorrectly here, I don&apos;t know.&lt;/p&gt;

&lt;p&gt;Do you have access to the SQL standard to help us understand what&lt;br/&gt;
the specified behavior should be?&lt;/p&gt;</comment>
                            <comment id="12588503" author="kusartur" created="Mon, 14 Apr 2008 08:55:47 +0100"  >&lt;p&gt;I starting from the page &lt;br/&gt;
&lt;a href=&quot;http://en.wikipedia.org/wiki/SQL&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://en.wikipedia.org/wiki/SQL&lt;/a&gt; &lt;br/&gt;
and next &lt;a href=&quot;http://en.wikipedia.org/wiki/SQL-92&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://en.wikipedia.org/wiki/SQL-92&lt;/a&gt; &lt;br/&gt;
and next open the page &lt;a href=&quot;http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt&lt;/a&gt;.&lt;br/&gt;
In the specyfication I found that &lt;br/&gt;
&quot;If DISTINCT is specified, then let TXA be the result of elimi-&lt;br/&gt;
            nating redundant duplicate values from TX. Otherwise, let TXA be&lt;br/&gt;
            TX.&quot;&lt;/p&gt;

&lt;p&gt;So, in JavaDB  is not ok   &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


</comment>
                            <comment id="12588565" author="knutanders" created="Mon, 14 Apr 2008 13:58:55 +0100"  >&lt;p&gt;I tried the query with different versions of Derby:&lt;/p&gt;

&lt;p&gt;10.0.1.2: two rows&lt;br/&gt;
10.1.1.0: two rows&lt;br/&gt;
10.1.2.1: one row&lt;br/&gt;
10.2.1.6: one row&lt;br/&gt;
10.2.2.0: one row&lt;br/&gt;
10.3.1.4: two rows&lt;br/&gt;
10.3.2.1: two rows&lt;br/&gt;
10.4.1.1 (RC): two rows&lt;/p&gt;

&lt;p&gt;So, given that one row is the correct result, the bug was fixed at some point, but it regressed back later.&lt;/p&gt;</comment>
                            <comment id="12588600" author="knutanders" created="Mon, 14 Apr 2008 16:00:44 +0100"  >&lt;p&gt;The first change (two rows --&amp;gt; one row) happened in this commit:&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------&lt;br/&gt;
r267239 | bandaram | 2005-09-02 20:07:39 +0200 (Fri, 02 Sep 2005) | 6 lines&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-504&quot; title=&quot;SELECT DISTINCT returns duplicates when selecting from subselects&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-504&quot;&gt;&lt;del&gt;DERBY-504&lt;/del&gt;&lt;/a&gt;: Disable pushing down DISTINCT when number of columns from the parent query and the subquery don&apos;t match. Can lead to wrong results.&lt;/p&gt;

&lt;p&gt;Thanks to Rick for persistant reviews and running the tests.&lt;/p&gt;

&lt;p&gt;Submitted by Knut Anders Hatlen (Knut.Hatlen@Sun.COM)&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------&lt;/p&gt;


&lt;p&gt;The old behaviour (one row --&amp;gt; two rows) was reintroduced in this commit:&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------&lt;br/&gt;
r516454 | abrown | 2007-03-09 17:37:20 +0100 (Fri, 09 Mar 2007) | 8 lines&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-681&quot; title=&quot;Eliminate the parser&amp;#39;s rewriting of the abstract syntax tree for queries with GROUP BY and/or HAVING clauses&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-681&quot;&gt;&lt;del&gt;DERBY-681&lt;/del&gt;&lt;/a&gt;: Remove the &quot;wrap group by&apos;s in a subselect&quot; rewrite in the parser.&lt;br/&gt;
This patch preserves the having clause through bind and optimize phases and&lt;br/&gt;
then, during the final rewrite for aggregates in the GroupByNode, it transforms&lt;br/&gt;
the having clause to a valid restriction. See text file attached to the Jira&lt;br/&gt;
for more information.&lt;/p&gt;

&lt;p&gt;Contributed by Manish Khettry (manish_khettry@yahoo.com)&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------&lt;/p&gt;</comment>
                            <comment id="12590731" author="bryanpendleton" created="Sun, 20 Apr 2008 03:45:18 +0100"  >&lt;p&gt;This page suggests that certain versions of Sybase may have similar behavior to Derby:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.help.ase_15.0.sqlug/html/sqlug/sqlug126.htm&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.help.ase_15.0.sqlug/html/sqlug/sqlug126.htm&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It seems like Derby could recognize that:&lt;/p&gt;

&lt;p&gt;  select distinct a from t group by a, b&lt;/p&gt;

&lt;p&gt;is identical to&lt;/p&gt;

&lt;p&gt;  select distinct a from t group by a&lt;/p&gt;

&lt;p&gt;I can think of 3 possible ways to give Derby this behavior:&lt;br/&gt;
1) When processing GROUP by columns, and deciding whether to pull them up&lt;br/&gt;
into the result column list as generated columns, detect this particular case and&lt;br/&gt;
don&apos;t pull up the generated GROUP BY column &quot;b&quot; into the result list.&lt;br/&gt;
2) In the compilation process, prior to generating the distinct scan result set,&lt;br/&gt;
detect that un-necessary column &quot;b&quot; has been included into the result column list&lt;br/&gt;
and skip it when generating the data structures for execution.&lt;br/&gt;
3) At execution time, when setting up the sorter, recognize that column &quot;b&quot; isn&apos;t&lt;br/&gt;
needed in the sort key, and only sort/collapse the records on column &quot;a&quot;.&lt;/p&gt;

&lt;p&gt;It seems best to detect this situation earlier rather than later, so I&apos;m partial&lt;br/&gt;
to solutions which can solve the problem at compilation time, not execution time.&lt;/p&gt;</comment>
                            <comment id="12591176" author="bryanpendleton" created="Tue, 22 Apr 2008 03:37:23 +0100"  >&lt;p&gt;Attached is &apos;dontGenerateForDistinct.diff&apos;, a patch proposal.&lt;/p&gt;

&lt;p&gt;This patch modifies the processing of GROUP BY columns&lt;br/&gt;
which are &quot;generated&quot; into the select&apos;s result column list.&lt;br/&gt;
Specifically, the patch causes columns to be generated&lt;br/&gt;
into the select RCL only if the select does &lt;b&gt;not&lt;/b&gt; specify DISTINCT.&lt;/p&gt;

&lt;p&gt;If the select specifies DISTINCT, we don&apos;t want to include&lt;br/&gt;
any additional columns into the RCL because we want to&lt;br/&gt;
be sure that we only perform DISTINCT processing on&lt;br/&gt;
the columns that were specified by the user.&lt;/p&gt;

&lt;p&gt;The patch also includes some additional test cases, based&lt;br/&gt;
on the repro case in the issue description.&lt;/p&gt;

&lt;p&gt;I ran a complete set of regression tests with the modified code&lt;br/&gt;
and it passed all the existing tests, as well as the new tests&lt;br/&gt;
added by this patch.&lt;/p&gt;

&lt;p&gt;Please have a look and let me know what you think.&lt;/p&gt;</comment>
                            <comment id="12591224" author="thomanie" created="Tue, 22 Apr 2008 07:52:37 +0100"  >&lt;p&gt;The approach taken in the proposed patch looks good. Test changes seem to cover the failing scenarios well. &lt;br/&gt;
Running a few tests on the patch now, but unless they show any problems I&apos;m +1 to commit.&lt;/p&gt;
</comment>
                            <comment id="12591268" author="thomanie" created="Tue, 22 Apr 2008 12:38:12 +0100"  >&lt;p&gt;No errors seen in my testing - so +1 for commit.&lt;/p&gt;</comment>
                            <comment id="12591512" author="bryanpendleton" created="Wed, 23 Apr 2008 03:17:18 +0100"  >&lt;p&gt;Thanks for the review and testing Thomas!&lt;/p&gt;

&lt;p&gt;I updated the patch with (a) a short comment on the code change,&lt;br/&gt;
and (b) a few other test cases which I created by looking at some&lt;br/&gt;
of the other test cases in GroupByTest and adding DISTINCT to them.&lt;/p&gt;

&lt;p&gt;The revised patch is attached.&lt;/p&gt;</comment>
                            <comment id="12591513" author="bryanpendleton" created="Wed, 23 Apr 2008 03:19:04 +0100"  >&lt;p&gt;Committed addCommentAndAnotherTest.diff to the trunk as revision 650728.&lt;/p&gt;

&lt;p&gt;I&apos;ll investigate merging this patch back to the 10.4 and 10.3 lines.&lt;/p&gt;</comment>
                            <comment id="12592080" author="bryanpendleton" created="Thu, 24 Apr 2008 15:27:18 +0100"  >&lt;p&gt;Merged the trunk change to the 10.4 branch as revision 651275.&lt;/p&gt;</comment>
                            <comment id="12592184" author="bryanpendleton" created="Thu, 24 Apr 2008 23:20:01 +0100"  >&lt;p&gt;GroupByTest.java is quite different in 10.3, making it hard to do an automated merge.&lt;/p&gt;

&lt;p&gt;Attached file tenThree.diff is the patch I intend to submit to 10.3, if testing goes well.&lt;/p&gt;</comment>
                            <comment id="12592383" author="bryanpendleton" created="Fri, 25 Apr 2008 15:09:47 +0100"  >&lt;p&gt;Committed tenThree.diff to the 10.3 branch as revision 651612.&lt;/p&gt;

&lt;p&gt;Marking the issue as resolved. Please confirm that the fix is working,&lt;br/&gt;
and close the issue if the problem is gone. Thanks for helping us&lt;br/&gt;
find this problem!&lt;/p&gt;</comment>
                            <comment id="12620378" author="rhillegas" created="Wed, 6 Aug 2008 19:54:01 +0100"  >&lt;p&gt;Does this issue need a release note? With this fix, a family of queries will now return different results.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12380741" name="addCommentAndAnotherTest.diff" size="6129" author="bryanpendleton" created="Wed, 23 Apr 2008 03:17:18 +0100"/>
                            <attachment id="12380661" name="dontGenerateForDistinct.diff" size="4694" author="bryanpendleton" created="Tue, 22 Apr 2008 03:37:23 +0100"/>
                            <attachment id="12380874" name="tenThree.diff" size="4752" author="bryanpendleton" created="Thu, 24 Apr 2008 23:20:01 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 11 Apr 2008 14:20:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23745</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0lg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37293</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>