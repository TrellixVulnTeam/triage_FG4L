<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:40:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5561/DERBY-5561.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5561] Race conditions in LogicalConnection checking for a null physical connection</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5561</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;There are race conditions with checkForNullPhysicalConnection calls in LogicalConnection.  checkForNullPhysicalConnection is not synchronized and it checks for the member &quot;phsyicalConnection&quot; which can be cleared by &quot;nullPhsyicalConnection&quot; (which is synchronized) and &quot;close&quot; (which is synchronized) and &quot;closeWithoutRecyclingToPool&quot; (which is synchronized).&lt;/p&gt;

&lt;p&gt;This affects &quot;nativeSQL&quot;, &quot;getAutoCommit&quot;, &quot;getTransactionIsolation&quot;, &quot;getWarnings&quot;, &quot;isReadOnly&quot;, &quot;getCatalog&quot;, &quot;getTypeMap&quot;, &quot;createStatement&quot;, &quot;prepareCall&quot;, &quot;prepareStatement&quot;, &quot;setHoldability&quot;, &quot;getHoldability&quot;, &quot;setSavePoint&quot;, &quot;rollBack&quot;, &quot;releaseSavePoint&quot;, &quot;getSchema&quot;, &quot;setSchema&quot;.&lt;/p&gt;

&lt;p&gt;All of these call &quot;checkForNullPhysicalConnection&quot; and then use the member &quot;physicalConnection&quot; after that call returns.  Because these methods are not synchronized, between the time &quot;checkForNullPhysicalConnectoin&quot; returns and &quot;physicalConnection&quot; is used, the &quot;physicalConnection&quot; member could be set to null and then a NPE occurs.&lt;/p&gt;

&lt;p&gt;Probably all of these methods should be changed to synchronized.&lt;/p&gt;</description>
                <environment>Solaris 10&lt;br/&gt;
Glassfish V2.1.1&lt;br/&gt;
ClientXADataSource connection pool</environment>
        <key id="12536509">DERBY-5561</key>
            <summary>Race conditions in LogicalConnection checking for a null physical connection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="bbergquist">Brett Bergquist</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Dec 2011 15:26:51 +0000</created>
                <updated>Wed, 3 Sep 2014 09:31:43 +0100</updated>
                            <resolved>Mon, 1 Oct 2012 15:41:04 +0100</resolved>
                                    <version>10.5.3.2</version>
                    <version>10.8.2.2</version>
                                    <fixVersion>10.5.3.2</fixVersion>
                    <fixVersion>10.6.2.4</fixVersion>
                    <fixVersion>10.7.1.4</fixVersion>
                    <fixVersion>10.8.3.0</fixVersion>
                    <fixVersion>10.9.2.2</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                            <comments>
                            <comment id="13176727" author="kmarsden" created="Wed, 28 Dec 2011 17:57:13 +0000"  >&lt;p&gt;Do you have multiple threads accessing the same  connection at the same time?   If so is it intentional? Typically when that is being done it is not intentional as even if the various methods were synchronized the two threads would share transaction and other state that would be difficult to coordinate.&lt;/p&gt;
</comment>
                            <comment id="13176747" author="kmarsden" created="Wed, 28 Dec 2011 18:33:39 +0000"  >&lt;p&gt;Makes sense. Thanks for the explanation.&lt;/p&gt;</comment>
                            <comment id="13176753" author="kmarsden" created="Wed, 28 Dec 2011 18:41:25 +0000"  >&lt;p&gt;Just realized Brett&apos;s explanation is not in the Jira. It can be found in this thread.&lt;br/&gt;
&lt;a href=&quot;http://old.nabble.com/-jira---Created--%28DERBY-5561%29-Race-conditions-in-LogicalConnection-checking-for-a-null-physical-connection-to33046047.html#a33046825&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://old.nabble.com/-jira---Created--%28DERBY-5561%29-Race-conditions-in-LogicalConnection-checking-for-a-null-physical-connection-to33046047.html#a33046825&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13178747" author="bbergquist" created="Tue, 3 Jan 2012 14:19:56 +0000"  >&lt;p&gt;This patch changes all methods that call &quot;checkForNullPhysicalConnection&quot; to be synchronized.  Some of the methods in LogicalConnection.java already were.  This patch makes all calls consistent and eliminates the race condition.&lt;/p&gt;</comment>
                            <comment id="13197604" author="siddharthsrivastava" created="Wed, 1 Feb 2012 06:02:05 +0000"  >&lt;p&gt;thanks Brett for the patch. I will be looking into adding test for this patch.&lt;/p&gt;</comment>
                            <comment id="13210432" author="kmarsden" created="Fri, 17 Feb 2012 18:37:43 +0000"  >&lt;p&gt;Triage for 10.9.  Urgent, High Value Fix. Thanks Brett for the patch and Siddharth for picking up the testing and driving it to commit.&lt;/p&gt;</comment>
                            <comment id="13262497" author="kristwaa" created="Thu, 26 Apr 2012 10:46:13 +0100"  >&lt;p&gt;Any updates on this issue?&lt;br/&gt;
To me the changes look safe and correct. Given that the Connection interface probably won&apos;t see much change, and that writing a test that reliably detects missing synchronization in future methods (i.e. by using reflection and running  a test pattern for each method) may be non-trivial, I suggest we commit the patch right away unless Siddharth is planning to write a test for this shortly.&lt;/p&gt;

&lt;p&gt;Siddhart, what&apos;s your opinion on this?&lt;/p&gt;</comment>
                            <comment id="13263366" author="siddharthsrivastava" created="Fri, 27 Apr 2012 06:40:25 +0100"  >&lt;p&gt;The patch works fine for me as well. I do plan to write the test for it but I can continue with it only after next week since I have exams till then.I&apos;ll add the test case for it after that.&lt;br/&gt;
Until then I too recommend committing the patch. &lt;/p&gt;</comment>
                            <comment id="13267172" author="kristwaa" created="Thu, 3 May 2012 05:30:18 +0100"  >&lt;p&gt;Great!&lt;/p&gt;

&lt;p&gt;I committed &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5561&quot; title=&quot;Race conditions in LogicalConnection checking for a null physical connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5561&quot;&gt;&lt;del&gt;DERBY-5561&lt;/del&gt;&lt;/a&gt;.patch to trunk with revision 1333305.&lt;/p&gt;</comment>
                            <comment id="13267236" author="kristwaa" created="Thu, 3 May 2012 07:15:19 +0100"  >&lt;p&gt;Attaching patch 2a, which cleans up a few minor issues:&lt;br/&gt;
 o converts docs to Javadoc&lt;br/&gt;
 o remove stale doc&lt;br/&gt;
 o correct/improve some comments&lt;br/&gt;
 o makes physicalConnection_ package-private&lt;br/&gt;
 o makes checkForNullPhysicalConnection final&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="13269455" author="kristwaa" created="Mon, 7 May 2012 09:36:46 +0100"  >&lt;p&gt;I committed patch 2a to trunk with revision 1334919.&lt;br/&gt;
I&apos;ll give it a week or so before I look at backporting this to 10.8.&lt;/p&gt;</comment>
                            <comment id="13285547" author="kristwaa" created="Wed, 30 May 2012 11:20:21 +0100"  >&lt;p&gt;Backported to 10.8 with revision 1344183.&lt;br/&gt;
Resolving issue.&lt;/p&gt;</comment>
                            <comment id="13453405" author="kmarsden" created="Tue, 11 Sep 2012 21:56:56 +0100"  >&lt;p&gt;Likely applies to 10.5 as well so might be good to backport.&lt;/p&gt;</comment>
                            <comment id="13454055" author="kristwaa" created="Wed, 12 Sep 2012 16:10:48 +0100"  >&lt;p&gt;Reopening for backports.&lt;/p&gt;</comment>
                            <comment id="13454056" author="kristwaa" created="Wed, 12 Sep 2012 16:12:12 +0100"  >&lt;p&gt;Backported to 10.7 with revision 1383996.&lt;br/&gt;
I&apos;ll let the nightly tests run through before merging this fix back to 10.5, although I don&apos;t expect any problems.&lt;/p&gt;</comment>
                            <comment id="13459094" author="mamtas" created="Wed, 19 Sep 2012 22:03:12 +0100"  >&lt;p&gt;Assigning to me for backporting to 10.5&lt;/p&gt;</comment>
                            <comment id="13459800" author="mamtas" created="Thu, 20 Sep 2012 18:58:28 +0100"  >&lt;p&gt;Backported to 10.6.2.3 with revision 1388139&lt;/p&gt;</comment>
                            <comment id="13460110" author="mamtas" created="Fri, 21 Sep 2012 02:06:27 +0100"  >&lt;p&gt;Backported to 10.5.3.2 with revision 1388285&lt;/p&gt;</comment>
                            <comment id="13466845" author="kristwaa" created="Mon, 1 Oct 2012 15:41:04 +0100"  >&lt;p&gt;Resolving again. Added 10.5.3.2 to fix versions.&lt;/p&gt;</comment>
                            <comment id="14119635" author="knutanders" created="Wed, 3 Sep 2014 09:31:42 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12509289" name="DERBY-5561.patch" size="6710" author="bbergquist" created="Tue, 3 Jan 2012 14:19:56 +0000"/>
                            <attachment id="12525403" name="derby-5561-2a-minor_cleanups.diff" size="4193" author="kristwaa" created="Thu, 3 May 2012 07:15:19 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12540680">DERBY-5592</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10365"><![CDATA[Crash]]></customfieldvalue>
    <customfieldvalue key="10421"><![CDATA[Seen in production]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 28 Dec 2011 17:57:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>222192</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy08n3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35218</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>