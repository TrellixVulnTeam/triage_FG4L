<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:10:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-375/DERBY-375.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-375] Specification of incomplete server properties on command line causes NPE with NetworkServerControl when starting the server.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-375</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When using the command line to start the Network Server, there a couple of cases where if a property is specified on the command line but no value is given (ex. &quot;-Dderby.drda.maxThreads&quot; instead of &quot;-Dderby.drda.maxThreads=3&quot;), a Null Pointer Exception will result, when the correct behavior should be to use some kind of default.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;p&gt;&amp;gt; java -Dderby.drda.maxThreads org.apache.derby.drda.NetworkServerControl start -p 1528&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.localizeMessage(NetworkServerControlImpl.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessageWork(NetworkServerControlImpl.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessage(NetworkServerControlImpl.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.getIntPropVal(NetworkServerControlImpl.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.getPropertyInfo(NetworkServerControlImpl.java)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.&amp;lt;init&amp;gt;(NetworkServerControlImpl.java)&lt;br/&gt;
        at org.apache.derby.drda.NetworkServerControl.main(NetworkServerControl.java)&lt;/p&gt;

&lt;p&gt;Note that even though we see this NPE, it appears that the server still starts up, although the startup may not be complete (subsequent attempts to connect  might lead to errors like &quot;Invalid reply from network server: Insufficient data.&quot;).&lt;/p&gt;

&lt;p&gt;For other properties, this will just result in the default value being used, which is the correct behavior.  For example:&lt;/p&gt;

&lt;p&gt;&amp;gt; java -Dderby.drda.host org.apache.derby.drda.NetworkServerControl start -p 1528&lt;br/&gt;
Server is ready to accept connections on port 1528.&lt;/p&gt;</description>
                <environment>Running Derby Network Server and using command line API to start the server.</environment>
        <key id="12311499">DERBY-375</key>
            <summary>Specification of incomplete server properties on command line causes NPE with NetworkServerControl when starting the server.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="deepa">Deepa Remesh</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Sun, 19 Jun 2005 17:11:18 +0100</created>
                <updated>Fri, 21 Oct 2005 10:03:17 +0100</updated>
                            <resolved>Fri, 21 Oct 2005 10:02:55 +0100</resolved>
                                    <version>10.1.1.0</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.2.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="12314695" author="fuzzylogic" created="Thu, 30 Jun 2005 06:50:00 +0100"  >&lt;p&gt;Moving to 10.2&lt;/p&gt;</comment>
                            <comment id="12331941" author="deepa" created="Thu, 13 Oct 2005 10:50:05 +0100"  >&lt;p&gt;The default values for network server properties mentioned in Derby Server and Administration Guide are:&lt;/p&gt;

&lt;p&gt;derby.drda.host - If no host name is specified, the Network Server listens on the loopback address of the current machine (localhost).&lt;br/&gt;
derby.drda.keepAlive - true&lt;br/&gt;
derby.drda.logConnections - false&lt;br/&gt;
derby.drda.maxThreads - 1&lt;br/&gt;
derby.drda.minThreads - 1&lt;br/&gt;
derby.drda.portNumber - If no port number is specified, 1527 is the default.&lt;br/&gt;
derby.drda.startNetworkServer - false&lt;br/&gt;
derby.drda.timeSlice - 1&lt;br/&gt;
derby.drda.traceAll - false&lt;br/&gt;
derby.drda.traceDirectory - If the derby.system.home property has been set, it is the default. Otherwise, the default is the current directory.&lt;br/&gt;
derby.drda.debug - false &lt;/p&gt;

&lt;p&gt;However, in the code, default value of minThreads, maxThreads and timeSlice is &apos;0&apos;. In my patch too, I am using &apos;0&apos; as the default value for these. I also saw a test (maxThread.java) which tests default value of maxThreads as &apos;0&apos;. I think the document needs to be updated. Also, the property &apos;derby.drda.debug&apos; is not listed in the admin guide. Is this an internal property not exposed to users? &lt;/p&gt;</comment>
                            <comment id="12332118" author="deepa" created="Sat, 15 Oct 2005 09:48:34 +0100"  >&lt;p&gt;Attaching a patch &apos;derby-375.diff&apos; for this problem. Network server was giving NPE when system properties were specified without values. When a system property is specified without any value, the getProperty method in java.util.Properties returns an empty string. For the following network server properties (minThreads, maxThreads, timeSlice and portNumber), &apos;getPropertyInfo&apos; method in NetworkServerControlImpl will pass this empty string to &apos;getIntPropVal&apos;. This will try to get the Integer value and will cause an exception. To display this exception, &apos;localizeMessage&apos; method is used. At this point, &apos;langUtil&apos; which is passed to &apos;localizeMessage&apos; is not yet initialized and this results in the NPE. &lt;/p&gt;

&lt;p&gt;The patch does the following:&lt;br/&gt;
1. Moves the call to &apos;init&apos;, which initializes &apos;langUtil&apos;, before the call to &apos;getPropertyInfo&apos; method in the constructors of NetworkServerControlImpl.&lt;br/&gt;
2. If the system properties are specified without values, use defaults for them.&lt;br/&gt;
3. For &apos;derby.drda.traceDirectory&apos; property following is mentioned in the doc - &quot;If the derby.system.home property has been set, it is the default. Otherwise, the default is the current directory.&quot;.  &apos;getPropertyInfo&apos; was getting the value of &apos;derby.system.home&apos; but not using it as default for &apos;derby.drda.traceDirectory&apos;.&lt;br/&gt;
So the current directory was always getting used as default. Changed this.&lt;br/&gt;
4. When I added the default for &apos;derby.drda.traceDirectory&apos;, the tests derbynet/getCurrentProperties.java and derbynet/sysinfo.java had additional lines for derby.drda.traceDirectory in their outputs. Since the directory listed is dependent on the test directory, I have sed out &apos;traceDirectory&apos; lines for these tests.&lt;br/&gt;
5. Adds tests to derbynet/testProperties.java.&lt;br/&gt;
6. Fixes javadoc for &apos;traceDirectory&apos; in NetworkServerControl.&lt;/p&gt;

&lt;p&gt;Ran derbyall on Windows XP with Sun jdk 1.4.2. 1 test failed (derbyall/derbyall.fail:lang/ConcurrentImplicitCreateSchema.java). The failure is not related to this change.&lt;/p&gt;

&lt;p&gt;This patch also fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-613&quot; title=&quot;Intended location of network server tracing files is not clear.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-613&quot;&gt;&lt;del&gt;DERBY-613&lt;/del&gt;&lt;/a&gt; (Intended location of network server tracing files is not clear.). Please review/commit this patch. I&apos;ll open a sub-task to update documentation with the correct default values for maxThreads, minThreads and timeSlice.&lt;/p&gt;</comment>
                            <comment id="12332124" author="kmarsden" created="Sat, 15 Oct 2005 11:34:12 +0100"  >&lt;p&gt;Reviewed and committed this patch to the trunk.  Looks good. Thanks for fixing &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-613&quot; title=&quot;Intended location of network server tracing files is not clear.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-613&quot;&gt;&lt;del&gt;DERBY-613&lt;/del&gt;&lt;/a&gt; too!&lt;br/&gt;
My only comment would be that perhaps it would be better to use a substitute to something generic rather than a delete of the traceDirectory lines.  If you feel so motivated you could submit a followon patch.&lt;/p&gt;

&lt;p&gt;Date: Fri Oct 14 18:22:15 2005&lt;br/&gt;
New Revision: 321274&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=321274&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=321274&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="12332498" author="army" created="Thu, 20 Oct 2005 04:47:17 +0100"  >&lt;p&gt;The patch for this has been committed and I verified that the example shown in this description now works against the trunk, as do the new test cases in derbynet/testProperties.  Should this fix be ported to 10.1?  The Fix version is only specified as 10.2.0.0, so if that&apos;s correct, I&apos;ll go ahead and resolve/close this issue...&lt;/p&gt;</comment>
                            <comment id="12332500" author="deepa" created="Thu, 20 Oct 2005 05:02:03 +0100"  >&lt;p&gt;Thanks for verifying. I was not planning to merge this to 10.1. You may close this issue.&lt;/p&gt;</comment>
                            <comment id="12332501" author="army" created="Thu, 20 Oct 2005 05:12:22 +0100"  >&lt;p&gt;Patch was reviewed and applied to trunk with svn 321274.  I verified that the issue has been fixed in the trunk, so I am now resolving and closing this issue.&lt;/p&gt;</comment>
                            <comment id="12332639" author="deepa" created="Fri, 21 Oct 2005 07:48:23 +0100"  >&lt;p&gt;Re-opening to merge  fix to 10.1&lt;/p&gt;</comment>
                            <comment id="12332640" author="deepa" created="Fri, 21 Oct 2005 07:52:36 +0100"  >&lt;p&gt;I merged this fix to my 10.1 codeline and ran derbyall with Sun JDK 1.4.2 on Windows XP. 2 failures:&lt;br/&gt;
derbyall/derbyall.fail:unit/T_Diagnosticable.unit (This test passed when I re-ran it)&lt;br/&gt;
derbyall/derbyall.fail:i18n/iepnegativetests_ES.sql (master update issue)&lt;/p&gt;

&lt;p&gt;Merge command:&lt;br/&gt;
svn merge -r 321273:321274 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk&lt;/a&gt;&lt;br/&gt;
svn merge -r 326288:326289 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please merge this to 10.1 branch. Thanks.&lt;/p&gt;</comment>
                            <comment id="12332643" author="kmarsden" created="Fri, 21 Oct 2005 08:44:05 +0100"  >&lt;p&gt;Checked this fix which also fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-613&quot; title=&quot;Intended location of network server tracing files is not clear.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-613&quot;&gt;&lt;del&gt;DERBY-613&lt;/del&gt;&lt;/a&gt; into 10.1&lt;/p&gt;

&lt;p&gt;Date: Thu Oct 20 15:39:09 2005&lt;br/&gt;
New Revision: 327018&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=327018&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=327018&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12332648" author="deepa" created="Fri, 21 Oct 2005 10:02:55 +0100"  >&lt;p&gt;Verified in 10.1 by running the example in description.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12314891" name="derby-375.diff" size="11108" author="deepa" created="Sat, 15 Oct 2005 09:48:34 +0100"/>
                            <attachment id="12314892" name="derby-375.status" size="615" author="deepa" created="Sat, 15 Oct 2005 09:48:34 +0100"/>
                            <attachment id="12314893" name="derbyall_report.txt" size="13490" author="deepa" created="Sat, 15 Oct 2005 09:48:34 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12317978">DERBY-629</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 30 Jun 2005 05:50:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21923</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy17mf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40885</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>