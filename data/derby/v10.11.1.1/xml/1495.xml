<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:32:56 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1495/DERBY-1495.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1495] Attempt to modify an identity column error after resetting identity column</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1495</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When an identity counter is altered using the ALTER TABLE statement below, it seems as if the GENERATED BY DEFAULT behavior is lost.&lt;br/&gt;
The following statements will reproduce the error.&lt;/p&gt;

&lt;p&gt;CREATE TABLE MYTABLE (&lt;br/&gt;
  id   INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) NOT NULL&lt;br/&gt;
 ,col2 INT NOT NULL&lt;br/&gt;
)&lt;/p&gt;

&lt;p&gt;&amp;#8211; Insert using an explicit value on the ID-field&lt;br/&gt;
INSERT INTO MYTABLE(ID, COL2) VALUES(2, 2)&lt;/p&gt;

&lt;p&gt;&amp;#8211; Reset the identity field&lt;br/&gt;
ALTER TABLE mytable ALTER COLUMN id RESTART WITH 3&lt;/p&gt;

&lt;p&gt;&amp;#8211; Try inserting another explicit value and the error below is thrown.&lt;br/&gt;
INSERT INTO MYTABLE(ID, COL2) VALUES(4, 4)&lt;/p&gt;

&lt;p&gt;Error: SQL Exception: Attempt to modify an identity column &apos;ID&apos;. , SQL State: 42Z23, Error Code: 30000&lt;/p&gt;

&lt;p&gt;&amp;#8211; Although, this works fine&lt;br/&gt;
INSERT INTO MYTABLE(COL2) VALUES(4)&lt;/p&gt;</description>
                <environment>Java 1.5.0_06-b05 on Linux Ubuntu 5.10. Derby version 10.2.0.3-412239</environment>
        <key id="12345725">DERBY-1495</key>
            <summary>Attempt to modify an identity column error after resetting identity column</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="gramark">Lars Gr&#229;mark</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Jul 2006 05:50:24 +0100</created>
                <updated>Thu, 13 Dec 2007 09:05:02 +0000</updated>
                            <resolved>Mon, 13 Nov 2006 20:38:11 +0000</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.2.0</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12430083" author="tsuresh" created="Wed, 23 Aug 2006 20:36:57 +0100"  >&lt;p&gt;I came across this issue while doing a buddy testing for alter table with RESTART .  It is  really irritating  for  an user to  try  alter table with restart on  GENERATED BY DEFAULT COLUMN and    find , he/she can not insert  values manually.   I think  , this bug should get fixed for 10.2 , if possible .&lt;/p&gt;



</comment>
                            <comment id="12436168" author="jimisola" created="Wed, 20 Sep 2006 09:29:11 +0100"  >&lt;p&gt;Seems as if a lot of people have came across this issue. It was reported more than two months ago and still no action - not even a comment from the developer team.&lt;/p&gt;

&lt;p&gt;This issue has minor priority, but it should be considered MAJOR. We currently have to copy the Derby database back-and-forth due to this issue.&lt;br/&gt;
I sincerely hope that this will get into 10.2. Especially, since Derby 10.2 will be the JavaDB shipped with the JDK (if am not mistaking).&lt;/p&gt;

</comment>
                            <comment id="12436230" author="kristwaa" created="Wed, 20 Sep 2006 14:29:52 +0100"  >&lt;p&gt;I&apos;m taking a brief look at this. If someone with more knowledge wants to help, or fix the bug, let me know &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Note that the same problem occur if you try to change the increment of the identity column.&lt;/p&gt;</comment>
                            <comment id="12436243" author="bryanpendleton" created="Wed, 20 Sep 2006 15:18:56 +0100"  >&lt;p&gt;Thanks Kristian for investigating this problem. My hunch is that all the fun happens&lt;br/&gt;
in AlterTableConstantAction.modifyColumnDefault. The ALTER TABLE statement&lt;br/&gt;
doesn&apos;t provide all the information about the column&apos;s auto-increment behaviors so&lt;br/&gt;
the modifyColumnDefault() method has to merge the new behaviors specified on&lt;br/&gt;
the ALTER TABLE statement with the existing behaviors that the column already has.&lt;/p&gt;

&lt;p&gt;My guess is that the problem lies in this merging process; the modifyColumnDefault()&lt;br/&gt;
method is not being careful enough to use the previous column behaviors in those&lt;br/&gt;
cases where the ALTER TABLE statement has not provided new behaviors.&lt;/p&gt;

&lt;p&gt;Hope this helps.&lt;/p&gt;</comment>
                            <comment id="12436262" author="alanbrito" created="Wed, 20 Sep 2006 16:45:01 +0100"  >&lt;p&gt;Note:&lt;br/&gt;
The same thing is happening in Derby 10.1.x when you try to change Set Increment By.  Please reference issue: &lt;a href=&quot;http://issues.apache.org/jira/browse/DERBY-1645&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/DERBY-1645&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;There is no With Restart command in 10.1.x, but I assume the behavior is related.&lt;/p&gt;

&lt;p&gt;Like the previous poster, I also had to jump through some hoops to get around this issue.&lt;/p&gt;
</comment>
                            <comment id="12436264" author="kristwaa" created="Wed, 20 Sep 2006 16:57:56 +0100"  >&lt;p&gt;Thanks Bryan.&lt;/p&gt;

&lt;p&gt;I have been able to determine what seems to be causing the problem, but have not yet understood how to fix it. This is my first venture into the this area of the code, so things are very unclear to me.&lt;/p&gt;

&lt;p&gt;First, after studying the various variables describing an identity column, I noticed that if the DefaultInfo assoiciated with an identity column is null, the column is said to be &quot;generated always as identity&quot;. In effect, the column definition is changed after the restart/increment operation, because the defaultInfo is set to null. This can be observed with the new describe command in ij.&lt;/p&gt;

&lt;p&gt;Bryan&apos;s guess seems to be valid, but if I add the old DefaultInfoImpl instance to the new one, I get a NPE when doing a drop on the table the next time I boot the database. It happens for &apos;BasicDependencyManager.clearDependencies&apos;. It also happens if I create a new instance (new DefaultInfoImpl(true,null,null)) and add it to the newly created ColumnDescriptor. This piece of the code is in AlterTableConstantAction.modifyColumnDefault, as Bryan mentioned.&lt;/p&gt;

&lt;p&gt;Is the error in this method, or does it happen earlier so the input is not as expected?&lt;br/&gt;
What step have I forgotten to do?&lt;/p&gt;

&lt;p&gt;I&apos;ll keep looking into this, but any piece of further advice is appreciated!&lt;/p&gt;</comment>
                            <comment id="12436538" author="kristwaa" created="Thu, 21 Sep 2006 15:01:44 +0100"  >&lt;p&gt;I&apos;m going on vacation for a week, so I won&apos;t be doing anything on this issue for a while.&lt;br/&gt;
Anyone should feel free to take over &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
The problem should be easy to find if you follow the hint Bryan gave in a comment above.&lt;br/&gt;
I don&apos;t have a preliminary patch I can post at this time, but what I found out is described in the comment above.&lt;/p&gt;</comment>
                            <comment id="12438134" author="bryanpendleton" created="Wed, 27 Sep 2006 15:22:55 +0100"  >&lt;p&gt;Possible duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1645&quot; title=&quot;ALTER TABLE ... SET INCREMENT BY X... Turns off the &amp;quot;Generated By Default&amp;quot; identity column constraint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1645&quot;&gt;&lt;del&gt;DERBY-1645&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="12443470" author="kristwaa" created="Thu, 19 Oct 2006 10:54:12 +0100"  >&lt;p&gt;Although the problem summaries are a bit different, these two issues seem to be caused by the same bug in Derby.&lt;/p&gt;</comment>
                            <comment id="12449064" author="bryanpendleton" created="Sun, 12 Nov 2006 00:36:19 +0000"  >&lt;p&gt;Attached is preserveColDefault_v1.diff, a proposed patch to solve this problem,&lt;br/&gt;
as well as to solve &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1645&quot; title=&quot;ALTER TABLE ... SET INCREMENT BY X... Turns off the &amp;quot;Generated By Default&amp;quot; identity column constraint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1645&quot;&gt;&lt;del&gt;DERBY-1645&lt;/del&gt;&lt;/a&gt;, which is closely related.&lt;/p&gt;

&lt;p&gt;Kristian, I was not able to reproduce the problems that you had in the&lt;br/&gt;
dependency system when dropping the table. Perhaps you could experiment&lt;br/&gt;
with this patch and see if you can reproduce those problems?&lt;/p&gt;</comment>
                            <comment id="12449313" author="kristwaa" created="Mon, 13 Nov 2006 11:05:15 +0000"  >&lt;p&gt;I have tested/reviewed the patch, and was unable to find any problems. More specifically, I did not see the error I saw when trying to fix the bug. Although my approach were pretty much the same, I suspect I might have done what Bryan did somewhere else in the code path (and in that way made something go wrong).&lt;/p&gt;

&lt;p&gt;I ran derbyall and suites.All with both Java SE 5 and 6. Only saw three known problems in derbyall (Compatibility and VerifySignatures).&lt;/p&gt;

&lt;p&gt;Patch is small and clean, everything seems to work and testcases have been added.&lt;br/&gt;
+1 to commit&lt;/p&gt;</comment>
                            <comment id="12449486" author="bryanpendleton" created="Mon, 13 Nov 2006 20:38:11 +0000"  >&lt;p&gt;Kristian, thank you very much for the review and the testing.&lt;/p&gt;

&lt;p&gt;I committed the patch to subversion as revision 474502.&lt;/p&gt;</comment>
                            <comment id="12449774" author="kartha" created="Tue, 14 Nov 2006 20:33:45 +0000"  >&lt;p&gt;Seems like a useful fix for the 10.2 branch also, is any committer planning to port the fix to 10.2 ?&lt;/p&gt;

&lt;p&gt;-Rajesh&lt;/p&gt;</comment>
                            <comment id="12449781" author="bryanpendleton" created="Tue, 14 Nov 2006 20:56:16 +0000"  >&lt;p&gt;Hi Rajesh, I think that is a good suggestion. I will investigate merging this fix to 10.2.&lt;/p&gt;</comment>
                            <comment id="12449788" author="jimisola" created="Tue, 14 Nov 2006 21:16:24 +0000"  >&lt;p&gt;Backporting the fix to 10.2 would be highly appreciated.&lt;/p&gt;</comment>
                            <comment id="12449870" author="bryanpendleton" created="Wed, 15 Nov 2006 00:15:16 +0000"  >&lt;p&gt;The merge to 10.2 was clean, and my testing was successful. Submitted the merged&lt;br/&gt;
change to the 10.2 branch as revision 475081&lt;/p&gt;</comment>
                            <comment id="12449992" author="kristwaa" created="Wed, 15 Nov 2006 12:12:54 +0000"  >&lt;p&gt;Should the Fix Version be updated to reflect that the fix is in the 10.2 branch as well?&lt;br/&gt;
If so, this goes for the related Jira issue too.&lt;/p&gt;</comment>
                            <comment id="12450057" author="bryanpendleton" created="Wed, 15 Nov 2006 15:20:07 +0000"  >&lt;p&gt;Adding 10.2.1.8 Fix Version to reflect the merging of this fix to 10.2 branch. Thanks Kristian for catching this.&lt;/p&gt;</comment>
                            <comment id="12551368" author="fuzzylogic" created="Thu, 13 Dec 2007 09:05:02 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12347331">DERBY-1645</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12344819" name="preserveColDefault_v1.diff" size="9505" author="bryanpendleton" created="Sun, 12 Nov 2006 00:36:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Aug 2006 19:36:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22539</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy106v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39681</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>