<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:41:11 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4110/DERBY-4110.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4110] When deleting rows from a table name with its synonym name, Derby throws SQLSTATE 42X04.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4110</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Getting an error (using Derby 10.4.1.3) when deleting records from a table using a qualified synonymn name.&lt;br/&gt;
Table Name is ABC_PROCESS_INVOCATION_XML and the synonmyn name is SYN_ABC_P_I_X&lt;/p&gt;

&lt;p&gt;The query being fired was&lt;br/&gt;
&quot;Delete from SYN_ABC_P_I_X where ID = ? &quot;&lt;/p&gt;

&lt;p&gt;from the error log&lt;br/&gt;
---------------&lt;br/&gt;
Caused by: ERROR 42X04: Column &apos;APP.ABC_PROCESS_INVOCATION_XML.ID&apos; is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE  statement then &apos;APP.ABC_PROCESS_INVOCATION_XML.ID&apos; is not a column in the target table.&lt;br/&gt;
---------------&lt;/p&gt;

&lt;p&gt;After going thru few earlier bugs, a similar bug has been logged earlier bug &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1784&quot; title=&quot;When qualifying a column name with its synonym name in the select list, Derby throws SQLSTATE 42X04.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1784&quot;&gt;&lt;del&gt;DERBY-1784&lt;/del&gt;&lt;/a&gt; &lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/browse/DERBY-1784&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/DERBY-1784&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But looks like the fix did not make its way to 10.4.1.3?&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12419205">DERBY-4110</key>
            <summary>When deleting rows from a table name with its synonym name, Derby throws SQLSTATE 42X04.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="prasanna_pramati">Lakshmi Prasanna</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Mar 2009 10:17:39 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:13 +0100</updated>
                            <resolved>Thu, 7 Jan 2010 00:11:23 +0000</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12726600" author="rhillegas" created="Thu, 2 Jul 2009 19:26:06 +0100"  >&lt;p&gt;Triaged July 2, 2009: Downgrading urgency to normal.&lt;/p&gt;</comment>
                            <comment id="12781211" author="bryanpendleton" created="Sun, 22 Nov 2009 20:29:00 +0000"  >&lt;p&gt;I ran the script from &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1784&quot; title=&quot;When qualifying a column name with its synonym name in the select list, Derby throws SQLSTATE 42X04.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1784&quot;&gt;&lt;del&gt;DERBY-1784&lt;/del&gt;&lt;/a&gt; against both the 10.4.1.3 release as well as against the trunk,&lt;br/&gt;
and the script runs fine, so it appears that &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1784&quot; title=&quot;When qualifying a column name with its synonym name in the select list, Derby throws SQLSTATE 42X04.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1784&quot;&gt;&lt;del&gt;DERBY-1784&lt;/del&gt;&lt;/a&gt; is definitely fixed both in 10.4.1.3&lt;br/&gt;
as well as in the trunk. I also checked the subversion logs, and they show that the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1784&quot; title=&quot;When qualifying a column name with its synonym name in the select list, Derby throws SQLSTATE 42X04.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1784&quot;&gt;&lt;del&gt;DERBY-1784&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
fix is present in both places. So I think that the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1784&quot; title=&quot;When qualifying a column name with its synonym name in the select list, Derby throws SQLSTATE 42X04.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1784&quot;&gt;&lt;del&gt;DERBY-1784&lt;/del&gt;&lt;/a&gt; fix is fine.&lt;/p&gt;

&lt;p&gt;Below is the output of the script I ran.&lt;/p&gt;

&lt;p&gt;Is there a script which can reproduce this problem more exactly, either in 10.4.1.3 or in the trunk?&lt;/p&gt;

&lt;p&gt;C:\temp\d1784&amp;gt;java -cp \tools\derby\db-derby-10.4.1.3-bin\lib\derbyrun.jar org.apache.derby.tools.ij&lt;br/&gt;
ij version 10.4&lt;br/&gt;
ij&amp;gt; run &apos;/temp/d1784.sql&apos;;&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:wombat;create=true&apos; user &apos;user1&apos; as user1;&lt;br/&gt;
ij&amp;gt; create schema test1;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create schema test2;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create table test1.t1 ( id bigint not null );&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into test1.t1 values (1),(2);&lt;br/&gt;
2 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create synonym test2.t1 for test1.t1;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; set schema test1;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select t1.id from t1;&lt;br/&gt;
ID&lt;br/&gt;
--------------------&lt;br/&gt;
1&lt;br/&gt;
2&lt;/p&gt;

&lt;p&gt;2 rows selected&lt;br/&gt;
ij&amp;gt; set schema test2;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select t1.id from t1;&lt;br/&gt;
ID&lt;br/&gt;
--------------------&lt;br/&gt;
1&lt;br/&gt;
2&lt;/p&gt;

&lt;p&gt;2 rows selected&lt;br/&gt;
ij&amp;gt; select id from t1;&lt;br/&gt;
ID&lt;br/&gt;
--------------------&lt;br/&gt;
1&lt;br/&gt;
2&lt;/p&gt;

&lt;p&gt;2 rows selected&lt;br/&gt;
ij&amp;gt; delete from t1 where id = 2;&lt;br/&gt;
1 row inserted/updated/deleted&lt;/p&gt;
</comment>
                            <comment id="12782340" author="bjustx" created="Wed, 25 Nov 2009 08:31:10 +0000"  >&lt;p&gt;I have the same Problem. We are already working with Derby 10.1.3.1. We upgraded to Version 10.5.3.0 and encrypted the database with dataEncryption=true. Everything works fine. Only deletes on synonym tables fail with ERROR 42X04 and the mentioned message. I have also tried 10.4.1.3 and it also failed.&lt;/p&gt;</comment>
                            <comment id="12782450" author="bryanpendleton" created="Wed, 25 Nov 2009 14:37:47 +0000"  >&lt;p&gt;Thanks Boris.&lt;/p&gt;

&lt;p&gt;Do you have a script you can contribute which demonstrates the problem?&lt;/p&gt;

&lt;p&gt;Can you run the script that I posted above? Does it fail for you in 10.4.1.3?&lt;/p&gt;</comment>
                            <comment id="12782515" author="bjustx" created="Wed, 25 Nov 2009 17:19:37 +0000"  >&lt;p&gt;Hi Bryan!&lt;br/&gt;
There is a difference between your script and my definition. In addition I have defined an unique index on the table badax.r058100.&lt;br/&gt;
Without index it also works on my database.&lt;/p&gt;

&lt;p&gt;IJ Version 10.5&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:d:\temp\testDB;create=true&apos;;&lt;br/&gt;
ij&amp;gt; create schema BADAX;&lt;br/&gt;
0 Zeilen eingef&#179;gt/aktualisiert/gel&#247;scht&lt;br/&gt;
ij&amp;gt; create table BADAX.R058100 (CHGTSP TIMESTAMP, DELFLAG CHAR(1), LIZENZ INTEGER, KUNDNR INTEGER, ERSTTSP TIMESTAMP, LFDNR SMALLINT, KONTAKTART CHAR(2), KONTAKTDAT INTEGER, SCHLAGW CHAR(60), TXT VARCHAR(2048), ERSTSPARTE CHAR(4), ERSTPRODNR CHAR(11), ERSTPGM CHAR(8), VERSION SMALLINT);&lt;br/&gt;
0 Zeilen eingef&#179;gt/aktualisiert/gel&#247;scht&lt;br/&gt;
ij&amp;gt; create synonym BADAX.Q058100 FOR BADAX.R058100;&lt;br/&gt;
0 Zeilen eingef&#179;gt/aktualisiert/gel&#247;scht&lt;br/&gt;
ij&amp;gt; CREATE UNIQUE INDEX XR0581B ON BADAX.R058100(LIZENZ,KUNDNR,LFDNR,ERSTTSP);&lt;br/&gt;
0 Zeilen eingef&#179;gt/aktualisiert/gel&#247;scht&lt;br/&gt;
ij&amp;gt; insert into &quot;BADAX&quot;.&quot;R058100&quot; (&quot;CHGTSP&quot;, &quot;DELFLAG&quot;, &quot;LIZENZ&quot;, &quot;KUNDNR&quot;, &quot;ERS&lt;br/&gt;
TTSP&quot;, &quot;LFDNR&quot;, &quot;KONTAKTART&quot;, &quot;KONTAKTDAT&quot;, &quot;SCHLAGW&quot;, &quot;TXT&quot;, &quot;ERSTSPARTE&quot;, &quot;ERS&lt;br/&gt;
TPRODNR&quot;, &quot;ERSTPGM&quot;, &quot;VERSION&quot;) values (&apos;2009-10-16 13:38:21.781&apos;, &apos;A&apos;, 105911,1&lt;br/&gt;
377917, &apos;2009-10-16 13:38:21.781&apos;, 999, &apos;F &apos;, 20091016, &apos;Fonds-Polizze/08&lt;br/&gt;
                               &apos;, &apos;&amp;lt;dokumente&amp;gt;&amp;lt;dokument logicalID=&quot;2009-10-16-13&lt;br/&gt;
.38.21.734000&quot; physicalID=&quot;P1255693101734.pdf&quot; status=&quot;V&quot;/&amp;gt;&amp;lt;/dokumente&amp;gt;&apos;, &apos;    &apos;&lt;br/&gt;
, &apos;           &apos;, &apos;        &apos;, 0);&lt;br/&gt;
1 Zeile eingef&#179;gt/aktualisiert/gel&#247;scht&lt;br/&gt;
ij&amp;gt; delete from BADAX.Q058100;&lt;br/&gt;
FEHLER 42X04: Die Spalte &apos;BADAX.R058100.LIZENZ&apos; ist in keiner Tabelle der FROM-L&lt;br/&gt;
iste enthalten, erscheint in einer Verkn&#179;pfungsspezifikation und befindet sich a&lt;br/&gt;
u&#9600;erhalb des Geltungsbereichs derselben oder erscheint in einer HAVING-Klausel u&lt;br/&gt;
nd ist nicht in der &apos;GROUP BY&apos;-Liste enthalten. Wenn es sich um eine Anweisung C&lt;br/&gt;
REATE oder ALTER TABLE handelt, ist &apos;BADAX.R058100.LIZENZ&apos; keine Spalte in der Z&lt;br/&gt;
ieltabelle.&lt;/p&gt;</comment>
                            <comment id="12782533" author="bryanpendleton" created="Wed, 25 Nov 2009 17:55:42 +0000"  >&lt;p&gt;Thanks Boris! Adding the CREATE UNIQUE INDEX did the trick.&lt;/p&gt;

&lt;p&gt;I can now reproduce the strange behavior in both the 10.4 release and in the trunk.&lt;/p&gt;

&lt;p&gt;Attached is &apos;repro.sql&apos;, which causes the strange message to appear.&lt;/p&gt;

&lt;p&gt;I&apos;ll see if I can figure out what is going on under the covers.&lt;/p&gt;</comment>
                            <comment id="12782573" author="bryanpendleton" created="Wed, 25 Nov 2009 19:34:56 +0000"  >&lt;p&gt;I see that UpdateNode and InsertNode have some special code in their&lt;br/&gt;
bindStatement() methods to call normalizeSynonymColumns, but&lt;br/&gt;
DeleteNode does not have such special code. That looks intriguing,&lt;br/&gt;
so I&apos;ll chase that theory for a while...&lt;/p&gt;</comment>
                            <comment id="12784252" author="bryanpendleton" created="Tue, 1 Dec 2009 14:51:45 +0000"  >&lt;p&gt;The patch below appears to make the repro script pass, and appears to cause&lt;br/&gt;
no other ill effects (in simple testing). The idea behind the patch is that when&lt;br/&gt;
building the ResultColumnList that is used to tie together the search results&lt;br/&gt;
from the WHERE clause with the processing of the DELETE, the result columns&lt;br/&gt;
will be bound against the exposed table name of the table named in the DELETE&lt;br/&gt;
statement, so if the statement used a synonymTableName, then the result&lt;br/&gt;
column list should manufacture column references which use a synonymTableName as well.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure about the operation of the &apos;normalizeSynonymColumns&apos; code that I&lt;br/&gt;
commented on last week; I don&apos;t understand exactly when that code comes into play,&lt;br/&gt;
but it does NOT appear to be relevant to this particular case. I think it has more to&lt;br/&gt;
do with the fact that INSERT and UPDATE can refer to a named set of columns which&lt;br/&gt;
are to be affected by the statement, whereas DELETE operates on the entire row.&lt;/p&gt;

&lt;p&gt;Anyway, here&apos;s the patch I&apos;m currently pursuing:&lt;/p&gt;

&lt;p&gt;Index: java/engine/org/apache/derby/impl/sql/compile/DMLModStatementNode.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; java/engine/org/apache/derby/impl/sql/compile/DMLModStatementNode.java  (revision 885667)&lt;br/&gt;
+++ java/engine/org/apache/derby/impl/sql/compile/DMLModStatementNode.java  (working copy)&lt;br/&gt;
@@ -361,7 +361,7 @@&lt;br/&gt;
      (FromBaseTable)&lt;br/&gt;
        (getNodeFactory().getNode(&lt;br/&gt;
                    C_NodeTypes.FROM_BASE_TABLE,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;targetTableName,&lt;br/&gt;
+                   synonymTableName != null ? synonymTableName : targetTableName,&lt;br/&gt;
                    null,&lt;br/&gt;
                    null,&lt;br/&gt;
                    null,&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12793900" author="bryanpendleton" created="Wed, 23 Dec 2009 02:39:14 +0000"  >&lt;p&gt;Attached is a patch proposal containing the code change and a regression&lt;br/&gt;
test based on the repro script.&lt;/p&gt;

&lt;p&gt;The full regression test was clean.&lt;/p&gt;

&lt;p&gt;Any suggestions for additional regression tests, particularly w.r.t. synonym&lt;br/&gt;
handling, are welcome.&lt;/p&gt;

&lt;p&gt;I&apos;m proposing to commit this patch, since it appears to resolve the&lt;br/&gt;
repro script and doesn&apos;t break any other tests.&lt;/p&gt;</comment>
                            <comment id="12794119" author="knutanders" created="Wed, 23 Dec 2009 17:35:25 +0000"  >&lt;p&gt;+1 to commit. This looks like an improvement to me. I won&apos;t claim that I have understood if/how normalizeSynonymColumns() should come into play here, though...&lt;/p&gt;</comment>
                            <comment id="12797406" author="bryanpendleton" created="Thu, 7 Jan 2010 00:11:23 +0000"  >&lt;p&gt;Thanks for the code review, Knut. I don&apos;t have any further improvements&lt;br/&gt;
to make to this patch at this time, so I&apos;m committing it to the trunk for&lt;br/&gt;
further shakeout and usage.&lt;/p&gt;

&lt;p&gt;Committed to the trunk as revision 896722.&lt;/p&gt;

&lt;p&gt;I&apos;m not planning to backport this fix to earlier branches at this time,&lt;br/&gt;
although I don&apos;t think it would be hard to do, if somebody else wants to.&lt;/p&gt;</comment>
                            <comment id="13685166" author="knutanders" created="Mon, 17 Jun 2013 10:19:13 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12428790" name="patch.diff" size="2514" author="bryanpendleton" created="Wed, 23 Dec 2009 02:39:14 +0000"/>
                            <attachment id="12426125" name="repro.sql" size="413" author="bryanpendleton" created="Wed, 25 Nov 2009 17:55:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 2 Jul 2009 18:26:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24031</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0rdr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38254</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>