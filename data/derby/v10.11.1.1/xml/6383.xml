<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:30:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6383/DERBY-6383.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6383] Update trigger defined on one column fires on update of other columns</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6383</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I see this problem on 10.8 and higher. To reproduce, create a database with a trigger like this:&lt;/p&gt;

&lt;p&gt;connect &apos;jdbc:derby:trigdb;create=true&apos;;&lt;br/&gt;
create table t1(x int, y int);&lt;br/&gt;
create table t2(x int, y int);&lt;br/&gt;
create trigger tr after update of x on t1 referencing old table as old insert into t2 select * from old;&lt;/p&gt;

&lt;p&gt;Then run dblook on the database, and you&apos;ll see the following output:&lt;/p&gt;

&lt;p&gt;&amp;#8211; ----------------------------------------------&lt;br/&gt;
&amp;#8211; DDL Statements for triggers&lt;br/&gt;
&amp;#8211; ----------------------------------------------&lt;/p&gt;

&lt;p&gt;CREATE TRIGGER &quot;APP&quot;.&quot;TR&quot; AFTER UPDATE OF &quot;X&quot;, &quot;Y&quot; ON &quot;APP&quot;.&quot;T1&quot; REFERENCING OLD_TABLE AS OLD FOR EACH STATEMENT insert into t2 select * from old;&lt;/p&gt;

&lt;p&gt;Notice that the DDL creates an update trigger for columns X and Y, whereas the original trigger was defined on column X only.&lt;/p&gt;

&lt;p&gt;I see the expected DDL on 10.7.1.1.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12674782">DERBY-6383</key>
            <summary>Update trigger defined on one column fires on update of other columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                            <label>backport_reject_10_6</label>
                    </labels>
                <created>Mon, 21 Oct 2013 13:33:28 +0100</created>
                <updated>Wed, 6 Aug 2014 01:21:29 +0100</updated>
                            <resolved>Thu, 14 Nov 2013 07:28:08 +0000</resolved>
                                    <version>10.7.1.4</version>
                    <version>10.8.1.2</version>
                    <version>10.9.1.0</version>
                    <version>10.10.1.1</version>
                                    <fixVersion>10.7.1.4</fixVersion>
                    <fixVersion>10.8.3.3</fixVersion>
                    <fixVersion>10.9.2.2</fixVersion>
                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13802842" author="knutanders" created="Wed, 23 Oct 2013 13:16:19 +0100"  >&lt;p&gt;This is actually more serious than dblook showing incorrect information. The trigger that was defined on update of column X does in fact fire on update of column Y as well. The attached script d6383.sql reproduces the bug:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ij&amp;gt; connect &apos;jdbc:derby:memory:db;create=true&apos;;
ij&amp;gt; create table t1(x int, y int);
0 rows inserted/updated/deleted
ij&amp;gt; create table t2(x int, y int);
0 rows inserted/updated/deleted
ij&amp;gt; insert into t1 values (1,2);
1 row inserted/updated/deleted
ij&amp;gt; -- create a trigger on update of T1(X)
create trigger t1 after update of x on t1 referencing old table as old insert into t2 select * from old;
0 rows inserted/updated/deleted
ij&amp;gt; -- update T1(Y), should not fire the trigger
update t1 set y = y + 1;
1 row inserted/updated/deleted
ij&amp;gt; -- trigger should not fire, so T2 should be empty
select * from t2;
X          |Y          
-----------------------
1          |2          

1 row selected
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With 10.7.1.1 and earlier the final SELECT query returns no rows, which means the trigger had not fired. This is the correct behaviour, I believe.&lt;/p&gt;

&lt;p&gt;With 10.7.1.4 and higher, the SELECT query returns one row (as seen above), which means the trigger had fired.&lt;/p&gt;</comment>
                            <comment id="13802844" author="knutanders" created="Wed, 23 Oct 2013 13:18:51 +0100"  >&lt;p&gt;Updated the bug title to reflect that the bug affects how the trigger is fired and not just how it&apos;s shown by dblook.&lt;/p&gt;</comment>
                            <comment id="13802860" author="knutanders" created="Wed, 23 Oct 2013 13:55:42 +0100"  >&lt;p&gt;It looks like the behaviour was changed in this commit:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;r1044096 | mamta | 2010-12-09 20:19:42 +0100 (Thu, 09 Dec 2010) | 14 lines&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4874&quot; title=&quot;Trigger does not recognize new size of VARCHAR column  expanded with ALTER TABLE. It fails with ERROR 22001: A truncation error was encountered trying to shrink VARCHAR &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4874&quot;&gt;&lt;del&gt;DERBY-4874&lt;/del&gt;&lt;/a&gt; Trigger does not recognize new size of VARCHAR column expanded with ALTER TABLE. It fails with ERROR 22001: A truncation error was encountered trying to shrink VARCHAR&lt;/p&gt;

&lt;p&gt;The trigger action associated with a trigger gets converted as shown in the example below. This transformation happens if the trigger action has REFERENCEs clause.&lt;br/&gt;
	update xr.repositoryobjectversion set uname = upper( n.name )&lt;br/&gt;
	  where name = n.name and uname &amp;lt;&amp;gt; upper( n.name );&lt;br/&gt;
	turns into&lt;br/&gt;
	update xr.repositoryobjectversion set uname = &lt;br/&gt;
	  upper( CAST (org.apache.derby.iapi.db.Factory::getTriggerExecutionContext().getNewRow().getObject(3) AS VARCHAR(128)) ) &lt;br/&gt;
	  where name = CAST (org.apache.derby.iapi.db.Factory::getTriggerExecutionContext().getNewRow().getObject(3) AS VARCHAR(128))&lt;br/&gt;
As can be seen above, there is a CASTing involved which uses the length of the column in trigger table. &lt;/p&gt;

&lt;p&gt;If say that length is changed by ALTER TABLE after the trigger has been created, that change in the length does not get reflected in the sql associated with the trigger action in the form on SPSDescriptor. In order to fix this, I have made changes which willcause us to regenerate the sql from the trigger action for the SPSDescriptor if we are working with an invalidated row level trigger which uses the REFERENCEs clause.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13804439" author="mamtas" created="Thu, 24 Oct 2013 18:35:52 +0100"  >&lt;p&gt;I will take a look at this jira&lt;/p&gt;</comment>
                            <comment id="13805083" author="mamtas" created="Fri, 25 Oct 2013 07:25:29 +0100"  >&lt;p&gt;I will have a patch ready by tomorrow. I found that this issue is for statement triggers. Row triggers work fine. For the reproduction ij script  provided by Knut, if we add a row level trigger as shown below, it will cause the row trigger to fire only when we update the column on which row trigger is defined.&lt;/p&gt;

&lt;p&gt;create trigger t2 after update of x on t1 referencing old as old_row for each row insert into t2 values(old_row.x, old_row.y);&lt;br/&gt;
update t1 set y = y + 1;&lt;br/&gt;
select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from t2;&lt;br/&gt;
update t1 set x = x + 1;&lt;br/&gt;
select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from t2;&lt;/p&gt;</comment>
                            <comment id="13807587" author="mamtas" created="Tue, 29 Oct 2013 01:59:06 +0000"  >&lt;p&gt;Attaching a patch to fix the issue. We were incorrectly marking the statement trigger to fire for all the columns on the table rather than the ones identified by the CREATE TRIGGER statement. Next, I will add a junit test and also an upgrade test. But in the meantime, please let me know if there are any comments.&lt;/p&gt;</comment>
                            <comment id="13808098" author="knutanders" created="Tue, 29 Oct 2013 15:40:51 +0000"  >&lt;p&gt;Thanks for looking at this bug, Mamta. The suggested fix looks reasonable to me. You might also want to change a comment further up in that method, which implies that only row-level triggers can be defined on specific columns:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;			//This is the most interesting case for us. If we are here, &lt;br/&gt;
			//then it means that the trigger is defined at the row level&lt;br/&gt;
			//and a set of trigger columns are specified in the CREATE&lt;br/&gt;
			//TRIGGER statement. This can only happen for an UPDATE&lt;br/&gt;
			//trigger.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I stepped through the code in a debugger and found that the code was executed for statement-level triggers too, so the part that says that &quot;the trigger is defined at the row level&quot; is not correct.&lt;/p&gt;</comment>
                            <comment id="13809748" author="mamtas" created="Wed, 30 Oct 2013 23:23:14 +0000"  >&lt;p&gt;Knut, thanks so much for reviewing the patch. &lt;/p&gt;

&lt;p&gt;I am attaching a new patch DERBY6383_patch2_diff.txt(which is not ready for commit). It takes care of Knut&apos;s comment and adds a junit test and adds an upgrade test. I am having problems with the upgrade tests and am wondering if the failure rings a bell to anyone. Basically, the junit tests(suites.All which includes upgrade suite)works perfectly fine with my patch *&lt;b&gt;if I disable the newly added upgrade suite in the attached patch&lt;/b&gt;*. But if I include my new upgrade fixture in the upgrade suite and run suites.All, I am getting errors similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5947&quot; title=&quot;Factor out common code from generated classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5947&quot;&gt;&lt;del&gt;DERBY-5947&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6203&quot; title=&quot;Intermittent assert failure in StoredPage.initSlotTable() when running upgrade tests on 10.9 branch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6203&quot;&gt;&lt;del&gt;DERBY-6203&lt;/del&gt;&lt;/a&gt;. Further more, some other upgrade tests fail after them but it may be the side effects of the failures seen by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5947&quot; title=&quot;Factor out common code from generated classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5947&quot;&gt;&lt;del&gt;DERBY-5947&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6203&quot; title=&quot;Intermittent assert failure in StoredPage.initSlotTable() when running upgrade tests on 10.9 branch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6203&quot;&gt;&lt;del&gt;DERBY-6203&lt;/del&gt;&lt;/a&gt;. I am attaching the output of the stand alone upgrade suite(upgradeTests._Suite) run for reference(this upgrade suite was run with my newly added upgrade test in the patch) as runall.out. Additionally, I have also attached error-stacktrace and derby.log for testTriggers and testDisposableStatisticsExplicit.&lt;/p&gt;

&lt;p&gt;I will try to narrow down the releases that we include for upgrade suite to see if I can have a shorter upgrade suite to share which runs into the problems I am experiencing. Appreciate all the help. Thanks.&lt;/p&gt;</comment>
                            <comment id="13810190" author="knutanders" created="Thu, 31 Oct 2013 12:24:37 +0000"  >&lt;p&gt;I think this failure means the test change made the create phase corrupt the SYSSTATEMENTS table when running the upgrade tests against 10.5.1.1, 10.5.3.0, 10.6.1.0 or 10.6.2.1. The corruption happens because of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4577&quot; title=&quot;An expanding update fails with an nospc.U error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4577&quot;&gt;&lt;del&gt;DERBY-4577&lt;/del&gt;&lt;/a&gt;. When the upgrade test tries to boot the corrupted database in soft upgrade mode, an assert added in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4577&quot; title=&quot;An expanding update fails with an nospc.U error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4577&quot;&gt;&lt;del&gt;DERBY-4577&lt;/del&gt;&lt;/a&gt; detects the corruption and raises an error.&lt;/p&gt;

&lt;p&gt;Since the corruption happens in old, already released versions of Derby, and it&apos;s too late to fix the bug in those versions now, I think we could just disable this test case if the old version suffers from &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4577&quot; title=&quot;An expanding update fails with an nospc.U error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4577&quot;&gt;&lt;del&gt;DERBY-4577&lt;/del&gt;&lt;/a&gt; (that is, older than 10.7.1.1).&lt;/p&gt;

&lt;p&gt;Actually, I don&apos;t think this is the kind of bug fix where we usually add an upgrade test. The patch doesn&apos;t attempt to fix this problem for existing triggers on upgrade (I don&apos;t think it could, since the information about which columns the original CREATE TRIGGER statement specified is lost). The main difference between the upgrade test case and the TriggerTest test case seems to be that the upgrade test case verifies that CREATE TRIGGER doesn&apos;t work as expected on some specific old versions. Since the behaviour of the already released versions is never going to change, we don&apos;t need to spend time testing that behaviour. The testing of the behaviour of the new version looks more or less the same as what was added to TriggerTest, so maybe it would be good enough coverage if we simply skipped the upgrade test case. Then we&apos;d avoid the problem of having to find a workaround for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4577&quot; title=&quot;An expanding update fails with an nospc.U error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4577&quot;&gt;&lt;del&gt;DERBY-4577&lt;/del&gt;&lt;/a&gt; altogether.&lt;/p&gt;</comment>
                            <comment id="13810528" author="mamtas" created="Thu, 31 Oct 2013 18:32:02 +0000"  >&lt;p&gt;Knut, you are right about upgrade test demonstrating what does not work in releases with defect &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt; and newly created triggers on soft-upgraded or hard-upgraded triggers working correctly. I will go ahead and remove the upgrade test so we don&apos;t need to find a workaround to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4577&quot; title=&quot;An expanding update fails with an nospc.U error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4577&quot;&gt;&lt;del&gt;DERBY-4577&lt;/del&gt;&lt;/a&gt;. Also, I will go ahead and create a new jira to see if we can add another column to SYSTRIGGERS table to save the CREATE TRIGGER sql for cases like this jira. This saved sql can be used in tiring to fix the bugs by recreating the SYSTRIGGERS row information if needed during soft-upgrade or hard-upgrade. In this jira, the only way to fix the problem is to manually drop and recreate the STATEMENT triggers after sof/hard upgrade since we do not have information on what columns the CREATE TRIGGER was created on.&lt;/p&gt;</comment>
                            <comment id="13810588" author="jira-bot" created="Thu, 31 Oct 2013 19:29:02 +0000"  >&lt;p&gt;Commit 1537593 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1537593&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1537593&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns). &lt;/p&gt;

&lt;p&gt;This regression is caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4874&quot; title=&quot;Trigger does not recognize new size of VARCHAR column  expanded with ALTER TABLE. It fails with ERROR 22001: A truncation error was encountered trying to shrink VARCHAR &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4874&quot;&gt;&lt;del&gt;DERBY-4874&lt;/del&gt;&lt;/a&gt;(Trigger does not recognize new size of VARCHAR column expanded with ALTER TABLE. It fails with ERROR 22001: A truncation error was&lt;br/&gt;
encountered trying to shrink VARCHAR)&lt;/p&gt;

&lt;p&gt;The regression is for Statement level triggers. The statement trigger gets fired incorrectly for any column update rather than just the column specified in the UPDATE of column clause. The fix is going to ensure that SYSTRIGGERS has the correct list of columns on which trigger should be fired. Row level triggers work fine. The only workaround at this point is to drop and recreate the statement triggers.&lt;/p&gt;</comment>
                            <comment id="13811340" author="knutanders" created="Fri, 1 Nov 2013 15:25:10 +0000"  >&lt;p&gt;I think I&apos;d prefer not to add an extra column to SYSTRIGGERS. If similar bugs turn up (fingers crossed that they don&apos;t!), we can always tell users to drop and recreate the trigger after upgrade, just like we&apos;ll tell them that they&apos;ll have to do that to work around this bug. I&apos;m worried that adding more redundancy in the system tables and more upgrade logic just in anticipation of future bugs (bugs that we don&apos;t know what will look like) might cause more problems than they will help if/when a situation where they are useful arises. In the case where a CREATE operation is buggy, I&apos;m fine with having to recreate the object to get it fixed. After all, triggers are no special in this regard, so if we add such a column to SYSTRIGGERS, we should probably add such columns to other system tables too in case CREATE TABLE, CREATE TYPE or any other CREATE operation turns out to have a problem.&lt;/p&gt;</comment>
                            <comment id="13811541" author="myrna" created="Fri, 1 Nov 2013 18:35:57 +0000"  >&lt;p&gt;I think the commit of revision 1537593 caused failures in the derbyall dblook tests, both for client and embedded, see for instance:&lt;br/&gt;
&lt;a href=&quot;http://download.java.net/javadesktop/derby/request_5583609/javadb-task-3751113.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.java.net/javadesktop/derby/request_5583609/javadb-task-3751113.html&lt;/a&gt;&lt;br/&gt;
or &lt;br/&gt;
&lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/main/linux/testlog/ibm16/1537799-derbyall_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/main/linux/testlog/ibm16/1537799-derbyall_diff.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13813556" author="jira-bot" created="Tue, 5 Nov 2013 02:04:46 +0000"  >&lt;p&gt;Commit 1538854 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1538854&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1538854&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;Following old harness tests need their master files updated after the code changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;. Now the behavior of these master match those of 10.6 codeline where &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt; regression does not exist.&lt;/p&gt;</comment>
                            <comment id="13813557" author="jira-bot" created="Tue, 5 Nov 2013 02:05:04 +0000"  >&lt;p&gt;Commit 1538854 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1538854&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1538854&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;Following old harness tests need their master files updated after the code changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;. Now the behavior of these master match those of 10.6 codeline where &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt; regression does not exist.&lt;/p&gt;</comment>
                            <comment id="13813558" author="jira-bot" created="Tue, 5 Nov 2013 02:05:23 +0000"  >&lt;p&gt;Commit 1538854 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1538854&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1538854&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;Following old harness tests need their master files updated after the code changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;. Now the behavior of these master match those of 10.6 codeline where &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt; regression does not exist.&lt;/p&gt;</comment>
                            <comment id="13813611" author="mamtas" created="Tue, 5 Nov 2013 04:02:21 +0000"  >&lt;p&gt;Working on backporting upto 10.7&lt;/p&gt;</comment>
                            <comment id="13814060" author="jira-bot" created="Tue, 5 Nov 2013 17:24:32 +0000"  >&lt;p&gt;Commit 1539074 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1539074&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1539074&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;Backporting following 2 revisions from trunk to 10.10. Had to hand do the changes because of conflicts during svn merge.&lt;br/&gt;
1537593, 1538854&lt;/p&gt;</comment>
                            <comment id="13814168" author="jira-bot" created="Tue, 5 Nov 2013 19:29:33 +0000"  >&lt;p&gt;Commit 1539108 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1539108&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1539108&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;2 master updates&lt;/p&gt;</comment>
                            <comment id="13814574" author="jira-bot" created="Wed, 6 Nov 2013 03:35:58 +0000"  >&lt;p&gt;Commit 1539228 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/branches/10.9&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1539228&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1539228&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;Backporting to 10.9&lt;/p&gt;</comment>
                            <comment id="13816288" author="mamtas" created="Thu, 7 Nov 2013 19:09:26 +0000"  >&lt;p&gt;I spent some time analyzing the triggers and systriggers system table to see if we can help identify precisely which triggers need to be dropped and recreated. &lt;/p&gt;

&lt;p&gt;systriggers table has a column called REFERENCEDCOLUMNS which keeps track of the columns on which triggers should get fired.&lt;/p&gt;

&lt;p&gt;For update triggers defined at statement level on specific columns, this column will keep position of those columns in the REFERENCEDCOLUMNS column. eg&lt;br/&gt;
create table t1(x int, y int);&lt;br/&gt;
create table t2(x int, y int);&lt;br/&gt;
create trigger tr1 after update of x on t1 referencing old table as old insert into t2 select * from old;&lt;br/&gt;
REFERENCEDCOLUMNS for the above trigger should be (1) but because of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;, it is (1,2) and thus causing the trigger to fire no matter which column gets updated rather than just for column x. I have added a junit test case for this scenario showing that after the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt; is checked in, we do not fire the trigger above for update of column y. Although, if a new column is added to the column after the trigger above is created, an update of the newly added column will not fire the trigger defined above because &lt;br/&gt;
REFERENCEDCOLUMNS does not have the position of the newly added column listed in it. I will add a junit test for newly added column for update triggers defined at statement level on specific columns.&lt;/p&gt;

&lt;p&gt;For update triggers defined at statement level on table level rather than specific columns, this column should be null eg&lt;br/&gt;
create trigger tr2 after update on t1 referencing old table as old insert into t2 select * from old;&lt;br/&gt;
REFERENCEDCOLUMNS for the above trigger should be null since it should fire for any column update but because of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;, it is (1,2) which does not cause any problem for the given eg because we want this trigger to fire whether column x or y got updated. But if we add another column to table t1, an update of that column will not fire the trigger above because REFERENCEDCOLUMNS is not null. I will add a junit test case for this scenario to show that after the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt; is checked in, the trigger tr2 will get fired for an update of new column added after the trigger creation.&lt;/p&gt;

&lt;p&gt;I will also add junit test cases for drop column scenario to confirm update triggers work fine.&lt;/p&gt;

&lt;p&gt;Based on this information, all statement level update triggers will need to be dropped and recreated in order to fix the buggy triggers.&lt;/p&gt;</comment>
                            <comment id="13816290" author="mamtas" created="Thu, 7 Nov 2013 19:09:53 +0000"  >&lt;p&gt;I will update release notes based on the findings of the earlier comment.&lt;/p&gt;</comment>
                            <comment id="13817540" author="mamtas" created="Fri, 8 Nov 2013 18:17:53 +0000"  >&lt;p&gt;DERBY6383_patch3_diff.txt which has number of junit tests, mainly to test out add/drop column&apos;s impact on triggers. Want to point out that from drop column test case in testDerby6383StatementTriggerBugTst1, in trunk, the drop column drops the statement trigger defined at  table level in trunk but not in 10.6. This may be what &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3940&quot; title=&quot;Dropping a column does not drop triggers which mention that column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3940&quot;&gt;&lt;del&gt;DERBY-3940&lt;/del&gt;&lt;/a&gt;(Dropping a column does not drop triggers which mention that column) is. &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3940&quot; title=&quot;Dropping a column does not drop triggers which mention that column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3940&quot;&gt;&lt;del&gt;DERBY-3940&lt;/del&gt;&lt;/a&gt; has been verified to be fixed in trunk and 10.10 but we do not for sure for earlier codelines. I will work on trying out the test case attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3940&quot; title=&quot;Dropping a column does not drop triggers which mention that column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3940&quot;&gt;&lt;del&gt;DERBY-3940&lt;/del&gt;&lt;/a&gt; on 10.6 and other higher codelines. But if anyone knows about it, may be they can explain the difference in behavior of drop column on trigger table in trunk vs 10.6 Thanks&lt;br/&gt;
+&lt;br/&gt;
+        //Drop a column from the table. Following will drop trigger t3&lt;br/&gt;
+        // because it depends on column being dropped. But trigger t2&lt;br/&gt;
+        // will remain intact since it does not have dependency on&lt;br/&gt;
+        // column being dropped. So only trigger left at this point&lt;br/&gt;
+        // will be t2 after the following column drop&lt;br/&gt;
+        s.executeUpdate(&quot;ALTER TABLE DERBY_6368_TAB1 DROP COLUMN Y&quot;);&lt;/p&gt;</comment>
                            <comment id="13817585" author="mamtas" created="Fri, 8 Nov 2013 19:08:31 +0000"  >&lt;p&gt;Investigating more about drop column and its impact on statement level trigger defined at the table level might be &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4988&quot; title=&quot;ALTER TABLE DROP COLUMN should make use of information in SYSTRIGGERS to detect column used through REFERENCING clause to find trigger dependencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4988&quot;&gt;&lt;del&gt;DERBY-4988&lt;/del&gt;&lt;/a&gt;(ALTER TABLE DROP COLUMN should make use of information in SYSTRIGGERS to detect column used through REFERENCING clause to find trigger dependencies). A simple test case below which works correctly in trunk through 10.7 but not in 10.6(and probably earlier codelines). I will create a new jira for this specific drop column case.&lt;br/&gt;
java org.apache.derby.tools.ij&lt;br/&gt;
connect &apos;jdbc:derby:db1;create=true&apos;;&lt;br/&gt;
CREATE TABLE DERBY_6368_TAB1 (X INTEGER, Y INTEGER);&lt;br/&gt;
CREATE TABLE DERBY_6368_TAB2 (X INTEGER, Y INTEGER);&lt;br/&gt;
INSERT INTO  DERBY_6368_TAB1 VALUES(1, 2);&lt;/p&gt;

&lt;p&gt;&amp;#8211; statement trigger defined at table level&lt;br/&gt;
CREATE TRIGGER t3 AFTER UPDATE ON DERBY_6368_TAB1 REFERENCING old table AS old INSERT INTO DERBY_6368_TAB2 SELECT * FROM old;&lt;/p&gt;

&lt;p&gt;--1 row&lt;br/&gt;
UPDATE DERBY_6368_TAB1 SET x = x + 1;&lt;br/&gt;
select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from DERBY_6368_TAB2;&lt;br/&gt;
delete from DERBY_6368_TAB2;&lt;/p&gt;

&lt;p&gt;&amp;#8211; following should drop the statement trigger defined above but it does not do that in 10.6 and earlier codelines&lt;br/&gt;
ALTER TABLE DERBY_6368_TAB1 DROP COLUMN Y;&lt;br/&gt;
ALTER TABLE DERBY_6368_TAB2 DROP COLUMN Y;&lt;br/&gt;
select * from sys.systriggers;&lt;/p&gt;

&lt;p&gt;UPDATE DERBY_6368_TAB1 SET x = x + 1;&lt;br/&gt;
--count should be 0 but in 10.6 and earlier, the update fires the trigger since the trigger didn&apos;t get dropped&lt;br/&gt;
select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from DERBY_6368_TAB2;&lt;/p&gt;</comment>
                            <comment id="13819832" author="jira-bot" created="Tue, 12 Nov 2013 05:00:38 +0000"  >&lt;p&gt;Commit 1540947 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/branches/10.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1540947&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1540947&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;Backporting to 10.8&lt;/p&gt;</comment>
                            <comment id="13820263" author="jira-bot" created="Tue, 12 Nov 2013 17:15:48 +0000"  >&lt;p&gt;Commit 1541167 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/branches/10.7&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1541167&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1541167&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;Backporting to 10.7&lt;/p&gt;</comment>
                            <comment id="13820264" author="jira-bot" created="Tue, 12 Nov 2013 17:18:45 +0000"  >&lt;p&gt;Commit 1541170 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1541170&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1541170&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;Adding more junit tests for checking the affects of adding/dropping columns to the table with update triggers defined on it.&lt;/p&gt;</comment>
                            <comment id="13820269" author="mamtas" created="Tue, 12 Nov 2013 17:23:21 +0000"  >&lt;p&gt;No further backporting beyond 10.7 is needed because this regression does not exist in those codelines.&lt;/p&gt;</comment>
                            <comment id="13820497" author="jira-bot" created="Tue, 12 Nov 2013 21:30:12 +0000"  >&lt;p&gt;Commit 1541245 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1541245&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1541245&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;Backporting more junit tests from trunk for checking the affects of adding/dropping columns to the table with update triggers defined on it&lt;/p&gt;</comment>
                            <comment id="13820512" author="jira-bot" created="Tue, 12 Nov 2013 21:52:00 +0000"  >&lt;p&gt;Commit 1541252 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/branches/10.9&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1541252&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1541252&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;backporting tests&lt;/p&gt;</comment>
                            <comment id="13820525" author="jira-bot" created="Tue, 12 Nov 2013 22:00:25 +0000"  >&lt;p&gt;Commit 1541254 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/branches/10.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1541254&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1541254&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;backporting tests&lt;/p&gt;</comment>
                            <comment id="13821618" author="mamtas" created="Wed, 13 Nov 2013 18:12:20 +0000"  >&lt;p&gt;Backport of the junit test to 10.7 gives error because of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6417&quot; title=&quot;Dropping a column in 10.7 release when there is a trigger with REFERENCING OLD clause defined on the table gives error &amp;quot;ERROR 42X05: Table/View &amp;#39;OLD&amp;#39; does not exist.&amp;quot;.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6417&quot;&gt;DERBY-6417&lt;/a&gt;. The test for ALTER TABLE .. DROP COLUMN is giving incorrect behavior in 10.7. I will comment out that part of the test and make any needed changes to backport hopefully the rest of the junit test to 10.7. Code changes for this jira are already in 10.7&lt;/p&gt;</comment>
                            <comment id="13822227" author="jira-bot" created="Thu, 14 Nov 2013 07:24:26 +0000"  >&lt;p&gt;Commit 1541837 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/branches/10.7&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1541837&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1541837&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;backporting part of the junit tests added for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;. Had to comment out couple drop column related tests because of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6417&quot; title=&quot;Dropping a column in 10.7 release when there is a trigger with REFERENCING OLD clause defined on the table gives error &amp;quot;ERROR 42X05: Table/View &amp;#39;OLD&amp;#39; does not exist.&amp;quot;.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6417&quot;&gt;DERBY-6417&lt;/a&gt;(Dropping a column in 10.7 release when there is a trigger with REFERENCING OLD clause defined on the table gives error &quot;ERROR 42X05: Table/View &apos;OLD&apos; does not exist.&quot;.) in 10.7 codeline&lt;/p&gt;</comment>
                            <comment id="13946457" author="rhillegas" created="Tue, 25 Mar 2014 12:33:18 +0000"  >&lt;p&gt;The release note says that a regression was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;. Shouldn&apos;t that be some older issue like &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4874&quot; title=&quot;Trigger does not recognize new size of VARCHAR column  expanded with ALTER TABLE. It fails with ERROR 22001: A truncation error was encountered trying to shrink VARCHAR &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4874&quot;&gt;&lt;del&gt;DERBY-4874&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Also, in the &quot;Incompatibilities with Previous Release&quot; section, I think that the following phrase&#8230;&lt;/p&gt;

&lt;p&gt;for columns not specified CREATE TRIGGER... AFTER UPDATE.. OF columns-list&lt;/p&gt;

&lt;p&gt;&#8230;would read better as&lt;/p&gt;

&lt;p&gt;for columns not specified in the column list of the &quot;CREATE TRIGGER... AFTER UPDATE.. OF&quot; clause&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13948494" author="myrna" created="Wed, 26 Mar 2014 21:28:23 +0000"  >&lt;p&gt;Attaching a modified version of the release notes that attempts to address Rick&apos;s findings.&lt;/p&gt;</comment>
                            <comment id="14004294" author="jira-bot" created="Wed, 21 May 2014 04:37:01 +0100"  >&lt;p&gt;Commit 1596451 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1596451&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1596451&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6547&quot; title=&quot;testDERBY5120NumRowsInSydependsForTrigger fails when the starting version of the upgrade trajectory is 10.10.2.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6547&quot;&gt;&lt;del&gt;DERBY-6547&lt;/del&gt;&lt;/a&gt;(testDERBY5120NumRowsInSydependsForTrigger fails when the starting version of the upgrade trajectory is 10.10.2.0)&lt;/p&gt;

&lt;p&gt;10.10, 10.9 and 10.8 jars started failing in upgrade suite(in testDERBY5120NumRowsInSydependsForTrigger) after following was backported into those codelines&lt;br/&gt;
*****&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;(Update trigger defined on one column fires on update of other columns)&lt;/p&gt;

&lt;p&gt;Backporting following 2 revisions from trunk to 10.10. Had to hand do the changes because of conflicts during svn merge.&lt;br/&gt;
1537593, 1538854 &lt;br/&gt;
*****&lt;/p&gt;

&lt;p&gt;The reason behind the failure is actually how testDERBY5120NumRowsInSydependsForTrigger test was written and not a code regression. &lt;/p&gt;

&lt;p&gt;The test creates a trigger which is supposed to fire on a specific column&lt;br/&gt;
	create trigger ATDC_TAB1_TRG1 after update of C11 on ATDC_TAB1 REFERENCING old_table as old &lt;br/&gt;
        	for each statement MODE DB2SQL insert into ATDC_BKUP1 select * from old&lt;br/&gt;
But later on it the test, it is expecting the trigger to fire on update of non-trigger column of the table. This was fine before &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt; was backported because w/o the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt;, triggers would fire on update of any column on the table(&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt; - Update trigger defined on one column fires on update of other columns). But after those codelines got the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt; as part of the backport, the trigger correctly won&apos;t fire any more on non-trigger columns and that started the test failure. I have fixed the test to update the trigger column in order to fire the trigger and now the test behaves correctly. I will backport this test fix upto 10.8 codelines which is how far &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6383&quot; title=&quot;Update trigger defined on one column fires on update of other columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6383&quot;&gt;&lt;del&gt;DERBY-6383&lt;/del&gt;&lt;/a&gt; got backported to.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12731721">DERBY-6684</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12679066">DERBY-6417</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12709795">DERBY-6547</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12478632">DERBY-4874</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12610747" name="DERBY6383_patch1_diff.txt" size="1031" author="mamtas" created="Tue, 29 Oct 2013 01:59:06 +0000"/>
                            <attachment id="12611202" name="DERBY6383_patch2_diff.txt" size="12742" author="mamtas" created="Wed, 30 Oct 2013 23:23:14 +0000"/>
                            <attachment id="12612860" name="DERBY6383_patch3_diff.txt" size="8145" author="mamtas" created="Fri, 8 Nov 2013 18:17:53 +0000"/>
                            <attachment id="12609849" name="d6383.sql" size="421" author="knutanders" created="Wed, 23 Oct 2013 13:16:19 +0100"/>
                            <attachment id="12611207" name="derby_for_Embedded_40Changes10_7testTriggers.log" size="173464" author="mamtas" created="Wed, 30 Oct 2013 23:23:14 +0000"/>
                            <attachment id="12611206" name="derby_for_Embedded_40Changes10_9testDisposableStatisticsExplicit.log" size="194109" author="mamtas" created="Wed, 30 Oct 2013 23:23:14 +0000"/>
                            <attachment id="12611204" name="error-stacktrace_for_Embedded_40Changes10_7testTriggers.out" size="57800" author="mamtas" created="Wed, 30 Oct 2013 23:23:14 +0000"/>
                            <attachment id="12611205" name="error-stacktrace_for_Embedded_40Changes10_9testDisposableStatisticsExplicit.out" size="68714" author="mamtas" created="Wed, 30 Oct 2013 23:23:14 +0000"/>
                            <attachment id="12637016" name="releaseNote.html" size="4645" author="myrna" created="Wed, 26 Mar 2014 21:28:23 +0000"/>
                            <attachment id="12612728" name="releaseNote.html" size="4940" author="mamtas" created="Thu, 7 Nov 2013 22:53:55 +0000"/>
                            <attachment id="12612513" name="releaseNote.html" size="4354" author="mamtas" created="Thu, 7 Nov 2013 02:45:48 +0000"/>
                            <attachment id="12611203" name="runall.out" size="465710" author="mamtas" created="Wed, 30 Oct 2013 23:23:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    <customfieldvalue key="10366"><![CDATA[Wrong query result]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Oct 2013 17:35:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354404</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzixzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354694</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>