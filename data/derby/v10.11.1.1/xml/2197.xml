<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:13:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2197/DERBY-2197.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2197] Remove unused code for locking rows while holding a latch</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2197</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Some of the code for locking a row while holding a latch doesn&apos;t seem to be used outside the unit tests for store. This code should be removed in order to reduce the overall complexity. See the discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2107&quot; title=&quot;Move page latching out of the lock manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2107&quot;&gt;&lt;del&gt;DERBY-2107&lt;/del&gt;&lt;/a&gt; for details.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12359093">DERBY-2197</key>
            <summary>Remove unused code for locking rows while holding a latch</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Dec 2006 07:50:41 +0000</created>
                <updated>Fri, 16 Feb 2007 13:26:12 +0000</updated>
                            <resolved>Wed, 17 Jan 2007 08:55:07 +0000</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Services</component>
                    <component>Store</component>
                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12460475" author="knutanders" created="Fri, 22 Dec 2006 13:42:05 +0000"  >&lt;p&gt;I&apos;m attaching a patch (derby-2197-engine.diff) for feedback. It is not ready&lt;br/&gt;
for commit yet since many of the storeunit tests won&apos;t build with it. All of&lt;br/&gt;
the engine code builds.&lt;/p&gt;

&lt;p&gt;The patch makes the following changes to the engine code:&lt;/p&gt;

&lt;p&gt;  1) Removes LockFactory.lockObject(..., Latch) and its implementation in&lt;br/&gt;
     SinglePool.&lt;/p&gt;

&lt;p&gt;  2) Removes LockingPolicy.lockRecordForRead(Latch, ...) and&lt;br/&gt;
     LockingPolicy.lockRecordForWrite(Latch, ...) and all their&lt;br/&gt;
     implementations.&lt;/p&gt;

&lt;p&gt;  3) Removes Page.fetch(), Page.update() and Page.delete() and their&lt;br/&gt;
     implementations in BasePage.&lt;/p&gt;

&lt;p&gt;  4) The only caller of Page.update() (GenericScanController.replace()) has&lt;br/&gt;
     been rewritten to use Page.updateAtSlot(), and an assert has been added to&lt;br/&gt;
     check whether row locking is needed.&lt;/p&gt;

&lt;p&gt;  5) The only caller of Page.delete() (BTreeScan.delete()) has been rewritten&lt;br/&gt;
     to use Page.deleteAtSlot(), and an assert has been added to check whether&lt;br/&gt;
     row locking is needed.&lt;/p&gt;

&lt;p&gt;Since many of the storeunit tests invoke some of the deleted methods directly,&lt;br/&gt;
they won&apos;t compile. I have therefore tested the patch by building (sane) engine&lt;br/&gt;
jars and using derbyTesting.jar from a clean trunk. The results from the&lt;br/&gt;
testing showed no errors in the JUnit tests and 25 errors in derbyall. All of&lt;br/&gt;
the errors in derbyall were storeunit tests which tried to invoke the deleted&lt;br/&gt;
methods.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure how to proceed with the storeunit tests. The removed methods are&lt;br/&gt;
used many places, and the tests are not always clear on what they are&lt;br/&gt;
testing. I guess I could write some utility methods in T_Util which did some&lt;br/&gt;
locking/latching tricks around Page.updateAtSlot/deleteAtSlot/fetchFromSlot.&lt;/p&gt;

&lt;p&gt;Comments on the approach I used in the patch and bright ideas on how to fix the&lt;br/&gt;
storeunit tests would be greatly appreciated! Thanks.&lt;/p&gt;</comment>
                            <comment id="12463273" author="knutanders" created="Tue, 9 Jan 2007 13:15:35 +0000"  >&lt;p&gt;Attaching a new patch (derby-2197-v1.diff) which also updates the&lt;br/&gt;
storeunit tests. I successfully ran derbyall on Solaris with Sun&apos;s JVM&lt;br/&gt;
1.5.0 and the JUnit tests with Sun&apos;s JVM 1.6.0. Derbyall also ran&lt;br/&gt;
cleanly when only the changes to the java/testing subtree were&lt;br/&gt;
applied.&lt;/p&gt;

&lt;p&gt;The only change in the engine code from the previous patch&lt;br/&gt;
(derby-2197-engine.diff) is a small modification of the assert in&lt;br/&gt;
GenericScanController.replace(). The old assert only checked that the&lt;br/&gt;
container was not opened in row locking mode, but it failed in&lt;br/&gt;
T_AccessFactory. However, replace() calls repositionScanForUpateOper()&lt;br/&gt;
which obtains a write lock if update locks are used, so the record&lt;br/&gt;
should already be locked. Therefore, I made the assert also check&lt;br/&gt;
whether update locks were used, and then T_AccessFactory succeeded.&lt;/p&gt;

&lt;p&gt;unitTests/services/T_LockFactory.java was modified so that it doesn&apos;t&lt;br/&gt;
test the lockObject() method that was removed from LockFactory.&lt;/p&gt;

&lt;p&gt;The tests in unitTests/store that call Page.fetch(), Page.delete() and&lt;br/&gt;
Page.update() directly, now use fetchFromSlot(), deleteAtSlot() and&lt;br/&gt;
updateAtSlot() instead. This changes what&apos;s being tested, since the&lt;br/&gt;
*Slot() methods don&apos;t perform any locking. I don&apos;t think that&apos;s a&lt;br/&gt;
problem since these tests don&apos;t depend on locking. Although some of&lt;br/&gt;
them are multi-threaded, each thread creates its own set of containers&lt;br/&gt;
that it&apos;s working on. It also seems like the original test cases use&lt;br/&gt;
the locking and non-locking variants of the methods more or less at&lt;br/&gt;
random, so I don&apos;t believe the locking behaviour is essential in these&lt;br/&gt;
tests.&lt;/p&gt;

&lt;p&gt;In T_RawStoreFactory, the tests P003, P004 and P052 were removed&lt;br/&gt;
because their comments said they were tests for Page.update() and&lt;br/&gt;
Page.delete(), which this patch deleted.&lt;/p&gt;

&lt;p&gt;The patch is ready for review.&lt;/p&gt;</comment>
                            <comment id="12463885" author="knutanders" created="Thu, 11 Jan 2007 13:12:18 +0000"  >&lt;p&gt;I plan to commit the patch early next week if there are no comments.&lt;/p&gt;</comment>
                            <comment id="12465389" author="knutanders" created="Wed, 17 Jan 2007 08:55:07 +0000"  >&lt;p&gt;Committed revision 496960.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12356332">DERBY-2107</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12347745" name="derby-2197-engine.diff" size="31003" author="knutanders" created="Fri, 22 Dec 2006 13:42:05 +0000"/>
                            <attachment id="12347746" name="derby-2197-engine.stat" size="1108" author="knutanders" created="Fri, 22 Dec 2006 13:42:05 +0000"/>
                            <attachment id="12348544" name="derby-2197-v1.diff" size="69775" author="knutanders" created="Tue, 9 Jan 2007 13:13:46 +0000"/>
                            <attachment id="12348545" name="derby-2197-v1.stat" size="1584" author="knutanders" created="Tue, 9 Jan 2007 13:13:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30315</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy13db:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40196</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>