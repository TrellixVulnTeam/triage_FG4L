<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:36:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3051/DERBY-3051.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3051] Replication: Modify logging subsystem to append log records to the replication buffer when in replication master mode</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3051</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When Derby has the replication master role for a database &apos;x&apos;, it should ship all log records generated for this database to the Derby with the slave role. A replication buffer was added to Derby in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2926&quot; title=&quot;Replication: Add a log buffer for log records that should be shipped to the slave&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2926&quot;&gt;&lt;del&gt;DERBY-2926&lt;/del&gt;&lt;/a&gt;. This issue is for modifying the logging subsystem to append log records to this buffer every time a log records is appended to the disk buffer (LogAccessFile). This will, of course, only be done if it has the master role.&lt;/p&gt;

&lt;p&gt;Currently, I have identified two modifications that will be required in LogToFile:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;LogToFile#appendLogRecord needs to append to the replication buffer after appending to the disk buffer&lt;/li&gt;
	&lt;li&gt;LogToFile#flush (i.e., the method used to force buffered log records to disk) must notify the Master Controller (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2977&quot; title=&quot;Replication: Add a ReplicationMaster controller that will manage replication on the master side&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2977&quot;&gt;&lt;del&gt;DERBY-2977&lt;/del&gt;&lt;/a&gt;) that a flush has taken place. The MasterController will decide if any action is required because of this.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12377554">DERBY-3051</key>
            <summary>Replication: Modify logging subsystem to append log records to the replication buffer when in replication master mode</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12373499">DERBY-2922</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jorgenlo">J&#248;rgen L&#248;land</assignee>
                                    <reporter username="jorgenlo">J&#248;rgen L&#248;land</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Sep 2007 12:29:56 +0100</created>
                <updated>Thu, 2 May 2013 03:29:10 +0100</updated>
                            <resolved>Tue, 18 Sep 2007 12:38:21 +0100</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Services</component>
                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12527006" author="jorgenlo" created="Thu, 13 Sep 2007 08:41:20 +0100"  >&lt;p&gt;Attaching a patch, v1, that makes LogToFile send log records to MasterFactory, and notifies the MF when a log disk flush has taken place. This only happens when boolean inReplicationMasterMode is true. The patch also adds two methods to LogFactory: startReplicationMasterRole and stopReplicationMasterRole. &lt;/p&gt;

&lt;p&gt;All tests have passed. Intermittent failure ProcedureInTriggerTest (see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1585&quot; title=&quot;derbylang/procedureInTrigger: not able to create trigger due to an open ResultSet&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1585&quot;&gt;&lt;del&gt;DERBY-1585&lt;/del&gt;&lt;/a&gt;) was encountered in one iteration of derbyall, but was not reproducable. &lt;/p&gt;</comment>
                            <comment id="12527892" author="narayanan" created="Sun, 16 Sep 2007 19:30:57 +0100"  >&lt;p&gt;Thank you for the patch Jorgen. The patch looks very good.&lt;/p&gt;

&lt;p&gt;I just have one very small doubt&lt;/p&gt;

&lt;p&gt;Would it be OK for the startReplicationMasterRole and stopReplicationMasterRole&lt;br/&gt;
of the ReadOnly class to both throw an exception Or maybe the stopreplication &lt;br/&gt;
inadvertently called on a read only database would have failed somewhere before &lt;br/&gt;
itself since the replication would not have been started in the first place and &lt;br/&gt;
this code is ideally speaking not reachable.&lt;/p&gt;</comment>
                            <comment id="12527999" author="oysteing" created="Mon, 17 Sep 2007 09:58:45 +0100"  >&lt;p&gt;Patch looks good.  I have only nits on my list:&lt;/p&gt;

&lt;p&gt;1. LogToFile#inReplicationMasterMode:&lt;/p&gt;

&lt;p&gt;   LogToFile also has a member inSlaveMode.  Maybe that should be&lt;br/&gt;
   called inReplicationSlaveMode for uniformity?  Also, I think the&lt;br/&gt;
   declaration of these two member fields should be placed together.&lt;/p&gt;

&lt;p&gt;2. LogToFile#appendLogRecord: &lt;/p&gt;

&lt;p&gt;   Any particular reason that MasterFactory#appendLogRecord has a&lt;br/&gt;
   different ordering of the parameters than&lt;br/&gt;
   LogToFile#appendLogRecord.  I think the code would be easier to&lt;br/&gt;
   read if the methods had the same parameter ordering.&lt;/p&gt;

&lt;p&gt;3. LogToFile#flush: &lt;/p&gt;

&lt;p&gt;   What does the &apos;?&apos; behind INVALID_LOG_INSTANT mean?&lt;/p&gt;

&lt;p&gt;4. LogToFile#startReplicationMasterRole, javadoc:&lt;/p&gt;

&lt;p&gt;   I would say &apos;pass log records&apos; instead of &apos;send ...&apos; in order to&lt;br/&gt;
   make it clearer that the MasterFactory is on the same node, and&lt;br/&gt;
   that we here are not talking about sending it over the network to&lt;br/&gt;
   the MasterFactory.&lt;/p&gt;

&lt;p&gt;5. LogToFile#stopReplicationMasterRole, javadoc:&lt;/p&gt;

&lt;p&gt;   Seems not right to mention ReadOnly here since that is a different&lt;br/&gt;
   implementation of LogFactory.&lt;/p&gt;

&lt;p&gt;6. LogFactory#(start|stop)ReplicationMasterRole, javadoc:&lt;/p&gt;

&lt;p&gt;   The javadoc references to the corresponding ReadOnly methods does&lt;br/&gt;
   not seem necessary to me.&lt;/p&gt;</comment>
                            <comment id="12528049" author="jorgenlo" created="Mon, 17 Sep 2007 13:56:28 +0100"  >&lt;p&gt;Attaching a patch, v1b, incorporating comments from Narayanan and &#216;ystein.&lt;/p&gt;

&lt;p&gt;Narayanan: You are correct; before the stopReplicationMaster method is ever called, startReplicationMaster has been called. This means that in read only databases, a &quot;cannot replicate readonly database&quot; exception has already been thrown.&lt;/p&gt;</comment>
                            <comment id="12528053" author="jorgenlo" created="Mon, 17 Sep 2007 13:58:52 +0100"  >&lt;p&gt;Patch 1b passes all tests.&lt;/p&gt;</comment>
                            <comment id="12528356" author="oysteing" created="Tue, 18 Sep 2007 12:28:49 +0100"  >&lt;p&gt;Committed patch, derby_3051_1b.diff, at revision 576835.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12373593">DERBY-2926</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12374534">DERBY-2977</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12365696" name="derby_3051_1.diff" size="10178" author="jorgenlo" created="Thu, 13 Sep 2007 08:41:20 +0100"/>
                            <attachment id="12365697" name="derby_3051_1.stat" size="389" author="jorgenlo" created="Thu, 13 Sep 2007 08:41:20 +0100"/>
                            <attachment id="12366005" name="derby_3051_1b.diff" size="14739" author="jorgenlo" created="Mon, 17 Sep 2007 13:56:28 +0100"/>
                            <attachment id="12366004" name="derby_3051_1b.stat" size="389" author="jorgenlo" created="Mon, 17 Sep 2007 13:56:28 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 16 Sep 2007 18:30:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30711</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0k0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37062</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>