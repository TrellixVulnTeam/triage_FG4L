<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:45:35 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3709/DERBY-3709.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3709] Exception printed by replication test: Could not perform operation because the database is not in replication master mode.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3709</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I saw the following exception printed when I ran suites.All on trunk (revision 663064). None of the tests failed.&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE07, SQLERRMC: Could not perform operation because the database is not in replication master mode.&lt;br/&gt;
	at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:96)&lt;br/&gt;
	at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:362)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:149)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:582)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:207)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.failOver_direct(ReplicationRun.java:1286)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.failOver(ReplicationRun.java:1220)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local.testReplication_Local(ReplicationRun_Local.java:148)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:164)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:130)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:104)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:120)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
	at junit.textui.TestRunner.doRun(TestRunner.java:121)&lt;br/&gt;
	at junit.textui.TestRunner.start(TestRunner.java:185)&lt;br/&gt;
	at junit.textui.TestRunner.main(TestRunner.java:143)&lt;br/&gt;
Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE07, SQLERRMC: Could not perform operation because the database is not in replication master mode.&lt;br/&gt;
	at org.apache.derby.client.am.Connection.completeSqlca(Connection.java:2068)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseRdbAccessFailed(NetConnectionReply.java:537)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(NetConnectionReply.java:430)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(NetConnectionReply.java:294)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(NetConnectionReply.java:121)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(NetConnection.java:831)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(NetConnection.java:755)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowUSRIDONLconnect(NetConnection.java:588)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowConnect(NetConnection.java:395)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.&amp;lt;init&amp;gt;(NetConnection.java:219)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection40.&amp;lt;init&amp;gt;(NetConnection40.java:77)&lt;br/&gt;
	at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl40.newNetConnection(ClientJDBCObjectFactoryImpl40.java:269)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:140)&lt;br/&gt;
	... 31 more&lt;/p&gt;</description>
                <environment>Java Version:    1.6.0_04&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
OS name:         SunOS&lt;br/&gt;
OS architecture: x86&lt;br/&gt;
OS version:      5.10</environment>
        <key id="12397515">DERBY-3709</key>
            <summary>Exception printed by replication test: Could not perform operation because the database is not in replication master mode.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="olesolberg">Ole Solberg</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Jun 2008 22:14:47 +0100</created>
                <updated>Mon, 29 Jun 2009 23:43:11 +0100</updated>
                            <resolved>Tue, 5 Aug 2008 15:34:34 +0100</resolved>
                                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                                    <fixVersion>10.4.2.0</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12602613" author="narayanan" created="Thu, 5 Jun 2008 12:04:21 +0100"  >&lt;p&gt;I remember while working on 3617 thinking that this might be because the&lt;br/&gt;
tests call failover immediately after a start master, this results in failover&lt;br/&gt;
being called before replication can be booted completely. I will take a closer&lt;br/&gt;
look at this over the weekend, unless someone beats me to it.&lt;/p&gt;</comment>
                            <comment id="12603018" author="olesolberg" created="Fri, 6 Jun 2008 13:28:06 +0100"  >&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3632&quot; title=&quot;Replication tests must ensure stable replication state has been reached before attempting further connection or new replication commands.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3632&quot;&gt;&lt;del&gt;DERBY-3632&lt;/del&gt;&lt;/a&gt; patch derby-3632_p1.diff.txt might &quot;solve&quot;/bypass the main problem here: that failover is attempted before replication is ready.&lt;/p&gt;

&lt;p&gt;The test should however also catch the unexpected exception so that the failure is not hidden: I will upload a patch for this. &lt;/p&gt;</comment>
                            <comment id="12603019" author="olesolberg" created="Fri, 6 Jun 2008 13:30:47 +0100"  >&lt;p&gt;Catch the unexpected exception so that the failure is not hidden.&lt;/p&gt;</comment>
                            <comment id="12603419" author="narayanan" created="Sun, 8 Jun 2008 19:10:31 +0100"  >&lt;p&gt;1) Can&apos;t we just leave the &apos;else&apos; and the catch(Exception ex) parts since the method is already&lt;br/&gt;
    throwing an Exception?&lt;br/&gt;
2) I am not sure this usage assertTrue(msg, false); is right, I guess the aim is to print msg all the time.&lt;br/&gt;
    Do we need to use assertTrue in this case?&lt;/p&gt;

&lt;p&gt;Also, I will get 3632 in first and then switch to this issue.&lt;/p&gt;</comment>
                            <comment id="12603421" author="knutanders" created="Sun, 8 Jun 2008 19:21:18 +0100"  >&lt;p&gt;Hi Narayanan,&lt;/p&gt;

&lt;p&gt;1) I agree. The if/else part could probably be replaced with a call to BaseJDBCTestCase.assertSQLState(), and the &quot;catch (Exception e)&quot; part could probably be removed.&lt;/p&gt;

&lt;p&gt;2) I think you&apos;re right. assertTrue(msg, false) should be replaced with fail(msg). And if we don&apos;t catch the exceptions, as you suggested in (1), we don&apos;t need that call at all.&lt;/p&gt;</comment>
                            <comment id="12603542" author="olesolberg" created="Mon, 9 Jun 2008 11:47:10 +0100"  >&lt;p&gt;You are of course right, on both 1) and 2).&lt;br/&gt;
This patch should take care of your suggested simplification.&lt;br/&gt;
Thanks for catching this!&lt;/p&gt;

&lt;p&gt;ReplicationSuite ran OK with this patch.&lt;/p&gt;</comment>
                            <comment id="12603554" author="narayanan" created="Mon, 9 Jun 2008 13:00:38 +0100"  >&lt;p&gt;Thank you for the patch Ole! Shall run tests and commit tonight or early tomorrow morning.&lt;br/&gt;
I have my hands full now (sorry that I can&apos;t commit this immediately)! Also should this change be reflected in the 10.4 branch also?&lt;/p&gt;</comment>
                            <comment id="12603558" author="olesolberg" created="Mon, 9 Jun 2008 13:24:41 +0100"  >&lt;p&gt;Yes, this should be merged to 10.4 also (derby-3632_p1.diff.txt + derby-3709_p1-v2.diff.txt).&lt;br/&gt;
Thanks for handling this Narayanan!&lt;/p&gt;</comment>
                            <comment id="12603802" author="narayanan" created="Tue, 10 Jun 2008 09:32:05 +0100"  >&lt;p&gt;Thank you for the patch Ole&lt;/p&gt;

&lt;p&gt;I had two unrelated failures while running these tests&lt;/p&gt;

&lt;p&gt;Sending        java/testing/org/apache/derbyTesting/functionTests/tests/replicationTests/ReplicationRun.java&lt;br/&gt;
Transmitting file data .&lt;br/&gt;
Committed revision 666006.&lt;/p&gt;

&lt;p&gt;Will merge it to 10.4 after running tests&lt;/p&gt;</comment>
                            <comment id="12604200" author="narayanan" created="Wed, 11 Jun 2008 13:27:12 +0100"  >&lt;p&gt;merged with 10.4. The tests in my environment were blubbering incoherently as usual :-/&lt;/p&gt;

&lt;p&gt;Sending        java/testing/org/apache/derbyTesting/functionTests/tests/replicationTests/ReplicationRun.java&lt;br/&gt;
Transmitting file data .&lt;br/&gt;
Committed revision 666631.&lt;/p&gt;</comment>
                            <comment id="12605863" author="olesolberg" created="Wed, 18 Jun 2008 07:40:29 +0100"  >&lt;p&gt;Patch has been applied (trunk and merged to 10.4).&lt;/p&gt;</comment>
                            <comment id="12619694" author="rhillegas" created="Mon, 4 Aug 2008 21:45:26 +0100"  >&lt;p&gt;Marking as Fix Version 10.4.2 because the fix has been ported to the 10.4 branch.&lt;/p&gt;</comment>
                            <comment id="12619894" author="rhillegas" created="Tue, 5 Aug 2008 15:27:42 +0100"  >&lt;p&gt;Can this issue be marked as resolved now?&lt;/p&gt;</comment>
                            <comment id="12619900" author="olesolberg" created="Tue, 5 Aug 2008 15:34:34 +0100"  >&lt;p&gt;Resolving: applied to trunk and 10.4.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12394296">DERBY-3632</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12398022">DERBY-3719</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12383678" name="derby-3709_p1-v2.diff.txt" size="1216" author="olesolberg" created="Mon, 9 Jun 2008 11:47:10 +0100"/>
                            <attachment id="12383554" name="derby-3709_p1.diff.txt" size="933" author="olesolberg" created="Fri, 6 Jun 2008 13:30:47 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Jun 2008 11:04:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23801</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0w2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39014</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>