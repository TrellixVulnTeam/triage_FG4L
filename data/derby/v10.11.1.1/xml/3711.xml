<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:48:51 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3711/DERBY-3711.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3711] convert store/aes.sql to junit test &amp; add unrestricted test cases.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3711</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The store/aes.sql test can, because it&apos;s a master-based test, only test what&apos;s guaranteed available, i.e. only the encryptionKeyLength=128.&lt;br/&gt;
If it were a junit test, we could make it ignore the expected failures if the larger key sizes weren&apos;t supported, but test otherwise.&lt;/p&gt;

&lt;p&gt;Having a junit test doesn&apos;t guarantee the test would get executed, of course, but at least the test would exist. &lt;/p&gt;

&lt;p&gt;Would it be useful/ok to have a message print to the console as a warning?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12397526">DERBY-3711</key>
            <summary>convert store/aes.sql to junit test &amp; add unrestricted test cases.</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Jun 2008 23:26:27 +0100</created>
                <updated>Thu, 27 Dec 2012 15:57:00 +0000</updated>
                            <resolved>Mon, 9 Jun 2008 18:17:44 +0100</resolved>
                                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12602714" author="kmarsden" created="Thu, 5 Jun 2008 18:10:08 +0100"  >&lt;p&gt;Myrna asked.&lt;br/&gt;
&amp;gt;Would it be useful/ok to have a message print to the console as a warning (if larger key sizes are skipped)?&lt;/p&gt;

&lt;p&gt;I wouldn&apos;t mind a message, but I think it is not the norm for tests we skip because there is not support, so maybe others have different opinions.&lt;/p&gt;
</comment>
                            <comment id="12602718" author="myrna" created="Thu, 5 Jun 2008 18:37:24 +0100"  >&lt;p&gt;Thx for your comment Kathey - I went ahead with that idea, will upload a patch...And I&apos;ll commit soon.&lt;br/&gt;
There&apos;ll be a follow up patch to add the test to the store _Suite, and to do remove the old test. I can take the println out then if that&apos;s preferred by the community.&lt;/p&gt;</comment>
                            <comment id="12602738" author="myrna" created="Thu, 5 Jun 2008 19:15:07 +0100"  >&lt;p&gt;As I was looking at encryptiontests, I felt it useful for those running textui.TestRunner with -Dderby.tests.trace=true and harmless to others to rename the fixture &apos;testConnection&apos; in suites.EncryptionSuite. Committed that with revision 663688:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void testConnection() throws SQLException&lt;br/&gt;
+    public void testEncryptedDBConnection() throws SQLException&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12602762" author="myrna" created="Thu, 5 Jun 2008 20:52:46 +0100"  >&lt;p&gt;Attaching a patch that adds the converted test - EncryptionAESTest - to store._Suite, and removes the old test files.&lt;br/&gt;
I modified EncryptionAesTest so that it only prints a comment to the console if derby.tests.trace=true.&lt;/p&gt;

&lt;p&gt;I am running regression tests.&lt;/p&gt;</comment>
                            <comment id="12604156" author="kristwaa" created="Wed, 11 Jun 2008 09:28:54 +0100"  >&lt;p&gt;I notice EncryptionAESTest has some code in common with EncryptionKeyAESTest/EncryptionKeyTest, but I assume they test different things?&lt;br/&gt;
Would it be beneficial/possible to run the new tests for the other encryption algorithms as well?&lt;/p&gt;</comment>
                            <comment id="12604228" author="myrna" created="Wed, 11 Jun 2008 15:17:44 +0100"  >&lt;p&gt;You&apos;re right, I happily stole some setup code from EncryptionKeyTest and its subclass EncryptionKeyAESTest. &lt;/p&gt;

&lt;p&gt;The tests do test different things; the old aes.sql test had one test case (case 5) which was indeed covered in EncryptionKeyAESTest so I didn&apos;t include that in the new Encryption AESTest. The Encryption Key*Test covers using the &apos;encryptionKey&apos; attribute; EncryptionAESTEst (as well as several other encryption tests) test with &apos;bootPassword&apos;.&lt;/p&gt;

&lt;p&gt;I was focused solely on converting aes.sql while adding testing for larger (non-exportable for US) keylengths.&lt;/p&gt;

&lt;p&gt;Now that I look, it seems&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;reasonable to test various feedback modes with other algorithms (testFeedBackModes fixture)&lt;/li&gt;
	&lt;li&gt;based on the code coverage results you&apos;d think there&apos;s room for testing unsupported padding strings, but what else can we test except that anything except &apos;NoPadding&apos; is invalid? Some of the other encryption .sql tests check this also.&lt;/li&gt;
	&lt;li&gt;some further testing with other keylengths might be useful to other algorithms, especially using keylengthbits-EncodedKeyLength format, but the 128/192/256 is specific to AES.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;While looking, I noticed also that&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;there is reference in one of the presentations (one by jean, one by dan) of derby.encryptionBlockSize, but I find no test of that at all&lt;/li&gt;
	&lt;li&gt;the reference manual doesn&apos;t mention the property encryptionKeyLength&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I have no plans at this time to extend the feedbackmode testing to other algorithms nor to add testing for constructions like &apos;encryptionKeyLength=56-8&apos; (valid for DES; what happens with other algorithms?), but they might be interesting.&lt;/p&gt;</comment>
                            <comment id="12604345" author="dagw" created="Wed, 11 Jun 2008 22:33:09 +0100"  >&lt;p&gt;I think the property derby.encryptionBlockSize is only ever used to persist this quantity&lt;br/&gt;
between boots (in service.properties) and can not be set by users. Jean&apos;s presentation seems&lt;br/&gt;
to indicate that. So does the code in RawStore#setupEncryptionEngines, I think.&lt;br/&gt;
But there seems to be a vulnerability here, cf also &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-46&quot; title=&quot;Do not store encryption block size for encrypted database when using external key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-46&quot;&gt;DERBY-46&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;As for encryptionKeyLength, it seems this can be specified (per Dan&apos;s paper and code below) &lt;br/&gt;
and should probably be documented, cf this code fragment in JCECipherFactory:&lt;/p&gt;

&lt;p&gt;		// case 1 - if &apos;encryptionKey&apos; is not set and &apos;encryptionKeyLength&apos; is set, then use&lt;br/&gt;
		// the &apos;encryptionKeyLength&apos; property value  as the keyLength in bits.&lt;br/&gt;
		// case 2 - &apos;encryptionKey&apos; property is not set and &apos;encryptionKeyLength&apos; is not set, then&lt;br/&gt;
		// use the defaults keylength:  56bits for DES, 168 for DESede and 128 for any other encryption&lt;br/&gt;
		// algorithm&lt;br/&gt;
                if (externalKey == null &amp;amp;&amp;amp; create) {&lt;br/&gt;
			if(properties.getProperty(Attribute.CRYPTO_KEY_LENGTH) != null)&lt;br/&gt;
			{&lt;br/&gt;
                            :&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12397524">DERBY-3710</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12438802">DERBY-4418</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12398125">DERBY-3720</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12383493" name="DERBY-3711-2.diff" size="20357" author="myrna" created="Thu, 5 Jun 2008 20:52:46 +0100"/>
                            <attachment id="12383492" name="DERBY-3711-2.stat" size="507" author="myrna" created="Thu, 5 Jun 2008 20:52:46 +0100"/>
                            <attachment id="12383475" name="DERBY-3711_1.diff" size="21281" author="myrna" created="Thu, 5 Jun 2008 18:37:54 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Jun 2008 17:10:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30964</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0xen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39230</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>