<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:45:17 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3632/DERBY-3632.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3632] Replication tests must ensure stable replication state has been reached before attempting further connection or new replication commands.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3632</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When executing replication commands (startslave, startmaster, stopmaster, stopslave, failover) tests must make sure that correct replication state has been reached before attempting further connection to the master and slave databases.&lt;/p&gt;

&lt;p&gt;This causes intermittent errors in replication tests.&lt;/p&gt;</description>
                <environment>All</environment>
        <key id="12394296">DERBY-3632</key>
            <summary>Replication tests must ensure stable replication state has been reached before attempting further connection or new replication commands.</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="olesolberg">Ole Solberg</assignee>
                                    <reporter username="olesolberg">Ole Solberg</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Apr 2008 11:26:47 +0100</created>
                <updated>Fri, 23 Jan 2015 01:34:55 +0000</updated>
                            <resolved>Fri, 23 Jan 2015 01:34:55 +0000</resolved>
                                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Replication</component>
                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12591230" author="olesolberg" created="Tue, 22 Apr 2008 08:12:28 +0100"  >&lt;p&gt;Patch derby-3632_p1 increases the timeout for starting the master and slave servers and the timeout for a successfull &quot;startmaster=true&quot;.&lt;br/&gt;
Now allows up to 120s before giving up.&lt;/p&gt;</comment>
                            <comment id="12600959" author="dagw" created="Fri, 30 May 2008 00:07:37 +0100"  >&lt;p&gt;Looks like this change will make the test more stable. &lt;/p&gt;

&lt;p&gt;Just a question.. currently the test sleeps for only 200 milliseconds before trying to see if fail-over occurred (loops max 100 times, i.e. 20 seconds). Is it expected that failover will take so long here? &lt;br/&gt;
If the expectation is in the order of several seconds, why is the sleep increment that small (200ms) ?&lt;/p&gt;

&lt;p&gt;If this is all as expected, +1 to commit.&lt;/p&gt;</comment>
                            <comment id="12601039" author="olesolberg" created="Fri, 30 May 2008 08:55:58 +0100"  >&lt;p&gt;&quot;Normally&quot; failover does not take that long. But I have seen cases, with other load on the test host, when both startmaster and failover can take time.&lt;/p&gt;

&lt;p&gt;It would be good to see if this change do make the test more stable.&lt;/p&gt;</comment>
                            <comment id="12603414" author="narayanan" created="Sun, 8 Jun 2008 18:48:44 +0100"  >&lt;p&gt;This issue is related to 3709 which also seems to deal with&lt;br/&gt;
failures of failover attempted before replication has completely&lt;br/&gt;
started.&lt;/p&gt;</comment>
                            <comment id="12603415" author="narayanan" created="Sun, 8 Jun 2008 18:49:23 +0100"  >&lt;p&gt;The patch for the issue seems straightforward to me, will commit this patch&lt;br/&gt;
if my tests pass. Starting test runs now.&lt;/p&gt;</comment>
                            <comment id="12603463" author="narayanan" created="Mon, 9 Jun 2008 04:08:13 +0100"  >&lt;p&gt;I ran tests on this patch and noticed multiple failures.&lt;/p&gt;

&lt;p&gt;1) I had a &quot;java.net.SocketException: Connection reset&quot; initially&lt;br/&gt;
2) A whole lot of java.security.PrivilegedActionException: javax.management.InstanceNotFoundException: org.apache.derby:type=NetworkServer,system=c013800d-011a-69a4-8c8a-ffff861961bb&lt;br/&gt;
3) And quite a few  Failed to start database &apos;singleUse/oneuse49&apos;, see the next exception for details.&lt;/p&gt;

&lt;p&gt;These might as well be because I missed a runic option while starting the tests. I will run the tests again and shall report back with the test results.&lt;/p&gt;

&lt;p&gt;I am careful with this patch because it primarily a timing change in starting the replication master. The failures might also be due to timing changes induced by this patch (Not sure about this one!).&lt;/p&gt;

&lt;p&gt;Ole, Can you please confirm that the tests passed for you with the attached patch?&lt;/p&gt;
</comment>
                            <comment id="12603483" author="narayanan" created="Mon, 9 Jun 2008 07:57:39 +0100"  >&lt;p&gt;In addition to the 7 failures in tinderbox, I had Derby-3689 recurring. These don&apos;t seem to be&lt;br/&gt;
related to the patch.&lt;/p&gt;

&lt;p&gt;I am going to commit this patch.&lt;/p&gt;

&lt;p&gt;Thanks for the patch Ole.&lt;/p&gt;</comment>
                            <comment id="12603485" author="narayanan" created="Mon, 9 Jun 2008 08:06:00 +0100"  >&lt;p&gt;Thank you for the diagnosis on the issue and the patch Ole!&lt;/p&gt;

&lt;p&gt;Sending        java/testing/org/apache/derbyTesting/functionTests/tests/replicationTests/ReplicationRun.java&lt;br/&gt;
Transmitting file data .&lt;br/&gt;
Committed revision 664639.&lt;/p&gt;</comment>
                            <comment id="12603500" author="olesolberg" created="Mon, 9 Jun 2008 09:01:19 +0100"  >&lt;p&gt;Thanks for committing the patch Narayanan!&lt;br/&gt;
And, yes, the tests passed for me - on several platforms....&lt;/p&gt;</comment>
                            <comment id="12603551" author="narayanan" created="Mon, 9 Jun 2008 12:58:09 +0100"  >&lt;p&gt;Committed to 10.4 branch also, ran tests,&lt;/p&gt;

&lt;p&gt;Sending        java/testing/org/apache/derbyTesting/functionTests/tests/replicationTests/ReplicationRun.java&lt;br/&gt;
Transmitting file data .&lt;br/&gt;
Committed revision 664684.&lt;/p&gt;


&lt;p&gt;Found two failures, unrelated to this issue or the patch submitted&lt;/p&gt;

&lt;p&gt;1) testAttributeAccumulatedConnectionCount(org.apache.derbyTesting.functionTests.tests.management.NetworkServerMBeanTest)java.security.PrivilegedActionException: javax.management.InstanceNotFoundException: org.apache.derby:type=NetworkServer,system=c013800d-011a-6ce8-6aa1-ffffae960ebe&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.management.MBeanTest.getAttribute(MBeanTest.java:379)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.management.NetworkServerMBeanTest.testAttributeAccumulatedConnectionCount(NetworkServerMBeanTest.java:93)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:101)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
Caused by: javax.management.InstanceNotFoundException: org.apache.derby:type=NetworkServer,system=c013800d-011a-6ce8-6aa1-ffffae960ebe&lt;br/&gt;
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean(DefaultMBeanServerInterceptor.java:1094)&lt;br/&gt;
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:662)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:638)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.management.MBeanTest$4.run(MBeanTest.java:382)&lt;br/&gt;
        ... 41 more&lt;/p&gt;

&lt;p&gt;2) testAttributeActiveConnectionCount(org.apache.derbyTesting.functionTests.tests.management.NetworkServerMBeanTest)java.security.PrivilegedActionException: javax.management.InstanceNotFoundException: org.apache.derby:type=NetworkServer,system=c013800d-011a-6ce8-6aa1-ffffae960ebe&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.management.MBeanTest.getAttribute(MBeanTest.java:379)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.management.NetworkServerMBeanTest.testAttributeActiveConnectionCount(NetworkServerMBeanTest.java:103)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:101)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
Caused by: javax.management.InstanceNotFoundException: org.apache.derby:type=NetworkServer,system=c013800d-011a-6ce8-6aa1-ffffae960ebe&lt;br/&gt;
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean(DefaultMBeanServerInterceptor.java:1094)&lt;br/&gt;
        at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getAttribute(DefaultMBeanServerInterceptor.java:662)&lt;br/&gt;
        at com.sun.jmx.mbeanserver.JmxMBeanServer.getAttribute(JmxMBeanServer.java:638)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.management.MBeanTest$4.run(MBeanTest.java:382)&lt;br/&gt;
        ... 41 more&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 9328,  Failures: 0,  Errors: 2&lt;/p&gt;</comment>
                            <comment id="12605864" author="olesolberg" created="Wed, 18 Jun 2008 07:42:29 +0100"  >&lt;p&gt;Patch has been applied (trunk and merged to 10.4).&lt;/p&gt;</comment>
                            <comment id="12619698" author="rhillegas" created="Mon, 4 Aug 2008 21:50:59 +0100"  >&lt;p&gt;Marking Fix Version 10.4.2 because this work has been ported to 10.4.&lt;/p&gt;</comment>
                            <comment id="12619895" author="rhillegas" created="Tue, 5 Aug 2008 15:30:00 +0100"  >&lt;p&gt;Can this issue be marked as resolved?&lt;/p&gt;</comment>
                            <comment id="12619909" author="olesolberg" created="Tue, 5 Aug 2008 15:45:48 +0100"  >&lt;p&gt;We are still seeing this intermittent failure, although not as frequent. But it apparently needs further work.&lt;/p&gt;</comment>
                            <comment id="12709643" author="dagw" created="Fri, 15 May 2009 00:58:18 +0100"  >&lt;p&gt;I make this issue a task since it is now a meta-issue, c.f the links to individual issues&lt;br/&gt;
of instabilities.&lt;/p&gt;</comment>
                            <comment id="14288563" author="myrna" created="Fri, 23 Jan 2015 01:34:55 +0000"  >&lt;p&gt;I am marking this issue as Fixed in 10.6. It seems from looking over the linked issues that most of these received fixes by that date.&lt;br/&gt;
Also changes were applied for this issue in 2009.&lt;/p&gt;

&lt;p&gt;Very occassionally replication tests still fail - there are (or should be) separate issues for that.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12397515">DERBY-3709</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12398022">DERBY-3719</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12423725">DERBY-4186</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12423424">DERBY-4175</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12425533">DERBY-4231</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12428027">DERBY-4277</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12423714">DERBY-4185</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12380669" name="derby-3632_p1.diff.txt" size="1394" author="olesolberg" created="Tue, 22 Apr 2008 08:12:28 +0100"/>
                            <attachment id="12380670" name="derby-3632_p1.stat.txt" size="101" author="olesolberg" created="Tue, 22 Apr 2008 08:12:28 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 29 May 2008 23:07:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30931</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0sa7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38400</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>