<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:22:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3905/DERBY-3905.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3905] Failed tests should save the database off to the fail directory</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3905</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Currently failed tests save the derby.log to the fail directory for that test.  It would be useful to save the database as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12406133">DERBY-3905</key>
            <summary>Failed tests should save the database off to the fail directory</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Oct 2008 22:41:18 +0100</created>
                <updated>Mon, 4 May 2009 19:22:26 +0100</updated>
                            <resolved>Wed, 15 Oct 2008 18:25:04 +0100</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12638588" author="kmarsden" created="Fri, 10 Oct 2008 18:00:50 +0100"  >&lt;p&gt;I implemented this by using File.rename() to move the database directory to the failure directory on failure which seems to work fine except for in the case where we have a CleanDatabaseTestSetup./decoratesql, where we lose the initial setup so subsequent tests may fail because the table setup isn&apos;t there.  Perhaps a recursive copy would be better, but  slower.    I&apos;ll try to write a method to do the recursive copy because I don&apos;t see anything readily available in Java and see how that goes.&lt;/p&gt;</comment>
                            <comment id="12638886" author="kmarsden" created="Sun, 12 Oct 2008 20:38:19 +0100"  >&lt;p&gt;Attached is a patch for this issue, which copies the database on failure.  The patch adds a copy method to PrivilegedFileOpsForTests and used that for both the database copy and derby.log copy.  &lt;/p&gt;

&lt;p&gt;Please review&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;
</comment>
                            <comment id="12638921" author="knutanders" created="Sun, 12 Oct 2008 23:35:05 +0100"  >&lt;p&gt;The patch looks correct to me. Some small comments:&lt;/p&gt;

&lt;p&gt;BaseTestCase.java:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I felt that the old approach of re-throwing running from the finally clause was clearer than the new approach where we store it in a variable and re-throw it at the end of the method.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;There&apos;s a javadoc comment added, but no method for the javadoc.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new File(failPath + File.separator + &quot;derby.log&quot;) could be simplified to new File(failPath, &quot;derby.log&quot;)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ioe.printStackTrace() could be replaced with BaseTestCase.printStackTrace(ioe) so that it is always printed to the correct stream.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;PrivilegedFileOpsForTests.java:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;No checked exception is thrown in the privileged action in getAbsolutePath(), so PrivilegedAction could be used instead of PrivilegedExceptionAction.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SecurityException is a RuntimeException and will never be wrapped in a PrivilegedExceptionAction, so the &quot;else if instance of SecurityException&quot; part of copy() could be removed.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FileNotFoundException is an IOException, so the &quot;else if instance of FileNotFoundException&quot; part of copy() could also be removed (FNFE will always be picked up by the first branch of the if statement)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12639121" author="kmarsden" created="Mon, 13 Oct 2008 18:22:36 +0100"  >&lt;p&gt;With the old method of throwing the exception from the finally block I got a warning in Eclipse.&lt;br/&gt;
&quot;finally block does not complete normally&quot; so this was the reason I changed it.  I read a little about the dangers of having a return statement or throwing an exception in a finally block at:&lt;br/&gt;
&lt;a href=&quot;http://www.basilv.com/psd/blog/2007/a-tale-of-bad-exception-handling-in-finally-blocks-in-java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.basilv.com/psd/blog/2007/a-tale-of-bad-exception-handling-in-finally-blocks-in-java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;so concluded it was probably not a good idea to keep the exception thrown in the finally block.&lt;br/&gt;
Do you think it is safe/a good idea  to change it back?&lt;/p&gt;


</comment>
                            <comment id="12639450" author="knutanders" created="Tue, 14 Oct 2008 16:11:57 +0100"  >&lt;p&gt;The article warns that returning from finally clauses could hide exceptions thrown in the try block. (I agree that&apos;s a problem, and at some point I think I even commented on some existing methods in store doing that. I should probably have filed a JIRA for that. Thanks for reminding me!) But hiding those exceptions is exactly what we&apos;re trying to achieve with this code, so I believe it is safe. The reason why I felt it was clearer, was that all the logic for re-throwing the exception was located in a single place (the finally clause), but I don&apos;t think it&apos;s a big issue.&lt;/p&gt;

&lt;p&gt;One thing that changed with the patch, is this:&lt;/p&gt;

&lt;p&gt;  Without the patch, we re-throw the exception that caused the test failure regardless of what happens in the try block.&lt;/p&gt;

&lt;p&gt;  With the patch, we only re-throw the exception that caused the test failure if no error condition happened in the try block or if an IOException was thrown. If some other kind of exception or throwable was thrown, the error in the try block will hide the error in the test.&lt;/p&gt;</comment>
                            <comment id="12639534" author="kmarsden" created="Tue, 14 Oct 2008 19:47:49 +0100"  >&lt;p&gt;Attached is an updated patch that makes the changes recommended by Knut. Ran suites.All with no failures.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12639847" author="knutanders" created="Wed, 15 Oct 2008 14:56:20 +0100"  >&lt;p&gt;Patch v2 looks fine to me. (One tiny nit: The two lines after the comment in recursiveCopy() are indented too far to the right.)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12391968" name="derby-3905_diff.txt" size="9712" author="kmarsden" created="Sun, 12 Oct 2008 20:38:19 +0100"/>
                            <attachment id="12392121" name="derby-3905_diff2.txt" size="8133" author="kmarsden" created="Tue, 14 Oct 2008 19:47:49 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 12 Oct 2008 22:35:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31049</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0xmv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39267</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>