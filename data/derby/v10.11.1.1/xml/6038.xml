<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:45:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6038/DERBY-6038.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6038] Intermittent failure in LangProcedureTest: cannot drop table because of open ResultSet</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6038</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Seen intermittently after LangProcedureTest was enabled:&lt;/p&gt;

&lt;p&gt;1) testDynamicResultSets(org.apache.derbyTesting.functionTests.tests.lang.LangProcedureTest)java.sql.SQLException: Operation &apos;DROP TABLE&apos; cannot be performed on object &apos;DELLATER3&apos; because there is an open ResultSet dependent on that object.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:256)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:424)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2400)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1334)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:630)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:559)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.LangProcedureTest.testDynamicResultSets(LangProcedureTest.java:976)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:424)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:441)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
Caused by: java.sql.SQLException: Operation &apos;DROP TABLE&apos; cannot be performed on object &apos;DELLATER3&apos; because there is an open ResultSet dependent on that object.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)&lt;br/&gt;
	... 47 more&lt;br/&gt;
Caused by: ERROR X0X95: Operation &apos;DROP TABLE&apos; cannot be performed on object &apos;DELLATER3&apos; because there is an open ResultSet dependent on that object.&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:295)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.verifyNoOpenResultSets(GenericLanguageConnectionContext.java:2146)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.prepareToInvalidate(GenericPreparedStatement.java:778)&lt;br/&gt;
	at org.apache.derby.impl.sql.depend.BasicDependencyManager.coreInvalidateFor(BasicDependencyManager.java:437)&lt;br/&gt;
	at org.apache.derby.impl.sql.depend.BasicDependencyManager.invalidateFor(BasicDependencyManager.java:298)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.DropTableConstantAction.executeConstantAction(DropTableConstantAction.java:265)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.MiscResultSet.open(MiscResultSet.java:61)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:452)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:333)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242)&lt;br/&gt;
	... 41 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12626909">DERBY-6038</key>
            <summary>Intermittent failure in LangProcedureTest: cannot drop table because of open ResultSet</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jan 2013 09:16:20 +0000</created>
                <updated>Mon, 17 Jun 2013 10:27:19 +0100</updated>
                            <resolved>Fri, 11 Jan 2013 09:22:29 +0000</resolved>
                                    <version>10.10.1.1</version>
                                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13549477" author="knutanders" created="Thu, 10 Jan 2013 09:36:22 +0000"  >&lt;p&gt;It reproduces every time in my environment if I run the test with -XX:+DisableExplicitGC. That switch disables a workaround in GenericLanguageConnectionContext.verifyNoOpenResultSets() that runs garbage collection to give the ResultSet a last chance to get closed before raising the error. The workaround is not 100% reliable, since calling System.gc() and System.runFinalization() is just a suggestion to the JVM, according to the Java SE javadocs. That&apos;s probably why the test occasionally fails also when it&apos;s run without the switch.&lt;/p&gt;</comment>
                            <comment id="13549569" author="knutanders" created="Thu, 10 Jan 2013 12:28:34 +0000"  >&lt;p&gt;Also seen in the nightly tests: &lt;a href=&quot;http://download.java.net/javadesktop/derby/javadb-5570895-report/javadb-5570895-3573399-details.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.java.net/javadesktop/derby/javadb-5570895-report/javadb-5570895-3573399-details.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13549572" author="knutanders" created="Thu, 10 Jan 2013 12:31:19 +0000"  >&lt;p&gt;One of the test cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3304&quot; title=&quot;Explicit commit inside a java procedure makes a dynamic result sets passed out unavailable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3304&quot;&gt;&lt;del&gt;DERBY-3304&lt;/del&gt;&lt;/a&gt; calls a stored Java procedure that raises an exception. The comments in the test case indicate that it expected all open result sets produced in the stored procedure to be closed automatically when the exception is raised. However, the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3304&quot; title=&quot;Explicit commit inside a java procedure makes a dynamic result sets passed out unavailable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3304&quot;&gt;&lt;del&gt;DERBY-3304&lt;/del&gt;&lt;/a&gt; only ensured that the CallStatementResultSet and all of its dynamic result sets would be closed automatically if the procedure failed. It would give the impression of having closed the other result sets opened in the procedure, because gc would in most cases close them implicitly before the table was attempted dropped, but not always.&lt;/p&gt;

&lt;p&gt;The attached patch makes the procedure close the non-dynamic result set explicitly to prevent the intermittent failure. It also updates the comments to say that the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3304&quot; title=&quot;Explicit commit inside a java procedure makes a dynamic result sets passed out unavailable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3304&quot;&gt;&lt;del&gt;DERBY-3304&lt;/del&gt;&lt;/a&gt; only affected the internal CallStatementResultSet and the dynamic result sets in the procedure. This makes the test run cleanly in my environment, also with the JVM switch that reliably reproduced the failure.&lt;/p&gt;</comment>
                            <comment id="13550702" author="dagw" created="Fri, 11 Jan 2013 02:15:56 +0000"  >&lt;p&gt;Thanks, Knut. Analysis and patch looks correct to me. +1&lt;/p&gt;</comment>
                            <comment id="13550999" author="knutanders" created="Fri, 11 Jan 2013 09:22:29 +0000"  >&lt;p&gt;Thanks, Dag. Committed revision 1431945.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12388563">DERBY-3414</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12385785">DERBY-3304</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12564156" name="d6038-1a-close-rs.diff" size="2910" author="knutanders" created="Thu, 10 Jan 2013 12:31:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 11 Jan 2013 02:15:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>303599</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz17gf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>251050</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>