<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:21 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5088/DERBY-5088.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5088] ShutdownException raised in istat thread during factory call</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5088</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Reported by Knut Anders in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5082&quot; title=&quot;ShutdownException in ContextManager.checkInterrupt() during shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5082&quot;&gt;&lt;del&gt;DERBY-5082&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
&amp;#8212;&lt;br/&gt;
While running the repro script, I&apos;ve also seen this exception printed to the console:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;index-stat-thread&quot; org.apache.derby.iapi.error.ShutdownException:&lt;br/&gt;
at org.apache.derby.iapi.services.context.ContextService.getFactory(ContextService.java:210)&lt;br/&gt;
at org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.run(IndexStatisticsDaemonImpl.java:700)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;ij didn&apos;t error out in that case, though.&lt;br/&gt;
&amp;#8212;&lt;/p&gt;

&lt;p&gt;This happens when the database is shut down before the istat worker thread has been initialized.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12500242">DERBY-5088</key>
            <summary>ShutdownException raised in istat thread during factory call</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Mar 2011 22:08:48 +0000</created>
                <updated>Thu, 30 Jun 2011 10:21:38 +0100</updated>
                            <resolved>Sun, 6 Mar 2011 09:43:10 +0000</resolved>
                                    <version>10.8.1.2</version>
                                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>Services</component>
                    <component>Store</component>
                        <due>Sun, 6 Mar 2011 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13001776" author="kristwaa" created="Thu, 3 Mar 2011 00:39:34 +0000"  >&lt;p&gt;Attaching patch 1a for review.&lt;br/&gt;
Refactors the exception handling code somewhat, and moves the factory call inside the try-catch.&lt;/p&gt;</comment>
                            <comment id="13001920" author="knutanders" created="Thu, 3 Mar 2011 08:50:52 +0000"  >&lt;p&gt;Thanks, Kristian! I ran the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5082&quot; title=&quot;ShutdownException in ContextManager.checkInterrupt() during shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5082&quot;&gt;&lt;del&gt;DERBY-5082&lt;/del&gt;&lt;/a&gt; repro script 70 times with the patch without seeing any problems, but I&apos;ve only seen this problem once, so it&apos;s difficult to say for sure whether the problem is fixed. But in any case, +1 to commit.&lt;/p&gt;</comment>
                            <comment id="13002181" author="lilywei" created="Thu, 3 Mar 2011 20:16:03 +0000"  >&lt;p&gt;Thanks, Kristian!! From looking at the code, I don&apos;t see much. When running the repro script, if I use the same db and get error and harmless telling me database exist and view already there, the script will hang. I understand this is a negative test. However, is this the expect behavior for the fix? Hope this help!&lt;/p&gt;</comment>
                            <comment id="13002238" author="kristwaa" created="Thu, 3 Mar 2011 21:36:41 +0000"  >&lt;p&gt;Sorry Lily, I didn&apos;t see your comment before after I committed the fix to trunk with revision 1076802.&lt;/p&gt;

&lt;p&gt;I don&apos;t quite understand what you mean with &quot;From looking at the code, I don&apos;t see much.&quot; Can you please clarify?&lt;br/&gt;
Note that if you reuse the database between runs it will quickly grow very large and may appear to hang while it is inserting data.&lt;/p&gt;

&lt;p&gt;The expected behavior for the fix is that you won&apos;t see the error / stacktrace reported by Knut when ij is exiting (which it will do when it has executed all the SQL commands in the script file). Since the bug is intermittent, it is not that easy to &quot;prove&quot; that it will never happen again.&lt;br/&gt;
If you see it now, the stacktrace should be different.&lt;/p&gt;</comment>
                            <comment id="13002316" author="lilywei" created="Thu, 3 Mar 2011 23:25:18 +0000"  >&lt;p&gt;That&apos;s okay. I understand. Thank Kristian for getting back to me so quickly.&lt;br/&gt;
I meant when I was looking at the code, the code seems to do the right thing. My only concern is whether daemonLCC.getDatabase().isActive() at IndexStatisticDaemonImpl.isShuttingDown() always reflects reality. Will isActive() method only return true when database is up and running. However, I couldn&apos;t come out with a case that the value does not reflect reality. &lt;/p&gt;

&lt;p&gt;You are right about the database grow very large. After running ij with more memory, I can see the row grow to more than millions. It is still running after 20 minutes. If I do see stacktrace, I will post them. Thanks!&lt;/p&gt;</comment>
                            <comment id="13003121" author="kristwaa" created="Sun, 6 Mar 2011 09:43:10 +0000"  >&lt;p&gt;Resolving issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12492660">DERBY-4939</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12500174">DERBY-5082</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12472491" name="derby-5088-1a-shutdownexception_refactor.diff" size="7469" author="kristwaa" created="Thu, 3 Mar 2011 00:39:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Mar 2011 00:39:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24640</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0fz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36406</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>