<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:59 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2812/DERBY-2812.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2812] Assessing blob (when its linked to DVD stream, ie large blob) corrupts stream fetched prior to this access.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2812</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description></description>
                <environment></environment>
        <key id="12371554">DERBY-2812</key>
            <summary>Assessing blob (when its linked to DVD stream, ie large blob) corrupts stream fetched prior to this access.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anurag">Anurag Shekhar</assignee>
                                    <reporter username="anurag">Anurag Shekhar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Jun 2007 18:27:35 +0100</created>
                <updated>Wed, 2 Dec 2009 11:53:32 +0000</updated>
                            <resolved>Fri, 15 Jun 2007 16:06:21 +0100</resolved>
                                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12504340" author="anurag" created="Wed, 13 Jun 2007 18:28:15 +0100"  >&lt;p&gt;Reproducible for both 2806 and this issue.&lt;/p&gt;</comment>
                            <comment id="12505047" author="anurag" created="Fri, 15 Jun 2007 06:54:07 +0100"  >&lt;p&gt;Description of Patch&lt;/p&gt;

&lt;p&gt;This patch makes use of PositionedStoreStream intoroduced in &lt;br/&gt;
derby-2806. I have introduced a wrapper AutoPositioningStream &lt;br/&gt;
for PositionedStoreStream. This class checks if PositionedStoreStream &lt;br/&gt;
has moved to a new postition since last read or seek and sets &lt;br/&gt;
it to back to the right position if it has.&lt;br/&gt;
There repositioning and actual operation on PositionedStoreStream &lt;br/&gt;
is performed within a synchrnized block synchrnizing on Connection Syncroniation object to avoid race condition.&lt;/p&gt;

&lt;p&gt;Class AutoPositioningStream extends from BinaryToRawStream to &lt;br/&gt;
skip the length information from PositionedStoreStream. I feel the &lt;br/&gt;
this class can be merged with BinaryToRawStream but wanted to &lt;br/&gt;
avoid making any change in BinaryToRawStream as this class is used &lt;br/&gt;
by few more classes (ResultSet and Statement) and we are too close &lt;br/&gt;
to deadline.&lt;/p&gt;

&lt;p&gt;Modified classes&lt;/p&gt;

&lt;p&gt;java/engine/org/apache/derby/impl/jdbc/EmbedBlob.java&lt;br/&gt;
       EmbedBlob now wraps stream retrieved from dvd before storing the &lt;br/&gt;
refrence locally.&lt;br/&gt;
       In getBinaryStream method it constructos and passes &lt;br/&gt;
AutoPositioningStrea as argument to UpdateableBlobStream.&lt;/p&gt;

&lt;p&gt;java/engine/org/apache/derby/impl/jdbc/BinaryToRawStream.java&lt;br/&gt;
       BinaryToRawStream is not final as AutoPositioningStream extends &lt;br/&gt;
from it. I plan to merger these two classes in a latter patch after 10.3 &lt;br/&gt;
release branch is cut.&lt;/p&gt;

&lt;p&gt;java/engine/org/apache/derby/impl/jdbc/UpdateableBlobStream.java&lt;br/&gt;
      UpdateableBlobStream was wrongly calling super.read in &lt;br/&gt;
read (byte [], int, int) method fixed it to call to stream instead.&lt;/p&gt;</comment>
                            <comment id="12505056" author="anurag" created="Fri, 15 Jun 2007 07:10:22 +0100"  >&lt;p&gt;In my previous patch, by mistake I included the release notes I was working on. Please ignore patch and consider derby-2812v2.diff for review/commit.&lt;/p&gt;</comment>
                            <comment id="12505063" author="anurag" created="Fri, 15 Jun 2007 07:41:43 +0100"  >&lt;p&gt;description of derby-2812-testsuites.diff&lt;/p&gt;

&lt;p&gt;I have added a new test MultiStreamLobTest under jdbcapi. It extracts two stream for blob and compares the two. It has a similar test for clob where it extracts two reader and compares them.&lt;/p&gt;</comment>
                            <comment id="12505154" author="kristwaa" created="Fri, 15 Jun 2007 12:10:08 +0100"  >&lt;p&gt;I had a look at &apos;derby-2812v2.diff&apos;. I also ran suites.All with Java 1.5, and it completed without failures.&lt;br/&gt;
As far as I can see, all my comments are additional improvements and nitpicks.&lt;/p&gt;

&lt;p&gt;Comments/questions:&lt;br/&gt;
 1) Since AutoPositioningStream extends BinaryToRawStream, can we be sure a non-store stream is never passed in? What&apos;s the consequence if it happens? (i.e. will the length be set to undetermined, or will the RawToBinaryStream fail?) I do see there is an assert in EmbedBlob, I was just thinking in more general terms.&lt;br/&gt;
    If AutoPositioningStream is only supposed to work on top of a PositionedStoreStream, maybe it should enforce that? As far as I can tell, it is not able to support the intended functionality if the passed in stream is not a PositionedStoreStream.&lt;/p&gt;

&lt;p&gt; 2) I think conChild, positionedStream and stream can be made final.&lt;/p&gt;

&lt;p&gt; 3) Some typos in the constructor JavaDoc (and &quot;operation&quot; -&amp;gt; &quot;operations&quot; in the class JavaDoc).&lt;/p&gt;

&lt;p&gt; 4) In skip, I don&apos;t think InputStream.skip is allowed to return &amp;lt; 0, and so the if (ret &amp;gt; 0) could be removed. It is not incorrect to have it, it might just be unnecessary.&lt;/p&gt;

&lt;p&gt; 5) Some trailing spaces on three &quot;empty&quot; lines. &lt;/p&gt;</comment>
                            <comment id="12505181" author="anurag" created="Fri, 15 Jun 2007 13:11:23 +0100"  >&lt;p&gt; 1) Since AutoPositioningStream extends BinaryToRawStream, can we be sure a non-store stream is never passed in? What&apos;s the consequence if it happens? (i.e. will the length be set to undetermined, or will the RawToBinaryStream fail?) I do see there is an assert in EmbedBlob, I was &lt;br/&gt;
In this patch derby-2812v3.diff i have addressed Kristian&apos;s comments&lt;br/&gt;
1. Enforcing PositionedStoreStream in AutoPositioningStream using SanityMagaer.assert&lt;/p&gt;

&lt;p&gt; 2) I think conChild, positionedStream and stream can be made final.&lt;br/&gt;
removed stream other two are final now&lt;/p&gt;

&lt;p&gt; 3) Some typos in the constructor JavaDoc (and &quot;operation&quot; -&amp;gt; &quot;operations&quot; in the class JavaDoc).&lt;br/&gt;
fixed typos&lt;/p&gt;

&lt;p&gt; 4) In skip, I don&apos;t think InputStream.skip is allowed to return &amp;lt; 0, and so the if (ret &amp;gt; 0) could be removed. It is not incorrect to have it, it might just be unnecessary.&lt;/p&gt;

&lt;p&gt;fixed&lt;/p&gt;

&lt;p&gt; 5) Some trailing spaces on three &quot;empty&quot; lines.&lt;/p&gt;

&lt;p&gt;thanks for the review&lt;br/&gt;
fixed&lt;/p&gt;</comment>
                            <comment id="12505261" author="kristwaa" created="Fri, 15 Jun 2007 16:06:21 +0100"  >&lt;p&gt;Thanks for the updated patch Anurag.&lt;br/&gt;
I ran suites.All and derbyall without failures.&lt;/p&gt;

&lt;p&gt;Committed &apos;derby-2812v3.diff&apos; to trunk with revision 547704.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12371445">DERBY-2806</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12359620" name="Derby2806.java" size="3224" author="anurag" created="Wed, 13 Jun 2007 18:28:15 +0100"/>
                            <attachment id="12359811" name="derby-2812-testsuites.diff" size="8617" author="anurag" created="Fri, 15 Jun 2007 07:41:43 +0100"/>
                            <attachment id="12359807" name="derby-2812.diff" size="12594" author="anurag" created="Fri, 15 Jun 2007 06:54:07 +0100"/>
                            <attachment id="12359809" name="derby-2812v2.diff" size="8317" author="anurag" created="Fri, 15 Jun 2007 07:10:22 +0100"/>
                            <attachment id="12359851" name="derby-2812v3.diff" size="8349" author="anurag" created="Fri, 15 Jun 2007 13:11:23 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 15 Jun 2007 11:10:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23263</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ri7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38274</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>