<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:43:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3385/DERBY-3385.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3385] Tests for JMX Management and Monitoring</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3385</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1387&quot; title=&quot;Add JMX extensions to Derby&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1387&quot;&gt;&lt;del&gt;DERBY-1387&lt;/del&gt;&lt;/a&gt; implements a new feature set in Derby: Java Management eXtentions (JMX), i.e. standards-based management and monitoring capabilities.&lt;/p&gt;

&lt;p&gt;As these are completely new features providing additional interfaces to a running Derby system, a set of functional regression tests should be added. The new tests should verify that Derby&apos;s public JMX API works as intended, and should be able to detect regressions in this area in the future. There is a functional specification (jmxFuncspec.html) attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1387&quot; title=&quot;Add JMX extensions to Derby&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1387&quot;&gt;&lt;del&gt;DERBY-1387&lt;/del&gt;&lt;/a&gt; which may be used as reference.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12387773">DERBY-3385</key>
            <summary>Tests for JMX Management and Monitoring</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12344126">DERBY-1387</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="johnemb">John H. Embretsen</assignee>
                                    <reporter username="johnemb">John H. Embretsen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Feb 2008 12:14:10 +0000</created>
                <updated>Mon, 4 May 2009 19:22:25 +0100</updated>
                            <resolved>Fri, 4 Apr 2008 14:53:59 +0100</resolved>
                                                    <fixVersion>10.4.1.3</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>JMX</component>
                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12567057" author="johnemb" created="Fri, 8 Feb 2008 14:52:21 +0000"  >&lt;p&gt;Attaching a simple sample program, TestJMXp9.java, demonstrating how to access Derby&apos;s JMX features programmatically, from a separate JVM on a local or remote machine. Will probably only work with patch 9 of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1387&quot; title=&quot;Add JMX extensions to Derby&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1387&quot;&gt;&lt;del&gt;DERBY-1387&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12572547" author="johnemb" created="Tue, 26 Feb 2008 16:27:39 +0000"  >&lt;p&gt;Attaching patch d3385_versionMBeanTest_01.diff in case anyone wants to review it while I&apos;m on vacation (1 week).&lt;/p&gt;

&lt;p&gt;The patch only includes tests for the Version MBean. Currently only attributes (names and types) for the VersionMBean instance for derby.jar are tested (I expect to add more later).&lt;/p&gt;

&lt;p&gt;A      java/testing/org/apache/derbyTesting/functionTests/tests/management&lt;/p&gt;

&lt;p&gt;New package for JMX management tests. Built with JDK1.5.&lt;/p&gt;

&lt;p&gt;A      java/testing/org/apache/derbyTesting/functionTests/tests/management/_Suite.java&lt;/p&gt;

&lt;p&gt;Test suite including all relevant management tests.&lt;/p&gt;

&lt;p&gt;A      java/testing/org/apache/derbyTesting/functionTests/tests/management/VersionMBeanTest.java&lt;/p&gt;

&lt;p&gt;Test fixtures/logic for the VersionMBean.&lt;/p&gt;

&lt;p&gt;A      java/testing/org/apache/derbyTesting/functionTests/tests/management/build.xml&lt;/p&gt;

&lt;p&gt;Build script for management tests.&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/junit/TestConfiguration.java&lt;/p&gt;

&lt;p&gt;Modifications to add jmxPort as a field in TestConfiguration. Default value is 9999 (arbitrarily chosen) for now. Let me know if there is a better way to do this.&lt;/p&gt;

&lt;p&gt;M      java/testing/build.xml&lt;/p&gt;

&lt;p&gt;Builds management tests as part of the overall test build.&lt;/p&gt;

&lt;p&gt;This patch does not add the new tests to a larger suite such as suites.All or junit-all.&lt;/p&gt;

&lt;p&gt;1 of the 10 tests will fail until the VersionMBean is updated (change attribute name &quot;MaintVersion&quot; to MaintenanceVersion&quot;). Running the tests requires JDK1.5 or better.&lt;/p&gt;</comment>
                            <comment id="12572594" author="djd" created="Tue, 26 Feb 2008 18:35:05 +0000"  >&lt;p&gt;I&apos;ll work on committing this. I think an improvement would be to separate out the generic jmx code from VersionMbeanTest into an abstract JMXTest class that VersionMbean would extend, then allowing other tests for other MBeans to be written easily.&lt;/p&gt;

&lt;p&gt;One thought is to ensure that the fixtures are flexible enough to run with different mechanisms to get the MBean, e.g. local jmx, remote jmx, accessing the platform MBean server from the same vm etc. I think what you have provided will allow this.&lt;/p&gt;

&lt;p&gt;Thanks for providing the initial setup, makes writing tests for others easier.&lt;/p&gt;

</comment>
                            <comment id="12572618" author="djd" created="Tue, 26 Feb 2008 19:10:08 +0000"  >&lt;p&gt;Patch committed as-is - revision 631355.&lt;/p&gt;

&lt;p&gt;Improved testing could include checking the values returned by getting the VersionMBean&apos;s attributues.&lt;/p&gt;</comment>
                            <comment id="12572620" author="djd" created="Tue, 26 Feb 2008 19:23:00 +0000"  >&lt;p&gt;Moved the utility code out of VersionMBean class into an MBeanTest class. Left the code that sets up the network server etc. in VersionMBean, not sure of its correct location. The functionality seems more suited to being decorators, e.g. jmx decorators that setup jmx and provide configfuration over how the JMX connection is made. Thus allowing the same fixtures to be used in multiple environments.&lt;/p&gt;</comment>
                            <comment id="12575675" author="johnemb" created="Thu, 6 Mar 2008 12:39:23 +0000"  >&lt;p&gt;Attached a patch for review, d3385_ant-junit-all.diff, which adds the management test suite as a new test run target ( junit-jmx ) in the top-level build.xml file. The tests are run (and automatically included in junit-all) only if the VM running Ant supports J2SE 5.0 or higher.&lt;/p&gt;</comment>
                            <comment id="12575724" author="djd" created="Thu, 6 Mar 2008 14:52:51 +0000"  >&lt;p&gt;Junit patch committed Revision: 634284 - Thanks John.&lt;/p&gt;</comment>
                            <comment id="12575770" author="johnemb" created="Thu, 6 Mar 2008 16:42:58 +0000"  >&lt;p&gt;Thanks for committing both patches, Dan. Also thank you very much for your contributions to JMX test configuration and setup the past week, and for testing the ManagementMBean!&lt;/p&gt;

&lt;p&gt;I intend to upload a patch soon adding fixtures for testing the VersionMBean for derbynet.jar (probably of limited value, but it doesn&apos;t hurt), and some updated comments base on the latest committed changes.&lt;/p&gt;

&lt;p&gt;I don&apos;t plan on adding checks for the actual values of the attributes yet, as I&apos;m not sure how to determine a lot of the expected values (version numbers etc.) in a way that won&apos;t require a lot of maintenance.&lt;/p&gt;</comment>
                            <comment id="12575778" author="djd" created="Thu, 6 Mar 2008 17:08:19 +0000"  >&lt;p&gt;On the version numbers, one approach is to cross-check with other mechanisms to return the same information, such as sysinfo, or DatabaseMetaData, JDBC Driver etc. Then at least one knows they are consistent.&lt;/p&gt;</comment>
                            <comment id="12575805" author="johnemb" created="Thu, 6 Mar 2008 17:50:01 +0000"  >&lt;p&gt;Attached a patch improving the VersionMBeanTest by adding fixtures for the derbynet.jar MBean, and brushing up some comments.&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/management/MBeanTest.java&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/tests/management/VersionMBeanTest.java&lt;/p&gt;

&lt;p&gt;I will consider adding attribute value value checking later...&lt;/p&gt;</comment>
                            <comment id="12576230" author="johnemb" created="Fri, 7 Mar 2008 15:16:28 +0000"  >&lt;p&gt;Thanks for committing patch 02 for the VersionMBeanTest with revision 634433 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Now attaching a new patch, d3385_jdbcMBeanTest_01.diff, which implements a junit test for the JDBCMBean. With this patch, the Emma tool reports 100% test coverage of org.apache.derby.jdbc.JDBC.java.&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/management/MBeanTest.java&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Extending BaseJDBCTestCase instead of BaseTestCase, since the new test subclass requires a JDBC connection in order to verify certain attribute values.&lt;/li&gt;
	&lt;li&gt;Added a return type (Object) to the invokeOperation method, and added a similar method for invoking an operation with arguments.&lt;/li&gt;
	&lt;li&gt;Added methods for retrieving sysinfo output from either the network server or the local VM (the latter is not used currently). This could potentially be useful for other tests as well, but I wasn&apos;t sure where to put it, so it lives in MBeanTest for now.&lt;/li&gt;
	&lt;li&gt;Added a couple of new assert methods.&lt;/li&gt;
	&lt;li&gt;Fixed some comments.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;A      java/testing/org/apache/derbyTesting/functionTests/tests/management/JDBCMBeanTest.java&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The new test class testing the presence, name, return type and return value of all expected attributes of the JDBCMBean, as well as the result of invoking the (only) operation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/management/_Suite.java&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Adding JDBCMBeanTest to the management test suite.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please review...&lt;/p&gt;</comment>
                            <comment id="12576250" author="djd" created="Fri, 7 Mar 2008 15:56:33 +0000"  >&lt;p&gt;I&apos;ll commit the jdbc patch but it needs a follow-on change. This code is not testing what it is meant to be testing:&lt;/p&gt;

&lt;p&gt;         DatabaseMetaData dbmd = getConnection().getMetaData();&lt;br/&gt;
        int expected = dbmd.getDriverMinorVersion();&lt;br/&gt;
        assertIntAttribute(expected, getJdbcMBeanObjectName(), &quot;MinorVersion&quot;);&lt;/p&gt;

&lt;p&gt;Since the suite wrapped the tests in a network server decorator, the connection, DatabaseMetaData and hence the driver version are all coming&lt;br/&gt;
from the client&apos;s driver, whereas the JDBCMBean is wrapping the embedded driver. While the versions are typically the same there is no requirement,&lt;br/&gt;
especially if folks try out combination testing.&lt;/p&gt;</comment>
                            <comment id="12576254" author="johnemb" created="Fri, 7 Mar 2008 16:08:29 +0000"  >&lt;p&gt;OK, thanks! I kind of knew that, but it must have slipped my mind when writing the code. And those tests passed by accident, so I didn&apos;t notice it...&lt;/p&gt;</comment>
                            <comment id="12576314" author="djd" created="Fri, 7 Mar 2008 18:19:29 +0000"  >&lt;p&gt;As a style issue I think the sysinfo code would be better as a test generic utility in o.a.dt.junit.something since it is independent of MBeans or JMX.&lt;/p&gt;

&lt;p&gt;As a community we do seem to have a habit of adding generic utilities into specific tests which leads to the same utility in multiple places (but sometimes implemented differently &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Something the old test harness was very prone to, it would be good if we can avoid this with Junit tests.&lt;/p&gt;
</comment>
                            <comment id="12576341" author="johnemb" created="Fri, 7 Mar 2008 19:18:02 +0000"  >&lt;p&gt;OK, I will move the sysinfo code to somewhere in o.a.dt.junit - that was my original plan anyways. I will also look into fixing the metadata/driver issue, but I most likely won&apos;t be able to do any of this before feature freeze and the cutting of the new branch.&lt;/p&gt;</comment>
                            <comment id="12577839" author="johnemb" created="Wed, 12 Mar 2008 13:07:31 +0000"  >&lt;p&gt;Attached patch file d3385_jdbcMBeanTest_02.diff:&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/management/MBeanTest.java&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/tests/management/JDBCMBeanTest.java&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/junit/TestConfiguration.java&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/junit/NetworkServerTestSetup.java&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/junit/Utilities.java&lt;/p&gt;

&lt;p&gt;This patch modifies the JDBCMBeanTest so that the expected values for the MajorVersion and MinorVersion attributes are obtained from the embedded driver instead of the client driver. &lt;/p&gt;

&lt;p&gt;I wasn&apos;t sure how to do this, but I ended up decorating these two test fixtures a bit differently than the rest of the fixtures, by using a ServerSetup which JDBCClient is set to embedded. The patch adds some logic in TestConfiguration.java and MBeanTest.java for handling this.&lt;/p&gt;

&lt;p&gt;The patch also moves the two generic utility methods for fetching sysinfo output from MBeanTest.java to org.apache.derbyTesting.junit.Utilities.java. In addition, the patch revises some Javadoc comments in NetworkServerTestSetup.java.&lt;/p&gt;

&lt;p&gt;When testing this patch I once ran into timeout issues similar to those reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3515&quot; title=&quot;23 timeouts encountered while running management junit suite as part of full nightly runs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3515&quot;&gt;&lt;del&gt;DERBY-3515&lt;/del&gt;&lt;/a&gt; when running the management Suite on WinXP (single-CPU) - but I have not been able to reproduce this yet, and it was likely not related to this specific patch - so I&apos;m asking for review/commit at this point.&lt;/p&gt;</comment>
                            <comment id="12577864" author="djd" created="Wed, 12 Mar 2008 14:50:08 +0000"  >&lt;p&gt;Does this method make sense?&lt;/p&gt;

&lt;p&gt; MBeanTest.decorateWithRemoteJmxAndEmbeddedJDBC&lt;/p&gt;

&lt;p&gt;In this case Derby&apos;s MBean will be running against the embedded jdbc driver on the remote machine,&lt;br/&gt;
but the junit test will be running against the embedded driver in the test vm.&lt;/p&gt;

&lt;p&gt;I guess they are the same but that is an assumption, it could change in the future, maybe any improvements could be addressed then.&lt;/p&gt;</comment>
                            <comment id="12577865" author="djd" created="Wed, 12 Mar 2008 14:55:39 +0000"  >&lt;p&gt;Another thought is just use a really simple approach instead of hiding all of this through decorators:&lt;/p&gt;

&lt;p&gt; Driver d = new org.apache.derby.jdbc.EmbeddedDriver();&lt;/p&gt;

&lt;p&gt;  d.getMinorVersion();&lt;/p&gt;

&lt;p&gt;  d.getMajorVersion();&lt;/p&gt;

&lt;p&gt;Sometimes simplicity &amp;amp; directness is better.&lt;/p&gt;</comment>
                            <comment id="12577868" author="johnemb" created="Wed, 12 Mar 2008 15:07:27 +0000"  >&lt;p&gt;Ah, so I don&apos;t really need to use DatabaseMetaData.... Much better, I will create a new patch with this change (using the Driver interface directly). &lt;br/&gt;
It still does not necessarily access the exact same embedded driver as the MBean implementation, but I have no idea how to access the embedded driver in a remote VM. It is better than using the client driver though, I guess.&lt;/p&gt;</comment>
                            <comment id="12577884" author="johnemb" created="Wed, 12 Mar 2008 15:51:45 +0000"  >&lt;p&gt;Attached patch file d3385_jdbcMBeanTest_03.diff, to replace d3385_jdbcMBeanTest_02.diff:&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/management/MBeanTest.java&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/tests/management/JDBCMBeanTest.java&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/junit/NetworkServerTestSetup.java&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/junit/Utilities.java&lt;/p&gt;

&lt;p&gt;This patch modifies the JDBCMBeanTest so that the expected values for the MajorVersion and MinorVersion attributes are obtained from the embedded driver instead of the client driver. &lt;/p&gt;

&lt;p&gt;The difference from patch 02 is that the expected values are retrieved directly from the embedded driver (assuming this is available in the classpath) instead of going through DatabaseMetaData and for that reason jumping through various hoops in order to get a JDBC connection using the embedded driver.&lt;/p&gt;

&lt;p&gt;As with patch 02, this patch also revises some javadoc comments in NetworkServerTestSetup, and moves the generic utility methods for getting sysinfo output, from MBeanTest to the Utilities class in org.apache.derbyTesting.junit.&lt;/p&gt;</comment>
                            <comment id="12577922" author="djd" created="Wed, 12 Mar 2008 17:02:51 +0000"  >&lt;p&gt;patch d3385_jdbcMBeanTest_03.diff applied revision 636417 - Thanks John.&lt;/p&gt;</comment>
                            <comment id="12585535" author="johnemb" created="Fri, 4 Apr 2008 14:53:59 +0100"  >&lt;p&gt;Currently planned tests have been committed to trunk and 10.4 branch, so I am resolving this issue. Additional improvements and additions can be tracked by new Jira issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12375079" name="TestJMXp9.java" size="5361" author="johnemb" created="Fri, 8 Feb 2008 14:52:21 +0000"/>
                            <attachment id="12377247" name="d3385_ant-junit-all.diff" size="2348" author="johnemb" created="Thu, 6 Mar 2008 12:39:23 +0000"/>
                            <attachment id="12377355" name="d3385_jdbcMBeanTest_01.diff" size="14263" author="johnemb" created="Fri, 7 Mar 2008 15:16:28 +0000"/>
                            <attachment id="12377695" name="d3385_jdbcMBeanTest_02.diff" size="22936" author="johnemb" created="Wed, 12 Mar 2008 13:07:30 +0000"/>
                            <attachment id="12377704" name="d3385_jdbcMBeanTest_03.diff" size="12546" author="johnemb" created="Wed, 12 Mar 2008 15:51:45 +0000"/>
                            <attachment id="12376503" name="d3385_versionMBeanTest_01.diff" size="25672" author="johnemb" created="Tue, 26 Feb 2008 16:27:39 +0000"/>
                            <attachment id="12377269" name="d3385_versionMBeanTest_02.diff" size="8566" author="johnemb" created="Thu, 6 Mar 2008 17:50:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 26 Feb 2008 18:35:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30830</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0xo7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39273</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>