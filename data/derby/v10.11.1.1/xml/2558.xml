<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:18 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2558/DERBY-2558.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2558] client trhows ArrayIndexOutOfBounds exception instead of parameter out of range </title>
                <link>https://issues.apache.org/jira/browse/DERBY-2558</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>
&lt;p&gt;The following sql gives an ArrayIndexOutOfBoundsException with client.  With embedded we get the expected.&lt;br/&gt;
ERROR XCL13: The parameter position &apos;2&apos; is out of range.  The number of parameters for this prepared  statement is &apos;1&apos;.&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t (i int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t values (3), (4);&lt;br/&gt;
2 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; execute &apos;select * from t where i=?&apos; using &apos;values (3,4)&apos;;&lt;br/&gt;
IJ WARNING: Autocommit may close using result set&lt;br/&gt;
JAVA ERROR: java.lang.ArrayIndexOutOfBoundsException: 1&lt;br/&gt;
java.lang.ArrayIndexOutOfBoundsException: 1&lt;br/&gt;
        at org.apache.derby.client.am.PreparedStatement.setObjectX(PreparedStatement.java:1506)&lt;br/&gt;
        at org.apache.derby.client.am.PreparedStatement.setObject(PreparedStatement.java:1458)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.util.DisplayMulti(util.java:696)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:474)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:351)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:270)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.Main.go(Main.java:215)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)&lt;br/&gt;
        at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:56)&lt;br/&gt;
        at org.apache.derby.tools.ij.main(ij.java:71)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12367410">DERBY-2558</key>
            <summary>client trhows ArrayIndexOutOfBounds exception instead of parameter out of range </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Apr 2007 21:41:32 +0100</created>
                <updated>Fri, 17 Aug 2007 23:37:35 +0100</updated>
                            <resolved>Wed, 16 May 2007 04:00:35 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12494175" author="bryanpendleton" created="Tue, 8 May 2007 04:24:07 +0100"  >&lt;p&gt;I think it would be reasonable to address this as an IJ issue,&lt;br/&gt;
by enhancing util.DisplayMulti() to compare ResultSetMetaData.getColumnCount()&lt;br/&gt;
against ParameterMetadata.getParameterCount(), and complain&lt;br/&gt;
if the two counts do not match.&lt;/p&gt;

&lt;p&gt;At least, it seems to improve this particular test case. I&apos;ll try to work it&lt;br/&gt;
up as a proper patch, and see what results I get.&lt;/p&gt;</comment>
                            <comment id="12494530" author="bryanpendleton" created="Wed, 9 May 2007 18:06:37 +0100"  >&lt;p&gt;Attached is &apos;ijCheckParms.diff&apos;, a patch proposal.&lt;/p&gt;

&lt;p&gt;This patch modifies IJ so that it cross-checks the number&lt;br/&gt;
of parameters in the prepared statement against the&lt;br/&gt;
number of columns in the provided result set, and complains&lt;br/&gt;
if the two do not have the same size.&lt;/p&gt;

&lt;p&gt;The patch also includes a few tests.&lt;/p&gt;

&lt;p&gt;derbyall and suites.All pass.&lt;/p&gt;

&lt;p&gt;Please have a look at the patch proposal and tell me what you think.&lt;/p&gt;</comment>
                            <comment id="12495760" author="kmarsden" created="Mon, 14 May 2007 20:30:09 +0100"  >&lt;p&gt;It seems to me that since the ArrayIndexOutOfBounds exception is being thrown from within client, we should be able to get a java reproduction for this outside of ij.  I tried, but got  a perfectly reasonable error message with the code below, so I am not sure how to reproduce, but it does seem like just working around the issue in ij is not the   best  solution.&lt;/p&gt;


&lt;p&gt;import java.sql.DriverManager;&lt;br/&gt;
import java.sql.SQLException;&lt;br/&gt;
import java.sql.Statement;&lt;br/&gt;
import java.sql.Connection;&lt;br/&gt;
import java.sql.ResultSet;&lt;br/&gt;
import java.sql.PreparedStatement;&lt;/p&gt;

&lt;p&gt;public class d2558 {&lt;/p&gt;

&lt;p&gt;    public static void main(String[] args) throws Exception {&lt;/p&gt;

&lt;p&gt;        Class.forName(&quot;org.apache.derby.jdbc.ClientDriver&quot;);&lt;br/&gt;
        Connection conn = DriverManager.getConnection(&quot;jdbc:derby://localhost:1527/wombat;create=true;traceFile=trace.out&quot;);&lt;br/&gt;
        Statement s = conn.createStatement();&lt;/p&gt;

&lt;p&gt;        try &lt;/p&gt;
{
            s.executeUpdate(&quot;DROP TABLE t &quot;);
        }
&lt;p&gt; catch (SQLException se) {}&lt;/p&gt;



&lt;p&gt;        s.executeUpdate(&quot;Create table t (i int)&quot;);&lt;br/&gt;
        s.executeUpdate(&quot;insert into t values (3), (4)&quot;);&lt;br/&gt;
        PreparedStatement ps = conn.prepareStatement(&quot;select * from t where i=?&quot;);&lt;br/&gt;
        ps.setObject(1,new Integer(3));&lt;br/&gt;
        ps.setObject(2,new Integer(4));&lt;br/&gt;
        ResultSet rs = ps.executeQuery();&lt;/p&gt;


&lt;p&gt;    }&lt;br/&gt;
}&lt;/p&gt;</comment>
                            <comment id="12495766" author="bryanpendleton" created="Mon, 14 May 2007 20:48:48 +0100"  >&lt;p&gt;Hi Kathey, thanks for the feedback!&lt;/p&gt;

&lt;p&gt;I see what you mean.&lt;/p&gt;

&lt;p&gt;I also notice that IJ&apos;s code is calling the 4-argument version of setObject, not&lt;br/&gt;
the 2-argument version, and I wonder if that is why your repro didn&apos;t provoke the error.&lt;/p&gt;

&lt;p&gt;I will look more closely at the client code, using your repro as a basis.&lt;/p&gt;</comment>
                            <comment id="12495768" author="kmarsden" created="Mon, 14 May 2007 20:56:33 +0100"  >&lt;p&gt;Thanks Bryan,  I was using the wrong setObject call.&lt;br/&gt;
Attached is the java repro for the issue&lt;/p&gt;</comment>
                            <comment id="12495781" author="bryanpendleton" created="Mon, 14 May 2007 21:46:29 +0100"  >&lt;p&gt;Thanks Kathey, your repro works for me too.&lt;/p&gt;

&lt;p&gt;I will investigate fixing this in the client rather than in ij.&lt;/p&gt;</comment>
                            <comment id="12495815" author="bryanpendleton" created="Tue, 15 May 2007 00:59:00 +0100"  >&lt;p&gt;Attached is setObjectCheckIndex.diff, an alternate patch proposal.&lt;/p&gt;

&lt;p&gt;Instead of checking the parameter index in IJ, this change checks&lt;br/&gt;
the parameterIndex at the start of the client&apos;s setObject() method,&lt;br/&gt;
using the same method as is done for the other overloads of&lt;br/&gt;
setObject.&lt;/p&gt;

&lt;p&gt;As Kathey observed, it&apos;s better to fix this in the client code directly&lt;br/&gt;
because then it fixes not only the IJ case but also all other code that&lt;br/&gt;
might use the client APIs, such as a user&apos;s application.&lt;/p&gt;

&lt;p&gt;The patch proposal contains a new test case, as an IJ script, taken&lt;br/&gt;
from the initial repro.&lt;/p&gt;

&lt;p&gt;I&apos;d appreciate feedback about whether we should also add some&lt;br/&gt;
test cases which directly call the JDBC API as well, based on&lt;br/&gt;
Kathey&apos;s d2558.java test program, or whether that&lt;br/&gt;
would be overkill and it&apos;s adequate just to test this via IJ.&lt;/p&gt;

&lt;p&gt;derbyall and suites.All testing was clean with this patch.&lt;/p&gt;</comment>
                            <comment id="12495840" author="kmarsden" created="Tue, 15 May 2007 02:55:35 +0100"  >&lt;p&gt;Patch looks good to me.  I don&apos;t think we need a separate java test.&lt;/p&gt;</comment>
                            <comment id="12495843" author="kmarsden" created="Tue, 15 May 2007 03:57:04 +0100"  >&lt;p&gt;actually I don&apos;t think ij2.sql runs with client, so the test would only test embedded (I think)&lt;/p&gt;</comment>
                            <comment id="12495845" author="bryanpendleton" created="Tue, 15 May 2007 04:02:55 +0100"  >&lt;p&gt;I&apos;ll look into adding your repro as a test case in something like&lt;br/&gt;
derbynet/PrepareStatementTest.java. It should be pretty straightforward,&lt;br/&gt;
and that way we&apos;re sure we have a test case covering client code.&lt;/p&gt;</comment>
                            <comment id="12496120" author="bryanpendleton" created="Tue, 15 May 2007 21:35:03 +0100"  >&lt;p&gt;Attached is &apos;withJDBCTestCase.diff&apos;, an updated patch proposal&lt;br/&gt;
which contains a new test in the PrepareStatementTest suite.&lt;/p&gt;

&lt;p&gt;I left the ij2.sql test in place, because I think it is a reasonable&lt;br/&gt;
test and it doesn&apos;t add much time and eventually we might make&lt;br/&gt;
ij2.sql run against the client, in which case this test case will&lt;br/&gt;
also help verify this change.&lt;/p&gt;

&lt;p&gt;I checked that PrepareStatementTest fails as expected in client&lt;br/&gt;
mode without the code fix, and works in both client and embedded&lt;br/&gt;
with the code fix, and derbyall and suites.All were all clean.&lt;/p&gt;
</comment>
                            <comment id="12496124" author="kmarsden" created="Tue, 15 May 2007 21:47:55 +0100"  >&lt;p&gt;looks good to me&lt;/p&gt;</comment>
                            <comment id="12496179" author="bryanpendleton" created="Wed, 16 May 2007 04:00:35 +0100"  >&lt;p&gt;Committed withJDBCTestCase.diff to subversion as revision 538413.&lt;/p&gt;

&lt;p&gt;Thanks Kathey for the reviews and suggestions!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12356981" name="IJCheckParms.diff" size="6923" author="bryanpendleton" created="Wed, 9 May 2007 18:06:36 +0100"/>
                            <attachment id="12357306" name="d2558.java" size="987" author="kmarsden" created="Mon, 14 May 2007 20:56:33 +0100"/>
                            <attachment id="12357329" name="setObjectCheckIndex.diff" size="3384" author="bryanpendleton" created="Tue, 15 May 2007 00:59:00 +0100"/>
                            <attachment id="12357419" name="withJDBCTestCase.diff" size="4644" author="bryanpendleton" created="Tue, 15 May 2007 21:35:03 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 May 2007 03:24:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23101</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy118f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39850</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>