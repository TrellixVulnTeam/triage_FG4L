<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:25:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1213/DERBY-1213.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1213] create new space reclamation test based on functionality removed from access.sql test</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1213</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In order to get rid of the inconsistent  regression test results reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-990&quot; title=&quot;store/access.sql fails - incorrect index?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-990&quot;&gt;&lt;del&gt;DERBY-990&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1210&quot; title=&quot;With encryptionCFB suite store/access.sql fails with IBM jdk 1.3.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1210&quot;&gt;&lt;del&gt;DERBY-1210&lt;/del&gt;&lt;/a&gt;, removed the following &lt;br/&gt;
from the access.sql script.  This methodology has been problematic and multiple &quot;hacks&quot; have been put in to try and get the&lt;br/&gt;
results reproducible.  The results are very timing dependent on background threads.   The test probably should be rewritten&lt;br/&gt;
as a .java program and at the very least report the differences in space management in the error (rather than the lazy approach&lt;br/&gt;
used because logic was not possible in a .sql script).&lt;/p&gt;

&lt;p&gt;Here is the original scripting:&lt;br/&gt;
&amp;#8212; buddy test case for reclaiming deleted rows during split.&lt;br/&gt;
&amp;#8212; test space reclamation using the SpaceTable VTI.&lt;br/&gt;
&amp;#8212;    o insert bunch of rows with sequential keys.&lt;br/&gt;
&amp;#8212;    o create non-unique index.&lt;br/&gt;
&amp;#8212;    o check space usage for index using SpaceTable VTI&lt;br/&gt;
&amp;#8212;    o delete every other one less than 1000 - this will make normal post&lt;br/&gt;
&amp;#8212;      commit not fire as no page should have all deleted rows (&amp;lt; 1000 avoids&lt;br/&gt;
&amp;#8212;      possible case where last page only has 1 row).&lt;br/&gt;
&amp;#8212;    o commit&lt;br/&gt;
&amp;#8212;    o now reinsert rows into the &quot;holes&quot; which before the fix would cause&lt;br/&gt;
&amp;#8212;      splits, but now will force reclaim space and reuse existing space in&lt;br/&gt;
&amp;#8212;      btree.&lt;br/&gt;
&amp;#8212;    o redo delete, commit and insert several times over&lt;br/&gt;
&amp;#8212;    o check space usage for index using SpaceTable VTI is same as above&lt;/p&gt;

&lt;p&gt;&amp;#8212; set page size to default.&lt;br/&gt;
-call SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(&apos;derby.storage.pageSize&apos;, &apos;4096&apos;);&lt;br/&gt;
-call SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(&apos;derby.storage.minimumRecordSize&apos;,&lt;br/&gt;
&apos;1&apos;);&lt;br/&gt;
-&lt;br/&gt;
-autocommit off;&lt;br/&gt;
-commit;&lt;br/&gt;
-drop table foo;&lt;br/&gt;
-drop table foo2;&lt;br/&gt;
-&lt;br/&gt;
&amp;#8212; create and load a table with values from 1024 down to 1,&lt;br/&gt;
-create table foo (a int, b char(200), c int);&lt;br/&gt;
-&lt;br/&gt;
-insert into foo values (1024, &apos;even&apos;, 0);&lt;br/&gt;
-insert into foo        (select foo.a - 1, &apos;odd&apos; , 1 from foo);&lt;br/&gt;
-&lt;br/&gt;
-insert into foo (select foo.a - 2,   foo.b, foo.c from foo);&lt;br/&gt;
-insert into foo (select foo.a - 4,   foo.b, foo.c from foo);&lt;br/&gt;
-insert into foo (select foo.a - 8,   foo.b, foo.c from foo);&lt;br/&gt;
-insert into foo (select foo.a - 16,  foo.b, foo.c from foo);&lt;br/&gt;
-insert into foo (select foo.a - 32,  foo.b, foo.c from foo);&lt;br/&gt;
-insert into foo (select foo.a - 64,  foo.b, foo.c from foo);&lt;br/&gt;
-insert into foo (select foo.a - 128, foo.b, foo.c from foo);&lt;br/&gt;
-insert into foo (select foo.a - 256, foo.b, foo.c from foo);&lt;br/&gt;
-insert into foo (select foo.a - 512, foo.b, foo.c from foo);&lt;br/&gt;
-&lt;br/&gt;
&amp;#8212; insert into the &quot;holes&quot;, but different keys (even2 instead of even)&lt;br/&gt;
-create table foo2 (a int, b char(200), c int);&lt;br/&gt;
-insert into foo2 (select * from foo);&lt;br/&gt;
-delete from foo2 where foo2.c = 1;&lt;br/&gt;
-delete from foo2 where foo2.a &amp;gt;= 1000;&lt;br/&gt;
-&lt;br/&gt;
&amp;#8212; create &quot;packed&quot; index.&lt;br/&gt;
-create index a on foo (a, b);&lt;br/&gt;
-commit;&lt;br/&gt;
-&lt;br/&gt;
-create table spaceused (a int);&lt;br/&gt;
-&lt;br/&gt;
&amp;#8212; check space usage on the index&lt;br/&gt;
-insert into spaceused&lt;br/&gt;
-select numallocatedpages&lt;br/&gt;
-from new org.apache.derby.diag.SpaceTable(&apos;FOO&apos;) t&lt;br/&gt;
-where conglomeratename = &apos;A&apos;;&lt;br/&gt;
-&lt;br/&gt;
&amp;#8212; delete every other row&lt;br/&gt;
-delete from foo where foo.c = 0 and foo.a &amp;lt; 1000;&lt;br/&gt;
&amp;#8212; turn all the deletes into &quot;committed deletes&quot;&lt;br/&gt;
-commit;&lt;br/&gt;
&amp;#8212; wait for post commit on heap deleted rows to finish, so that there is&lt;br/&gt;
&amp;#8212; no interference between post commit heap processing, and btree reclamation&lt;br/&gt;
&amp;#8212; during split.&lt;br/&gt;
-CALL WAIT_FOR_POST_COMMIT();&lt;br/&gt;
-&lt;br/&gt;
&amp;#8212; reinsert&lt;br/&gt;
-insert into foo (select * from foo2);&lt;br/&gt;
-commit;&lt;br/&gt;
&amp;#8212; do the above several times&lt;br/&gt;
-delete from foo where foo.c = 0 and foo.a &amp;lt; 1000;&lt;br/&gt;
-commit;&lt;br/&gt;
&amp;#8212; wait for post commit on heap deleted rows to finish, so that there is&lt;br/&gt;
&amp;#8212; no interference between post commit heap processing, and btree reclamation&lt;br/&gt;
&amp;#8212; during split.&lt;br/&gt;
-CALL WAIT_FOR_POST_COMMIT();&lt;br/&gt;
-&lt;br/&gt;
-insert into foo (select * from foo2);&lt;br/&gt;
-delete from foo where foo.c = 0 and foo.a &amp;lt; 1000;&lt;br/&gt;
-commit;&lt;br/&gt;
&amp;#8212; wait for post commit on heap deleted rows to finish, so that there is&lt;br/&gt;
&amp;#8212; no interference between post commit heap processing, and btree reclamation&lt;br/&gt;
&amp;#8212; during split.&lt;br/&gt;
-CALL WAIT_FOR_POST_COMMIT();&lt;br/&gt;
-&lt;br/&gt;
-insert into foo (select * from foo2);&lt;br/&gt;
-delete from foo where foo.c = 0 and foo.a &amp;lt; 1000;&lt;br/&gt;
-commit;&lt;br/&gt;
&amp;#8212; wait for post commit on heap deleted rows to finish, so that there is&lt;br/&gt;
&amp;#8212; no interference between post commit heap processing, and btree reclamation&lt;br/&gt;
&amp;#8212; during split.&lt;br/&gt;
-CALL WAIT_FOR_POST_COMMIT();&lt;br/&gt;
-&lt;br/&gt;
-insert into foo (select * from foo2);&lt;br/&gt;
-delete from foo where foo.c = 0 and foo.a &amp;lt; 1000;&lt;br/&gt;
-commit;&lt;br/&gt;
&amp;#8212; wait for post commit on heap deleted rows to finish, so that there is&lt;br/&gt;
&amp;#8212; no interference between post commit heap processing, and btree reclamation&lt;br/&gt;
&amp;#8212; during split.&lt;br/&gt;
-CALL WAIT_FOR_POST_COMMIT();&lt;br/&gt;
-&lt;br/&gt;
-insert into foo (select * from foo2);&lt;br/&gt;
-delete from foo where foo.c = 0 and foo.a &amp;lt; 1000;&lt;br/&gt;
-commit;&lt;br/&gt;
&amp;#8212; wait for post commit on heap deleted rows to finish, so that there is&lt;br/&gt;
&amp;#8212; no interference between post commit heap processing, and btree reclamation&lt;br/&gt;
&amp;#8212; during split.&lt;br/&gt;
-CALL WAIT_FOR_POST_COMMIT();&lt;br/&gt;
-&lt;br/&gt;
-&lt;br/&gt;
-insert into foo (select * from foo2);&lt;br/&gt;
-&lt;br/&gt;
-commit;&lt;br/&gt;
-&lt;br/&gt;
&amp;#8212; check space usage on the index&lt;br/&gt;
-insert into spaceused&lt;br/&gt;
-select numallocatedpages&lt;br/&gt;
-from new org.apache.derby.diag.SpaceTable(&apos;FOO&apos;) t&lt;br/&gt;
-where conglomeratename = &apos;A&apos;;&lt;br/&gt;
-&lt;br/&gt;
&amp;#8212; should only be 1 distinct row in this table since space used by the&lt;br/&gt;
&amp;#8212; index should be the same before and after&lt;br/&gt;
-select count(distinct a)&lt;br/&gt;
-from spaceused;&lt;br/&gt;
-&lt;br/&gt;
&amp;#8212; cleanup&lt;br/&gt;
-drop table foo;&lt;br/&gt;
-drop table foo2;&lt;br/&gt;
-drop table spaceused;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12332093">DERBY-1213</key>
            <summary>create new space reclamation test based on functionality removed from access.sql test</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mikem">Mike Matrigali</reporter>
                        <labels>
                            <label>derby_triage10_8</label>
                    </labels>
                <created>Fri, 14 Apr 2006 03:17:29 +0100</created>
                <updated>Thu, 17 Feb 2011 21:47:53 +0000</updated>
                                            <version>10.2.1.6</version>
                                                    <component>Store</component>
                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29895</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0hxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36722</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>