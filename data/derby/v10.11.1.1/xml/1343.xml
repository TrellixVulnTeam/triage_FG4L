<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:38:19 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1343/DERBY-1343.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1343] It is possible to have duplicate entries in conglomerateId of sysconglomerates before DERBY-655 was fixed in 10.0 or 10.1 databases. It is desirable to patch these databases on upgrade to 10.2 so conglomerateId becomes unique again.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1343</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Because of an optimization implemented in before Derby 10.0 release, it is possible to have duplicate entries in conglomerateId column. It would be good to patch these entries during upgrade to 10.2 or later so that conglomerateIds become unique again. See the discussion and proposed solutions at:&lt;br/&gt;
&lt;a href=&quot;http://www.nabble.com/-Derby-655-+%3A+getImportedKeys+returns+duplicate+rows+in+some+cases-t1673189.html#a4535887&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/-Derby-655-+%3A+getImportedKeys+returns+duplicate+rows+in+some+cases-t1673189.html#a4535887&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When a user defines a constraint, Derby checks to see if it&apos;s backing index is a duplicate of an existing index and if yes, then it shares the same conglomerates for both such indexes. Code for this is in org.apache.derby.impl.sql.execute.CreateIndexConstantAction.executeConstantAction. This causes Derby to have duplicate rows in sysconglomerates with same conglomerateid. (More information on this can be found in thread &lt;a href=&quot;http://www.nabble.com/-Derby-655-+%3A+getImportedKeys+returns+duplicate+rows+in+some+cases-t1673189.html#a4535887&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/-Derby-655-+%3A+getImportedKeys+returns+duplicate+rows+in+some+cases-t1673189.html#a4535887&lt;/a&gt; titled &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-655&quot; title=&quot;getImportedKeys returns duplicate rows in some cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-655&quot;&gt;&lt;del&gt;DERBY-655&lt;/del&gt;&lt;/a&gt; : getImportedKeys returns duplicate rows in some cases&quot;.&lt;/p&gt;

&lt;p&gt;During drop constraint, it looks like Derby is not able to identify the correct row in SYSCONGLOMERATES, if there are duplicate rows with same conglomerateid and as a consequence, wrong row gets dropped in SYSCONGLOMERATES. More information with an example on this can be found in thread &lt;a href=&quot;http://www.nabble.com/When+foreign+key+is+dropped%2C+is+Derby+dropping+the+wrong+row+from+SYS.SYSCONGLOMERATES--t1654121.html#a4481463&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/When+foreign+key+is+dropped%2C+is+Derby+dropping+the+wrong+row+from+SYS.SYSCONGLOMERATES--t1654121.html#a4481463&lt;/a&gt; titled &quot;When foreign key is dropped, is Derby dropping the wrong row from SYS.SYSCONGLOMERATES?&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12343486">DERBY-1343</key>
            <summary>It is possible to have duplicate entries in conglomerateId of sysconglomerates before DERBY-655 was fixed in 10.0 or 10.1 databases. It is desirable to patch these databases on upgrade to 10.2 so conglomerateId becomes unique again.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mamtas">Mamta A. Satoor</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 May 2006 03:00:05 +0100</created>
                <updated>Tue, 18 Jun 2013 17:15:09 +0100</updated>
                            <resolved>Mon, 30 Nov 2009 15:20:26 +0000</resolved>
                                    <version>10.0.2.0</version>
                                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12417341" author="mikem" created="Fri, 23 Jun 2006 01:31:41 +0100"  >&lt;p&gt;this is an issue with the system catalogs, from discussions on list it looks like not a store issue.&lt;/p&gt;</comment>
                            <comment id="12424251" author="kmarsden" created="Sat, 29 Jul 2006 02:04:04 +0100"  >&lt;p&gt;I am a litle confused by this JIRA. Is it an upgrade requirement for 10.2, e.g. should this be marked URGENT or is it just a nice to have?  What are the ramifications of not  fixing  it?  How would users be affected?&lt;/p&gt;
</comment>
                            <comment id="12435835" author="rhillegas" created="Tue, 19 Sep 2006 15:54:57 +0100"  >&lt;p&gt;Moving to 10.2.2.0.&lt;/p&gt;</comment>
                            <comment id="12456060" author="rhillegas" created="Wed, 6 Dec 2006 14:49:53 +0000"  >&lt;p&gt;Move to 10.2.3.0.&lt;/p&gt;</comment>
                            <comment id="12467530" author="fuzzylogic" created="Thu, 25 Jan 2007 20:36:36 +0000"  >&lt;p&gt;Unsetting Fix Version for unassigned issues.&lt;/p&gt;</comment>
                            <comment id="12480611" author="djd" created="Tue, 13 Mar 2007 23:50:47 +0000"  >&lt;p&gt;I stumbled across this bug as part of the cleanup for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2397&quot; title=&quot;Dropping SQL objects could be improved by reducing the number of classes required.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2397&quot;&gt;DERBY-2397&lt;/a&gt;, since the code in DropConstraintConstantAction (copied here) just looked wrong.&lt;/p&gt;

&lt;p&gt;				for (int i = 0; i &amp;lt; conglomDescs.length; i++)&lt;br/&gt;
				{&lt;br/&gt;
					if (conglomDescs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.isConstraint())&lt;/p&gt;
					{
						DropIndexConstantAction.dropIndex(dm, dd, tc,
													conglomDescs[i], td, 
													lcc);
						break;
					}
&lt;p&gt;				}&lt;/p&gt;

&lt;p&gt;The code looks wrong because of the &apos;break&quot;, why is the first match good enough? As Mamta pointed out in the thread above the &quot;wrong&quot; CoglomerateDescriptor (row in SYSCONGLOMERATES) gets dropped.&lt;/p&gt;

&lt;p&gt;Looking at it more though I don&apos;t think it matters, both ConglomerateDescriptors (rows) have the same key information and so it actually doesn&apos;t matter which gets dropped. The only difference is the conglomerate name for the backing index which is never used. As far as I can see the ConstraintDescriptor only links to the ConglomerateDescriptor through the UUID (which is the same in the two rows in the 10.0 code before the fix to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-655&quot; title=&quot;getImportedKeys returns duplicate rows in some cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-655&quot;&gt;&lt;del&gt;DERBY-655&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;So I don&apos;t see any real need to write upgrade code that handles this situation. I will add some comments to the code to clarify it.&lt;/p&gt;</comment>
                            <comment id="12780642" author="knutanders" created="Fri, 20 Nov 2009 16:50:25 +0000"  >&lt;p&gt;From the comments, this sounds more like an improvement than a bug, so I&apos;m reclassifying the issue.&lt;/p&gt;

&lt;p&gt;However, I don&apos;t think it&apos;s very likely anymore that someone will pick up this issue, given that it only affects upgrade from 10.0 and 10.1. I propose that we close this issue as &quot;Won&apos;t Fix&quot;.&lt;/p&gt;</comment>
                            <comment id="12783690" author="knutanders" created="Mon, 30 Nov 2009 15:20:26 +0000"  >&lt;p&gt;Setting resolution to &quot;Won&apos;t Fix&quot;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12325084">DERBY-655</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12508599">DERBY-5249</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12653491">DERBY-6269</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 23 Jun 2006 00:31:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29955</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0g4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36430</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>