<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:20 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6396/DERBY-6396.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6396] NullPointerException in DirFile</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6396</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;We got a NullPointerException trying to start a Derby database in embedded mode; the stacktrace indicated it happened in org.apache.derby.impl.io.DirFile.deleteAll(); that method got called from org.apache.derby.impl.io.BaseStorageFactory.createTempDir().&lt;/p&gt;

&lt;p&gt;After investigating, it appears that the deleteAll() method calls &quot;super.list()&quot;, which according to the java.io.File specifications, can return null. But the deleteAll() method doesn&apos;t handle that case gracefully.&lt;/p&gt;</description>
                <environment>Windows 7</environment>
        <key id="12676253">DERBY-6396</key>
            <summary>NullPointerException in DirFile</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="fabian_depry@yahoo.com">Fabian Depry</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Oct 2013 00:42:40 +0000</created>
                <updated>Wed, 21 Jan 2015 00:23:43 +0000</updated>
                            <resolved>Mon, 4 Nov 2013 10:14:33 +0000</resolved>
                                    <version>10.10.1.1</version>
                                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Miscellaneous</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13807752" author="knutanders" created="Tue, 29 Oct 2013 07:53:06 +0000"  >&lt;p&gt;Do you happen know what kind of condition that made it return null? The javadoc says that File.list() returns null if it is not a directory or if an I/O error occurs. Since deleteAll() checks that the file exists and is a directory before it calls list(), it sounds like there must have been some kind of I/O error.&lt;/p&gt;</comment>
                            <comment id="13807761" author="knutanders" created="Tue, 29 Oct 2013 08:03:38 +0000"  >&lt;p&gt;I&apos;m able to reproduce this by doing &quot;chmod 000&quot; on the database&apos;s tmp directory before booting the database.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NullPointerException
        at org.apache.derby.impl.io.DirFile.deleteAll(Unknown Source)
        at org.apache.derby.impl.io.BaseStorageFactory.createTempDir(Unknown Source)
        at org.apache.derby.impl.io.DirStorageFactory.doInit(Unknown Source)
        at org.apache.derby.impl.io.BaseStorageFactory.init(Unknown Source)
        at org.apache.derby.impl.services.monitor.StorageFactoryService.privGetStorageFactoryInstance(Unknown Source)
        at org.apache.derby.impl.services.monitor.StorageFactoryService.access$400(Unknown Source)
        at org.apache.derby.impl.services.monitor.StorageFactoryService$3.run(Unknown Source)
        at java.security.AccessController.doPrivileged(Native Method)
        at org.apache.derby.impl.services.monitor.StorageFactoryService.getStorageFactoryInstance(Unknown Source)
        at org.apache.derby.impl.store.raw.data.BaseDataFileFactory.boot(Unknown Source)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13807811" author="knutanders" created="Tue, 29 Oct 2013 09:15:44 +0000"  >&lt;p&gt;The attached patch, check-null.diff, makes the database boot successfully in the case where it previously failed with a NullPointerException. Now, instead, if you perform an operation that requires a temporary file after the database has been successfully booted, you will see a message such as:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ij&amp;gt; declare global temporary table t(x int) not logged;
ERROR XSDF1: Exception during creation of file /tmp/d6396/db/tmp/T1383035594089.tmp for container
ERROR XJ001: Java exception: &apos;/tmp/d6396/db/tmp/T1383035594089.tmp (Permission denied): java.io.FileNotFoundException&apos;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll see if I can cook up a regression test case for it.&lt;/p&gt;

&lt;p&gt;All the existing regression tests passed with the patch.&lt;/p&gt;</comment>
                            <comment id="13807902" author="fabian_depry@yahoo.com" created="Tue, 29 Oct 2013 11:49:46 +0000"  >&lt;p&gt;This happened to one of our customers; we have not been able to reproduce the issue ourselves. But that customer mentioned that the tmp folder became unaccessible because of networking issues; so yes, it seems there was an I/O problem, which is one of the two conditions under which File.list() would return null.&lt;/p&gt;

&lt;p&gt;It all makes sense &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks for looking into this!&lt;/p&gt;</comment>
                            <comment id="13807910" author="knutanders" created="Tue, 29 Oct 2013 12:03:09 +0000"  >&lt;p&gt;Thanks, Fabian. It makes sense that this could happen if the directory lives on a network drive.&lt;/p&gt;

&lt;p&gt;I guess at some point we should rewrite most of this code to use the java.nio.file classes instead of java.io.File, as they will give better error reporting in these cases (an IOException with a proper error message, rather than a boolean return value with no information about what went wrong). But that&apos;s new functionality in Java 7, and Derby has to work on Java 6 too for now, so that will have to wait.&lt;/p&gt;</comment>
                            <comment id="13807913" author="knutanders" created="Tue, 29 Oct 2013 12:16:59 +0000"  >&lt;p&gt;Attaching an updated patch that includes a test case (check-null-with-test.diff). The test fails with a NullPointerException without the fix (at least on platforms where java.io.File.setReadable() has an effect) and passes with the fix. I&apos;ve verified that the test passes on Windows and Linux, with Java 6, 7 and 8. That should hopefully cover most platform differences.&lt;/p&gt;</comment>
                            <comment id="13810001" author="jira-bot" created="Thu, 31 Oct 2013 07:33:59 +0000"  >&lt;p&gt;Commit 1537394 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1537394&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1537394&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6396&quot; title=&quot;NullPointerException in DirFile&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6396&quot;&gt;&lt;del&gt;DERBY-6396&lt;/del&gt;&lt;/a&gt;: NullPointerException in DirFile&lt;/p&gt;

&lt;p&gt;Check that the array returned by File.list() is non-null before&lt;br/&gt;
attempting to iterate through it. Null is a valid return value.&lt;/p&gt;</comment>
                            <comment id="13812727" author="jira-bot" created="Mon, 4 Nov 2013 10:12:22 +0000"  >&lt;p&gt;Commit 1538541 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1538541&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1538541&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6396&quot; title=&quot;NullPointerException in DirFile&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6396&quot;&gt;&lt;del&gt;DERBY-6396&lt;/del&gt;&lt;/a&gt;: NullPointerException in DirFile&lt;/p&gt;

&lt;p&gt;Merged fix from trunk (revision 1537394).&lt;/p&gt;</comment>
                            <comment id="13812729" author="knutanders" created="Mon, 4 Nov 2013 10:14:33 +0000"  >&lt;p&gt;I backported the fix to the 10.10 branch. I did not backport the test, since it depends on the java.io.File.setReadable() method, which is not available on all platforms supported by 10.10.&lt;/p&gt;</comment>
                            <comment id="14284849" author="myrna" created="Wed, 21 Jan 2015 00:23:43 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12610799" name="check-null-with-test.diff" size="8199" author="knutanders" created="Tue, 29 Oct 2013 12:16:59 +0000"/>
                            <attachment id="12610788" name="check-null.diff" size="1616" author="knutanders" created="Tue, 29 Oct 2013 09:15:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10421"><![CDATA[Seen in production]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 29 Oct 2013 07:53:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>355750</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzj6a7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356038</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>