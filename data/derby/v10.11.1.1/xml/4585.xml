<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:42:43 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4585/DERBY-4585.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4585] IndexChanger.doDelete throws NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4585</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;After a bunch of DELETE and DROP-Commands, the following error occurs in our application:&lt;/p&gt;

&lt;p&gt;2010-03-16 12:54:23.070 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_4,5,derby.daemons&amp;#93;&lt;/span&gt; (XID = 15898), (SESSIONID = 1), (DATABASE = ixintrexx), (DRDAID = NF000001.PAA8-4469821361421447518&lt;/p&gt;
{2}), Cleanup action starting&lt;br/&gt;
2010-03-16 12:54:23.070 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_4,5,derby.daemons&amp;#93;&lt;/span&gt; (XID = 15898), (SESSIONID = 1), (DATABASE = ixintrexx), (DRDAID = NF000001.PAA8-4469821361421447518{2}
&lt;p&gt;), Failed Statement is: DELETE FROM LCAPPCHILDCONTROLTITLE WHERE STRCHILDCONTROLGUID IN (SELECT STRGUID FROM LCAPPCHILDCONTROL WHERE STRAPPCONTROLDRGUID IN (SELECT A.STRGUID FROM LCAPPCONTROLDR A, LCAPPFUP B WHERE A.STRAPPFUPGUID = B.STRGUID AND B.STRAPPGUID = &apos;93A720B90BB6C25703701E67D0DA75220B7D2FFC&apos;))&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.IndexChanger.doDelete(IndexChanger.java:369)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.IndexChanger.delete(IndexChanger.java:544)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.IndexSetChanger.delete(IndexSetChanger.java:250)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.RowChangerImpl.deleteRow(RowChangerImpl.java:476)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.DeleteResultSet.collectAffectedRows(DeleteResultSet.java:405)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.DeleteResultSet.open(DeleteResultSet.java:137)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:297)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(EmbedStatement.java:175)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLIMM(DRDAConnThread.java:5022)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:750)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:290)&lt;br/&gt;
Cleanup action completed&lt;/p&gt;

&lt;p&gt;The database seems to be corrupt, after this exception has been thrown.&lt;br/&gt;
As you can see, I already compiled Derby to get the line number where the error occurs. I must apologize for not having a sufficient test case yet, but the code leading to this issue is very complex. If one wants to reproduce this bug, I can send a download link for our product and instructions to reproduce the problem.&lt;/p&gt;
</description>
                <environment>Various operating systems, Java 1.6.0_18</environment>
        <key id="12459261">DERBY-4585</key>
            <summary>IndexChanger.doDelete throws NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="upkeller">Martin Keller</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Mar 2010 13:40:26 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:24 +0100</updated>
                            <resolved>Tue, 8 Feb 2011 00:27:04 +0000</resolved>
                                    <version>10.3.3.0</version>
                    <version>10.4.1.3</version>
                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                    <version>10.5.2.0</version>
                    <version>10.5.3.0</version>
                                    <fixVersion>10.5.3.2</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12845927" author="knutanders" created="Tue, 16 Mar 2010 15:13:40 +0000"  >&lt;p&gt;Hi Martin,&lt;/p&gt;

&lt;p&gt;Could you please also post the DDL statements used to create the tables involved in the query (including any tables with foreign key constraints referencing LCAPPCHILDCONTROLTITLE)?&lt;/p&gt;

&lt;p&gt;When you say that the database seems to be corrupt, which symptoms do you see? Do you also see those problems after rebooting the database?&lt;/p&gt;</comment>
                            <comment id="12849239" author="rhillegas" created="Wed, 24 Mar 2010 16:00:08 +0000"  >&lt;p&gt;Hi Martin,&lt;/p&gt;

&lt;p&gt;Thanks for logging this issue. Can you answer Knut&apos;s last question: Do you still see problems after rebooting the database? Thanks.&lt;/p&gt;</comment>
                            <comment id="12849272" author="upkeller" created="Wed, 24 Mar 2010 16:40:39 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Rebooting the database doesn&apos;t change anything.&lt;br/&gt;
Corrupt means, that the statement above worked for several times until the first exception and then never again.&lt;/p&gt;

&lt;p&gt;I&apos;ll attach the &quot;corrupt&quot; database to the issue.&lt;/p&gt;</comment>
                            <comment id="12850107" author="knutanders" created="Fri, 26 Mar 2010 12:19:38 +0000"  >&lt;p&gt;I also see the NullPointerException when I try to run the DELETE statement with head of trunk. I ran the database consistency checker (&lt;a href=&quot;http://wiki.apache.org/db-derby/DatabaseConsistencyCheck&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/DatabaseConsistencyCheck&lt;/a&gt;) but that didn&apos;t reveal any structural problems in the database.&lt;/p&gt;</comment>
                            <comment id="12850963" author="knutanders" created="Mon, 29 Mar 2010 17:22:36 +0100"  >&lt;p&gt;The attached zip file (repro.zip) contains scripts that reproduce the NullPointerException on a fresh database. While trimming the data set, the statistics changed and so did the execution plan, so I needed to add an optimizer override in order to force the optimizer to pick a plan that failed. To reproduce, unzip the attached file and run the following command in the directory where it was unzipped:&lt;/p&gt;

&lt;p&gt;$ java -jar /path/to/derbyrun.jar ij repro.sql&lt;br/&gt;
ij version 10.6&lt;br/&gt;
.&lt;br/&gt;
.&lt;br/&gt;
.&lt;br/&gt;
ij&amp;gt; delete from t4 where d in&lt;br/&gt;
  (select id from t2 --derby-properties constraint=fk_t2_t1&lt;br/&gt;
    where b in (select t1.id from t1, t3 where t1.a=t3.id and t3.c=&apos;93A720B90BB6C25703701E67D0DA75220B7D2FFC&apos;));&lt;br/&gt;
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;/p&gt;</comment>
                            <comment id="12850990" author="knutanders" created="Mon, 29 Mar 2010 17:34:29 +0100"  >&lt;p&gt;The NPE is reproducible on 10.3.3.0 and on all 10.4 and 10.5 releases. I don&apos;t see it on 10.3.2.1 or earlier releases, so I&apos;m flagging it as a regression. I&apos;ve removed the data corruption flag, since all the data appears to be intact in the database.&lt;/p&gt;</comment>
                            <comment id="12851009" author="knutanders" created="Mon, 29 Mar 2010 18:14:21 +0100"  >&lt;p&gt;The repro started failing when &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3301&quot; title=&quot;Incorrect result from query with nested EXIST&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3301&quot;&gt;&lt;del&gt;DERBY-3301&lt;/del&gt;&lt;/a&gt; was fixed.&lt;/p&gt;</comment>
                            <comment id="12851335" author="knutanders" created="Tue, 30 Mar 2010 10:52:59 +0100"  >&lt;p&gt;Attaching a new, simplified repro that consists of a single stand-alone SQL script.&lt;/p&gt;</comment>
                            <comment id="12851357" author="knutanders" created="Tue, 30 Mar 2010 12:13:02 +0100"  >&lt;p&gt;The problem seems to be related to the caching of updatable index scans in the activation (the NPE happens because the cached scan is null). The field that holds the cached scan is initialized by TableScanResultSet.openCore() if, and only if, the scan is updatable and uses an index. However, TableScanResultSet.close() unconditionally clears the information. So if a statement execution plan has one updatable index scan and one non-updatable scan, closing the non-updatable scan may clear information needed by the still open updatable scan.&lt;/p&gt;

&lt;p&gt;The attached patch ensures that TableScanResultSet.close() only clears index scan information from the activation if it had cached information there itself. This made the NPE go away. The patch does not include any tests, and I have not run any of the regression tests with it yet.&lt;/p&gt;

&lt;p&gt;(By the way, I don&apos;t think this problem was introduced with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3301&quot; title=&quot;Incorrect result from query with nested EXIST&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3301&quot;&gt;&lt;del&gt;DERBY-3301&lt;/del&gt;&lt;/a&gt;, but it probably made the optimizer pick a different plan (it changed how nested IN/EXISTS queries where flattened, I think) that made the problem surface. It may be possible to come up with a case that fails before &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3301&quot; title=&quot;Incorrect result from query with nested EXIST&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3301&quot;&gt;&lt;del&gt;DERBY-3301&lt;/del&gt;&lt;/a&gt; too.)&lt;/p&gt;</comment>
                            <comment id="12851474" author="knutanders" created="Tue, 30 Mar 2010 18:34:23 +0100"  >&lt;p&gt;Attaching a new patch which includes a regression test case. All the regression tests ran cleanly with this patch.&lt;/p&gt;</comment>
                            <comment id="12853839" author="knutanders" created="Tue, 6 Apr 2010 11:28:20 +0100"  >&lt;p&gt;Committed revision 931076.&lt;/p&gt;</comment>
                            <comment id="12885228" author="knutanders" created="Mon, 5 Jul 2010 14:11:15 +0100"  >&lt;p&gt;Looks like the fix-version field was updated instead of the affects-version field. Updating fix-version and affects-version to reflect the version on which the problem has been seen and when it was fixed.&lt;/p&gt;</comment>
                            <comment id="12990229" author="mikem" created="Thu, 3 Feb 2011 18:44:21 +0000"  >&lt;p&gt;backporting to 10.5, temp assigning to me.&lt;/p&gt;</comment>
                            <comment id="12991737" author="mikem" created="Tue, 8 Feb 2011 00:27:04 +0000"  >&lt;p&gt;backported fix to 10.5, resetting owner back to original and resolving.&lt;/p&gt;</comment>
                            <comment id="13685227" author="knutanders" created="Mon, 17 Jun 2013 10:19:24 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12385521">DERBY-3301</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12497378">DERBY-4994</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12440256" name="derby-4585-1a.diff" size="5424" author="knutanders" created="Tue, 30 Mar 2010 18:34:23 +0100"/>
                            <attachment id="12439672" name="derby-4585.tar.gz" size="1959171" author="upkeller" created="Wed, 24 Mar 2010 16:47:02 +0000"/>
                            <attachment id="12440213" name="fix.diff" size="965" author="knutanders" created="Tue, 30 Mar 2010 12:13:02 +0100"/>
                            <attachment id="12440195" name="repro.sql" size="1065" author="knutanders" created="Tue, 30 Mar 2010 10:52:59 +0100"/>
                            <attachment id="12440077" name="repro.zip" size="2967" author="knutanders" created="Mon, 29 Mar 2010 17:22:36 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 Mar 2010 15:13:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24353</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0j7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36929</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>