<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:44:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6610/DERBY-6610.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6610] suites.All cannot be run with classes without failures</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6610</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;suites.All no longer runs cleanly for me when I run with just classes.&lt;br/&gt;
It still runs fine with jars.&lt;br/&gt;
We accepted this behavior at some point, but it is frustrating when you want to &apos;quickly&apos; run tests while still working on some details.&lt;/p&gt;

&lt;p&gt;One of the tests that failed for me was lang.DatabaseClassLoadingTest (complaining about one of the databases not found), another was lang.LuceneSupportPermsTest.&lt;br/&gt;
If a test cannot run cleanly with classes, it should get skipped (preferably both in the test itself and from the _Suite in which it is included).&lt;br/&gt;
I also think some of the network server tests complain if derbynet.jar is not found - I cannot off-hand remember if this causes the test to fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12720644">DERBY-6610</key>
            <summary>suites.All cannot be run with classes without failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Jun 2014 18:42:10 +0100</created>
                <updated>Wed, 22 Oct 2014 20:17:49 +0100</updated>
                            <resolved>Thu, 16 Oct 2014 15:07:16 +0100</resolved>
                                    <version>10.11.1.1</version>
                                    <fixVersion>10.12.0.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14028958" author="knutanders" created="Thu, 12 Jun 2014 10:17:00 +0100"  >&lt;p&gt;I recently came across a problem to run NativeAuthenticationServiceTest against classes. The problem was that the following permission is granted to derby.jar, but not to the classes directory:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-comment&quot;&gt;// needed to create a temp file in order to open a database in a jar file
&lt;/span&gt;  permission java.io.FilePermission &lt;span class=&quot;code-quote&quot;&gt;&quot;${java.io.tmpdir}${/}-&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;read,write,delete&quot;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The attached patch, &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12650026/12650026_tmp-permission.diff&quot; title=&quot;tmp-permission.diff attached to DERBY-6610&quot;&gt;tmp-permission.diff&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;, grants the extra permission to the classes directory. That seems to make both NativeAuthenticationServiceTest and DatabaseClassLoadingTest run fine.&lt;/p&gt;</comment>
                            <comment id="14028960" author="jira-bot" created="Thu, 12 Jun 2014 10:17:50 +0100"  >&lt;p&gt;Commit 1602102 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1602102&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1602102&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6610&quot; title=&quot;suites.All cannot be run with classes without failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6610&quot;&gt;&lt;del&gt;DERBY-6610&lt;/del&gt;&lt;/a&gt;: suites.All cannot be run with classes without failures&lt;/p&gt;

&lt;p&gt;Grant the derbyTesting.codeclasses code base permission to access&lt;br/&gt;
temporary files to allow DatabaseClassLoadingTest and&lt;br/&gt;
NativeAuthenticationServiceTest to run with classes.&lt;/p&gt;</comment>
                            <comment id="14162889" author="myrna" created="Wed, 8 Oct 2014 02:06:55 +0100"  >&lt;p&gt;attaching a patch which makes returns an empty compatibility test if we&apos;re not loading the (JVMInfo and other) classes from jars. I&apos;ll commit this patch.&lt;/p&gt;

&lt;p&gt;Before this patch, we&apos;d get an exception like the following when running suites.All:&lt;br/&gt;
Failed to invoke class org.apache.derbyTesting.functionTests.tests.compatibility._Suite&lt;br/&gt;
java.lang.reflect.InvocationTargetException&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:492)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.suites.AllPackages.invokeSuite(AllPackages.java:176)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.suites.AllPackages.addSuiteByReflection(AllPackages.java:147)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.suites.AllPackages.suite(AllPackages.java:58)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.suites.All.suite(All.java:50)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:492)&lt;br/&gt;
        at junit.runner.BaseTestRunner.getTest(BaseTestRunner.java:126)&lt;br/&gt;
        at junit.textui.TestRunner.start(TestRunner.java:184)&lt;br/&gt;
        at junit.textui.TestRunner.main(TestRunner.java:143)&lt;br/&gt;
Caused by: java.lang.IllegalStateException: only running off jars is supported, currently running off directory C:[derbyhomedir]\trunk\classes&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.compatibility.VersionCombinationConfigurator.getJarDirectoryOf(VersionCombinationConfigurator.java:320)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.compatibility.VersionCombinationConfigurator.getRunningDistribution(VersionCombinationConfigurator.java:292)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.compatibility.VersionCombinationConfigurator.filterVersions(VersionCombinationConfigurator.java:267)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.compatibility.VersionCombinationConfigurator.addTests(VersionCombinationConfigurator.java:170)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.compatibility._Suite.addVersionCombinations(_Suite.java:79)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.compatibility._Suite.suite(_Suite.java:133)&lt;br/&gt;
        ... 15 more&lt;/p&gt;
</comment>
                            <comment id="14162890" author="jira-bot" created="Wed, 8 Oct 2014 02:08:02 +0100"  >&lt;p&gt;Commit 1630000 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myrna&quot; class=&quot;user-hover&quot; rel=&quot;myrna&quot;&gt;Myrna van Lunteren&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1630000&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1630000&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6610&quot; title=&quot;suites.All cannot be run with classes without failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6610&quot;&gt;&lt;del&gt;DERBY-6610&lt;/del&gt;&lt;/a&gt;; suites.All cannot be run with classes without failures&lt;br/&gt;
  returning an empty compatibility suite if the classes are not loaded from jar files.&lt;/p&gt;</comment>
                            <comment id="14168835" author="myrna" created="Mon, 13 Oct 2014 00:09:08 +0100"  >&lt;p&gt;attaching a patch which updates a number of tests&apos; policy files with the now required usederbyinternals permission in the codeclasses area.&lt;/p&gt;

&lt;p&gt;Note that store.Derby3980DeadlockTest probably also need this permission, but I added the permission all over that tests&apos; policy file and I still got an error.&lt;br/&gt;
So that one I will look at a bit further, and update later.&lt;/p&gt;

&lt;p&gt;Also, with the modification to the lucene policy file that test no longer fails because of the missing permission, but it does still fail, so that I need to look into also.&lt;/p&gt;

&lt;p&gt;Further, I initially tried to add the policy to the SysinfoTest.policy and run it with a pre-build of the ibm 1.8 jvm and the test still failed. Even when I had granted AllPermissions in the policy file the test failed with that jvm. So I will try to figure out what&apos;s wrong with that picture too. But the test passed with ibm 1.7 and classes after the change.&lt;br/&gt;
I&apos;ll commit this first patch shortly.&lt;/p&gt;</comment>
                            <comment id="14168836" author="jira-bot" created="Mon, 13 Oct 2014 00:10:20 +0100"  >&lt;p&gt;Commit 1631263 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myrna&quot; class=&quot;user-hover&quot; rel=&quot;myrna&quot;&gt;Myrna van Lunteren&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1631263&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1631263&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6610&quot; title=&quot;suites.All cannot be run with classes without failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6610&quot;&gt;&lt;del&gt;DERBY-6610&lt;/del&gt;&lt;/a&gt;; suites.All cannot be run with classes without failures&lt;br/&gt;
   adding usederbyinternals permission to the codeclasses area for a number of test policy files.&lt;/p&gt;</comment>
                            <comment id="14169739" author="myrna" created="Mon, 13 Oct 2014 19:46:23 +0100"  >&lt;p&gt;Re Derby3980DeadlockTest: the test failed because of a missing &quot;read&quot; permission as well as the missing usederbyinternals permission. Also there was a typo in one permssion granted.&lt;br/&gt;
Note further that this test is not part of suites.All, according to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3980&quot; title=&quot;Conflicting select then update with REPEATABLE_READ gives lock timeout instead of deadlock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3980&quot;&gt;&lt;del&gt;DERBY-3980&lt;/del&gt;&lt;/a&gt; it was considered not stable so has not been added to any suite. Furthermore, it was replaced by DeadlockDetectionTest, so one way to deal with this is to just remove the test and its policy file.&lt;br/&gt;
However, for now, I&apos;ll just patch up the Derby3980DeadlockTest.policy.&lt;/p&gt;</comment>
                            <comment id="14169742" author="jira-bot" created="Mon, 13 Oct 2014 19:47:32 +0100"  >&lt;p&gt;Commit 1631509 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myrna&quot; class=&quot;user-hover&quot; rel=&quot;myrna&quot;&gt;Myrna van Lunteren&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1631509&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1631509&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6610&quot; title=&quot;suites.All cannot be run with classes without failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6610&quot;&gt;&lt;del&gt;DERBY-6610&lt;/del&gt;&lt;/a&gt;; suites.All cannot be run with classes without failures&lt;br/&gt;
   fix up policy file for Derby3980DeadlockTest&lt;/p&gt;</comment>
                            <comment id="14173112" author="myrna" created="Wed, 15 Oct 2014 23:59:37 +0100"  >&lt;p&gt;In an earlier comment I maligned a ibm 1.8 pre-build. I was suffering from classpath confusion; for the ibm 1.8 test run I had the CLASSPATH pointing to a build that did not have my changes.&lt;/p&gt;</comment>
                            <comment id="14173148" author="myrna" created="Thu, 16 Oct 2014 00:38:18 +0100"  >&lt;p&gt;The next failure is:&lt;br/&gt;
test_001_basicNoGrant(org.apache.derbyTesting.functionTests.tests.lang.LuceneSupportPermsTest)java.sql.SQLException: The exception &apos;java.security.AccessControlException: Access denied (&quot;java.lang.RuntimePermission&quot; &quot;accessDeclaredMembers&quot;)&apos; was thrown while evaluating an expression.&lt;br/&gt;
Followed by more of the same and errors because an expected view does not exist.&lt;br/&gt;
I can see the same errors when I run LuceneSuite.&lt;br/&gt;
When I add the DeclaredMembers permission to the codeclassessection in luceneSupport.policy, LuceneSuite runs successfully with classes..&lt;br/&gt;
I will attach and commit a patch for this issue.&lt;/p&gt;

&lt;p&gt;(Note that apparently one cannot run the LuceneSupportPermsTest by itself, I got the following error:&lt;br/&gt;
test_001_basicNoGrant(org.apache.derbyTesting.functionTests.tests.lang.LuceneSupportPermsTest)java.sql.SQLException: The exception &apos;java.lang.ExceptionInInitializerError&apos; was thrown while evaluating an expression....&lt;br/&gt;
caused by: &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
caused by: &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException: A SPI class of type org.apache.lucene.codecs.Codec with name &apos;Lucene46&apos; does not exist. You need to add the corresponding JAR file supporting this SPI to your classpath.The current classpath supports the following names: []&lt;br/&gt;
        at org.apache.lucene.util.NamedSPILoader.lookup(NamedSPILoader.java:109)&lt;br/&gt;
        at org.apache.lucene.codecs.Codec.forName(Codec.java:95)&lt;br/&gt;
        at org.apache.lucene.codecs.Codec.&amp;lt;clinit&amp;gt;(Codec.java:122)&lt;br/&gt;
        at java.lang.J9VMInternals.initializeImpl(Native Method)&lt;br/&gt;
        at java.lang.J9VMInternals.initialize(J9VMInternals.java:237)&lt;br/&gt;
        ... 80 more&lt;br/&gt;
The lucene jars from the source tree are in my classpath)&lt;/p&gt;</comment>
                            <comment id="14173149" author="myrna" created="Thu, 16 Oct 2014 00:39:37 +0100"  >&lt;p&gt;adding required permission to the luceneSupport.policy file.&lt;/p&gt;</comment>
                            <comment id="14173151" author="jira-bot" created="Thu, 16 Oct 2014 00:41:00 +0100"  >&lt;p&gt;Commit 1632198 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myrna&quot; class=&quot;user-hover&quot; rel=&quot;myrna&quot;&gt;Myrna van Lunteren&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1632198&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1632198&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6610&quot; title=&quot;suites.All cannot be run with classes without failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6610&quot;&gt;&lt;del&gt;DERBY-6610&lt;/del&gt;&lt;/a&gt;; suites.All cannot be run with classes without failures&lt;br/&gt;
   grant DeclaredMember permission to the codeclasses area in policy file for lucene tests.&lt;/p&gt;</comment>
                            <comment id="14173781" author="myrna" created="Thu, 16 Oct 2014 15:07:16 +0100"  >&lt;p&gt;After the last change (revision 1632198), a full trunk suites.All shows:  run using junit.textui.TestRunner passed for me with 16355 tests. &lt;br/&gt;
If there are new failures, a new issue should be opened for the failures happening at that time.&lt;br/&gt;
Resolving.&lt;/p&gt;</comment>
                            <comment id="14180357" author="myrna" created="Wed, 22 Oct 2014 20:17:49 +0100"  >&lt;p&gt;close all resolved issues with myself as reporter and assignee.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12673495" name="DERBY-6610_1.diff" size="1085" author="myrna" created="Wed, 8 Oct 2014 02:06:55 +0100"/>
                            <attachment id="12674435" name="DERBY-6610_pols1.diff" size="6648" author="myrna" created="Mon, 13 Oct 2014 00:09:08 +0100"/>
                            <attachment id="12675151" name="DERBY-6610_pols3.diff" size="675" author="myrna" created="Thu, 16 Oct 2014 00:39:37 +0100"/>
                            <attachment id="12650026" name="tmp-permission.diff" size="1407" author="knutanders" created="Thu, 12 Jun 2014 10:17:00 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 12 Jun 2014 09:17:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>398843</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzqir3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>398965</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>