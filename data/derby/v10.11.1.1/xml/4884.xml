<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:20:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4884/DERBY-4884.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4884] DatabasePropertyTestSetup cannot change static properties in encrypted databases</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4884</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;DatabasePropertyTestSetup needs to reboot the database in order to set static properties. In tests with encrypted databases, the database cannot be rebooted because the boot password is only known inside the setUp() method of the decorator created by Decorator.encryptedDatabase().&lt;/p&gt;

&lt;p&gt;One of the problems that results from this, is that BlobClob4Blob test cannot reduce the lock timeout for the encrypted variant of the test. Since there are four test cases that wait for a lock timeout, the test takes almost four minutes longer than it would have if the lock timeout had been reduced.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12479079">DERBY-4884</key>
            <summary>DatabasePropertyTestSetup cannot change static properties in encrypted databases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Nov 2010 11:15:07 +0000</created>
                <updated>Mon, 29 Nov 2010 14:21:30 +0000</updated>
                            <resolved>Tue, 9 Nov 2010 10:18:30 +0000</resolved>
                                    <version>10.7.1.1</version>
                                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12928562" author="knutanders" created="Fri, 5 Nov 2010 11:09:20 +0000"  >&lt;p&gt;I&apos;ve found two more tests, in addition to BlobClob4BlobTest, that have this problem:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;StressMultiTest: This test works around the problem by using a SystemPropertyTestSetup for static database properties instead of using DatabasePropertyTestSetup. See comment in its suite() method.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DeadlockModeTest: Same problem as BlobClob4BlobTest. It wraps a DatabasePropertyTestSetup on top of the encryption decorator. But since the encryption decorator creates a single-use database, the DBPTS will work on the wrong database (it works on the default db since it&apos;s not inside the encryption decorator). Moving the encryption decorator outside the the DBPTS will make the rebooting of the fail because the boot password isn&apos;t available outside the encryption decorator&apos;s setUp() method. Unlike the problem in BlobClob4BlobTest, this doesn&apos;t usually make the test take unnecessarily long time, since the test isn&apos;t expected to experience timeouts or deadlocks.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m working on a patch that makes the encryption decorator better integrated with the test framework. In short, I&apos;m planning to add support for extra connection attributes in TestConfiguration, so that the necessary attributes will also be available when opening a connection outside of the decorator&apos;s setUp() method.&lt;/p&gt;</comment>
                            <comment id="12928568" author="knutanders" created="Fri, 5 Nov 2010 12:01:35 +0000"  >&lt;p&gt;Here&apos;s a patch (1a) that makes the necessary changes to the encryption decorator (Decorator.encryptedDatabase()) to support rebooting using the normal helper methods (e.g., TestConfiguration.shutdownDatabase()). It doesn&apos;t touch any of the tests that use the decorator, and there are more changes needed to make them set static properties correctly using DatabasePropertyTestSetup.&lt;/p&gt;

&lt;p&gt;Changes made by this patch:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TestConfiguration: Add support for extra connection attributes in the configuration.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DriverManagerConnector: Pick up connection attributes from the TestConfiguration.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;JDBCDataSource: Pick up connection attributes from the TestConfiguration. This will make all DataSource-based connectors use the connection attributes.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Decorator: Use a ChangeConfigurationSetup that adds connection attributes to the current configuration when decorating encryption tests (and, because of code sharing, also collation tests). Stop creating the database in the decorator&apos;s setUp(), since the other changes makes the framework create the database automatically on the first connection attempt, just like other tests/decorators.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DatabaseMetaDataTest: Work-around for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4886&quot; title=&quot;Client and embedded don&amp;#39;t agree on connection attributes in DatabaseMetaData.getURL()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4886&quot;&gt;DERBY-4886&lt;/a&gt;. Since the framework changes makes openDefaultConnection() use the extra connection attributes, and DatabaseMetaDataTest is invoked by CollationTest with extra attributes, the test of getURL() in DatabaseMetaDataTest will see a different URL in client mode.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Regression tests ran cleanly with the patch.&lt;/p&gt;</comment>
                            <comment id="12929498" author="knutanders" created="Mon, 8 Nov 2010 08:23:25 +0000"  >&lt;p&gt;Committed revision 1032485.&lt;/p&gt;</comment>
                            <comment id="12929536" author="knutanders" created="Mon, 8 Nov 2010 10:23:11 +0000"  >&lt;p&gt;Here&apos;s a second patch that makes BlobClob4BlobTest and DeadlockModeTest use the reduced timeouts when running against encrypted databases. The patch changes the order of the decorators so that the DatabasePropertyTestSetup executes inside the encryption decorator, and this ensures that it works on the encrypted database instead of on the default database.&lt;/p&gt;

&lt;p&gt;DeadlockModeTest had one more problem that needed to be fixed. The encrypted variant always worked on the default (non-encrypted) database, not only when setting the timeouts, but also when doing database operations in the test case. The reason for this was that all the database connections were opened in helper threads, and the decorators only change the test configuration for the current thread (in a thread local field in TestConfiguration), so the connections would always be opened against the default database. I therefore made the test open all the connections in the main JUnit thread and pass the Connection objects as arguments to the helper threads when creating them.&lt;/p&gt;

&lt;p&gt;With this patch, the time to run BlobClob4BlobTest was reduced from 5 min 25 sec to 1 min 40 sec in my environment. (No change in run time for DeadlockModeTest since it doesn&apos;t usually see lock timeouts.)&lt;/p&gt;</comment>
                            <comment id="12930071" author="knutanders" created="Tue, 9 Nov 2010 10:18:29 +0000"  >&lt;p&gt;Committed revision 1032907.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12479618">DERBY-4898</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12458899" name="derby-4884-1a.diff" size="16858" author="knutanders" created="Fri, 5 Nov 2010 12:01:34 +0000"/>
                            <attachment id="12459053" name="derby-4884-2a.diff" size="5336" author="knutanders" created="Mon, 8 Nov 2010 10:23:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24507</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0otr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37840</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>