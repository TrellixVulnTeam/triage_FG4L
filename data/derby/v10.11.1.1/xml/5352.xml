<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:32:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5352/DERBY-5352.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5352] Derby table functions stored in a jar file inside the database which implement VTICosting or RestrictedVTI fail with ClassNotFoundException</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5352</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Derby table functions stored in a jar file inside the database which implement VTICosting or RestrictedVTI fail with ClassNotFoundException.  This occurs when you attempt to query the table function.   If you put the JAR on the classpath instead, then the table function can be accessed correctly.&lt;/p&gt;

&lt;p&gt;I believe the problem is in JarLoader.java which has:&lt;/p&gt;


&lt;p&gt;        // Classes in installed jars cannot reference&lt;br/&gt;
        // Derby internal code. This is to avoid&lt;br/&gt;
        // code in installed jars bypassing SQL&lt;br/&gt;
        // authorization by calling Derby&apos;s internal methods.&lt;br/&gt;
        //&lt;br/&gt;
        // Any classes in the org.apache.derby.jdbc package&lt;br/&gt;
        // are allowed as it allows routines to make JDBC&lt;br/&gt;
        // connections to other databases. This does expose&lt;br/&gt;
        // public classes in that package that are not part&lt;br/&gt;
        // of the public api to attacks. One could attempt&lt;br/&gt;
        // further limiting allowed classes to those starting&lt;br/&gt;
        // with Embedded (and Client) but when fetching the&lt;br/&gt;
        // default connection in a routine (jdbc:default:connection)&lt;br/&gt;
        // the DriverManager attempts a load of the already loaded&lt;br/&gt;
        // AutoloadDriver, I think to establish the calling class&lt;br/&gt;
        // has access to the driver.&lt;br/&gt;
        //&lt;br/&gt;
        // This check in addition to the one in UpdateLoader&lt;br/&gt;
        // that prevents restricted classes from being loaded&lt;br/&gt;
        // from installed jars. The checks should be seen as&lt;br/&gt;
        // independent, ie. the restricted load check should&lt;br/&gt;
        // not make assumptions about this check reducing the&lt;br/&gt;
        // number of classes it has to check for.&lt;br/&gt;
        if (className.startsWith(&quot;org.apache.derby.&quot;)&lt;br/&gt;
                &amp;amp;&amp;amp; !className.startsWith(&quot;org.apache.derby.jdbc.&quot;))&lt;/p&gt;
        {
            ClassNotFoundException cnfe = new ClassNotFoundException(className);
            //cnfe.printStackTrace(System.out);
            throw cnfe;
        }&lt;br/&gt;
&lt;br/&gt;
Which explicitly restricts access to the org.apache.derby package except for org.apache.derby.jdbc.   I have debugged this and if change this to:&lt;br/&gt;
&lt;br/&gt;
        // Classes in installed jars cannot reference&lt;br/&gt;
        // Derby internal code. This is to avoid&lt;br/&gt;
        // code in installed jars bypassing SQL&lt;br/&gt;
        // authorization by calling Derby&apos;s internal methods.&lt;br/&gt;
      if (className.startsWith(&quot;org.apache.derby.&quot;)&lt;br/&gt;
                &amp;amp;&amp;amp; !className.startsWith(&quot;org.apache.derby.jdbc.&quot;)&lt;br/&gt;
                &amp;amp;&amp;amp; !className.startsWith(&quot;org.apache.derby.vti.&quot;))&lt;br/&gt;
        {
            ClassNotFoundException cnfe = new ClassNotFoundException(className);
            //cnfe.printStackTrace(System.out);
            throw cnfe;
        }

&lt;p&gt;The access is allowed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12515406">DERBY-5352</key>
            <summary>Derby table functions stored in a jar file inside the database which implement VTICosting or RestrictedVTI fail with ClassNotFoundException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bbergquist">Brett Bergquist</assignee>
                                    <reporter username="bbergquist">Brett Bergquist</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Jul 2011 15:56:49 +0100</created>
                <updated>Mon, 17 Jun 2013 10:19:49 +0100</updated>
                            <resolved>Thu, 4 Aug 2011 19:57:04 +0100</resolved>
                                    <version>10.8.1.2</version>
                                    <fixVersion>10.8.2.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13076157" author="rhillegas" created="Tue, 2 Aug 2011 13:19:16 +0100"  >&lt;p&gt;Your solution looks good to me, Brett. Along with a regression test, it will probably fix the problem. I am closing &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5366&quot; title=&quot;ClassNotFoundException when invoking a table function stored in a jar file in the database which extends or implements one of the classes/interfaces in org.apache.derby.vti &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5366&quot;&gt;&lt;del&gt;DERBY-5366&lt;/del&gt;&lt;/a&gt;, which duplicates this bug. Thanks. &lt;/p&gt;</comment>
                            <comment id="13076231" author="bbergquist" created="Tue, 2 Aug 2011 15:41:56 +0100"  >&lt;p&gt;Patch against JarLoader.java to explicitly add in access to &quot;org.apache.derby.vti.&quot; access.&lt;/p&gt;</comment>
                            <comment id="13076297" author="rhillegas" created="Tue, 2 Aug 2011 17:30:02 +0100"  >&lt;p&gt;Thanks for the patch, Brett. It looks good to me. Attaching derby-5352-01-ab-fixWithRegressionTest.diff. This adds a regression test to verify that the fix works. The test fails without your change and succeeds with your change.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;


&lt;p&gt;-----------&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/services/reflect/JarLoader.java&lt;/p&gt;

&lt;p&gt;Brett&apos;s fix.&lt;/p&gt;

&lt;p&gt;-----------&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/dummy_vti.jar&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/DatabaseClassLoadingTest.java&lt;/p&gt;

&lt;p&gt;Adds a restricted table function to dummy_vti.jar and verifies that it loads and runs.&lt;/p&gt;</comment>
                            <comment id="13076298" author="rhillegas" created="Tue, 2 Aug 2011 17:31:02 +0100"  >&lt;p&gt;Running full regression tests now.&lt;/p&gt;</comment>
                            <comment id="13078336" author="rhillegas" created="Tue, 2 Aug 2011 19:18:01 +0100"  >&lt;p&gt;Hi Brett,&lt;/p&gt;

&lt;p&gt;Have you signed the Apache Contributor License Agreement? I don&apos;t see your name on the list of contributors who have signed a CLA: &lt;a href=&quot;http://people.apache.org/committer-index.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/committer-index.html&lt;/a&gt; . The community will want you to submit one before we can commit your work. If your current employment agreement assigns your inventions to your employer, your company may need to sign a corporate CLA as well. See: &lt;a href=&quot;http://www.apache.org/licenses/#clas&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.apache.org/licenses/#clas&lt;/a&gt; . Thanks.&lt;/p&gt;</comment>
                            <comment id="13078350" author="rhillegas" created="Tue, 2 Aug 2011 19:35:01 +0100"  >&lt;p&gt;All regression tests passed cleanly for me. This patch is ready for commit once we clear up the CLA issue. Thanks.&lt;/p&gt;</comment>
                            <comment id="13078734" author="rhillegas" created="Wed, 3 Aug 2011 14:17:35 +0100"  >&lt;p&gt;I see Brett&apos;s CLA on file. Committed derby-5352-01-ab-fixWithRegressionTest.diff at subversion revision 1153474.&lt;/p&gt;</comment>
                            <comment id="13078739" author="rhillegas" created="Wed, 3 Aug 2011 14:28:06 +0100"  >&lt;p&gt;Ported 1153474 from the trunk to the 10.8 branch at subversion revision 1153478.&lt;/p&gt;</comment>
                            <comment id="13079529" author="rhillegas" created="Thu, 4 Aug 2011 19:57:04 +0100"  >&lt;p&gt;Resolving this issue since I believe no further work is needed.&lt;/p&gt;</comment>
                            <comment id="13685368" author="knutanders" created="Mon, 17 Jun 2013 10:19:49 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12515956">DERBY-5366</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12488917" name="derby-5352-01-ab-fixWithRegressionTest.diff" size="4061" author="rhillegas" created="Tue, 2 Aug 2011 17:30:02 +0100"/>
                            <attachment id="12488901" name="derby-5352.diff" size="856" author="bbergquist" created="Tue, 2 Aug 2011 15:41:56 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 2 Aug 2011 12:19:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24792</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0e3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36102</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>