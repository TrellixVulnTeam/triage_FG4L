<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:17 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2557/DERBY-2557.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2557] Provide a new interface on DataValueFactory(DVF) called getNull(formatId, collationType) which returns a DVD with proper collation association. </title>
                <link>https://issues.apache.org/jira/browse/DERBY-2557</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Provide a new interface, called getInstanceUsingFormatIdAndCollationType(formatId, collationType) on DVF. Store will call this interface to create empty DVD objects and then load these DVD objects using readExternal. For performance efficiency, when Store needs more of the same base DVD, then on subsequent needs, it will call DVD.getNewNull rather than calling DVF.getInstanceUsingFormatIdAndCollationType again. This work is required for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2537&quot; title=&quot;implement pushing collation info to store, storing collation info in store metadata, and creating templates based on store metadata&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2537&quot;&gt;&lt;del&gt;DERBY-2537&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12367399">DERBY-2557</key>
            <summary>Provide a new interface on DataValueFactory(DVF) called getNull(formatId, collationType) which returns a DVD with proper collation association. </summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="mamtas">Mamta A. Satoor</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Apr 2007 18:51:01 +0100</created>
                <updated>Thu, 2 May 2013 03:29:07 +0100</updated>
                            <resolved>Mon, 14 May 2007 18:39:10 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12489497" author="mamtas" created="Tue, 17 Apr 2007 19:27:37 +0100"  >&lt;p&gt;Committed the patch DERBY2557_getObject_Using_CollationType_FormatID_interface_on_DVF_v1_diff.txt using revision 529697.&lt;/p&gt;

&lt;p&gt;This change provides a new interface on DataValueFactory(DVF) which will be used by Store. Store has format ids and collation types and needs to have Objects created based on that information. This object creation will be supported by the new interface on DVF and it is called getInstanceUsingFormatIdAndCollationType.&lt;br/&gt;
DVF will keep an array of InstanceGetters for all the format ids supported by Derby. Initially, this array won&apos;t have anything. Every time this new interface is called on a new format id, the InstnaceGetter obtained will be saved in that array so next time around, we don&apos;t need to create a new InstanceGetter for the same format id. The next time around, the new interface will find the InstanceGetter in the array and will use that to create an object based on format id. If the collation type passed to the interface is UCS_BASIC, then the new interface will simply return that object. If the collation type is territory based and the object returned for the format id is of type StringDataValue, then the new interface will create a new DVD which is based on the territory based collation by calling DVD.getValue(TerritoryBasedCollator).&lt;/p&gt;</comment>
                            <comment id="12489535" author="djd" created="Tue, 17 Apr 2007 21:32:20 +0100"  >&lt;p&gt;I assume this new method is only for returning DVD&apos;s, is that correct?&lt;br/&gt;
If so could it be declared to return DataValueDescriptor, since it&apos;s a method on DataValueFactory.&lt;/p&gt;</comment>
                            <comment id="12489574" author="army" created="Wed, 18 Apr 2007 00:08:35 +0100"  >&lt;p&gt;The following code appears twice in the patch:&lt;/p&gt;

&lt;p&gt;+    //If we are dealing with territory based collation and &lt;br/&gt;
+    //the object is of type StringDataValue, then we need to &lt;br/&gt;
+    //create a StringDataValue with territory based collation.&lt;br/&gt;
+    if (returnObject instanceof StringDataValue) &lt;br/&gt;
+        ((StringDataValue)returnObject).getValue(getCharacterCollator(collationType));&lt;br/&gt;
+    return returnObject;&lt;/p&gt;

&lt;p&gt;The call to &quot;getValue(...)&quot; on returnObject creates a new StringDataValue with territory-based collation.  But then the code appears to ignore the result of &quot;getValue(...)&quot; and simply returns returnObject, which (I think?) has default collation.  Is that intentional? The comments do not explicitly say that we&apos;re supposed to &lt;b&gt;return&lt;/b&gt; the new StringDataValue, just that we&apos;re supposed to &lt;b&gt;create&lt;/b&gt; one--so I guess the code matches the comments.  But that seems a tad odd to me...&lt;/p&gt;

&lt;p&gt;I took a look at SQLChar.getValue(RuleBasedCollator) and there do not appear to be any side effects of that method on the SQLChar, so I don&apos;t understand what we get from calling &quot;getValue(...)&quot; in the above code?  If we are not going to store the result or return it, then why do we need to call getValue(...) in the first place? (sorry if I&apos;m missing something obvious).&lt;/p&gt;</comment>
                            <comment id="12489605" author="mamtas" created="Wed, 18 Apr 2007 05:41:36 +0100"  >&lt;p&gt;Army, thanks for the code review.&lt;/p&gt;

&lt;p&gt;You are ofcourse right about &quot;But that seems a tad odd to me... &quot;. I meant to return the new StringDataValue obtained through &quot;getValue(...)&quot;. I will fix that very soon. Thanks for catching it.&lt;/p&gt;

&lt;p&gt;As for SQLChar.getValue(RuleBasedCollator), if the passed RuleBasedCollator is null then that means that we have the right StringDataValue object ie we want to keep using this DVD which has UCS_BASIC collation associated with it. But if SQLChar.getValue(RuleBasedCollator) gets called with non-null RuleBasedCollator, then we want to return CollatorSQLChar because CollatorSQLChar uses the passed RuleBasedCollator for collation rather than using UCS_BASIC. Please let me know if the comments on StringDataValue#getValue(RuleBasedCollator) are any help in understanding this or you think more comments should go somewhere.&lt;/p&gt;</comment>
                            <comment id="12489607" author="mamtas" created="Wed, 18 Apr 2007 06:16:46 +0100"  >&lt;p&gt;The previous patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2557&quot; title=&quot;Provide a new interface on DataValueFactory(DVF) called getNull(formatId, collationType) which returns a DVD with proper collation association. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2557&quot;&gt;&lt;del&gt;DERBY-2557&lt;/del&gt;&lt;/a&gt; (DERBY2557_getObject_Using_CollationType_FormatID_interface_on_DVF_v1_diff.txt)  (committed using revision 529697) had a bug in it. After getting a collation sensitive DVD, the new method on DVF (getInstanceUsingFormatIdAndCollationType) was still returning the DVD with UCS_BASIC collation. Patch(DERBY2535_Return_Collator_api_On_DVD_v1_diff.txt) (committed using revision 529866) fixes that problem. &lt;/p&gt;</comment>
                            <comment id="12489608" author="mamtas" created="Wed, 18 Apr 2007 06:24:21 +0100"  >&lt;p&gt;Dan had following comment earlier&lt;br/&gt;
&quot;I assume this new method is only for returning DVD&apos;s, is that correct? If so could it be declared to return DataValueDescriptor, since it&apos;s a method on DataValueFactory. &quot;&lt;/p&gt;

&lt;p&gt;I am not sure what is the right thing to do here. The new method on DVF at this point is capable of returning more than just a DVD(that is why the return type is Object) depending on the passed format id. Although Store code is always going to call this method for format ids associated with DVDs, there is no check done in the new method to make sure that if a format id passed does not correspond to DVD, then it should throw an error. The other goal for this method on DVF was to remove the similar code from BaseMonitor(newInstanceFromIdentifier) which handles all different kinds of format ids. If we decide to make the new method on DVF to only deal with DVDs, then we will need to have code to handle other format ids either in BaseMonitor or somewhere else. I will like community&apos;s feedback on this.&lt;/p&gt;</comment>
                            <comment id="12489749" author="djd" created="Wed, 18 Apr 2007 15:17:04 +0100"  >&lt;p&gt;DataValueFactory&apos;s role is as a factory for returning DataValueDescriptors not as a general format identifier to object factory, that&apos;s the Monitor&apos;s role so I think the interface should be limited to DVDs.&lt;/p&gt;

&lt;p&gt;However I didn&apos;t understand the comment able needing to have code to handle other formats in BaseMonitor. That code already exists and the patch doesn&apos;t remove any of that code.&lt;/p&gt;

&lt;p&gt;The advantage of only handling DVDs could be a much much simpler &amp;amp; clearer implementation of the new method on DataValueFactory, basically just  moving existing code. (Roughly move the switch statement from the instance getter implementation into a static method in DataValueFactoryImpl, use that method in the new api method and have the instance getter call the static method).&lt;/p&gt;</comment>
                            <comment id="12490085" author="mamtas" created="Thu, 19 Apr 2007 15:59:02 +0100"  >&lt;p&gt;Based on feedback from Dan, changing the implementation of the new interface DVF.getNull so that it bypasses the InstanceGetter. This implementation is much simpler than the old one because there is no InstanceGetter involved. The patch is attached as DERBY2557_getObject_Using_CollationType_FormatID_interface_on_DVF_v2_diff.txt I am running the tests and will commit the patch after successful runs of the tests.&lt;/p&gt;

&lt;p&gt;The changes made in the patch are as follows&lt;br/&gt;
1)DataValueFactory&lt;br/&gt;
Changed the name of the new interface from getInstanceUsingFormatIdAndCollationType to getNull. This interface now returns a DVD rather than an Object. The functionality of the interface remains the same but the implementation has changed.&lt;br/&gt;
2)DataValueFactoryImpl&lt;br/&gt;
a)Removed the class level array and the code associated with InstanceGetter.&lt;br/&gt;
b)Added a new static method called getNullDVDWithUCS_BASICcollation(int formatId). This static method handles all the format ids associated with DVDs with the exception of Decimals. The class to be returned for Decimals depends on what VM is being used. This dependency on the VM is handled by getNullDecimal defined on DVF. But since getNullDecimal is not a static method, it can&apos;t be called by static method getNullDVDWithUCS_BASICcollation. I could go the path of defining getNullDecimal as static but that will require changes in NumericTypeCompiler.nullMethodName method. Also, all the other getNullXXX on DVF are non-static So, the code for returning the right DVD for Decimal is not in getNullDVDWithUCS_BASICcollation. Rather it is in the calling method, getNull. For other format ids associated with DVDs, getNull will check if the DVD is of type StringDataValue and the collation type is territory based and if so, then it will return ((StringDataValue)returnDVD).getValue(getCharacterCollator(collationType));&lt;br/&gt;
3)DTSClassInfo&lt;br/&gt;
This class now calls the static method in DVF to get the DVDs. But if the format id is not for a DVD, then it checks if it needs to return TypeId.&lt;/p&gt;

&lt;p&gt;I will go ahead and commit it after the tests run successfully. Does anyone have any comments on the patch? &lt;/p&gt;</comment>
                            <comment id="12490177" author="mamtas" created="Thu, 19 Apr 2007 22:12:11 +0100"  >&lt;p&gt;Commited the patch DERBY2557_getObject_Using_CollationType_FormatID_interface_on_DVF_v2_diff.txt using revision 530546&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12366919">DERBY-2537</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12355727" name="DERBY2535_Return_Collator_api_On_DVD_v1_diff.txt" size="3893" author="mamtas" created="Wed, 18 Apr 2007 06:16:46 +0100"/>
                            <attachment id="12355728" name="DERBY2535_Return_Collator_api_On_DVD_v1_stat.txt" size="212" author="mamtas" created="Wed, 18 Apr 2007 06:16:46 +0100"/>
                            <attachment id="12355706" name="DERBY2557_getObject_Using_CollationType_FormatID_interface_on_DVF_v1_diff.txt" size="7947" author="mamtas" created="Tue, 17 Apr 2007 19:27:37 +0100"/>
                            <attachment id="12355707" name="DERBY2557_getObject_Using_CollationType_FormatID_interface_on_DVF_v1_stat.txt" size="212" author="mamtas" created="Tue, 17 Apr 2007 19:27:37 +0100"/>
                            <attachment id="12355840" name="DERBY2557_getObject_Using_CollationType_FormatID_interface_on_DVF_v2_diff.txt" size="13796" author="mamtas" created="Thu, 19 Apr 2007 15:59:02 +0100"/>
                            <attachment id="12355841" name="DERBY2557_getObject_Using_CollationType_FormatID_interface_on_DVF_v2_stat.txt" size="278" author="mamtas" created="Thu, 19 Apr 2007 15:59:02 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 17 Apr 2007 20:32:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30514</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0k8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37097</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>