<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:31:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6073/DERBY-6073.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6073] Test ordering instability in StatementPoolingTest</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6073</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;StatementPoolingTest.testPoolingEnabledByCheckingImplementationDetails() assumes that the client-side statement cache will have been primed by a previous test case, testCacheOverflow(). On Java 7 and Java 8 the test order is not deterministic. If testPoolingEnabledByCheckingImplementationDetails() is the first test case to run, then it fails with this error:&lt;/p&gt;

&lt;p&gt;org.apache.derbyTesting.functionTests.tests.jdbcapi.StatementPoolingTest.assertClassName(StatementPoolingTest.java:147)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.StatementPoolingTest.testPoolingEnabledByCheckingImplementationDetails(StatementPoolingTest.java:89)&lt;/p&gt;

&lt;p&gt;I will attach a patch which forces testPoolingEnabledByCheckingImplementationDetails() to be first in the test order. With this patch, StatementPoolingTest fails for me on Java 7 when run on the 10.9 branch as well as on trunk.&lt;/p&gt;</description>
                <environment>Java 7, Java 8</environment>
        <key id="12632609">DERBY-6073</key>
            <summary>Test ordering instability in StatementPoolingTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Feb 2013 16:11:27 +0000</created>
                <updated>Tue, 12 Mar 2013 08:25:31 +0000</updated>
                            <resolved>Tue, 12 Mar 2013 08:25:31 +0000</resolved>
                                    <version>10.9.1.0</version>
                    <version>10.10.1.1</version>
                                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13579279" author="rhillegas" created="Fri, 15 Feb 2013 16:15:04 +0000"  >&lt;p&gt;Attaching z.diff. After applying this patch, I see the error on trunk. I also see the error after applying the patch to 10.9 and then running with Java 6 or Java 7. Because the problem can be reproduced on 10.9, I do not believe this is a regression introduced by work on the trunk.&lt;/p&gt;</comment>
                            <comment id="13579284" author="rhillegas" created="Fri, 15 Feb 2013 16:17:37 +0000"  >&lt;p&gt;Linking to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6000&quot; title=&quot;Implement support for JDBC 4.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6000&quot;&gt;&lt;del&gt;DERBY-6000&lt;/del&gt;&lt;/a&gt; because this bug was discovered while testing the new JDBC 4.2 implementation on Java 8.&lt;/p&gt;</comment>
                            <comment id="13579294" author="rhillegas" created="Fri, 15 Feb 2013 16:35:49 +0000"  >&lt;p&gt;Attaching derby-6073-01-aa-fixTestCaseOrder.diff. This patch makes the test case order deterministic and fixes the bug on Java 7. Committed at subversion revision 1446675.&lt;/p&gt;

&lt;p&gt;After applying this patch, I see a follow-on problem on Java 8:&lt;/p&gt;

&lt;p&gt;1) testAll(org.apache.derbyTesting.functionTests.tests.jdbcapi.StatementPoolingTest)junit.framework.ComparisonFailure: expected:&amp;lt;...alPreparedStatement4&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&amp;gt; but was:&amp;lt;...alPreparedStatement4&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.StatementPoolingTest.assertClassName(StatementPoolingTest.java:145)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.StatementPoolingTest.t02_testPoolingEnabledByCheckingImplementationDetails(StatementPoolingTest.java:90)&lt;/p&gt;

&lt;p&gt;I will port derby-6073-01-aa-fixTestCaseOrder.diff to 10.9 and prepare another patch for trunk to fix the follow-on problem.&lt;/p&gt;

&lt;p&gt;Touches the following file:&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/StatementPoolingTest.java&lt;/p&gt;</comment>
                            <comment id="13579297" author="rhillegas" created="Fri, 15 Feb 2013 16:39:45 +0000"  >&lt;p&gt;Ported 1446675 from trunk to 10.9 branch at subversion revision 1446676.&lt;/p&gt;</comment>
                            <comment id="13579301" author="kristwaa" created="Fri, 15 Feb 2013 16:43:18 +0000"  >&lt;p&gt;Rick, are you sure this is about test ordering?&lt;/p&gt;

&lt;p&gt;The test fails when getting the connection. The connection is not of the right type. I&apos;m thinking this is a bug in that single test, not an ordering instability.&lt;/p&gt;</comment>
                            <comment id="13579313" author="rhillegas" created="Fri, 15 Feb 2013 16:53:32 +0000"  >&lt;p&gt;Hi Kristian,&lt;/p&gt;

&lt;p&gt;You probably know more about this test case than I do. If you want to back out my fix and propose a better one, feel free to! Thanks.&lt;/p&gt;</comment>
                            <comment id="13579339" author="rhillegas" created="Fri, 15 Feb 2013 17:24:33 +0000"  >&lt;p&gt;Attaching derby-6073-02-aa-java8tweak.diff. This patch adjusts the assertClassName() method to account for the fact that some *40 classes have corresponding *42 subclasses and some don&apos;t.  Committed at subversion revision 1446698.&lt;/p&gt;

&lt;p&gt;The logic is brittle and will probably break again when we implement the next (Java 9) rev of JDBC. But maybe we can just kick the can down the road for another two years. I will unassign myself from this bug so that others can improve this bug fix if they want to.&lt;/p&gt;

&lt;p&gt;Touches the following file:&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/StatementPoolingTest.java&lt;/p&gt;</comment>
                            <comment id="13580576" author="knutanders" created="Mon, 18 Feb 2013 12:19:53 +0000"  >&lt;p&gt;I think the problem is in the test framework. ConnectionPoolDataSourceConnector calls setMaxStatements(2) on the data source before creating a connection. However, if that fails, it creates a new data source on which it calls setCreateDatabase(&quot;create&quot;), and returns a connection created with this data source. The data source that creates the database does not have statement pooling enabled, and the test case will therefore not use statement pooling if the wombat database doesn&apos;t already exist before the test case is executed.&lt;/p&gt;

&lt;p&gt;The attached patch (derby-6073-03-aa-fixConnector.diff) changes ConnectionPoolDataSourceConnector so that it also enables statement pooling on data sources that have the createDatabase attribute set. This makes StatementPoolingTest pass in my environment also if testPoolingEnabledByCheckingImplementationDetails() runs as the first test case.&lt;/p&gt;

&lt;p&gt;Running the full regression test suite on the patch to see if it causes problems for other tests that use ConnectionPoolDataSourceConnector.&lt;/p&gt;</comment>
                            <comment id="13580633" author="knutanders" created="Mon, 18 Feb 2013 14:37:04 +0000"  >&lt;p&gt;All the regression tests passed with the patch.&lt;/p&gt;</comment>
                            <comment id="13581210" author="knutanders" created="Tue, 19 Feb 2013 11:00:04 +0000"  >&lt;p&gt;Committed revision 1447667.&lt;/p&gt;</comment>
                            <comment id="13599189" author="rhillegas" created="Mon, 11 Mar 2013 19:44:53 +0000"  >&lt;p&gt;Can we close this issue now? Thanks.&lt;/p&gt;</comment>
                            <comment id="13599824" author="knutanders" created="Tue, 12 Mar 2013 08:25:31 +0000"  >&lt;p&gt;I don&apos;t think there&apos;s any more work needed on this bug. Closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12616758">DERBY-6000</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12569558" name="derby-6073-01-aa-fixTestCaseOrder.diff" size="7345" author="rhillegas" created="Fri, 15 Feb 2013 16:35:49 +0000"/>
                            <attachment id="12569568" name="derby-6073-02-aa-java8tweak.diff" size="936" author="rhillegas" created="Fri, 15 Feb 2013 17:24:33 +0000"/>
                            <attachment id="12569803" name="derby-6073-03-aa-fixConnector.diff" size="10009" author="knutanders" created="Mon, 18 Feb 2013 12:19:53 +0000"/>
                            <attachment id="12569555" name="z.diff" size="7972" author="rhillegas" created="Fri, 15 Feb 2013 16:15:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 15 Feb 2013 16:43:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313105</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzbvsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313451</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>