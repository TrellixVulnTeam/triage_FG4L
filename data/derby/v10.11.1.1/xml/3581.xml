<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:30:59 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3581/DERBY-3581.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3581] Changing certain properties on client DataSource objects causes existing connections to reflect the new values</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3581</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The client driver has code propagating changes made to the DataSource to existing connections created by that DataSource.&lt;br/&gt;
There is some discussion of this in the thread &lt;a href=&quot;http://www.nabble.com/ConnectionPoolDataSource-properties-td15740457.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/ConnectionPoolDataSource-properties-td15740457.html&lt;/a&gt;, and there is also an example of what can happen due to this &quot;feature&quot;.&lt;/p&gt;

&lt;p&gt;Besides from being a bug with the potential to cause strange errors in deployment, the issue also makes the client driver code harder to read and understand.&lt;br/&gt;
As far as I can see, there is also some related code in other parts of the client driver, for instance for &quot;fully&quot; resetting statements. There is mention of dynamic versus static sections in the comments (this one from am.Statement):&lt;/p&gt;

&lt;p&gt;    // If a dataSource is passed into resetClientConnection(), then we will assume&lt;br/&gt;
    // properties on the dataSource may have changed, and we will need to go through&lt;br/&gt;
    // the open-statement list on the connection and do a full reset on all statements,&lt;br/&gt;
    // including preparedStatement&apos;s and callableStatement&apos;s.  This is because property&lt;br/&gt;
    // change may influence the section we allocate for the preparedStatement, and&lt;br/&gt;
    // also the cursor attributes, i.e. setCursorSensitivity().&lt;br/&gt;
    // If no dataSource is passed into resetClientConnection(), then we will do the&lt;br/&gt;
    // minimum reset required for preparedStatement&apos;s and callableStatement&apos;s.&lt;/p&gt;

&lt;p&gt;Note that the reset code for statements is also invoked when ClientPooledConnection.getConnection() is invoked. I do not understand why we should reset statements when we get a new logical connection.&lt;/p&gt;

&lt;p&gt;Further, I also suspect the concept of a deferred reset has been introduced because of the feature/bug described by this Jira issue. A deferred reset seems to be a mechanism to avoid a round-trip to validate the newly changed DataSource properties (typically user, password and security mechanism).&lt;br/&gt;
I will look into removing code related to deferred resets as well. If you have historic information about these parts of the driver, I would appreciate if you share it with the community if possible.&lt;/p&gt;

&lt;p&gt;Just to be clear, it is my opinion that changed DataSource properties should take effect when one of the following methods is invoked:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;DataSource.getConnection()&lt;/li&gt;
	&lt;li&gt;ConnectionPoolDataSource.getPooledConnection()&lt;/li&gt;
	&lt;li&gt;XADataSource.getXAConnection()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All of the methods above returns a physical connection. Properties like user name and password are associated with the physical connection, and thus requests to obtain a logical connection should not cause any of these properties to change.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12392664">DERBY-3581</key>
            <summary>Changing certain properties on client DataSource objects causes existing connections to reflect the new values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Sun, 30 Mar 2008 14:21:10 +0100</created>
                <updated>Mon, 4 May 2009 19:21:59 +0100</updated>
                            <resolved>Mon, 30 Jun 2008 13:41:18 +0100</resolved>
                                    <version>10.3.2.1</version>
                    <version>10.4.1.3</version>
                    <version>10.5.1.1</version>
                                    <fixVersion>10.4.2.0</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>JDBC</component>
                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12584822" author="kristwaa" created="Wed, 2 Apr 2008 23:05:15 +0100"  >&lt;p&gt;&apos;derby-3581-1a-remove_user_password_iteration1.diff&apos; removes the use of user and password variables when resetting a pooled connection. The only call to the top-level method changed is in ClientPooledConnection.getConnection().&lt;/p&gt;

&lt;p&gt;I have run suites.All without failures, and will continue the work by checking if and for what the data source reference is needed when resetting a physical connection.&lt;br/&gt;
Note that there is no way to change the user name and/or password except for getting a new connection. One can either change the values held be the creating data source, or once can use getPooledConnection(user, password).&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;br/&gt;
I have started derbyall as well, and will report back if it fails.&lt;/p&gt;</comment>
                            <comment id="12585177" author="kristwaa" created="Thu, 3 Apr 2008 17:44:32 +0100"  >&lt;p&gt;In the issue description, I wrote the following:&lt;br/&gt;
----- Kristian wrote:&lt;br/&gt;
Further, I also suspect the concept of a deferred reset has been introduced because of the feature/bug described by this Jira issue. A deferred reset seems to be a mechanism to avoid a round-trip to validate the newly changed DataSource properties (typically user, password and security mechanism).&lt;br/&gt;
I will look into removing code related to deferred resets as well. If you have historic information about these parts of the driver, I would appreciate if you share it with the community if possible. &lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;After reading some sections in the DRDA spec, I think that statement is wrong.&lt;br/&gt;
Sending what is called the deferred reset sequence in the driver (EXCSAT, ACCSEC, SECCHK and ACCRDB), is specified by the DRDA spec. It says the source server &lt;b&gt;can&lt;/b&gt; send it if it wants to reuse the connection for another application or transaction, but I haven&apos;t found a place where it says it has to send it.&lt;br/&gt;
I thought about sending only SECCHK and ACCRDB to reduce the work, but this is not allowed by the DRDA spec (but I think it is allowed by the network server).&lt;/p&gt;

&lt;p&gt;My current conclusion is that the deferred reset code still has to be used and cannot be removed. The code related to picking up changes in the data source can however still be removed.&lt;br/&gt;
Implementing an alternative &quot;reset protocol&quot; might be possible, but that would be 10.5 or maybe even 11. I&apos;m sure a more efficient scheme can be implemented, but it is not clear to me what the solution space looks like bounded by the DRDA spec.&lt;/p&gt;

&lt;p&gt;BTW; derbyall ran cleanly for the 1a patch.&lt;/p&gt;</comment>
                            <comment id="12589121" author="kristwaa" created="Tue, 15 Apr 2008 16:16:52 +0100"  >&lt;p&gt;Committed &apos;derby-3581-1a-remove_user_password_iteration1.diff&apos; to trunk with revision 648280.&lt;br/&gt;
More patches will follow.&lt;/p&gt;</comment>
                            <comment id="12590345" author="kristwaa" created="Fri, 18 Apr 2008 10:02:32 +0100"  >&lt;p&gt;&apos;derby-3581-2a-remove_datasource_iteration1.diff&apos; removes the usage of the data source when the connection is reset. The reset still happens when a new logical connection is obtained, so this change would only affect pooled and xa connections.&lt;/p&gt;

&lt;p&gt;Further, since the reset method is only ever called with the recomputeFromDataSource variable set to true, I plan to simplify the methods and remove that variable.&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;br/&gt;
J2EEDataSourceTest, XATest and XATransactionTest ran cleanly. I&apos;m running full regression tests.&lt;/p&gt;</comment>
                            <comment id="12590347" author="kristwaa" created="Fri, 18 Apr 2008 10:05:48 +0100"  >&lt;p&gt;I&apos;m a bit torn on what to do regarding backporting. I know there are bugs in this area that might have to be fixed in the 10.4 branch. On the other hand, these changes are more like cleanup issues.&lt;/p&gt;

&lt;p&gt;I&apos;ll wait for feedback, if I hear nothing I think I&apos;ll backport to 10.4.&lt;/p&gt;</comment>
                            <comment id="12590409" author="kristwaa" created="Fri, 18 Apr 2008 12:55:07 +0100"  >&lt;p&gt;Committed patch 2a to trunk with revision 649473.&lt;br/&gt;
Regression tests ran cleanly (except for derbyrunjartest in derbyall, which also failed before this patch was applied).&lt;/p&gt;</comment>
                            <comment id="12602994" author="kristwaa" created="Fri, 6 Jun 2008 12:05:32 +0100"  >&lt;p&gt;Backported patches 1a and 2a to 10.4 with revision 663893.&lt;br/&gt;
suites.All and derbyall ran successfully (Sun JDK 1.6.0, Solaris 10).&lt;/p&gt;</comment>
                            <comment id="12604170" author="kristwaa" created="Wed, 11 Jun 2008 10:47:45 +0100"  >&lt;p&gt;&apos;derby-3581-3a-remove_recomputeFromDataSource_flag.diff&apos; removes a flag that is always true.&lt;br/&gt;
It serves no purpose any more, and the associated functionality will not be used/supported by the Derby client driver. Adding it again at a later time, for instance if the community wants to create an enterprise level client side pooling agent, should be pretty easy.&lt;br/&gt;
The removal also makes the code easier to read and understand.&lt;/p&gt;

&lt;p&gt;Regression tests ran without failures (Sun JDK 1.6.0, Solaris 10).&lt;br/&gt;
Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12604185" author="knutanders" created="Wed, 11 Jun 2008 12:27:12 +0100"  >&lt;p&gt;This comment in NetConnection.completeReset() also needs to be updated when recomputeFromDataSource is removed (is 3341 a typo, by the way?):&lt;/p&gt;

&lt;p&gt;         // NB! Override the recomputFromDataSource flag.&lt;br/&gt;
         //     This was done as a temporary, minimal intrusive fix to support&lt;br/&gt;
         //     JDBC statement pooling.&lt;br/&gt;
         //     See &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3341&quot; title=&quot;TABLE FUNCTION returning CHAR values does not return a correct value if the Java ResultSet class returns a value less than the length of the defined CHAR.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3341&quot;&gt;&lt;del&gt;DERBY-3341&lt;/del&gt;&lt;/a&gt; for details.&lt;/p&gt;</comment>
                            <comment id="12604465" author="kristwaa" created="Thu, 12 Jun 2008 10:52:22 +0100"  >&lt;p&gt;&apos;derby-3581-3b-remove_recomputeFromDataSource_flag.diff&apos; also removes the comment (and an unused import).&lt;/p&gt;

&lt;p&gt;Thanks for the correction Knut Anders!&lt;br/&gt;
I plan to commit patch 3b later today.&lt;/p&gt;</comment>
                            <comment id="12604909" author="kristwaa" created="Fri, 13 Jun 2008 16:21:08 +0100"  >&lt;p&gt;Committed &apos;derby-3581-3b-remove_recomputeFromDataSource_flag.diff&apos; to trunk with revision 667568.&lt;br/&gt;
I plan to backport it to 10.4 later, because an upcoming fix under &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3723&quot; title=&quot;Reset current schema to default (user name) when creating a new logical connection in the client driver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3723&quot;&gt;&lt;del&gt;DERBY-3723&lt;/del&gt;&lt;/a&gt; will touch the same code.&lt;/p&gt;</comment>
                            <comment id="12609223" author="kristwaa" created="Mon, 30 Jun 2008 13:41:18 +0100"  >&lt;p&gt;Backported patch 3b to the 10.4 branch with revision 672749. The commit also included the patches for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3723&quot; title=&quot;Reset current schema to default (user name) when creating a new logical connection in the client driver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3723&quot;&gt;&lt;del&gt;DERBY-3723&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12612420" author="kristwaa" created="Thu, 10 Jul 2008 10:46:48 +0100"  >&lt;p&gt;Don&apos;t plan to do any more work on this.&lt;br/&gt;
No problems reported.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12379190" name="derby-3581-1a-remove_user_password_iteration1.diff" size="8538" author="kristwaa" created="Wed, 2 Apr 2008 23:05:14 +0100"/>
                            <attachment id="12380476" name="derby-3581-2a-remove_datasource_iteration1.diff" size="6338" author="kristwaa" created="Fri, 18 Apr 2008 10:02:32 +0100"/>
                            <attachment id="12383817" name="derby-3581-3a-remove_recomputeFromDataSource_flag.diff" size="9699" author="kristwaa" created="Wed, 11 Jun 2008 10:47:45 +0100"/>
                            <attachment id="12383818" name="derby-3581-3a-remove_recomputeFromDataSource_flag.stat" size="199" author="kristwaa" created="Wed, 11 Jun 2008 10:47:45 +0100"/>
                            <attachment id="12383903" name="derby-3581-3b-remove_recomputeFromDataSource_flag.diff" size="10006" author="kristwaa" created="Thu, 12 Jun 2008 10:52:22 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 11 Jun 2008 11:27:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23725</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0y1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39335</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>