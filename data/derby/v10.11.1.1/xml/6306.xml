<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6306/DERBY-6306.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6306] XplainStatisticsTest.testSimpleQuery: BEGIN_COMP_TIME unexpectedly NULL</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6306</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Seen on two platforms in nightly testing of trunk revision 1506904:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://download.java.net/javadesktop/derby/request_5579443/javadb-task-3691350.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.java.net/javadesktop/derby/request_5579443/javadb-task-3691350.html&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://download.java.net/javadesktop/derby/request_5579443/javadb-task-3691354.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.java.net/javadesktop/derby/request_5579443/javadb-task-3691354.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;junit.framework.AssertionFailedError: BEGIN_COMP_TIME unexpectedly NULL&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.getNonNullTimestamp(XplainStatisticsTest.java:1538)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.verifySensibleStatementTimings(XplainStatisticsTest.java:1417)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.XplainStatisticsTest.testSimpleQuery(XplainStatisticsTest.java:1038)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;/p&gt;</description>
                <environment>windows_ia32_jdk7&lt;br/&gt;
windows_amd64_jdk8</environment>
        <key id="12659987">DERBY-6306</key>
            <summary>XplainStatisticsTest.testSimpleQuery: BEGIN_COMP_TIME unexpectedly NULL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Jul 2013 09:15:18 +0100</created>
                <updated>Wed, 21 Jan 2015 00:23:13 +0000</updated>
                            <resolved>Thu, 29 Aug 2013 10:27:58 +0100</resolved>
                                    <version>10.11.1.1</version>
                                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13751356" author="knutanders" created="Tue, 27 Aug 2013 16:28:39 +0100"  >&lt;p&gt;Both testSimpleQuery() and testSimpleXplainOnly() execute the following query:&lt;/p&gt;

&lt;p&gt;  SELECT country from countries WHERE region = &apos;Central America&apos;&lt;/p&gt;

&lt;p&gt;The former with statistics timing turned on, the latter with timing turned off.&lt;/p&gt;

&lt;p&gt;The begin compilation timestamp is recorded in GenericStatement.prepMinion() if timing is enabled. However, it is only recorded if the statement is actually compiled. Not if it is found in the statement cache.&lt;/p&gt;

&lt;p&gt;If testSimpleXplainOnly() runs first, testSimpleQuery() will find the statement in the statement cache, and it won&apos;t compile it. The begin compilation timestamp will therefore be null, and the test fails.&lt;/p&gt;

&lt;p&gt;Assuming it is correct to return null if the compilation was short-circuited, we could work around the problem by having testSimpleQuery() (or the setUp() method) clear the statement cache to ensure the statement is always compiled.&lt;/p&gt;

&lt;p&gt;Alternatively, we could make GenericStatement.prepMinion() record non-null timestamps and timings in the case where no compilation has happened too.&lt;/p&gt;

&lt;p&gt;Any opinions or other suggestions?&lt;/p&gt;

&lt;p&gt;I think I&apos;m leaning towards handling this as a test bug and fixing it by clearing the statement cache before the test case runs, but I could be persuaded otherwise.&lt;/p&gt;</comment>
                            <comment id="13751414" author="rhillegas" created="Tue, 27 Aug 2013 17:38:06 +0100"  >&lt;p&gt;Thanks for picking up this issue, Knut. I like the idea of treating this as a test bug and clearing the statement cache.&lt;/p&gt;</comment>
                            <comment id="13751939" author="bryanpendleton" created="Wed, 28 Aug 2013 01:12:26 +0100"  >&lt;p&gt;Oh, the statement cache! I often forget about that.&lt;/p&gt;

&lt;p&gt;Surely the simplest thing for now is to fix the test; when&lt;br/&gt;
writing it, I was definitely assuming that each statement&lt;br/&gt;
and each test case was basically starting from scratch, so&lt;br/&gt;
none of the current tests are expecting stuff to be laying&lt;br/&gt;
around in the statement cache.&lt;/p&gt;

&lt;p&gt;But it does sort of seem like there is a bug in the&lt;br/&gt;
actual measurement feature as well; if a statement is&lt;br/&gt;
found in the cache and therefore not compiled anew, I&lt;br/&gt;
think that the timestamps for compilation should be valid,&lt;br/&gt;
but probably the begin and end compilation timestamps&lt;br/&gt;
should be identical, indicating that compilation took&lt;br/&gt;
no time at all.&lt;/p&gt;

&lt;p&gt;Maybe that could be addressed as a separate issue, once&lt;br/&gt;
we&apos;ve made the test suite more reliable with the current&lt;br/&gt;
Derby functionality.&lt;/p&gt;</comment>
                            <comment id="13752273" author="knutanders" created="Wed, 28 Aug 2013 11:29:41 +0100"  >&lt;p&gt;Thanks, Rick and Bryan, for your comments. I agree that it makes sense to treat this as a test bug in this issue, and open a new issue if we think the actual statistics should be changed. Feel free to open such an issue if you&apos;d like.&lt;/p&gt;</comment>
                            <comment id="13752276" author="knutanders" created="Wed, 28 Aug 2013 11:35:47 +0100"  >&lt;p&gt;Attaching d6306-1a.diff which makes XplainStatisticsTest clear the statement cache from its setUp() method, so that the test cases needn&apos;t worry about what the earlier test cases did.&lt;/p&gt;

&lt;p&gt;The method that clears the statement cache has been separated out in a helper method, BaseJDBCTestCase.emptyStatementCache(), so that it can be reused. (It&apos;s used in a similar way in StatementPlanCacheTest.)&lt;/p&gt;

&lt;p&gt;This seems to have taken care of the intermittent failure in my environment.&lt;/p&gt;</comment>
                            <comment id="13753412" author="jira-bot" created="Thu, 29 Aug 2013 09:01:12 +0100"  >&lt;p&gt;Commit 1518533 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1518533&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1518533&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6306&quot; title=&quot;XplainStatisticsTest.testSimpleQuery: BEGIN_COMP_TIME unexpectedly NULL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6306&quot;&gt;&lt;del&gt;DERBY-6306&lt;/del&gt;&lt;/a&gt;: XplainStatisticsTest.testSimpleQuery: BEGIN_COMP_TIME unexpectedly NULL&lt;/p&gt;

&lt;p&gt;Clear the statement cache between test cases so that statements from&lt;br/&gt;
earlier test cases don&apos;t affect the results.&lt;/p&gt;</comment>
                            <comment id="13753456" author="jira-bot" created="Thu, 29 Aug 2013 10:27:32 +0100"  >&lt;p&gt;Commit 1518551 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1518551&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1518551&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6306&quot; title=&quot;XplainStatisticsTest.testSimpleQuery: BEGIN_COMP_TIME unexpectedly NULL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6306&quot;&gt;&lt;del&gt;DERBY-6306&lt;/del&gt;&lt;/a&gt;: XplainStatisticsTest.testSimpleQuery: BEGIN_COMP_TIME unexpectedly NULL&lt;/p&gt;

&lt;p&gt;Merged revision 1518533 from trunk.&lt;/p&gt;</comment>
                            <comment id="14284763" author="myrna" created="Wed, 21 Jan 2015 00:23:13 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12600371" name="d6306-1a.diff" size="3599" author="knutanders" created="Wed, 28 Aug 2013 11:35:47 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 27 Aug 2013 16:38:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340179</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzgikn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340497</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>