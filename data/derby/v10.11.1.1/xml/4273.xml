<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:51:05 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4273/DERBY-4273.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4273] A lock could not be obtained within the time requested error in testBTreeForwardScan_fetchRows_resumeAfterWait_nonUnique_split</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4273</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I recently merged changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3926&quot; title=&quot;Incorrect ORDER BY caused by index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3926&quot;&gt;&lt;del&gt;DERBY-3926&lt;/del&gt;&lt;/a&gt; into 10.5.1.2 codeline (revision 784809) and I ran the junit tests on the merged code. The tests finished with one &quot;A lock could not be obtained within the time requested&quot;. Knut suggested that I open a new jira entry for this issue. Copying his comment from &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2991&quot; title=&quot;Index split deadlock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2991&quot;&gt;&lt;del&gt;DERBY-2991&lt;/del&gt;&lt;/a&gt; here &quot;Yes, that test was added for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2991&quot; title=&quot;Index split deadlock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2991&quot;&gt;&lt;del&gt;DERBY-2991&lt;/del&gt;&lt;/a&gt;.. It requires some coordination between two threads, so my first guess would be that there is a timing issue in the test. Please file a separate JIRA issue for this failure. Thanks. &quot;&lt;/p&gt;

&lt;p&gt;Following is the stack track for the failure&lt;br/&gt;
There was 1 error: &lt;br/&gt;
1) testBTreeForwardScan_fetchRows_resumeAfterWait_nonUnique_split(org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest)java.sql.SQLException: A lock could not be obtained within the time requested &lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) &lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:201) &lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:391) &lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) &lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2201) &lt;br/&gt;
        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) &lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedResultSet.closeOnTransactionError(EmbedResultSet.java:4338) &lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:467) &lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:371) &lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest.testBTreeForwardScan_fetchRows_resumeAfterWait_nonUnique_split(IndexSplitDeadlockTest.java:489) &lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) &lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79) &lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) &lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:106) &lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) &lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19) &lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23) &lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) &lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22) &lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19) &lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23) &lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57) &lt;br/&gt;
Caused by: ERROR 40XL1: A lock could not be obtained within the time requested at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:276) &lt;br/&gt;
        at org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(ConcurrentLockSet.java:602) &lt;br/&gt;
        at org.apache.derby.impl.services.locks.ConcurrentLockSet.zeroDurationLockObject(ConcurrentLockSet.java:855) &lt;br/&gt;
        at org.apache.derby.impl.services.locks.AbstractPool.zeroDurationlockObject(AbstractPool.java:297) &lt;br/&gt;
        at org.apache.derby.impl.store.raw.xact.RowLocking2nohold.lockRecordForRead(RowLocking2nohold.java:89) &lt;br/&gt;
        at org.apache.derby.impl.store.access.heap.HeapController.lockRow(HeapController.java:520) &lt;br/&gt;
        at org.apache.derby.impl.store.access.heap.HeapController.lockRow(HeapController.java:638) &lt;br/&gt;
        at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3.lockRowOnPage(B2IRowLocking3.java:309) &lt;br/&gt;
        at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3._lockScanRow(B2IRowLocking3.java:599) &lt;br/&gt;
        at org.apache.derby.impl.store.access.btree.index.B2IRowLockingRR.lockScanRow(B2IRowLockingRR.java:105) &lt;br/&gt;
        at org.apache.derby.impl.store.access.btree.BTreeForwardScan.fetchRows(BTreeForwardScan.java:305) &lt;br/&gt;
        at org.apache.derby.impl.store.access.btree.BTreeScan.fetchNextGroup(BTreeScan.java:1585) &lt;br/&gt;
        at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.reloadArray(BulkTableScanResultSet.java:327) &lt;br/&gt;
        at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.getNextRowCore(BulkTableScanResultSet.java:282) &lt;br/&gt;
        at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:460) &lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:427) &lt;br/&gt;
        ... 34 more &lt;/p&gt;

&lt;p&gt;FAILURES!!! &lt;br/&gt;
Tests run: 9258, Failures: 0, Errors: 1 &lt;/p&gt;</description>
                <environment></environment>
        <key id="12427949">DERBY-4273</key>
            <summary>A lock could not be obtained within the time requested error in testBTreeForwardScan_fetchRows_resumeAfterWait_nonUnique_split</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="mamtas">Mamta A. Satoor</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jun 2009 00:50:15 +0100</created>
                <updated>Fri, 21 Jan 2011 17:52:27 +0000</updated>
                            <resolved>Sat, 27 Jun 2009 14:26:41 +0100</resolved>
                                    <version>10.5.2.0</version>
                                    <fixVersion>10.5.2.0</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12720702" author="knutanders" created="Wed, 17 Jun 2009 16:07:52 +0100"  >&lt;p&gt;I&apos;m not able to reproduce this failure myself (except if I add some sleep() calls), but I think the problem is that the helper thread uses more time than expected before it commits the transaction and releases the X lock. After locking the record, it sleeps for two seconds and then inserts 300 rows before it commits. Since the lock timeout is four seconds, the test may fail if inserting the 300 rows takes more than two seconds (closer to three seconds should normally be OK since the the main thread waits one second before it tries to retrieve the locked row).&lt;/p&gt;

&lt;p&gt;But there&apos;s actually no reason why the lock timeout should be as low as four seconds in this test. None of the test cases expect timeouts, so the test would run as fast with a high timeout. The lowering of the timeout was added because many of the test cases would fail with a timeout exception before &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2991&quot; title=&quot;Index split deadlock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2991&quot;&gt;&lt;del&gt;DERBY-2991&lt;/del&gt;&lt;/a&gt; was fixed, so it was faster to run the test during development that way.&lt;/p&gt;

&lt;p&gt;Attached is a patch which makes the test use the default timeout values.&lt;/p&gt;</comment>
                            <comment id="12720711" author="knutanders" created="Wed, 17 Jun 2009 16:25:02 +0100"  >&lt;p&gt;Committed revision 785662.&lt;/p&gt;</comment>
                            <comment id="12720720" author="knutanders" created="Wed, 17 Jun 2009 16:36:00 +0100"  >&lt;p&gt;Merged to the 10.5 branch and committed revision 785676.&lt;/p&gt;

&lt;p&gt;I cannot say for sure that the problem is fixed since I cannot reproduce it, but I&apos;m marking the issue as resolved on the assumption that it is. If it still reproduces, please reopen.&lt;/p&gt;</comment>
                            <comment id="12720721" author="knutanders" created="Wed, 17 Jun 2009 16:37:39 +0100"  >&lt;p&gt;Adding component test since the bug appears to be in the test code.&lt;/p&gt;</comment>
                            <comment id="12724648" author="mikem" created="Fri, 26 Jun 2009 19:24:42 +0100"  >&lt;p&gt;reopening issue, it still reproduces sometimes in nightly runs.  &lt;br/&gt;
On 6/24/09 it reproduced against trunk, on ibm15 jvm:&lt;br/&gt;
&lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/main/windows/testSummary-788236.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/main/windows/testSummary-788236.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1) testBTreeForwardScan_fetchRows_resumeAfterWait_nonUnique_split(org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest)java.sql.SQLException: A lock could not be obtained within the time requested&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedResultSet.closeOnTransactionError(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedResultSet.next(Unknown Source)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.IndexSplitDeadlockTest.testBTreeForwardScan_fetchRows_resumeAfterWait_nonUnique_split(IndexSplitDeadlockTest.java:488)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
Caused by: ERROR 40XL1: A lock could not be obtained within the time requested&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.locks.ConcurrentLockSet.zeroDurationLockObject(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.locks.AbstractPool.zeroDurationlockObject(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.xact.RowLocking2nohold.lockRecordForRead(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.HeapController.lockRow(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.access.heap.HeapController.lockRow(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3.lockRowOnPage(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3._lockScanRow(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.access.btree.index.B2IRowLockingRR.lockScanRow(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.access.btree.BTreeForwardScan.fetchRows(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.store.access.btree.BTreeScan.fetchNextGroup(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.reloadArray(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.getNextRowCore(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(Unknown Source)&lt;br/&gt;
	... 30 more&lt;/p&gt;</comment>
                            <comment id="12724767" author="knutanders" created="Sat, 27 Jun 2009 01:27:30 +0100"  >&lt;p&gt;I wrapped the test in a DatabasePropertyTestSetup that sets derby.locks.deadlockTrace=true so that we get more info the next time it fails. Committed revision 788909.&lt;/p&gt;</comment>
                            <comment id="12724820" author="knutanders" created="Sat, 27 Jun 2009 09:25:45 +0100"  >&lt;p&gt;It looks like some other test is reducing the lock timeouts without resetting them, so derby.locks.waitTimeout is 3 seconds, not the expected 60 seconds, when the test is run as part of suites.All. I think ResultSetMiscTest and/or SetTransactionIsolationTest is the culprit.&lt;/p&gt;</comment>
                            <comment id="12724852" author="knutanders" created="Sat, 27 Jun 2009 14:17:34 +0100"  >&lt;p&gt;d4273-2.diff makes ResultSetMiscTest and SetTransactionIsolationTest use DatabasePropertyTestSetup to set deadlock timeout and wait timeout. I&apos;ve verified that IndexSplitDeadlockTest now has default timeout values when run as part of suites.All.&lt;/p&gt;</comment>
                            <comment id="12724853" author="knutanders" created="Sat, 27 Jun 2009 14:26:41 +0100"  >&lt;p&gt;Committed to trunk with revision 788968.&lt;br/&gt;
Committed to 10.5 with revision 788969.&lt;/p&gt;

&lt;p&gt;I&apos;m marking the issue as resolved. If the problem is still reproducible, please reopen again.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12375269">DERBY-2991</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12411985" name="d4273-2.diff" size="4158" author="knutanders" created="Sat, 27 Jun 2009 14:17:34 +0100"/>
                            <attachment id="12410945" name="d4273.diff" size="661" author="knutanders" created="Wed, 17 Jun 2009 16:07:52 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 17 Jun 2009 15:07:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24145</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0l27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37230</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>