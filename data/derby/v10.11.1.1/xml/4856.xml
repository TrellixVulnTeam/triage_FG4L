<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:11:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4856/DERBY-4856.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4856] Add thread dump information when derby crash</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4856</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;On system crash or session ending error, Derby should dump as much information as possible. Such as: forcing a javacore if possible or at least thread dump and system environment information. This should only occur if a running session crashes not on boot error due to fail recovery etc.&lt;br/&gt;
The IBM jvm provides a way to programmatically dump a javacore. i.e. com.ibm.jvm.Dump.JavaDump() And, the SUN jvm will force a thread dump using the Unsafe class and there may be a better way. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12477769">DERBY-4856</key>
            <summary>Add thread dump information when derby crash</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lilywei">Lily Wei</assignee>
                                    <reporter username="lilywei">Lily Wei</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Oct 2010 19:25:10 +0100</created>
                <updated>Wed, 5 Feb 2014 22:40:47 +0000</updated>
                            <resolved>Fri, 28 Jan 2011 01:38:47 +0000</resolved>
                                                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12922656" author="kmarsden" created="Tue, 19 Oct 2010 19:35:57 +0100"  >&lt;p&gt;I recently had to do a programatic dump of information on a Sun JVM and found this:&lt;br/&gt;
&lt;a href=&quot;http://forums.oracle.com/forums/thread.jspa?threadID=1237584&amp;amp;tstart=15&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://forums.oracle.com/forums/thread.jspa?threadID=1237584&amp;amp;tstart=15&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The file did not have the system properties or shell environment.   I printed the system properties as below, but between the two seemed to still be missing a of information, like the shell environment and the command line,&lt;/p&gt;

&lt;p&gt;	System.out.println(&quot;\n\n------ Java System Properties -----&quot;);&lt;br/&gt;
	Properties sprops = System.getProperties();&lt;br/&gt;
	Set listem;&lt;br/&gt;
	String str;&lt;/p&gt;

&lt;p&gt;	listem = sprops.keySet();&lt;br/&gt;
	Iterator itr = listem.iterator();	&lt;/p&gt;

&lt;p&gt;	System.out.println(&quot;props test&quot;);&lt;br/&gt;
	while (itr.hasNext())&lt;/p&gt;
	{
		str = (String) itr.next();
		System.out.println(&quot;key: &quot; + str +&quot;\t;value: &quot; + sprops.getProperty(str));
	}

&lt;p&gt;	System.out.println(&quot;---- end System Properties output ----\n\n&quot;);&lt;/p&gt;</comment>
                            <comment id="12922780" author="dagw" created="Wed, 20 Oct 2010 00:17:21 +0100"  >&lt;p&gt;Thread.getAllStackTraces may be useful? (&amp;gt;= 1.5 though)&lt;/p&gt;</comment>
                            <comment id="12928898" author="kmarsden" created="Sat, 6 Nov 2010 00:28:33 +0000"  >&lt;p&gt;I think ultimately the information should dump  only for ExceptionSeverity.SESSION_SEVERITY errors or higher if the derby engine is booted, but while developing you may want to leave the boot check out and the use this corrupt database which will fail to connect and produce a ExceptionSeverity.DATABASE_SEVERITY error.&lt;/p&gt;

&lt;p&gt;Lily also mentioned to me two other types of errors that might need to be reported, java exceptions that don&apos;t get caught and wrapped in SQLExceptions  like some NullPointerExceptions and also it would be nice ultimate to include low cost asserts in insane builds. I am not quite sure how this should be accomplished.&lt;/p&gt;
</comment>
                            <comment id="12932804" author="lilywei" created="Wed, 17 Nov 2010 03:58:49 +0000"  >&lt;p&gt;Thanks to Kathey. I am able to construct first attempt to add thread dump on insane build for embedded server. &lt;br/&gt;
I am puzzling on whether the StandardException.printStackTrace(PrintWriter s) for severity &amp;gt;= ExceptionSeverity.SESSION_SEVERITY is the best place to print out thread dump or place like ErrorStringBuilder.stackTrace is better. Personally, I think it shouldn&apos;t be that much noise to put in StandardException.printStackTrace(PrinterWriter s) Any opinion is welcome. Please review the code and give me your opinion. Thanks.&lt;/p&gt;</comment>
                            <comment id="12932806" author="lilywei" created="Wed, 17 Nov 2010 04:07:05 +0000"  >&lt;p&gt;The changes included: &lt;br/&gt;
1. Move ThreadDump.java from java/shared/org/apache/derby/shared/common/sanity to java/shard/org/apache/derby/shared/common/error&lt;br/&gt;
2. move dumpThreads method from AssertFailure to ExceptionUtil&lt;br/&gt;
3. Add printStackTrace to StandardException when severity &amp;gt;= ExceptionSeverity.SESSION_SEVERITY&lt;br/&gt;
You can find thread dump information in derby.log for corruptdb database &lt;/p&gt;

&lt;p&gt;Hope this is helpful.&lt;/p&gt;</comment>
                            <comment id="12932892" author="knutanders" created="Wed, 17 Nov 2010 10:45:50 +0000"  >&lt;p&gt;I&apos;d prefer that we don&apos;t change the behaviour of StandardException.printStackTrace(), as that may be confusing to the users and may also make the output from the applications noisy and harder to read. To me it sounds sufficient to dump this information to derby.log and not include the thread dump in the exception itself. What about adding the code to ContextManager.cleanupOnError() instead? That&apos;s where the writing of errors to derby.log happens.&lt;/p&gt;</comment>
                            <comment id="12932967" author="bryanpendleton" created="Wed, 17 Nov 2010 14:49:51 +0000"  >&lt;p&gt;+1 to placing this information in a file of some sort.&lt;/p&gt;

&lt;p&gt;derby.log is a reasonable suggestion.&lt;/p&gt;

&lt;p&gt;Another idea is create a separate file JUST for this this crash information.&lt;br/&gt;
Since it&apos;s similar in notion to a &quot;crash dump&quot; file, how about a uniquely&lt;br/&gt;
generated name for a standalone &quot;dump&quot; file of some sort, as in:&lt;/p&gt;

&lt;p&gt;    derby_minidump_YYMMDD_n.txt&lt;/p&gt;

&lt;p&gt;Where the YYMMDD is today&apos;s date, and the &apos;N&apos; is&lt;br/&gt;
a number incremented each time we produce a dump on&lt;br/&gt;
that date.&lt;/p&gt;

&lt;p&gt;A nicely packaged standalone dump file produced on a system crash&lt;br/&gt;
would provide a very helpful tool for users to interact with the&lt;br/&gt;
community when trying to diagnose Derby problems.&lt;/p&gt;</comment>
                            <comment id="12932993" author="kristwaa" created="Wed, 17 Nov 2010 15:48:42 +0000"  >&lt;p&gt;Another point supporting Bryan&apos;s suggestion, is that derby.log is by default overwritten.&lt;br/&gt;
This can be, and hopefully is, changed in production environments, but I still think a separate file is an approach worth considering (we may have to deal with write privileges then).&lt;/p&gt;</comment>
                            <comment id="12933337" author="lilywei" created="Thu, 18 Nov 2010 07:11:29 +0000"  >&lt;p&gt;We can definitely consider writing the information to a separate file and consider the deal with write privileges. If we do add the code in ContextManager.cleanupOnError(), how do we make sure the database is already boot. I keep seeing the threadDump information get print out before the database is booted. How to avoid it?&lt;/p&gt;</comment>
                            <comment id="12965578" author="lilywei" created="Wed, 1 Dec 2010 06:20:46 +0000"  >&lt;p&gt;Thanks to Kathey, due to the scope of the changes, I would like to purpose three steps check-in to address this issue :&lt;br/&gt;
I.&lt;br/&gt;
1.1. Move ThreadDump.java from java/shared/org/apache/derby/shared/common/sanity to            java/shard/org/apache/derby/shared/common/error &lt;br/&gt;
1.2. move dumpThreads method from AssertFailure to ExceptionUtil &lt;br/&gt;
1.3  Have this available for insane build only.&lt;br/&gt;
II.&lt;br/&gt;
 2.1 Add ThreadDump information to sane build in ContextManager. cleanupOnError(). it will print the thread dump information to derby.log&lt;br/&gt;
III.&lt;br/&gt;
3.1 Add file handling as Bryan and Kristian&apos;s suggestion for ThreadDump info. The current thinking is to add the file handling code as the method as utility tool and calls it in ContextManager&lt;/p&gt;

&lt;p&gt;I am attaching &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4856&quot; title=&quot;Add thread dump information when derby crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4856&quot;&gt;&lt;del&gt;DERBY-4856&lt;/del&gt;&lt;/a&gt;-part_1_1a.diff for code review. The patching is covering the part one change. I am running Suites.All and derbyall now. &lt;/p&gt;</comment>
                            <comment id="12965686" author="bryanpendleton" created="Wed, 1 Dec 2010 14:18:21 +0000"  >&lt;p&gt;+1 to the technique of the multi-step approach.&lt;/p&gt;

&lt;p&gt;I read through your part-1 patch and it looks fine to me.&lt;/p&gt;

&lt;p&gt;Thanks for working on this infrastructure, it will be very helpful!&lt;/p&gt;</comment>
                            <comment id="12965759" author="lilywei" created="Wed, 1 Dec 2010 17:41:37 +0000"  >&lt;p&gt;Thank you so much, Bryan. I run Suites.all and derbyall and I did not see any error. If it is okay with everybody, I will check into trunk today.&lt;/p&gt;</comment>
                            <comment id="12965772" author="knutanders" created="Wed, 1 Dec 2010 18:07:22 +0000"  >&lt;p&gt;I think this is OK as long as the classes are only used by the sane jars. If you plan to use the classes in the production jars too, you should be aware of the discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-289&quot; title=&quot;Enable code sharing between Derby client and engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-289&quot;&gt;DERBY-289&lt;/a&gt;, which raises some concerns about having code in the shared packages.&lt;/p&gt;</comment>
                            <comment id="12965861" author="kmarsden" created="Wed, 1 Dec 2010 21:51:44 +0000"  >&lt;p&gt;I think the point of the move is to make them available for insane builds so they can be used by the engine on a crash, so if it cannot be in shared,  I guess instead of moving the SanityManager code, there will have to be separate new code for producing thread dumps in  java/engine/org/apache/derby/iapi/services/info.  It would be good to include comments in both explaining that any bug fixes will likely have to be fixed in both places.&lt;/p&gt;</comment>
                            <comment id="12966133" author="lilywei" created="Thu, 2 Dec 2010 14:44:08 +0000"  >&lt;p&gt;Thanks Knut and Kathey. &lt;br/&gt;
For phrase one, the goal is to use ExceptionUtil.dumpThread() in AssertFailure.java. AssertFailure.java is in shared/common/sanity for insane build.&lt;br/&gt;
For phrase two, the goal is to use ExceptionUtil.dumpThread() in ContextManager for engine. ExceptionUtil is in shared/common/error which is an existing class for derby.jar and derbyclient.jar. I am including ContextManaer.java now to help me understand does it fit into the David&apos;s concern on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-289&quot; title=&quot;Enable code sharing between Derby client and engine&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-289&quot;&gt;DERBY-289&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-289?focusedCommentId=12415429&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#action_12415429&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DERBY-289?focusedCommentId=12415429&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#action_12415429&lt;/a&gt;. If phrase two&apos;s change is only to ContextManager.java(working progress) which uses ExceptionUtil.java and ExceptionUtil.java is an existing class, do I still need to introduce code in java/engine/org/apache/derby/iapi/services/info to have similar class? I would think it is safe to use since it is an existing class on shared/common/error that derby.jar and derbyclient.jar both had. &lt;/p&gt;</comment>
                            <comment id="12966299" author="kmarsden" created="Thu, 2 Dec 2010 21:59:55 +0000"  >
&lt;p&gt;Hi Lily,&lt;/p&gt;

&lt;p&gt;I see what you mean about ExceptionUtil.java. I think the short story is that that it should not have ever been used by the engine.  David&apos;s original comment said:&lt;/p&gt;

&lt;p&gt;&quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-838&quot; title=&quot;Create internationalization framework for network client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-838&quot;&gt;&lt;del&gt;DERBY-838&lt;/del&gt;&lt;/a&gt;: Establish an internationalization framework for the network&lt;br/&gt;
client.&lt;/p&gt;

&lt;p&gt;Added a new shared directory and shared packages.  These shared packages&lt;br/&gt;
are only used by the derbyclient.jar until we establish a shared code framework&quot;&lt;/p&gt;

&lt;p&gt;I recall conversations long ago that until we figured out how to really handle common code, things that would be potentially  good to share would be put under shared, but only be used by client until the whole framework was worked out. Unfortunately this history was lost when during the LOB work too years later, ExceptionUtil obviously looked very convenient for this  engine work, but we should probably file a bug to take references to ExceptionUtil out of the engine.&lt;/p&gt;


</comment>
                            <comment id="12967071" author="lilywei" created="Mon, 6 Dec 2010 03:07:10 +0000"  >&lt;p&gt;Thanks Kathey for point out the history and how to proceed. Thanks Knut for helping me on IRC. Due to the fact that java/shared/org/apache/derby/shared/common is really for derbyclient.jar. And, my part 1 and part 2 are really only for engine. I will not be changing the java/shared/org/apache/derby/shared/common/sanity/ThreadDump.java. or any of the shared files.&lt;br/&gt;
Instead, I am adding a new java/engine/org/apache/derby/iapi/error/ThreadDumpUtil.java and java/engine/org/apache/derby/iapi/error/ExceptionUtil.java Since these two files are very similar to the ThreadDump.java and ExceptionUtil.java in java/shared/ . In the future, if the code affect both engine and client, developer has to fix in two places.&lt;/p&gt;

&lt;p&gt;I changed the name from ThreadDump.java to ThreadDumpUtil.java.  If there is no extra instruction in extraDBMSclasses.properties or rename to ThreadDumpUtil.java, With the change iapi/build.xml, build process will always build ThreadDump.class in classes/org/apache/derby/shared/common/error/ThreadDump.class. &lt;br/&gt;
With derby.module.engine.threaddumputil=org.apache.derby.iapi.error.ThreadDumpUtil in extraDBMSclasses.properties and rename ThreadDump.java to ThreadDumpUtil.java in iapi/error, the build process will build classes/org/apache/derby/iapi/error/ThreadDumpUtil.class&lt;/p&gt;

&lt;p&gt;ContextManager.java change is so thread dump information will be in insane build. I install updates for eclipse with my eclipse. The new behavior keeps sorting the import files when I press safe. I tried to make it not sort the import files and not very successful. I thought we can use sorted import files. If we prefer not to have it sort, I need help to figure out how to make eclipse not sort the import files. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The code is ready for review. I run Suites.all and derybyall for insane and sane build and they all run okay. I also tested it with &apos;corruptdb&apos; database and see the thread dump information.&lt;/p&gt;</comment>
                            <comment id="12968935" author="kmarsden" created="Tue, 7 Dec 2010 20:09:15 +0000"  >&lt;p&gt;Thanks Lily for the patch.&lt;/p&gt;

&lt;p&gt;For the new engine ExceptionUtil, I don&apos;t think  the field threadDump is needed or used.  The reflection call should use the ThreadDump in engine, not the shared one. I think then it will be fine for the engine ThreadDump class to keep the original name,  ThreadDump.&lt;/p&gt;


&lt;p&gt;In ContextManager, there seem to be some javadoc formatting issues with the new getErrorCode method, which might better be callse dgetErrorSeverity.  I would add a comment that errors that are not Standard or SQLExcetions are not handled at this time.&lt;br/&gt;
]&lt;/p&gt;</comment>
                            <comment id="12968995" author="lilywei" created="Tue, 7 Dec 2010 21:19:22 +0000"  >&lt;p&gt;Thanks Kathey for reviewing the code. &lt;br/&gt;
I attached the part_2_2b patch.&lt;br/&gt;
The threadDump varilable is removed from ExceptionUtil and the reflection is using ThreadDump. The ThreadDumpUtil is rename to ThreadDump in iapi/error.&lt;/p&gt;

&lt;p&gt;In ContextManager, the import is not being sorted. The getErrorCode Method is renamed to getErrorSeverity and the javadoc format issues is modified. Add commend says error only StandardException and SQLException are being handled at this time. &lt;/p&gt;

&lt;p&gt;build.xml and extraDBMSclasses.properties had been changed to reflect rename of ThreadDumpUtil to ThreadDump.&lt;/p&gt;</comment>
                            <comment id="12969173" author="lilywei" created="Wed, 8 Dec 2010 04:06:42 +0000"  >&lt;p&gt;Run fine for suites.all and derbyall for insane build. Thread dump info is log to derby.log. &lt;br/&gt;
Commit fix for part 2 of this issue and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4929&quot; title=&quot;Engine code should not use java/shared/org/apache/derby/shared/common/error/ErrorUtil.java &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4929&quot;&gt;&lt;del&gt;DERBY-4929&lt;/del&gt;&lt;/a&gt; at subversion revision 1043290. &lt;/p&gt;</comment>
                            <comment id="12969249" author="knutanders" created="Wed, 8 Dec 2010 08:52:38 +0000"  >&lt;p&gt;The two new files added in the patch didn&apos;t have the svn:eol-style property set. I fixed that and committed revision 1043334.&lt;/p&gt;

&lt;p&gt;Here&apos;s a description of how to configure Subversion to set this property automatically for you: &lt;a href=&quot;http://www.apache.org/dev/svn-eol-style.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.apache.org/dev/svn-eol-style.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12971918" author="lilywei" created="Thu, 16 Dec 2010 01:05:56 +0000"  >&lt;p&gt;Thanks to Kathey. I am attach &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4856&quot; title=&quot;Add thread dump information when derby crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4856&quot;&gt;&lt;del&gt;DERBY-4856&lt;/del&gt;&lt;/a&gt;_part_3_1a.diff patch.&lt;br/&gt;
The changes in this patch:&lt;br/&gt;
1. Allow use enter property derby.stream.error.extendedDiagSeverityLevel. The default value is 40000&lt;br/&gt;
2. If the error(StandardException, SQLException) has error severity level &amp;gt;= derby.stream.error.extendedDiagSeverityLevel, thread dump information and extend diagnosis information will be handle by Derby.&lt;br/&gt;
3. Change SimpleTest to have derby.stream.error.extendedDiagSeverityLevel=45000&lt;/p&gt;

&lt;p&gt;I am running Suites and derbyall tests now.&lt;/p&gt;

&lt;p&gt;Question: If the database is not booted and error occurs, thread dump information and extend diagnosis information will still be handle with proper extenedDiagSeverityLevel . Should the code be some where else than ContextManager.cleanupOnError()? Any suggestion is welcome. Thanks.&lt;/p&gt;</comment>
                            <comment id="12975399" author="lilywei" created="Tue, 28 Dec 2010 01:02:54 +0000"  >&lt;p&gt;Thanks to IRC discussion with Kathey and Knut. This is the prototype for checking whether database is active or it is okay to trace thread dump information in ContextManager.cleanupOnError on top of part_3_1a patch. The change includes:&lt;br/&gt;
1.	cleanupOnError takes two parameters: error and isdbactive. If isdbactive, it will print out threadudmp info and diagnosis information for ibm jvm&lt;br/&gt;
2.	The guide line to get isdbactive information is to just pass the Boolean value when it make sense, get it from the isactive information from the database associated with the object, get it from  the isactive Boolean value from the database associated with LanguageConnectionContext,  or the isactive value from EmbedPooledConnection value. &lt;/p&gt;

&lt;p&gt;The patch passed Suites.all and derbyall for sun jvm.  However, it hangs on replication tests for ibm jvm such as ReplicationRun_Local in ReplicationRun_Local.connectPing somewhere near conn=DriverManager.getConnection(dbURL); &lt;/p&gt;

&lt;p&gt;The patch is ready for review. Thank you for reviewing in advance.&lt;/p&gt;</comment>
                            <comment id="12976361" author="lilywei" created="Fri, 31 Dec 2010 22:49:52 +0000"  >&lt;p&gt;Thanks to Kathey for reviewing the code. The new patch is ready for review.&lt;br/&gt;
Change in this patch compare to last one&lt;br/&gt;
1.	For all the tests, assume we don&apos;t want the thread dump info except T_b2i.java test. For T_b2i.java, I am testing the test can function correctly if we get the database active information from LanguageConnectionContext object.&lt;br/&gt;
2.	For the code path we know it is okay not to get the thread dump information, we will assume database is not active&lt;br/&gt;
3.	Change getSystenProperty to private in JVMInfo.java&lt;/p&gt;

&lt;p&gt;Patch run clean on suites.all for sun jvm. I am still running derbyall test suite for sun jvm.&lt;/p&gt;

&lt;p&gt;There are two issues that are under investigation:&lt;br/&gt;
1.	For ibm 1.6 jvm, ReplicationRun_Local still hang on ReplicationRun.connectPing(...) where we try to do DriverManager.getConnection(dbURL) on windows 7. The test did not hang with ibm 1.6 jvm on windows xp. The dbURL value is jdbc:derby://localhost:1531/c:\derby3\trunk\testtmp\db_slave\wombat I am thinking out loud here. Will change the path for the master and slave server and using the new way to remove directory make the hang issue and intermediate failure on replication tests behave better?  Any suggestion is welcome.&lt;br/&gt;
2.	For replication failover case, there are some javacore* files created due to the current design of handling javaDump for ibm. Maybe we should just not dump thread info in these cases?&lt;/p&gt;

&lt;p&gt;Happy New Year!&lt;/p&gt;</comment>
                            <comment id="12976954" author="lilywei" created="Mon, 3 Jan 2011 20:56:42 +0000"  >&lt;p&gt;Change in this patch compare to 3a patch:&lt;br/&gt;
1. Change TransactionResourceImpl.cleanupOnError(Throwable e) to assume database is not active to avoid the hanging problem for replicationRun_Local test one windows 7. Also, not create thread dump info and diagnoisis files on replication failover situation.&lt;/p&gt;

&lt;p&gt;Suites.all runs clean with ibm 1.6 jvm with svn 1054737. derbyall failed on unit/T_RawStoreFactory.unit due to not able to shutdown database.&lt;/p&gt;

&lt;p&gt;Suites.all and derbyall run clean with sun jvm.&lt;/p&gt;


&lt;p&gt;The patch is ready for review.&lt;/p&gt;</comment>
                            <comment id="12977644" author="lilywei" created="Wed, 5 Jan 2011 06:28:52 +0000"  >&lt;p&gt;Thanks to Kathey for reviewing the code and found problem for not able to get thread dump and diagnostic information when there is deadlock error. Please refer to test Derby3980DeadlockTest.&lt;/p&gt;

&lt;p&gt;The changes for this patch compare to 3b are:&lt;br/&gt;
1.	Use isactive variable in SequenceUpdater.java&lt;br/&gt;
2.	Revise TransactionResourceImpl.cleanupOnError(Throwable error, Boolean diagActive) method to take one more parameter to further detect whether to process diagnostic information.&lt;br/&gt;
&#8226;	Pass whether database is active information in TransactionResourceImpl.handleException&lt;br/&gt;
3.	Assume database is not active when calling TransactionResourceImpl.cleanupOnError on EmbeddedConnection(...) init stage and EmbeddedConnection.close&lt;br/&gt;
4.	Change comments and variable name&lt;br/&gt;
5.	Add test to Derby3980DeadlockTest.java&lt;/p&gt;

&lt;p&gt;Current result: There is one javacore* file after Derby3980DeadlockTest&lt;/p&gt;

&lt;p&gt;I am running suites.all and derbyall tests. Please review the code.&lt;/p&gt;</comment>
                            <comment id="12978005" author="lilywei" created="Wed, 5 Jan 2011 22:31:17 +0000"  >&lt;p&gt;After running derbyall and suites.all with ibm 1.6 jvm, I made the following adjustment and attach 3d patch:&lt;br/&gt;
1.	Check whether database is null at TransactionResourceImple.handleException as sometimes the database can be null and we will not want to print any thread dump or diagnostic information&lt;br/&gt;
2.	Modify MaxLogNumberRecovery.java to set derby.stream.error.extendedDiagSeverityLevel to 50000 so no thread dump or diagnostic information as test exceed the max log file number. &lt;br/&gt;
3.	Revert the change for SimpleTest.java since the flag value is being used in Derby3980DeadlockTest and MaxLogNumberRecovery.&lt;/p&gt;

&lt;p&gt;Derbyall and suites.all does not have any unexpected failure with ibm 1.6 jvm. I am running with sun jvm now. The patch is ready for review.&lt;/p&gt;</comment>
                            <comment id="12979964" author="lilywei" created="Tue, 11 Jan 2011 06:28:36 +0000"  >&lt;p&gt;Add removing the javacore* file from Derby3980DeadlockTest and add the proper .policy file for it.&lt;br/&gt;
However, due to the current behavior regarding error for  40001 or 40XL1: A lock could not be obtained. The test output is different from ibm jvm or sun jvm. There might be more work to be done to make the test more stable to be part of regression test. There is no change on code change for 3e patch. Suites and derbyall run clean on 3e patch.&lt;/p&gt;</comment>
                            <comment id="12980415" author="lilywei" created="Tue, 11 Jan 2011 23:09:50 +0000"  >&lt;p&gt;Thanks to Kathey, patch 3g modify Derby3980DeadlockTest.decorateTest to preserve the derby.log on failure. Due to extra timing to create javacore* files, ibm jvm produce deadlock error instead of log time out error. &lt;/p&gt;</comment>
                            <comment id="12981122" author="lilywei" created="Thu, 13 Jan 2011 04:10:19 +0000"  >&lt;p&gt;Check in svn #1058404 for part_3_3g patch with space/tab changes and AuthenticationTest.java change.&lt;br/&gt;
It is possible the database.isActive() information could need more work. Please watch that for me. When running suites.all with ibm jvm, there are left over javacore* files. I still need to do clean up work. More information is needed to find out which tests create the javacore*file. There are two ways to clean up the javacore* files - create teardown() method to clean up the javacore* files or set the flag by calling &lt;br/&gt;
setSystemProperty(&quot;derby.stream.error.extendedDiagSeverityLevel&quot;,&quot;50000&quot;)&lt;/p&gt;

&lt;p&gt;Derby3980DeadlockTest might not always produce deadlock error and it is not part of nightly run test.&lt;/p&gt;

&lt;p&gt;Thank Kathey so much for keep helping me review and write this part of fix. Thank Knut for giving very helpful tips in IRC and everywhere else.  Hopefully, the javacore* files will not cause the machine to run out of disk space. Post-commit reviews still welcome. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12981180" author="knutanders" created="Thu, 13 Jan 2011 08:44:19 +0000"  >&lt;p&gt;It would be good to add a comment in AuthenticationTest to explain why the system property has to be set for the test. There&apos;s no code to reset the property, so doesn&apos;t that mean it will affect subsequent tests too? Thinking more about it, since the code to set the system property is in baseSuite(), it will be executed before any tests have started, so it will probably affect all the tests. Would it work to wrap the test in a SystemPropertyTestSetup instead?&lt;/p&gt;</comment>
                            <comment id="12981252" author="lilywei" created="Thu, 13 Jan 2011 14:03:52 +0000"  >&lt;p&gt;Thanks Knut for reviewing. I will add the comment to explain why the system property has to be set for AuthenticationTest. When I run suites.all with 1.6 ibm jvm, it created 145 javacore* files. I review most of them and most of them come from AuthenticationTest for getConnection that will get error/SQLException with negative tests. So, it makes sense for the thread dump information and diagnostic information. However, we really don&apos;t want to have too many left over javacore* files after test run. So, I set it in baseSuite() to trigger not producing such behavior.  I will look into wrap the test in a SystemPropertyTestSetup to see whether it is more appropriate. &lt;/p&gt;</comment>
                            <comment id="12981439" author="lilywei" created="Thu, 13 Jan 2011 19:34:17 +0000"  >&lt;p&gt;It is better to wrap extendedDiagSeverityLevel property in SystemPropertyTestSetup for AuthenticationTest. Add the comment and the change to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4856&quot; title=&quot;Add thread dump information when derby crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4856&quot;&gt;&lt;del&gt;DERBY-4856&lt;/del&gt;&lt;/a&gt;_part_3_3g_1a.diff patch. I am running suites.All to see we don&apos;t produce too many javacore* files. Please review the change.&lt;/p&gt;</comment>
                            <comment id="12981601" author="lilywei" created="Fri, 14 Jan 2011 01:34:48 +0000"  >&lt;p&gt;Thanks Kathey for giving her blessing for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4856&quot; title=&quot;Add thread dump information when derby crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4856&quot;&gt;&lt;del&gt;DERBY-4856&lt;/del&gt;&lt;/a&gt;_part_3_3g_1a.diff patch. There is only one javacore* file left after running suites.all with ibm 1.6 jvm. The test runs clean. The file is from LockInterruptTest. Add property to avoid thread dump and diagnostic information with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4856&quot; title=&quot;Add thread dump information when derby crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4856&quot;&gt;&lt;del&gt;DERBY-4856&lt;/del&gt;&lt;/a&gt;_part_3_3g_2a.diff patch. Please review the code.&lt;/p&gt;</comment>
                            <comment id="12981616" author="kmarsden" created="Fri, 14 Jan 2011 03:03:24 +0000"  >&lt;p&gt;Lilly at what point in the test was the the javacore occurring? Was it really a crash?&lt;/p&gt;
</comment>
                            <comment id="12981622" author="lilywei" created="Fri, 14 Jan 2011 03:44:57 +0000"  >&lt;p&gt;Thanks Kathey for reviewing. At LockInterruptTest.runWaiter() line 150 with ps.executeUpdate, the test receive an interrupt and raise an error/exception &quot;ERROR 08000: Connection closed by unknown interrupt&quot;. I think this is a negative test case again. So, I set the flag to turn off thread dump and diagnostic information.&lt;/p&gt;</comment>
                            <comment id="12981771" author="kmarsden" created="Fri, 14 Jan 2011 14:33:29 +0000"  >&lt;p&gt;I think this is indeed a session ending exception so it makes sense to get the javadump when it occurs and the thread dump might be very useful at this point.   If under some circumstance someone had intentional interrupts where this was expected, they could set property higher to avoid the javacores, so +1 to the change.&lt;/p&gt;</comment>
                            <comment id="12981772" author="lilywei" created="Fri, 14 Jan 2011 14:41:37 +0000"  >&lt;p&gt;Thanks Kathey for reviewing. I&apos;ll check-in the patch now.&lt;/p&gt;</comment>
                            <comment id="12987875" author="lilywei" created="Fri, 28 Jan 2011 01:38:03 +0000"  >&lt;p&gt;Attach the releaseNote.html. Please review the release note. &lt;/p&gt;</comment>
                            <comment id="12988185" author="dagw" created="Fri, 28 Jan 2011 19:12:55 +0000"  >&lt;p&gt;Hi, thanks for the release notes, Lily!&lt;/p&gt;

&lt;p&gt;Caveat, my comments below are not based on a thorough knowledge of&lt;br/&gt;
this new feature, I have just read about if cursorily, so if I got my&lt;br/&gt;
fact wrong, please forgive. Mostly, my change proposals are for&lt;br/&gt;
improved legibility.&lt;/p&gt;

&lt;p&gt;&amp;gt; Summary of Change&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Derby will dump as much thread dump and diagnostic information as&lt;br/&gt;
&amp;gt; possible on system crash or session error. i.e. Users will find&lt;br/&gt;
&amp;gt; thread dump information with error severity higher than session&lt;br/&gt;
&amp;gt; error in derby.log.  &lt;/p&gt;

&lt;p&gt;&quot;will&quot; -&amp;gt; &quot;will by default&quot; &lt;br/&gt;
&quot;Users&quot; -&amp;gt; &quot;users&quot;&lt;/p&gt;

&lt;p&gt;Maybe add a sentence: &quot;It is also possible to get thread dump and&lt;br/&gt;
diagnostic information&quot; of errors with lower severity by adjusting a&lt;br/&gt;
property&quot;.&lt;/p&gt;

&lt;p&gt;&amp;gt; Symptoms Seen by Applications Affected by&lt;br/&gt;
&amp;gt; Change&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; If errors have error severity level greater or equal than value&lt;br/&gt;
&amp;gt; derby.stream.error.extendedDiagSeverityLevel is set, thread dump&lt;br/&gt;
&amp;gt; information and extened diagnostic information will be handle by&lt;br/&gt;
&amp;gt; Derby. Users can find thread dump information on derby.log. For ibm&lt;br/&gt;
&amp;gt; jvm users, a javacore file will be created.&lt;/p&gt;

&lt;p&gt;I am not sure this content is correct for this section: The &quot;symptom&quot;&lt;br/&gt;
if any of existing systems would be that we don&apos;t get (or there is not&lt;br/&gt;
way to get ) enough state information when the system crashes or a&lt;br/&gt;
session level error happens.&lt;/p&gt;

&lt;p&gt;&amp;gt; Incompatibilities with Previous Release&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; N/A &lt;/p&gt;

&lt;p&gt;&quot;N/A -&amp;gt; None  &lt;/p&gt;

&lt;p&gt;I think &quot;none&quot; is better here, since incompatibilities is always a&lt;br/&gt;
relevant (&quot;applicable&quot;) question for database changes.&lt;/p&gt;

&lt;p&gt;&amp;gt; Rationale for Change&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; The change intend to get more detail information relate to the staus&lt;/p&gt;

&lt;p&gt;&quot;The change intend&quot; -&amp;gt; The intention of the change&lt;br/&gt;
&quot;staus&quot; -&amp;gt; status&lt;/p&gt;

&lt;p&gt;&amp;gt; of Derby server when user hit system crash or server session error.&lt;/p&gt;

&lt;p&gt;&quot;Derby server&quot; -&amp;gt; This applies to embedded usages as well? (i.e. not&lt;br/&gt;
limited to running with client/server. If so, maybe you can just use&lt;br/&gt;
&quot;Derby&quot; instead.&lt;/p&gt;

&lt;p&gt;&amp;gt; Application Changes Required&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Users do not need to change anything for this change. If more thread&lt;br/&gt;
&amp;gt; dump information requires for error is has severity level less than&lt;/p&gt;

&lt;p&gt;&quot;requires&quot; -&amp;gt; &quot;is required&quot;&lt;br/&gt;
&quot;is has&quot; -&amp;gt; that have&quot;&lt;/p&gt;

&lt;p&gt;&amp;gt; session error, derby.stream.error.extendedDiagSeverityLevel can be&lt;/p&gt;

&lt;p&gt;Specify scope (database or system level) of property and whether it is&lt;br/&gt;
a dynamic or static property.&lt;/p&gt;

&lt;p&gt;&amp;gt; set on derby.properties or as part of jvm argument. For example, if&lt;/p&gt;

&lt;p&gt;&quot;on derby.properties&quot; -&amp;gt; in the file &quot;derby.properties&quot;&lt;br/&gt;
&quot;jvm&quot; -&amp;gt; &quot;JVM&quot;&lt;/p&gt;

&lt;p&gt;&amp;gt; there is a deadlock issue and users would like to see thread dump&lt;br/&gt;
&amp;gt; information while deadlock is happening. Users can then set&lt;/p&gt;

&lt;p&gt;2nd &quot;deadlock&quot; above -&amp;gt; &quot;the deadlock&quot;&lt;/p&gt;

&lt;p&gt;&quot;. Users&quot; -&amp;gt; &quot;, users&quot;&lt;/p&gt;

&lt;p&gt;&amp;gt; derby.stream.error.extendedDiagSeverityLevel=30000 on either&lt;/p&gt;

&lt;p&gt;&quot;on&quot; -&amp;gt; &quot;in&quot;&lt;/p&gt;

&lt;p&gt;&amp;gt; derby.properties or as part of jvm argument.&lt;/p&gt;

&lt;p&gt;&quot;jvm argument&quot; -&amp;gt; &quot;JVM argument, e.g. -Dderby.stream.error.extendedDiagSeverityLevel=30000&quot;&lt;/p&gt;


&lt;p&gt;&amp;gt; They can find the tread dump information on derby.log.&lt;/p&gt;

&lt;p&gt;Change to &quot;The thread dump information is found in the Derby error&lt;br/&gt;
log, typically this is the file &quot;derby.log&quot;.&lt;/p&gt;


&lt;p&gt;&amp;gt; derby.stream.error.extendedDiagSeverityLevel=30000 means&lt;br/&gt;
&amp;gt; turn on TRANSACTION_SEVERITY type of error.&lt;/p&gt;

&lt;p&gt;last line -&amp;gt; &quot;that the extended thread dump information for errors of&lt;br/&gt;
transaction severity or higher. Please consult the Derby documentation for explanation of error severity and for&lt;br/&gt;
other possible settings of extendedDiagSeverityLevel.&lt;/p&gt;</comment>
                            <comment id="12988348" author="lilywei" created="Sat, 29 Jan 2011 01:09:41 +0000"  >&lt;p&gt;Thanks for the reviewing the release notes, Dag!!!&lt;/p&gt;

&lt;p&gt;Caveat, my comments below are not based on a thorough knowledge of &lt;br/&gt;
this new feature, I have just read about if cursorily, so if I got my &lt;br/&gt;
fact wrong, please forgive. Mostly, my change proposals are for &lt;br/&gt;
improved legibility. &lt;br/&gt;
You are so kind. I really appreciated. &lt;br/&gt;
My comments are as follow:&lt;/p&gt;

&lt;p&gt;&amp;gt; Summary of Change &lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Derby will dump as much thread dump and diagnostic information as &lt;br/&gt;
&amp;gt; possible on system crash or session error. i.e. Users will find &lt;br/&gt;
&amp;gt; thread dump information with error severity higher than session &lt;br/&gt;
&amp;gt; error in derby.log. &lt;/p&gt;

&lt;p&gt;&quot;will&quot; -&amp;gt; &quot;will by default&quot; &lt;br/&gt;
&quot;Users&quot; -&amp;gt; &quot;users&quot; &lt;br/&gt;
These have been changed.&lt;/p&gt;

&lt;p&gt;Maybe add a sentence: &quot;It is also possible to get thread dump and &lt;br/&gt;
diagnostic information&quot; of errors with lower severity by adjusting a &lt;br/&gt;
property&quot;. &lt;br/&gt;
I think I did this. However, if it still need adjustment, please just let me knows.&lt;/p&gt;

&lt;p&gt;&amp;gt; Symptoms Seen by Applications Affected by &lt;br/&gt;
&amp;gt; Change &lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; If errors have error severity level greater or equal than value &lt;br/&gt;
&amp;gt; derby.stream.error.extendedDiagSeverityLevel is set, thread dump &lt;br/&gt;
&amp;gt; information and extened diagnostic information will be handle by &lt;br/&gt;
&amp;gt; Derby. Users can find thread dump information on derby.log. For ibm &lt;br/&gt;
&amp;gt; jvm users, a javacore file will be created. &lt;/p&gt;

&lt;p&gt;I am not sure this content is correct for this section: The &quot;symptom&quot; &lt;br/&gt;
if any of existing systems would be that we don&apos;t get (or there is not &lt;br/&gt;
way to get ) enough state information when the system crashes or a &lt;br/&gt;
session level error happens. &lt;br/&gt;
I am not sure about the content either. However, for this version, I decide to have the description here.&lt;br/&gt;
If users only view this section of release note, it might be good to have the information here too.&lt;/p&gt;

&lt;p&gt;&amp;gt; Incompatibilities with Previous Release &lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; N/A &lt;/p&gt;

&lt;p&gt;&quot;N/A -&amp;gt; None &lt;br/&gt;
I changed this to &quot;None&quot;.&lt;/p&gt;

&lt;p&gt;I think &quot;none&quot; is better here, since incompatibilities is always a &lt;br/&gt;
relevant (&quot;applicable&quot;) question for database changes. &lt;br/&gt;
+1&lt;/p&gt;

&lt;p&gt;&amp;gt; Rationale for Change &lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; The change intend to get more detail information relate to the staus &lt;/p&gt;

&lt;p&gt;&quot;The change intend&quot; -&amp;gt; The intention of the change &lt;br/&gt;
&quot;staus&quot; -&amp;gt; status &lt;/p&gt;

&lt;p&gt;&amp;gt; of Derby server when user hit system crash or server session error. &lt;/p&gt;

&lt;p&gt;&quot;Derby server&quot; -&amp;gt; This applies to embedded usages as well? (i.e. not &lt;br/&gt;
limited to running with client/server. If so, maybe you can just use &lt;br/&gt;
&quot;Derby&quot; instead. &lt;br/&gt;
These have been changed.&lt;/p&gt;



&lt;p&gt;&amp;gt; Application Changes Required &lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Users do not need to change anything for this change. If more thread &lt;br/&gt;
&amp;gt; dump information requires for error is has severity level less than &lt;/p&gt;

&lt;p&gt;&quot;requires&quot; -&amp;gt; &quot;is required&quot; &lt;br/&gt;
&quot;is has&quot; -&amp;gt; that have&quot; &lt;/p&gt;

&lt;p&gt;&amp;gt; session error, derby.stream.error.extendedDiagSeverityLevel can be &lt;/p&gt;

&lt;p&gt;Specify scope (database or system level) of property and whether it is &lt;br/&gt;
a dynamic or static property. &lt;/p&gt;

&lt;p&gt;&amp;gt; set on derby.properties or as part of jvm argument. For example, if &lt;/p&gt;

&lt;p&gt;&quot;on derby.properties&quot; -&amp;gt; in the file &quot;derby.properties&quot; &lt;br/&gt;
&quot;jvm&quot; -&amp;gt; &quot;JVM&quot; &lt;/p&gt;

&lt;p&gt;&amp;gt; there is a deadlock issue and users would like to see thread dump &lt;br/&gt;
&amp;gt; information while deadlock is happening. Users can then set &lt;/p&gt;

&lt;p&gt;2nd &quot;deadlock&quot; above -&amp;gt; &quot;the deadlock&quot; &lt;/p&gt;

&lt;p&gt;&quot;. Users&quot; -&amp;gt; &quot;, users&quot; &lt;/p&gt;

&lt;p&gt;&amp;gt; derby.stream.error.extendedDiagSeverityLevel=30000 on either &lt;/p&gt;

&lt;p&gt;&quot;on&quot; -&amp;gt; &quot;in&quot; &lt;/p&gt;

&lt;p&gt;&amp;gt; derby.properties or as part of jvm argument. &lt;/p&gt;

&lt;p&gt;&quot;jvm argument&quot; -&amp;gt; &quot;JVM argument, e.g. -Dderby.stream.error.extendedDiagSeverityLevel=30000&quot; &lt;/p&gt;


&lt;p&gt;&amp;gt; They can find the tread dump information on derby.log. &lt;/p&gt;

&lt;p&gt;Change to &quot;The thread dump information is found in the Derby error &lt;br/&gt;
log, typically this is the file &quot;derby.log&quot;. &lt;/p&gt;


&lt;p&gt;&amp;gt; derby.stream.error.extendedDiagSeverityLevel=30000 means &lt;br/&gt;
&amp;gt; turn on TRANSACTION_SEVERITY type of error. &lt;/p&gt;

&lt;p&gt;last line -&amp;gt; &quot;that the extended thread dump information for errors of &lt;br/&gt;
transaction severity or higher. Please consult the Derby documentation for explanation of error severity and for &lt;br/&gt;
other possible settings of extendedDiagSeverityLevel.&lt;/p&gt;

&lt;p&gt;These have been changed. &lt;/p&gt;</comment>
                            <comment id="12989253" author="dagw" created="Tue, 1 Feb 2011 15:39:19 +0000"  >&lt;p&gt;Some further legibility improvement suggestions:&lt;/p&gt;

&lt;p&gt;&amp;gt; Summary of Change&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Derby will by default dump as much thread dump and diagnostic&lt;br/&gt;
&amp;gt; information as possible on system crash or session error.&lt;br/&gt;
&amp;gt; i.e. users will find thread dump information with error severity&lt;br/&gt;
&amp;gt; higher than session error in derby.log.&lt;/p&gt;

&lt;p&gt;Possible improvement:&lt;/p&gt;

&lt;p&gt;On experiencing a system crash or session error, Derby will print as&lt;br/&gt;
much diagnostic information as possible to the Derby error log,&lt;br/&gt;
including stack traces of all threads.&lt;/p&gt;


&lt;p&gt;&amp;gt; It is also possible to get thread dump and diagnostic information of&lt;br/&gt;
&amp;gt; errors with lower severity by adjusting a property.&lt;/p&gt;

&lt;p&gt;This one is good, maybe change &quot;of&quot; to &quot;for&quot;,&lt;/p&gt;

&lt;p&gt;&amp;gt; Symptoms Seen by Applications Affected by Change &lt;/p&gt;

&lt;p&gt;&amp;gt; If errors have error severity level greater or equal than value&lt;br/&gt;
&amp;gt; derby.stream.error.extendedDiagSeverityLevel is set, thread dump&lt;br/&gt;
&amp;gt; information and extened diagnostic information will be handle by&lt;br/&gt;
&amp;gt; Derby. Users can find thread dump information in derby.log. For ibm&lt;br/&gt;
&amp;gt; JVM users, a javacore file will be created.&lt;/p&gt;

&lt;p&gt;I still feel this information belongs in the first section, and that&lt;br/&gt;
this section should be N/A. I agree this is useful &lt;/p&gt;

&lt;p&gt;&quot;handle&quot; -&amp;gt; &quot;printed&quot;&lt;br/&gt;
&quot;in derby.log&quot; -&amp;gt; &quot;in the Derby error log&quot;&lt;/p&gt;

&lt;p&gt;ibm -&amp;gt; IBM &lt;/p&gt;

&lt;p&gt;&amp;gt; Incompatibilities with Previous Release&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; None&lt;/p&gt;

&lt;p&gt;&amp;gt; Rationale for Change&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; The intention of the change to get more detail information relate to&lt;/p&gt;

&lt;p&gt;&quot;relate&quot; -&amp;gt; &quot;related&quot;&lt;/p&gt;

&lt;p&gt;&amp;gt; the status of Derby when user hit system crash or server session&lt;br/&gt;
&amp;gt; error.  &lt;/p&gt;

&lt;p&gt;Suggest_&lt;/p&gt;

&lt;p&gt;&quot;the status of Derby when important errors happen, &quot;important&quot; by&lt;br/&gt;
default meaning errors with session severity and higher. This will&lt;br/&gt;
help users, DBAs and support personnel to determine the exact cause of&lt;br/&gt;
the error condition.&quot;&lt;/p&gt;


&lt;p&gt;&amp;gt; Application Changes Required&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Users do not need to change anything for this change. If more thread&lt;br/&gt;
&amp;gt; dump information is required for error that have severity level less&lt;br/&gt;
&amp;gt; than session error, derby.stream.error.extendedDiagSeverityLevel can&lt;/p&gt;

&lt;p&gt;&quot;derby.stream.error.extendedDiagSeverityLevel&quot; -&amp;gt;&lt;br/&gt;
&quot;the property derby.stream.error.extendedDiagSeverityLevel&quot;&lt;/p&gt;

&lt;p&gt;&amp;gt; be set in the file &quot;derby.properties&quot; or as part of the JVM&lt;br/&gt;
&amp;gt; argument. &lt;/p&gt;

&lt;p&gt;In stead of specifying &quot;derby.properties&quot; or JVM argument here,&lt;br/&gt;
wouldn&apos;t it be better to just state this is a Derby system property&lt;br/&gt;
and give a link to the documentation? System wide properties can also&lt;br/&gt;
be set programmatically. You could also say, here as an example, &quot;for&lt;br/&gt;
example, in derby.properties&quot; but not try to enumerate all ways it can&lt;br/&gt;
be set.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://db.apache.org/derby/docs/10.7/devguide/cdevsetprop16827.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/10.7/devguide/cdevsetprop16827.html&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;&amp;gt; For example, if there is a deadlock issue and users would&lt;br/&gt;
&amp;gt; like to see thread dump information while the deadlock is happening,&lt;br/&gt;
&amp;gt; users can then set&lt;br/&gt;
&amp;gt; derby.stream.error.extendedDiagSeverityLevel=30000 in the file&lt;br/&gt;
&amp;gt; &quot;derby.properties&quot; or as part of JVM argument,&lt;br/&gt;
&amp;gt; e.g. -Dderby.stream.error.extendedDiagSeverityLevel=30000.&lt;/p&gt;

&lt;p&gt;See above comment, drop how to to set it here altogether, just show&lt;br/&gt;
the value required.&lt;/p&gt;

&lt;p&gt;&amp;gt; The thread dump information is found in the Derby error log,&lt;/p&gt;

&lt;p&gt;&quot;The thread dump information&quot; -&amp;gt;&lt;br/&gt;
&quot;The diagnostics and the thread dump information&quot;&lt;/p&gt;

&lt;p&gt;&amp;gt; typically this is the file &quot;derby.log&quot;.&lt;/p&gt;

&lt;p&gt;&amp;gt; derby.stream.error.extendedDiagSeverityLevel=30000&lt;br/&gt;
&amp;gt; means turn on TRANSACTION_SEVERITY type of error that the extended&lt;br/&gt;
&amp;gt; thread dump information for errors of transaction severity or&lt;br/&gt;
&amp;gt; higher. &lt;/p&gt;

&lt;p&gt;Suggest:&lt;/p&gt;

&lt;p&gt;&quot;derby.stream.error.extendedDiagSeverityLevel=30000 means that extra&lt;br/&gt;
diagnostics and thread dump will be activated for errors with&lt;br/&gt;
severity equal to og higher than transaction severity (30000).&quot;&lt;/p&gt;

&lt;p&gt;&amp;gt; Please consult the Derby documentation for explanation of error&lt;br/&gt;
&amp;gt; severity and for other possible settings of&lt;br/&gt;
&amp;gt; extenedDiagSeverityLevel.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Dag&lt;/p&gt;</comment>
                            <comment id="12989819" author="lilywei" created="Wed, 2 Feb 2011 21:58:37 +0000"  >&lt;p&gt;Thanks Dag for reviewing in such details. I feel I shall help more on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4741&quot; title=&quot;Make embedded Derby work reliably in the presence of thread interrupts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4741&quot;&gt;&lt;del&gt;DERBY-4741&lt;/del&gt;&lt;/a&gt; since you help me so much. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Some further legibility improvement suggestions: &lt;/p&gt;

&lt;p&gt;&amp;gt; Summary of Change &lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Derby will by default dump as much thread dump and diagnostic &lt;br/&gt;
&amp;gt; information as possible on system crash or session error. &lt;br/&gt;
&amp;gt; i.e. users will find thread dump information with error severity &lt;br/&gt;
&amp;gt; higher than session error in derby.log. &lt;/p&gt;

&lt;p&gt;Possible improvement: &lt;/p&gt;

&lt;p&gt;On experiencing a system crash or session error, Derby will print as &lt;br/&gt;
much diagnostic information as possible to the Derby error log, &lt;br/&gt;
including stack traces of all threads. &lt;br/&gt;
&amp;gt;&amp;gt;I change to reflect the suggestion.&lt;/p&gt;

&lt;p&gt;&amp;gt; It is also possible to get thread dump and diagnostic information of &lt;br/&gt;
&amp;gt; errors with lower severity by adjusting a property. &lt;/p&gt;

&lt;p&gt;This one is good, maybe change &quot;of&quot; to &quot;for&quot;, &lt;br/&gt;
&amp;gt;&amp;gt;Thanks. Done!&lt;/p&gt;

&lt;p&gt;&amp;gt; Symptoms Seen by Applications Affected by Change &lt;/p&gt;

&lt;p&gt;&amp;gt; If errors have error severity level greater or equal than value &lt;br/&gt;
&amp;gt; derby.stream.error.extendedDiagSeverityLevel is set, thread dump &lt;br/&gt;
&amp;gt; information and extened diagnostic information will be handle by &lt;br/&gt;
&amp;gt; Derby. Users can find thread dump information in derby.log. For ibm &lt;br/&gt;
&amp;gt; JVM users, a javacore file will be created. &lt;/p&gt;

&lt;p&gt;I still feel this information belongs in the first section, and that &lt;br/&gt;
this section should be N/A. I agree this is useful &lt;/p&gt;

&lt;p&gt;&quot;handle&quot; -&amp;gt; &quot;printed&quot; &lt;br/&gt;
&quot;in derby.log&quot; -&amp;gt; &quot;in the Derby error log&quot; &lt;/p&gt;

&lt;p&gt;ibm -&amp;gt; IBM&lt;br/&gt;
&amp;gt;&amp;gt;I see your point. I still feel it does not hurt to be here for users who only view this section for release note.&lt;/p&gt;

&lt;p&gt;&amp;gt; Incompatibilities with Previous Release &lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; None &lt;/p&gt;

&lt;p&gt;&amp;gt; Rationale for Change &lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; The intention of the change to get more detail information relate to &lt;/p&gt;

&lt;p&gt;&quot;relate&quot; -&amp;gt; &quot;related&quot; &lt;br/&gt;
&amp;gt;&amp;gt;Done.&lt;/p&gt;

&lt;p&gt;&amp;gt; the status of Derby when user hit system crash or server session &lt;br/&gt;
&amp;gt; error. &lt;/p&gt;

&lt;p&gt;Suggest_ &lt;/p&gt;

&lt;p&gt;&quot;the status of Derby when important errors happen, &quot;important&quot; by &lt;br/&gt;
default meaning errors with session severity and higher. This will &lt;br/&gt;
help users, DBAs and support personnel to determine the exact cause of &lt;br/&gt;
the error condition.&quot; &lt;br/&gt;
&amp;gt;&amp;gt;I change the release note to reflect to the suggestion.&lt;/p&gt;


&lt;p&gt;&amp;gt; Application Changes Required &lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Users do not need to change anything for this change. If more thread &lt;br/&gt;
&amp;gt; dump information is required for error that have severity level less &lt;br/&gt;
&amp;gt; than session error, derby.stream.error.extendedDiagSeverityLevel can &lt;/p&gt;

&lt;p&gt;&quot;derby.stream.error.extendedDiagSeverityLevel&quot; -&amp;gt; &lt;br/&gt;
&quot;the property derby.stream.error.extendedDiagSeverityLevel&quot; &lt;/p&gt;

&lt;p&gt;&amp;gt; be set in the file &quot;derby.properties&quot; or as part of the JVM &lt;br/&gt;
&amp;gt; argument. &lt;/p&gt;

&lt;p&gt;In stead of specifying &quot;derby.properties&quot; or JVM argument here, &lt;br/&gt;
wouldn&apos;t it be better to just state this is a Derby system property &lt;br/&gt;
and give a link to the documentation? System wide properties can also &lt;br/&gt;
be set programmatically. You could also say, here as an example, &quot;for &lt;br/&gt;
example, in derby.properties&quot; but not try to enumerate all ways it can &lt;br/&gt;
be set. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://db.apache.org/derby/docs/10.7/devguide/cdevsetprop16827.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/10.7/devguide/cdevsetprop16827.html&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;Thank you so much for the link. I was trying find the link and add it to it. The users will see the link in this releaseNote.html.&lt;/p&gt;

&lt;p&gt;&amp;gt; For example, if there is a deadlock issue and users would &lt;br/&gt;
&amp;gt; like to see thread dump information while the deadlock is happening, &lt;br/&gt;
&amp;gt; users can then set &lt;br/&gt;
&amp;gt; derby.stream.error.extendedDiagSeverityLevel=30000 in the file &lt;br/&gt;
&amp;gt; &quot;derby.properties&quot; or as part of JVM argument, &lt;br/&gt;
&amp;gt; e.g. -Dderby.stream.error.extendedDiagSeverityLevel=30000. &lt;/p&gt;

&lt;p&gt;See above comment, drop how to to set it here altogether, just show &lt;br/&gt;
the value required. &lt;/p&gt;

&lt;p&gt;&amp;gt; The thread dump information is found in the Derby error log, &lt;/p&gt;

&lt;p&gt;&quot;The thread dump information&quot; -&amp;gt; &lt;br/&gt;
&quot;The diagnostics and the thread dump information&quot; &lt;/p&gt;

&lt;p&gt;&amp;gt; typically this is the file &quot;derby.log&quot;. &lt;/p&gt;

&lt;p&gt;&amp;gt; derby.stream.error.extendedDiagSeverityLevel=30000 &lt;br/&gt;
&amp;gt; means turn on TRANSACTION_SEVERITY type of error that the extended &lt;br/&gt;
&amp;gt; thread dump information for errors of transaction severity or &lt;br/&gt;
&amp;gt; higher. &lt;/p&gt;

&lt;p&gt;Suggest: &lt;/p&gt;

&lt;p&gt;&quot;derby.stream.error.extendedDiagSeverityLevel=30000 means that extra &lt;br/&gt;
diagnostics and thread dump will be activated for errors with &lt;br/&gt;
severity equal to og higher than transaction severity (30000).&quot; &lt;br/&gt;
&amp;gt;&amp;gt;The change is reflected to the suggestion.  &lt;/p&gt;

&lt;p&gt;&amp;gt; Please consult the Derby documentation for explanation of error &lt;br/&gt;
&amp;gt; severity and for other possible settings of &lt;br/&gt;
&amp;gt; extenedDiagSeverityLevel. &lt;/p&gt;</comment>
                            <comment id="13000819" author="knutanders" created="Tue, 1 Mar 2011 10:31:25 +0000"  >&lt;p&gt;Attaching an updated release note.&lt;/p&gt;

&lt;p&gt;Made the summary a one-liner (&quot;Improved error diagnostics on system crashes and session errors&quot;) so that it fits nicely into the short list of changes. The extra information contained in the original summary was incorporated into the other sections.&lt;/p&gt;</comment>
                            <comment id="13000926" author="rhillegas" created="Tue, 1 Mar 2011 15:52:24 +0000"  >&lt;p&gt;Adjust the release note.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12681947">DERBY-6426</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12496860">DERBY-4986</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12491936">DERBY-4929</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12465136" name="ContextManager.java" size="17279" author="lilywei" created="Thu, 2 Dec 2010 14:44:08 +0000"/>
                            <attachment id="12465029" name="DERBY-4856-part_1_1a.diff" size="13974" author="lilywei" created="Wed, 1 Dec 2010 06:20:46 +0000"/>
                            <attachment id="12465358" name="DERBY-4856_part_2_2a.diff" size="16114" author="lilywei" created="Mon, 6 Dec 2010 03:07:10 +0000"/>
                            <attachment id="12465733" name="DERBY-4856_part_2_2b.diff" size="14966" author="lilywei" created="Tue, 7 Dec 2010 21:19:22 +0000"/>
                            <attachment id="12466358" name="DERBY-4856_part_3_1a.diff" size="7884" author="lilywei" created="Thu, 16 Dec 2010 01:05:56 +0000"/>
                            <attachment id="12467023" name="DERBY-4856_part_3_2a.diff" size="29203" author="lilywei" created="Tue, 28 Dec 2010 01:02:54 +0000"/>
                            <attachment id="12467239" name="DERBY-4856_part_3_3a.diff" size="28324" author="lilywei" created="Fri, 31 Dec 2010 22:49:52 +0000"/>
                            <attachment id="12467362" name="DERBY-4856_part_3_3b.diff" size="23616" author="lilywei" created="Mon, 3 Jan 2011 20:56:42 +0000"/>
                            <attachment id="12467521" name="DERBY-4856_part_3_3c.diff" size="27523" author="lilywei" created="Wed, 5 Jan 2011 06:28:52 +0000"/>
                            <attachment id="12467592" name="DERBY-4856_part_3_3d.diff" size="28601" author="lilywei" created="Wed, 5 Jan 2011 22:31:17 +0000"/>
                            <attachment id="12467978" name="DERBY-4856_part_3_3e.diff" size="57102" author="lilywei" created="Tue, 11 Jan 2011 06:28:35 +0000"/>
                            <attachment id="12468074" name="DERBY-4856_part_3_3g.diff" size="57580" author="lilywei" created="Tue, 11 Jan 2011 23:09:50 +0000"/>
                            <attachment id="12468284" name="DERBY-4856_part_3_3g_1a.diff" size="1192" author="lilywei" created="Thu, 13 Jan 2011 19:34:17 +0000"/>
                            <attachment id="12468330" name="DERBY-4856_part_3_3g_2a.diff" size="1470" author="lilywei" created="Fri, 14 Jan 2011 01:34:48 +0000"/>
                            <attachment id="12458976" name="corruptdb.zip" size="59242" author="kmarsden" created="Sat, 6 Nov 2010 00:28:33 +0000"/>
                            <attachment id="12459765" name="derby-4856-1a.diff" size="16213" author="lilywei" created="Wed, 17 Nov 2010 03:58:49 +0000"/>
                            <attachment id="12459766" name="derby.log" size="27104" author="lilywei" created="Wed, 17 Nov 2010 03:58:49 +0000"/>
                            <attachment id="12472319" name="releaseNote.html" size="4801" author="rhillegas" created="Tue, 1 Mar 2011 15:52:24 +0000"/>
                            <attachment id="12472297" name="releaseNote.html" size="5676" author="knutanders" created="Tue, 1 Mar 2011 10:31:25 +0000"/>
                            <attachment id="12470073" name="releaseNote.html" size="5442" author="lilywei" created="Wed, 2 Feb 2011 21:58:37 +0000"/>
                            <attachment id="12469723" name="releaseNote.html" size="5259" author="lilywei" created="Sat, 29 Jan 2011 01:09:41 +0000"/>
                            <attachment id="12469692" name="releaseNote.html" size="4767" author="lilywei" created="Fri, 28 Jan 2011 17:11:48 +0000"/>
                            <attachment id="12469616" name="releaseNote.html" size="4854" author="lilywei" created="Fri, 28 Jan 2011 01:38:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Oct 2010 18:35:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24498</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0gnb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36515</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>