<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:45:32 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3964/DERBY-3964.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3964] NullPointerException when re-evaluating generated column during ON DELETE SET NULL referential action</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3964</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Cf repro RegenerateAfterOnDeleteSetNullError.java enclosed.&lt;/p&gt;

&lt;p&gt;1) test_1(org.apache.derbyTesting.functionTests.tests.lang.RegenerateAfterOnDeleteSetNullError)java.sql.SQLException: The exception &apos;java.lang.NullPointerException&apos; was thrown while evaluating an expression.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:223)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:398)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2201)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1323)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(EmbedStatement.java:175)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.RegenerateAfterOnDeleteSetNullError.test_1(RegenerateAfterOnDeleteSetNullError.java:60)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:105)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
Caused by: java.sql.SQLException: The exception &apos;java.lang.NullPointerException&apos; was thrown while evaluating an expression.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)&lt;br/&gt;
	... 31 more&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:244)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)&lt;br/&gt;
	... 29 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.BaseActivation.getColumnFromRow(BaseActivation.java:1451)&lt;br/&gt;
	at org.apache.derby.exe.ac30fbc0bbx011dxd4a8x4baexffffd28a99d54.e5(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:149)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.NoRowsResultSetImpl.evaluateGenerationClauses(NoRowsResultSetImpl.java:623)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.UpdateResultSet.collectAffectedRows(UpdateResultSet.java:451)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.DeleteCascadeResultSet.collectAffectedRows(DeleteCascadeResultSet.java:195)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.DeleteCascadeResultSet.open(DeleteCascadeResultSet.java:120)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:297)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)&lt;br/&gt;
	... 24 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12409207">DERBY-3964</key>
            <summary>NullPointerException when re-evaluating generated column during ON DELETE SET NULL referential action</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Nov 2008 17:21:02 +0000</created>
                <updated>Thu, 13 Jan 2011 17:50:58 +0000</updated>
                            <resolved>Wed, 3 Dec 2008 22:52:43 +0000</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12652456" author="rhillegas" created="Tue, 2 Dec 2008 18:54:50 +0000"  >&lt;p&gt;Attaching derby-3964-01-aa-onDeleteSetNull.diff. This patch fixes the NPE triggered when a primary key deletion cascades changes to a foreign key table. Tests are running.&lt;/p&gt;

&lt;p&gt;Here&apos;s what was going on:&lt;/p&gt;

&lt;p&gt;o The cascaded change translated into an UPDATE on the foreign key table.&lt;/p&gt;

&lt;p&gt;o During the cascaded change, generation clauses were being evaluated on the pre-images of columns as well as on the after images in the UPDATE row.&lt;/p&gt;

&lt;p&gt;o The pre-image referred to a ResultSet whose row was not available at execution time.&lt;/p&gt;

&lt;p&gt;o That triggered the NPE.&lt;/p&gt;

&lt;p&gt;The fix was to eliminate the useless evaluation of the generation clause on the pre-image of the column.&lt;/p&gt;


&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/compile/DMLModStatementNode.java&lt;/p&gt;

&lt;p&gt;The code-generation of generation clauses is changed to only build code for after images. This involves adding an argument to generateGenerationClauses(), flagging whether the statement is an UPDATE.&lt;/p&gt;


&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/compile/UpdateNode.java&lt;br/&gt;
M      java/engine/org/apache/derby/impl/sql/compile/InsertNode.java&lt;/p&gt;

&lt;p&gt;Adds the extra argument to the callers of generateGenerationClauses.&lt;/p&gt;


&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/GeneratedColumnsTest.java&lt;/p&gt;

&lt;p&gt;Adds a test case.&lt;/p&gt;</comment>
                            <comment id="12652525" author="rhillegas" created="Tue, 2 Dec 2008 21:44:55 +0000"  >&lt;p&gt;Tests passed cleanly for me on derby-3964-01-aa-onDeleteSetNull.diff except for the heisenbug in the stress multi tests. Committed at subversion revision 722623.&lt;/p&gt;</comment>
                            <comment id="12669137" author="jrgchip" created="Sat, 31 Jan 2009 03:02:36 +0000"  >&lt;p&gt;I cannot tell from this report which versions it occurs in nor which it is fixed in.&lt;/p&gt;

&lt;p&gt;I also need to know whether it could be the same as the error I am incurring in both v10.3.3.0 and v10.4.2.0 (but not v10.3.2.1).&lt;/p&gt;

&lt;p&gt;It is an error in which I incur a NullPointerException trying to delete a row from a table with ON DELETE referential actions (though not a SET NULL action).  The error is exemplified by the following sequence in IJ:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; delete from app.&quot;LineItem&quot; where &quot;Id&quot; = 60275;&lt;br/&gt;
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
ij&amp;gt; select * from app.&quot;LineItem&quot; where &quot;Id&quot; = 60275;&lt;br/&gt;
ERROR 08003: No current connection.&lt;/p&gt;

&lt;p&gt;The LineItem table has the following constraints:&lt;br/&gt;
  ALTER TABLE &quot;APP&quot;.&quot;LineItem&quot; ADD CONSTRAINT &quot;LineItem_FK_OrderId&quot; FOREIGN KEY (&quot;OrderId&quot;) REFERENCES &quot;APP&quot;.&quot;Order&quot; (&quot;Id&quot;) ON DELETE CASCADE ON UPDATE NO ACTION;&lt;br/&gt;
  ALTER TABLE &quot;APP&quot;.&quot;LineItem&quot; ADD CONSTRAINT &quot;LineItem_FK_ProductId&quot; FOREIGN KEY (&quot;ProductId&quot;) REFERENCES &quot;APP&quot;.&quot;Product&quot; (&quot;Id&quot;) ON DELETE RESTRICT ON UPDATE NO ACTION;&lt;/p&gt;</comment>
                            <comment id="12669173" author="knutanders" created="Sat, 31 Jan 2009 10:54:42 +0000"  >&lt;p&gt;(Setting affects-version and fix-version to 10.5.0.0.)&lt;/p&gt;

&lt;p&gt;Chip,&lt;/p&gt;

&lt;p&gt;As I understand this bug, it only affects a new feature in 10.5 (generated columns), so I think you must be seeing something else. Just a guess, but it looks similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2353&quot; title=&quot;intermittent NPEs during DELETE ops in a reasonably large transaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2353&quot;&gt;&lt;del&gt;DERBY-2353&lt;/del&gt;&lt;/a&gt; (at least if you happen to run with derby.language.logQueryPlan=true). There should be a stack trace for the NullPointerException in derby.log which could give a clue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12312855">DERBY-481</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12394667" name="RegenerateAfterOnDeleteSetNullError.java" size="2270" author="dagw" created="Tue, 25 Nov 2008 17:23:38 +0000"/>
                            <attachment id="12395112" name="derby-3964-01-aa-onDeleteSetNull.diff" size="7510" author="rhillegas" created="Tue, 2 Dec 2008 18:54:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 2 Dec 2008 18:54:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23945</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0non:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37655</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>