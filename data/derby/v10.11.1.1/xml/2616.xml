<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:31:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2616/DERBY-2616.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2616] intermittent network startup related errors in running junit nightly test suite</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2616</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I intermitently get network startup related errors in running the nightly full test suite on my laptop, running XP, with a firewall and a VPN - I am not sure what if any of those environmental factors is causing it.  I have been mostly ignoring the errors as it seemed like it usually was only one test.  I my latest run it was more like 7 or 8.  I&apos;ll append exact tests as a comment on this issue.&lt;/p&gt;

&lt;p&gt;To debug the problem I picked one -     org.apache.derbyTesting.functionTests.tests.derbynet.NSSecurityMechanismTest &lt;br/&gt;
and ran it in a loop.  When I did this it failed everytime after the first one (and the first one  intermittently failed).  When I bumped the  WAIT_TIME  up to 300000  and the SLEEP_TIME to 500 in&lt;br/&gt;
java/testing/org/apache/derbyTesting/junit/NetworkServerTestSetup.java  then the test passed everytime .  In 30 runs the&lt;br/&gt;
entire test took  varying times from 2 minutes to 6 minutes, mostly in the 4 minute range.&lt;/p&gt;
</description>
                <environment>m1_ibm15:220&amp;gt;sysinfo&lt;br/&gt;
------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.5.0&lt;br/&gt;
Java Vendor:     IBM Corporation&lt;br/&gt;
Java home:       c:\p4\m1\ibm15\jre&lt;br/&gt;
Java classpath:  c:/p4/m1/classes;c:/p4/m1/tools/java/jdbctests.zip;c:/p4/m1/too&lt;br/&gt;
ls/java/jakarta-oro-2.0.8.jar;c:/p4/m1/tools/java/jgl3.1.0.jar;c:/p4/m1/tools/ja&lt;br/&gt;
va/jndi/providerutil.jar;c:/p4/m1/tools/java/jndi/ldap.jar;c:/p4/m1/tools/java/j&lt;br/&gt;
ndi/jndi.jar;c:/p4/m1/tools/java/jnl1.0F.zip;c:/p4/m1/tools/java/junit.jar;c:/p4&lt;br/&gt;
/m1/tools/java/servlet-2_2b.jar;c:/p4/m1/tools/java/xslt4j-2_5_0/xercesImpl.jar;&lt;br/&gt;
c:/p4/m1/tools/java/xslt4j-2_5_0/xml-apis.jar;c:/p4/m1/tools/java/xslt4j-2_5_0/x&lt;br/&gt;
alan.jar&lt;br/&gt;
OS name:         Windows XP&lt;br/&gt;
OS architecture: x86&lt;br/&gt;
OS version:      5.1 build 2600 Service Pack 2&lt;br/&gt;
Java user name:  mikem&lt;br/&gt;
Java user home:  C:\Documents and Settings\Administrator&lt;br/&gt;
Java user dir:   C:\mikem\_tools&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
java.specification.version: 1.5&lt;br/&gt;
--------- Derby Information --------</environment>
        <key id="12368720">DERBY-2616</key>
            <summary>intermittent network startup related errors in running junit nightly test suite</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikem">Mike Matrigali</assignee>
                                    <reporter username="mikem">Mike Matrigali</reporter>
                        <labels>
                    </labels>
                <created>Sat, 5 May 2007 18:47:24 +0100</created>
                <updated>Mon, 29 Jun 2009 23:42:49 +0100</updated>
                            <resolved>Fri, 25 May 2007 18:46:23 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12493887" author="mikem" created="Sat, 5 May 2007 19:01:54 +0100"  >&lt;p&gt;I noticed that netstat -a reported a lot of  ports for the server were in TIME_WAIT, and I found that default TIME_WAIT on XP&lt;br/&gt;
is 240 seconds.  I also found the following on the net about TIME_WAIT and am wondering if either the test or the server&lt;br/&gt;
is forcing a artificially small port space and thus causing this wait time:&lt;/p&gt;

&lt;p&gt;TIME_WAIT is an integral part of TCP&apos;s correctness algorithms. It is&lt;br/&gt;
there to protect new connections by the same &quot;name&quot; from inadvertently&lt;br/&gt;
accepting segments from old connections and thus corrupting data.&lt;/p&gt;

&lt;p&gt;Strictly speaking, TIME_WAIT is supposed to last as long as four&lt;br/&gt;
minutes, so the connection rate that could result in attempts to reuse&lt;br/&gt;
a TCP connection name (local/remote IP, local/remote port) that is&lt;br/&gt;
still in TIME_WAIT would be:&lt;/p&gt;

&lt;p&gt;sizeof(portspace)/240&lt;/p&gt;

&lt;p&gt;If your client application is allowing the stack to pick the local&lt;br/&gt;
port number (eg is not calling bind() to pick a port number itself),&lt;br/&gt;
then likely as not, the range of ports it gets will be 49152 to 65535&lt;br/&gt;
or ~16384 port numbers:&lt;/p&gt;

&lt;p&gt;16384/240&lt;/p&gt;

&lt;p&gt;or 68 connections per second.&lt;/p&gt;

&lt;p&gt;The best &quot;fix&quot; is to get your applications to use long-lived TCP&lt;br/&gt;
connections. The next best fix after that is to broaden the number of&lt;br/&gt;
ports (and perhaps IP addresses) involved. One way to do that is to&lt;br/&gt;
have the application attempt to bind() to port numbers in the range of&lt;br/&gt;
day 5000 to 65535. That would increase the rate before attempted&lt;br/&gt;
TIME_WAIT reuse to&lt;/p&gt;

&lt;p&gt;65000/240&lt;/p&gt;

&lt;p&gt;or ~270 connections per second.&lt;/p&gt;

&lt;p&gt;You could achieve similar results by spreading the traffic across a&lt;br/&gt;
larger number of IP addresses - on the client, the server, or both.&lt;/p&gt;

&lt;p&gt;A much more distant fourth option is to decrease the length of TIME_WAIT to&lt;br/&gt;
say 60 seconds (math left as an excercise to the reader &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;However, you should &quot;never&quot; take steps to make there be no TIME_WAIT&lt;br/&gt;
state at all, such as using an &quot;abortive&quot; close.&lt;/p&gt;</comment>
                            <comment id="12493888" author="mikem" created="Sat, 5 May 2007 19:05:01 +0100"  >&lt;p&gt;Here are test failures I believe are related to not enough time waiting for network server to start:&lt;/p&gt;

&lt;p&gt;1) DerbyNetNewServer(org.apache.derbyTesting.functionTests.tests.derbynet.NetHar&lt;br/&gt;
nessJavaTest)junit.framework.ComparisonFailure: Output at line 2 expected:&amp;lt;Testi&lt;br/&gt;
ng null PrintWriter&amp;gt; but was:&amp;lt;Server shutdown failed: DRDA_NoIO.S:Could not conn&lt;br/&gt;
ect to Derby Network Server on host 127.0.0.1, port 1527.&amp;gt;&lt;br/&gt;
    at org.apache.derbyTesting.functionTests.util.CanonTestCase.compareCanon(Can&lt;br/&gt;
onTestCase.java:100)&lt;br/&gt;
    at org.apache.derbyTesting.functionTests.util.HarnessJavaTest.runTest(Harnes&lt;br/&gt;
sJavaTest.java:90)&lt;br/&gt;
    at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
2) testclientij(org.apache.derbyTesting.functionTests.tests.derbynet.NetIjTest)j&lt;br/&gt;
unit.framework.AssertionFailedError: Timed out waiting for network server to sta&lt;br/&gt;
rt&lt;br/&gt;
    at org.apache.derbyTesting.junit.NetworkServerTestSetup.waitForServerStart(N&lt;br/&gt;
etworkServerTestSetup.java:281)&lt;br/&gt;
    at org.apache.derbyTesting.junit.NetworkServerTestSetup.setUp(NetworkServerT&lt;br/&gt;
estSetup.java:116)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:18)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
3) testNetworkServerSecurityMechanism(org.apache.derbyTesting.functionTests.test&lt;br/&gt;
s.derbynet.NSSecurityMechanismTest)junit.framework.AssertionFailedError: Timed o&lt;br/&gt;
ut waiting for network server to start&lt;br/&gt;
    at org.apache.derbyTesting.junit.NetworkServerTestSetup.waitForServerStart(N&lt;br/&gt;
etworkServerTestSetup.java:281)&lt;br/&gt;
    at org.apache.derbyTesting.functionTests.tests.derbynet.NSSecurityMechanismT&lt;br/&gt;
est.setSecurityMechanism(NSSecurityMechanismTest.java:415)&lt;br/&gt;
    at org.apache.derbyTesting.functionTests.tests.derbynet.NSSecurityMechanismT&lt;br/&gt;
est.testNetworkServerSecurityMechanism(NSSecurityMechanismTest.java:323)&lt;br/&gt;
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java&lt;br/&gt;
:64)&lt;br/&gt;
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorI&lt;br/&gt;
mpl.java:43)&lt;br/&gt;
    at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
5) DriverTestjunit.framework.AssertionFailedError: Timed out waiting for network&lt;br/&gt;
 server to start&lt;br/&gt;
    at org.apache.derbyTesting.junit.NetworkServerTestSetup.waitForServerStart(N&lt;br/&gt;
etworkServerTestSetup.java:281)&lt;br/&gt;
    at org.apache.derbyTesting.junit.NetworkServerTestSetup.setUp(NetworkServerT&lt;br/&gt;
estSetup.java:116)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:18)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
6) DataSourceReferenceTest:clientjunit.framework.AssertionFailedError: Timed out&lt;br/&gt;
 waiting for network server to start&lt;br/&gt;
    at org.apache.derbyTesting.junit.NetworkServerTestSetup.waitForServerStart(N&lt;br/&gt;
etworkServerTestSetup.java:281)&lt;br/&gt;
    at org.apache.derbyTesting.junit.NetworkServerTestSetup.setUp(NetworkServerT&lt;br/&gt;
estSetup.java:116)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:18)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
7) ImportExportTest:clientjunit.framework.AssertionFailedError: Timed out waitin&lt;br/&gt;
g for network server to start&lt;br/&gt;
    at org.apache.derbyTesting.junit.NetworkServerTestSetup.waitForServerStart(N&lt;br/&gt;
etworkServerTestSetup.java:281)&lt;br/&gt;
    at org.apache.derbyTesting.junit.NetworkServerTestSetup.setUp(NetworkServerT&lt;br/&gt;
estSetup.java:116)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:18)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
8) ImportExportProcedureTestjunit.framework.AssertionFailedError: extinout\t1.da&lt;br/&gt;
t&lt;br/&gt;
    at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDir(DropDatabaseSet&lt;br/&gt;
up.java:129)&lt;br/&gt;
    at org.apache.derbyTesting.junit.DropDatabaseSetup.access$000(DropDatabaseSe&lt;br/&gt;
tup.java:38)&lt;br/&gt;
    at org.apache.derbyTesting.junit.DropDatabaseSetup$1.run(DropDatabaseSetup.j&lt;br/&gt;
ava:104)&lt;br/&gt;
    at java.security.AccessController.doPrivileged(AccessController.java:193)&lt;br/&gt;
    at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDirectory(DropDatab&lt;br/&gt;
aseSetup.java:101)&lt;br/&gt;
    at org.apache.derbyTesting.junit.SupportFilesSetup.tearDown(SupportFilesSetu&lt;br/&gt;
p.java:127)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:20)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;/p&gt;</comment>
                            <comment id="12493896" author="mikem" created="Sun, 6 May 2007 00:25:47 +0100"  >&lt;p&gt;535572 checkin fixes this problem for my test running.&lt;/p&gt;

&lt;p&gt;Increase the maximum wait time for tests that start the server.  On my&lt;br/&gt;
windows XP system I would get intermittent failures at the old 60 second&lt;br/&gt;
max.  I believe the issue is turnaround time on the port, rather than a&lt;br/&gt;
specific startup issue in the code.  Setting the max to 300 seconds allowed&lt;br/&gt;
me to pass a complete nightly test and also passed a reiterated test 30 times&lt;br/&gt;
that would previously fail every time at the 60 second level.&lt;/p&gt;</comment>
                            <comment id="12509304" author="djd" created="Sat, 30 Jun 2007 18:05:18 +0100"  >&lt;p&gt;I think the real cause of the failure to start the network server is &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1966&quot; title=&quot;NetworkServer startup can take 50+ seconds if a client holds an open connection to the previous server booted within the same vm&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1966&quot;&gt;DERBY-1966&lt;/a&gt; and not related to windows or firewalls.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12353342">DERBY-1966</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 30 Jun 2007 17:05:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23132</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0wbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39056</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>