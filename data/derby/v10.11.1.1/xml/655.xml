<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:47:49 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-655/DERBY-655.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-655] getImportedKeys returns duplicate rows in some cases</title>
                <link>https://issues.apache.org/jira/browse/DERBY-655</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I have a database with a large number of tables.  I get duplicate rows when I call DatabaseMetaData.getImportedKeys for a particular table. However, if I create the same table with same number of foreign keys in another database (which has fewer number of tables), then getImportedKeys returns me the correct number of rows. This error seems to happen only when the database has a large number of tables. I will attach a repro for this shortly. &lt;/p&gt;</description>
                <environment>Sun JDK 1.4.2, Windows XP</environment>
        <key id="12325084">DERBY-655</key>
            <summary>getImportedKeys returns duplicate rows in some cases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="deepa">Deepa Remesh</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Oct 2005 02:18:01 +0100</created>
                <updated>Tue, 18 Jun 2013 17:15:09 +0100</updated>
                            <resolved>Fri, 30 Jun 2006 10:53:05 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12356103" author="deepa" created="Fri, 28 Oct 2005 02:22:25 +0100"  >&lt;p&gt;Attaching a repro for this. To see the problem:&lt;/p&gt;

&lt;p&gt;1. Start ij and run bigdb.sql and smalldb.sql. It will create 2 databases bigdb and smalldb. Since it takes a while to run the sql, I will also attach a zip file with the databases already created. &lt;br/&gt;
2. Run &quot;java keys smalldb&quot;. Call to getImportedKeys for the table &apos;ACCCMDGRP&apos; returns 2 rows, which is correct.&lt;br/&gt;
3. Run &quot;java keys bigdb&quot;. Call to getImportedKeys for the table &apos;ACCCMDGRP&apos; returns 3 rows instead of 2. In the output, rows 2 and 3 are duplicates.&lt;/p&gt;</comment>
                            <comment id="12356104" author="deepa" created="Fri, 28 Oct 2005 02:24:42 +0100"  >&lt;p&gt;Attaching a zip file with the databases&lt;/p&gt;</comment>
                            <comment id="12412003" author="mamtas" created="Wed, 17 May 2006 00:08:56 +0100"  >&lt;p&gt;I was able to reduce the test case provided to following set of sql which will reproduce the erroneous behavior in Derby 10.0.&lt;br/&gt;
CREATE TABLE t1(c11_ID BIGINT NOT NULL);&lt;br/&gt;
CREATE TABLE t2 (c21_ID BIGINT NOT NULL primary key);&lt;br/&gt;
ALTER TABLE t1 ADD CONSTRAINT F_12 Foreign Key (c11_ID)&lt;br/&gt;
   REFERENCES t2 (c21_ID) ON DELETE CASCADE ON UPDATE NO ACTION;&lt;br/&gt;
CREATE TABLE t3(c31_ID BIGINT NOT NULL primary key);&lt;br/&gt;
ALTER TABLE t2 ADD CONSTRAINT F_443 Foreign Key (c21_ID)&lt;br/&gt;
   REFERENCES t3(c31_ID) ON DELETE CASCADE ON UPDATE NO ACTION;&lt;/p&gt;

&lt;p&gt;If DatabaseMetaData.getImportedKeys  is run against table t1, Derby 10.0 will run 2 rows and Cloudscape 5.2 will run 1 row. &lt;/p&gt;</comment>
                            <comment id="12413282" author="mamtas" created="Fri, 26 May 2006 02:13:21 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-655&quot; title=&quot;getImportedKeys returns duplicate rows in some cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-655&quot;&gt;&lt;del&gt;DERBY-655&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1343&quot; title=&quot;It is possible to have duplicate entries in conglomerateId of sysconglomerates before DERBY-655 was fixed in 10.0 or 10.1 databases. It is desirable to patch these databases on upgrade to 10.2 so conglomerateId becomes unique again.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1343&quot;&gt;&lt;del&gt;DERBY-1343&lt;/del&gt;&lt;/a&gt; are both exhibiting for the same reason. For performance reasons, duplicate indexes share the same physical conglomerate and that is represented by SYSCONGLOMERATES.CONGLOMERATENUMBER. But such duplicate indexes should have unique logical conglomerate associated with them, represented by SYSCONGLOMERATES.CONGLOMERATEID. This does not happen and hence there is no way to tell the 2 duplicate indexes apart from each other in SYSCONGLOMERATES table. The fix for this is in 2 parts&lt;br/&gt;
1)All the future duplicate indexes should have unique logical conglomerate assoicated with them.&lt;br/&gt;
2)All the existing duplicate indexes should be fixed to have unique logical conglomerate during the database upgrade phase.&lt;br/&gt;
More information on this bug can be found at &lt;a href=&quot;http://www.nabble.com/-Derby-655-+:+getImportedKeys+returns+duplicate+rows+in+some+cases-t1673189.html#a4535887&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/-Derby-655-+:+getImportedKeys+returns+duplicate+rows+in+some+cases-t1673189.html#a4535887&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12413352" author="mamtas" created="Fri, 26 May 2006 12:37:55 +0100"  >&lt;p&gt;Attaching patch for the first part of the solution, which is to generate unique logical conglomerates for duplicate indexes. Also, I tried my patch against &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1343&quot; title=&quot;It is possible to have duplicate entries in conglomerateId of sysconglomerates before DERBY-655 was fixed in 10.0 or 10.1 databases. It is desirable to patch these databases on upgrade to 10.2 so conglomerateId becomes unique again.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1343&quot;&gt;&lt;del&gt;DERBY-1343&lt;/del&gt;&lt;/a&gt; and this patch takes care of part 1 of that bug too. &lt;br/&gt;
Derby655GetImportedKeysPatch1.txt is the actual patch and Derby655GetImportedKeysStat1.txt is svn stat output for the patch.&lt;/p&gt;

&lt;p&gt;This patch is for 10.0 codeline. Same fix needs to be put in to all the subsequent codelines. Do I need to submit separate patches for 10.1 and 10.2 codelines? Can a commiter see if the patch looks good and can be checked in?&lt;/p&gt;</comment>
                            <comment id="12413392" author="bandaram" created="Fri, 26 May 2006 15:48:10 +0100"  >&lt;p&gt;Submitted this patch. Normally would have asked if you really have an itch to see this fix in 10.0, but since this problem potentially leaves system tables in confusing state, I have merged this into 10.0.&lt;/p&gt;

&lt;p&gt;Sending        java\engine\org\apache\derby\impl\sql\execute\CreateIndexConstantAction.java&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\DerbyNet\metadata.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\metadata.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\jdbcapi\metadata.java&lt;br/&gt;
Transmitting file data ....&lt;br/&gt;
Committed revision 409580.&lt;/p&gt;</comment>
                            <comment id="12413394" author="bandaram" created="Fri, 26 May 2006 16:00:51 +0100"  >&lt;p&gt;I tried merging this fix to 10.1 branch, but there are conflicts with test changes. Can you submit a merged patch for both 10.1 and trunk?&lt;/p&gt;</comment>
                            <comment id="12413859" author="mamtas" created="Wed, 31 May 2006 01:32:09 +0100"  >&lt;p&gt;I tried doing merge on 10.1 codeline using following &lt;br/&gt;
svn merge -r 409579:409580 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/branches/10.0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/branches/10.0&lt;/a&gt;&lt;br/&gt;
and ran into problems with test file and master files changes. merge didn&apos;t work for test file changes because in 10.1, we have split metadata.java into 2 classes, metadata.java and metadata_test.java. The changes I made in 10.0 metadata.java need to go in 10.1 metadata_test.java. I fixed this by reverting the test file and master files from the merge command and hand-doiing the test changes. The diff for 10.1 is attached as Derby655GetImportedKeysPatch1Codeline101.txt to this JIRA entry. Let me know if a commiter runs into a problem. Next, I will work on getting a patch ready for main codeline. &lt;/p&gt;</comment>
                            <comment id="12413975" author="mamtas" created="Wed, 31 May 2006 12:46:17 +0100"  >&lt;p&gt;After submitting my earlier patch for 10.1, I ran the derbyall and found that there are few more masters that are getting impacted by changes to metadata_test.java. So, I am attaching a new diff file for 10.1 codeline, named Derby655GetImportedKeysPatch2Codeline101.txt(Commiters, please disregard Derby655GetImportedKeysPatch1Codeline101.txt) &lt;/p&gt;</comment>
                            <comment id="12414095" author="mamtas" created="Thu, 1 Jun 2006 00:51:52 +0100"  >&lt;p&gt;I have attached the patch for the main codeline to this JIRA entry as Derby655GetImportedKeysPatch1CodelineTrunk.txt. &lt;br/&gt;
The upgrade test Upgrade_10_1_10_2 is not included in this patch because the patch submitted for 10.1 first needs to go in and then the upgrade test will give the correct master diff. Without the 10.1 patch in, the 10.1 database is getting created with duplicate logical conglomerateids and hence, after the upgrade to 10.2, the database still contains duplicate rows and hence incorrect results. Once the patch for 10.1 goes in, the newly created 10.1 db will not have duplicate logical conglomerateids. The part 2 of the solution for this JIRA entry is not yet worked on. The part 2 is supposed to take care of duplicate logical conglomerate ids when a database is upgraded. &lt;/p&gt;

&lt;p&gt;Note to the committers : there are patches that need to be committed, one for 10.1 codeline and another for main codeline.&lt;/p&gt;</comment>
                            <comment id="12414558" author="bandaram" created="Sat, 3 Jun 2006 15:25:33 +0100"  >&lt;p&gt;This patch is committed to trunk and 10.1. Please RESOLVE and close accordingly.&lt;/p&gt;</comment>
                            <comment id="12414920" author="knutanders" created="Tue, 6 Jun 2006 15:33:35 +0100"  >&lt;p&gt;Mamta A. Satoor wrote:&lt;/p&gt;

&lt;p&gt;&amp;gt; The upgrade test Upgrade_10_1_10_2 is not included in this patch&lt;br/&gt;
&amp;gt; because the patch submitted for 10.1 first needs to go in and then&lt;br/&gt;
&amp;gt; the upgrade test will give the correct master diff. Without the 10.1&lt;br/&gt;
&amp;gt; patch in, the 10.1 database is getting created with duplicate&lt;br/&gt;
&amp;gt; logical conglomerateids and hence, after the upgrade to 10.2, the&lt;br/&gt;
&amp;gt; database still contains duplicate rows and hence incorrect&lt;br/&gt;
&amp;gt; results. Once the patch for 10.1 goes in, the newly created 10.1 db&lt;br/&gt;
&amp;gt; will not have duplicate logical conglomerateids.&lt;/p&gt;

&lt;p&gt;Does this mean that the upgrade test is going to fail until 10.1.3 is&lt;br/&gt;
released and the jars checked into the repository? If that&apos;s the case,&lt;br/&gt;
I think we should update the upgrade test canon temporarily now and&lt;br/&gt;
revert it once 10.1.3 is out. Ole&apos;s tinderbox test has failed since&lt;br/&gt;
the check-in of this patch.&lt;/p&gt;</comment>
                            <comment id="12414986" author="mamtas" created="Wed, 7 Jun 2006 00:26:53 +0100"  >&lt;p&gt;The part I of the fix has gone into all the 3 codelines but the upgrade test fails with duplicate row because the 10.1 jar used by the upgrade test does not yet have those changes. &lt;/p&gt;

&lt;p&gt;Seems like the 10.1 jar will get updated only when 10.1.3 wil be ready and hence I am attaching a patch (Derby655GetImportedKeysPatch1CodelineTrunkUpgradeTest.txt) with the duplicate row for the upgrade test until 10.1.3 jars are checked in. Can a committer please check in this change?&lt;/p&gt;</comment>
                            <comment id="12414987" author="mamtas" created="Wed, 7 Jun 2006 00:29:06 +0100"  >&lt;p&gt;The patch I submitted couple minutes back (Derby655GetImportedKeysPatch1CodelineTrunkUpgradeTest.txt) is for the main codeline. &lt;/p&gt;</comment>
                            <comment id="12415097" author="knutanders" created="Wed, 7 Jun 2006 16:02:17 +0100"  >&lt;p&gt;Thanks Mamta! Committed revision 412320.&lt;/p&gt;</comment>
                            <comment id="12418559" author="mamtas" created="Fri, 30 Jun 2006 10:53:05 +0100"  >&lt;p&gt;Resolving this issue since the patch ensures the uniqueness of conglomerateid for new conglomerates in SYSCONGLOMERATES table. For existing duplicate conglomeratid, work needs to be done at the database upgrade time. &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1343&quot; title=&quot;It is possible to have duplicate entries in conglomerateId of sysconglomerates before DERBY-655 was fixed in 10.0 or 10.1 databases. It is desirable to patch these databases on upgrade to 10.2 so conglomerateId becomes unique again.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1343&quot;&gt;&lt;del&gt;DERBY-1343&lt;/del&gt;&lt;/a&gt; is open to track upgrade work. As per my knowledge, nobody is working on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1343&quot; title=&quot;It is possible to have duplicate entries in conglomerateId of sysconglomerates before DERBY-655 was fixed in 10.0 or 10.1 databases. It is desirable to patch these databases on upgrade to 10.2 so conglomerateId becomes unique again.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1343&quot;&gt;&lt;del&gt;DERBY-1343&lt;/del&gt;&lt;/a&gt; at this point.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12508599">DERBY-5249</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12653491">DERBY-6269</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12343486">DERBY-1343</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12334592" name="Derby655GetImportedKeysPatch1.txt" size="4409" author="mamtas" created="Fri, 26 May 2006 12:37:55 +0100"/>
                            <attachment id="12334788" name="Derby655GetImportedKeysPatch1Codeline101.txt" size="4646" author="mamtas" created="Wed, 31 May 2006 01:32:09 +0100"/>
                            <attachment id="12334841" name="Derby655GetImportedKeysPatch1CodelineTrunk.txt" size="8788" author="mamtas" created="Thu, 1 Jun 2006 00:51:52 +0100"/>
                            <attachment id="12335096" name="Derby655GetImportedKeysPatch1CodelineTrunkUpgradeTest.txt" size="3544" author="mamtas" created="Wed, 7 Jun 2006 00:26:53 +0100"/>
                            <attachment id="12334815" name="Derby655GetImportedKeysPatch2Codeline101.txt" size="8768" author="mamtas" created="Wed, 31 May 2006 12:46:17 +0100"/>
                            <attachment id="12334593" name="Derby655GetImportedKeysStat1.txt" size="339" author="mamtas" created="Fri, 26 May 2006 12:37:55 +0100"/>
                            <attachment id="12320359" name="bigdb.sql" size="464876" author="deepa" created="Fri, 28 Oct 2005 02:22:25 +0100"/>
                            <attachment id="12320358" name="keys.java" size="2239" author="deepa" created="Fri, 28 Oct 2005 02:22:25 +0100"/>
                            <attachment id="12320361" name="keys_test.zip" size="1455666" author="deepa" created="Fri, 28 Oct 2005 02:24:42 +0100"/>
                            <attachment id="12320360" name="smalldb.sql" size="2181" author="deepa" created="Fri, 28 Oct 2005 02:22:25 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 May 2006 23:08:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22075</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0g47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36429</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>