<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:09:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5533/DERBY-5533.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5533] Client differs from embedded when rs.updateInt overflows: 22015 vs 22003</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5533</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;stm.executeUpdate(&quot;create table t(i smallint)&quot;);&lt;br/&gt;
stm.executeUpdate(&quot;insert into t values 1,2,3,4&quot;);&lt;/p&gt;

&lt;p&gt;ResultSet rs = stm.executeQuery(&quot;select i from t&quot;);&lt;/p&gt;

&lt;p&gt;rs.next();&lt;/p&gt;

&lt;p&gt;try &lt;/p&gt;
{
    rs.updateInt(1, 100000);
}
&lt;p&gt; catch (SQLException e) &lt;/p&gt;
{
    // client: 22015 vs embedded 22003
}

&lt;p&gt;According to the standard, 22015 should be used for INTERVALs (&quot;interval field overflow&quot;). 22003 seems more correct, the standard uses that for &quot;numeric value out of range&quot;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12534820">DERBY-5533</key>
            <summary>Client differs from embedded when rs.updateInt overflows: 22015 vs 22003</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                            <label>derby_backport_reject_10_8</label>
                    </labels>
                <created>Mon, 12 Dec 2011 19:04:18 +0000</created>
                <updated>Tue, 9 Jul 2013 15:09:48 +0100</updated>
                            <resolved>Sat, 17 Dec 2011 00:27:14 +0000</resolved>
                                                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>JDBC</component>
                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13167682" author="dagw" created="Mon, 12 Dec 2011 19:06:46 +0000"  >&lt;p&gt;The code generating 22015 in the client is LossOfPrecisionConversionException. I noticed this was unused in the regressions suite coverage, so presumably out JUnit&lt;br/&gt;
tests do not test this error condition, at least not on the client.&lt;/p&gt;</comment>
                            <comment id="13168062" author="dagw" created="Tue, 13 Dec 2011 02:07:09 +0000"  >&lt;p&gt;Uploading derby-5533-repro, which reproduces this in the form of a patch against jdbcapi.UpdateXXXTest. It tests all upper bounds checks needed for updateXXX in a new fixture.&lt;br/&gt;
In addition, lower bound checks should be added to it.&lt;/p&gt;

&lt;p&gt;LossOfPrecisionConversionException is also thrown from the methods CrossConverter#getXXXFromYYY, so that usage should be checked as well (probably also wrong).&lt;/p&gt;</comment>
                            <comment id="13168064" author="dagw" created="Tue, 13 Dec 2011 02:12:15 +0000"  >&lt;p&gt;Data point: changing the SQL state in LossOfPrecisionConversionException to 22003 makes the repro test pass. &lt;/p&gt;</comment>
                            <comment id="13168937" author="dagw" created="Wed, 14 Dec 2011 01:00:05 +0000"  >&lt;p&gt;Uploading derby-5522-test which extends the repro into a full fledged test of upper lower bound checking on the conversions in ResultSet#setXXX and #getXXX.&lt;/p&gt;

&lt;p&gt;I have checked that all usages of LossOfPrecisionConversionException is covered by these tests, so changing that exception should be safe.&lt;/p&gt;

&lt;p&gt;Up till now I have made this a patch of UpdateXXXTest, which may not be entirely suitable now that we&apos;re testing getXXX as well. Poked around, but found only ParameterMappingTest asserting against the SQL state 22003. Should I try to move these new tests over there, possibly make a new test, or just leave them inside UpdateXXXTest? &lt;/p&gt;</comment>
                            <comment id="13169349" author="rhillegas" created="Wed, 14 Dec 2011 13:41:27 +0000"  >&lt;p&gt;Thanks for the impressive battery of new tests, Dag! ParameterMappingTest doesn&apos;t have a header comment explaining its purpose in life, but it seems to try to run a comprehensive battery of tests against the getXXX() and setXXX() methods. UpdateXXXTest, according to its header comment, is a test for updatable ResultSets. If this fix is not specific to updatable ResultSets, ParameterMappingTest might be a better home for it. But I don&apos;t think it would hurt to leave the tests where you put them originally. Thanks!&lt;/p&gt;</comment>
                            <comment id="13169770" author="dagw" created="Wed, 14 Dec 2011 22:45:20 +0000"  >&lt;p&gt;Thanks, Rick. I decided to move them to ParameterMappingTest instead; only half the new tests concern updatable result sets, after all.&lt;/p&gt;

&lt;p&gt;Uploading patch derby-5533 with the tests and a fix which changes the class LossOfPrecisionConversionException to OutsideRangeForDataTypeException, wrapping 22003 and updates the usage sites, all of which are covered by the tests I believe. I also removed the old error 22015.S.1, which was only used by the client.&lt;/p&gt;

&lt;p&gt;Note: whereas the old error message indicated the &lt;b&gt;value&lt;/b&gt; that was out of range for the conversion, the 22003 erro rmessage shows the target type XXX for setXXX. However, for getXXX, the type given in the error message by the embedded driver not the target Java type (e.g. short in getShort), but the correspondig SQL type, i,e.. SMALLINT. I think this is the way it is because on the server, the same conversion methods are also used in CAST, where the target type is an SQL type, not a Java type. I chose to let the client use the same type strings as embedded does. If we want to improve on this later, we can do that for both drivers.&lt;/p&gt;

&lt;p&gt;Running regressions, please review.&lt;/p&gt;</comment>
                            <comment id="13170149" author="knutanders" created="Thu, 15 Dec 2011 12:02:04 +0000"  >&lt;p&gt;The patch looks good to me. +1&lt;/p&gt;</comment>
                            <comment id="13170303" author="dagw" created="Thu, 15 Dec 2011 15:53:18 +0000"  >&lt;p&gt;Thanks, Knut! Regressions passed, modulo &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1913&quot; title=&quot;storetests/st_reclaim_longcol.java fails intermittently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1913&quot;&gt;&lt;del&gt;DERBY-1913&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13171334" author="dagw" created="Sat, 17 Dec 2011 00:09:55 +0000"  >&lt;p&gt;Uploading a new version of the patch, &quot;derby-5513b&quot;. It adds more tests for the floating point types. This led to the posting of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5546&quot; title=&quot;ResultSet#updateBigDecimal on a REAL column does not do underflow checking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5546&quot;&gt;&lt;del&gt;DERBY-5546&lt;/del&gt;&lt;/a&gt;, too. The test has many test cases that should be fixed up when the follow-on issues (all linked to this issue) are fixed.&lt;/p&gt;</comment>
                            <comment id="13171363" author="dagw" created="Sat, 17 Dec 2011 00:25:58 +0000"  >&lt;p&gt;Committed version &quot;b&quot; of the patch as svn 1215365, resolving.&lt;/p&gt;</comment>
                            <comment id="13703304" author="kmarsden" created="Tue, 9 Jul 2013 15:09:48 +0100"  >&lt;p&gt;Label derby_backport_reject_10_8. Shouldn&apos;t backport SQLState change&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12534895">DERBY-5534</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12535050">DERBY-5536</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12535489">DERBY-5546</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12507210" name="derby-5533-repro.diff" size="6242" author="dagw" created="Tue, 13 Dec 2011 17:27:42 +0000"/>
                            <attachment id="12507275" name="derby-5533-test.diff" size="14285" author="dagw" created="Wed, 14 Dec 2011 01:00:05 +0000"/>
                            <attachment id="12507450" name="derby-5533.diff" size="57578" author="dagw" created="Wed, 14 Dec 2011 22:45:56 +0000"/>
                            <attachment id="12507451" name="derby-5533.stat" size="1207" author="dagw" created="Wed, 14 Dec 2011 22:45:56 +0000"/>
                            <attachment id="12507743" name="derby-5533b.diff" size="64328" author="dagw" created="Sat, 17 Dec 2011 00:09:55 +0000"/>
                            <attachment id="12507744" name="derby-5533b.stat" size="1207" author="dagw" created="Sat, 17 Dec 2011 00:09:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10367"><![CDATA[Deviation from standard]]></customfieldvalue>
    <customfieldvalue key="10363"><![CDATA[Embedded/Client difference]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 14 Dec 2011 13:41:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220504</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0edj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36147</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>