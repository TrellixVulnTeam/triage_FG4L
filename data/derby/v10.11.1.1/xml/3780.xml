<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:17:34 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3780/DERBY-3780.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3780] Run junit tests with -Dfile.encoding=&quot;UTF-16&quot; to expose encoding issues and analyze failures</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3780</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Wth sun jkd 1.5 and 1.6 you can run JUnit tests with -Dfile.encoding=&quot;UTF-16&quot; to help expose encoding issues with Derby and tests.    Run suites.All and analyze failures.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12400066">DERBY-3780</key>
            <summary>Run junit tests with -Dfile.encoding=&quot;UTF-16&quot; to expose encoding issues and analyze failures</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jul 2008 22:36:23 +0100</created>
                <updated>Mon, 4 May 2009 19:22:36 +0100</updated>
                            <resolved>Mon, 21 Jul 2008 21:40:31 +0100</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12614538" author="kmarsden" created="Thu, 17 Jul 2008 22:40:57 +0100"  >&lt;p&gt;Here are the unalyzed results of a run of suiltes.all with -Dfile.encoding=UTF-16.  Interestingly there are some failures that did not show up on Zos. Also attaching a utility ReadEncodedFile which I had to use to translate the UTF-16 output into the default encoding.&lt;/p&gt;

</comment>
                            <comment id="12614680" author="knutanders" created="Fri, 18 Jul 2008 10:30:45 +0100"  >&lt;p&gt;I haven&apos;t studied the results in detail, I just wanted to add that the file.encoding property is not a standard property, and it is meant to be a read-only property that tells you the default encoding. Since you&apos;re not supposed to change the property, some parts of the class library may use it to determine the default encoding, whereas others may use another way to find it. So some of the failures may be caused by the class library being confused and using the encoding inconsistently.&lt;/p&gt;

&lt;p&gt;Seems like you also ran out of perm gen space. Possibly because UTF-16 requires more space in many cases?&lt;/p&gt;</comment>
                            <comment id="12614799" author="kmarsden" created="Fri, 18 Jul 2008 18:14:54 +0100"  >&lt;p&gt;Thanks Knut for looking at this. Below is my analysis.&lt;/p&gt;

&lt;p&gt;--------------------------------------------------------------------------------------------&lt;br/&gt;
ClobTest,  BlobClob4Blob and LargeDataLocks tests assume length of string inserted into a binary column is equal to the length of the bytes that represent the string.  These did not fail on Zos because even though the values are different for EBCDIC, the alphabet characters still only take one byte.  The tests should be changed to not make this assumption.&lt;/p&gt;

&lt;p&gt;1) testGetCharacterStreamClobUpdates(org.apache.derbyTesting.functionTests.tests.jdbc4.ClobTest)java.sql.SQLException: The position argument &apos;53&apos; exceeds the size of the BLOB/CLOB.&lt;/p&gt;

&lt;p&gt;16) testPositionBlob(org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest)junit.framework.AssertionFailedError: FAIL - wrong match found for ??? starting at 52 and length of 3 expected:&amp;lt;57&amp;gt; but was:&amp;lt;-1&amp;gt;&lt;/p&gt;

&lt;p&gt;17) testGetBlobBeforeAndAfterUpdate(org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest)junit.framework.AssertionFailedError: FAIL - wrong blob value&lt;/p&gt;

&lt;p&gt;18) testGetBlobBeforeAndAfterUpdateStream(org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest)junit.framework.AssertionFailedError: FAIL - wrong blob value&lt;/p&gt;

&lt;p&gt;19) testPositionBytes(org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest)junit.framework.AssertionFailedError: FAIL - wrong match found for ? starting at 40 and length of 1 expected:&amp;lt;62&amp;gt; but was:&amp;lt;47&amp;gt;&lt;/p&gt;

&lt;p&gt;20) testPositionBlob(org.apache.derbyTesting.functionTests.tests.jdbcapi.Blob&lt;br/&gt;
Clob4BlobTest)junit.framework.AssertionFailedError: FAIL - wrong match found for ????????? starting at 38 and length of 9 expected:&amp;lt;39&amp;gt; but was:&amp;lt;-1&amp;gt;&lt;/p&gt;

&lt;p&gt;27) testGetBytes(org.apache.derbyTesting.functionTests.tests.jdbcapi.LargeDataLocksTest)junit.framework.AssertionFailedError: expected:&amp;lt;38000&amp;gt; but was:&amp;lt;76002&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.LargeDataLocksTest.te&lt;/p&gt;

&lt;p&gt;26) testGetBinaryStream(org.apache.derbyTesting.functionTests.tests.jdbcapi.LargeDataLocksTest)junit.framew&lt;br/&gt;
ork.AssertionFailedError: expected:&amp;lt;38000&amp;gt; but was:&amp;lt;76002&amp;gt;&lt;br/&gt;
------------------------------------------------------------------------&lt;br/&gt;
File not imported with US-ASCII codeset. Test needs to be fixed.&lt;/p&gt;

&lt;p&gt;30) testEarlyEndOfFile(org.apache.derbyTesting.functionTests.tests.tools.ImportExportTest)junit.framework.ComparisonFailure: Unexpected SQL state. expected:&amp;lt;XIE0E&amp;gt; but was:&amp;lt;42X04&amp;gt;&lt;br/&gt;
--------------------------------------------------------------------&lt;br/&gt;
Tests that spawn processes that don&apos;t have the same file.encoding.  Can&apos;t really fix this without passing the file.encoding on to the spawned process which we probably don&apos;t want to do since it is not a standard property.&lt;/p&gt;

&lt;p&gt;2) SecureServerTest( Opened = false, Authenticated= false, CustomDerbyProperties= null, WildCardHost= null )junit.framework.AssertionFailedError: SecureServerTest( Opened = false, Authenticated= false, CustomDerbyProperties= null, WildCardHost= null )&lt;br/&gt;
Expected: Security manager installed using the Basic server security policy.&lt;br/&gt;
But saw: ????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????&lt;br/&gt;
----------------------------------------------------------------------------&lt;br/&gt;
Problem reading error log vti.  The support file is in ascii and the SYSCS_DIAG.ERROR_LOG_READER vti I think correctly reads in the default encoding, so I don&apos;t think this is a problem.  Not sure why this one didn&apos;t show up on Zos.&lt;/p&gt;


&lt;p&gt;13) testErrorLogReader(org.apache.derbyTesting.functionTests.tests.lang.SysDiagVTIMappingTest)junit.framework.AssertionFailedError: Unexpected row count: expected:&amp;lt;2&amp;gt; but was:&amp;lt;0&amp;gt;&lt;br/&gt;
---------------------------------------------------------------------------&lt;br/&gt;
Permgen Space errors and cascading DatabaseMetaDataTest failures.  This just occured because I forgot to up the Permgen space when running with the sun jvm.&lt;/p&gt;

&lt;p&gt;-------------------------------------------------------------------&lt;br/&gt;
Pemission errors getting context class loader in DropDatabaseTestSetup.  Not sure what could be causing this or even what test is causing the problem.  Maybe an encoding problem reading the policy file, but only a few tests seemed to have this problem.&lt;/p&gt;

&lt;p&gt;19) Encryption Algorithm: defaultjava.security.AccessControlException: access denied (java.lang.RuntimePermission getClassLoader)&lt;/p&gt;

&lt;p&gt;--------------------------------------------------------------------------------------------------------------------&lt;br/&gt;
In general the conclusion is running this way popped a few more test encoding issues and this is a nice trick to reproduce encoding issues on Windows with Sun JVM&apos;s (doesn&apos;t work with IBM jvms).  I don&apos;t see any product encoding issues.  Running with -Dfile.encoding=UTF-16  it is not really suitable for a nightly run, which I had hoped, because of the spawned processes and AccessControl exceptions.&lt;/p&gt;</comment>
                            <comment id="12614839" author="kmarsden" created="Fri, 18 Jul 2008 19:43:33 +0100"  >&lt;p&gt;Attached is a patch to fix the test encoding issues with&lt;br/&gt;
jdbc4/ClobTest.java&lt;br/&gt;
jdbcapi/LargeDataLocksTest.java&lt;br/&gt;
jdbcapi/BlobClob4BlobTest.java&lt;br/&gt;
tools/ImportExportTest.java&lt;/p&gt;</comment>
                            <comment id="12614887" author="knutanders" created="Fri, 18 Jul 2008 22:32:04 +0100"  >&lt;p&gt;The changes look good to me. You may want to change the code in the decorateSQL() method in LargeDataLocksTest so that the UnsupportedEncodingException is thrown, not just printed. decorateSQL() cannot throw other checked exceptions than SQLException, but you can use BaseTestCase.fail(String, Exception) to get around that problem.&lt;/p&gt;</comment>
                            <comment id="12615413" author="kmarsden" created="Mon, 21 Jul 2008 21:40:31 +0100"  >&lt;p&gt;Ran tests and found some test encoding issues which I corrected.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12386350" name="ReadEncodedFile.java" size="700" author="kmarsden" created="Thu, 17 Jul 2008 22:40:57 +0100"/>
                            <attachment id="12386425" name="derby-3780_diff.txt" size="9834" author="kmarsden" created="Fri, 18 Jul 2008 19:43:33 +0100"/>
                            <attachment id="12386349" name="suites_all_utf16.txt" size="680202" author="kmarsden" created="Thu, 17 Jul 2008 22:40:57 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Jul 2008 09:30:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30996</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0xif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39247</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>