<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:37:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4700/DERBY-4700.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4700] Add method to obtain a bogus port in TestConfiguration</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4700</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In some cases one needs to obtain a port number on which there is no Derby network server.&lt;br/&gt;
Today this is solved in an ad-hoc way, for instance by using the current port minus one. When running tests in parallel, there is a chance that a port where there actually is a Derby network server listening is picked.&lt;/p&gt;

&lt;p&gt;As a start, I suggest that the bogus port is allocated to the last port in the port range configured for the run: baseport + MAX_PORTS_USED -1.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466967">DERBY-4700</key>
            <summary>Add method to obtain a bogus port in TestConfiguration</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Jun 2010 07:27:16 +0100</created>
                <updated>Mon, 29 Nov 2010 14:21:07 +0000</updated>
                            <resolved>Tue, 13 Jul 2010 14:24:01 +0100</resolved>
                                    <version>10.7.1.1</version>
                                    <fixVersion>10.6.2.1</fixVersion>
                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12879031" author="knutanders" created="Tue, 15 Jun 2010 18:12:07 +0100"  >&lt;p&gt;Alternatively, we could initialize it using getNextAvailablePort() in TestConfiguration&apos;s constructor, similar to how we allocate the JMX port. Then we don&apos;t need extra logic in getNextAvailablePort() to prevent collisions with the last port in the allowed range.&lt;/p&gt;</comment>
                            <comment id="12879281" author="kristwaa" created="Wed, 16 Jun 2010 09:55:08 +0100"  >&lt;p&gt;Makes sense to follow an existing pattern. Note that there are eight constructors...&lt;br/&gt;
BTW, the extra logic for the other approach would be changing &apos;&amp;gt;&apos; to &apos;&amp;gt;=&apos; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;In a way we are wasting ports by allocating them even if they are not used, but I think it is better to allocate them early on for the sake of clarity.&lt;br/&gt;
Should we also add debug print outs for the additional ports (jmx and bogus) to aid debugging port conflicts?&lt;/p&gt;</comment>
                            <comment id="12883472" author="kristwaa" created="Tue, 29 Jun 2010 10:09:05 +0100"  >&lt;p&gt;First proposal for a patch, using the mechanism Knut mentioned above.&lt;/p&gt;

&lt;p&gt;Regression tests passed.&lt;br/&gt;
I haven&apos;t looked through the existing tests yet for more cases where a bogus port is used.&lt;br/&gt;
I&apos;m also considering adding a println-statement where we assign a bogus port (i.e. bogusPort = getNextAvailablePort()).&lt;/p&gt;</comment>
                            <comment id="12883573" author="dagw" created="Tue, 29 Jun 2010 15:57:30 +0100"  >&lt;p&gt;Looks good to me.  +1 I have no special concerns about adding an println. The way I understand it, it is there to aid test debugging.&lt;/p&gt;

&lt;p&gt;Nit: I&apos;d use the existing idiom for converting an int to String (in the changed line in NetworkServerControlClientCommandTest), since the same idiom is used elsewhere in that method.&lt;/p&gt;</comment>
                            <comment id="12884221" author="kristwaa" created="Thu, 1 Jul 2010 10:01:50 +0100"  >&lt;p&gt;Thanks, Dag.&lt;/p&gt;

&lt;p&gt;I have attached patch 1b, where I reverted to the idom used elsewhere (the &quot;&quot; + was just to shorten the line &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ), and I also added a println method in TestConfiguration (TC). Not quite sure about it yet, but it did at least made it clear to me that we are creating two TC instances - so we end up with two JMX ports and two bogus ports. I guess one is for the embedded configuration, the other for the client.&lt;/p&gt;

&lt;p&gt;Do we need a bogus port for an embedded TC?&lt;br/&gt;
What about a JMX port?&lt;/p&gt;

&lt;p&gt;I&apos;m a bit in a hurry right now, but will return to this later.&lt;/p&gt;</comment>
                            <comment id="12887358" author="kristwaa" created="Mon, 12 Jul 2010 13:25:14 +0100"  >&lt;p&gt;A comment from Dag, posted to derby-dev:&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&amp;gt; Do we need a bogus port for an embedded TC?&lt;br/&gt;
Well, I used one in the BootLockTest, for example (although Kathey has&lt;br/&gt;
later rewritten that test to work without ports), so I wouldn&apos;t rule&lt;br/&gt;
it a priori. I wasn&apos;t aware that we created two concurrent TCs either,&lt;br/&gt;
presumably they are used in sequence, so we don&apos;t &lt;b&gt;really&lt;/b&gt; need separate&lt;br/&gt;
port assignements for them?&lt;/p&gt;

&lt;p&gt;&amp;gt; What about a JMX port?&lt;br/&gt;
I think JMX is useful also for an embedded Derby, so we would want to&lt;br/&gt;
be able to test it.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Dag&lt;/p&gt;
&lt;hr /&gt;
</comment>
                            <comment id="12887754" author="kristwaa" created="Tue, 13 Jul 2010 14:24:00 +0100"  >&lt;p&gt;Committed patch 1a to trunk with revision 963705.&lt;br/&gt;
Backported to 10.6 with revision 963706.&lt;/p&gt;

&lt;p&gt;I don&apos;t expect more work on this issue.&lt;/p&gt;</comment>
                            <comment id="12888301" author="kristwaa" created="Wed, 14 Jul 2010 12:43:13 +0100"  >&lt;p&gt;Patch 2a makes the bogus port static, such that it is shared between all TestConfiguration instances in a VM. It also increases the max port count to 11 - we&apos;re already using that many ports so the next change that requires another alternative port will trigger the assert in getNextAvailablePort().&lt;/p&gt;

&lt;p&gt;Regression tests passed (traditional serial run).&lt;br/&gt;
Patch ready for review.&lt;br/&gt;
I do plan to commit this fix shortly to stop the tinderbox test from failing. I&apos;ll update the wiki page when I commit.&lt;/p&gt;</comment>
                            <comment id="12888471" author="kristwaa" created="Wed, 14 Jul 2010 19:19:43 +0100"  >&lt;p&gt;To stop the tinderbox from failing, I decided to commit patch 2a.&lt;br/&gt;
I increased the maximum number of ports to 20, and also updated the wiki.&lt;br/&gt;
This can be changed again if the discussion on derby-dev ends with a different conclusion.&lt;/p&gt;

&lt;p&gt;Committed to trunk with revision 964115, I will backport it to 10.6 tomorrow if there are no problems.&lt;/p&gt;</comment>
                            <comment id="12890200" author="kristwaa" created="Tue, 20 Jul 2010 08:13:21 +0100"  >&lt;p&gt;Backported patch 2a to 10.6 with revision 965737.&lt;br/&gt;
Closing issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12469643">DERBY-4747</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12448296" name="derby-4700-1a.diff" size="4310" author="kristwaa" created="Tue, 29 Jun 2010 10:09:05 +0100"/>
                            <attachment id="12448484" name="derby-4700-1b.diff" size="5202" author="kristwaa" created="Thu, 1 Jul 2010 10:01:50 +0100"/>
                            <attachment id="12449448" name="derby-4700-2a-static_bogus.diff" size="4012" author="kristwaa" created="Wed, 14 Jul 2010 12:43:13 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Jun 2010 17:12:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31335</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ovz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37850</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>