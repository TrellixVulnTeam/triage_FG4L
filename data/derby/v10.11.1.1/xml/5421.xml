<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:49:56 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5421/DERBY-5421.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5421] NullPointerException during system.nstest.utils.Dbutil.update_one_row</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5421</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The nstest - both embedded (on Windows XP) and client/server configuration (on SUSE Linux 10) ran into a NullPointerException during the call to update_one_row.&lt;br/&gt;
The test only ran for 5 days, vs. 10.8.1.2 8 days, and I&apos;ve never seen this error before:&lt;/p&gt;

&lt;p&gt;sample (console) output:&lt;br/&gt;
total memory: 20962816 free: 3036264 Wed Sep 14 00:28:00 PDT 2011&lt;br/&gt;
TObj --&amp;gt;NULL error message detected&lt;br/&gt;
TObj --&amp;gt;Here is the NULL exception - java.lang.NullPointerException&lt;br/&gt;
TObj --&amp;gt;Stack trace of the NULL exception - java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.utils.DbUtil.update_one_row(DbUtil.java:275)&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.tester.TesterObject.doIUDOperation(TesterObject.java:162)&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.tester.Tester2.startTesting(Tester2.java:109)&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.NsTest.run(NsTest.java:555)&lt;br/&gt;
TObj --&amp;gt;At this point - executing update_one_row, exception thrown was : null&lt;br/&gt;
TObj --&amp;gt;NULL error message detected&lt;br/&gt;
TObj --&amp;gt;Here is the NULL exception - java.lang.NullPointerException&lt;br/&gt;
TObj --&amp;gt;Stack trace of the NULL exception - java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.utils.DbUtil.update_one_row(DbUtil.java:275)&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.tester.TesterObject.doIUDOperation(TesterObject.java:162)&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.tester.Tester1.startTesting(Tester1.java:118)&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.NsTest.run(NsTest.java:551)&lt;br/&gt;
TObj --&amp;gt;At this point - executing update_one_row, exception thrown was : null&lt;/p&gt;

&lt;p&gt;Looking at the source of nstest.utils.DbUtil.update_one_row it&apos;s calling ps2.close():&lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
....&lt;br/&gt;
		column = colnames&lt;span class=&quot;error&quot;&gt;&amp;#91;ind % NUMTYPES&amp;#93;&lt;/span&gt;; // randomly gets one of the columns&lt;br/&gt;
		// of the table&lt;/p&gt;

&lt;p&gt;		try &lt;/p&gt;
{
			
			ps2 = conn.prepareStatement(&quot; update nstesttab set &quot; + column
					+ &quot; = ? &quot; + &quot; where serialkey = &quot; + skey);
			
		}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
			ps2.close();
			printException(
					&quot;closing update prepared stmt in dbUtil.update_one_row() &quot;,
					e);
			return rowsUpdated;
		}
&lt;p&gt;....&lt;br/&gt;
----------------------------&lt;/p&gt;

&lt;p&gt;At first glance, this seems a test issue, but I think it possible the test is hiding something more interesting, so I&apos;m not marking this as component &apos;test&apos;.&lt;/p&gt;</description>
                <environment>Windows XP (embedded), SUSE Linux (10) (client/server), both with ibm 1.6 SR9 FP1</environment>
        <key id="12523649">DERBY-5421</key>
            <summary>NullPointerException during system.nstest.utils.Dbutil.update_one_row</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Sep 2011 05:02:11 +0100</created>
                <updated>Mon, 17 Jun 2013 10:19:10 +0100</updated>
                            <resolved>Thu, 16 Feb 2012 20:37:09 +0000</resolved>
                                    <version>10.8.2.2</version>
                                    <fixVersion>10.8.2.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13108868" author="mamtas" created="Tue, 20 Sep 2011 19:02:12 +0100"  >&lt;p&gt;I did a quick glance at the code around the null pointer exception area nstest.utils.DbUtil.update_one_row(DbUtil.java:275) and found that in case of exception, we do following&lt;br/&gt;
	} catch (Exception e) {&lt;br/&gt;
		ps2.close();&lt;br/&gt;
		printException(&lt;br/&gt;
				&quot;closing update prepared stmt in dbUtil.update_one_row() &quot;,&lt;br/&gt;
				e);&lt;/p&gt;

&lt;p&gt;One definite improvement to the test would be to first print the exception and then do the ps2.close so we know what was the exact exception. But this is for future runs. Myrna I think already mentioned that when the test gets run next time, she will run it with more diagnostic properties like derby.language.logStatementText=true and derby.stream.error.logSeverityLevel=0&lt;/p&gt;</comment>
                            <comment id="13108887" author="rhillegas" created="Tue, 20 Sep 2011 19:17:07 +0100"  >&lt;p&gt;I agree with Kathey that this error may be fallout from an ungraceful recovery after the error seen in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5423&quot; title=&quot;ERROR X0Y84: Too  much contention on sequence NSTESTTAB in ns system test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5423&quot;&gt;&lt;del&gt;DERBY-5423&lt;/del&gt;&lt;/a&gt;. Setting derby.language.sequence.preallocator=200 may help this test run longer before it stumbles over too much contention on the identity column. That is not to say that we shouldn&apos;t add defensive logic to the test so that it recovers more gracefully.&lt;/p&gt;</comment>
                            <comment id="13109080" author="mamtas" created="Wed, 21 Sep 2011 00:20:20 +0100"  >&lt;p&gt;While we are at it, I think the defensive logic in DbUtil.update_one_row can look as follows&lt;br/&gt;
		try &lt;/p&gt;
{
			
			ps2 = conn.prepareStatement(&quot; update nstesttab set &quot; + column
					+ &quot; = ? &quot; + &quot; where serialkey = &quot; + skey);
			
		}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
			printException(
					&quot;closing update prepared stmt in dbUtil.update_one_row() &quot;,
					e);
			if (ps2 != null)
				ps2.close();
			return rowsUpdated;
		}

&lt;p&gt;With this change, even if ps2 is null for some reason, we would not run into NPE and the exception would be recorded for debugging. The similar error handling exists in DbUtil.pick_one.&lt;/p&gt;</comment>
                            <comment id="13109306" author="knutanders" created="Wed, 21 Sep 2011 07:54:10 +0100"  >&lt;p&gt;If the statement inside the try block raises an exception, ps2 is definitely going to be null in the catch block, so I&apos;d rather remove the closing altogether. Apart from that, the suggested changes sound good to me.&lt;/p&gt;</comment>
                            <comment id="13115124" author="myrna" created="Tue, 27 Sep 2011 02:44:58 +0100"  >&lt;p&gt;I was didn&apos;t notice this last comment, and have run a couple of days with every ps.close() in DbUtils.java framed by a if (ps != n ull)&lt;br/&gt;
   ps.close()&lt;br/&gt;
(or ps2, if that&apos;s what it was).&lt;/p&gt;

&lt;p&gt;This run showed a ton of 40001 errors  &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5428&quot; title=&quot;ns test error: ERROR 38000:  The exception &amp;#39;org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED Identity being changed on a live cacheable. Old uuidString = 846c00a0-0132-88d8-fec0-000000080920&amp;#39; was thrown while evaluating an expression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5428&quot;&gt;&lt;del&gt;DERBY-5428&lt;/del&gt;&lt;/a&gt; - not sure if that&apos;s what was going on before, but also further NullPointerExceptions like this:&lt;/p&gt;

&lt;p&gt;TObj --&amp;gt;Here is the NULL exception - java.lang.NullPointerException&lt;br/&gt;
TObj --&amp;gt;Stack trace of the NULL exception -&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.tester.TesterObject.doSelectOpe&lt;br/&gt;
ration(TesterObject.java:239)&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.tester.Tester1.startTesting(Tes&lt;br/&gt;
ter1.java:102)&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.NsTest.run(NsTest.java:551)&lt;br/&gt;
TObj --&amp;gt;At this point - processing ResultSet during row data retrieval, exceptio&lt;br/&gt;
n thrown was : null&lt;br/&gt;
--&amp;gt; Isolation Level is TRANSACTION_READ_UNCOMMITTED, hence SHOULD NOT FAIL *****&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;
			&lt;ul&gt;
				&lt;li&gt;doSelect in thread Tester1Thread 2 threw java.lang.NullPointerException&lt;br/&gt;
TObj --&amp;gt;NULL error message detected&lt;br/&gt;
TObj --&amp;gt;Here is the NULL exception - java.lang.NullPointerException&lt;br/&gt;
TObj --&amp;gt;Stack trace of the NULL exception -&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.tester.TesterObject.doSelectOpe&lt;br/&gt;
ration(TesterObject.java:298)&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.tester.Tester1.startTesting(Tes&lt;br/&gt;
ter1.java:102)&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.NsTest.run(NsTest.java:551)&lt;br/&gt;
TObj --&amp;gt;At this point - doSelectOperation(), exception thrown was : null&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.tester.TesterObject.doSelectOpe&lt;br/&gt;
ration(TesterObject.java:298)&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.tester.Tester1.startTesting(Tes&lt;br/&gt;
ter1.java:102)&lt;br/&gt;
        at org.apache.derbyTesting.system.nstest.NsTest.run(NsTest.java:551)&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13115127" author="myrna" created="Tue, 27 Sep 2011 02:46:25 +0100"  >&lt;p&gt;Attaching the (10.8 branch) diff of the change adding if (ps != nul) to every ps*.close() call.&lt;/p&gt;

&lt;p&gt;Not for commit.&lt;/p&gt;</comment>
                            <comment id="13117678" author="myrna" created="Thu, 29 Sep 2011 23:32:04 +0100"  >&lt;p&gt;Posting another patch, against 10.8 branch, which does away with all the ps*.closes, and also adds an if (rSet != null) to TesterObject.&lt;/p&gt;</comment>
                            <comment id="13117812" author="myrna" created="Fri, 30 Sep 2011 02:30:33 +0100"  >&lt;p&gt;committed patch &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5421&quot; title=&quot;NullPointerException during system.nstest.utils.Dbutil.update_one_row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5421&quot;&gt;&lt;del&gt;DERBY-5421&lt;/del&gt;&lt;/a&gt;_2.diff to 10.8 with revision 1177474 and merged it back up to trunk with revision  1177475.&lt;/p&gt;</comment>
                            <comment id="13119435" author="myrna" created="Mon, 3 Oct 2011 18:51:03 +0100"  >&lt;p&gt;I think the changes for this particular issue are complete.&lt;/p&gt;</comment>
                            <comment id="13685147" author="knutanders" created="Mon, 17 Jun 2013 10:19:10 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12523654">DERBY-5423</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12496617" name="DERBY-5421_1.diff" size="1490" author="myrna" created="Tue, 27 Sep 2011 02:46:25 +0100"/>
                            <attachment id="12497077" name="DERBY-5421_2.diff" size="8469" author="myrna" created="Thu, 29 Sep 2011 23:32:04 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 20 Sep 2011 18:02:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11494</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0dwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36071</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>