<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:26:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3911/DERBY-3911.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3911] BTreeController.reclaim_deleted_rows() may hide exceptions</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3911</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;BTreeController.reclaim_deleted_rows() contains this piece of code:&lt;/p&gt;

&lt;p&gt;        catch (java.lang.ClassCastException cce)&lt;/p&gt;
        {
            // because we give up the latch on the leaf before entering this
            // routine, the page might change from a leaf to branch.  If that
            // happens this routine will get a ClassCastException, and we
            // just give up trying to reclaim space.
        }
&lt;p&gt;        finally&lt;/p&gt;
        {
            if (controlRow != null)
                controlRow.release();

            return(purged_at_least_one_row);
        }

&lt;p&gt;It intentionally hides ClassCastExceptions, but it also unintentionally hides all other exceptions because of the return statement in the finally clause.&lt;/p&gt;

&lt;p&gt;Some related discussions can be found in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3216&quot; title=&quot;do row level lock space reclamation in btree of indiv rows.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3216&quot;&gt;&lt;del&gt;DERBY-3216&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3905&quot; title=&quot;Failed tests should save the database off to the fail directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3905&quot;&gt;&lt;del&gt;DERBY-3905&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12406401">DERBY-3911</key>
            <summary>BTreeController.reclaim_deleted_rows() may hide exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Oct 2008 17:01:27 +0100</created>
                <updated>Mon, 4 May 2009 19:23:00 +0100</updated>
                            <resolved>Wed, 15 Oct 2008 09:14:28 +0100</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12639469" author="knutanders" created="Tue, 14 Oct 2008 17:17:16 +0100"  >&lt;p&gt;The attached patch should fix the issue. It moves the return statement out of the finally clause, so exceptions thrown in the try block will be reported. I haven&apos;t run any regression tests on the patch yet.&lt;/p&gt;</comment>
                            <comment id="12639701" author="dagw" created="Wed, 15 Oct 2008 03:52:15 +0100"  >&lt;p&gt;Looks right to me.&lt;br/&gt;
This links explains the mechanics of why the exception will be hidden, FYI:&lt;br/&gt;
&lt;a href=&quot;http://www.jguru.com/faq/view.jsp?EID=288261&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.jguru.com/faq/view.jsp?EID=288261&lt;/a&gt; (it wasn&apos;t obvious to me)&lt;/p&gt;</comment>
                            <comment id="12639757" author="knutanders" created="Wed, 15 Oct 2008 09:14:28 +0100"  >&lt;p&gt;Thanks for looking at the patch Dag!&lt;br/&gt;
Committed revision 704801.&lt;/p&gt;</comment>
                            <comment id="12688376" author="kmarsden" created="Mon, 23 Mar 2009 18:54:33 +0000"  >&lt;p&gt;In investigating &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4075&quot; title=&quot;ERROR XSDBB: Unknown page format at page Page(613,Container(0, 1024)) when running MailJdbc (Embedded) system tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4075&quot;&gt;&lt;del&gt;DERBY-4075&lt;/del&gt;&lt;/a&gt; I was skimming over the store changes made in 10.5 to see if that could give me ideas where the problem lies.  I  came across this issue and had a question.&lt;/p&gt;


&lt;p&gt;The current code (trunk  revision 757498 ~line 181  ) in BTreeController.java reads:&lt;br/&gt;
~&lt;br/&gt;
      catch (java.lang.ClassCastException cce)&lt;/p&gt;
        {
            // because we give up the latch on the leaf before entering this
            // routine, the page might change from a leaf to branch.  If that
            // happens this routine will get a ClassCastException, and we
            // just give up trying to reclaim space.
        }
&lt;p&gt;        finally&lt;br/&gt;
        {&lt;br/&gt;
            if (controlRow != null) {&lt;br/&gt;
                if (purged_at_least_one_row) &lt;/p&gt;
{
                    // Set a hint in the page that scans positioned on it
                    // need to reposition because rows have disappeared from
                    // the page.
                    controlRow.page.setRepositionNeeded();
                }
&lt;p&gt;                controlRow.release();&lt;br/&gt;
            }&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;        return(purged_at_least_one_row);&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;At the controlRow.release() line my Eclipse IDE reports a warning: &quot;finally block does not complete normally&quot;   Now that the return is moved out of the finally block, I don&apos;t understand why I am seeing this warning. Can anyone explain it to me?&lt;/p&gt;


&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12688406" author="espinha" created="Mon, 23 Mar 2009 20:41:14 +0000"  >&lt;p&gt;As per Kathey&apos;s request, I had a look at this file under Eclipse 3.4.2 (Ganymede) and I do not get the said warning.&lt;/p&gt;

&lt;p&gt;It all points to an Eclipse bug (n.b. Kathey is using a previous version).&lt;/p&gt;

&lt;p&gt;Tiago&lt;/p&gt;</comment>
                            <comment id="12688514" author="kmarsden" created="Tue, 24 Mar 2009 00:42:31 +0000"  >&lt;p&gt;Thanks Tiago for looking at in Ganymede. I will assume then that it is just an Eclipse bug.  Someday I will be brave and upgrade my Eclipse.&lt;/p&gt;

&lt;p&gt; It is interesting though, in playing with this I was able to make a program that hides a ClassCastException  with  an NPE  in the finally clause.  This one actually didn&apos;t give me a warning in Eclipse.  It is an interesting case to think about when doing complex operations in finally blocks.&lt;/p&gt;

&lt;p&gt;public class FinallyTest {&lt;/p&gt;

&lt;p&gt;    public static void main(String[] args) throws Exception &lt;/p&gt;
{
        System.out.println(makeMyString());

    }

&lt;p&gt;    private static String makeMyString() throws Exception {&lt;br/&gt;
        String myString = null;&lt;/p&gt;

&lt;p&gt;        try &lt;/p&gt;
{
            myString = (String) new Object();
        }
&lt;p&gt; finally &lt;/p&gt;
{
           // we lose our ClassCastException
            release();
            System.out.println(&quot;Finished finally&quot;);
        }

&lt;p&gt;        return myString;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    private static void release() throws Exception &lt;/p&gt;
{
        Object aNullObject = null;
        System.out.println(aNullObject.toString());
    }

&lt;p&gt;}&lt;/p&gt;



&lt;p&gt;&amp;gt; java FinallyTest&lt;br/&gt;
Exception in thread &quot;main&quot; java.lang.NullPointerException&lt;br/&gt;
        at FinallyTest.release(FinallyTest.java:25)&lt;br/&gt;
        at FinallyTest.makeMyString(FinallyTest.java:16)&lt;br/&gt;
        at FinallyTest.main(FinallyTest.java:6)&lt;/p&gt;</comment>
                            <comment id="12688600" author="knutanders" created="Tue, 24 Mar 2009 07:43:50 +0000"  >&lt;p&gt;Note that there is one important difference between the issue logged here and what Kathey constructed. The logged issue would actually hide any error completely and return successfully, whereas the constructed example would still throw an exception and reveal that something is wrong.&lt;/p&gt;</comment>
                            <comment id="12688688" author="espinha" created="Tue, 24 Mar 2009 13:37:26 +0000"  >&lt;p&gt;Interestingly enough, by changing the return statement into the finally block on Kathey&apos;s example, we still get the NPE and the code doesn&apos;t return successfully.&lt;/p&gt;

&lt;p&gt;I think it remains a mystery to why this was happening in the first place on the original case. Even having the exception happening inside the finally block, the last exception to happen (and to not be caught) should stop the thread it is executing on, right?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12392104" name="derby-3911.diff" size="555" author="knutanders" created="Tue, 14 Oct 2008 17:17:16 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 15 Oct 2008 02:52:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23913</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0x6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39195</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>