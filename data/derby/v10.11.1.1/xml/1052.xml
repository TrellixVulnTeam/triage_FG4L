<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:32:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1052/DERBY-1052.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1052] test jdbcapi/checkDataSource30 and savepointJdbc30_XA fail with remote server with security exceptions</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1052</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The .tmp from the jdbcapi/checkDataSource30.java is:&lt;br/&gt;
----------------------&lt;br/&gt;
START XA HOLDABILITY TEST&lt;br/&gt;
ERROR (no SQLState): java.security.PrivilegedActionException : Error opening socket to server localhost on port 1527 with message : Connection refused&lt;br/&gt;
Completed checkDataSource30&lt;br/&gt;
----------------------&lt;/p&gt;

&lt;p&gt;The .tmp from the jdbcapi/savepointJdbc30_XA.java is:&lt;br/&gt;
-------------------------------------&lt;br/&gt;
FAIL &amp;#8211; unexpected exception&lt;br/&gt;
SQLSTATE(null):java.sql.SQLException: java.security.PrivilegedActionException : Error opening socket to server localhost on port 1527 with message : Connection refused&lt;br/&gt;
	at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:285)&lt;br/&gt;
	at org.apache.derby.client.ClientPooledConnection.&amp;lt;init&amp;gt;(ClientPooledConnection.java:104)&lt;br/&gt;
	at org.apache.derby.client.ClientXAConnection.&amp;lt;init&amp;gt;(ClientXAConnection.java:47)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientXADataSource.getXAConnection(ClientXADataSource.java:50)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientXADataSource.getXAConnection(ClientXADataSource.java:43)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.jdbcapi.savepointJdbc30_XA.main(savepointJdbc30_XA.java:58)&lt;br/&gt;
Caused by: org.apache.derby.client.am.DisconnectException: java.security.PrivilegedActionException : Error opening socket to server localhost on port 1527 with message : Connection refused&lt;br/&gt;
	at org.apache.derby.client.net.NetAgent.&amp;lt;init&amp;gt;(NetAgent.java:113)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.newAgent_(NetConnection.java:928)&lt;br/&gt;
	at org.apache.derby.client.am.Connection.initConnection(Connection.java:174)&lt;br/&gt;
	at org.apache.derby.client.am.Connection.&amp;lt;init&amp;gt;(Connection.java:144)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.&amp;lt;init&amp;gt;(NetConnection.java:207)&lt;br/&gt;
	at org.apache.derby.client.net.NetXAConnection.&amp;lt;init&amp;gt;(NetXAConnection.java:39)&lt;br/&gt;
	at org.apache.derby.client.ClientPooledConnection.&amp;lt;init&amp;gt;(ClientPooledConnection.java:94)&lt;br/&gt;
	... 4 more&lt;br/&gt;
-----------------------------&lt;/p&gt;
</description>
                <environment>windows, server jdk13 or jdk14,  client jdk14</environment>
        <key id="12329434">DERBY-1052</key>
            <summary>test jdbcapi/checkDataSource30 and savepointJdbc30_XA fail with remote server with security exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Sat, 25 Feb 2006 02:57:32 +0000</created>
                <updated>Wed, 1 Jul 2009 01:09:09 +0100</updated>
                            <resolved>Thu, 16 Mar 2006 07:55:32 +0000</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12368164" author="djd" created="Wed, 1 Mar 2006 05:18:04 +0000"  >&lt;p&gt;I don&apos;t think these are actually security exceptions, the  java.security.PrivilegedActionException is just a mechnism used to throw the real exception through a privileged block. The real exeception is wrapped by the PrivilegedActionException, and in this case seems to be a connection refused. Embedded unwraps PrivilegedActionExceptions and just throws the real underlying exception, client should do the same, I&apos;ll enter a bug.&lt;/p&gt;</comment>
                            <comment id="12368180" author="myrna" created="Wed, 1 Mar 2006 07:10:02 +0000"  >&lt;p&gt;Thx for looking at this &amp;amp; the logging of that bug...&lt;/p&gt;

&lt;p&gt;In the meantime, I am looking for other approaches as to what the problem is here.&lt;/p&gt;

&lt;p&gt;One thing that is puzzling is the reference to &apos;localhost&apos; in the savepointJdbc30_XA.tmp. I looked around in tests/jdbcapi/checkDataSourceJdbc30 and tests/jdbcapi/checkDataSource, tests/jdbcapi/savepointJdbc30_XA and tests/jdbcapi/savepointJdbc30_JSR169 and TestUtil under functionTests, but could not see where this might be coming from....?&lt;/p&gt;</comment>
                            <comment id="12368187" author="kmarsden" created="Wed, 1 Mar 2006 08:34:52 +0000"  >&lt;p&gt;The test checkDataSource.java  gets its datasource using the methods &lt;br/&gt;
TestUtil.getXXXDataSource methods which all ultimately  create the datasource with the default serverName if none was passed to  those methods.  The default is localhost.&lt;/p&gt;


&lt;p&gt; So at some point ds.setServerName(remoteHost)  will need to be called to change the the host. &lt;br/&gt;
One thought is that the method  TestUtil.getDataSourceWithReflection could  call setServerName(remoteHost)  if serverName has not been set in the attributes by the caller.&lt;/p&gt;</comment>
                            <comment id="12369554" author="myrna" created="Thu, 9 Mar 2006 05:46:54 +0000"  >&lt;p&gt;M      java\testing\org\apache\derbyTesting\functionTests\util\TestUtil.java&lt;/p&gt;

&lt;p&gt;I&apos;m attaching an attempted fix for this.&lt;br/&gt;
I tested with remote server with insane jars, ran derbyall, and for good measure, also ran derbyall with wctme5.7_foundation.&lt;br/&gt;
There were the &apos;known&apos; wctme5.7 failures (bootLock, SUR*test...), the checkDataSource and savepointJdbc30_XA tests passed with remote server, and derbyall looked good...&lt;/p&gt;

&lt;p&gt;Except for one mysterious failure with my change: on linux (not on windows machine), with jars built on windows, the test derbynet/runtimeinfo.java failed with both DerbyNet and DerbyNetClient. It&apos;s very strange, because that test does not use datasources in any way that I can see. Also, the result is intermittent...&lt;br/&gt;
I am hoping someone will have a chance to review this and run the test on linux after applying my patch...&lt;br/&gt;
This is an example diff I&apos;m seeing:&lt;br/&gt;
--------&lt;br/&gt;
....&lt;br/&gt;
Attempt to shutdown framework: DerbyNetClient&lt;br/&gt;
57a58,66&lt;br/&gt;
&amp;gt; Session # :2&lt;br/&gt;
&amp;gt; Database :wombat;create=true&lt;br/&gt;
&amp;gt; User :APP&lt;br/&gt;
&amp;gt; # Statements:2&lt;br/&gt;
&amp;gt; Prepared Statement Information: &lt;br/&gt;
&amp;gt;       Stmt ID         SQLText&lt;br/&gt;
&amp;gt;       -------------   -----------&lt;br/&gt;
&amp;gt;       SYSLH0002       VALUES(1)&lt;br/&gt;
&amp;gt;       SYSLH0001       SELECT count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from sys.systables&lt;br/&gt;
61 del&lt;br/&gt;
&amp;lt; # Active Sessions : 1&lt;br/&gt;
61a70&lt;br/&gt;
&amp;gt; # Active Sessions : 2&lt;br/&gt;
Test Failed.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;End:   runtimeinfo jdk1.4.2_04 DerbyNetClient 2006-03-08 12:11:27 ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-----------------------&lt;/p&gt;
</comment>
                            <comment id="12369557" author="myrna" created="Thu, 9 Mar 2006 06:36:07 +0000"  >&lt;p&gt;Well, I finally thought of another way to approach that mysterious runtimeinfo failure (pretty silly not to think of it sooner), and ran the same test after reverting. And sure enough, the test still failed. So, my change is not related, there&apos;s something else sitting around in my environment making this go oops. &lt;/p&gt;

&lt;p&gt;I&apos;ll go clean that up, in the mean time, this patch is fairly simple &amp;amp; I think it&apos;s good to go.&lt;/p&gt;
</comment>
                            <comment id="12370610" author="fuzzylogic" created="Thu, 16 Mar 2006 07:55:32 +0000"  >&lt;p&gt;Committed revision 386221.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12323951" name="DERBY-1052_testutil_2006_03_08.diff" size="861" author="myrna" created="Thu, 9 Mar 2006 05:46:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 1 Mar 2006 05:18:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22282</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0tjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38606</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>