<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:35:31 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-938/DERBY-938.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-938] ContextManager needs to be optimized</title>
                <link>https://issues.apache.org/jira/browse/DERBY-938</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;ContextManagers are used extensively, particularly to get access to ExcutionContexts and StatementContexts. Optimizing this access should improve overall performance. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12328752">DERBY-938</key>
            <summary>ContextManager needs to be optimized</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dyret">Dyre Tjeldvoll</assignee>
                                    <reporter username="dyret">Dyre Tjeldvoll</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Feb 2006 14:57:13 +0000</created>
                <updated>Fri, 21 Jan 2011 19:00:25 +0000</updated>
                            <resolved>Tue, 21 Feb 2006 16:44:00 +0000</resolved>
                                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12365747" author="dyret" created="Fri, 10 Feb 2006 00:54:52 +0000"  >&lt;p&gt;Patch and results from running derbyall. Please review.&lt;/p&gt;</comment>
                            <comment id="12365750" author="dyret" created="Fri, 10 Feb 2006 00:59:44 +0000"  >&lt;p&gt;Inspired by Bryan Pendleton I have added a separate patch description document, but it is not quite up to his standards. &lt;/p&gt;</comment>
                            <comment id="12365751" author="djd" created="Fri, 10 Feb 2006 01:01:32 +0000"  >&lt;p&gt;Since this is a critical area an overview of what changes you made would be really useful. Hard to tell what you approach was from just the patch.&lt;/p&gt;</comment>
                            <comment id="12365752" author="dyret" created="Fri, 10 Feb 2006 01:05:49 +0000"  >&lt;p&gt;Hi Dan you are up early. You managed to put in your comment while I was attaching the description document. Does it address your concern?&lt;/p&gt;</comment>
                            <comment id="12366496" author="dyret" created="Thu, 16 Feb 2006 01:13:25 +0000"  >&lt;p&gt;Attaching a spreadsheet that shows the reduction in CPU resulting from optimizing getContext(String) for StatementContext and ExecutionContext. The load is  single record select, 100000 records in the table, pageCacheSize=10000, 10 sek warmup time, and 10 min running time. The measurements are obtained using Sun Performance Analyzer 7.4&lt;/p&gt;

&lt;p&gt;While I have accepted the fact that the getContext(String) part of the patch will not make it into Derby, I would still like to document that there IS a perfomance issue  lurking here, and I would encourage &quot;the folks that have been working on the product for nearly ten years&quot; to think about how it can be fixed without violating other important design criteria.&lt;/p&gt;</comment>
                            <comment id="12366537" author="djd" created="Thu, 16 Feb 2006 05:41:33 +0000"  >&lt;p&gt;It&apos;s great that you are looking into this, one of my itches is better pure cpu performance for Derby.&lt;br/&gt;
Suggestions are:&lt;/p&gt;

&lt;p&gt;1) As suggested before and I thought was part of your patch, using an unsynchronized collection.&lt;/p&gt;

&lt;p&gt;2)  Use Integer for context identifiers instead of Strings. I once started some work towards this, moving&lt;br/&gt;
some context identifiers to a central class to ensure unique numeric identifiers.&lt;/p&gt;

&lt;p&gt;I wonder if implementing these basic ideas will still show that some language specific changes are needed.&lt;br/&gt;
If they are let&apos;s tackle those separately.&lt;/p&gt;
</comment>
                            <comment id="12366616" author="dyret" created="Thu, 16 Feb 2006 19:21:01 +0000"  >&lt;p&gt;Spreadsheet as HTML, not XHTML.&lt;/p&gt;</comment>
                            <comment id="12366961" author="dyret" created="Sun, 19 Feb 2006 21:34:31 +0000"  >&lt;p&gt;New spreadsheet (get.v2.html) that shows the effect of a new version of the patch which doesn&apos;t include the getContext() optimization. Seems like there is a substantial benefit to be had from just switching to a non-synchronized container, (note the large reduction in wait time). &lt;/p&gt;</comment>
                            <comment id="12366962" author="dyret" created="Sun, 19 Feb 2006 22:27:20 +0000"  >&lt;p&gt;Attached a new patch (derby-934.v2.*) that removes the getContext() optimization as suggested by the reviewers. A couple of things to note:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The modification was not completely independent of the rest of the patch, so there were some additional changes, e.g. the traversal of the StatementContexts.&lt;/li&gt;
	&lt;li&gt;I have not changed ContextIds from Strings to ints, for reasons explained in (&lt;a href=&quot;http://article.gmane.org/gmane.comp.apache.db.derby.devel/14273&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://article.gmane.org/gmane.comp.apache.db.derby.devel/14273&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;Even without this patch ContextManager depends on the language module in cleanupOnError(Throwable), which references org.apache.derby.iapi.reference.ContextId.LANG_CONNECTION (line 254), and org.apache.derby.iapi.reference.ContextId.LANG_STATEMENT (line 271). So the only added dependency introduced by the first version of the patch was that on ExecutionContexts.CONTEXT_ID, which could easily have been moved to  org.apache.derby.iapi.reference.ContextId as suggested in &lt;a href=&quot;http://article.gmane.org/gmane.comp.apache.db.derby.devel/14273&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://article.gmane.org/gmane.comp.apache.db.derby.devel/14273&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Anyway, more work is needed to make ContextManager completely independent, as intended. &lt;/p&gt;</comment>
                            <comment id="12366974" author="djd" created="Mon, 20 Feb 2006 03:27:57 +0000"  >&lt;p&gt;Thanks for the new patch: Some minor comments:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Class javadoc comment for CtxStack is out of date I think it will cause Javadoc errors due to the&lt;br/&gt;
references to getStatementContext &amp;amp; getStatementContextStackSize. The sentence beforre these&lt;br/&gt;
references is also stale.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Should the methods in CTxStack be &apos;package protected&apos; instead of public. The class is not accessible outside the package.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Should the ContextManager.getContextStack() method be declared to return a List (ie. the interface) not a specific implementation?&lt;br/&gt;
  This would have two advantages:&lt;br/&gt;
           1) you could return a read-only list to enforce your requirement using&lt;br/&gt;
                   java.util.Collections.unmodifiableList()&lt;br/&gt;
                    Not sure what performance effect this would have though.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;            2) You could use java.util.Collections.EMPTY_LIST instead of having the new field voidArrayList_&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If we keep voidArrayList_ , shouldn&apos;t it be a static?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;For the new method getContextStack, is the caller allowed to push/pop contexts with the same id through&lt;br/&gt;
the context manager while it is iterating the contents of the returned List,  or will that causes issues? E.g. popping&lt;br/&gt;
a context with the same id, might cause a no such element exeption on the returned list.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;For the new method getContextStack, it would be good to specify which order the contexts are in the returned List,&lt;br/&gt;
is the element at 0 the first pushed or the most recently pushed.&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12367023" author="dyret" created="Mon, 20 Feb 2006 20:42:52 +0000"  >&lt;p&gt;Thanks for your feedback.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I&apos;ll fix the javadoc issues.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I&apos;ll trust you on the &quot;package protected&quot; access issue, and fix that.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;About List and unmodifiableList: From a SW engineering point of view, I totally agree. However, my profiler indicates that this uses about 3 times more CPU. It&apos;s a tradeoff...&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Yes, voidArrayList_ should have been static.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;No the intention was that the List cannot be modified while it is traversed. I must admit that I don&apos;t understand why you would want to allow that (given that MT-access is ruled out). If you require the use of polymorphism to determine which elements should be removed from the container, would it not be better to mark those elements so that they get deleted when the iteration reaches their location in the container?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Yes, I will add a comment about how the elements are ordered in the returned List.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12367026" author="dyret" created="Mon, 20 Feb 2006 20:51:54 +0000"  >&lt;p&gt;Uhm, disregard item 3 in my previous comment. I misunderstood the question. The intention was that the underlying CtxStack would not be modified while iterating over it using getContextStack(). This should be documented in javadoc comment. Will fix.&lt;/p&gt;</comment>
                            <comment id="12367056" author="dyret" created="Tue, 21 Feb 2006 02:20:20 +0000"  >&lt;p&gt;Attached a new patch (derby-938.v3.*) &lt;/p&gt;</comment>
                            <comment id="12367099" author="djd" created="Tue, 21 Feb 2006 07:47:18 +0000"  >&lt;p&gt; Patch derby-938.v3.diff - Committed revision 379265.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12322800" name="derby-938.diff" size="19330" author="dyret" created="Fri, 10 Feb 2006 00:54:52 +0000"/>
                            <attachment id="12322803" name="derby-938.html" size="3356" author="dyret" created="Fri, 10 Feb 2006 00:59:44 +0000"/>
                            <attachment id="12323174" name="derby-938.v2.diff" size="11241" author="dyret" created="Sun, 19 Feb 2006 22:27:20 +0000"/>
                            <attachment id="12323199" name="derby-938.v3.diff" size="11368" author="dyret" created="Tue, 21 Feb 2006 02:20:20 +0000"/>
                            <attachment id="12323200" name="derby-938.v3.stat" size="446" author="dyret" created="Tue, 21 Feb 2006 02:20:20 +0000"/>
                            <attachment id="12323201" name="derbyall_report.v3.txt" size="22928" author="dyret" created="Tue, 21 Feb 2006 02:20:20 +0000"/>
                            <attachment id="12323050" name="get.html" size="3604" author="dyret" created="Thu, 16 Feb 2006 19:21:01 +0000"/>
                            <attachment id="12323173" name="get.v2.html" size="4745" author="dyret" created="Sun, 19 Feb 2006 21:34:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10362"><![CDATA[Performance]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 10 Feb 2006 01:01:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29790</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0jef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36961</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>