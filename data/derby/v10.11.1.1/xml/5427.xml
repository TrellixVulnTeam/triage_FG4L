<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:31:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5427/DERBY-5427.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5427] Unauthorized shutdown should not generate thread dump and javacore. AuthenticationTest dumps over 20 javacores with IBM JVM for normal user errors</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5427</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If jdbcapi.AuthenticationTest is run without changing the derby.stream.error.extendedDiagSeverityLevel as is done in the test, it generates thread dumps and javacores  for IBM jvms. I beleive the errors in this test are expected user errors and not crashes so they should &lt;b&gt;not&lt;/b&gt; generate a thread dump or javacore.  To reproduce remove this line from test:&lt;/p&gt;


&lt;p&gt;   //Derby-4856,set the property to avoid thread dump and diagnostic info&lt;br/&gt;
        sysprops.put(&quot;derby.stream.error.extendedDiagSeverityLevel&quot;,&quot;50000&quot;);&lt;/p&gt;


&lt;p&gt;Until fixed, users can work around the issue by setting derby.stream.error.extendedDiagSeverityLevel to 50000 as is done in the test.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12524309">DERBY-5427</key>
            <summary>Unauthorized shutdown should not generate thread dump and javacore. AuthenticationTest dumps over 20 javacores with IBM JVM for normal user errors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Sep 2011 18:30:24 +0100</created>
                <updated>Wed, 5 Feb 2014 22:40:47 +0000</updated>
                            <resolved>Wed, 2 Nov 2011 03:39:37 +0000</resolved>
                                    <version>10.7.1.4</version>
                                    <fixVersion>10.8.3.0</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13113158" author="lilywei" created="Fri, 23 Sep 2011 06:12:04 +0100"  >&lt;p&gt;The test generates more than 20 unauthorized shutdown errors. The numbers of javacore files depend on number of the same unauthorized shutdown error. To fix this from error point of view, we need to increase the error level for &#8220;ERROR 08004: Database connection refused&#8221;. As fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4856&quot; title=&quot;Add thread dump information when derby crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4856&quot;&gt;&lt;del&gt;DERBY-4856&lt;/del&gt;&lt;/a&gt;, we did not decide to change the error level for ERROR 08004. This is a good time to revisit this issue. Should we increase the error level for ERROR 08004 to be higher to avoid the javacore for IBM JVM instead of the workaround fix by setting derby.stream.error.extendedDiagSeverityLevel to 50000?&lt;/p&gt;</comment>
                            <comment id="13114752" author="kmarsden" created="Mon, 26 Sep 2011 17:11:51 +0100"  >&lt;p&gt;On a simple functional level, the task of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4586&quot; title=&quot;Add compatibility tests to explore behavior differences between Derby and other DBMS implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4586&quot;&gt;DERBY-4586&lt;/a&gt; was to generate a thread dump/javacore when Derby crashes. This is not a crash so should not generate a javacore, so users and the tests should not have to work around generating javacores in this situation by setting derby.stream.error.extendedDiagSeverityLevel ,&lt;/p&gt;

&lt;p&gt;8004 is currently a session level error which seems correct to me.&lt;/p&gt;

&lt;p&gt;So I think the problem here is that our determination of whether this situation is a a crash is a bit off.&lt;br/&gt;
As I recall the determination of a crash was when we got a session level error on a booted database. Perhaps it should be instead if we get a session level error on an active session.&lt;/p&gt;</comment>
                            <comment id="13119037" author="lilywei" created="Sun, 2 Oct 2011 17:35:12 +0100"  >&lt;p&gt;Currently, we are using whether a booted database get a session level error to determine whether to generate a thread dump/javacore. Adding the logic on top of that with whether it is a active session sounds more accurate to determine a Derby crash situation occur or not. In AuthenticationTest case, Derby is not crashing. If we add whether it is a active session logic to the code, it should be closer for the fix of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4586&quot; title=&quot;Add compatibility tests to explore behavior differences between Derby and other DBMS implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4586&quot;&gt;DERBY-4586&lt;/a&gt; with the goal to detecting Derby is crashing. Can anyone suggest how to determine whether we have a active session or not?&lt;/p&gt;</comment>
                            <comment id="13122976" author="kmarsden" created="Fri, 7 Oct 2011 18:26:26 +0100"  >&lt;p&gt;I verified that this is also an issue with 10.8.1.2 as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4586&quot; title=&quot;Add compatibility tests to explore behavior differences between Derby and other DBMS implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4586&quot;&gt;DERBY-4586&lt;/a&gt; went into that release. &lt;/p&gt;

&lt;p&gt;I am finding it a bit difficult to get a test case outside of AuthenticationTest. Simple authentication failures  with ij do not cause  the issue, so may be more of an edge case than first thought, but I will continue to debug.&lt;/p&gt;

&lt;p&gt;I think it is an important issue, especially for IBM jvm&apos;s as leads to the javacore in addition to the thread dump in the derby.log that would print with other JVM&apos;s, but I don&apos;t think it needs to hold up the release.  &lt;/p&gt;
</comment>
                            <comment id="13126177" author="kmarsden" created="Wed, 12 Oct 2011 22:35:48 +0100"  >&lt;p&gt;Attached is a patch which fixes this issue, but I don&apos;t know if it is the best solution.    The critieria for a crash needs to be that we do the thread dump if we get a session level error while the session is active.  To test whether the session was active we would just check  database.isActive().  In the problematic authentication cases, database.isActive() was true and we are actually in a transaction at the time,  but because the user had not successfully logged in, it should not have been considered an active session.&lt;/p&gt;

&lt;p&gt;The attached change actually checks the SQLState for login errors and does not consider that case an active session. I  wonder if there is not a better and more efficient way to check.&lt;/p&gt;</comment>
                            <comment id="13126178" author="kmarsden" created="Wed, 12 Oct 2011 22:36:43 +0100"  >&lt;p&gt;Marking patch available as I would like feedback on the solution. I ran AuthenticationTest but not the full set of regressions yet.&lt;/p&gt;</comment>
                            <comment id="13126205" author="kmarsden" created="Wed, 12 Oct 2011 23:18:01 +0100"  >&lt;p&gt;oops, forgot to attach the test diff.&lt;/p&gt;</comment>
                            <comment id="13127263" author="lilywei" created="Fri, 14 Oct 2011 04:54:38 +0100"  >&lt;p&gt;+1 The change looks good to me.&lt;/p&gt;</comment>
                            <comment id="13127838" author="kmarsden" created="Fri, 14 Oct 2011 21:34:39 +0100"  >&lt;p&gt;Thanks Lily for the review. Regression&apos;s passed fine.   I&apos;ll go ahead and check this into trunk and 10.8.&lt;/p&gt;</comment>
                            <comment id="13141886" author="kmarsden" created="Wed, 2 Nov 2011 03:39:08 +0000"  >&lt;p&gt;This issue affects 10.7 as well, but I am encountering conflicts backporting the fix.  I think I won&apos;t bother with that now.&lt;br/&gt;
If someone using 10.7 needs it they can look at the back port.&lt;/p&gt;</comment>
                            <comment id="13823418" author="knutanders" created="Fri, 15 Nov 2013 08:15:12 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update: close all resolved issues that haven&amp;#39;t had any activity the last year&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12681947">DERBY-6426</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12505727">DERBY-5209</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12457305">DERBY-4565</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12498829" name="derby-5427_diff.txt" size="2057" author="kmarsden" created="Wed, 12 Oct 2011 22:35:48 +0100"/>
                            <attachment id="12498833" name="derby-5427_test_diff.txt" size="898" author="kmarsden" created="Wed, 12 Oct 2011 23:18:00 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 23 Sep 2011 05:12:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3252</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    <customfieldvalue key="10427"><![CDATA[Workaround attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0c8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35802</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>