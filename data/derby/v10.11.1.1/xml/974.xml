<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:34:46 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-974/DERBY-974.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-974] ClientDriver can lose some connection properties</title>
                <link>https://issues.apache.org/jira/browse/DERBY-974</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Internally, the ClientDriver class&apos;s appendDatabaseAttributes() method uses keys() on the connection properties to get a list of the property names. However, this misses any properties in the default set. The correct method for a Properties object is propertyNames(). This will return the same type of object as keys(), but will include all properties.&lt;/p&gt;

&lt;p&gt;(It is unfortunate that Sun chose to make Properties a subclass of Hashtable, instead of giving Properties a Hashtable, as the former exposes too much implementation.)&lt;/p&gt;

&lt;p&gt;The fix is to simply replace calls to keys() on all Property objects to use propertyNames(). A quick search revealed that this is not the only place in the code base where this is done, so a more thorough scan should be made.&lt;/p&gt;</description>
                <environment>Linux, Sun JRE 1.5</environment>
        <key id="12328917">DERBY-974</key>
            <summary>ClientDriver can lose some connection properties</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jorgenlo">J&#248;rgen L&#248;land</assignee>
                                    <reporter username="crimson">Michael Hackett</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Feb 2006 07:39:34 +0000</created>
                <updated>Tue, 19 Feb 2008 13:51:58 +0000</updated>
                            <resolved>Mon, 22 Oct 2007 12:17:01 +0100</resolved>
                                    <version>10.1.2.1</version>
                    <version>10.1.3.1</version>
                    <version>10.4.1.3</version>
                                    <fixVersion>10.3.2.1</fixVersion>
                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12366255" author="crimson" created="Tue, 14 Feb 2006 07:44:30 +0000"  >&lt;p&gt;Demonstrates the difference between the keys() and propertyNames() methods on Properties.&lt;/p&gt;</comment>
                            <comment id="12366258" author="crimson" created="Tue, 14 Feb 2006 07:54:25 +0000"  >&lt;p&gt;A diff against the 10.1.2.1 source of my proposed changed. It&apos;s very small. I haven&apos;t actually figured out how to build from source yet, so I cannot test that fix, so this is just to illustrate the issue. (I also don&apos;t know how a proper patch file is supposed to be generated, but please enlighten me privately.)&lt;/p&gt;</comment>
                            <comment id="12366259" author="crimson" created="Tue, 14 Feb 2006 08:07:57 +0000"  >&lt;p&gt;I should also mention that it was Spring&apos;s DriverManagerDataSource class that exposed this issue, and I originally thought the problem was there. It makes a new Properties object from the original one using the Properties(Properties defaults) constructor, instead of clone(). I&apos;m not sure whether one is preferred over another, but using the method I describe gives the correct results in any situation, and I believe it to be the more correct way to work with Properties objects.&lt;/p&gt;</comment>
                            <comment id="12366262" author="bandaram" created="Tue, 14 Feb 2006 08:37:29 +0000"  >&lt;p&gt;There seems to be a similar issue, filed under &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-546&quot; title=&quot;In contrast to EmbeddedDriver, ClientDriver fails to report all DriverPropertyInfo&amp;#39;s&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-546&quot;&gt;DERBY-546&lt;/a&gt;. Haven&apos;t checked in detail if they are same or not.&lt;/p&gt;</comment>
                            <comment id="12366291" author="crimson" created="Tue, 14 Feb 2006 12:31:20 +0000"  >&lt;p&gt;It doesn&apos;t appear to me to be closely related. It looks like the example code passes only a connection URL to the ClientDriver, converting connection properties to Derby&apos;s URL format before calling the driver. (Ironically, the example code in 546 does the conversion correctly, which is exactly the problem in the ClientDriver that I&apos;m reporting here.) The problem here is with passing connection properties in the info argument instead of the URL.&lt;/p&gt;</comment>
                            <comment id="12371365" author="deepa" created="Wed, 22 Mar 2006 08:52:31 +0000"  >&lt;p&gt;Thanks Michael for reporting and working on this issue. I took a look at PropetiesTest.java and it demonstrates the problem.&lt;/p&gt;

&lt;p&gt;For your question about how to create patches, please take a look at &lt;a href=&quot;http://db.apache.org/derby/derby_comm.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/derby_comm.html&lt;/a&gt;. It is recommended to include a regression test when submiiting patches.  Please go through &lt;a href=&quot;http://wiki.apache.org/db-derby/DerbyCommitHowTo&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/DerbyCommitHowTo&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can also look at this link &lt;a href=&quot;http://wiki.apache.org/db-derby/ForNewDevelopers&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/ForNewDevelopers&lt;/a&gt;, which has pointers to the links I just mentioned along with some more information to get started with Derby development. Hope this helps.&lt;/p&gt;</comment>
                            <comment id="12419927" author="kmarsden" created="Mon, 10 Jul 2006 01:54:53 +0100"  >&lt;p&gt;Hello Michael if you you are still monitoring this issue. I wanted to follow up  and see if  if you were still interested in pursuing posting a patch to  issue.  It seems like it would be very useful for Network Client not to lose properties.    I hope that Deepa&apos;s  comment answered your questions about creating a patch and tests.&lt;/p&gt;

&lt;p&gt;I looked briefly at  ProperiesTest.java and see that  it does show  how using keys()  would be a problem. I think though that it would be good as Deepa said to have a reproducible case/test to show the functional  impact with  Derby.&lt;/p&gt;

&lt;p&gt;I will be happy to try out and review your patch/repro  if/when you  submit it.    Please let us know if you are still interested in working on this issue.  &lt;/p&gt;</comment>
                            <comment id="12421146" author="crimson" created="Fri, 14 Jul 2006 17:27:45 +0100"  >&lt;p&gt;OK, I&apos;ll give it a try. I got the trunk source and all the dependencies and managed to get the tests running (after a short struggle). I&apos;ll try to pick it back up early next week and add a test and look at writing a fix.&lt;/p&gt;</comment>
                            <comment id="12535179" author="jorgenlo" created="Tue, 16 Oct 2007 09:01:26 +0100"  >&lt;p&gt;The bug is still present in the current trunk (verified by println&apos;s in ClientDriver), and the fix is simple. However, I cannot figure out how to write a test for this. I need a method that returns the values in the Properties object of the connection. The method java.sql.Connect#getClientInfo(String name) would probably do the trick, but that method is introduced in Java 1.6. However, I don&apos;t think the lack of a regression test should block the fix.&lt;/p&gt;

&lt;p&gt;I&apos;ll upload a patch in a few days. If I get a hint for how to write a test before that, I&apos;ll be glad to add that as well.&lt;/p&gt;</comment>
                            <comment id="12535180" author="jorgenlo" created="Tue, 16 Oct 2007 09:04:02 +0100"  >&lt;p&gt;Bug is still present in current trunk. &lt;/p&gt;</comment>
                            <comment id="12535204" author="jorgenlo" created="Tue, 16 Oct 2007 09:49:52 +0100"  >&lt;p&gt;I figured a way to test this. Without the patch, the code below results in &lt;/p&gt;

&lt;p&gt;&quot;java.sql.SQLException: The connection was refused because the database test1 was not found.&quot; &lt;/p&gt;

&lt;p&gt;whereas it correctly creates a database named &apos;test1&apos; with the patch applied.&lt;/p&gt;

&lt;p&gt;&amp;lt;code&amp;gt;&lt;br/&gt;
Properties props1 = new Properties();&lt;br/&gt;
props1.put(&quot;create&quot;, &quot;true&quot;);&lt;br/&gt;
Properties props2 = new Properties(props1);&lt;br/&gt;
...&lt;br/&gt;
con = DriverManager.getConnection(&quot;jdbc:derby://localhost:1527/test1;&quot;, props2);&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12535456" author="jorgenlo" created="Wed, 17 Oct 2007 09:13:03 +0100"  >&lt;p&gt;The attached patch, v1, fixes the bug and adds a regression test to the jdbc4 junit tests. The regression test connects to a database with a Properties object with default value create=true. Without the patch, the connection is refused because ClientDriver does not see the create=true property. With the patch, the connection works as expected.&lt;/p&gt;

&lt;p&gt;All tests pass&lt;/p&gt;</comment>
                            <comment id="12535535" author="knutanders" created="Wed, 17 Oct 2007 13:41:40 +0100"  >&lt;p&gt;Rather than hard-coding the host name and the database name, I think you can wrap the test case in a DatabaseChangeSetup via TestConfiguration.singleUseDatabaseDecorator(). This will automatically generate a unique database name and do cleanup afterwards. Then you can get the JDBC URL by calling TestConfiguration.getCurrent().getJDBCUrl(). With this approach, it is also easier to make the test run in both embedded mode and client/server mode, so you don&apos;t need special code in suite().&lt;/p&gt;

&lt;p&gt;Wouldn&apos;t it be better to skip this catch block? If the test fails, it would probably be more interesting to see the actual error message and its stack trace, so I think it is better just to let the exception propagate up to the caller.&lt;br/&gt;
+        } catch (SQLNonTransientConnectionException e)&lt;/p&gt;
{
+            fail(&quot;Connecting with a Properties object with &quot;+
+                 &quot;default values does not work&quot;);
+        }
&lt;p&gt; finally {&lt;/p&gt;

&lt;p&gt;Does this test belong in the JDBC 4 suite? I don&apos;t see that it is testing any functionality specific to JDBC 4. Perhaps jdbcapi/DriverTest is a better place? In fact, it looks like DriverTest already has what you need to pass in a Properties object to getConnection(). See DriverTest.assertConnect().&lt;/p&gt;</comment>
                            <comment id="12535871" author="jorgenlo" created="Thu, 18 Oct 2007 10:45:32 +0100"  >&lt;p&gt;Just what I needed! DriverTest definitely makes this testing cleaner and easier. Thanks for the tip, Knut &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;v2 of the patch adds a test to DriverTest instead of ConnectionTest. This moves the test from jdbc4 to jdbcapi, which means that it will be tested with older jvms as well.&lt;/p&gt;

&lt;p&gt;All tests completed without errors.&lt;/p&gt;</comment>
                            <comment id="12535897" author="knutanders" created="Thu, 18 Oct 2007 12:44:04 +0100"  >&lt;p&gt;Hi J&#248;rgen,&lt;br/&gt;
I ran DriverTest with only the test changes applied, but it didn&apos;t fail. Am I doing something wrong?&lt;/p&gt;</comment>
                            <comment id="12536576" author="jorgenlo" created="Mon, 22 Oct 2007 07:15:26 +0100"  >&lt;p&gt;Changed test to the original plan of using create=true as a default in a connection property.&lt;/p&gt;</comment>
                            <comment id="12536579" author="jorgenlo" created="Mon, 22 Oct 2007 07:22:58 +0100"  >&lt;p&gt;... now with correct indentation&lt;/p&gt;</comment>
                            <comment id="12536628" author="knutanders" created="Mon, 22 Oct 2007 12:02:29 +0100"  >&lt;p&gt;Thanks J&#248;rgen! Now I see that the test fails without the fix and passes with the fix.&lt;/p&gt;</comment>
                            <comment id="12536629" author="knutanders" created="Mon, 22 Oct 2007 12:17:01 +0100"  >&lt;p&gt;Committed revision 587056 (trunk)&lt;br/&gt;
Committed revision 587058 (10.3)&lt;/p&gt;</comment>
                            <comment id="12570222" author="jorgenlo" created="Tue, 19 Feb 2008 13:45:29 +0000"  >&lt;p&gt;Closing since the issue has been tagged as fixed since October 2007&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12322937" name="ClientDriver.java-diff" size="902" author="crimson" created="Tue, 14 Feb 2006 07:54:25 +0000"/>
                            <attachment id="12322936" name="PropertiesTest.java" size="1321" author="crimson" created="Tue, 14 Feb 2006 07:44:30 +0000"/>
                            <attachment id="12367856" name="derby-974-1.diff" size="2531" author="jorgenlo" created="Wed, 17 Oct 2007 09:13:02 +0100"/>
                            <attachment id="12367857" name="derby-974-1.stat" size="149" author="jorgenlo" created="Wed, 17 Oct 2007 09:13:02 +0100"/>
                            <attachment id="12367929" name="derby-974-2.diff" size="2426" author="jorgenlo" created="Thu, 18 Oct 2007 10:45:32 +0100"/>
                            <attachment id="12367928" name="derby-974-2.stat" size="147" author="jorgenlo" created="Thu, 18 Oct 2007 10:45:32 +0100"/>
                            <attachment id="12368117" name="derby-974-3.diff" size="1734" author="jorgenlo" created="Mon, 22 Oct 2007 07:22:58 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 14 Feb 2006 08:37:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22228</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0zcv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39546</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>