<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:26:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6089/DERBY-6089.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6089] CallableStatement#registerOutParameter on client lacks check of legal types.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6089</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Cf the attached negative test in a patch to PreparedStatement42.&lt;/p&gt;

&lt;p&gt;In JDBC 4.2, the Javadoc for registerOutParameter(int parameterIndex,&lt;br/&gt;
int sqlType, String typeName) reads:&lt;/p&gt;

&lt;p&gt;:&lt;br/&gt;
@exception SQLFeatureNotSupportedException if sqlType is a ARRAY,&lt;br/&gt;
 BLOB, CLOB, DATALINK, JAVA_OBJECT, NCHAR, NCLOB, NVARCHAR,&lt;br/&gt;
 LONGNVARCHAR, REF, ROWID, SQLXML or STRUCT data type and the JDBC&lt;br/&gt;
 driver does not support this data type&lt;br/&gt;
:&lt;/p&gt;

&lt;p&gt;For the new overloads, for embedded this is checked inside Util42#getTypeAsInt. The similar&lt;br/&gt;
client method, Utils42#getTypeAsInt does not do this checking.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12633549">DERBY-6089</key>
            <summary>CallableStatement#registerOutParameter on client lacks check of legal types.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                            <label>derby_backport_reject_10_8</label>
                    </labels>
                <created>Fri, 22 Feb 2013 04:39:19 +0000</created>
                <updated>Tue, 9 Jul 2013 13:58:34 +0100</updated>
                            <resolved>Wed, 13 Mar 2013 13:13:02 +0000</resolved>
                                    <version>10.10.1.1</version>
                                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13583935" author="dagw" created="Fri, 22 Feb 2013 05:46:05 +0000"  >&lt;p&gt;Attaching another repro that shows the behavior of the old overloads: it seems they are missing the type check too, but they behave differently for embedded and client:&lt;br/&gt;
on embedded we see an exception that the datatype is not correct for the parameter number (correct, but I would exoect the SQLFeatureNotSupportedException for the old overloads, too), and for client, no error is thrown in the call to registerOutParameter. So, are both check types missing there? &lt;/p&gt;</comment>
                            <comment id="13586237" author="rhillegas" created="Mon, 25 Feb 2013 20:10:22 +0000"  >&lt;p&gt;Attaching derby-6089-01-aa-addCheckToClient.diff. This patch makes the client perform the same check as the embedded driver for the new CallableStatement.registerOutParameter() overloads. I will run regression tests.&lt;/p&gt;

&lt;p&gt;This patch addresses the first problem described by Dag, the problem with the new overloads. The patch does not address the follow-on pre-existing problem with the old overloads.&lt;/p&gt;


&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;------------&lt;/p&gt;

&lt;p&gt;M       java/client/org/apache/derby/client/am/PreparedStatement.java&lt;br/&gt;
M       java/client/org/apache/derby/client/am/Utils42.java&lt;br/&gt;
M       java/client/org/apache/derby/client/am/Agent.java&lt;/p&gt;

&lt;p&gt;Factors type checking in the client to mimic the embedded behavior.&lt;/p&gt;


&lt;p&gt;------------&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/tests/jdbc4/PreparedStatementTest42.java&lt;/p&gt;

&lt;p&gt;Adds Dag&apos;s negative case to this test.&lt;/p&gt;</comment>
                            <comment id="13586645" author="dagw" created="Tue, 26 Feb 2013 02:32:15 +0000"  >&lt;p&gt;Thanks, Rick, looks good. I see TINYINT is (only) commented out in the test; intentional or carry-over from my repros?&lt;/p&gt;</comment>
                            <comment id="13587131" author="rhillegas" created="Tue, 26 Feb 2013 13:54:07 +0000"  >&lt;p&gt;Thanks for the quick review, Dag. Tests passed cleanly for me on the first patch. Attaching derby-6089-01-ab-addCheckToClient.diff, a second rev which removes the commented-out TINYINT line. Committed at subversion revision 1450168.&lt;/p&gt;</comment>
                            <comment id="13600066" author="rhillegas" created="Tue, 12 Mar 2013 14:24:57 +0000"  >&lt;p&gt;Attaching derby-6089-02-aa-addCheckToOldOverloads.diff. This patch makes the old overloads behave like the new overloads: If the jdbc type is not a legal Derby data type, then a SQLFeatureNotSupportedException is raised. I am running tests now.&lt;/p&gt;


&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;--------------&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/sql/GenericParameterValueSet.java&lt;/p&gt;

&lt;p&gt;The guts of the change to the embedded driver: check the data type whenever calling registerOutParameter.&lt;/p&gt;

&lt;p&gt;--------------&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/jdbc/Util42.java&lt;br/&gt;
M       java/engine/org/apache/derby/impl/jdbc/EmbedCallableStatement42.java&lt;br/&gt;
M       java/engine/org/apache/derby/impl/jdbc/EmbedPreparedStatement42.java&lt;br/&gt;
M       java/engine/org/apache/derby/impl/jdbc/ConnectionChild.java&lt;br/&gt;
M       java/engine/org/apache/derby/impl/jdbc/Util.java&lt;br/&gt;
M       java/engine/org/apache/derby/impl/jdbc/EmbedPreparedStatement.java&lt;br/&gt;
M       java/engine/org/apache/derby/impl/jdbc/EmbedResultSet42.java&lt;/p&gt;

&lt;p&gt;Some refactoring in order to support the embedded change.&lt;/p&gt;

&lt;p&gt;--------------&lt;/p&gt;

&lt;p&gt;M       java/client/org/apache/derby/client/am/CallableStatement.java&lt;/p&gt;

&lt;p&gt;The change to the client driver: check the data type whenever calling registerOutParameter.&lt;/p&gt;

&lt;p&gt;--------------&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/tests/jdbc4/PreparedStatementTest42.java&lt;/p&gt;

&lt;p&gt;Add Dag&apos;s test case from 6089-repro-old-overloads.diff.&lt;/p&gt;</comment>
                            <comment id="13600137" author="rhillegas" created="Tue, 12 Mar 2013 16:22:58 +0000"  >&lt;p&gt;Attaching derby-6089-02-ab-addCheckToOldOverloads.diff. The tests tripped one problem: the error has changed to a SQLFeatureNotSupportedException when you try to register an output parameter as a java.sql.Types.OTHER.&lt;/p&gt;

&lt;p&gt;Committed at subversion revision 1455602.&lt;/p&gt;

&lt;p&gt;Touches the following additional file:&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/master/outparams.out&lt;/p&gt;</comment>
                            <comment id="13601125" author="rhillegas" created="Wed, 13 Mar 2013 13:13:02 +0000"  >&lt;p&gt;I believe that the work on this issue is done. Resolving.&lt;/p&gt;</comment>
                            <comment id="13601459" author="myrna" created="Wed, 13 Mar 2013 18:23:27 +0000"  >&lt;p&gt;Updated the j9_foundation canon to match the changes to master/outparams.out with revision &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1456075&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1456075&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13612017" author="dagw" created="Sun, 24 Mar 2013 06:24:36 +0000"  >&lt;p&gt;Thanks, Rick. Patch is a good cleanup, closing this issue.&lt;/p&gt;</comment>
                            <comment id="13703217" author="rhillegas" created="Tue, 9 Jul 2013 13:40:10 +0100"  >&lt;p&gt;This cleanup cannot be backported to 10.8 because it touches JDBC 4.2 support classes which aren&apos;t present in 10.8.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12616758">DERBY-6000</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12570418" name="6089-repro-old-overloads.diff" size="1846" author="dagw" created="Fri, 22 Feb 2013 05:46:05 +0000"/>
                            <attachment id="12570414" name="6089-repro.diff" size="1390" author="dagw" created="Fri, 22 Feb 2013 04:42:16 +0000"/>
                            <attachment id="12570847" name="derby-6089-01-aa-addCheckToClient.diff" size="12658" author="rhillegas" created="Mon, 25 Feb 2013 20:10:22 +0000"/>
                            <attachment id="12570982" name="derby-6089-01-ab-addCheckToClient.diff" size="12629" author="rhillegas" created="Tue, 26 Feb 2013 13:54:07 +0000"/>
                            <attachment id="12573335" name="derby-6089-02-aa-addCheckToOldOverloads.diff" size="15951" author="rhillegas" created="Tue, 12 Mar 2013 14:24:57 +0000"/>
                            <attachment id="12573354" name="derby-6089-02-ab-addCheckToOldOverloads.diff" size="97052" author="rhillegas" created="Tue, 12 Mar 2013 16:22:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10367"><![CDATA[Deviation from standard]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 25 Feb 2013 20:10:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314044</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzc1l3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314389</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>