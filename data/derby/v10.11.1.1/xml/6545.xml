<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:55:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6545/DERBY-6545.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6545] Should not be able to add a default to an identity column</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6545</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;According to the 2011 edition of the SQL Standard, the only alterations allowed on identity columns are the following:&lt;/p&gt;

&lt;p&gt;1) changing the identity properties of the column&lt;/p&gt;

&lt;p&gt;2) causing the column to cease to be an identity column&lt;/p&gt;

&lt;p&gt;This is described in part 2, section 11.2 (alter column definition), syntax rule 6. However, Derby allows you to add a default to an identity column. It&apos;s clear from the CREATE TABLE syntax that a column can&apos;t both have a default and be an identity column. A side-effect of using ALTER TABLE to add a default to an identity column is this: the column ceases to be an identity column. The following script output shows this Derby behavior:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ij version 10.11
ij&amp;gt; connect &apos;jdbc:derby:memory:db;create=true&apos;;
ij&amp;gt; create table t1_01
(
    a int generated always as identity ( start with 10, increment by 20 ),
    b int
);
0 rows inserted/updated/deleted
ij&amp;gt; -- should not succeed but does
alter table t1_01 alter column a default 99;
0 rows inserted/updated/deleted
ij&amp;gt; mainline (1.8) &amp;gt; runsql zzz
ij version 10.11
ij&amp;gt; connect &apos;jdbc:derby:memory:db;create=true&apos;;
ij&amp;gt; create table t1_01
(
    a int generated always as identity ( start with 10, increment by 20 )
);
0 rows inserted/updated/deleted
ij&amp;gt; select c.autoincrementvalue, c.autoincrementstart, c.autoincrementinc, c.columndefault
from sys.syscolumns c, sys.systables t
where c.referenceid = t.tableid
and t.tablename = &apos;T1_01&apos;;
AUTOINCREMENTVALUE  |AUTOINCREMENTSTART  |AUTOINCREMENTINC    |COLUMNDEFAULT  
------------------------------------------------------------------------------
10                  |10                  |20                  |NULL           

1 row selected
ij&amp;gt; -- should not succeed but does
alter table t1_01 alter column a default 99;
0 rows inserted/updated/deleted
ij&amp;gt; select c.autoincrementvalue, c.autoincrementstart, c.autoincrementinc, c.columndefault
from sys.syscolumns c, sys.systables t
where c.referenceid = t.tableid
and t.tablename = &apos;T1_01&apos;;
AUTOINCREMENTVALUE  |AUTOINCREMENTSTART  |AUTOINCREMENTINC    |COLUMNDEFAULT  
------------------------------------------------------------------------------
NULL                |NULL                |NULL                |99             

1 row selected
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Fixing this deviation from the Standard will create a backward incompatibility. However, it is hard to imagine that any production application relies on this deviation. This is the sort of schema evolution which one tests out in the laboratory or resorts to during an application upgrade. A judicious use of RENAME COLUMN and ALTER TABLE should provide a usable workaround.&lt;/p&gt;

&lt;p&gt;For that reason, I think that we should correct this deviation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12709124">DERBY-6545</key>
            <summary>Should not be able to add a default to an identity column</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                            <label>derby_backport_reject_10_10</label>
                    </labels>
                <created>Thu, 17 Apr 2014 20:16:36 +0100</created>
                <updated>Fri, 10 Oct 2014 19:12:16 +0100</updated>
                            <resolved>Fri, 30 May 2014 15:32:20 +0100</resolved>
                                                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13973337" author="rhillegas" created="Thu, 17 Apr 2014 21:07:58 +0100"  >&lt;p&gt;Attaching derby-6545-01-aa-forbidDefaultOnIdentityColumn.diff. This patch forbids the adding of a default to an identity column. I will run tests.&lt;/p&gt;


&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;--------------&lt;/p&gt;

&lt;p&gt;M       java/engine/org/apache/derby/impl/sql/compile/ModifyColumnNode.java&lt;br/&gt;
M       java/engine/org/apache/derby/loc/messages.xml&lt;/p&gt;

&lt;p&gt;The change. The wording of an error message has been adjusted to account for this extra kind of forbidden alteration.&lt;/p&gt;

&lt;p&gt;--------------&lt;/p&gt;

&lt;p&gt;M       java/testing/org/apache/derbyTesting/functionTests/tests/lang/AutoIncrementTest.java&lt;/p&gt;

&lt;p&gt;A canonized deviation from the Standard has been converted into a test for the correct, Standard behavior.&lt;/p&gt;</comment>
                            <comment id="13973472" author="rhillegas" created="Thu, 17 Apr 2014 23:02:23 +0100"  >&lt;p&gt;Tests passed cleanly for me on derby-6545-01-aa-forbidDefaultOnIdentityColumn.diff.&lt;/p&gt;</comment>
                            <comment id="13973770" author="mikem" created="Fri, 18 Apr 2014 05:06:55 +0100"  >&lt;p&gt;the proposed change looks fine to me.  I think it should only be introduced in a new major release like 10.11, and&lt;br/&gt;
not backported due to the backward compatibility issue.  &lt;/p&gt;

&lt;p&gt;Rick, are there are soft and/or hard upgrade issues for a &quot;bad&quot; past table that has had identity turned off and a default added?  would it be worth adding upgrade test for this?&lt;/p&gt;</comment>
                            <comment id="13974009" author="rhillegas" created="Fri, 18 Apr 2014 13:19:28 +0100"  >&lt;p&gt;Thanks for the quick review, Mike. Not backporting this patch sounds appropriate to me. The upgrade behavior of this patch should be:&lt;/p&gt;

&lt;p&gt;1) If you soft-upgrade to 10.11, you will not be able to add a default to an identity column.&lt;/p&gt;

&lt;p&gt;2) If you soft-downgrade back to 10.10 or earlier, you will again be able to add a default to an identity column.&lt;/p&gt;

&lt;p&gt;I don&apos;t think that this patch creates any new problems for columns which used to be identity columns but were given defaults by 10.10 or earlier. The metadata changes and some debug printouts suggest that the old, non-Standard behavior was equivalent to the following sequence of transformations:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ALTER TABLE $tableName ALTER COLUMN $columnName DROP IDENTITY;

ALTER TABLE $tableName ALTER COLUMN $columnName DEFAULT $defaultValue;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It may be that there are problems with columns which have undergone these transformations. If so, those problems would affect the columns today in 10.10. This patch does not add any new problems. By itself, this patch does not change any metadata and it doesn&apos;t change any DML behavior. So I can&apos;t think of a problem case for these columns which I could add to the upgrade tests. But I&apos;m happy to add an upgrade test if someone can think of a problem case.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13974012" author="jira-bot" created="Fri, 18 Apr 2014 13:22:54 +0100"  >&lt;p&gt;Commit 1588455 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhillegas&quot; class=&quot;user-hover&quot; rel=&quot;rhillegas&quot;&gt;Rick Hillegas&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1588455&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1588455&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6545&quot; title=&quot;Should not be able to add a default to an identity column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6545&quot;&gt;&lt;del&gt;DERBY-6545&lt;/del&gt;&lt;/a&gt;: Prevent ALTER TABLE from adding a default to an identity column; commit derby-6545-01-aa-forbidDefaultOnIdentityColumn.diff.&lt;/p&gt;</comment>
                            <comment id="14013685" author="rhillegas" created="Fri, 30 May 2014 15:31:06 +0100"  >&lt;p&gt;Adding a release note for this issue.&lt;/p&gt;</comment>
                            <comment id="14013687" author="rhillegas" created="Fri, 30 May 2014 15:32:20 +0100"  >&lt;p&gt;I believe that this issue is fixed. Resolving so that the detailed release note will turn up in the 10.11 release notes.&lt;/p&gt;</comment>
                            <comment id="14023894" author="rhillegas" created="Mon, 9 Jun 2014 13:31:11 +0100"  >&lt;p&gt;Correcting a typo in the detailed release note.&lt;/p&gt;</comment>
                            <comment id="14167235" author="mikem" created="Fri, 10 Oct 2014 19:12:16 +0100"  >&lt;p&gt;marking not for backport as was discussed in the issue comments when this issue was originally being worked on.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12412008">DERBY-4011</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12640694" name="derby-6545-01-aa-forbidDefaultOnIdentityColumn.diff" size="2572" author="rhillegas" created="Thu, 17 Apr 2014 21:07:58 +0100"/>
                            <attachment id="12649202" name="releaseNote.html" size="3321" author="rhillegas" created="Mon, 9 Jun 2014 13:31:11 +0100"/>
                            <attachment id="12647601" name="releaseNote.html" size="3325" author="rhillegas" created="Fri, 30 May 2014 15:31:06 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10367"><![CDATA[Deviation from standard]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Apr 2014 04:06:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387447</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzoljr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387709</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>