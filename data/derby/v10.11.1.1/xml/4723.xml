<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:10:35 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4723/DERBY-4723.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4723] Using an instance lock to protect static shared data in EmbedPooledConnection</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4723</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;EmbedPooledConnection has the unsafe synchronization as follow.&lt;/p&gt;

&lt;p&gt;private static int idCounter = 0;&lt;/p&gt;

&lt;p&gt;private synchronized int nextId()&lt;/p&gt;
    {
        return idCounter++;
    }&lt;br/&gt;
&lt;br/&gt;
idCounter is a static shared data, and it is not proper to use a instance lock to protect it, especially when two instance of the class are created.&lt;br/&gt;
&lt;br/&gt;
it would be more safer to write this instead:&lt;br/&gt;
&lt;br/&gt;
private static synchronized int nextId()&lt;br/&gt;
    {
        return idCounter++;
    }</description>
                <environment></environment>
        <key id="12468135">DERBY-4723</key>
            <summary>Using an instance lock to protect static shared data in EmbedPooledConnection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="cashcrop">Wendy Feng</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Jun 2010 10:36:07 +0100</created>
                <updated>Mon, 17 Jun 2013 10:19:44 +0100</updated>
                            <resolved>Tue, 15 Feb 2011 14:00:53 +0000</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.3.2</fixVersion>
                    <fixVersion>10.6.2.4</fixVersion>
                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <timeoriginalestimate seconds="600">10m</timeoriginalestimate>
                            <timeestimate seconds="600">10m</timeestimate>
                                        <comments>
                            <comment id="12883502" author="kristwaa" created="Tue, 29 Jun 2010 11:14:53 +0100"  >&lt;p&gt;Hi Wendy,&lt;/p&gt;

&lt;p&gt;Thanks for reporting the issue.&lt;br/&gt;
The proposed fix sounds good, but before we implement it we may want to verify that we indeed need this data to be shared.&lt;/p&gt;

&lt;p&gt;As far as I can see, the id is used only for tracing. Having a local counter together with the id for the real connection would uniquely identify a pooled connection (would have to save this, since the real connection can be nullified), but we would then loose creation ordering information.&lt;br/&gt;
In any case I think accessing the shared state in this case won&apos;t cause any performance issues (once per pooled connection creation, minimal critical section size).&lt;/p&gt;

&lt;p&gt;Opinions anyone?&lt;br/&gt;
If I don&apos;t hear anything, I&apos;ll commit Wendy&apos;s proposed fix.&lt;/p&gt;</comment>
                            <comment id="12883509" author="knutanders" created="Tue, 29 Jun 2010 12:04:41 +0100"  >&lt;p&gt;I agree that Wendy&apos;s proposed fix sounds fine.&lt;/p&gt;

&lt;p&gt;Since the field is only used to identify the instance uniquely in toString(), and toString() already prints the value of Object.hashCode(), perhaps we could just remove this code? Object.hashCode() isn&apos;t guaranteed to return a unique value, but it&apos;s probably good enough for tracing purposes.&lt;/p&gt;</comment>
                            <comment id="12893168" author="kristwaa" created="Wed, 28 Jul 2010 13:56:55 +0100"  >&lt;p&gt;Attached patch 1a, which removes the code using incorrect synchronization.&lt;/p&gt;</comment>
                            <comment id="12893206" author="kristwaa" created="Wed, 28 Jul 2010 16:20:09 +0100"  >&lt;p&gt;Committed patch 1a to trunk with revision 980089.&lt;br/&gt;
Regression tests passed (12836 tests executed).&lt;/p&gt;</comment>
                            <comment id="12989877" author="kmarsden" created="Wed, 2 Feb 2011 23:37:39 +0000"  >&lt;p&gt;Reopen for backport&lt;/p&gt;</comment>
                            <comment id="12994623" author="kmarsden" created="Tue, 15 Feb 2011 01:55:03 +0000"  >&lt;p&gt;Assign to myself temporarily for backport.&lt;/p&gt;</comment>
                            <comment id="13685342" author="knutanders" created="Mon, 17 Jun 2013 10:19:44 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12497378">DERBY-4994</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12450696" name="derby-4723-1a-remove_code.diff" size="1286" author="kristwaa" created="Wed, 28 Jul 2010 13:56:55 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 29 Jun 2010 10:14:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24430</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0j13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36901</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>