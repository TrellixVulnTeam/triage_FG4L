<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5157/DERBY-5157.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5157] Incomplete quoting of SQL identifiers in AlterTableConstantAction</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5157</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;AlterTableConstantAction generates SQL statements various places. Identifiers (schema names, table names, column names) are surrounded with double quotes in case they contain special characters. This is not enough if the identifiers contain double quotes, as can be seen with this example:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; alter table t add column &quot;&quot;&quot;&quot; int default 42;&lt;br/&gt;
ERROR 42X01: Syntax error: Encountered &quot;\&quot;&quot; at line 1, column 22.&lt;/p&gt;

&lt;p&gt;I&apos;ve found three places where AlterTableConstantAction generates SQL statements: updateNewColumnToDefault(), updateNewAutoincrementColumn(), getColumnMax(). All three places suffer from this problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12502569">DERBY-5157</key>
            <summary>Incomplete quoting of SQL identifiers in AlterTableConstantAction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Mar 2011 13:33:42 +0100</created>
                <updated>Thu, 30 Jun 2011 10:21:41 +0100</updated>
                            <resolved>Tue, 29 Mar 2011 10:18:48 +0100</resolved>
                                    <version>10.7.1.1</version>
                                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13012027" author="knutanders" created="Mon, 28 Mar 2011 13:43:38 +0100"  >&lt;p&gt;I think the code in updateNewAutoincrementColumn() isn&apos;t currently in use because of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3888&quot; title=&quot;ALTER TABLE ... ADD COLUMN cannot add identity columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3888&quot;&gt;&lt;del&gt;DERBY-3888&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The bug in updateNewColumnToDefault() is shown by the ALTER TABLE statement in the bug description.&lt;/p&gt;

&lt;p&gt;The problem in getColumnMax() can be exposed by executing these statements:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t (&quot;&quot;&quot;&quot; int generated always as identity);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; alter table t alter column &quot;&quot;&quot;&quot; set increment by 2;&lt;br/&gt;
ERROR 42X01: Syntax error: Encountered &quot;APP&quot; at line 1, column 22.&lt;/p&gt;</comment>
                            <comment id="13012048" author="knutanders" created="Mon, 28 Mar 2011 14:28:34 +0100"  >&lt;p&gt;The attached patch fixes the problems by using the helper methods in IdUtil and StringUtil to do the quoting properly. It also adds test cases to verify the fixes (except the one in updateNewAutoincrementColumn() since that code isn&apos;t currently in use).&lt;/p&gt;</comment>
                            <comment id="13012282" author="dagw" created="Tue, 29 Mar 2011 01:04:03 +0100"  >&lt;p&gt;Patch looks good. I verified that the new test cases fail without the patch. Well, actually the first one did (&quot;testDerby5157_addColumnWithDefaultValue&quot;). The second one &quot;testDerby5157_changeIncrement&quot; subsequently gave a lock timeout in the &quot;CREATE SCHEMA&quot;.&lt;/p&gt;

&lt;p&gt;With the patch the tests ran fine.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13012373" author="knutanders" created="Tue, 29 Mar 2011 09:00:17 +0100"  >&lt;p&gt;Thanks for looking at the patch, Dag. I see a lock timeout in the second test case as well if I back out the fix. But if I only back out the fix in getColumnMax(), so that the first test case passes, the second one fails with the expected syntax error, so I think it does its job. I&apos;m a bit puzzled by the timeout exception, though. The transaction should be rolled back by BaseJDBCTestCase.tearDown() and release the locks, but for some reason rollback() fails with &quot;ERROR X0Y67: Cannot issue rollback in a nested connection when there is a pending operation in the parent connection.&quot; This isn&apos;t a problem introduced by the fix, so I&apos;ll go ahead committing the patch. I&apos;ll do some more digging and file a separate issue for the rollback problem if it looks like there is a bug.&lt;/p&gt;</comment>
                            <comment id="13012402" author="knutanders" created="Tue, 29 Mar 2011 10:18:48 +0100"  >&lt;p&gt;Logged &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5161&quot; title=&quot;Cannot rollback after syntax error in internal statement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5161&quot;&gt;&lt;del&gt;DERBY-5161&lt;/del&gt;&lt;/a&gt; for the rollback issue.&lt;/p&gt;

&lt;p&gt;Committed derby-5157-1a.diff to trunk with revision 1086526.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12502679">DERBY-5161</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12474774" name="derby-5157-1a.diff" size="4569" author="knutanders" created="Mon, 28 Mar 2011 14:28:34 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 29 Mar 2011 00:04:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24679</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0fvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36390</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>