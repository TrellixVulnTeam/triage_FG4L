<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:54:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3177/DERBY-3177.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3177] Dropping columns casues auto_increment field to be lost</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3177</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I have a DB that I&apos;ve been updating over time, and I&apos;ve run into this bug.  After running this script Messages.ID table looses it&apos;s auto incrementing column after running the script to completion.  If I create a virgin DB and run this script against the Message table&apos;s ID column looses it&apos;s auto increment data type.  If you comment out the last three alter table statements the column&apos;s auto increment feature is not lost.  You don&apos;t have to insert any data into the database for this to happen.&lt;/p&gt;

&lt;p&gt;I tried creating a simpler script to expose this problem, but was unsuccessful.  I tried something like:&lt;/p&gt;

&lt;p&gt;create table Messages ( &lt;br/&gt;
  Name varchar(256), &lt;br/&gt;
  KillThis varchar(256),&lt;br/&gt;
  id INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), &lt;br/&gt;
  CONSTRAINT MESSAGES_id_pk PRIMARY KEY(id) &lt;br/&gt;
);&lt;br/&gt;
alter table Messages drop column KillThis;&lt;/p&gt;

&lt;p&gt;However, this DID NOT EXPOSE THE BUG.  So there is something else at work causing this problem.  See the attached script to recreate the problem.&lt;/p&gt;</description>
                <environment>Windows XP SP2&lt;br/&gt;
JVM: Hotspot JVM 1.6&lt;br/&gt;
Derby: 10.3.1000004.561794</environment>
        <key id="12381920">DERBY-3177</key>
            <summary>Dropping columns casues auto_increment field to be lost</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="chubbard">Charlie Hubbard</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Nov 2007 14:56:39 +0000</created>
                <updated>Fri, 21 Jan 2011 17:51:01 +0000</updated>
                            <resolved>Wed, 21 Nov 2007 16:30:14 +0000</resolved>
                                    <version>10.3.1.4</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12540445" author="chubbard" created="Tue, 6 Nov 2007 14:57:13 +0000"  >&lt;p&gt;Script to reproduce the bug.&lt;/p&gt;</comment>
                            <comment id="12540852" author="bryanpendleton" created="Wed, 7 Nov 2007 19:23:48 +0000"  >&lt;p&gt;Attached is &apos;bug2.sql&apos;, a modified version of migration-bug.sql&lt;br/&gt;
in which I have added 3 &quot;select * from sys.syscolumns&quot;&lt;br/&gt;
statements to demonstrate that the autoinc* fields of the&lt;br/&gt;
syscolumns record for the id column of the messages table&lt;br/&gt;
get damaged by the alter table drop column statement.&lt;/p&gt;

&lt;p&gt;Running the script together with the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3175&quot; title=&quot;NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3175&quot;&gt;&lt;del&gt;DERBY-3175&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
does &lt;b&gt;not&lt;/b&gt; reproduce the problem, which provides some&lt;br/&gt;
evidence that this bug is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3175&quot; title=&quot;NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3175&quot;&gt;&lt;del&gt;DERBY-3175&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I propose to:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;include the bug2.sql test case into the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3175&quot; title=&quot;NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3175&quot;&gt;&lt;del&gt;DERBY-3175&lt;/del&gt;&lt;/a&gt; patch&lt;/li&gt;
	&lt;li&gt;mark this issue as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3177&quot; title=&quot;Dropping columns casues auto_increment field to be lost&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3177&quot;&gt;&lt;del&gt;DERBY-3177&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please let me know if this seems like the wrong course of action.&lt;/p&gt;</comment>
                            <comment id="12540962" author="bryanpendleton" created="Thu, 8 Nov 2007 04:38:13 +0000"  >&lt;p&gt;Unfortunately, I can&apos;t think of an easy way to repair the SYSCOLUMNS corruption.&lt;br/&gt;
I believe that the essence of the corruption is that the AUTOINCREMENTVALUE  ,&lt;br/&gt;
AUTOINCREMENTSTART , and AUTOINCREMENTINC columns of the&lt;br/&gt;
SYS.SYSCOLUMNS row for the &quot;ID&quot; column of the &quot;MESSAGES&quot; table have been &lt;br/&gt;
erroneously set to NULL, when they should have the values as described in&lt;br/&gt;
&lt;a href=&quot;http://db.apache.org/derby/docs/10.3/ref/rrefsistabs22441.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/10.3/ref/rrefsistabs22441.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Unfortunately, trying to issue an UPDATE statement against SYS.SYSCOLUMNS&lt;br/&gt;
to repair the damage produces the error:&lt;/p&gt;

&lt;p&gt;ERROR 42Y25: &apos;SYS.SYSCOLUMNS&apos; is a system table.  Users are not allowed to modify the contents of this table.&lt;/p&gt;

&lt;p&gt;and I don&apos;t know how to get around this error.&lt;/p&gt;

&lt;p&gt;So you may need to either restore your database from a backup, or &lt;br/&gt;
export the data and re-import it, after dropping and re-creating the table.&lt;/p&gt;

&lt;p&gt;Perhaps somebody else can think of an alternate way to repair the table,&lt;br/&gt;
and will post it.&lt;/p&gt;</comment>
                            <comment id="12543147" author="bryanpendleton" created="Fri, 16 Nov 2007 17:43:37 +0000"  >&lt;p&gt;Charlie, what do you think is the status of this issue at this point? In my environment,&lt;br/&gt;
the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3175&quot; title=&quot;NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3175&quot;&gt;&lt;del&gt;DERBY-3175&lt;/del&gt;&lt;/a&gt; patch makes the bug2.sql script run correctly, so my feeling is that&lt;br/&gt;
we should mark this issue as a resolved duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3175&quot; title=&quot;NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3175&quot;&gt;&lt;del&gt;DERBY-3175&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;However, in one of your comments to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3175&quot; title=&quot;NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3175&quot;&gt;&lt;del&gt;DERBY-3175&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
( &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3175#action_12541670&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DERBY-3175#action_12541670&lt;/a&gt; )&lt;br/&gt;
you indicated that you are still seeing problems even after the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3175&quot; title=&quot;NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3175&quot;&gt;&lt;del&gt;DERBY-3175&lt;/del&gt;&lt;/a&gt; fix.&lt;/p&gt;

&lt;p&gt;Can you provide a repro script that demonstrates those problems?&lt;/p&gt;

&lt;p&gt;Please let us know what you think would be best to do regarding this JIRA issue.&lt;/p&gt;</comment>
                            <comment id="12543321" author="chubbard" created="Sat, 17 Nov 2007 23:50:48 +0000"  >
&lt;p&gt;Well I have been very busy lately so I haven&apos;t had much time to dedicate looking into this.  I have been running my program fairly frequently with the patch for 3175.  Originally when I first ran my program with the patch I received an exception (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3175#action_12541670&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DERBY-3175#action_12541670&lt;/a&gt;) which someone said it looked like another bug 3197.  I turned on logging like they asked, but I haven&apos;t encountered the problem again.  Unfortunately, I have worked around the issue in 3177 so my program is different from when I modified it in the beginning.  However, it doesn&apos;t seem to be a problem at this time. &lt;/p&gt;

&lt;p&gt;Charlie&lt;/p&gt;</comment>
                            <comment id="12543323" author="bryanpendleton" created="Sun, 18 Nov 2007 00:22:10 +0000"  >&lt;p&gt;Thanks very much for the update, that is very helpful. Intermittent problems can be very frustrating, I agree. If you can keep your eyes open for the re-occurrence, and can keep the logging turned on so that we can capture more information when you encounter it again, that would be great. Thanks for the patience in trying to track these problems down.&lt;/p&gt;</comment>
                            <comment id="12543325" author="chubbard" created="Sun, 18 Nov 2007 00:44:37 +0000"  >&lt;p&gt;No problem!  It&apos;s easy working with ya&apos;ll.  I wouldn&apos;t have reverted the code had I known ya&apos;ll were so on top of it.  Most of the time issues are logged, and they are never worked on so I just wanted to say thanks for being so diligent.  Logging is on, and eyes are peeled. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12543715" author="knutanders" created="Mon, 19 Nov 2007 22:43:00 +0000"  >&lt;p&gt;Bryan, I think it is OK to close this one as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3175&quot; title=&quot;NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3175&quot;&gt;&lt;del&gt;DERBY-3175&lt;/del&gt;&lt;/a&gt;. The fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3175&quot; title=&quot;NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3175&quot;&gt;&lt;del&gt;DERBY-3175&lt;/del&gt;&lt;/a&gt; did fix the repro attached to this issue, and the other NullPointerException Charlie saw looks suspiciously similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3197&quot; title=&quot;NPE in ProjectRestrictResultSet on  finishAndRTS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3197&quot;&gt;&lt;del&gt;DERBY-3197&lt;/del&gt;&lt;/a&gt;, so we won&apos;t lose track of it if this issue is closed.&lt;/p&gt;</comment>
                            <comment id="12544522" author="bryanpendleton" created="Wed, 21 Nov 2007 16:30:14 +0000"  >&lt;p&gt;Resolving as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3175&quot; title=&quot;NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3175&quot;&gt;&lt;del&gt;DERBY-3175&lt;/del&gt;&lt;/a&gt;. I agree with Knut&apos;s&lt;br/&gt;
suggestion that &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3197&quot; title=&quot;NPE in ProjectRestrictResultSet on  finishAndRTS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3197&quot;&gt;&lt;del&gt;DERBY-3197&lt;/del&gt;&lt;/a&gt; describes the other NPE well.&lt;br/&gt;
I marked this issue as related to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3197&quot; title=&quot;NPE in ProjectRestrictResultSet on  finishAndRTS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3197&quot;&gt;&lt;del&gt;DERBY-3197&lt;/del&gt;&lt;/a&gt; since the repro&lt;br/&gt;
scripts in this issue might provide some clues about how to&lt;br/&gt;
reproduce &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3197&quot; title=&quot;NPE in ProjectRestrictResultSet on  finishAndRTS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3197&quot;&gt;&lt;del&gt;DERBY-3197&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12381898">DERBY-3175</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12382286">DERBY-3197</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12369133" name="bug2.sql" size="6603" author="bryanpendleton" created="Wed, 7 Nov 2007 19:23:48 +0000"/>
                            <attachment id="12369027" name="migration-bug.sql" size="6079" author="chubbard" created="Tue, 6 Nov 2007 14:57:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 7 Nov 2007 19:23:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23479</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0lxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37373</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10050"><![CDATA[Blocker]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>