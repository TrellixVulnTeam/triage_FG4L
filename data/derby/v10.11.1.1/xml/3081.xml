<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:47:54 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3081/DERBY-3081.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3081] cannot create instance of generated class because of java.lang.VerifyError in 4 tests on IBM iseries</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3081</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;4 tests fail to instantiate a generated class:&lt;/p&gt;

&lt;p&gt;	1) testTrimCharIsExpr(org.apache.derbyTesting.functionTests.tests.lang.AnsiTrimTest)java.sql.SQLException: Cannot create an instance of generated class org.apache.derby.exe.ac848c0061x0114xfee3x0ec7x0000636c39840.&lt;/p&gt;

&lt;p&gt;	2) testEnglishCollation(org.apache.derbyTesting.functionTests.tests.lang.CollationTest)java.sql.SQLException: Cannot create an instance of generated class org.apache.derby.exe.aca31ba168x0114xfee3x0ec7x0000636c39842a.&lt;/p&gt;

&lt;p&gt;	3) testNorwayCollation(org.apache.derbyTesting.functionTests.tests.lang.CollationTest)java.sql.SQLException: Cannot create an instance of generated class org.apache.derby.exe.ac066fa8c8x0114xfee3x0ec7x0000636c39842a.&lt;/p&gt;

&lt;p&gt;	4) testPolishCollation(org.apache.derbyTesting.functionTests.tests.lang.CollationTest)java.sql.SQLException: Nie mo?na utworzy? instancji wygenerowanej klasy org.apache.derby.exe.ac86a73025x0114xfee3x0ec7x0000636c39842a.&lt;/p&gt;

&lt;p&gt;All these something like this:&lt;br/&gt;
    ------------------------&lt;br/&gt;
    Caused by: java.lang.VerifyError: org/apache/derby/exe/ac86a73025x0114xfee3x0ec7x0000636c39842a 0000 0000 &lt;br/&gt;
	at java.lang.Throwable.&amp;lt;init&amp;gt;(Throwable.java:195)&lt;br/&gt;
	at java.lang.Error.&amp;lt;init&amp;gt;(Error.java:49)&lt;br/&gt;
	at java.lang.VerifyError.&amp;lt;init&amp;gt;(VerifyError.java:34)&lt;br/&gt;
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)&lt;br/&gt;
	at java.lang.reflect.Constructor.newInstance(Constructor.java:274)&lt;br/&gt;
	at org.apache.derby.iapi.services.loader.ClassInfo.getNewInstance(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.reflect.LoadedGeneratedClass.newInstance(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.reflect.ReflectGeneratedClass.newInstance(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericActivationHolder.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.getActivation(Unknown Source)&lt;/p&gt;</description>
                <environment>IBM iseries, OS: V5R4M0; both with ibm 142 (build 1.4.2_08-b02) and 15 jvm (build 1.5.0_03-b07)</environment>
        <key id="12378615">DERBY-3081</key>
            <summary>cannot create instance of generated class because of java.lang.VerifyError in 4 tests on IBM iseries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Sep 2007 03:57:42 +0100</created>
                <updated>Wed, 14 Nov 2007 22:37:54 +0000</updated>
                            <resolved>Wed, 26 Sep 2007 21:19:11 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.2.1</fixVersion>
                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12529931" author="kmarsden" created="Mon, 24 Sep 2007 19:14:22 +0100"  >&lt;p&gt;The case from testTrimCharIsExpr reproduces with ij.&lt;/p&gt;

&lt;p&gt; create table tt (id int, v varchar(16), c char(16), cl clob(10240));  &lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
  ij(CONNECTION1)&amp;gt;&lt;br/&gt;
&amp;gt; insert into tt values (1, &apos;abcaca&apos;, &apos;abcaca&apos;, &apos;abcaca&apos;);&lt;br/&gt;
  1 row inserted/updated/deleted&lt;br/&gt;
  ij(CONNECTION1)&amp;gt;&lt;br/&gt;
&amp;gt; SELECT count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM tt  WHERE id = 1 AND (trim (leading substr(v,1,1) from v&lt;br/&gt;
  )) = &apos;bcaca&apos;;&lt;br/&gt;
  ERROR XBCM2: Cannot create an instance of generated class org.apache.derby.ex&lt;br/&gt;
  e.ac12564092x0115x38a7xf2edx00000104c6301.&lt;br/&gt;
  ERROR XJ001: Java exception: &apos;org/apache/derby/exe/ac12564092x0115x38a7xf2edx&lt;br/&gt;
  00000104c6301 0000 0000 : java.lang.VerifyError&apos;.&lt;br/&gt;
  ij(CONNECTION1)&amp;gt;&lt;br/&gt;
&amp;gt; exit;&lt;/p&gt;

&lt;p&gt;Unfortunately I can&apos;t seem to get the class file to dump even with &lt;br/&gt;
 derby.debug.true=DumpClassFile&lt;/p&gt;

&lt;p&gt;I seem to recall some sort of problem with this if the failure came early, but I can&apos;t find the Jira entry right now.  &lt;/p&gt;

</comment>
                            <comment id="12529939" author="kmarsden" created="Mon, 24 Sep 2007 19:48:58 +0100"  >&lt;p&gt;I was able to generate the class on Windows   I am attaching that class and the decompiled with javap -private.&lt;/p&gt;

&lt;p&gt;If I  ftp over to iseries,  java -verify yields:&lt;br/&gt;
&amp;gt; java  -verify org.apache.derby.exe.ac601a400fx0115x38bex8045x0000004554b80&lt;br/&gt;
  java.lang.VerifyError: org/apache/derby/exe/ac601a400fx0115x38bex8045x0000004&lt;br/&gt;
  554b80 0000 0000&lt;br/&gt;
          at java.lang.Throwable.&amp;lt;init&amp;gt;(Throwable.java:195)&lt;br/&gt;
          at java.lang.Error.&amp;lt;init&amp;gt;(Error.java:49)&lt;br/&gt;
          at java.lang.VerifyError.&amp;lt;init&amp;gt;(VerifyError.java:34)&lt;/p&gt;


&lt;p&gt;I am guessing we are hitting something similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-488&quot; title=&quot;DatabaseMetaData.getColumns() fails on iSeries JDK 1.4 with verfier error on generated class.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-488&quot;&gt;&lt;del&gt;DERBY-488&lt;/del&gt;&lt;/a&gt; where the iseries JVM is more strict than the other jvms.&lt;/p&gt;

&lt;p&gt;Exactly how to determine the offensive code from this point is pretty fuzzy to me.  Any thoughts are greatly appreciated.&lt;/p&gt;
</comment>
                            <comment id="12529954" author="kmarsden" created="Mon, 24 Sep 2007 20:58:46 +0100"  >&lt;p&gt;I am guessing this issue is related to the addition of ANSI TRIM functionality &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1623&quot; title=&quot;Add ANSI TRIM implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1623&quot;&gt;&lt;del&gt;DERBY-1623&lt;/del&gt;&lt;/a&gt;, probably specifically the new code in TernaryOperatorNode, but the issue is not immediately apparent to my untrained eye.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc/db/derby/code/trunk/java/engine/org/apache/derby/impl/sql/compile/TernaryOperatorNode.java?p2=%2Fdb%2Fderby%2Fcode%2Ftrunk%2Fjava%2Fengine%2Forg%2Fapache%2Fderby%2Fimpl%2Fsql%2Fcompile%2FTernaryOperatorNode.java&amp;amp;p1=%2Fdb%2Fderby%2Fcode%2Ftrunk%2Fjava%2Fengine%2Forg%2Fapache%2Fderby%2Fimpl%2Fsql%2Fcompile%2FTernaryOperatorNode.java&amp;amp;r1=546183&amp;amp;r2=546182&amp;amp;view=diff&amp;amp;pathrev=546183&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/db/derby/code/trunk/java/engine/org/apache/derby/impl/sql/compile/TernaryOperatorNode.java?p2=%2Fdb%2Fderby%2Fcode%2Ftrunk%2Fjava%2Fengine%2Forg%2Fapache%2Fderby%2Fimpl%2Fsql%2Fcompile%2FTernaryOperatorNode.java&amp;amp;p1=%2Fdb%2Fderby%2Fcode%2Ftrunk%2Fjava%2Fengine%2Forg%2Fapache%2Fderby%2Fimpl%2Fsql%2Fcompile%2FTernaryOperatorNode.java&amp;amp;r1=546183&amp;amp;r2=546182&amp;amp;view=diff&amp;amp;pathrev=546183&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12530005" author="kmarsden" created="Mon, 24 Sep 2007 23:35:30 +0100"  >&lt;p&gt;Attached is an initial attempt to fix this issue. I would most appreciate review from someone familiar with byte code generation as it is a weak area for me.  The patch changes &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;mb.upCast(leftInterfaceType);&lt;br/&gt;
to &lt;br/&gt;
+                       mb.cast(leftInterfaceType);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;to properly cast the argument to StringDataValue.   Essentially what we were ending up with in the generated code was this:&lt;/p&gt;

&lt;p&gt;  public Object e2()&lt;br/&gt;
        throws StandardException, Exception&lt;br/&gt;
    {&lt;br/&gt;
        ConcatableDataValue concatabledatavalue = ((StringDataValue)getColumnFromRow(2, 2)).substring(getDataValueFactory().getDataValue(1, null), getDataValueFactory().getDataValue(1, null), e3, 16);&lt;br/&gt;
        e3 = concatabledatavalue;&lt;br/&gt;
        StringDataValue stringdatavalue = ((StringDataValue)getColumnFromRow(2, 2)).ansiTrim(2, concatabledatavalue, e2);&lt;br/&gt;
....&lt;/p&gt;

&lt;p&gt;So we were passing a ConcatableDataValue instead of a StringDataValue to ansiTrim.  Changing from upCast to cast forces the cast so that ansiTrim gets called, but I am not sure I entirely understand the implications of the change.  Please take a look at this one line change and let me know what you think.&lt;/p&gt;

&lt;p&gt;So far I only verified that the reproducible case passes on iseries and windows and that AnsiTrimTest  passes on Windows.  I&apos;ll run the full set of tests on iseries after I confirm I am on the right track here.&lt;/p&gt;


&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;

</comment>
                            <comment id="12530545" author="kmarsden" created="Wed, 26 Sep 2007 21:19:11 +0100"  >&lt;p&gt;fixed in trunk and 10.3 branch&lt;/p&gt;</comment>
                            <comment id="12530546" author="mamtas" created="Wed, 26 Sep 2007 21:24:02 +0100"  >&lt;p&gt;With my limited knowledge of code generation. I am not sure if I can provide a very educated code review for the patch but the changes look fine to me.&lt;/p&gt;</comment>
                            <comment id="12530552" author="kmarsden" created="Wed, 26 Sep 2007 21:48:48 +0100"  >&lt;p&gt;Thanks Mamta for looking at the patch!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12347086">DERBY-1623</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12366497" name="DERBY-3081_try1_diff.txt" size="534" author="kmarsden" created="Mon, 24 Sep 2007 23:35:30 +0100"/>
                            <attachment id="12366498" name="DERBY-3081_try1_stat.txt" size="79" author="kmarsden" created="Mon, 24 Sep 2007 23:35:30 +0100"/>
                            <attachment id="12366481" name="ac601a400fx0115x38bex8045x0000004554b80.class" size="7110" author="kmarsden" created="Mon, 24 Sep 2007 19:48:58 +0100"/>
                            <attachment id="12366482" name="javap.out" size="16507" author="kmarsden" created="Mon, 24 Sep 2007 19:48:58 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 24 Sep 2007 18:14:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23417</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy10rj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39774</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>