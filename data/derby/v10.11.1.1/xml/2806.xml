<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:50:44 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2806/DERBY-2806.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2806] calling getByteLength on org.apache.derby.impl.jdbc.StoreStreamClob makes BinaryStream, fetched before this call, unusable</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2806</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;StoreStreamClob.getByteLength first resets the internal stream and then reads the entire stream. Due to this any read on Stream obtained by StoreStreamClob.getRawByteStream returns -1.&lt;/p&gt;

&lt;p&gt;StoreStreamClob is a read only InternalClob, so probably keeping the length in a variable will be good idea.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12371445">DERBY-2806</key>
            <summary>calling getByteLength on org.apache.derby.impl.jdbc.StoreStreamClob makes BinaryStream, fetched before this call, unusable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="anurag">Anurag Shekhar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jun 2007 07:52:48 +0100</created>
                <updated>Mon, 9 Feb 2009 12:47:57 +0000</updated>
                            <resolved>Thu, 14 Jun 2007 23:06:30 +0100</resolved>
                                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12504274" author="kristwaa" created="Wed, 13 Jun 2007 15:59:15 +0100"  >&lt;p&gt;Attached &apos;derby-2806-1a.diff&apos;, which is a first shot at this issue.&lt;/p&gt;

&lt;p&gt;I consider separating the error reporting changes into a separate patch.&lt;br/&gt;
I have added a position-aware stream on top of the stream from store (OverflowInputStream), which can reposition itself on request and also tell its current position.&lt;br/&gt;
It affects only Clob (I have overridden getStream() in SQLClob).&lt;/p&gt;

&lt;p&gt;There seems to be a certain misfit in placement of the store class... I&apos;m also not 100% certain if more logic is needed to only ever return one instance of the PositionedStoreStream. Currently, it is possible to call getStream() twice, get two instances of the positioned reader and then make the out of sync with the underlying stream. I will investigate this.&lt;/p&gt;

&lt;p&gt;Note that a positioned stream is only created on top of Resetable-streams.&lt;/p&gt;

&lt;p&gt;Nice if anyone could take a look.&lt;/p&gt;</comment>
                            <comment id="12504276" author="kristwaa" created="Wed, 13 Jun 2007 16:00:54 +0100"  >&lt;p&gt;Forgot to say, all our tests run without failures with the preliminary patch.&lt;/p&gt;</comment>
                            <comment id="12504333" author="anurag" created="Wed, 13 Jun 2007 18:19:36 +0100"  >&lt;p&gt;reproducible for this bug.&lt;/p&gt;</comment>
                            <comment id="12504336" author="anurag" created="Wed, 13 Jun 2007 18:22:20 +0100"  >&lt;p&gt;This issue is not limited to clob. Blob too has similar problem. The reproducible i attached has reproducible for both blob and clob. I will be creating a separate issue to handle blob. Also this is not a regression this issue is present in 10.2.2.0 and 10.1. I haven&apos;t tried any other release.&lt;/p&gt;</comment>
                            <comment id="12504339" author="anurag" created="Wed, 13 Jun 2007 18:25:17 +0100"  >&lt;p&gt;Running the reproducible on trunk gives UTF8Format exception and on 10.2.2 it returns -1 indicating end of stream. Both behavior are due to same issue.&lt;/p&gt;</comment>
                            <comment id="12504354" author="anurag" created="Wed, 13 Jun 2007 18:53:36 +0100"  >&lt;p&gt;Producible (clob part) runs without error with this patch. &lt;/p&gt;</comment>
                            <comment id="12504934" author="kristwaa" created="Thu, 14 Jun 2007 22:45:29 +0100"  >&lt;p&gt;I wasn&apos;t able to get the repro to fail, and it was a bit hard to understand from the output if it did fail or not.&lt;br/&gt;
Maybe some other patch has changed the behavior.&lt;br/&gt;
In my next patch I will add a new test called ClobUpdateableReader.testMultiplexedOperationProblem, which does still fail without the patch. It only tests if Clob experiences the bug.&lt;/p&gt;</comment>
                            <comment id="12504938" author="kristwaa" created="Thu, 14 Jun 2007 22:55:50 +0100"  >&lt;p&gt;&apos;derby-2806-2a.diff&apos; implements the required changes and adds a test case that demonstrates the bug/problem.&lt;br/&gt;
Changes from the previous patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Instead of returning/creating the PositionedStoreStream in SQLClob, it is done in StoreStreamClob.&lt;br/&gt;
    This is better since it isolates the change more.&lt;/li&gt;
	&lt;li&gt;PositionedStoreStream no longer handle the encoded length. This was too specific, and should be handled in the next higher level instead. This allows it to be used for both Clob and Blob.&lt;/li&gt;
	&lt;li&gt;Removed some unrelated, though valid, changes regarding error reporting. I hope to address them in a separate Jira.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Ran suites.All/derbyall without failures.&lt;/p&gt;</comment>
                            <comment id="12504942" author="kristwaa" created="Thu, 14 Jun 2007 23:06:30 +0100"  >&lt;p&gt;Committed &apos;derby-2806-2a.diff&apos; to trunk with revision 547422.&lt;/p&gt;

&lt;p&gt;This bug is also present in 10.2, but I do not plan to back-port it to that branch. This is due to the fact that the Clob code has been heavily rewritten and reorganized for 10.3 and I think it might be hard to fix the bug in 10.2 without a rather large fix (my gut feeling, there might be a simple way...).&lt;/p&gt;</comment>
                            <comment id="12504973" author="kristwaa" created="Fri, 15 Jun 2007 01:12:13 +0100"  >&lt;p&gt;&apos;derby-2806-3a-test_fix_and_cleanup.diff&apos; is a patch fixing the ClobUpdatableReaderTest failure.&lt;br/&gt;
I had forgotten to turn off autocommit and do some resource cleanup, but for some reason it worked in the JVM I used when I wrote and ran the test.&lt;br/&gt;
I also cleaned up the patch in general, using the convenience methods instead of keeping a reference to the connection and calling the methods on it directly.&lt;/p&gt;

&lt;p&gt;Sorry for the unnecessary noise &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12504974" author="kristwaa" created="Fri, 15 Jun 2007 01:15:56 +0100"  >&lt;p&gt;Committed &apos;derby-2806-3a-test_fix_and_cleanup.diff&apos; to trunk with revision 547461.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12371623">DERBY-2818</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12371554">DERBY-2812</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12359619" name="Derby2806.java" size="3224" author="anurag" created="Wed, 13 Jun 2007 18:19:36 +0100"/>
                            <attachment id="12359605" name="derby-2806-1a.diff" size="18253" author="kristwaa" created="Wed, 13 Jun 2007 15:59:14 +0100"/>
                            <attachment id="12359777" name="derby-2806-2a.diff" size="24779" author="kristwaa" created="Thu, 14 Jun 2007 22:55:50 +0100"/>
                            <attachment id="12359778" name="derby-2806-2a.stat" size="304" author="kristwaa" created="Thu, 14 Jun 2007 22:55:50 +0100"/>
                            <attachment id="12359787" name="derby-2806-3a-test_fix_and_cleanup.diff" size="13114" author="kristwaa" created="Fri, 15 Jun 2007 01:12:13 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 13 Jun 2007 14:59:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23258</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ya7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39372</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>