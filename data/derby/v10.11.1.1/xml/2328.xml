<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:52:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2328/DERBY-2328.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2328] Reduce monitor contention in SinglePool</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2328</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When multiple threads enter the lock manager, there might be contention on SinglePool&apos;s monitor. The contention should be reduced in order to improve scalability.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12362668">DERBY-2328</key>
            <summary>Reduce monitor contention in SinglePool</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12348056">DERBY-1704</parent>
                                    <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Feb 2007 09:25:43 +0000</created>
                <updated>Mon, 29 Jun 2009 15:15:57 +0100</updated>
                            <resolved>Thu, 1 Mar 2007 08:13:42 +0000</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12472599" author="knutanders" created="Tue, 13 Feb 2007 09:50:44 +0000"  >&lt;p&gt;SinglePool&apos;s monitor is only locked when one needs to fetch the LockSpace object associated with a compatibility space from SinglePool&apos;s hash table. A hash table is used because the lock manager API says that any object can be a compatibility space, and that two objects, a and b, refer to the same compatibility space if a.equals(b) returns true. In the current Derby code, there are no compatibility spaces that are considered equal by equals() that are not considered equal by the == operator. Therefore, we could make the API have stricter requirements to the compatibility space objects (for instance that they must be == and created by a createCompatibilitySpace method) and remove the hash table. Each compatibility space object would have a direct reference to its locks. Since there would be no hash table to synchronize on, the problem with monitor contention would be solved. Also, there would be less indirection which could also be beneficial in the single-user case.&lt;/p&gt;</comment>
                            <comment id="12472702" author="djd" created="Tue, 13 Feb 2007 15:12:15 +0000"  >&lt;p&gt;I  think you are proposing that the LockFactory has a createCompatibilitySpace method that returns some interface, say CompatibilitySpace. Then all methods in the lock api that take &apos;Object compatibilitySpace&apos; would change to &apos;CompatibilitySpace compatibilitySpace&apos;. Without the specific interface the api could be become subject for bugs if a object not created by createCompatibilitySpace is passed in.&lt;br/&gt;
With this approach I don&apos;t see any need to specifiy/require anything about equals for CompatibilitySpace, but maybe I&apos;m missing something.&lt;/p&gt;

&lt;p&gt;I think this is a good approach, the existing code valued footprint over multi-cpu performance (and maybe the existing approach did not save footprint due to the memory used by the hashtable).&lt;br/&gt;
Seems this approach only needs one new class, the interface CompatibilitySpace, and then the existing LockSpace would implement it.&lt;/p&gt;</comment>
                            <comment id="12472720" author="knutanders" created="Tue, 13 Feb 2007 15:49:07 +0000"  >&lt;p&gt;&amp;gt; but maybe I&apos;m missing something.&lt;br/&gt;
Nope, you&apos;re not missing anything! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I think your suggestions sound great.&lt;/p&gt;</comment>
                            <comment id="12473057" author="knutanders" created="Wed, 14 Feb 2007 12:05:26 +0000"  >&lt;p&gt;LanguageConnectionContext has a method called getLockSpace(int) which creates a compatibility space, but the method is not used. unused.diff removes the method so that it doesn&apos;t complicate things when the use of compatibility space objects changes. All the tests passed.&lt;/p&gt;</comment>
                            <comment id="12473059" author="knutanders" created="Wed, 14 Feb 2007 12:10:33 +0000"  >&lt;p&gt;getLockSpace(int) in the previous comment should have been getLockObject(int). Committed unused.diff with revision 507500.&lt;/p&gt;</comment>
                            <comment id="12474188" author="knutanders" created="Mon, 19 Feb 2007 14:43:08 +0000"  >&lt;p&gt;derby-2328.diff removes the Hashtable in SinglePool. Derbyall and the JUnit tests passed on Solaris 10/JDK6.&lt;/p&gt;

&lt;p&gt;Description of the changes:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;New method in LockFactory: createCompatibilitySpace()&lt;/li&gt;
	&lt;li&gt;New (almost empty) interface CompatibilitySpace to be returned from createCompatibilitySpace()&lt;/li&gt;
	&lt;li&gt;LockSpace implements CompatibilitySpace and is returned by SinglePool.createCompatibilitySpace()&lt;/li&gt;
	&lt;li&gt;SinglePool no longer extends Hashtable. Now it casts the supplied compatibility space object to LockSpace and uses it directly.&lt;/li&gt;
	&lt;li&gt;Modified signatures of all methods/variables that used compatibility spaces (Object -&amp;gt; CompatibilitySpace)&lt;/li&gt;
	&lt;li&gt;Modified code that assumed compatibility space objects were transaction objects (virtual lock table and code that locked an object with the transaction as lock group)&lt;/li&gt;
	&lt;li&gt;Code that tested space1.equals(space2) was changed to (space1 == space2)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Because of the signature changes the patch grew quite big. Reviews would be greatly appreciated. Thanks.&lt;/p&gt;</comment>
                            <comment id="12476570" author="olav" created="Wed, 28 Feb 2007 12:45:00 +0000"  >&lt;p&gt;Adding comments sent earlier today to derby-dev when JIRA was unavailable:&lt;br/&gt;
=====================================================&lt;/p&gt;

&lt;p&gt;I have downloaded and reviewed the patch. I like the introduction of the CompatibilitySpace interface and having to explicitly to create compatibility spaces. It mades the code more readable. Also removing the hash table from SinglePool is good both for simplifying the code, readability and performance (CPU and monitor contention). The patch looks very good.&lt;/p&gt;

&lt;p&gt;I have only some very minor nits:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;java/engine/org/apache/derby/impl/services/locks/LockSpace.java:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   -since you have changed the signature of the LockSpace constructor you should consider adding JavaDoc describing the new parameter (Object owner).&lt;br/&gt;
   -it might also be an idea to explain the &quot;owner&quot; concept in the JavaDoc for the class since this is a new concept you are introducing?&lt;br/&gt;
    (and if you change the JavaDoc for the class, you can probably also change the sentence refeering the &quot;a hashtable keyed by...&quot; to a &quot;hash map keyed by....&quot;)&lt;/p&gt;

&lt;p&gt;I have run the derbyall and Junit test suites with the patch. Only the two tests that currently fail in the thinderbox test failed.&lt;/p&gt;

&lt;p&gt;+1 to commit this patch.&lt;/p&gt;

&lt;p&gt;Thanks for the work on this, Knut Anders!&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Olav &lt;/p&gt;</comment>
                            <comment id="12476859" author="knutanders" created="Thu, 1 Mar 2007 08:13:42 +0000"  >&lt;p&gt;Thanks for the review, Olav! I made some changes to the javadoc as you suggested and committed revision 513222.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12351507" name="derby-2328.diff" size="74482" author="knutanders" created="Mon, 19 Feb 2007 14:43:08 +0000"/>
                            <attachment id="12351508" name="derby-2328.stat" size="2479" author="knutanders" created="Mon, 19 Feb 2007 14:43:08 +0000"/>
                            <attachment id="12351130" name="unused.diff" size="1999" author="knutanders" created="Wed, 14 Feb 2007 12:05:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10362"><![CDATA[Performance]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 13 Feb 2007 15:12:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30383</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0wnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39110</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>