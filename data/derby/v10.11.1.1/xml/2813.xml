<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:58 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2813/DERBY-2813.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2813] store/ClassLoaderBootTest fixture testBootingAnAlreadyBootedDatabase fails indicating derby booted a database that was already booted by another CLR if security manager is on</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2813</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description></description>
                <environment>The test ClassLoaderBoot test currently runs without security manager. Security manager needs to be enabled.&lt;br/&gt;
</environment>
        <key id="12371570">DERBY-2813</key>
            <summary>store/ClassLoaderBootTest fixture testBootingAnAlreadyBootedDatabase fails indicating derby booted a database that was already booted by another CLR if security manager is on</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                            <label>derby_triage10_11</label>
                    </labels>
                <created>Wed, 13 Jun 2007 22:59:14 +0100</created>
                <updated>Thu, 24 Oct 2013 21:33:32 +0100</updated>
                                            <version>10.3.1.4</version>
                    <version>10.11.1.1</version>
                                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12576379" author="kmarsden" created="Fri, 7 Mar 2008 21:28:25 +0000"  >&lt;p&gt;unassigning. I am not currently working on this issue.&lt;/p&gt;</comment>
                            <comment id="12758825" author="kmarsden" created="Wed, 23 Sep 2009 19:46:51 +0100"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;With the current &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-700&quot; title=&quot;Derby does not prevent dual boot of database from different classloaders on Linux and Mac OS X&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-700&quot;&gt;&lt;del&gt;DERBY-700&lt;/del&gt;&lt;/a&gt; fix, was there still a problem with running this test under security manager?  I  can&apos;t remember now what the original issues were or if they were test or product related.&lt;/p&gt;</comment>
                            <comment id="12758835" author="rhillegas" created="Wed, 23 Sep 2009 20:07:03 +0100"  >&lt;p&gt;Hi Kathey,&lt;/p&gt;

&lt;p&gt;The fix to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-700&quot; title=&quot;Derby does not prevent dual boot of database from different classloaders on Linux and Mac OS X&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-700&quot;&gt;&lt;del&gt;DERBY-700&lt;/del&gt;&lt;/a&gt; did not address the problems with running this test under a security manager. The test now runs under the decorator which disables the security manager.&lt;/p&gt;</comment>
                            <comment id="13741238" author="myrna" created="Thu, 15 Aug 2013 18:34:14 +0100"  >&lt;p&gt;From browsing through &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-700&quot; title=&quot;Derby does not prevent dual boot of database from different classloaders on Linux and Mac OS X&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-700&quot;&gt;&lt;del&gt;DERBY-700&lt;/del&gt;&lt;/a&gt;, and looking through past bugs, it looks like the problem was that if security Manager is switched on, the test fails.&lt;br/&gt;
So, if the last line of in the suite() method in the test:&lt;br/&gt;
        &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
        Properties p = new Properties();&lt;br/&gt;
        p.setProperty(&quot;derby.infolog.append&quot;, &quot;true&quot;);&lt;/p&gt;

&lt;p&gt;        setup = new SystemPropertyTestSetup(setup,p);&lt;br/&gt;
        return SecurityManagerSetup.noSecurityManager(setup);&lt;br/&gt;
Is replaced by:&lt;br/&gt;
        return setup;&lt;br/&gt;
Then the test passes when run with classes, but fails as follows when run with jars (I tried with sane):&lt;/p&gt;

&lt;p&gt;1) testBootingAnAlreadyBootedDatabase(org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest)junit.framework.AssertionFailedError: booted database that was already booted by another CLR&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest.testBootingAnAlreadyBootedDatabase(ClassLoaderBootTest.java:179)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;

&lt;p&gt;This comes from the following section in the test:&lt;/p&gt;

&lt;p&gt;        // first boot the database using one loader and attempt &lt;br/&gt;
        // to boot it using another loader, it should fail to boot.&lt;/p&gt;

&lt;p&gt;        setThreadLoader(loader_1);&lt;br/&gt;
        DataSource ds_1 = JDBCDataSource.getDataSource();&lt;br/&gt;
        Connection conn1 = ds_1.getConnection();&lt;br/&gt;
        // now attemp to boot using another class loader.&lt;br/&gt;
        setThreadLoader(loader_2);&lt;br/&gt;
        DataSource ds_2 = JDBCDataSource.getDataSource();&lt;br/&gt;
        try &lt;/p&gt;
{
            ds_2.getConnection();
:179=&amp;gt;      fail(&quot;booted database that was already booted by another CLR&quot;);
        }
&lt;p&gt; catch (SQLException e) &lt;/p&gt;
{
            SQLException ne = e.getNextException();
            assertPreventDualBoot(ne);
            JDBCDataSource.shutEngine(ds_2);
        }</comment>
                            <comment id="13741257" author="kmarsden" created="Thu, 15 Aug 2013 18:49:08 +0100"  >&lt;p&gt;That failure looks serious.  It seems like with jars and security manager on we are able to dual boot the database which would be a bad bug.&lt;/p&gt;</comment>
                            <comment id="13741274" author="myrna" created="Thu, 15 Aug 2013 18:56:03 +0100"  >&lt;p&gt;Changed this from a sub-task to a bug, and also marked it higher prio and urgency and adjusted the title.&lt;/p&gt;</comment>
                            <comment id="13742452" author="kmarsden" created="Fri, 16 Aug 2013 18:52:45 +0100"  >&lt;p&gt;Looking at the derby.log after running the test with security manager on, it for some reason uses the default class loader instead of DerbyURLClassLoader and so this is why we do not get the dual boot message. So it looks like indeed a test issue and not an actual dual boot.&lt;/p&gt;</comment>
                            <comment id="13799940" author="kmarsden" created="Sat, 19 Oct 2013 17:25:42 +0100"  >&lt;p&gt;Unchecking HVF since this is just a test issue.&lt;/p&gt;</comment>
                            <comment id="13804641" author="kmarsden" created="Thu, 24 Oct 2013 21:31:42 +0100"  >&lt;p&gt;Attaching a patch that just gives a better assert when run with security manager. The new assertion shows that the ClassLoader of the datasource is wrong instead of indicating dual boot.  Also changes an instance of getContextClassLoader to be in a privilege block and fixes up a couple comments.&lt;/p&gt;

&lt;p&gt;I can&apos;t quite figure out why we are not getting the right class loader with security manager.  setContextClassLoader seems to be executing properly but for some reason the instantiated data source does not pick it up, but I will go ahead and check in this patch as at least it makes the real problem clearer. The new  failure with security manager on is &lt;/p&gt;

&lt;p&gt;1) testBootingAnAlreadyBootedDatabase(org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest)junit.framew&lt;br/&gt;
ork.AssertionFailedError: expected:&amp;lt;org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest$DerbyURLClassL&lt;br/&gt;
oader@b1b0b1b&amp;gt; but was:&amp;lt;sun.misc.Launcher$AppClassLoader@1e261e26&amp;gt;&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest.testBootingAnAlreadyBootedDatabase(Clas&lt;br/&gt;
sLoaderBootTest.java:174)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
2) testBootingDatabaseShutdownByAnotherCLR(org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest)junit.f&lt;br/&gt;
ramework.AssertionFailedError: expected:&amp;lt;org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest$DerbyURLC&lt;br/&gt;
lassLoader@48874887&amp;gt; but was:&amp;lt;sun.misc.Launcher$AppClassLoader@1e261e26&amp;gt;&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.ClassLoaderBootTest.testBootingDatabaseShutdownByAnotherCLR&lt;br/&gt;
(ClassLoaderBootTest.java:207)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 2,  Failures: 2,  Errors: 0&lt;/p&gt;</comment>
                            <comment id="13804642" author="jira-bot" created="Thu, 24 Oct 2013 21:33:32 +0100"  >&lt;p&gt;Commit 1535536 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kmarsden&quot; class=&quot;user-hover&quot; rel=&quot;kmarsden&quot;&gt;Kathey Marsden&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1535536&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1535536&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2813&quot; title=&quot;store/ClassLoaderBootTest fixture testBootingAnAlreadyBootedDatabase fails indicating derby booted a database that was already booted by another CLR if security manager is on&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2813&quot;&gt;DERBY-2813&lt;/a&gt; store/ClassLoaderBootTest fixture testBootingAnAlreadyBootedDatabase fails indicating derby booted a database that was already booted by another CLR if security manager is on&lt;/p&gt;

&lt;p&gt;This patch just improves the assertion with security manager on to show that we are picking up the wrong class loader. It does not fix the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12610143" name="derby-2813_betterassert_diff.txt" size="3526" author="kmarsden" created="Thu, 24 Oct 2013 21:31:42 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Sep 2009 19:07:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30606</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0rrj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38316</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>