<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2398/DERBY-2398.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2398] Convert jdbcapi/autoGeneratedJdbc30.java to junit</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2398</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Convert the jdbcapi/autoGeneratedJdbc30.java test from the old harness to junit.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12364148">DERBY-2398</key>
            <summary>Convert jdbcapi/autoGeneratedJdbc30.java to junit</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jta">Jean T. Anderson</assignee>
                                    <reporter username="jta">Jean T. Anderson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Mar 2007 16:50:57 +0000</created>
                <updated>Fri, 21 Jan 2011 18:19:22 +0000</updated>
                            <resolved>Mon, 17 Nov 2008 20:43:17 +0000</resolved>
                                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12479739" author="jta" created="Fri, 9 Mar 2007 22:17:04 +0000"  >&lt;p&gt;test upload&lt;/p&gt;</comment>
                            <comment id="12480538" author="jta" created="Tue, 13 Mar 2007 20:42:07 +0000"  >&lt;p&gt;derby-2398-pre.diff converts about half of jdbcapi/autoGeneratedJdbc30.java test to JUnit.&lt;/p&gt;

&lt;p&gt;1) It adds a prepareStatement(String sql, int autoGeneratedKeys) method to junit/BaseJDBCTestCase.java.&lt;/p&gt;

&lt;p&gt;2) This suite runs only if (JDBC.vmSupportsJDBC3()). Is checking for JDBC3 sufficient to handle J2ME/JSR169? --There&apos;s one test that will do a DriverManager call.&lt;/p&gt;

&lt;p&gt;3) I made quite a few changes to the original test that are detailed below. For now, I have left in temporary System.out.println statements such as this:&lt;/p&gt;

&lt;p&gt;  System.out.println (&quot;Old Test 1&quot;); // temporary&lt;/p&gt;

&lt;p&gt;along with prints of values to make it easy to doublecheck results against the original master.&lt;/p&gt;

&lt;p&gt;Changes to original program:&lt;/p&gt;

&lt;p&gt;4) The original test did SET INCREMENT BY in ALTER statements because &quot;set by increment not yet supported for create table...&quot;&lt;br/&gt;
The new JUnit test includes the increment in the CREATE TABLE statement.&lt;/p&gt;

&lt;p&gt;5) There are many tests in the old version, roughly 25 * 4 queries each (most insert queries are tested four ways), so I divided them up into separate, standalone fixtures.&lt;br/&gt;
However! This means each fixture creates its own Statement and PreparedStatement.  The old master output this note:&lt;/p&gt;

&lt;p&gt;   System.out.println(&quot;Test 8 - create a new statement and request for generated keys on it after doing an insert into &quot;);&lt;/p&gt;

&lt;p&gt;This led me to think there might have been a difference in behavior between reusing the same Statement and create a new one, but I haven&apos;t see any  difference in behavior compared to the original master.&lt;/p&gt;

&lt;p&gt;If the standalone fixtures path I&apos;m on is not right, I&apos;m only half way through the tests and it would be easy to redo the test so that a single fixture calls the separate test methods with the same Statements and PreparedStatements. Having separate methods will still make the test easier to read and follow.&lt;/p&gt;

&lt;p&gt;6) I assume that what matters about the key generated is null vs. not-null value (I&apos;m not paying attention to the actual values). That&apos;s simple, but if it&apos;s wrong I can change the code to test for actual values.&lt;/p&gt;
</comment>
                            <comment id="12480559" author="jta" created="Tue, 13 Mar 2007 22:05:58 +0000"  >&lt;p&gt;2) I think I can answer my own question: yes (I remembered belatedly that JDBC.vmSupportsJDBC2 was adequate for CallableTest.java)&lt;/p&gt;

&lt;p&gt;comments on the rest would be welcome.&lt;/p&gt;</comment>
                            <comment id="12480564" author="jta" created="Tue, 13 Mar 2007 22:29:44 +0000"  >&lt;p&gt;Incidently, in the old test, tests 11 and 12 output this message:&lt;/p&gt;

&lt;p&gt;&quot;expected to see resultset with one row of NULL value but instead get one row of non-NULL value from getGeneratedKeys&quot;&lt;/p&gt;

&lt;p&gt;Test 11 does a commit, followed by an insert into a table with no generated column.&lt;br/&gt;
Test 12 does a rollback, followed by an insert into a table with no generated column.&lt;/p&gt;

&lt;p&gt;In both cases, the previous transaction had a one-row insert on a table with a auto-generated column.&lt;/p&gt;

&lt;p&gt;I don&apos;t know if that indicates a potential problem in Derby handling. I&apos;ll be sure to copy those comments into code comments in the JUnit version.&lt;/p&gt;</comment>
                            <comment id="12480571" author="djd" created="Tue, 13 Mar 2007 23:02:18 +0000"  >&lt;p&gt;jta&amp;gt; 6) I assume that what matters about the key generated is null vs. not-null value (I&apos;m not paying attention to the actual values). That&apos;s simple, but if it&apos;s wrong I can change the code to test for actual values. &lt;/p&gt;

&lt;p&gt;Testing the values is best as the purpose (I assume) of this test is to test  the JDBC feature that returns auto genrated keys, so checking it&apos;s returning the correct value would be good.&lt;/p&gt;</comment>
                            <comment id="12480575" author="jta" created="Tue, 13 Mar 2007 23:21:10 +0000"  >&lt;p&gt;Dan wrote:&lt;br/&gt;
&amp;gt; Testing the values is best as the purpose (I assume) of this test is to test the JDBC feature that returns auto genrated keys, so checking it&apos;s returning the correct value would be good.&lt;/p&gt;

&lt;p&gt;ack, the old test 13 needs to verify that the value  obtained inside a savepoint is the same after it does a rollback. I had missed that fine point, so I do need to check actual values.&lt;/p&gt;

&lt;p&gt;thanks for the feedback, Dan.&lt;/p&gt;
</comment>
                            <comment id="12481383" author="jta" created="Fri, 16 Mar 2007 00:09:28 +0000"  >&lt;p&gt;Patch derby-2398.diff implements all tests. I&apos;ll wait for a day or two to give anyone who has time/inclination to review it (and many thanks in advance).&lt;/p&gt;

&lt;p&gt;Three specific questions/notes are below.&lt;/p&gt;

&lt;p&gt;1) The original autoGeneratedJdbc30_app.properties file has this setting:&lt;/p&gt;

&lt;p&gt;   runwithj9=false&lt;/p&gt;

&lt;p&gt;Does returning a empty suite if (!JDBC.vmSupportsJDBC3()) do what&apos;s needed for j9?  Or should I do something special?&lt;/p&gt;

&lt;p&gt;2) I posted to derby-dev* asking if getGeneratedKeys() should return a NULL key after commit/rollback. Depending on that answer, I&apos;ll open a Jira issue if one is needed and update comments for the relevant methods in the code.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://www.nabble.com/Should-getGeneratedKeys%28%29-return-a-NULL-key-after-commit-rollback--p9505841.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/Should-getGeneratedKeys%28%29-return-a-NULL-key-after-commit-rollback--p9505841.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;3) The testResultSetGarbageCollection() method is noticeably slow (Test 20 in&lt;br/&gt;
the old code).&lt;/p&gt;

&lt;p&gt;The purpose of the test was to verify a fix for an old issue in which the ResultSet returned by getGenerateKeys() was incorrectly tied to the activation of the PreparedStatement. So, when the ResultSet was garbage collected, the activation was closed, resulting in an &quot;Activation closed, operation execute not permitted&quot; exception on subsequent executes.&lt;/p&gt;

&lt;p&gt;So, the test does this:&lt;br/&gt;
        for (int i = 0; i &amp;lt; 100; i++)&lt;br/&gt;
        {&lt;br/&gt;
            ps.setInt(1, 100+i);&lt;br/&gt;
            ps.executeUpdate();&lt;/p&gt;

&lt;p&gt;            ResultSet rs = ps.getGeneratedKeys();&lt;br/&gt;
            while (rs.next()) &lt;/p&gt;
{
               rs.getInt(1);
            }
&lt;p&gt;            rs.close();&lt;br/&gt;
            conn.commit();&lt;/p&gt;

&lt;p&gt;            System.runFinalization();&lt;br/&gt;
            System.gc();&lt;br/&gt;
            System.runFinalization();&lt;br/&gt;
            System.gc();&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;I wonder if this is overkill. Could it be nipped back without degrading the effectiveness of the test?&lt;/p&gt;</comment>
                            <comment id="12482162" author="jta" created="Mon, 19 Mar 2007 17:19:03 +0000"  >&lt;p&gt;Regarding the j9 question, Myrna posted this comment to derby-dev &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;:&lt;br/&gt;
&amp;gt; Just jumping in on this part - we don&apos;t need to worry about j9 per se.&lt;br/&gt;
&amp;gt; That was created for IBM&apos;s jclMax implementation with wctme5.7, but it&lt;br/&gt;
&amp;gt; was based on jdk 1.3, which we no longer support with our 10.3&lt;br/&gt;
&amp;gt; codeline.&lt;br/&gt;
&amp;gt; j9_foundation is (with 10.3) changed to mean weme6.1&apos;s implementation,&lt;br/&gt;
&amp;gt; which is J2ME 1.1 / JSR169; that we still worry about and it can be&lt;br/&gt;
&amp;gt; addressed by checking JDBC.vmSupportsJSR169. JDBC.vmSupportsJdbc20()&lt;br/&gt;
&amp;gt; will return false for that JVM, as  (I think) will vmSupportsJdbc30().&lt;/p&gt;

&lt;p&gt;I didn&apos;t see any response to the question if getGeneratedKeys() should return a NULL key after commit/rollback.&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;If there&apos;s no comment regarding the observation that testResultSetGarbageCollection()  is slow (or any other objections raised), I&apos;ll go ahead and commit this work, but will note in the javadoc comment for this method that I think it&apos;s expensive. That way if anyone reviews tests later for performance issues she or he can more easily find it.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/db-derby-dev/200703.mbox/%3cc25576af0703151747g2399c546hee36afcb5a09381a@mail.gmail.com%3e&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/db-derby-dev/200703.mbox/%3cc25576af0703151747g2399c546hee36afcb5a09381a@mail.gmail.com%3e&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/db-derby-dev/200703.mbox/%3c45F9D7EF.1080806@bristowhill.com%3e&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/db-derby-dev/200703.mbox/%3c45F9D7EF.1080806@bristowhill.com%3e&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12648318" author="kmarsden" created="Mon, 17 Nov 2008 20:43:17 +0000"  >&lt;p&gt;Looks like this test conversion was committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12353228" name="derby-2398-pre.diff" size="25021" author="jta" created="Tue, 13 Mar 2007 20:42:07 +0000"/>
                            <attachment id="12353456" name="patch-2398.diff" size="45054" author="jta" created="Fri, 16 Mar 2007 00:09:28 +0000"/>
                            <attachment id="12353014" name="test_file_ignore_me.txt" size="63" author="jta" created="Fri, 9 Mar 2007 22:17:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 13 Mar 2007 23:02:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30422</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0jsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37024</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>