<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:40:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1325/DERBY-1325.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1325] Isolation level of local connection does not get reset after exiting a global transaction if the isolation level was changed using SQL</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1325</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If we update the isolation level using SQL instead of JDBC and then join/resume a global transaction, on ending the transaction, the isolation level of the local connection is not restored. The problem seems to be in EmbedXAResource. So it happens with both embedded and client driver. Client driver internally uses SQL to set the transaction isolation. So the problem is more likely to be hit with the client. I will attach a repro and a draft patch with more details.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12334191">DERBY-1325</key>
            <summary>Isolation level of local connection does not get reset after exiting a global transaction if the isolation level was changed using SQL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="deepa">Deepa Remesh</assignee>
                                    <reporter username="deepa">Deepa Remesh</reporter>
                        <labels>
                    </labels>
                <created>Sat, 13 May 2006 07:10:08 +0100</created>
                <updated>Wed, 12 Jul 2006 03:09:34 +0100</updated>
                            <resolved>Fri, 26 May 2006 03:29:12 +0100</resolved>
                                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.3.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12383325" author="deepa" created="Sat, 13 May 2006 07:25:36 +0100"  >&lt;p&gt;Attaching a repro &apos;SetIsolation_SQL_JDBC.java&apos; and a draft patch &apos;derby-1325-draft.diff&apos; for the problem. The patch adds a call to update the isolation level in the BrokeredConnection when joining/resuming a transaction. This is similar to what is done when we start a fresh transaction. With the patch, I ran the repro and xa suite. This patch is only to get comments/feedback and not for commit. Please take a look.&lt;/p&gt;</comment>
                            <comment id="12402337" author="deepa" created="Tue, 16 May 2006 00:03:40 +0100"  >&lt;p&gt;Attaching a patch &apos;derby-1325-v1.diff&apos; which ensures correct isolation level gets used once we switch back to local mode when SQL is used to set the isolation level.&lt;/p&gt;

&lt;p&gt;Patch does the following:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Adds call to get the isolation level up to date when joining/resuming a global transaction. This will make sure the BrokeredConnection object has the correct isolation level to be used when we switch back to local mode.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Adds a test to jdbcapi/checkDataSource.java and modifies the master files.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With this patch, I ran derbyall with Sun jdk 1.4.2 on Windows XP. No failures. I would appreciate if someone can take a look at this patch. &lt;/p&gt;</comment>
                            <comment id="12402425" author="kmarsden" created="Tue, 16 May 2006 05:41:20 +0100"  >&lt;p&gt;Deepa, this patch looks ok to me but it would be good if someone more familiar with the embedded xa isolation state maintenance could take a look.&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12411899" author="mamtas" created="Tue, 16 May 2006 15:00:03 +0100"  >&lt;p&gt;Deepa, the patch looks good to me too. I think this bug is result of Derby-421(worked by me) where I missed cleaning up the state information during the global transaction exit time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Your patch seems to take care of it.&lt;/p&gt;</comment>
                            <comment id="12412411" author="deepa" created="Fri, 19 May 2006 03:58:43 +0100"  >&lt;p&gt;Thanks Kathey and Mamta for looking at the patch. I am attaching an updated patch &apos;derby-1325-v2.diff&apos; because the first patch became outdated after the commit for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1219&quot; title=&quot;jdbcapi/checkDataSource.java and jdbcapi/checkDataSource30.java hang intermittently with client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1219&quot;&gt;&lt;del&gt;DERBY-1219&lt;/del&gt;&lt;/a&gt;. In the new patch, I moved the test into a new method in checkDataSource.java. I verified the test fails without the patch and passes with the patch. Please review/commit this patch.&lt;/p&gt;</comment>
                            <comment id="12412985" author="kmarsden" created="Wed, 24 May 2006 04:35:58 +0100"  >&lt;p&gt;Comitted to the trunk. Won&apos;t mark resolved until it goes into 10.1&lt;/p&gt;

&lt;p&gt;Date: Tue May 23 13:29:47 2006&lt;br/&gt;
New Revision: 409002&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=409002&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?rev=409002&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks Deepa!&lt;/p&gt;</comment>
                            <comment id="12413116" author="deepa" created="Wed, 24 May 2006 21:58:25 +0100"  >&lt;p&gt;Attaching a patch &apos;derby-1325-10.1.diff&apos; which ports this fix to 10.1 branch. A direct merge was not possible. With this patch, I successfully ran derbyall with Sun jdk 1.4.2 on Windows XP. Please take a look at this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="12413290" author="kmarsden" created="Fri, 26 May 2006 03:29:12 +0100"  >&lt;p&gt;Resoved with&lt;br/&gt;
Date: Thu May 25 12:22:20 2006&lt;br/&gt;
New Revision: 409438&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=409438&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?rev=409438&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12330637">DERBY-1148</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12327457" name="SetIsolation_SQL_JDBC.java" size="6718" author="deepa" created="Sat, 13 May 2006 07:25:36 +0100"/>
                            <attachment id="12334509" name="derby-1325-10.1.diff" size="3883" author="deepa" created="Wed, 24 May 2006 21:58:25 +0100"/>
                            <attachment id="12334510" name="derby-1325-10.1.status" size="333" author="deepa" created="Wed, 24 May 2006 21:58:25 +0100"/>
                            <attachment id="12327458" name="derby-1325-draft.diff" size="1514" author="deepa" created="Sat, 13 May 2006 07:25:36 +0100"/>
                            <attachment id="12331910" name="derby-1325-v1.diff" size="11967" author="deepa" created="Tue, 16 May 2006 00:03:40 +0100"/>
                            <attachment id="12331911" name="derby-1325-v1.status" size="631" author="deepa" created="Tue, 16 May 2006 00:03:40 +0100"/>
                            <attachment id="12334284" name="derby-1325-v2.diff" size="4147" author="deepa" created="Fri, 19 May 2006 03:58:43 +0100"/>
                            <attachment id="12334285" name="derby-1325-v2.status" size="427" author="deepa" created="Fri, 19 May 2006 03:58:43 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 May 2006 04:41:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22438</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy15hr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40540</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>