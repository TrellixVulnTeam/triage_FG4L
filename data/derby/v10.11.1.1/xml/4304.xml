<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:36:19 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4304/DERBY-4304.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4304] Network Server shutdown should handle exceptions and finish the server shutdown completely</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4304</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;While working on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4053&quot; title=&quot;Network Server&amp;#39;s failure to rollback local transactions on shutdown can cause  hang on startup with message java.net.BindException: Address already in use: NET_Bind in derby.log &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4053&quot;&gt;&lt;del&gt;DERBY-4053&lt;/del&gt;&lt;/a&gt;, found that an exception from Connection.close was not handled properly by the server shutdown code which caused a new instance server startup to hang. Resolved the problem with Connection close but in general, we should&lt;br/&gt;
1) Make sure an exception during shutdown processing does not prevent the remaining shutdown tasks, like closing the server socket from occurring. &lt;br/&gt;
2) Make sure any exceptions that occur in shutdown processing are reported to the console. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12430250">DERBY-4304</key>
            <summary>Network Server shutdown should handle exceptions and finish the server shutdown completely</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="mamtas">Mamta A. Satoor</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jul 2009 19:15:51 +0100</created>
                <updated>Fri, 21 Jan 2011 17:52:30 +0000</updated>
                            <resolved>Thu, 17 Sep 2009 18:59:42 +0100</resolved>
                                    <version>10.6.1.0</version>
                                    <fixVersion>10.3.3.1</fixVersion>
                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12731428" author="mamtas" created="Wed, 15 Jul 2009 14:14:16 +0100"  >&lt;p&gt;I have made changes to NetworkServerControlImpl.java so we handle the exceptions during different steps of server shutdown and continue with the next step in shutdown rather than bailing out after the first exception. I ran junit suite and didn&apos;t see any new failure except the known intermittent &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4307&quot; title=&quot;testRunTests in RuntimeinfoTest fails periodically with Assertion failure checking output&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4307&quot;&gt;&lt;del&gt;DERBY-4307&lt;/del&gt;&lt;/a&gt; (RuntimeinfoTest Assertion failure). I will run derbyall next. If noone has any comments on the patch, I can check it in later this morning so it can be migrated to 10.5 codeline before we cut a release candidate there.&lt;/p&gt;</comment>
                            <comment id="12731449" author="knutanders" created="Wed, 15 Jul 2009 15:08:08 +0100"  >&lt;p&gt;I noticed one small inconsistency: When iterating over sessionTable, the try block encloses the entire loop, so an error in the middle of the table will prevent the rest of the sessions from being closed. When iterating over threadList, the try block only encloses the body of the loop, so we&apos;ll continue shutting down the rest of the threads in case of an error. It would be good if the two loops were handled the same way.&lt;/p&gt;

&lt;p&gt;Many of the lines use an odd mix of both tabs and spaces on the same line.&lt;/p&gt;</comment>
                            <comment id="12731461" author="mamtas" created="Wed, 15 Jul 2009 15:26:21 +0100"  >&lt;p&gt;Knut, thanks for reviewing the patch. I will change the sessionTable loop to do try catch one session at a time rather than the entire loop. I meant to do it that way but obviously didn&apos;t. I will look at the tabs and spaces issue.&lt;/p&gt;</comment>
                            <comment id="12731534" author="mamtas" created="Wed, 15 Jul 2009 17:00:49 +0100"  >&lt;p&gt;I have committed the changes into trunk with revision 794303 and commit comments as follows. Working on mergine and running the tests on 10.5 codeline&lt;br/&gt;
**********&lt;br/&gt;
I have made changes to NetworkServerControlImpl.java so we handle the exceptions during different steps of server shutdown and continue with the next step in shutdown rather than bailing out after the first exception.&lt;br/&gt;
**********&lt;/p&gt;</comment>
                            <comment id="12731536" author="kmarsden" created="Wed, 15 Jul 2009 17:08:10 +0100"  >&lt;p&gt;Thanks Mamta for making this change. I don&apos;t think it should  go into to 10.5 until we have analyzed and perhaps resolved some of the new errors that will show up in the log and console. I think errors like the NullPointerException unregistering might be disconcerting.  &lt;/p&gt;</comment>
                            <comment id="12732028" author="kmarsden" created="Thu, 16 Jul 2009 18:15:06 +0100"  >&lt;p&gt;Mamta I noted that at least in the case of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4310&quot; title=&quot;Closing a prepared statement with an embedded   XAConnection can cause the statement to be reprepared and errors related to missing dependencies. This can interfere with network server closeSession()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4310&quot;&gt;&lt;del&gt;DERBY-4310&lt;/del&gt;&lt;/a&gt;, the exception stack trace does not print to the console, just the error message.  This is the contents of serverConsole.log:&lt;br/&gt;
2009-07-16 17:05:43.546 GMT : Apache Derby Network Server - 10.6.0.0 alpha - (794751) started and ready to accept connections on port 1527&lt;/p&gt;

&lt;p&gt;2009-07-16 17:05:45.078 GMT : Unexpected exception:&lt;br/&gt;
 Table/View &apos;APP.FOO&apos; does not exist.&lt;/p&gt;

&lt;p&gt;Can you make it so the full stack trace prints as well. That would be much more helpful.  To try it out, run jdbcapi.XATest and look at logs/serverConsoleOutput.logs.&lt;/p&gt;

</comment>
                            <comment id="12733304" author="mamtas" created="Mon, 20 Jul 2009 19:14:57 +0100"  >&lt;p&gt;It seems that when running insane build, we do not put the stack trace in logs/serverConsoleOutput.log Kathey must be running insane. I will see what can we do in the code to have the stack trace printed no matter what kind of build we are working with.&lt;/p&gt;</comment>
                            <comment id="12733638" author="mamtas" created="Tue, 21 Jul 2009 15:29:44 +0100"  >&lt;p&gt;with revision 796316, I have fixed the problem of stack trace printing. The commit comments were as follows&lt;br/&gt;
**************&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4304&quot; title=&quot;Network Server shutdown should handle exceptions and finish the server shutdown completely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4304&quot;&gt;&lt;del&gt;DERBY-4304&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
When running in insane mode, the stack trace of the exception was not getting printed in the console log file logs/serverConsoleOutput.log The reason for this is that the code was&lt;br/&gt;
doing following&lt;br/&gt;
           consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;,&lt;br/&gt;
               exception.getMessage());&lt;br/&gt;
           consoleExceptionPrintTrace(exception);&lt;br/&gt;
That is, the stack trace printing was happening after the call to consolePropertyMessage. The call to consolePropertyMessage results into a call to consolePropertyMessageWork which may throw an exception back depending on the type of the error it is handling. If this method does throw an exception, then consoleExceptionPrintTrace does not get a chance to dump the stack trace into the logs/serverConsoleOutput. (Probably in sane mode, there is some other additional place where we do the stack trace printing and that is why we saw the stack trace despite consolePropertyMessage throwing an exception.) To fix the problem, I have switched the order of the 2 calls above and that makes sure that we do print the stack trace for debugging purpose.&lt;br/&gt;
**************&lt;/p&gt;</comment>
                            <comment id="12733686" author="mamtas" created="Tue, 21 Jul 2009 17:13:55 +0100"  >&lt;p&gt;Kathey asked following on the derby-dev&lt;br/&gt;
****************&lt;br/&gt;
Mamta, if consolePropertyMessage is throwing an exception, does that mean still we will not complete the other shutdown tasks?&lt;br/&gt;
****************&lt;/p&gt;

&lt;p&gt;I think that might be possible &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Maybe there is some other method which just does the job of printing stuff and not trying to handle it. I will take a look.&lt;/p&gt;</comment>
                            <comment id="12733691" author="mamtas" created="Tue, 21 Jul 2009 17:21:20 +0100"  >&lt;p&gt;I had finished running the junit suite before checking in and that ran fine with only one known failure &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4307&quot; title=&quot;testRunTests in RuntimeinfoTest fails periodically with Assertion failure checking output&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4307&quot;&gt;&lt;del&gt;DERBY-4307&lt;/del&gt;&lt;/a&gt; testRunTests. derbyall had not finished before I checked in. It just finished and I see one NPE which may be same as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4306&quot; title=&quot;NullPointerException in JMXManagementService.unregisterMBean when running jdbcapi._Suite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4306&quot;&gt;&lt;del&gt;DERBY-4306&lt;/del&gt;&lt;/a&gt;. I will investigate further into it. The NPE stack trace is as follows&lt;br/&gt;
The failing test is DerbyNetAutoStart&lt;br/&gt;
Starting test case 1.&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.services.jmx.JMXManagementService.unregisterMBean(JMXManagementService.java:286)&lt;br/&gt;
	at org.apache.derby.impl.services.jmx.JMXManagementService.unregisterMBean(JMXManagementService.java:277)&lt;br/&gt;
	at org.apache.derby.impl.drda.NetworkServerControlImpl.blockingStart(NetworkServerControlImpl.java:892)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:599)&lt;br/&gt;
	at org.apache.derby.iapi.jdbc.DRDAServerStarter.run(DRDAServerStarter.java:236)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:735)&lt;br/&gt;
Starting test case 2.&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.services.jmx.JMXManagementService.unregisterMBean(JMXManagementService.java:286)&lt;br/&gt;
	at org.apache.derby.impl.services.jmx.JMXManagementService.unregisterMBean(JMXManagementService.java:277)&lt;br/&gt;
	at org.apache.derby.impl.drda.NetworkServerControlImpl.blockingStart(NetworkServerControlImpl.java:892)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:599)&lt;br/&gt;
	at org.apache.derby.iapi.jdbc.DRDAServerStarter.run(DRDAServerStarter.java:236)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:735)&lt;/p&gt;</comment>
                            <comment id="12733695" author="mamtas" created="Tue, 21 Jul 2009 17:26:05 +0100"  >&lt;p&gt;Because of the NPE, I will backout my change for now until I figure out what is happening.&lt;/p&gt;</comment>
                            <comment id="12733702" author="mamtas" created="Tue, 21 Jul 2009 17:37:53 +0100"  >&lt;p&gt;Backed out changes 796316 with revision 796372 until I can figure out the cause of NPE in DerbyNetAutoStart&lt;/p&gt;</comment>
                            <comment id="12735102" author="mamtas" created="Fri, 24 Jul 2009 18:19:00 +0100"  >&lt;p&gt;Tiago noticed (&lt;br/&gt;
[ &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4306?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=12731644#action_12731644&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DERBY-4306?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=12731644#action_12731644&lt;/a&gt; ]) following NPE with my checkin 796316 (which has been rolled back)&lt;br/&gt;
       at org.apache.derby.impl.drda.NetworkServerControlImpl.isMsgProperty(NetworkServerControlImpl.java:3460)&lt;br/&gt;
       at org.apache.derby.impl.drda.NetworkServerControlImpl.localizeMessage(NetworkServerControlImpl.java:3397)&lt;br/&gt;
       at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessageWork(NetworkServerControlImpl.java:3195)&lt;br/&gt;
       at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessage(NetworkServerControlImpl.java:1888)&lt;br/&gt;
       at org.apache.derby.impl.drda.NetworkServerControlImpl.blockingStart(NetworkServerControlImpl.java:895)&lt;br/&gt;
       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
       at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;/p&gt;

&lt;p&gt;       at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
       at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
       at org.apache.derby.iapi.jdbc.DRDAServerStarter.run(DRDAServerStarter.java:236)&lt;br/&gt;
       at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;I debugged the NPE and found that my try catch block below was getting NPE from mgmtService.unregisterMBean(versionMBean);&lt;br/&gt;
	    try &lt;/p&gt;
{
	        mgmtService.unregisterMBean(versionMBean);
	        mgmtService.unregisterMBean(networkServerMBean);
	    } catch (Exception exception) {
			consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;, 
               				exception.getMessage()); 
			consoleExceptionPrintTrace(exception);
	    }&lt;br/&gt;
This NPE from mgmtService.unregisterMBean(versionMBean); is caught by the catch clause above. The problem though is that exception.getMessage() for this NPE returns null and our existing code for consolePropertyMessage is not written to handle a null 2nd parameter. But the work that is being done by consolePropertyMessage on exception.getMessage() is also done by the next line of code in try catch block which is consoleExceptionPrintTrace(exception); In fact, consoleExceptionPrintTrace handles the null exception.getMessage() fine. Because of that I am suggesting that I replace the call consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;, exception.getMessage()); with consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;, true);&lt;br/&gt;
&lt;br/&gt;
So, the new try catch will look as follows&lt;br/&gt;
	    try {
	        mgmtService.unregisterMBean(versionMBean);
	        mgmtService.unregisterMBean(networkServerMBean);
	    }
&lt;p&gt; catch (Exception exception) &lt;/p&gt;
{
			consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;, true);
			consoleExceptionPrintTrace(exception);
	    }

&lt;p&gt;In fact, I am changing all the try catches introduced for different steps of shutdown to look like above. I am running the junit tests right now. Once derbyall and junit finish, I will go ahead and commit these changes. Any feedback greatly appreciated.&lt;/p&gt;</comment>
                            <comment id="12735178" author="kmarsden" created="Fri, 24 Jul 2009 22:51:13 +0100"  >&lt;p&gt;Mamta, will this also take care of the problem where printing out the exception throws a new Exception so the remaining shutdown tasks do not execute?&lt;/p&gt;

&lt;p&gt;If you post a patch before you commit, I will do a quick review. &lt;/p&gt;

&lt;p&gt;I wish we could somehow add tests for this issue, but because it exposes problems that shouldn&apos;t happen, as soon as we fix those we lose our test cases for this fix.&lt;/p&gt;</comment>
                            <comment id="12735710" author="mamtas" created="Mon, 27 Jul 2009 19:52:01 +0100"  >&lt;p&gt;I am attaching(DERBY4304_fixNPE_patch2_diff.txt) a simple fix to NPE problem. During one of the shutdown steps, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4306&quot; title=&quot;NullPointerException in JMXManagementService.unregisterMBean when running jdbcapi._Suite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4306&quot;&gt;&lt;del&gt;DERBY-4306&lt;/del&gt;&lt;/a&gt; was throwing a npe(we have fixed &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4306&quot; title=&quot;NullPointerException in JMXManagementService.unregisterMBean when running jdbcapi._Suite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4306&quot;&gt;&lt;del&gt;DERBY-4306&lt;/del&gt;&lt;/a&gt; now) and the shutdown exception handling code was calling following method on that npe&lt;br/&gt;
                       consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;, exception.getMessage());&lt;br/&gt;
                       consoleExceptionPrintTrace(exception);&lt;br/&gt;
but the call exception.getMessage() on npe was returning null and consolePropertyMessage is not written to handle null 2nd param for this call of consolePropertyMessage. But the work done by this particular type of consolePropertyMessage method is also done by the next call in the shutdown exception handling which is consoleExceptionPrintTrace. Because of this, I have replaced the consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;, exception.getMessage()); call with consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;, true); This change makes sure we do not run into npe when exception.getMessage() is null. I am not sure if we should enter a new jira entry to make consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;, exception.getMessage()); handle a null 2nd param. &lt;/p&gt;

&lt;p&gt;i ran junit tests and then ran into intermittent upgrade test failures. i am running derbyall and as soon as they are finished, i will go ahead and checkin the patch.&lt;/p&gt;

&lt;p&gt;One last step remaining is may be write a new method which is a subset of consolePropertyMessage because consolePropertyMessage handles the exception printing and then goes ahead and throws the exception again. For our purposes in this jira entry, we do not want the exception to be thrown back. instead, we want to move on to the next step in server shutdown.&lt;/p&gt;
</comment>
                            <comment id="12735874" author="mamtas" created="Tue, 28 Jul 2009 02:10:26 +0100"  >&lt;p&gt;Committed patch DERBY4304_fixNPE_patch2_diff.txt with following comments (revision 798347)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4304&quot; title=&quot;Network Server shutdown should handle exceptions and finish the server shutdown completely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4304&quot;&gt;&lt;del&gt;DERBY-4304&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;During one of the server shutdown steps, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4306&quot; title=&quot;NullPointerException in JMXManagementService.unregisterMBean when running jdbcapi._Suite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4306&quot;&gt;&lt;del&gt;DERBY-4306&lt;/del&gt;&lt;/a&gt; was throwing a npe(we have fixed &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4306&quot; title=&quot;NullPointerException in JMXManagementService.unregisterMBean when running jdbcapi._Suite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4306&quot;&gt;&lt;del&gt;DERBY-4306&lt;/del&gt;&lt;/a&gt; now) and the shutdown exception handling code was calling following method on that npe &lt;br/&gt;
          consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;, exception.getMessage()); &lt;br/&gt;
          consoleExceptionPrintTrace(exception); &lt;br/&gt;
but the call exception.getMessage() on npe was returning null and consolePropertyMessage is not written to handle null 2nd param for this call of consolePropertyMessage. But the work done by this particular type of consolePropertyMessage method is also done by the next call in the shutdown exception handling which is consoleExceptionPrintTrace. Because of this, I have replaced the consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;, exception.getMessage()); call with consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;, true); This change makes sure we do not run into npe when exception.getMessage() is null. I am not sure if we should enter a new jira entry to make consolePropertyMessage(&quot;DRDA_UnexpectedException.S&quot;, exception.getMessage()); handle a null 2nd param. &lt;/p&gt;

&lt;p&gt;junit tests with this change ran into intermittent upgrade test failures. &lt;/p&gt;

&lt;p&gt;One last step remaining is may be write a new method which is a subset of consolePropertyMessage because consolePropertyMessage handles the exception printing and then goes ahead and throws the exception again. For our purposes in this jira entry, we do not want the exception to be thrown back. instead, we want to move on to the next step in server shutdown. &lt;/p&gt;</comment>
                            <comment id="12736641" author="mamtas" created="Wed, 29 Jul 2009 15:21:08 +0100"  >&lt;p&gt;With revision, committed 798742, made changes so that during server shutdown sub-steps, we print the exception info and then move on to the next step in server shutdown.The commit comments were as follows&lt;br/&gt;
*****************&lt;br/&gt;
During server shutdown substeps, catch any exception thrown, print it to console along with stack trace and then move on to the next substep rather than re-throwing the exception after console printing.&lt;br/&gt;
*****************&lt;/p&gt;</comment>
                            <comment id="12742145" author="mamtas" created="Wed, 12 Aug 2009 01:38:30 +0100"  >&lt;p&gt;Attaching a new patch DERBY4304ShutdownException_patch3_diff.txt which puts a new try catch block around all of the server shutdown code in case if there is some exception being thrown which is not getting caught. The catch block will log into the log file but if that fails for some reason, it will also just dump the stack trace using ex.printStackTrace().&lt;/p&gt;

&lt;p&gt;I have attached for reference the server console log with my changes logAfterPatch3Changes.txt and without my changes logBeforePatch3Changes.txt. i do not see any new exception in the log file when running junit suite. I will also run derbyall. If no one has any feedback to this patch, I will go ahead and commit it tomorrow.&lt;/p&gt;</comment>
                            <comment id="12742356" author="kmarsden" created="Wed, 12 Aug 2009 14:55:02 +0100"  >&lt;p&gt;Hi Mamta,&lt;/p&gt;

&lt;p&gt;I took a quick look at the diff and noticed that the normal timestamps that print  for network server commands are commented out, which I guess you did for your testing.  These should be enabled again before commit.&lt;/p&gt;

&lt;p&gt;The rest of the diff I think is  ok but was a little hard to read because of the indentation change.    Thanks for doing this. I think this will finally allow us to get full reporting of any shutdown issues.  It would be great to see this change backported, but you would need to be careful to also backport the fixes for the bugs found when fixing this issue as well.&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12742398" author="mamtas" created="Wed, 12 Aug 2009 16:08:50 +0100"  >&lt;p&gt;Thanks for reviewing the changes, Kathey. Yes, I have undone changes for skipping the timestamp printing. I have committed the rest of the changes with revision 803548. Once the derbyall run is finished, I will look into backporting the changes.&lt;/p&gt;</comment>
                            <comment id="12748416" author="mamtas" created="Thu, 27 Aug 2009 17:09:56 +0100"  >&lt;p&gt;Merged the changes for this jira entry into 10.5 codeline using revision r808479. Will work on backporting to 10.4 codeline next.&lt;/p&gt;</comment>
                            <comment id="12749337" author="mamtas" created="Mon, 31 Aug 2009 00:00:14 +0100"  >&lt;p&gt;Merged 5 out of 6 checkins that went in for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4304&quot; title=&quot;Network Server shutdown should handle exceptions and finish the server shutdown completely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4304&quot;&gt;&lt;del&gt;DERBY-4304&lt;/del&gt;&lt;/a&gt; into 10.4 codeline&lt;br/&gt;
svn merge -r 794302:794303 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk/&lt;/a&gt;&lt;br/&gt;
svn merge -r 796315:796316 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk/&lt;/a&gt;&lt;br/&gt;
svn merge -r 796371:796372 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk/&lt;/a&gt;&lt;br/&gt;
svn merge -r 798346:798347 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk/&lt;/a&gt;&lt;br/&gt;
svn merge -r 798741:798742 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Will mege the last one as a separate checkin.&lt;/p&gt;</comment>
                            <comment id="12749501" author="mamtas" created="Mon, 31 Aug 2009 14:50:56 +0100"  >&lt;p&gt;Merged the final remaining changes revision 803548 from trunk into 10.4 codeline. The merged happened with revision 809593.&lt;/p&gt;</comment>
                            <comment id="12751039" author="mamtas" created="Thu, 3 Sep 2009 15:18:31 +0100"  >&lt;p&gt;Backported changes into 10.3 codeline with revision 810956.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12430439">DERBY-4306</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12414620">DERBY-4053</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12430639">DERBY-4310</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12416271" name="DERBY4304ShutdownException_patch3_diff.txt" size="9915" author="mamtas" created="Wed, 12 Aug 2009 01:38:30 +0100"/>
                            <attachment id="12414650" name="DERBY4304_fixNPE_patch2_diff.txt" size="2669" author="mamtas" created="Mon, 27 Jul 2009 19:52:01 +0100"/>
                            <attachment id="12413548" name="DERBY4304_handleExceptions_patch1_diff.txt" size="4651" author="mamtas" created="Wed, 15 Jul 2009 14:14:16 +0100"/>
                            <attachment id="12416269" name="logAfterPatch3Changes.txt" size="55568" author="mamtas" created="Wed, 12 Aug 2009 01:38:30 +0100"/>
                            <attachment id="12416270" name="logBeforePatch3Changes.txt" size="49055" author="mamtas" created="Wed, 12 Aug 2009 01:38:30 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 15 Jul 2009 14:08:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31189</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0l0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37223</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>