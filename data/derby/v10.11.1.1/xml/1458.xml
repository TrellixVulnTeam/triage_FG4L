<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:26:05 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1458/DERBY-1458.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1458] Add MessageBundleTest to build script to verify that there are no orphaned message ids</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1458</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;MessageBundleTest can&apos;t be run with the regular tests because it relies on SQLState.java and MessageId.java, which are not in the jar files.  But it actually makes more sense to run it as part of the build, as we are verifying the consistency of code references.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12345064">DERBY-1458</key>
            <summary>Add MessageBundleTest to build script to verify that there are no orphaned message ids</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="davidvc">David Van Couvering</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Jun 2006 01:39:17 +0100</created>
                <updated>Wed, 5 May 2010 12:44:24 +0100</updated>
                            <resolved>Sun, 19 Oct 2008 02:13:03 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Build tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12435826" author="rhillegas" created="Tue, 19 Sep 2006 15:48:42 +0100"  >&lt;p&gt;Moving to 10.2.2.0.&lt;/p&gt;</comment>
                            <comment id="12457910" author="rhillegas" created="Tue, 12 Dec 2006 22:23:17 +0000"  >&lt;p&gt;Unknown release vehicle.&lt;/p&gt;</comment>
                            <comment id="12639621" author="myrna" created="Tue, 14 Oct 2008 23:05:36 +0100"  >&lt;p&gt;Attaching a patch that adds a target, runmessagechecktest, to the top level build.xml. The &apos;all&apos; target depends on it, and it runs MessageBundleTest through target junit-single.&lt;/p&gt;

&lt;p&gt;When there are no missing/orphaned messages, this adds the following output to any &apos;all&apos; build (after the pptesting-build/junit-init and before the final closing &apos;all:&apos;&lt;br/&gt;
-------------------&lt;br/&gt;
runmessagechecktest:&lt;/p&gt;

&lt;p&gt;junit-init:&lt;/p&gt;

&lt;p&gt;junit-single:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.derbyTesting.functionTests.tests.i18n.MessageBundleTest&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 3, Failures: 0, Errors: 0, Time elapsed: 0.188 sec&lt;br/&gt;
-------------------&lt;/p&gt;

&lt;p&gt;When you remove an SQLState without clobbering (clobber &amp;amp; rebuild would show more compilation errors)  it&apos;ll do something like this (but still give BUILD SUCCESSFUL)&lt;/p&gt;

&lt;p&gt;-------------------&lt;br/&gt;
runmessagechecktest:&lt;/p&gt;

&lt;p&gt;junit-init:&lt;/p&gt;

&lt;p&gt;junit-single:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.derbyTesting.functionTests.tests.i18n.MessageBundleTest&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; WARNING: Message id XCL30.S in messages_en.properties is not referenced in either SQLState.java or MessageId.java&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 3, Failures: 0, Errors: 0, Time elapsed: 0.172 sec&lt;br/&gt;
-------------------&lt;/p&gt;

&lt;p&gt;If you remove a message from messages.xml you&apos;ll get this:&lt;/p&gt;

&lt;p&gt;-------------------&lt;br/&gt;
runmessagechecktest:&lt;/p&gt;

&lt;p&gt;junit-init:&lt;/p&gt;

&lt;p&gt;junit-single:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.derbyTesting.functionTests.tests.i18n.MessageBundleTest&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; ERROR: Message id XCL30.S in SQLState.java was not found in messages_en.properties&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 3, Failures: 0, Errors: 0, Time elapsed: 0.219 sec&lt;br/&gt;
-------------------&lt;/p&gt;

&lt;p&gt;I think this good enough.&lt;br/&gt;
I intend to commit this.&lt;/p&gt;</comment>
                            <comment id="12639623" author="myrna" created="Tue, 14 Oct 2008 23:17:27 +0100"  >&lt;p&gt;committed the patch with revision 704718.&lt;/p&gt;</comment>
                            <comment id="12639704" author="dagw" created="Wed, 15 Oct 2008 03:57:55 +0100"  >&lt;p&gt;Looks very useful, thanks Myrna!&lt;/p&gt;</comment>
                            <comment id="12639717" author="myrna" created="Wed, 15 Oct 2008 05:37:36 +0100"  >&lt;p&gt;This worked fine in my environment, but caused a build failure in the tinderbox.&lt;/p&gt;

&lt;p&gt;I backed out the dependency - leaving the target - with revision 704779 until I (or someone else) can figure out why it worked for me but failed in the tinderbox.&lt;br/&gt;
Hopefully this does build the tinderbox again.&lt;/p&gt;</comment>
                            <comment id="12639981" author="myrna" created="Wed, 15 Oct 2008 22:51:29 +0100"  >&lt;p&gt;I assume that the problem with the tinderbox was that ant does not have the optional package installed that gives the junit task (ant-junit.jar).&lt;br/&gt;
I had the choice to either make the messagebundle check depend on whether or not the junit task was available, or to create a taskdef, or antcall, to do the same as the junit-single target, but not use the &quot;junit&quot; task.&lt;/p&gt;

&lt;p&gt;I chose to continue to rely on the existing junit task, having two things to do essentially the same seemed rather ugly.&lt;br/&gt;
It does make the check a little less useful (as not run everywhere, or by everyone).&lt;/p&gt;

&lt;p&gt;I&apos;m attaching a patch that makes ant all:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;check for the optional junit package&lt;/li&gt;
	&lt;li&gt;if the junit task is not available, print a message indicating no message check is getting run.&lt;/li&gt;
	&lt;li&gt;else run the messagebundletest&lt;/li&gt;
	&lt;li&gt;remove the junit test dir. All interesting info should be visible in the build output.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;output if ant-junit.jar is available is now:&lt;br/&gt;
-----------------------------&lt;br/&gt;
checkjunittask:&lt;/p&gt;

&lt;p&gt;junit-init:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;mkdir&amp;#93;&lt;/span&gt; Created dir: &amp;lt;mytrunkdir&amp;gt;\junit_20081015_1448\testout&lt;/p&gt;

&lt;p&gt;runmessagechecktest:&lt;/p&gt;

&lt;p&gt;junit-init:&lt;/p&gt;

&lt;p&gt;junit-single:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.derbyTesting.functionTests.tests.i18n.MessageBundleTest&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 3, Failures: 0, Errors: 0, Time elapsed: 0.172 sec&lt;/p&gt;

&lt;p&gt;cleanjunit:&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;delete&amp;#93;&lt;/span&gt; Deleting directory &amp;lt;mytrunkdir&amp;gt;\junit_20081015_1448&lt;/p&gt;

&lt;p&gt;nojunittask:&lt;/p&gt;

&lt;p&gt;runmessagecheck:&lt;br/&gt;
-----------------------------&lt;br/&gt;
if not available:&lt;br/&gt;
-----------------------------&lt;br/&gt;
junit-init:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;mkdir&amp;#93;&lt;/span&gt; Created dir: &amp;lt;mytrunkdir&amp;gt;\junit_20081015_1433\testout&lt;/p&gt;

&lt;p&gt;runmessagechecktest:&lt;/p&gt;

&lt;p&gt;nojunittask:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; no junit task available; no message check run&lt;/p&gt;

&lt;p&gt;cleanjunit:&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;delete&amp;#93;&lt;/span&gt; Deleting directory &amp;lt;mytrunkdir&amp;gt;\junit_20081015_1433&lt;/p&gt;

&lt;p&gt;runmessagecheck:&lt;br/&gt;
-----------------------------&lt;/p&gt;

&lt;p&gt;I&apos;ll wait for comments for a day or so.&lt;/p&gt;</comment>
                            <comment id="12640313" author="myrna" created="Thu, 16 Oct 2008 21:59:50 +0100"  >&lt;p&gt;Third attempt.&lt;br/&gt;
I did away with the junit run and junit checks in build.xml, and instead, &quot;svn move&quot;d the MessageBundleTest from the functionTests to java/build/org/apache/derbyBuild, adjusted it:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;no longer inherit from TestCase&lt;/li&gt;
	&lt;li&gt;removed constructor&lt;/li&gt;
	&lt;li&gt;added a main method that calls the 3 &apos;tests&apos;&lt;/li&gt;
	&lt;li&gt;changed the &apos;ERROR&apos; strings to &apos;WARNING&apos;.&lt;/li&gt;
	&lt;li&gt;and adjusted the package &amp;amp; comment.&lt;br/&gt;
This org.apache.derbyBuild.MessageBundleTest runs as a java task - I don&apos;t think it&apos;s needed to have checks for this because we already have several other java tasks in the build.&lt;br/&gt;
Also removed the old null-ish master&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This check will not cause the build to fail, just issues a warning.&lt;/p&gt;

&lt;p&gt;The output now  looks for instance:&lt;br/&gt;
if all ok:&lt;br/&gt;
------------------&lt;br/&gt;
runmessagecheck:&lt;br/&gt;
------------------&lt;br/&gt;
if something missing from SQLState (or MessageId)(note that clobber &amp;amp; rebuild would also catch those):&lt;br/&gt;
------------------&lt;br/&gt;
runmessagecheck:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; WARNING: Message id XCL30.S in messages_en.properties is not referenced in either SQLState.java or MessageId.java&lt;br/&gt;
------------------&lt;br/&gt;
if something&apos;s missing from messages.xml:&lt;br/&gt;
------------------&lt;br/&gt;
runmessagecheck:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; ERROR: Message id XCL30.S in SQLState.java was not found in messages_en.properties&lt;br/&gt;
------------------&lt;/p&gt;
</comment>
                            <comment id="12640331" author="myrna" created="Thu, 16 Oct 2008 22:23:28 +0100"  >&lt;p&gt;I&apos;m not certain that what I did made a good patch (first svn move, then modify the moved file). So, just in case, I&apos;m attaching the source class as it is in its new location...&lt;/p&gt;</comment>
                            <comment id="12640335" author="kmarsden" created="Thu, 16 Oct 2008 22:35:29 +0100"  >&lt;p&gt;I had a problem applying the patch where MessageBundleTest.java ended up to be an empty file.  When I manually added the file that you attached to this issue, it all seemed to work ok.  Looks good for commit to me.&lt;/p&gt;</comment>
                            <comment id="12640587" author="myrna" created="Fri, 17 Oct 2008 18:24:31 +0100"  >&lt;p&gt;I&apos;m attaching an attempt to implement a taskdef, similar to what was done for PropertySetter, but I&apos;m stumped - I get a failure out of the call to the taskdef (regardless of whether or not I make the check hit some failures).&lt;/p&gt;

&lt;p&gt;The output I get is this (with verbose):&lt;br/&gt;
runmessagecheck:&lt;/p&gt;

&lt;p&gt;BUILD FAILED&lt;br/&gt;
C:\derbyt\svn\trunk\build.xml:480: failure in message check&lt;br/&gt;
	at org.apache.derbyBuild.MessageBundleTest.execute(Unknown Source)&lt;br/&gt;
	at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)&lt;br/&gt;
	at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
	at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)&lt;br/&gt;
	at org.apache.tools.ant.Task.perform(Task.java:348)&lt;br/&gt;
	at org.apache.tools.ant.Target.execute(Target.java:357)&lt;br/&gt;
	at org.apache.tools.ant.Target.performTasks(Target.java:385)&lt;br/&gt;
	at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)&lt;br/&gt;
	at org.apache.tools.ant.Project.executeTarget(Project.java:1298)&lt;br/&gt;
	at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)&lt;br/&gt;
	at org.apache.tools.ant.Project.executeTargets(Project.java:1181)&lt;br/&gt;
	at org.apache.tools.ant.Main.runBuild(Main.java:698)&lt;br/&gt;
	at org.apache.tools.ant.Main.startAnt(Main.java:199)&lt;br/&gt;
	at org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)&lt;br/&gt;
	at org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)&lt;/p&gt;

&lt;p&gt;Is there anyone familiar with this technique that can spot where I went wrong?&lt;/p&gt;</comment>
                            <comment id="12640588" author="myrna" created="Fri, 17 Oct 2008 18:25:04 +0100"  >&lt;p&gt;latest patch available for review only.&lt;/p&gt;</comment>
                            <comment id="12640591" author="myrna" created="Fri, 17 Oct 2008 18:29:17 +0100"  >&lt;p&gt;forgot to mention - &lt;br/&gt;
1. this was in response to a thread following the build failure after I checked in my second attempt:&lt;br/&gt;
&lt;a href=&quot;http://www.nabble.com/Build-Report---tinderbox_trunk16-705255-build-failed---Sun-Database-Engineering--Auto-generated-mail--td20015598.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/Build-Report---tinderbox_trunk16-705255-build-failed---Sun-Database-Engineering--Auto-generated-mail--td20015598.html&lt;/a&gt;&lt;br/&gt;
2. The error message above shows &quot;failure in message check&quot; - that&apos;s when I had the BuildException in the execute method do this: throw new BuildException(&quot;failure in message check&quot;);&lt;br/&gt;
With the current .java per the patch, the error shows: C:\derbyt\svn\trunk\build.xml:480: null.&lt;/p&gt;</comment>
                            <comment id="12640819" author="myrna" created="Sun, 19 Oct 2008 02:13:03 +0100"  >&lt;p&gt;I figure out my mistake and fixed it. &lt;br/&gt;
I checked in the latest patch, but with a minor fix (a mistaken placing of the flag for buildfailure) and added a comment in the buildException - revision 705945.&lt;/p&gt;</comment>
                            <comment id="12864288" author="kristwaa" created="Wed, 5 May 2010 12:44:24 +0100"  >&lt;p&gt;Closing issue.&lt;br/&gt;
Note that running &apos;ant runmessagecheck&apos; stand-alone isn&apos;t recommended. This is probably because it loads resources from either jars or classes, so you have to re-build Derby to make it pick up the changes.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12392141" name="DERBY-1458.diff" size="1207" author="myrna" created="Tue, 14 Oct 2008 23:05:36 +0100"/>
                            <attachment id="12392206" name="DERBY-1458.diff2" size="2406" author="myrna" created="Wed, 15 Oct 2008 22:51:29 +0100"/>
                            <attachment id="12392289" name="DERBY-1458_3.diff" size="14597" author="myrna" created="Thu, 16 Oct 2008 21:59:50 +0100"/>
                            <attachment id="12392288" name="DERBY-1458_3.stat" size="263" author="myrna" created="Thu, 16 Oct 2008 21:59:50 +0100"/>
                            <attachment id="12392359" name="DERBY-1458_4_tmp.diff" size="15391" author="myrna" created="Fri, 17 Oct 2008 18:24:31 +0100"/>
                            <attachment id="12392358" name="MessageBundleTest.java" size="8479" author="myrna" created="Fri, 17 Oct 2008 18:24:31 +0100"/>
                            <attachment id="12392299" name="MessageBundleTest.java" size="8005" author="myrna" created="Thu, 16 Oct 2008 22:23:28 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Sep 2006 14:48:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30000</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0qgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38105</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>