<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:14:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6224/DERBY-6224.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6224] Issues with latest JDK 8 EA build because of missing SQLPermission</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6224</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;With the latest EA build of JDK 8 (build 1.8.0-ea-b89), I see many failures in suites.All. For example:&lt;/p&gt;

&lt;p&gt;1) testStartNetworkServerFalse(org.apache.derbyTesting.functionTests.tests.derbynet.DerbyNetAutoStartTest)java.security.AccessControlException: access denied (&quot;java.sql.SQLPermission&quot; &quot;deregisterDriver&quot;)&lt;br/&gt;
	at java.security.AccessControlContext.checkPermission(AccessControlContext.java:364)&lt;br/&gt;
	at java.security.AccessController.checkPermission(AccessController.java:562)&lt;br/&gt;
	at java.lang.SecurityManager.checkPermission(SecurityManager.java:549)&lt;br/&gt;
	at java.sql.DriverManager.deregisterDriver(DriverManager.java:399)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.unregisterDriverModule(AutoloadedDriver.java:263)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver20.stop(Driver20.java:105)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.stop(TopService.java:443)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.shutdown(TopService.java:394)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:227)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.FileMonitor.shutdown(FileMonitor.java:44)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:197)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.FileMonitor.shutdown(FileMonitor.java:44)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:255)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver20.connect(Driver20.java:246)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:145)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:661)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:208)&lt;br/&gt;
	at org.apache.derbyTesting.junit.DriverManagerConnector.getConnectionByAttributes(DriverManagerConnector.java:204)&lt;br/&gt;
	at org.apache.derbyTesting.junit.DriverManagerConnector.shutEngine(DriverManagerConnector.java:171)&lt;br/&gt;
	at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1822)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.derbynet.DerbyNetAutoStartTest.setUp(DerbyNetAutoStartTest.java:82)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:439)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:456)&lt;/p&gt;

&lt;p&gt;What&apos;s new in EA build 89 is that DriverManager.deregisterDriver() now requires an SQLPermission when running under a security manager. Most of suites.All runs under a security manager, and Derby&apos;s engine shutdown code calls deregisterDriver(), so this problem probably affects all tests that shut down the engine.&lt;/p&gt;</description>
                <environment>java version &amp;quot;1.8.0-ea&amp;quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.8.0-ea-b89)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 25.0-b31, mixed mode)</environment>
        <key id="12647706">DERBY-6224</key>
            <summary>Issues with latest JDK 8 EA build because of missing SQLPermission</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 May 2013 09:20:33 +0100</created>
                <updated>Wed, 21 Jan 2015 00:23:01 +0000</updated>
                            <resolved>Thu, 20 Jun 2013 16:13:36 +0100</resolved>
                                    <version>10.11.1.1</version>
                                    <fixVersion>10.8.3.3</fixVersion>
                    <fixVersion>10.9.2.2</fixVersion>
                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Miscellaneous</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13669135" author="knutanders" created="Wed, 29 May 2013 11:19:07 +0100"  >&lt;p&gt;I think at the very least we need to add the permission to the policy files used by the tests so that the tests will go through on JDK 8. Also, we should add the permission to the default policy file that gets installed if the network server is started from the command line, as the permission will be needed when shutting down the server. And we should document that this permission is needed.&lt;/p&gt;

&lt;p&gt;We may also want to wrap the calls to DriverManager.deregisterDriver() from AutoloadedDriver.unregisterDriverModule() in a doPrivileged block. Then it would be sufficient to grant the extra permission to derby.jar, and it would not be necessary to grant it to code that invokes Derby system shutdown without the deregister=false attribute. On the other hand, not wrapping the calls in a doPrivileged block would give more fine-grained control with who is allowed to invoke system shutdown without deregister=false. But then again, if we skip the doPrivileged blocks in AutoloadedDriver.unregisterDriverModule() and require the calling code to have permission to deregister drivers, the calling code will be allowed to deregister any driver by calling DriverManager.deregisterDriver(). If we have doPrivileged blocks in AutoloadedDriver and only grant the permission to derby.jar, the calling code will only be able to deregister the Derby embedded driver indirectly via a call to DriverManager.getConnection(&quot;jdbc:derby:;shutdown=true&quot;). It will not be able to deregister any registered JDBC driver on the system.&lt;/p&gt;

&lt;p&gt;So I guess I&apos;m leaning towards wrapping AutoloadedDriver&apos;s calls to deregisterDriver() in a doPrivileged block and only requiring derby.jar to have the extra permission. System privileges (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2109&quot; title=&quot;System privileges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2109&quot;&gt;DERBY-2109&lt;/a&gt;) is probably a better mechanism for limiting who is allowed to invoke a system shutdown.&lt;/p&gt;</comment>
                            <comment id="13669194" author="knutanders" created="Wed, 29 May 2013 13:37:13 +0100"  >&lt;p&gt;The attached patch, derby-6224-01-a.diff, wraps a doPrivileged block around the calls to DriverManager.deregisterDriver() in AutoloadedDriver and grants SQLPermission(&quot;deregisterDriver&quot;) to derby.jar and the classes directory in derby_tests.policy and ServerPropertiesTest.policy. This was sufficient to make the tests run cleanly on JDK 8 EA b91, with the exception of one unrelated failure logged as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6233&quot; title=&quot;XMLBindingTest fails on latest JDK 8 EA&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6233&quot;&gt;&lt;del&gt;DERBY-6233&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The patch does not add the required permission to the default policy installed by the network server when it&apos;s started from the command line. This means the network server will still print an AccessControlException when it&apos;s shutting down, but that doesn&apos;t seem to cause any problems for the tests. It needs to be fixed, though.&lt;/p&gt;</comment>
                            <comment id="13669611" author="rhillegas" created="Wed, 29 May 2013 20:38:33 +0100"  >&lt;p&gt;Thanks for that analysis and for the patch, Knut. I see three issues involved here. Two are Derby specific:&lt;/p&gt;

&lt;p&gt;1) Unrestricted permission for orderly engine shutdown.&lt;/p&gt;

&lt;p&gt;2) Unrestricted permission for component removal.&lt;/p&gt;

&lt;p&gt;...and the third is a broader JDBC concern:&lt;/p&gt;

&lt;p&gt;3) A denial-of-service vulnerability associated with unrestricted access to DriverManager.deregisterDriver().&lt;/p&gt;

&lt;p&gt;As I understand it, SQLPermission( &quot;deregisterDriver&quot; ) was introduced to address (3). The permission is very broad. You can either mount the DOS attack against all servers or against none. I agree with your conclusion that orderly Derby shutdown should not open up a broad DOS attack against other servers. Since Derby only attempts to deregister its own driver, there is little risk in granting this SQLPermission to Derby all of the time. Your approach sounds good to me.&lt;/p&gt;

&lt;p&gt;There is still the vulnerability to other DOS attacks on Derby via (1) and (2). I think that we can continue that discussion on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-586&quot; title=&quot;Provide an alternative means to shut down a database other than using  getConnection()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-586&quot;&gt;DERBY-586&lt;/a&gt;. Thanks.&lt;/p&gt;</comment>
                            <comment id="13669790" author="knutanders" created="Wed, 29 May 2013 22:57:06 +0100"  >&lt;p&gt;Thanks for the feedback, Rick. I will go ahead according to my initial plan, then.&lt;/p&gt;

&lt;p&gt;I was hoping the network server shutdown issue could be solved by making NetworkServerControlImpl add the deregister=false attribute to the system shutdown command, instead of adding the SQLPermission to the default policy. Deregistering the driver during network server shutdown is not necessary. The system shutdown logic is there to ensure the databases are shut down cleanly before the JVM terminates. Whether or not the driver was deregistered is of no interest after the JVM has terminated.&lt;/p&gt;

&lt;p&gt;However, that doesn&apos;t help. deregister=false will prevent deregisterDriver() from being called on AutoloadedDriver40, but the logic is so that deregisteredDriver() will be called on Driver42 instead. If deregister=false is not specified, it&apos;s the other way around: deregisterDriver() is called on AutoloadedDriver40, but not on Driver42. So it looks as if we don&apos;t have any way to prevent deregisterDriver() from being called during system shutdown. I have a feeling that this behaviour is not intended, but I&apos;ll have to go through the comments on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2905&quot; title=&quot;Shutting down embedded Derby does not remove all code, the AutoloadDriver is left registered in the DriverManager.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2905&quot;&gt;&lt;del&gt;DERBY-2905&lt;/del&gt;&lt;/a&gt; to see if it was discussed there.&lt;/p&gt;</comment>
                            <comment id="13670291" author="knutanders" created="Thu, 30 May 2013 13:37:03 +0100"  >&lt;p&gt;I didn&apos;t find anything in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2905&quot; title=&quot;Shutting down embedded Derby does not remove all code, the AutoloadDriver is left registered in the DriverManager.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2905&quot;&gt;&lt;del&gt;DERBY-2905&lt;/del&gt;&lt;/a&gt; that suggested the current behaviour of calling DriverManager.deregisterDriver() even if deregister=false is specified, was intended. It looks like the call is a left-over from before AutoloadedDriver was introduced in 10.2.&lt;/p&gt;

&lt;p&gt;The engine code has two calls to DriverManager.registerDriver(). Both of them register an instance of AutoloadedDriver (or possibly the sub-class AutoloadedDriver40). None of them registers an instance of InternalDriver, so it looks pointless to try to unregister such a driver. And even more so when the caller has requested that the driver is not deregistered. Before JDBC 4.2, calling unregisterDriver() on a driver that was not registered was a no-op, so doing it was harmless. In JDBC 4.2 it is no longer a no-op, as it checks that the caller is granted permission to call the method. I suggest that we remove the call that tries to deregister the InteralDriver instance, since it&apos;s unnecessary and causes problems when running on Java 8.&lt;/p&gt;</comment>
                            <comment id="13670292" author="knutanders" created="Thu, 30 May 2013 13:45:07 +0100"  >&lt;p&gt;Attaching an updated patch, derby-6224-01-b.diff, which differs from the 01-a patch in the following ways:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It removes the call that tries to unregister the InternalDriver instance. After this change, all calls to deregisterDriver() take an AutoloadedDriver instance. From before we had (and still have) that all calls to registerDriver() took an AutoloadedDriver instance as argument. Also, as a consequence of this change, system shutdown will not try to call deregisterDriver() on any driver if deregister=false is specified.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It makes the network server shutdown logic use the deregister=false attribute so that we don&apos;t have to add SQLPermission(&quot;deregisterDriver&quot;) to the default server policy.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All regression tests ran cleanly with the patch.&lt;/p&gt;</comment>
                            <comment id="13671250" author="knutanders" created="Fri, 31 May 2013 09:15:48 +0100"  >&lt;p&gt;Committed the 01-b patch to trunk with revision 1488125.&lt;/p&gt;

&lt;p&gt;I plan to backport the fix at least back to 10.9, since that&apos;s how far back we currently test on JDK 8. Maybe also to 10.8. If we want to backport it further, we&apos;ll need to come up with another fix for the server shutdown problem, since the deregister=false attribute (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2905&quot; title=&quot;Shutting down embedded Derby does not remove all code, the AutoloadDriver is left registered in the DriverManager.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2905&quot;&gt;&lt;del&gt;DERBY-2905&lt;/del&gt;&lt;/a&gt;) is not available before 10.8. I don&apos;t intend to do that for now.&lt;/p&gt;</comment>
                            <comment id="13671271" author="dagw" created="Fri, 31 May 2013 10:00:11 +0100"  >&lt;p&gt;Thanks, looks like a good solution to me. +1&lt;/p&gt;</comment>
                            <comment id="13671344" author="knutanders" created="Fri, 31 May 2013 12:13:25 +0100"  >&lt;p&gt;Thanks, Dag!&lt;/p&gt;

&lt;p&gt;All tests ran cleanly with the patch on 10.10, so I committed the fix to that branch with revision 1488156.&lt;/p&gt;</comment>
                            <comment id="13677036" author="jira-bot" created="Thu, 6 Jun 2013 15:04:00 +0100"  >&lt;p&gt;Commit 1490291 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1490291&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1490291&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6224&quot; title=&quot;Issues with latest JDK 8 EA build because of missing SQLPermission&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6224&quot;&gt;&lt;del&gt;DERBY-6224&lt;/del&gt;&lt;/a&gt;: Many test failures on latest JDK 8 EA build because of missing SQLPermission&lt;/p&gt;

&lt;p&gt;Merged fix from trunk (revision 1488125).&lt;/p&gt;</comment>
                            <comment id="13677039" author="knutanders" created="Thu, 6 Jun 2013 15:05:20 +0100"  >&lt;p&gt;Merged to 10.9 and resolved some minor conflicts. Committed revision 1490291.&lt;/p&gt;</comment>
                            <comment id="13677403" author="kmarsden" created="Thu, 6 Jun 2013 20:23:16 +0100"  >&lt;p&gt;Sorry I haven&apos;t commented on this earlier.  This java 8 change has a pretty significant effect on just about any application running under security manager.  We should at least update the documentation with the new required permission and the template policy files. A release note of some sort would be good, but I am not sure exactly where it belongs as it is a java change that might affect any Derby version once running with java 8.&lt;/p&gt;

&lt;p&gt;I wonder even if we shouldn&apos;t consider just logging the failure and doing the rest of shutdown without the deregister of the driver would appropriate in this case.&lt;/p&gt;</comment>
                            <comment id="13677462" author="knutanders" created="Thu, 6 Jun 2013 21:26:59 +0100"  >&lt;p&gt;Hi Kathey,&lt;/p&gt;

&lt;p&gt;The documentation will be updated in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6239&quot; title=&quot;Document optional permission SQLPermission(&amp;quot;deregisterDriver&amp;quot;)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6239&quot;&gt;&lt;del&gt;DERBY-6239&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I agree that it may be good for compatibility to allow shutdown to continue even without this permission. Would it be sufficient to print a message to derby.log if the deregistering fails?&lt;/p&gt;

&lt;p&gt;I&apos;m not sure how to best make a release note for it, since the JRE can be upgraded independently of Derby. But I suppose it we wouldn&apos;t do any harm by mentioning the issue in the 10.10.2 release notes.&lt;/p&gt;</comment>
                            <comment id="13677536" author="kmarsden" created="Thu, 6 Jun 2013 22:33:10 +0100"  >&lt;p&gt;Knut said:&lt;br/&gt;
&amp;gt;I agree that it may be good for compatibility to allow shutdown to continue even without this permission. Would it be &amp;gt;sufficient to print a message to derby.log if the deregistering fails?&lt;br/&gt;
I think that would be sufficient. The message should include the tip to add this permission to the policy.&lt;/p&gt;

&lt;p&gt;&amp;gt;I&apos;m not sure how to best make a release note for it, since the JRE can be upgraded independently of Derby. But I &amp;gt;suppose it we wouldn&apos;t do any harm by mentioning the issue in the 10.10.2 release notes. &lt;br/&gt;
A 10.10.2 release note would be good.&lt;/p&gt;</comment>
                            <comment id="13678008" author="knutanders" created="Fri, 7 Jun 2013 13:57:00 +0100"  >&lt;p&gt;Uploading the first attempt at a release note. We may want to update it with the message in derby.log when that code has been written.&lt;/p&gt;</comment>
                            <comment id="13681156" author="knutanders" created="Wed, 12 Jun 2013 13:15:20 +0100"  >&lt;p&gt;derby-6224-02-a.diff makes shutdown write a message to derby.log instead of failing when the driver cannot be deregistered. Here&apos;s the full message written to derby.log:&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
Wed Jun 12 14:08:37 CEST 2013: Shutting down Derby engine&lt;br/&gt;
----------------------------------------------------------------&lt;br/&gt;
Wed Jun 12 14:08:37 CEST 2013:&lt;br/&gt;
Shutting down instance a816c00e-013f-3849-9ebc-0000035ea070 on database directory memory:/run/shm/derbytst/db with class loader sun.misc.Launcher$AppClassLoader@45ee12a7 &lt;br/&gt;
Could not deregister the JDBC driver during engine shutdown. Make sure SQLPermission(&quot;deregisterDriver&quot;) is granted to derby.jar.&lt;br/&gt;
java.security.AccessControlException: access denied (&quot;java.sql.SQLPermission&quot; &quot;deregisterDriver&quot;)&lt;br/&gt;
	at java.security.AccessControlContext.checkPermission(AccessControlContext.java:364)&lt;br/&gt;
	at java.security.AccessController.checkPermission(AccessController.java:562)&lt;br/&gt;
	at java.lang.SecurityManager.checkPermission(SecurityManager.java:549)&lt;br/&gt;
	at java.sql.DriverManager.deregisterDriver(DriverManager.java:399)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver$1.run(AutoloadedDriver.java:290)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver$1.run(AutoloadedDriver.java:287)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.deregisterDriver(AutoloadedDriver.java:286)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.unregisterDriverModule(AutoloadedDriver.java:265)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver20.stop(Driver20.java:105)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.stop(TopService.java:443)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.TopService.shutdown(TopService.java:394)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:229)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.FileMonitor.shutdown(FileMonitor.java:44)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:199)&lt;br/&gt;
	at org.apache.derby.impl.services.monitor.FileMonitor.shutdown(FileMonitor.java:44)&lt;br/&gt;
	at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:255)&lt;br/&gt;
	at org.apache.derby.jdbc.Driver20.connect(Driver20.java:246)&lt;br/&gt;
	at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:147)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:661)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:208)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:1483)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:1313)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:1101)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:347)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:245)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.go(Main.java:229)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.main(Main.java:75)&lt;br/&gt;
	at org.apache.derby.tools.ij.main(ij.java:59)&lt;br/&gt;
	at org.apache.derby.iapi.tools.run.main(run.java:53)&lt;br/&gt;
----------------------------------------------------------------&lt;/p&gt;</comment>
                            <comment id="13681254" author="knutanders" created="Wed, 12 Jun 2013 15:13:46 +0100"  >&lt;p&gt;I&apos;m also working on a regression test to verify that shutdown handles the missing permission gracefully.&lt;/p&gt;</comment>
                            <comment id="13681992" author="knutanders" created="Thu, 13 Jun 2013 08:33:01 +0100"  >&lt;p&gt;Attaching an updated patch, derby-6224-02-b-with-test.diff, which includes a test case that verifies that the engine can be shut down even without the permission.&lt;/p&gt;

&lt;p&gt;The command &quot;svn cp java/testing/org/apache/derbyTesting/functionTests/util/derby_tests.policy java/testing/org/apache/derbyTesting/functionTests/tests/engine/noDeregisterPermission.policy&quot; must be run before the patch is applied.&lt;/p&gt;

&lt;p&gt;When back-ported to older branches, the test must be disabled on JSR-169 because it uses DriverManager.&lt;/p&gt;</comment>
                            <comment id="13683365" author="jira-bot" created="Fri, 14 Jun 2013 15:05:04 +0100"  >&lt;p&gt;Commit 1493077 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1493077&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1493077&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6224&quot; title=&quot;Issues with latest JDK 8 EA build because of missing SQLPermission&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6224&quot;&gt;&lt;del&gt;DERBY-6224&lt;/del&gt;&lt;/a&gt;: Many test failures on latest JDK 8 EA build because of missing SQLPermission&lt;/p&gt;

&lt;p&gt;Continue shutdown if deregistering fails, and report the failure in derby.log.&lt;/p&gt;</comment>
                            <comment id="13688372" author="jira-bot" created="Wed, 19 Jun 2013 21:05:54 +0100"  >&lt;p&gt;Commit 1494758 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1494758&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1494758&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6224&quot; title=&quot;Issues with latest JDK 8 EA build because of missing SQLPermission&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6224&quot;&gt;&lt;del&gt;DERBY-6224&lt;/del&gt;&lt;/a&gt;: Many test failures on latest JDK 8 EA build because of missing SQLPermission&lt;/p&gt;

&lt;p&gt;Merged revision 1493077 from trunk.&lt;/p&gt;</comment>
                            <comment id="13689003" author="knutanders" created="Thu, 20 Jun 2013 09:23:13 +0100"  >&lt;p&gt;The back-ported fix seems to be causing build trouble on 10.10 if jsr169compile.classpath is set. I&apos;ll look into it.&lt;/p&gt;</comment>
                            <comment id="13689016" author="knutanders" created="Thu, 20 Jun 2013 09:39:52 +0100"  >&lt;p&gt;The buildbreak-10.10.diff patch makes sure the new test is always compiled against the Java 5 libraries on the 10.10 branch. It has to because it references DriverManager, which is not available on JSR-169. The test is already excluded on JSR-169 at run-time.&lt;/p&gt;</comment>
                            <comment id="13689020" author="jira-bot" created="Thu, 20 Jun 2013 09:41:54 +0100"  >&lt;p&gt;Commit 1494888 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1494888&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1494888&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6224&quot; title=&quot;Issues with latest JDK 8 EA build because of missing SQLPermission&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6224&quot;&gt;&lt;del&gt;DERBY-6224&lt;/del&gt;&lt;/a&gt;: Many test failures on latest JDK 8 EA build because of missing SQLPermission&lt;/p&gt;

&lt;p&gt;Compile the test against Java 5 libraries to prevent build issues when&lt;br/&gt;
jsr169compile.classpath is set.&lt;/p&gt;</comment>
                            <comment id="13689175" author="jira-bot" created="Thu, 20 Jun 2013 13:00:30 +0100"  >&lt;p&gt;Commit 1494947 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1494947&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1494947&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6224&quot; title=&quot;Issues with latest JDK 8 EA build because of missing SQLPermission&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6224&quot;&gt;&lt;del&gt;DERBY-6224&lt;/del&gt;&lt;/a&gt;: Many test failures on latest JDK 8 EA build because of missing SQLPermission&lt;/p&gt;

&lt;p&gt;Merged revisions 1494758 and 1494888 from 10.10.&lt;/p&gt;</comment>
                            <comment id="13689301" author="jira-bot" created="Thu, 20 Jun 2013 15:54:21 +0100"  >&lt;p&gt;Commit 1495035 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1495035&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1495035&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6224&quot; title=&quot;Issues with latest JDK 8 EA build because of missing SQLPermission&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6224&quot;&gt;&lt;del&gt;DERBY-6224&lt;/del&gt;&lt;/a&gt;: Many test failures on latest JDK 8 EA build because of missing SQLPermission&lt;/p&gt;

&lt;p&gt;Merged revisions 1490291 and 1494947 from 10.9.&lt;/p&gt;</comment>
                            <comment id="13689317" author="knutanders" created="Thu, 20 Jun 2013 16:10:36 +0100"  >&lt;p&gt;Uploading an updated release note that also mentions the message in derby.log.&lt;/p&gt;</comment>
                            <comment id="13689321" author="knutanders" created="Thu, 20 Jun 2013 16:13:36 +0100"  >&lt;p&gt;The changes have been back-ported all the way to 10.8. I&apos;m not planning to back-port them further for now, so I&apos;m marking the issue as resolved.&lt;/p&gt;</comment>
                            <comment id="13690044" author="dagw" created="Fri, 21 Jun 2013 06:33:14 +0100"  >&lt;p&gt;Does this issue pertain to the client driver at all? We do autoload it, but I guess it would be up to the user to deregister it... Next, what about the server? Doesn&apos;t the embedded driver get loaded when running the server too? If so, shouldn&apos;t we warn against customized server policies needing updates as well? Cf. release notes.&lt;/p&gt;</comment>
                            <comment id="13690091" author="knutanders" created="Fri, 21 Jun 2013 08:29:31 +0100"  >&lt;p&gt;&amp;gt; Does this issue pertain to the client driver at all? We do autoload it, but I guess it would be up to the user to deregister it...&lt;/p&gt;

&lt;p&gt;The Derby code does not attempt to deregister the client driver, so there are no changes needed in Derby. It might however be worth mentioning in the release note that user code that deregisters the driver manually, will also need the permission, and will possibly have to invoke it with doPrivileged().&lt;/p&gt;

&lt;p&gt;&amp;gt; Next, what about the server? Doesn&apos;t the embedded driver get loaded when running the server too? If so, shouldn&apos;t we warn against customized server policies needing updates as well?&lt;/p&gt;

&lt;p&gt;Yes, the server does load the embedded driver. And when the server is started from the command line, server shutdown will invoke engine shutdown. The fix made the network server shut down the engine with deregister=false so that the permission is not needed on server shutdown.&lt;/p&gt;

&lt;p&gt;If the server was not started from the command line, it will not attempt to shutdown the engine during server shutdown, so the permission is not needed for that case either.&lt;/p&gt;</comment>
                            <comment id="13690108" author="knutanders" created="Fri, 21 Jun 2013 08:57:44 +0100"  >&lt;p&gt;The build seems to have broken on 10.9 when the test was backported. It only breaks if j14lib is not set. The problem is that I changed the build script to use java14compile.classpath instead of java15compile.classpath for the new test when I backported it from 10.10. I mistakenly thought 10.9 was supposed to work on Java 1.4 (in fact, the 10.9.1 release notes say it is supported, although we removed support for it after 10.8), and the build worked in my environment because I had j14lib set, and the test ran just fine on 1.4.&lt;/p&gt;

&lt;p&gt;I&apos;ll post a patch that makes 10.9 compile the test against 1.5 instead of 1.4.&lt;/p&gt;

&lt;p&gt;The patch that broke the build on 10.9, was also backported to 10.8. However, on 10.8 it is correct to compile the test against 1.4, so that&apos;s not a problem.&lt;/p&gt;</comment>
                            <comment id="13690117" author="knutanders" created="Fri, 21 Jun 2013 09:15:41 +0100"  >&lt;p&gt;The attached buildbreak-10.9.diff patch makes the build work again on the 10.9 branch with no ant.properties file.&lt;/p&gt;</comment>
                            <comment id="13690160" author="knutanders" created="Fri, 21 Jun 2013 10:57:12 +0100"  >&lt;p&gt;Attaching an updated release note that mentions that applications may need to be changed if they call deregisterDriver() directly.&lt;/p&gt;</comment>
                            <comment id="13691713" author="dagw" created="Mon, 24 Jun 2013 06:48:28 +0100"  >&lt;p&gt;Thanks for those clarifications, Knut. I agree it&apos;s also nice to remind the client users in the release notes.&lt;/p&gt;</comment>
                            <comment id="14284732" author="myrna" created="Wed, 21 Jan 2015 00:23:01 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12373115">DERBY-2905</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12317310">DERBY-586</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12650291">DERBY-6239</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12588790" name="buildbreak-10.10.diff" size="1683" author="knutanders" created="Thu, 20 Jun 2013 09:39:52 +0100"/>
                            <attachment id="12589022" name="buildbreak-10.9.diff" size="1289" author="knutanders" created="Fri, 21 Jun 2013 09:15:41 +0100"/>
                            <attachment id="12585189" name="derby-6224-01-a.diff" size="5340" author="knutanders" created="Wed, 29 May 2013 13:37:13 +0100"/>
                            <attachment id="12585406" name="derby-6224-01-b.diff" size="7372" author="knutanders" created="Thu, 30 May 2013 13:45:07 +0100"/>
                            <attachment id="12587426" name="derby-6224-02-a.diff" size="3779" author="knutanders" created="Wed, 12 Jun 2013 13:15:20 +0100"/>
                            <attachment id="12587573" name="derby-6224-02-b-with-test.diff" size="11018" author="knutanders" created="Thu, 13 Jun 2013 08:33:01 +0100"/>
                            <attachment id="12589037" name="releaseNote.html" size="5697" author="knutanders" created="Fri, 21 Jun 2013 10:57:12 +0100"/>
                            <attachment id="12588853" name="releaseNote.html" size="4849" author="knutanders" created="Thu, 20 Jun 2013 16:10:36 +0100"/>
                            <attachment id="12586717" name="releaseNote.html" size="4515" author="knutanders" created="Fri, 7 Jun 2013 13:57:00 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 29 May 2013 19:38:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328062</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzeg27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328406</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>