<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:26:05 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2796/DERBY-2796.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2796] Obscure error messages when using SSL in various combinations</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2796</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I ran clients with various ssl configurations on their urls and startup options against servers with various ssl configurations. I will attach an html file recording my results. I feel that many of the error conditions raised diagnostics which were too obscure to be helpful. I think this will be burdensome to tech support.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12371286">DERBY-2796</key>
            <summary>Obscure error messages when using SSL in various combinations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bernt">Bernt M. Johnsen</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Jun 2007 22:03:53 +0100</created>
                <updated>Tue, 30 Jun 2009 01:14:39 +0100</updated>
                            <resolved>Wed, 20 Jun 2007 10:00:35 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                    <fixVersion>10.4.1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12502933" author="rhillegas" created="Fri, 8 Jun 2007 22:05:40 +0100"  >&lt;p&gt;Attaching ssltest.html, which describes my findings.&lt;/p&gt;</comment>
                            <comment id="12503338" author="bernt" created="Mon, 11 Jun 2007 10:12:55 +0100"  >&lt;p&gt;Thanks for your input.  &lt;/p&gt;

&lt;p&gt;1) When you have a plaintext server/client communication with an ssl peer, the plaintext side will just see garbage. That garbage, may be SSL-encoded communication or it might be something else. It is hard to give meaningful error-messages and it would require a major rewrite of the DRDA code, since this is detected way donw in the call stack. I think documentation is the proper solution here for the time being.&lt;/p&gt;

&lt;p&gt;2) The SSLException &quot;javax.net.ssl.SSLException: Unrecognized SSL message, plaintext connection?&quot; I think is ok, but it might be good to get rid of the stack trace. We have to propagate the text out to the user, since that is the only clue the user might get of what went wrong. Is this an doc issue too?&lt;/p&gt;</comment>
                            <comment id="12503340" author="bernt" created="Mon, 11 Jun 2007 10:17:46 +0100"  >&lt;p&gt;Fixing the doc typo.&lt;/p&gt;</comment>
                            <comment id="12503345" author="bernt" created="Mon, 11 Jun 2007 10:21:04 +0100"  >&lt;p&gt;The attachment belonged to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2795&quot; title=&quot;Unable to bring up server with SSL peer authentication enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2795&quot;&gt;&lt;del&gt;DERBY-2795&lt;/del&gt;&lt;/a&gt; and was therefore romved here.&lt;/p&gt;</comment>
                            <comment id="12503834" author="bernt" created="Tue, 12 Jun 2007 12:23:40 +0100"  >&lt;p&gt;The plan was that the network server refactoring (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2412&quot; title=&quot;Refactor NetworkServerControlImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2412&quot;&gt;DERBY-2412&lt;/a&gt;) should clean up the exception handling so that the javax.net.ssl.SSLException stack trace should be fixed then.&lt;/p&gt;</comment>
                            <comment id="12504608" author="bernt" created="Thu, 14 Jun 2007 10:04:29 +0100"  >&lt;p&gt;Suggestion: &lt;/p&gt;

&lt;p&gt;I&apos;ll try and get rid of the SSLException stack trace and change the two obscure error messages to e.g.:&lt;/p&gt;

&lt;p&gt;ERROR 58009: A network protocol error was encountered and the connection has been terminated: A PROTOCOL Data Stream Syntax Error was detected. Reason: 0x3. Plaintext connection to an SSL enabled server?&lt;/p&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;Invalid reply header from network server: Invalid string . Plaintext connection to an SSL enabled server?&lt;/p&gt;

&lt;p&gt;-------------------------------------------------------&lt;br/&gt;
There is also another case: If you run an ssl-enabled client against a plaintext server, you will get the following on the server console output:&lt;/p&gt;

&lt;p&gt;Execution failed because of a Distributed Protocol Error:  DRDA_Proto_SYNTAXRM; CODPNT arg  = 0; Error Code Value = 3&lt;br/&gt;
org.apache.derby.impl.drda.DRDAProtocolException: Execution failed because of a Distributed Protocol Error:  DRDA_Proto_SYNTAXRM; CODPNT arg  = 0; Error Code Value = 3&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.throwSyntaxrm(DRDAConnThread.java:468)&lt;br/&gt;
        at org.apache.derby.impl.drda.DDMReader.readDssHeader(DDMReader.java:348)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.exchangeServerAttributes(DRDAConnThread.java:1024)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.sessionInitialState(DRDAConnThread.java:618)&lt;br/&gt;
        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:264)&lt;/p&gt;

&lt;p&gt;The text &quot;Execution failed because of a Distributed Protocol Error:  DRDA_Proto_SYNTAXRM; CODPNT arg  = 0; Error Code Value = 3&quot;&lt;/p&gt;

&lt;p&gt;should be changed to &quot;Execution failed because of a Distributed Protocol Error:  DRDA_Proto_SYNTAXRM; CODPNT arg  = 0; Error Code Value = 3. SSL connection attempt to plaintext server?&lt;br/&gt;
--------------------------------------------------&lt;br/&gt;
An finally: The docs should state that a plaintext server or client has no way to know whether the ther side is an SSL enabled derby client/server or some prgram using a totally different protocol, and thus the error messages you get might seem a bit awkward.&lt;/p&gt;</comment>
                            <comment id="12504680" author="bernt" created="Thu, 14 Jun 2007 13:11:55 +0100"  >&lt;p&gt;A patch to fix the unneeded SSLException stack trace to the console. Solved by starting the ssl handshake immediately after the socket creation. DRDA_NoIO needed an extra argument to communicate why connect did not succeed.&lt;/p&gt;</comment>
                            <comment id="12505146" author="bernt" created="Fri, 15 Jun 2007 11:49:55 +0100"  >&lt;p&gt;Complete code fix attached which should solved all the issues mentioned by Rick.&lt;/p&gt;</comment>
                            <comment id="12505148" author="bernt" created="Fri, 15 Jun 2007 11:57:02 +0100"  >&lt;p&gt;Uploaded patch which adds a note about possible protocol error messages when mixing plaintext and ssl.&lt;/p&gt;</comment>
                            <comment id="12505149" author="bernt" created="Fri, 15 Jun 2007 11:57:48 +0100"  >&lt;p&gt;Uploaded patch which adds a note about possible protocol error messages when mixing plaintext and ssl.&lt;/p&gt;</comment>
                            <comment id="12505227" author="bernt" created="Fri, 15 Jun 2007 14:26:59 +0100"  >&lt;p&gt;New version of code patch fixing testconnection master file.&lt;/p&gt;</comment>
                            <comment id="12505280" author="dagw" created="Fri, 15 Jun 2007 16:52:30 +0100"  >&lt;p&gt;The patch looks good to me; the hint in the error messages will be&lt;br/&gt;
indeed helpful to understand what&apos;s going on if the user has&lt;br/&gt;
misconfigured.&lt;/p&gt;

&lt;p&gt;I notice that you had to remove localized versions of J131 &quot;A PROTOCOL&lt;br/&gt;
Data Stream Syntax Error was detected.  Reason: 0x&lt;/p&gt;
{0}
&lt;p&gt;.&quot;  since this is&lt;br/&gt;
now extended. For these locales this message will then fall back to&lt;br/&gt;
English.&lt;/p&gt;

&lt;p&gt;I did not run any tests to verify these changes.&lt;/p&gt;

&lt;p&gt;Nits:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;NetworkServerControlImpl&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Modified lines &amp;gt; 80&lt;/li&gt;
	&lt;li&gt;Spurious blank diffs (lines 2288-2290)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;I see you have updated the user docs and releaseNote.html of&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2108&quot; title=&quot;Implement SSL/TLS communication between client and server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2108&quot;&gt;&lt;del&gt;DERBY-2108&lt;/del&gt;&lt;/a&gt; accordingly, good! Some small comments on the latter:&lt;/p&gt;

&lt;p&gt;&amp;gt; Summary of Change - SSL/TLS implemented for client/server&lt;br/&gt;
&amp;gt; communication. &lt;/p&gt;

&lt;p&gt;I would make the title more descriptive:&lt;/p&gt;

&lt;p&gt;  &quot;Summary of Change - Encryption of data traffic between client and&lt;br/&gt;
  server is now supported via SSL/TLS.&quot;&lt;/p&gt;

&lt;p&gt;or some such.&lt;/p&gt;

&lt;p&gt;&amp;gt; Rationale for Change - The messages had to be extended due to more&lt;br/&gt;
&amp;gt; failure scenarios when connecting a client to a Derby server.&lt;/p&gt;

&lt;p&gt;I think this is the rationale for the changed error messages, not for&lt;br/&gt;
the issue&apos;s feature change which is introduction of SSL support.&lt;/p&gt;

&lt;p&gt;I think the rationale here would be something like:&lt;/p&gt;

&lt;p&gt;&quot;Encryption of data traffic between client and server is a desired&lt;br/&gt;
security feature for Derby.&quot;&lt;/p&gt;

&lt;p&gt;Another change not mentioned is that localized versions of J131 will&lt;br/&gt;
now fall back to English. You may want to add that, perhaps.&lt;/p&gt;
</comment>
                            <comment id="12505306" author="bernt" created="Fri, 15 Jun 2007 17:58:53 +0100"  >&lt;p&gt;Thanks Dag. I won&apos;t have time to address your issues with the patch before the deadline (which is in 2  minutes), so I really hope there will be an RC2 for this issue to make it into 10.3.&lt;/p&gt;</comment>
                            <comment id="12505770" author="bernt" created="Mon, 18 Jun 2007 11:51:11 +0100"  >&lt;p&gt;Code: Committed revision 548301 on trunk.&lt;br/&gt;
Docs: Committed revision 548304 on trunk.&lt;/p&gt;</comment>
                            <comment id="12505779" author="bernt" created="Mon, 18 Jun 2007 12:30:45 +0100"  >&lt;p&gt;Code: Committed revision 548322 on 10.3 branch.&lt;br/&gt;
Docs: Committed revision 548321 on 10.3 branch.&lt;/p&gt;</comment>
                            <comment id="12506586" author="myrna" created="Wed, 20 Jun 2007 17:19:27 +0100"  >&lt;p&gt;Unchecking 10.3.0.0, The version number of trunk was bumped with revision 547808, the changes went into trunk at revision 548301, that was 10.4.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12356362">DERBY-2108</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12359862" name="DERBY-2796-code-v2.diff" size="41665" author="bernt" created="Fri, 15 Jun 2007 14:26:50 +0100"/>
                            <attachment id="12359863" name="DERBY-2796-code-v2.stat" size="1995" author="bernt" created="Fri, 15 Jun 2007 14:26:56 +0100"/>
                            <attachment id="12359832" name="DERBY-2796-code.diff" size="40490" author="bernt" created="Fri, 15 Jun 2007 11:49:55 +0100"/>
                            <attachment id="12359833" name="DERBY-2796-code.stat" size="1911" author="bernt" created="Fri, 15 Jun 2007 11:49:55 +0100"/>
                            <attachment id="12359837" name="DERBY-2796-docs.diff" size="837" author="bernt" created="Fri, 15 Jun 2007 11:57:48 +0100"/>
                            <attachment id="12359838" name="DERBY-2796-docs.stat" size="37" author="bernt" created="Fri, 15 Jun 2007 11:57:48 +0100"/>
                            <attachment id="12359839" name="DERBY-2796-docs.zip" size="2250" author="bernt" created="Fri, 15 Jun 2007 11:57:48 +0100"/>
                            <attachment id="12359717" name="DERBY-2796-fix-sslexception.diff" size="22621" author="bernt" created="Thu, 14 Jun 2007 13:11:55 +0100"/>
                            <attachment id="12359718" name="DERBY-2796-fix-sslexception.stat" size="1016" author="bernt" created="Thu, 14 Jun 2007 13:11:55 +0100"/>
                            <attachment id="12359297" name="ssltest.html" size="4359" author="rhillegas" created="Fri, 8 Jun 2007 22:05:40 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Jun 2007 09:12:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23251</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0v7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38874</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>