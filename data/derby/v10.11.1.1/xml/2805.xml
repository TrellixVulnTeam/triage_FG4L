<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:50:46 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2805/DERBY-2805.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2805] ASSERT failure with sane build if DISTINCT and ORDER BY are present in a query that selects from a diagnostic table function.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2805</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Attempts to execute the following query will lead to an ASSERT failure with sane jars:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select distinct * from table(syscs_diag.space_table(&apos;T1&apos;)) X order by 3;&lt;/p&gt;

&lt;p&gt;ERROR XJ001: Java exception: &apos;ASSERT FAILED markOrderingDependent() not expected to be called for org.apache.derby.impl.sql.compile.FromVTI: org.apache.derby.shared.common.sanity.AssertFailure&apos;.&lt;/p&gt;

&lt;p&gt;Stack trace is:&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:162)&lt;br/&gt;
	at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147)&lt;br/&gt;
	at ResultSetNode.markOrderingDependent(ResultSetNode.java:1881)&lt;br/&gt;
	at SingleChildResultSetNode.markOrderingDependent(SingleChildResultSetNode.java:578)&lt;br/&gt;
	at SingleChildResultSetNode.markOrderingDependent(SingleChildResultSetNode.java:578)&lt;br/&gt;
	at SingleChildResultSetNode.markOrderingDependent(SingleChildResultSetNode.java:578)&lt;br/&gt;
	at SelectNode.genProjectRestrict(SelectNode.java:1409)&lt;br/&gt;
	at SelectNode.modifyAccessPaths(SelectNode.java:1816)&lt;br/&gt;
	at SingleChildResultSetNode.modifyAccessPaths(SingleChildResultSetNode.java:439)&lt;br/&gt;
	at DMLStatementNode.optimizeStatement(DMLStatementNode.java:307)&lt;br/&gt;
	at CursorNode.optimizeStatement(CursorNode.java:515)&lt;/p&gt;

&lt;p&gt;I was able to avoid this by adding an empty implementation of &quot;markOrderingDependent&quot; to the FromVTI class, so that&apos;s probably the fix that I will post (after looking a bit more closely at the code to see if this makes sense).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12371426">DERBY-2805</key>
            <summary>ASSERT failure with sane build if DISTINCT and ORDER BY are present in a query that selects from a diagnostic table function.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="army">A B</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jun 2007 00:14:29 +0100</created>
                <updated>Thu, 24 Jan 2008 16:57:36 +0000</updated>
                            <resolved>Thu, 14 Jun 2007 01:14:37 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12504329" author="army" created="Wed, 13 Jun 2007 18:03:19 +0100"  >&lt;p&gt;Attaching d2805_v1.patch to address this issue.  Patch does the following:&lt;/p&gt;

&lt;p&gt;  1 - Renames the &quot;markOrderingDependent()&quot; method and related variables to&lt;br/&gt;
      reflect their use: which is, so far as I can tell, to indicate that&lt;br/&gt;
	  the optimizer has eliminated a sort and thus that the underlying&lt;br/&gt;
	  result sets &lt;b&gt;may&lt;/b&gt; need to make adjustments to compensate for the&lt;br/&gt;
	  dropped sort.  At the moment the only result set node which needs&lt;br/&gt;
	  to make such an adjustment is IndexRowToBaseRowNode.&lt;/p&gt;

&lt;p&gt;  2 - Updates comments where appropriate to more explicitly describe the&lt;br/&gt;
	  intended use of the new &quot;adjustForSortElimination()&quot; method&lt;br/&gt;
	  (which is what &quot;markOrderingDependent()&quot; was renamed to).&lt;/p&gt;

&lt;p&gt;  3 - Adds a void implementation of &quot;adjustForSortElimination()&quot; to the&lt;br/&gt;
	  FromVTI class since that class doesn&apos;t need to make any adjustments.&lt;br/&gt;
	  This void method is what solves the failure reported in this issue.&lt;/p&gt;

&lt;p&gt;  4 - Adds appropriate test cases to a new fixture in the existing&lt;br/&gt;
	  lang/SysDiagVTIMappingTest JUnit test.&lt;/p&gt;

&lt;p&gt;Note that this patch touches several files due the method renaming mentioned in #1.&lt;/p&gt;

&lt;p&gt;I&apos;m running derbyall and suites.All now and will post when they are done.  In the meantime, it would be great if someone could review the renaming and associated comments to see if they do in fact make things clearer; if not, perhaps I can give it another go before committing...&lt;/p&gt;</comment>
                            <comment id="12504482" author="army" created="Thu, 14 Jun 2007 01:14:37 +0100"  >&lt;p&gt;derbyall and suites.All ran cleanly on SUSE Linux with ibm142, so I committed the changes with svn # 547066:&lt;/p&gt;

&lt;p&gt;  URL: &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=547066&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=547066&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Marking this issue as resolved. If there are any suggestions about how to make the code comments and/or relevant method names more clear, I can address those in a subsequent patch.  Otherwise I think this issue is complete.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12363059">DERBY-2351</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12359617" name="d2805_v1.patch" size="13204" author="army" created="Wed, 13 Jun 2007 18:03:18 +0100"/>
                            <attachment id="12359618" name="d2805_v1.stat" size="695" author="army" created="Wed, 13 Jun 2007 18:03:18 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23257</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0znj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39594</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>