<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:47:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3701/DERBY-3701.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3701] java.lang.Exception: DRDA_UnableToAccept.S:Unable to accept connections and client hang if tracing is turned on but traceDirectory does not exist</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3701</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Attempting to connect to network server if  derby.drda.traceAll is set to true and  derby.drda.traceDirectory is set to a non-existent directory causes the following exception on the console when the client attempts to connect and causes the client to hang.&lt;br/&gt;
java.lang.Exception: DRDA_UnableToAccept.S:Unable to accept connections.&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessageWork(NetworkServerControlImpl.java:&lt;br/&gt;
3172)&lt;br/&gt;
        at org.apache.derby.impl.drda.NetworkServerControlImpl.consolePropertyMessage(NetworkServerControlImpl.java:1829&lt;br/&gt;
)&lt;br/&gt;
        at org.apache.derby.impl.drda.ClientThread.run(ClientThread.java:116)&lt;/p&gt;


&lt;p&gt;See attached program DerbyIssue.java for reproducible test case.&lt;br/&gt;
This is a regression. It did not occur with 10.3.1.4.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12397290">DERBY-3701</key>
            <summary>java.lang.Exception: DRDA_UnableToAccept.S:Unable to accept connections and client hang if tracing is turned on but traceDirectory does not exist</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Jun 2008 15:36:39 +0100</created>
                <updated>Tue, 30 Jun 2009 17:12:54 +0100</updated>
                            <resolved>Wed, 11 Jun 2008 16:44:07 +0100</resolved>
                                    <version>10.3.2.1</version>
                    <version>10.3.3.0</version>
                    <version>10.4.1.3</version>
                    <version>10.5.1.1</version>
                                    <fixVersion>10.3.3.1</fixVersion>
                    <fixVersion>10.4.2.0</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12601657" author="kmarsden" created="Mon, 2 Jun 2008 16:55:26 +0100"  >&lt;p&gt;This issue seems to have been caused by the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3110&quot; title=&quot;server hangs after trace on command fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3110&quot;&gt;&lt;del&gt;DERBY-3110&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12601675" author="kmarsden" created="Mon, 2 Jun 2008 18:03:31 +0100"  >&lt;p&gt;It used to be (before &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3110&quot; title=&quot;server hangs after trace on command fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3110&quot;&gt;&lt;del&gt;DERBY-3110&lt;/del&gt;&lt;/a&gt;) that if the directory didn&apos;t exist the System properties to turn on tracing would just silently be ignored.  I think we should at least log a message to derby.log if the directory is not found.  Then perhaps as a future trunk improvement, we can attempt to create the directory if it doesn&apos;t exist.  Thoughts?&lt;/p&gt;


</comment>
                            <comment id="12602083" author="kmarsden" created="Tue, 3 Jun 2008 22:24:56 +0100"  >&lt;p&gt;Attached is my first attempt at fixing this issue.  No tests yet.  It logs the exception when it tries to turn on tracing when establishing the connection.  The problem is we get this exception for every connection, which seems like a lot of output.  Before &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3310&quot; title=&quot;ASSERT in MergeSort.checkColumnTypes() disallow legal type conversions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3310&quot;&gt;&lt;del&gt;DERBY-3310&lt;/del&gt;&lt;/a&gt; the behavior was the same except there was no logging of the exception which was wrong as well.&lt;/p&gt;

&lt;p&gt;Any thoughts on how to handle this better?&lt;/p&gt;</comment>
                            <comment id="12602138" author="dagw" created="Wed, 4 Jun 2008 02:20:32 +0100"  >&lt;p&gt;Well, it seems better with a lot of output than silently doing nothing, so it seems an improvement to me..&lt;br/&gt;
Trace was requested, after all.&lt;br/&gt;
I think the directory should be created if permissions are in place, though.&lt;/p&gt;</comment>
                            <comment id="12602262" author="kmarsden" created="Wed, 4 Jun 2008 13:39:36 +0100"  >&lt;p&gt;Do you think we should attempt to create the trace directory, even for release branches or make that change only on the trunk?&lt;/p&gt;
</comment>
                            <comment id="12602400" author="kmarsden" created="Wed, 4 Jun 2008 19:40:49 +0100"  >&lt;p&gt;Attached is a ptch derby-3701_diff.txt which resolves this issue on trunk. We will now attempt to create the trace directory if it does not exist and will no longer hang if the trace file cannot be accessed.  I added tests to NetworkServerControlApiTest. Running tests now.&lt;/p&gt;

</comment>
                            <comment id="12602490" author="myrna" created="Wed, 4 Jun 2008 23:43:32 +0100"  >&lt;p&gt;I keep going back and forth on your question. I think - as Dag said on the list - if the permissions are in place we should create the dirs.&lt;br/&gt;
But should this be backported? Or should we just give an error message in those earlier versions?&lt;br/&gt;
Either way will change the behavior, and might be an unwelcome surprise to people who have set this in their application.&lt;br/&gt;
But of course not having a connection is worse, that does need to get fixed.&lt;br/&gt;
I think maybe a compromise would be to have the stack print to derby.log in older versions. It would still mean more disk space used but not as much as if the full tracing would get created.&lt;/p&gt;</comment>
                            <comment id="12602689" author="dagw" created="Thu, 5 Jun 2008 16:59:35 +0100"  >&lt;p&gt;+1 to Myrna&apos;s compromise, creating the directory is new behavior, which would presumably necessitate a change in the docs as well, not just a release note, so better reserve that for trunk.&lt;/p&gt;</comment>
                            <comment id="12602699" author="kmarsden" created="Thu, 5 Jun 2008 17:31:18 +0100"  >&lt;p&gt;Before I check this into the trunk, I would appreciate review.  The exception handling is kind of messy since we need to throw an exception when NetworkServerControl.trace(true) fails but only log an exception if tracing  fails on making a connection.   I did this by adding a parameter to Session.initTrace to determine whether to throw the exception or not.  I&apos;d appreciate feedback on whether that&apos;s ok.&lt;/p&gt;


</comment>
                            <comment id="12603128" author="mamtas" created="Fri, 6 Jun 2008 19:29:38 +0100"  >&lt;p&gt;Kathey, i went through the patch and just have couple comments.&lt;/p&gt;

&lt;p&gt;For DssTrace.java, there is following code in the diff file,&lt;br/&gt;
                Exception e = pae.getException();&lt;br/&gt;
                if (e instanceof SecurityException)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw (SecurityException)pae.getException();&lt;br/&gt;
+                   throw (SecurityException) e;&lt;br/&gt;
                else&lt;/li&gt;
	&lt;li&gt;throw (IOException) pae.getException();&lt;br/&gt;
+                   throw (IOException) e;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Do we need to know what kind of exception it is before we throw it? In other words, could we just do?&lt;br/&gt;
                Exception e = pae.getException();&lt;br/&gt;
+               throw e;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (e instanceof SecurityException)&lt;/li&gt;
	&lt;li&gt;throw (SecurityException)pae.getException();&lt;/li&gt;
	&lt;li&gt;else&lt;/li&gt;
	&lt;li&gt;throw (IOException) pae.getException();&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Also, I wonder if it will be good to test that /trace/Server1.trace does not exist after making a Connection in xtestTraceSystemPropertiesNoPermission test.&lt;/p&gt;

&lt;p&gt;Other than that, the patch looks good to me.&lt;/p&gt;</comment>
                            <comment id="12603166" author="kmarsden" created="Fri, 6 Jun 2008 21:18:48 +0100"  >&lt;p&gt;Thanks Mamta for looking at the patch. I&apos;ll make the change in DssTrace.&lt;br/&gt;
For the test we don&apos;t have permission to read that directory so can&apos;t tell whether it created the file or not unfortunately.&lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12603186" author="kmarsden" created="Fri, 6 Jun 2008 22:40:05 +0100"  >&lt;p&gt;Attached is a release note for this issue.  I intend to backport the change, less the directory creation to 10.4 and 10.3.&lt;/p&gt;
</comment>
                            <comment id="12603267" author="dagw" created="Sat, 7 Jun 2008 02:28:31 +0100"  >&lt;p&gt;Maybe it would be good to say that any intervening directories in the given path will be created as well (I tried and they did on Solaris anyway). This may not be obvious to some users, cf. the -p option in many Unix mkdir(1) commands.&lt;/p&gt;</comment>
                            <comment id="12603413" author="knutanders" created="Sun, 8 Jun 2008 18:34:43 +0100"  >&lt;p&gt;Is the exists check necessary in the code below? In Sun&apos;s class library at least, File.mkdirs() first calls File.exists() and does nothing if the directory exists. Since mkdirs() doesn&apos;t throw IOException, I believe it should be safe in other JVMs as well.&lt;/p&gt;

&lt;p&gt;+                if (!PrivilegedFileOps.exists(traceDirectory))&lt;br/&gt;
+                &lt;/p&gt;
{
+                    PrivilegedFileOps.mkdirs(traceDirectory);
+                }

&lt;p&gt;mkdirs()&apos;s javadoc has an invalid HTML tag (&amp;lt;code&amp;gt; true &amp;lt;/true&amp;gt;). Fixed in revision 664524.&lt;/p&gt;

&lt;p&gt;The indentation in Session.java seems to be off. Probably a wrong tab size setting in your IDE. Fixed in revision 664530.&lt;/p&gt;</comment>
                            <comment id="12603634" author="kmarsden" created="Mon, 9 Jun 2008 19:12:15 +0100"  >&lt;p&gt;Attaching updated releaseNote to indicate that intervening directories will also be created (per Dag&apos;s suggestion).&lt;/p&gt;</comment>
                            <comment id="12620347" author="rhillegas" created="Wed, 6 Aug 2008 18:52:04 +0100"  >&lt;p&gt;Changed an uppercase begin-bold tag to lowercase so that it would match the corresponding lowercase end-bold tag and pass the lint tool for release notes: org.apache.derbyBuild.ReleaseNoteReader&lt;/p&gt;</comment>
                            <comment id="12625357" author="rhillegas" created="Mon, 25 Aug 2008 14:48:04 +0100"  >&lt;p&gt;Hi Kathey,&lt;/p&gt;

&lt;p&gt;Knut was wondering on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3820&quot; title=&quot;Tasks for managing the 10.4.2 release&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3820&quot;&gt;&lt;del&gt;DERBY-3820&lt;/del&gt;&lt;/a&gt; whether the release note correctly describes the behavior on 10.4 and 10.3. According to your earlier comments, you reworked the patch for those branches. The release note also seems to be talking about branches rather than releases. For instance, the behavior for 10.3 seems to me to be the behavior for the 10.3 branch, not the latest 10.3 release we have produced. It might be more useful to customers if the note talked about releases rather than branches. Thanks.&lt;/p&gt;</comment>
                            <comment id="12625396" author="myrna" created="Mon, 25 Aug 2008 16:19:48 +0100"  >&lt;p&gt;If I understand correctly, the backport to older branches still represents a change from earlier behavior of older releases off those branches in that now a warning/error message will come to derby.log (although the dirs still do not get created).&lt;/p&gt;

&lt;p&gt;The one reason why I think we might want to have a release note mentioning that is that derby.log can get really big that way.&lt;/p&gt;</comment>
                            <comment id="12625402" author="rhillegas" created="Mon, 25 Aug 2008 16:46:52 +0100"  >&lt;p&gt;Thanks for the explanation, Myrna. I&apos;m inlined to include this release note in the 10.4.2 issues list. Attaching a new version of releaseNote.html. This version clarifies the distinction between branches and releases.&lt;/p&gt;</comment>
                            <comment id="12625418" author="knutanders" created="Mon, 25 Aug 2008 17:16:42 +0100"  >&lt;p&gt;Thanks, the changes (and the explanation) made it much clearer to me.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12419675">DERBY-4128</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12422418">DERBY-4153</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12379806">DERBY-3110</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12383228" name="DerbyIssue.java" size="2055" author="kmarsden" created="Mon, 2 Jun 2008 15:37:13 +0100"/>
                            <attachment id="12383404" name="derby-3701_diff.txt" size="12505" author="kmarsden" created="Wed, 4 Jun 2008 19:40:49 +0100"/>
                            <attachment id="12383328" name="derby-3701_try1_diff.txt" size="2817" author="kmarsden" created="Tue, 3 Jun 2008 22:24:56 +0100"/>
                            <attachment id="12388852" name="releaseNote.html" size="5285" author="rhillegas" created="Mon, 25 Aug 2008 16:46:52 +0100"/>
                            <attachment id="12387662" name="releaseNote.html" size="5170" author="rhillegas" created="Wed, 6 Aug 2008 18:52:04 +0100"/>
                            <attachment id="12383700" name="releaseNote.html" size="5170" author="kmarsden" created="Mon, 9 Jun 2008 19:12:15 +0100"/>
                            <attachment id="12383595" name="releaseNote.html" size="5090" author="kmarsden" created="Fri, 6 Jun 2008 22:40:05 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 4 Jun 2008 01:20:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23797</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0udr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38740</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>