<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:35:12 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5109/DERBY-5109.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5109] testRAFWriteInterupted fails with The exception &apos;junit.framework.AssertionFailedError: interrupt flag lost&apos; was thrown while evaluating an expression</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5109</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I saw the following failure with IBM 1.4.2.&lt;/p&gt;

&lt;p&gt;testRAFWriteInterrupted(org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest)java.sql.SQLException: The exception &apos;junit.framework.AssertionFailedError: interrupt flag lost&apos; was thrown while evaluating an expression.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(Unknown Source)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest.testRAFWriteInterrupted(InterruptResilienceTest.java:204)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code))&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code))&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code))&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java(Compiled Code))&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;interrupt flag lost: junit.framework.AssertionFailedError&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)&lt;br/&gt;
	... 46 more&lt;br/&gt;
Caused by: junit.framework.AssertionFailedError: interrupt flag lost&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest.tstRAFwriteInterrupted(InterruptResilienceTest.java(Compiled Code))&lt;br/&gt;
	at org.apache.derby.exe.ac0b5b0099x012ex9446x7cf7xfffffa2dc87e0.g0(Unknown Source)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code))&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code))&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code))&lt;br/&gt;
	at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)&lt;br/&gt;
	... 42 more&lt;/p&gt;
</description>
                <environment>IBM 1.4.2   10.8.0.1 alpha - (1079089) 3/7/2011&lt;br/&gt;
on LInux&lt;br/&gt;
</environment>
        <key id="12500791">DERBY-5109</key>
            <summary>testRAFWriteInterupted fails with The exception &apos;junit.framework.AssertionFailedError: interrupt flag lost&apos; was thrown while evaluating an expression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2011 18:17:38 +0000</created>
                <updated>Tue, 19 Apr 2011 13:38:59 +0100</updated>
                            <resolved>Wed, 23 Mar 2011 11:55:27 +0000</resolved>
                                    <version>10.8.1.2</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13004134" author="kmarsden" created="Tue, 8 Mar 2011 18:47:42 +0000"  >&lt;p&gt;It looks like this issue is the same or at least the same error  &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5074&quot; title=&quot;test failure(s) with IBM 1.4.2 in store.InterruptResilienceTest.testRAFWriteInterrupted: java.sql.SQLException: The exception &amp;#39;junit.framework.AssertionFailedError: interrupt flag lost&amp;#39; was thrown while evaluating an expression. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5074&quot;&gt;&lt;del&gt;DERBY-5074&lt;/del&gt;&lt;/a&gt;, which was thought to be fixed. I probably should have reopened that one instead, but since &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5109&quot; title=&quot;testRAFWriteInterupted fails with The exception &amp;#39;junit.framework.AssertionFailedError: interrupt flag lost&amp;#39; was thrown while evaluating an expression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5109&quot;&gt;&lt;del&gt;DERBY-5109&lt;/del&gt;&lt;/a&gt;  is open now I will just leave it with this link for reference.&lt;/p&gt;</comment>
                            <comment id="13004739" author="kmarsden" created="Wed, 9 Mar 2011 19:13:15 +0000"  >&lt;p&gt;Saw this on 2011-03-08 on Windows IBM 1.4.2 with   10.8.0.1 alpha - (1079643)&lt;/p&gt;</comment>
                            <comment id="13006748" author="myrna" created="Tue, 15 Mar 2011 00:54:29 +0000"  >&lt;p&gt;I spent some time trying to see if I can pin down what the failure really is. It&apos;s consistent with ibm 1.4.2.&lt;br/&gt;
However, after making the test print some debug statements, I realized it&apos;s not consistently failing in the same call.&lt;br/&gt;
I&apos;ve tried a number of different runs, and each time, the failure occurs in a different place.&lt;br/&gt;
I looked at running without jit (by setting JAVA_COMPILER to &quot;NONE&quot;), but got the same effect. &lt;br/&gt;
I also tried running with -noclassgc -nocompactgc, which are garbage collection settings for the 1.4.2 jvm, but got no closer...&lt;/p&gt;

&lt;p&gt;I then wanted to switch off only this failing fixture, but got an intermittent failure in another fixture:&lt;/p&gt;

&lt;p&gt;1) testInterruptBatch(org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest)junit.framework.ComparisonFailure: expected 40XC0 expected:&amp;lt;40XC0&amp;gt; but was:&amp;lt;XJ001&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:791)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:826)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest.testInterruptBatch(InterruptResilienceTest.java:626)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:88)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:61)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:60)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: junit.framework.AssertionFailedError&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(Unknown Source)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest.testInterruptBatch(InterruptResilienceTest.java:623)&lt;br/&gt;
	... 32 more&lt;br/&gt;
Caused by: junit.framework.AssertionFailedError&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest.tstInterruptBatch(InterruptResilienceTest.java:603)&lt;br/&gt;
	at org.apache.derby.exe.ac7bc640efx012exb6bfx461fxffff94fc51340.g0(Unknown Source)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:88)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:61)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:60)&lt;br/&gt;
	at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)&lt;br/&gt;
	... 36 more&lt;/p&gt;

&lt;p&gt;So, I&apos;ll want to look at that also.&lt;/p&gt;

&lt;p&gt;Thus, I switched off this test altogether for ibm 1.4.2. with revision 1081612. Currently, then, it&apos;s only running with sun jvms and ibm 1.6 (because current ibm 1.5. versions still suffer from another jvm bug, see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4463&quot; title=&quot;JMX test in nightly test suite failed with:  JMXTest:clientjava.lang.InterruptedException:  &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4463&quot;&gt;&lt;del&gt;DERBY-4463&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;I&apos;m leaving this open pending further investigation.&lt;/p&gt;</comment>
                            <comment id="13007464" author="dagw" created="Wed, 16 Mar 2011 13:28:45 +0000"  >&lt;p&gt;It seems like the thread&apos;s interrupt flag is gets lost along the way (of execution) here. So, you don&apos;t see this at all with IBM 1.6?&lt;br/&gt;
In the first case, the assert fails after executing an update which does not throw, but that was interrupted before execution of the update starts. Maybe you could instrument InterruptStatus#setInterrupted to see if Derby ever notices the interrupt. If so, the flag should be reinstated before the API call exits in a call to #restoreIntrFlagIfSeen. If Derby doesn&apos;t see it, it can be that some JRE method that swallows it silently, or some location where I have forgotten to save the flag, but if so strange it only happens on this VM..&lt;/p&gt;

&lt;p&gt;In the second case Myrna tried , (testInterruptBatch), 08000 i seen but again the flag is not set. I tend to think this must be a JVM issue.. Instrumentation of #throwIf should reveal if the exception comes from where we assume it should during batch execution (EmbedStatement#executeBatch, ca line 983.&lt;/p&gt;</comment>
                            <comment id="13009835" author="dagw" created="Tue, 22 Mar 2011 20:55:49 +0000"  >&lt;p&gt;&amp;gt; I am now able to reproduce this on Linux with IBM VM: &quot;Classic VM (build&lt;br/&gt;
&amp;gt; 1.4.2, J2RE 1.4.2 IBM build cxia32142ifx-20110215 (SR13 FP8+PM31983)&lt;br/&gt;
&amp;gt; (JIT enabled: jitc)&quot;.&lt;/p&gt;

&lt;p&gt;I have been battling with this one today, it&apos;s proving elusive to track&lt;br/&gt;
down, the symptom is moving around as I instrument Derby, but I strongly&lt;br/&gt;
suspect the VM. I think instrumenting the VM is the easiest way to&lt;br/&gt;
understand what&apos;s going on.&lt;/p&gt;</comment>
                            <comment id="13009858" author="kmarsden" created="Tue, 22 Mar 2011 21:48:14 +0000"  >&lt;p&gt;Thank you Dag for looking at this issue and the IBM JVM. I think that since you strongly suspect the VM and we have only seen it with IBM 1.4.2, it is safe to close this issue as invalid and assume that is a correct assessment.     &lt;/p&gt;



</comment>
                            <comment id="13010081" author="dagw" created="Wed, 23 Mar 2011 11:55:27 +0000"  >&lt;p&gt;Closing as invalid, we currently believe this is a VM issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12499897">DERBY-5074</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12501060">DERBY-5123</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Mar 2011 00:54:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24655</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0grj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36534</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>