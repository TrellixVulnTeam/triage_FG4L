<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:26:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4923/DERBY-4923.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4923] update of a long row can fail with ERROR nospc: nospc.U exception.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4923</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;An update of a row fails with a nospc.U exception.  If there is space on the disk then an update should never fail for a space &lt;br/&gt;
issue.  The code is meant to always reserve enough space on a page such that if an expanding update happens that does not&lt;br/&gt;
fit, it should in the worst case change the row to an overflow row pointer and put the rest in a linked overflow chain.&lt;/p&gt;

&lt;p&gt;The following set of circumstances will cause this bug (not sure which are exactly needed - just what i did to&lt;br/&gt;
cause the repro), I will be attaching a test case:&lt;br/&gt;
The row being updated has the following characteristics:&lt;br/&gt;
    o located on 4k page&lt;br/&gt;
    o 2 colum row with 2nd column a blob column&lt;br/&gt;
    o the row is a long row with first piece having 1st column on main page, and the 2nd piece having just blob column on overflow page.&lt;br/&gt;
    o before the update there is 0 free space on the overflow page.&lt;br/&gt;
    o the update causes the blob column to expand past 4k &lt;/p&gt;

&lt;p&gt;Caused by: java.sql.SQLException: nospc.U&lt;br/&gt;
    at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
    at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119)&lt;br/&gt;
    at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)&lt;br/&gt;
    ... 39 more&lt;br/&gt;
Caused by: ERROR nospc: nospc.U&lt;br/&gt;
    at org.apache.derby.impl.store.raw.data.StoredPage.logRow(StoredPage.java:4155)&lt;br/&gt;
    at org.apache.derby.impl.store.raw.data.UpdateOperation.writeOptionalDataToBuffer(UpdateOperation.java:255)&lt;br/&gt;
    at org.apache.derby.impl.store.raw.data.UpdateOperation.&amp;lt;init&amp;gt;(UpdateOperation.java:106)&lt;br/&gt;
    at org.apache.derby.impl.store.raw.data.LoggableActions.actionUpdate(LoggableActions.java:80)&lt;br/&gt;
    at org.apache.derby.impl.store.raw.data.StoredPage.doUpdateAtSlot(StoredPage.java:8625)&lt;br/&gt;
    at org.apache.derby.impl.store.raw.data.BasePage.updateAtSlot(BasePage.java:1062)&lt;br/&gt;
    at org.apache.derby.impl.store.access.conglomerate.GenericConglomerateController.replace(GenericConglomerateController.java:486)&lt;br/&gt;
    at org.apache.derby.impl.sql.execute.RowChangerImpl.updateRow(RowChangerImpl.java:523)&lt;br/&gt;
    at org.apache.derby.impl.sql.execute.UpdateResultSet.collectAffectedRows(UpdateResultSet.java:569)&lt;br/&gt;
    at org.apache.derby.impl.sql.execute.UpdateResultSet.open(UpdateResultSet.java:264)&lt;br/&gt;
    at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:436)&lt;br/&gt;
    at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:317)&lt;br/&gt;
    at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1241)&lt;br/&gt;
    ... 33 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12491720">DERBY-4923</key>
            <summary>update of a long row can fail with ERROR nospc: nospc.U exception.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikem">Mike Matrigali</assignee>
                                    <reporter username="mikem">Mike Matrigali</reporter>
                        <labels>
                            <label>derby_triage10_11</label>
                    </labels>
                <created>Wed, 1 Dec 2010 01:01:25 +0000</created>
                <updated>Wed, 21 Jan 2015 00:23:28 +0000</updated>
                            <resolved>Mon, 4 Nov 2013 21:33:06 +0000</resolved>
                                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                    <version>10.6.2.1</version>
                    <version>10.10.1.1</version>
                    <version>10.11.1.1</version>
                                    <fixVersion>10.8.3.3</fixVersion>
                    <fixVersion>10.9.2.2</fixVersion>
                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="12965520" author="mikem" created="Wed, 1 Dec 2010 01:20:14 +0000"  >&lt;p&gt;derby4923repro.diff is a repro of the bug in the form of a junit test to be run from the codeline.  The attached derby.log shows the result from running it against a sane build.&lt;/p&gt;</comment>
                            <comment id="12994413" author="mikem" created="Mon, 14 Feb 2011 18:42:29 +0000"  >&lt;p&gt;reproducible serious bug setting urgency to urgent.  Once hit the row can&apos;t be updated any more.&lt;/p&gt;

&lt;p&gt;triaged for 10.8.&lt;/p&gt;</comment>
                            <comment id="13010111" author="rhillegas" created="Wed, 23 Mar 2011 13:22:37 +0000"  >&lt;p&gt;Turning off the &quot;Wrong query result&quot; box. It seems to me that this bug does not return the wrong rows to the user. It raises an exception and fails.&lt;/p&gt;</comment>
                            <comment id="13419118" author="rhillegas" created="Fri, 20 Jul 2012 14:25:13 +0100"  >&lt;p&gt;Hi Mike,&lt;/p&gt;

&lt;p&gt;This bug is assigned to you. Are you still working on it? Thanks.&lt;/p&gt;</comment>
                            <comment id="13419325" author="mikem" created="Fri, 20 Jul 2012 17:32:21 +0100"  >&lt;p&gt;i had plans to look at this, but not top of my list.  unassiging it for now and will change if I am actively working on it.&lt;/p&gt;</comment>
                            <comment id="13419389" author="rhillegas" created="Fri, 20 Jul 2012 18:54:27 +0100"  >&lt;p&gt;Attaching DERBY_4923.java. This reworks Mike&apos;s test case to be a standalone program rather than a JUnit test. If you run this with an insane engine, you get the stack trace indicated in this bug report. If you run this with a sane engine, you get an assertion.&lt;/p&gt;

&lt;p&gt;I don&apos;t know if it&apos;s significant that the test case compresses the table. However, table compression certainly takes us through code which has given rise to a lot of bugs.&lt;/p&gt;</comment>
                            <comment id="13419498" author="rhillegas" created="Fri, 20 Jul 2012 20:49:19 +0100"  >&lt;p&gt;Comments on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4577&quot; title=&quot;An expanding update fails with an nospc.U error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4577&quot;&gt;&lt;del&gt;DERBY-4577&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4923&quot; title=&quot;update of a long row can fail with ERROR nospc: nospc.U exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4923&quot;&gt;&lt;del&gt;DERBY-4923&lt;/del&gt;&lt;/a&gt; suggest that NoSpaceOnPage is a transient signal passed between methods inside StoredPage. If you grep the codeline, you see that StoredPage is the only class which mentions this exception. Low level logging methods throw NoSpaceOnPage to tell their callers that there isn&apos;t enough room on the page for the operation. The callers (in StoredPage) are supposed to allocate more space and then retry the operation. It seems that NoSpaceOnPage should never leak out of StoredPage. It should never escape to methods higher on the call stack. Does that sound correct?&lt;/p&gt;

&lt;p&gt;I am attaching derby-4923-tt-aa-NoSpaceOnPageExtendsException.diff. This patch changes NoSpaceOnPage, making it directly extend Exception so that it is no longer a StandardException. With this change you can see that it may be possible for NoSpaceOnPage to escape outside StoredPage to methods in the following classes:&lt;/p&gt;

&lt;p&gt;UpdateOperation&lt;br/&gt;
CopyRowsOperation&lt;br/&gt;
DirectActions&lt;br/&gt;
UpdateFieldOperation&lt;br/&gt;
InsertOperation&lt;/p&gt;

&lt;p&gt;There may be reasons why some of these callers can be confident that they won&apos;t ever see a NoSpaceOnPage exception. However, I don&apos;t understand how we can prove that assertion for any of these classes. It&apos;s clear that NoSpaceOnPage can leak up to at least one of these classes (UpdateOperation), perhaps in several ways given the number of bugs we have seen with this stack trace.&lt;/p&gt;

&lt;p&gt;Is there some way that we can prove that NoSpaceOnPage won&apos;t escape to any of the other calling classes?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13419620" author="mikem" created="Fri, 20 Jul 2012 23:07:59 +0100"  >&lt;p&gt;I do believe it is always a bug if a NoSpaceOnPage leaks out to a user.  There is a normal case where we can&apos;t insert and/or update keys in indexes over a certain size, but I think that&lt;br/&gt;
gets wrapped in a different exception.&lt;/p&gt;

&lt;p&gt;If the code were acting correctly then it would have reserved enough space such that the operation is not leaking the exception.  So at least in the cases that I have debugged in the&lt;br/&gt;
past the bug is not in the operation that is failing, it is in  a previous operation that lead to the page getting to state with not enough reserved space to do the operation.  There are &lt;br/&gt;
2 things to handle.  First is that the head of a row in a base table (heap) can never move off its page, so you must reserve enough space in the head row/page so that in the worst&lt;br/&gt;
case you can change the row to one that just has the head of row pointing to a linked list of all the other columns on another page.  The second case is handling the &quot;middle&quot; of the&lt;br/&gt;
row on another page.  Again similarly the design is to reserve enough space for the row such that if you need to expand it there is always enough space in worst case to just make&lt;br/&gt;
it a pointer yet another chunk somewhere.  It gets tricky in that a row might be smaller than what is necessary in the worst case to be one of these pointers.  &lt;/p&gt;

&lt;p&gt;The mostly likely place for this bug to happen would be in UpdateOperation and UpdateFieldOperation as these result in expanding the length of the row in place. &lt;/p&gt;

&lt;p&gt;CopyRowsOperation prechecks that the destination of the rows has space and maintains a latch so that it is guaranteed.  I remember a NoSpaceOnPage bug in the past in this one&lt;br/&gt;
where the bug was in the check not accounting for the correct change in compressed size of the page field, so in this case the bug was in the operation and not in the previous operaition.&lt;/p&gt;

&lt;p&gt;InsertOperation is the normal path for NoSpaceOnPage exceptions, I expect that somehow the code is set to catch these as it is the normal way to tell to insert a row somewhere else&lt;br/&gt;
rather than where it does not fit.&lt;/p&gt;
</comment>
                            <comment id="13420694" author="rhillegas" created="Mon, 23 Jul 2012 15:59:38 +0100"  >&lt;p&gt;Thanks for that explanation, Mike. This observation particularly struck me:&lt;/p&gt;

&lt;p&gt;&quot;So at least in the cases that I have debugged in the past the bug is not in the operation that is failing, it is in a previous operation that lead to the page getting to state with not enough reserved space to do the operation.&quot;&lt;/p&gt;

&lt;p&gt;This increases my suspicion that the attached repro may turn out to be another bug in table compression.&lt;/p&gt;

&lt;p&gt;On the related issue &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5858&quot; title=&quot;java.sql.SQLException: nospc.U trying to update a row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5858&quot;&gt;DERBY-5858&lt;/a&gt;, table compression was not used. So there is at least another code path, not involving table compression, which sets up this NoSpaceOnPage condition.&lt;/p&gt;
</comment>
                            <comment id="13464083" author="kmarsden" created="Wed, 26 Sep 2012 20:22:40 +0100"  >&lt;p&gt;Verified the repro attached still reproduces the error  against trunk and . The reproduction connects with an in-memory database so I didn&apos;t verify but presumably the original Data corruption flag is correct as well.  This would be great to get this one fixed for the next release. Do we have an idea of the scope of the work?&lt;/p&gt;

</comment>
                            <comment id="13803009" author="mikem" created="Wed, 23 Oct 2013 17:44:06 +0100"  >&lt;p&gt;This patch fixes the problem repro&apos;d by the included new test.  The problem was an off by 1 in checking for enough space to update a row on an overflow page to just an overflow pointer.  The intent of the code is to always reserve enough space in every overflow row to allow for this update.  In this case there was exactly enough space, but the code mistaken thought it needed 1 more byte.&lt;/p&gt;

&lt;p&gt;This patch also has been run full tests and passed against trunk.&lt;/p&gt;</comment>
                            <comment id="13803023" author="jira-bot" created="Wed, 23 Oct 2013 18:07:40 +0100"  >&lt;p&gt;Commit 1535075 from mikem@apache.org in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1535075&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1535075&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6320&quot; title=&quot;Log a page dump to derby.log if ERROR nospc: nospc.U  is returned to the user&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6320&quot;&gt;&lt;del&gt;DERBY-6320&lt;/del&gt;&lt;/a&gt; Log a page dump to derby.log if ERROR nospc: nospc.U is returned to the user&lt;br/&gt;
This patch adds the ability to dump a page in an insane build, and adds 2 calls to do so in 2 outstanding nospc error cases. In those two cases a new user&lt;br/&gt;
level error is thrown and nests the nospc.U error so that we still know the&lt;br/&gt;
original stack trace where the lowest error was thrown.  &lt;br/&gt;
The patch passes all tests and the specific errors were hand tested, one of &lt;br/&gt;
them using the test case filed in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4923&quot; title=&quot;update of a long row can fail with ERROR nospc: nospc.U exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4923&quot;&gt;&lt;del&gt;DERBY-4923&lt;/del&gt;&lt;/a&gt; and in the other case just by hand forcing the codepath.&lt;/p&gt;</comment>
                            <comment id="13803524" author="jira-bot" created="Thu, 24 Oct 2013 00:10:02 +0100"  >&lt;p&gt;Commit 1535206 from mikem@apache.org in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1535206&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1535206&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6320&quot; title=&quot;Log a page dump to derby.log if ERROR nospc: nospc.U  is returned to the user&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6320&quot;&gt;&lt;del&gt;DERBY-6320&lt;/del&gt;&lt;/a&gt; Log a page dump to derby.log if ERROR nospc: nospc.U is returned to the user&lt;/p&gt;

&lt;p&gt;backported change #1535075 from trunk to 10.10 branch, muliple manual changes&lt;br/&gt;
were necessary for the backport.&lt;/p&gt;

&lt;p&gt;The backport of this change from trunk to 10.10 did not go cleanly at all due&lt;br/&gt;
to usage of new java language features in messages in trunk. Here is the patch&lt;br/&gt;
for 10.10 which I assume will backport cleanly to previous releases.&lt;br/&gt;
The 2 problems were a new 15 param message and that trunk did not require&lt;br/&gt;
Objects in newException() anymore. Also had to hand resolve a merge issue in&lt;br/&gt;
StoredPage.java&lt;/p&gt;

&lt;p&gt;This patch adds the ability to dump a page in an insane build, and adds 2 calls&lt;br/&gt;
to do so in 2 outstanding nospc error cases. In those two cases a new user&lt;br/&gt;
level error is thrown and nests the nospc.U error so that we still know the&lt;br/&gt;
original stack trace where the lowest error was thrown.&lt;br/&gt;
The patch passes all tests and the specific errors were hand tested, one of&lt;br/&gt;
them using the test case filed in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4923&quot; title=&quot;update of a long row can fail with ERROR nospc: nospc.U exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4923&quot;&gt;&lt;del&gt;DERBY-4923&lt;/del&gt;&lt;/a&gt; and in the other case just by hand&lt;br/&gt;
forcing the codepath.&lt;/p&gt;</comment>
                            <comment id="13803712" author="jira-bot" created="Thu, 24 Oct 2013 04:34:52 +0100"  >&lt;p&gt;Commit 1535273 from mikem@apache.org in branch &apos;code/branches/10.9&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1535273&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1535273&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6320&quot; title=&quot;Log a page dump to derby.log if ERROR nospc: nospc.U  is returned to the user&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6320&quot;&gt;&lt;del&gt;DERBY-6320&lt;/del&gt;&lt;/a&gt; Log a page dump to derby.log if ERROR nospc: nospc.U is returned to the user&lt;/p&gt;

&lt;p&gt;backported change #1535206 from 10.10 to 10.9 branch, merge was clean.&lt;/p&gt;

&lt;p&gt;This patch adds the ability to dump a page in an insane build, and adds 2 calls&lt;br/&gt;
to do so in 2 outstanding nospc error cases. In those two cases a new user&lt;br/&gt;
level error is thrown and nests the nospc.U error so that we still know the&lt;br/&gt;
original stack trace where the lowest error was thrown.&lt;br/&gt;
The patch passes all tests and the specific errors were hand tested, one of&lt;br/&gt;
them using the test case filed in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4923&quot; title=&quot;update of a long row can fail with ERROR nospc: nospc.U exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4923&quot;&gt;&lt;del&gt;DERBY-4923&lt;/del&gt;&lt;/a&gt; and in the other case just by hand&lt;br/&gt;
forcing the codepath.&lt;/p&gt;</comment>
                            <comment id="13804306" author="jira-bot" created="Thu, 24 Oct 2013 16:16:48 +0100"  >&lt;p&gt;Commit 1535408 from mikem@apache.org in branch &apos;code/branches/10.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1535408&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1535408&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6320&quot; title=&quot;Log a page dump to derby.log if ERROR nospc: nospc.U  is returned to the user&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6320&quot;&gt;&lt;del&gt;DERBY-6320&lt;/del&gt;&lt;/a&gt; Log a page dump to derby.log if ERROR nospc: nospc.U is returned to the user&lt;/p&gt;

&lt;p&gt;backported change #1535206 from 10.10 to 10.8 branch, merge was clean.&lt;/p&gt;

&lt;p&gt;This patch adds the ability to dump a page in an insane build, and adds 2 calls&lt;br/&gt;
to do so in 2 outstanding nospc error cases. In those two cases a new user&lt;br/&gt;
level error is thrown and nests the nospc.U error so that we still know the&lt;br/&gt;
original stack trace where the lowest error was thrown.&lt;br/&gt;
The patch passes all tests and the specific errors were hand tested, one of&lt;br/&gt;
them using the test case filed in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4923&quot; title=&quot;update of a long row can fail with ERROR nospc: nospc.U exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4923&quot;&gt;&lt;del&gt;DERBY-4923&lt;/del&gt;&lt;/a&gt; and in the other case just by hand&lt;br/&gt;
forcing the codepath.&lt;/p&gt;</comment>
                            <comment id="13804316" author="jira-bot" created="Thu, 24 Oct 2013 16:27:16 +0100"  >&lt;p&gt;Commit 1535413 from mikem@apache.org in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1535413&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1535413&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4923&quot; title=&quot;update of a long row can fail with ERROR nospc: nospc.U exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4923&quot;&gt;&lt;del&gt;DERBY-4923&lt;/del&gt;&lt;/a&gt; update of a long row can fail with ERROR nospc: nospc.U exception.&lt;/p&gt;

&lt;p&gt;This checkin fixes the problem repro&apos;d by the included new test, which shows&lt;br/&gt;
an update of an existing row in db failing with a nosp.U exception. &lt;br/&gt;
The problem was an off by 1 error in checking for enough space to update a row&lt;br/&gt;
on an overflow page to just an overflow pointer. The intent of the code is to &lt;br/&gt;
always reserve enough space in every overflow row to allow for this update. &lt;br/&gt;
In this case there was exactly enough space, but the code mistaken thought it &lt;br/&gt;
needed 1 more byte.&lt;/p&gt;</comment>
                            <comment id="13804638" author="jira-bot" created="Thu, 24 Oct 2013 21:22:54 +0100"  >&lt;p&gt;Commit 1535523 from mikem@apache.org in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1535523&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1535523&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4923&quot; title=&quot;update of a long row can fail with ERROR nospc: nospc.U exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4923&quot;&gt;&lt;del&gt;DERBY-4923&lt;/del&gt;&lt;/a&gt; update of a long row can fail with ERROR nospc: nospc.U exception.&lt;/p&gt;

&lt;p&gt;backport change #1535413 from trunk to 10.10 branch.&lt;/p&gt;

&lt;p&gt;This checkin fixes the problem repro&apos;d by the included new test, which shows&lt;br/&gt;
an update of an existing row in db failing with a nosp.U exception.&lt;br/&gt;
The problem was an off by 1 error in checking for enough space to update a row&lt;br/&gt;
on an overflow page to just an overflow pointer. The intent of the code is to&lt;br/&gt;
always reserve enough space in every overflow row to allow for this update.&lt;br/&gt;
In this case there was exactly enough space, but the code mistaken thought it&lt;br/&gt;
needed 1 more byte.&lt;/p&gt;</comment>
                            <comment id="13804751" author="jira-bot" created="Thu, 24 Oct 2013 23:21:02 +0100"  >&lt;p&gt;Commit 1535576 from mikem@apache.org in branch &apos;code/branches/10.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1535576&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1535576&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4923&quot; title=&quot;update of a long row can fail with ERROR nospc: nospc.U exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4923&quot;&gt;&lt;del&gt;DERBY-4923&lt;/del&gt;&lt;/a&gt; update of a long row can fail with ERROR nospc: nospc.U exception.&lt;/p&gt;

&lt;p&gt;backport change #1535413 from trunk to 10.8 branch.&lt;/p&gt;

&lt;p&gt;This checkin fixes the problem repro&apos;d by the included new test, which shows&lt;br/&gt;
an update of an existing row in db failing with a nosp.U exception.&lt;br/&gt;
The problem was an off by 1 error in checking for enough space to update a row&lt;br/&gt;
on an overflow page to just an overflow pointer. The intent of the code is to&lt;br/&gt;
always reserve enough space in every overflow row to allow for this update.&lt;br/&gt;
In this case there was exactly enough space, but the code mistaken thought it&lt;br/&gt;
needed 1 more byte.&lt;/p&gt;</comment>
                            <comment id="13804753" author="jira-bot" created="Thu, 24 Oct 2013 23:22:01 +0100"  >&lt;p&gt;Commit 1535577 from mikem@apache.org in branch &apos;code/branches/10.9&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1535577&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1535577&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4923&quot; title=&quot;update of a long row can fail with ERROR nospc: nospc.U exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4923&quot;&gt;&lt;del&gt;DERBY-4923&lt;/del&gt;&lt;/a&gt; update of a long row can fail with ERROR nospc: nospc.U exception.&lt;/p&gt;

&lt;p&gt;backport change #1535413 from trunk to 10.9 branch.&lt;/p&gt;

&lt;p&gt;This checkin fixes the problem repro&apos;d by the included new test, which shows&lt;br/&gt;
an update of an existing row in db failing with a nosp.U exception.&lt;br/&gt;
The problem was an off by 1 error in checking for enough space to update a row&lt;br/&gt;
on an overflow page to just an overflow pointer. The intent of the code is to&lt;br/&gt;
always reserve enough space in every overflow row to allow for this update.&lt;br/&gt;
In this case there was exactly enough space, but the code mistaken thought it&lt;br/&gt;
needed 1 more byte.&lt;/p&gt;</comment>
                            <comment id="13804755" author="mikem" created="Thu, 24 Oct 2013 23:23:51 +0100"  >&lt;p&gt;fixed in trunk and backported to 10.10, 10.9, and 10.8.  I don&apos;t plan on backporting farther at this time, but it would be fine if someone else is interested.&lt;/p&gt;</comment>
                            <comment id="14284808" author="myrna" created="Wed, 21 Jan 2015 00:23:28 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12665995">DERBY-6319</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12539208">DERBY-5581</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12598679">DERBY-5858</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12526300">DERBY-5450</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12599854">DERBY-5876</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12609878" name="DERBY-4923.diff" size="14823" author="mikem" created="Wed, 23 Oct 2013 17:44:06 +0100"/>
                            <attachment id="12537376" name="DERBY_4923.java" size="7379" author="rhillegas" created="Fri, 20 Jul 2012 18:54:27 +0100"/>
                            <attachment id="12537400" name="derby-4923-tt-aa-NoSpaceOnPageExtendsException.diff" size="11082" author="rhillegas" created="Fri, 20 Jul 2012 20:49:19 +0100"/>
                            <attachment id="12465016" name="derby.log" size="36628" author="mikem" created="Wed, 1 Dec 2010 01:20:14 +0000"/>
                            <attachment id="12465015" name="derby4923repro.diff" size="12171" author="mikem" created="Wed, 1 Dec 2010 01:20:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10364"><![CDATA[Data corruption]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Mar 2011 13:22:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24536</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy09hr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35356</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>