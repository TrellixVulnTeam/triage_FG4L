<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:32:56 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1304/DERBY-1304.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1304] DROP view does not always completely remove view</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1304</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Execute the following scenario:&lt;/p&gt;

&lt;p&gt;Create a schema&lt;br/&gt;
Create a table&lt;br/&gt;
Create a view&lt;/p&gt;

&lt;p&gt;Drop the view&lt;br/&gt;
Drop the table&lt;br/&gt;
Drop the schema&lt;/p&gt;

&lt;p&gt;The first time this sequence executes OK, However, executing the same sequence again fails on the drop view:&lt;br/&gt;
ERROR X0X05: Table &apos;view&apos; does not exist.&lt;/p&gt;

&lt;p&gt;When I leave out the create and drop of a view, all goes well, so it seems &lt;br/&gt;
to have something to do with the view.&lt;/p&gt;

&lt;p&gt;I encountered the problem first using org.apache.derby.jdbc.ClientConnectionPoolDataSource, but later I found that the problem is reproducable with a simple ij script as follows:&lt;br/&gt;
&amp;#8211; *******************************************************&lt;br/&gt;
&amp;#8211; Setup connection&lt;br/&gt;
&amp;#8211; *******************************************************&lt;br/&gt;
connect &apos;jdbc:derby://localhost/TestData;create=true;&apos;;&lt;br/&gt;
&amp;#8211; *******************************************************&lt;br/&gt;
&amp;#8211; The first time&lt;br/&gt;
&amp;#8211; *******************************************************&lt;br/&gt;
CREATE SCHEMA TEST_SCHEMA;&lt;br/&gt;
CREATE TABLE TEST_SCHEMA.T1 (TABLE_COLUMN LONG VARCHAR);&lt;br/&gt;
CREATE VIEW TEST_SCHEMA.V1 AS SELECT TABLE_COLUMN AS VIEW_COLUMN FROM &lt;br/&gt;
TEST_SCHEMA.T1;&lt;/p&gt;

&lt;p&gt;DROP VIEW TEST_SCHEMA.V1;&lt;br/&gt;
DROP TABLE TEST_SCHEMA.T1;&lt;br/&gt;
DROP SCHEMA TEST_SCHEMA RESTRICT;&lt;br/&gt;
&amp;#8211; *******************************************************&lt;br/&gt;
&amp;#8211; The second time&lt;br/&gt;
&amp;#8211; *******************************************************&lt;br/&gt;
CREATE SCHEMA TEST_SCHEMA;&lt;br/&gt;
CREATE TABLE TEST_SCHEMA.T1 (TABLE_COLUMN LONG VARCHAR);&lt;br/&gt;
CREATE VIEW TEST_SCHEMA.V1 AS SELECT TABLE_COLUMN AS VIEW_COLUMN FROM &lt;br/&gt;
TEST_SCHEMA.T1;&lt;/p&gt;

&lt;p&gt;DROP VIEW TEST_SCHEMA.V1; &amp;#8211; This statement fails&lt;br/&gt;
DROP TABLE TEST_SCHEMA.T1;&lt;br/&gt;
DROP SCHEMA TEST_SCHEMA RESTRICT;&lt;br/&gt;
&amp;#8211; *******************************************************&lt;br/&gt;
&amp;#8211; Cleanup&lt;br/&gt;
&amp;#8211; *******************************************************&lt;br/&gt;
disconnect;&lt;br/&gt;
connect &apos;jdbc:derby://localhost/TestData;shutdown=true;&apos;;&lt;/p&gt;

&lt;p&gt;As an explanation why I would like to be able to create and then drop views: I am trying to interactively create my table setup. When I make mistakes I must drop wrongly defined tables or views.&lt;/p&gt;

&lt;p&gt;I encountered some other very strange behaviour that might be related to this issue (table not found when I just created it and wanted to create a second table with a foreign key referencing the first table), but which I am not yet able to reproduce in a consistent and simple way.&lt;/p&gt;</description>
                <environment>Windows XP</environment>
        <key id="12333366">DERBY-1304</key>
            <summary>DROP view does not always completely remove view</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yipng">Yip Ng</assignee>
                                    <reporter username="pietblok">Piet Blok</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 May 2006 03:26:34 +0100</created>
                <updated>Thu, 27 Sep 2007 16:43:25 +0100</updated>
                            <resolved>Thu, 27 Sep 2007 16:43:25 +0100</resolved>
                                    <version>10.1.2.1</version>
                                    <fixVersion>10.1.3.2</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12378502" author="bandaram" created="Tue, 9 May 2006 03:47:42 +0100"  >&lt;p&gt;I believe this problem would showup only when target schema of the view doesn&apos;t match current schema. In the example above, current schema is probably NOT test_schema, where the view is being created in. That is also why the problem doesn&apos;t show when setting current schema to TEST_SCHEMA as suggested by Rajesh. If this is the case, I would suggest changing the description to indicate that the problem shows up only under this condition.&lt;/p&gt;

&lt;p&gt;Also, the Component should be SQL. Store is probably not at fault here.&lt;/p&gt;</comment>
                            <comment id="12378505" author="mikem" created="Tue, 9 May 2006 03:51:55 +0100"  >&lt;p&gt;changing component to SQL.  In derby all view handling is done by metadata handled above the store.  Also there is metadata data caching that is done above the store.  It seems more likely the problem is there than in the store.&lt;/p&gt;</comment>
                            <comment id="12435727" author="yipng" created="Tue, 19 Sep 2006 09:41:06 +0100"  >&lt;p&gt;I stumbled on this while writing testcases and I have a patch for it.  Will post it for review once derbyall passes.&lt;/p&gt;</comment>
                            <comment id="12435971" author="yipng" created="Tue, 19 Sep 2006 20:12:35 +0100"  >&lt;p&gt;Attaching initial patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1304&quot; title=&quot;DROP view does not always completely remove view&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1304&quot;&gt;&lt;del&gt;DERBY-1304&lt;/del&gt;&lt;/a&gt;.  &lt;/p&gt;

&lt;p&gt;The problem is that DROP VIEW&apos;s binding logic is using its superclass QueryTreeNode&apos;s bind() method which just simply returns the object itself.  So there is no actual binding done in DROP VIEW at all!  It should have created a dependency on the statement, so when its associated descriptor gets dropped, the statement can be invalidated accordingly.  This explains why the second DROP VIEW fails since it is not invalidated by the system.  &lt;/p&gt;

&lt;p&gt;Another problem I see is if one just prepare the DROP VIEW statement, it will succeed even if the view does not exist.  This exhibits a different behavior than of DROP TABLE.  I really think this should stay consistent by throwing error at bind time.  However, doing so will definitely trigger a lot of diffs to the existing master output files.  Perhaps this behavior can be corrected in another jira.  Hence in the patch, it only addresses the dependency problem and let execution handle the view existence checking like before.  derbyall passes with this patch.    &lt;/p&gt;</comment>
                            <comment id="12436003" author="bryanpendleton" created="Tue, 19 Sep 2006 21:50:37 +0100"  >&lt;p&gt;Hi Yip, thanks for the patch!&lt;/p&gt;

&lt;p&gt;I had a look at your comments and at the patch code, and it seems reasonable to me.&lt;/p&gt;

&lt;p&gt;However, I am having a strange result with the testing.&lt;/p&gt;

&lt;p&gt;I tried running your test case without the code change, and the test passes, where I had&lt;br/&gt;
expected the test to fail.&lt;/p&gt;

&lt;p&gt;Strangely, though, based on the description in the comments, I tried typing in a very similar&lt;br/&gt;
test case and it failed just as I expected it to:&lt;/p&gt;

&lt;p&gt;create schema s;&lt;br/&gt;
create table s.t1 (a int);&lt;br/&gt;
create view s.v1 as select a as c_1 from s.t1;&lt;br/&gt;
drop view s.v1;&lt;br/&gt;
drop table s.t1;&lt;br/&gt;
drop schema s restrict;&lt;br/&gt;
create schema s;&lt;br/&gt;
create table s.t1 (a int);&lt;br/&gt;
create view s.v1 as select a as c_1 from s.t1;&lt;br/&gt;
drop view s.v1;&lt;/p&gt;

&lt;p&gt;At this last statement, I get &quot;ERROR X0X05: Table/View &apos;S.V1&apos; does not exist.&quot;.&lt;/p&gt;

&lt;p&gt;But for some reason, I don&apos;t get this error with your test case.&lt;/p&gt;

&lt;p&gt;I am mystified by this and can&apos;t explain why the two scripts would have different behavior,&lt;br/&gt;
but I double-checked my steps several times and am pretty confident that I am seeing&lt;br/&gt;
that behavior.&lt;/p&gt;

&lt;p&gt;Can you help me understand why I might be seeing this different behavior?&lt;/p&gt;</comment>
                            <comment id="12436024" author="yipng" created="Tue, 19 Sep 2006 22:51:44 +0100"  >&lt;p&gt;Hi Bryan, thanks for reviewing the patch.  I think I know why the error didn&apos;t show up with the test script.  It is due to the &amp;#8211; comment that is before the second DROP VIEW statement.  i.e.:  &lt;/p&gt;

&lt;p&gt;At GenericStatement.prepMinion() time: &lt;/p&gt;

&lt;p&gt;The GenericStatement&apos;s statementText = &quot;-- this is a comment;\r\nDROP VIEW TEST_SCHEMA.V1&quot;&lt;/p&gt;

&lt;p&gt;So when the system tries to look up this from the statement cache, it will miss since the hashCode of this statementText is different from the previous DROP VIEW statementText = &quot;DROP VIEW TEST_SCHEMA.V1&quot;&apos;s hashCode.   Since it didn&apos;t find a match, the system feeds this statement text to the compiler for compilation; hence,  the error won&apos;t show up in this case.  Thanks for catching that.  I am going to resubmit the patch.&lt;/p&gt;</comment>
                            <comment id="12436026" author="yipng" created="Tue, 19 Sep 2006 22:55:36 +0100"  >&lt;p&gt;Attaching derby1304-trunk-diff02.txt, this patch fixes up the testscript problem that Bryan found.&lt;/p&gt;</comment>
                            <comment id="12436028" author="bryanpendleton" created="Tue, 19 Sep 2006 23:13:59 +0100"  >&lt;p&gt;Hi Yip, thanks for the explanation. That makes sense to me. I did not&lt;br/&gt;
know about this behavior of IJ before, so I am glad to learn about it.&lt;/p&gt;

&lt;p&gt;With your latest patch, things are just as I expected: without the code change,&lt;br/&gt;
the test fails in the expected way, and with the code change the test passes.&lt;/p&gt;

&lt;p&gt;Do you feel like this change is now ready for commit? Unless anybody else&lt;br/&gt;
is intending to review it, I can commit it tonight.&lt;/p&gt;</comment>
                            <comment id="12436049" author="yipng" created="Wed, 20 Sep 2006 00:01:20 +0100"  >&lt;p&gt;I think it is ready for commit.  Thanks Bryan.&lt;/p&gt;</comment>
                            <comment id="12436083" author="bryanpendleton" created="Wed, 20 Sep 2006 02:32:02 +0100"  >&lt;p&gt;Spot testing with the latest patch went well, and my derbyall results were clean.&lt;/p&gt;

&lt;p&gt;Committed the &quot;version 2&quot; patch to subversion as revision 448026.&lt;/p&gt;</comment>
                            <comment id="12454746" author="kartha" created="Thu, 30 Nov 2006 20:29:14 +0000"  >&lt;p&gt;Adding 10.2.1.6 as fixed version. From the SVN commits the fix was ported to 10.2 with revision #449004 hence should have made the  10.2.1.6 (Oct 02, 2006 / SVN 452058)&lt;/p&gt;</comment>
                            <comment id="12530593" author="kmarsden" created="Thu, 27 Sep 2007 00:31:45 +0100"  >&lt;p&gt;Reopen to backport to 10.1&lt;/p&gt;</comment>
                            <comment id="12530758" author="kmarsden" created="Thu, 27 Sep 2007 16:43:25 +0100"  >&lt;p&gt;backported fix to 10.1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12341146" name="derby1304-trunk-diff01.txt" size="4048" author="yipng" created="Tue, 19 Sep 2006 20:12:35 +0100"/>
                            <attachment id="12341154" name="derby1304-trunk-diff02.txt" size="4049" author="yipng" created="Tue, 19 Sep 2006 22:55:36 +0100"/>
                            <attachment id="12341145" name="derby1304-trunk-stat01.txt" size="324" author="yipng" created="Tue, 19 Sep 2006 20:12:35 +0100"/>
                            <attachment id="12341153" name="derby1304-trunk-stat02.txt" size="324" author="yipng" created="Tue, 19 Sep 2006 22:55:36 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 9 May 2006 02:47:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22423</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy112f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39823</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>