<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:35:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5213/DERBY-5213.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5213] Write tests to verify the interaction of TRUNCATE TABLE and online backup</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5213</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;An uncommitted TRUNCATE TABLE command does not block online backup. We should verify that the online and backed up databases are both in a consistent state. At a minimum, we should test the following:&lt;/p&gt;

&lt;p&gt;o uncommitted truncate table followed by online backup and then access the backup copy and access the table.  should see the old data.&lt;br/&gt;
o uncommitred truncate table, followed by online backup that keeps logs,&lt;br/&gt;
  then commit the truncate, and then access the table in the backup.&lt;/p&gt;

&lt;p&gt;For more information, please see this email thread: &lt;a href=&quot;http://old.nabble.com/truncating-a-table-vs-online-backup-to31524933.html#a31524933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://old.nabble.com/truncating-a-table-vs-online-backup-to31524933.html#a31524933&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12506054">DERBY-5213</key>
            <summary>Write tests to verify the interaction of TRUNCATE TABLE and online backup</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 May 2011 13:36:40 +0100</created>
                <updated>Fri, 14 Jun 2013 18:26:26 +0100</updated>
                            <resolved>Thu, 13 Sep 2012 00:06:08 +0100</resolved>
                                    <version>10.9.1.0</version>
                                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>SQL</component>
                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13440395" author="myrna" created="Thu, 23 Aug 2012 16:47:15 +0100"  >&lt;p&gt;I&apos;m going to make a stab at writing a test for this.&lt;/p&gt;</comment>
                            <comment id="13443711" author="myrna" created="Wed, 29 Aug 2012 02:05:20 +0100"  >&lt;p&gt;Attaching a patch which does mostly precisely what was suggested in the email exchange, and this patch is ready for review.&lt;/p&gt;

&lt;p&gt;I think there are some further tests that can be added, for instance, there&apos;s some discussion in the reference guide about using blocking or not blocking behavior of SYSCS_BACKUP_DATABASE_AND_ENABLE_LOG_ARCHIVE and SYSCS_BACKUP_DATABASE_AND_ENABLE_LOG_ARCHIVE_NOWAIT. &lt;/p&gt;

&lt;p&gt;Perhaps also a test that tries to do a rollback of the truncate table.&lt;/p&gt;
</comment>
                            <comment id="13443714" author="myrna" created="Wed, 29 Aug 2012 02:07:12 +0100"  >&lt;p&gt;oops, just realized I forgot to undo the changes to lang._Suite in my initial patch for this - I commented out a bunch of tests for a mini-trial run.&lt;br/&gt;
That&apos;s of course not intended for commit.&lt;/p&gt;</comment>
                            <comment id="13444450" author="myrna" created="Wed, 29 Aug 2012 22:50:11 +0100"  >&lt;p&gt;I could use a review of this preliminary patch.&lt;/p&gt;</comment>
                            <comment id="13445102" author="rhillegas" created="Thu, 30 Aug 2012 18:03:36 +0100"  >&lt;p&gt;Hi Myrna,&lt;/p&gt;

&lt;p&gt;It looks to me as though the test tackles both cases described on this JIRA. I&apos;m a little confused by the queries which are supposed to check that the table has 1000 rows and 0 rows. It seems to me that the queries are only looking at the last 2 rows in the table and are not really verifying what they claim to. Maybe &quot;select count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; from truncable&quot; would be a better query. Thanks.&lt;/p&gt;</comment>
                            <comment id="13445114" author="mikem" created="Thu, 30 Aug 2012 18:18:11 +0100"  >&lt;p&gt;the tests in the preliminary patch look good.  This is just from a reading of the code, did not compile/run it.&lt;/p&gt;

&lt;p&gt;Some nits:&lt;br/&gt;
o would be nice to have hdr comment on testUncommittedTruncateBackupEnableLog&lt;br/&gt;
o assertDirectoryDeleted() seems like something that should be in a test utility that could be&lt;br/&gt;
   used in all tests rather than specific tests.&lt;/p&gt;

&lt;p&gt;stuff that should not hold up a commit:&lt;br/&gt;
o An interesting test would be to have truncate table happen &quot;during the backup&quot;.  This is a lot harder to write as timing is very&lt;br/&gt;
   critical.  Spent some time thinking about this but could not come up with a user level code way to test this for sure.  Could &lt;br/&gt;
   hack the actual code to help testing but that is not a great idea.  &lt;br/&gt;
o could add tests of freeze and unfreeze with respect to truncate.&lt;/p&gt;</comment>
                            <comment id="13445461" author="myrna" created="Fri, 31 Aug 2012 00:53:15 +0100"  >&lt;p&gt;Thank you for the reviews Rick and Mike.&lt;/p&gt;

&lt;p&gt;Rick - you are right of course. For some reason I just didn&apos;t want to do a select count, but it&apos;s the more logical query, so I changed it.&lt;br/&gt;
Mike - I added a comment describing the second fixture, and there was already an assertDirectoryDeleted in org.apache.derbyTesting.junit.BaseTestCase, so I removed the local method.&lt;/p&gt;

&lt;p&gt;I&apos;m running regressions now, and assuming they go well, I will commit this patch; then I&apos;ll start working on the other testing suggestions.&lt;/p&gt;
</comment>
                            <comment id="13448063" author="myrna" created="Tue, 4 Sep 2012 22:11:58 +0100"  >&lt;p&gt;regression tests went fine, so I committed the _2.diff patch with revision 1380779 (&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1380779&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1380779&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="13450620" author="knutanders" created="Fri, 7 Sep 2012 14:45:29 +0100"  >&lt;p&gt;There were some failures in the nightly tests after the new test went in:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/vista-64/1381230-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/vista-64/1381230-suitesAll_diff.txt&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/sol/1381654-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/sol/1381654-suitesAll_diff.txt&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/javaME/testing/testlog/ubuntu/1381230-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/javaME/testing/testlog/ubuntu/1381230-suitesAll_diff.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13450867" author="myrna" created="Fri, 7 Sep 2012 19:33:46 +0100"  >&lt;p&gt;Thanks for noticing those failures Knut. &lt;br/&gt;
I&apos;ll take a look at it on Monday. I&apos;ve disabled the test (commented out in lang._Suite) for now with revision: &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1382114&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1382114&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13453559" author="myrna" created="Wed, 12 Sep 2012 00:46:06 +0100"  >&lt;p&gt;I&apos;ve taken a quick look, and it seems to me the problem was that the sequence of the tests &lt;b&gt;was&lt;/b&gt; important - one of the tests did a truncate table and committed it.&lt;br/&gt;
As that wasn&apos;t my intention, I&apos;ve removed the decorateSQL and put the relevant code into the setUp() and dropped the table in a teardown() method.&lt;/p&gt;</comment>
                            <comment id="13453560" author="myrna" created="Wed, 12 Sep 2012 00:48:40 +0100"  >&lt;p&gt;Attaching a patch which&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;adds a third fixture, which tests an uncommitted truncate table followed by freeze/copy/unfreeze&lt;/li&gt;
	&lt;li&gt;removes the decorateSQL method and moves the creation and population of the truncable table to setUp(), and drops the table in teardown()&lt;/li&gt;
	&lt;li&gt;reinstates the test in lang._Suite&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I will commit this shortly.&lt;/p&gt;</comment>
                            <comment id="13454464" author="myrna" created="Thu, 13 Sep 2012 00:06:08 +0100"  >&lt;p&gt;Committed with revision &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1383677&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1383677&lt;/a&gt;.&lt;br/&gt;
Looks like tests have passed ok. Resolving.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12543202" name="DERBY-5213.diff_2" size="11234" author="myrna" created="Fri, 31 Aug 2012 00:53:15 +0100"/>
                            <attachment id="12544735" name="DERBY-5213.diff_3" size="7805" author="myrna" created="Wed, 12 Sep 2012 00:48:40 +0100"/>
                            <attachment id="12542875" name="DERBY_5213.diff_1" size="15123" author="myrna" created="Wed, 29 Aug 2012 02:05:20 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 23 Aug 2012 15:47:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31551</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0a2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35450</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>