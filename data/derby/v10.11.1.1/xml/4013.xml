<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:51:54 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4013/DERBY-4013.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4013] Allow standard SQL syntax: ALTER TABLE ALTER [COLUMN] &lt;col&gt; SET DEFAULT &lt;default&gt;</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4013</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Presently, the Derby syntax is ALTER TABLE ALTER &lt;span class=&quot;error&quot;&gt;&amp;#91;COLUMN&amp;#93;&lt;/span&gt; &amp;lt;col&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;WITH&amp;#93;&lt;/span&gt; DEFAULT &amp;lt;default&amp;gt;.&lt;br/&gt;
The &quot;SET&quot; keyword is not accepted, only an optional &quot;WITH&quot;. It would be good to accept the standard syntax here as well.&lt;br/&gt;
Cf. SQL 2003, section 11.12 &amp;lt;alter column definition&amp;gt; and section 11.13 &amp;lt;set column default clause&amp;gt;.&lt;/p&gt;

&lt;p&gt;Also, DROP DEFAULT is standard syntax not supported, so we should add that, too.&lt;/p&gt;

&lt;p&gt;Repro on trunk:&lt;/p&gt;

&lt;p&gt;$ java org.apache.derby.tools.ij&lt;br/&gt;
ij version 10.5&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:wombat;create=true&apos;;&lt;br/&gt;
ij&amp;gt; create table t(i int default 0, j int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; alter table t alter column j with default 1;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t values (default, default);&lt;br/&gt;
1 row inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select * from t;&lt;br/&gt;
I          |J          &lt;br/&gt;
-----------------------&lt;br/&gt;
0          |1          &lt;/p&gt;

&lt;p&gt;1 row selected&lt;br/&gt;
ij&amp;gt; alter table t alter column j default 2;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t values (default, default);&lt;br/&gt;
1 row inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select * from t;&lt;br/&gt;
I          |J          &lt;br/&gt;
-----------------------&lt;br/&gt;
0          |1          &lt;br/&gt;
0          |2          &lt;/p&gt;

&lt;p&gt;2 rows selected&lt;br/&gt;
ij&amp;gt; alter table t alter column j set default 3;&lt;br/&gt;
ERROR 42X01: Syntax error: Encountered &quot;set&quot; at line 1, column 30.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12412070">DERBY-4013</key>
            <summary>Allow standard SQL syntax: ALTER TABLE ALTER [COLUMN] &lt;col&gt; SET DEFAULT &lt;default&gt;</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Jan 2009 18:31:20 +0000</created>
                <updated>Thu, 2 May 2013 03:29:19 +0100</updated>
                            <resolved>Mon, 26 Jan 2009 18:29:14 +0000</resolved>
                                    <version>10.0.2.0</version>
                    <version>10.0.2.1</version>
                    <version>10.1.1.0</version>
                    <version>10.1.2.1</version>
                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                    <version>10.3.2.1</version>
                    <version>10.3.3.0</version>
                    <version>10.4.1.3</version>
                    <version>10.4.2.0</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12662504" author="dagw" created="Fri, 9 Jan 2009 20:11:30 +0000"  >&lt;p&gt;Uploading a small patch for this with new test cases for the syntax variations. I did not find a natural place for them, so I started a new test class, AlterColumnTest.&lt;/p&gt;</comment>
                            <comment id="12662558" author="knutanders" created="Fri, 9 Jan 2009 23:37:42 +0000"  >&lt;p&gt;I haven&apos;t tested the patch, only taken a brief look at it, but it looks correct to me. Why do you think it needs a release note?&lt;/p&gt;

&lt;p&gt;Minor nits:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;javadoc for the test class describes another test (&quot;compressing tables&quot; it says)&lt;/li&gt;
	&lt;li&gt;javadoc to explain tryAndExpect()&apos;s parameters might be helpful&lt;/li&gt;
	&lt;li&gt;tryAndExpect() reinvents JDBC.assertSingleValueResultSet()&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12662589" author="dagw" created="Sat, 10 Jan 2009 01:04:13 +0000"  >&lt;p&gt;Thanks for looking at this, Knut! Since this isssue is not a bug and too small to merit a feature write-up,&lt;br/&gt;
I figured it would be best to mark it as requiring a note in the release notes (although it is upwards compatible).&lt;br/&gt;
What do you think? &lt;/p&gt;

&lt;p&gt;Ill respin the patch to fix your nits.&lt;/p&gt;</comment>
                            <comment id="12662807" author="knutanders" created="Sun, 11 Jan 2009 18:45:44 +0000"  >&lt;p&gt;Even though it&apos;s a small feature, I think it makes more sense to list it under new features than under potential incompatibilities. The Release Note Needed flag is used for issues that require special attention, and adding this issue to that list will take attention away from the issues that really require special attention. Since there&apos;s no incompatibility, I&apos;d suggest that you just add it under Features at the 10.5.1 release wiki: &lt;a href=&quot;http://wiki.apache.org/db-derby/DerbyTenFiveOneRelease&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/DerbyTenFiveOneRelease&lt;/a&gt; (I think that&apos;s where the release manager takes the New Features list from when compiling the final release notes, but I may be mistaken.)&lt;/p&gt;</comment>
                            <comment id="12662972" author="chaase3" created="Mon, 12 Jan 2009 15:17:03 +0000"  >&lt;p&gt;Should we have an associated documentation issue to update the syntax in the ALTER TABLE topic of the Reference Manual? I can file one, or you can.&lt;/p&gt;</comment>
                            <comment id="12662978" author="dagw" created="Mon, 12 Jan 2009 15:52:18 +0000"  >&lt;p&gt;Yes, we should definitely change the docs too! Feel free to file an issue for it!&lt;/p&gt;</comment>
                            <comment id="12662987" author="dagw" created="Mon, 12 Jan 2009 16:23:46 +0000"  >&lt;p&gt;Uploading a new version of this patch, derby-4013b, which addresses Knut&apos;s nits.&lt;br/&gt;
Regressions were run on the previous version with no errors.&lt;/p&gt;</comment>
                            <comment id="12662991" author="dagw" created="Mon, 12 Jan 2009 16:30:54 +0000"  >&lt;p&gt;I will remove the release note flag, and add an entry to&lt;br/&gt;
DerbyTenFiveOneRelease, then.  &lt;/p&gt;

&lt;p&gt;It seems the semantics of this flag &quot;Release Note Needed&quot; is now&lt;br/&gt;
effectively: &quot;Release note attached (based on&lt;br/&gt;
/tools/release/templates/releaseNote.html), because this issue&lt;br/&gt;
potentially breaks existing applications&quot;. In other cases, we should&lt;br/&gt;
either enter an entry to the upcoming release page, and/or rely on the&lt;br/&gt;
release manager to find issues marked &quot;Improvement&quot; or &quot;New features&quot;&lt;br/&gt;
so something can be said about them in the release notes.&lt;/p&gt;</comment>
                            <comment id="12663274" author="knutanders" created="Tue, 13 Jan 2009 09:20:54 +0000"  >&lt;p&gt;Thanks, Dag. The 4013b patch looks good to me. I tested a couple of queries in ij, and it seems to work fine. +1 to commit.&lt;/p&gt;</comment>
                            <comment id="12664650" author="dagw" created="Fri, 16 Jan 2009 19:49:59 +0000"  >&lt;p&gt;Uploading patch derby-4013c, which also introduced the standard syntax&lt;br/&gt;
for ALTER &lt;span class=&quot;error&quot;&gt;&amp;#91;COLUMN&amp;#93;&lt;/span&gt; &amp;lt;column-name&amp;gt; DROP DEFAULT which is also not supported&lt;br/&gt;
presently (thank to Kim for discovering that) and added tests for&lt;br/&gt;
that.&lt;/p&gt;

&lt;p&gt;Re-running regressions.&lt;/p&gt;</comment>
                            <comment id="12665123" author="knutanders" created="Mon, 19 Jan 2009 13:38:27 +0000"  >&lt;p&gt;SQL 2003, 11.14 &amp;lt;drop column default clause&amp;gt; says the following in Syntax Rules:&lt;br/&gt;
&amp;gt; 2) The descriptor of C shall include a default value.&lt;/p&gt;

&lt;p&gt;And in General Rules:&lt;br/&gt;
&amp;gt; 1) The default value is removed from the column descriptor of C.&lt;/p&gt;

&lt;p&gt;Does this imply that if you drop the default value for the same column twice, the second one should fail because C has no default value? And similarly, if you try to drop the default on an identity column, it should fail, whereas the current patch will make it an ordinary (non-identity) column with default NULL?&lt;/p&gt;</comment>
                            <comment id="12665143" author="knutanders" created="Mon, 19 Jan 2009 16:11:19 +0000"  >&lt;p&gt;I tested DROP DEFAULT on PostgreSQL, and it appears to behave the same way as Derby would with the latest patch. DROP DEFAULT sets the default to NULL, and it can also be used to set the default of an identity column to NULL. Dropping the default twice does not raise an error.&lt;/p&gt;</comment>
                            <comment id="12665153" author="dagw" created="Mon, 19 Jan 2009 17:15:58 +0000"  >&lt;p&gt;Thanks for checking the standard on the semantics here, Knut. Derby&lt;br/&gt;
does treat no default the same as a default of null, I find.&lt;/p&gt;

&lt;p&gt;If this is strictly according to the standard, I am not sure.  At&lt;br/&gt;
least, if there is no defined default, the null value should be used,&lt;br/&gt;
according to section 11.5 default clause, General Rule 3 e):&lt;br/&gt;
&quot;Otherwise, S is set to the null value.&quot;&lt;/p&gt;

&lt;p&gt;The way I read it, this is not technically a default, but rather the&lt;br/&gt;
null is used in lieu of a defined default. By that reasoning, the DROP&lt;br/&gt;
default should probably have failed if there is no defined default on&lt;br/&gt;
that column. Up to now, Derby makes no such distinction, since setting&lt;br/&gt;
a default back to &quot;null&quot; is the only way to get rid of another defined&lt;br/&gt;
default &lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;But I suggest we be lenient here, as is Postgres in your experiment,&lt;br/&gt;
and let DROP DEFAULT be a no-op if there is no default defined for a&lt;br/&gt;
column, otherwise we would have to start distinguishing between an&lt;br/&gt;
explicitly created &quot;null&quot; default (whose dropping would be legal) and&lt;br/&gt;
an implicit null default (by rule 3e above, in which case dropping the&lt;br/&gt;
default would be an error).&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt;&lt;br/&gt;
This can be seen by first making an explicit non-null default, and&lt;br/&gt;
then changing its value to null:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; alter table t alter i DEFAULT 1;&lt;br/&gt;
ij&amp;gt; select columndefault, columndefaultid from sys.syscolumns where columnname=&apos;I&apos;;&lt;br/&gt;
COLUMNDEFAULT  |COLUMNDEFAULTID                     &lt;br/&gt;
----------------------------------------------------&lt;br/&gt;
1              |286cc01e-011e-efd9-cb02-000003ffe058&lt;/p&gt;

&lt;p&gt;ij&amp;gt; alter table t alter i DEFAULT null;&lt;br/&gt;
ij&amp;gt; select columndefault, columndefaultid from sys.syscolumns where columnname=&apos;I&apos;;&lt;br/&gt;
COLUMNDEFAULT  |COLUMNDEFAULTID                     &lt;br/&gt;
----------------------------------------------------&lt;br/&gt;
NULL           |NULL      &lt;/p&gt;

&lt;p&gt;There no longer a UUID identifying to a defined default (i.e. it has been dropped).&lt;/p&gt;</comment>
                            <comment id="12665154" author="dagw" created="Mon, 19 Jan 2009 17:16:53 +0000"  >&lt;p&gt;Regressions ran ok.&lt;/p&gt;</comment>
                            <comment id="12665368" author="knutanders" created="Tue, 20 Jan 2009 09:04:42 +0000"  >&lt;p&gt;I&apos;m fine with the suggested approach. If someone thinks it&apos;s important that we distinguish between the no default case and the NULL default case, that could be fixed later, but for now this looks like a fine incremental improvement to me.&lt;/p&gt;

&lt;p&gt;Two tiny nits:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;there&apos;s a pure whitespace diff right above dropTableConstraintDefinition() in sqlgrammar.jj&lt;/li&gt;
	&lt;li&gt;the javadoc comment for wrapAlterColumnDefaultValue() just says &quot;Minion&quot;, which is not very descriptive (but it&apos;s great that this common code was factored out!)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12666303" author="kmarsden" created="Thu, 22 Jan 2009 21:31:35 +0000"  >&lt;p&gt;I see the test was added to the suite:&lt;br/&gt;
+        suite.addTest(AlterColumnTest.suite());&lt;/p&gt;

&lt;p&gt;But I don&apos;t see AlterColumnTest as part of the patch.  Did you maybe not svn add or am I just missing it?&lt;/p&gt;

&lt;p&gt;Thanks &lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12666320" author="dagw" created="Thu, 22 Jan 2009 22:25:44 +0000"  >&lt;p&gt;Sorry about that, Kathey, the last rev. lacked the new test. Uploading it again.&lt;/p&gt;</comment>
                            <comment id="12667319" author="dagw" created="Mon, 26 Jan 2009 17:39:20 +0000"  >&lt;p&gt;Uploaded derby-4013d, which fixes Knut&apos;s nits.&lt;/p&gt;</comment>
                            <comment id="12667343" author="dagw" created="Mon, 26 Jan 2009 18:29:14 +0000"  >&lt;p&gt;Resolving, committed patch derby-4013d as svn 737774.&lt;br/&gt;
If nobody argues that this should be backported, I will close the issue in a bit.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12412206">DERBY-4016</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12397556" name="derby-4013.diff" size="5293" author="dagw" created="Fri, 9 Jan 2009 20:11:30 +0000"/>
                            <attachment id="12397557" name="derby-4013.stat" size="238" author="dagw" created="Fri, 9 Jan 2009 20:11:30 +0000"/>
                            <attachment id="12397697" name="derby-4013b.diff" size="5657" author="dagw" created="Mon, 12 Jan 2009 16:23:46 +0000"/>
                            <attachment id="12397698" name="derby-4013b.stat" size="238" author="dagw" created="Mon, 12 Jan 2009 16:23:46 +0000"/>
                            <attachment id="12398513" name="derby-4013c.diff" size="7675" author="dagw" created="Thu, 22 Jan 2009 22:25:44 +0000"/>
                            <attachment id="12398514" name="derby-4013c.stat" size="238" author="dagw" created="Thu, 22 Jan 2009 22:25:44 +0000"/>
                            <attachment id="12398745" name="derby-4013d.diff" size="7927" author="dagw" created="Mon, 26 Jan 2009 17:39:20 +0000"/>
                            <attachment id="12398746" name="derby-4013d.stat" size="238" author="dagw" created="Mon, 26 Jan 2009 17:39:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 9 Jan 2009 23:37:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31101</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0qd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38089</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>