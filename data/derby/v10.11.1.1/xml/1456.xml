<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:26:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1456/DERBY-1456.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1456] Network Server agentError calls log only to console and are hard to diagnose</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1456</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The Network Server code uses an assertion-check utility routine called agentError()&lt;br/&gt;
under certain circumstances. When these agentError() calls arise, for example as&lt;br/&gt;
in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1454&quot; title=&quot;DRDA Protocol Exception when DSS is exactly 32767 in length&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1454&quot;&gt;&lt;del&gt;DERBY-1454&lt;/del&gt;&lt;/a&gt;, there is no server side logging of the error except to the console. &lt;/p&gt;

&lt;p&gt;The user application  that hit &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1454&quot; title=&quot;DRDA Protocol Exception when DSS is exactly 32767 in length&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1454&quot;&gt;&lt;del&gt;DERBY-1454&lt;/del&gt;&lt;/a&gt; had not been capturing console output and there &lt;br/&gt;
was no clue in the derby.log, this made the problem hard to track down when they &lt;br/&gt;
suddenly hit this boundary deep within their stress tests.&lt;/p&gt;

&lt;p&gt;See also &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-743&quot; title=&quot;DRDA agentError messages need to be localizable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-743&quot;&gt;DERBY-743&lt;/a&gt; for another issue with Network Server&apos;s agentError routine.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12344908">DERBY-1456</key>
            <summary>Network Server agentError calls log only to console and are hard to diagnose</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12329163">DERBY-1011</parent>
                                    <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="skambha">Sunitha Kambhampati</assignee>
                                    <reporter username="bryanpendleton">Bryan Pendleton</reporter>
                        <labels>
                    </labels>
                <created>Sun, 25 Jun 2006 08:10:02 +0100</created>
                <updated>Thu, 13 Dec 2007 09:05:00 +0000</updated>
                            <resolved>Thu, 10 Aug 2006 23:48:21 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.3.2</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12423713" author="skambha" created="Wed, 26 Jul 2006 21:41:11 +0100"  >&lt;p&gt;I am attaching a patch &apos;derby1456.diff.txt&apos; and the stat file &apos;derby1456.stat.txt&apos; .&lt;/p&gt;

&lt;p&gt;For notes about this issue, please see the attached derby1456_notes.txt.&lt;/p&gt;

&lt;p&gt;This patch does the following:&lt;br/&gt;
1. Use the correct errorCodePoint for agent errors. CodePoint.AGNPRMRM. Agent errors will be logged ok.&lt;br/&gt;
2. In agent errors, retrieve the descriptive string passed in as argument.&lt;br/&gt;
3. override Exception.getMessage() , so call to DRDAProtocolException.getMessage() will return the diagnostic message.&lt;/p&gt;

&lt;p&gt;This is a network server only change. The server tests (derbynetclientmats and derbynetmats) ran ok on ibm142/linux. &lt;/p&gt;

&lt;p&gt;Can someone please review this patch. &lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Sunitha. &lt;/p&gt;</comment>
                            <comment id="12424960" author="kmarsden" created="Tue, 1 Aug 2006 19:08:20 +0100"  >&lt;p&gt;Sunitha,  I have not had time to look at this patch, but wonder: will the errors get logged to derby.log?&lt;/p&gt;</comment>
                            <comment id="12424966" author="skambha" created="Tue, 1 Aug 2006 19:15:48 +0100"  >&lt;p&gt;Yes. The errors will get logged to derby.log. &lt;/p&gt;</comment>
                            <comment id="12425077" author="bryanpendleton" created="Wed, 2 Aug 2006 02:11:48 +0100"  >&lt;p&gt;Hi Sunitha, thanks for picking up this problem. I read through your very clear&lt;br/&gt;
notes and through the diff and they make sense to me; this feels like a good solution.&lt;/p&gt;

&lt;p&gt;I would be glad to do a bit more review of this over the next few days and commit the change.&lt;/p&gt;</comment>
                            <comment id="12425251" author="bryanpendleton" created="Wed, 2 Aug 2006 15:53:23 +0100"  >&lt;p&gt;Using the technique suggested by Sunitha in the notes, which involves temporarily backing out the fix to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1454&quot; title=&quot;DRDA Protocol Exception when DSS is exactly 32767 in length&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1454&quot;&gt;&lt;del&gt;DERBY-1454&lt;/del&gt;&lt;/a&gt; and then running the repro code from that bug, I was able to confirm Sunitha&apos;s results and verify that the change works for me as well. The exception that is returned to the user is vastly more useful, and proper exception information is logged to derby.log.&lt;/p&gt;

&lt;p&gt;derbyall run was clean for me as well (modulo strange TransactionTable diff which others are also seeing).&lt;/p&gt;

&lt;p&gt;Committed the patch to subversion as revision 428012.&lt;/p&gt;

&lt;p&gt;Thank you very much for fixing this problem, Sunitha. Can you please close the issue at your convenience?&lt;/p&gt;</comment>
                            <comment id="12425293" author="skambha" created="Wed, 2 Aug 2006 17:55:41 +0100"  >&lt;p&gt;Thanks very much Bryan for the review and commit of this fix.  I ran some tests and have verified it as complete. So closing this issue. &lt;/p&gt;</comment>
                            <comment id="12427245" author="kmarsden" created="Thu, 10 Aug 2006 15:56:14 +0100"  >&lt;p&gt;I am merging this change to 10.1&lt;/p&gt;

&lt;p&gt;To verify reverse merged  the code change for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1454&quot; title=&quot;DRDA Protocol Exception when DSS is exactly 32767 in length&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1454&quot;&gt;&lt;del&gt;DERBY-1454&lt;/del&gt;&lt;/a&gt; and ran the new derbynet/prepStmt.java test: e.g.&lt;/p&gt;

&lt;p&gt;svn merge -r 417032:417031 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/branches/10.1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/branches/10.1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;svn revert `svnls | grep prepStmt`&lt;/p&gt;

&lt;p&gt;where svnls is&lt;br/&gt;
svn stat -q | sed -e &apos;s/\\/\//g&apos; |  sed -e &apos;s/. [ +]*//&apos; | grep -v &apos;external ite&lt;br/&gt;
m&apos;&lt;/p&gt;

&lt;p&gt;ran derbyNet/prepStmt.java&lt;/p&gt;

&lt;p&gt;And wow what a difference! &lt;/p&gt;


&lt;p&gt;What I saw was this in the derby.log&lt;/p&gt;

&lt;p&gt;org.apache.derby.impl.drda.DRDAProtocolException: Execution failed because of Permanent Agent Error: SVRCOD = 40; RDBNAM = wombat;create=true; diagnostic msg = LMTBLKPRC violation: splitQRYDTA was called to split a QRYDTA block, but the entire row fit successfully into the current block. Server rowsize computation was probably incorrect (perhaps an off-by-one bug?). QRYDTA blocksize: 32767&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.drda.DRDAProtocolException.newAgentError(DRDAProtocolException.java:328)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.drda.DRDAConnThread.agentError(DRDAConnThread.java:429)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.drda.DRDAConnThread.splitQRYDTA(DRDAConnThread.java:6240)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.drda.DRDAConnThread.writeFDODTA(DRDAConnThread.java:6173)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.drda.DRDAConnThread.writeQRYDTA(DRDAConnThread.java:5926)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:592)&lt;/p&gt;

&lt;p&gt;	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:223)&lt;/p&gt;

&lt;p&gt;2006-08-10 14:44:11.257 GMT Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;DRDAConnThread_2,5,main&amp;#93;&lt;/span&gt; (XID = 1121), (SESS&lt;/p&gt;



&lt;p&gt;and the client gets the perfectly reasonable:&lt;/p&gt;

&lt;p&gt;org.apache.derby.client.am.DisconnectException: Execution failed due to a distribution protocol err&lt;br/&gt;
or that caused deallocation of the conversation.  A PROTOCOL Data Stream Syntax Error was detected.&lt;br/&gt;
  Reason: 0x3&lt;br/&gt;
        at org.apache.derby.client.net.Reply.doSyntaxrmSemantics(Reply.java:950)&lt;br/&gt;
        at org.apache.derby.client.net.Reply.readDssHeader(Reply.java:345)&lt;br/&gt;
        at org.apache.derby.client.net.Reply.peekCodePoint(Reply.java:1009)&lt;br/&gt;
        at org.apache.derby.client.net.NetResultSetReply.parseCNTQRYreply(NetResultSetReply.java:12&lt;br/&gt;
9)&lt;br/&gt;
        at org.apache.derby.client.net.NetResultSetReply.readFetch(NetResultSetReply.java:38)&lt;br/&gt;
        at org.apache.derby.client.net.ResultSetReply.readFetch(ResultSetReply.java:40)&lt;br/&gt;
        at org.apache.derby.client.net.NetResultSet.readFetch_(NetResultSet.java:181)&lt;br/&gt;
        at org.apache.derby.client.am.ResultSet.flowFetch(ResultSet.java:2930)&lt;br/&gt;
        at org.apache.derby.client.net.NetCursor.getMoreData_(NetCursor.java:927)&lt;br/&gt;
        at org.apache.derby.client.am.Cursor.next(Cursor.java:155)&lt;br/&gt;
        at org.apache.derby.client.am.ResultSet.nextX(ResultSet.java:261)&lt;br/&gt;
        at org.apache.derby.client.am.ResultSet.next(ResultSet.java:240)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.derbynet.prepStmt.tickleDSSLength(prepStmt.j&lt;br/&gt;
ava:871)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.derbynet.prepStmt.jira1454Test(prepStmt.java&lt;br/&gt;
:842)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.derbynet.prepStmt.main(prepStmt.java:308)&lt;/p&gt;


&lt;p&gt; I keep thinking back to that case, if this error message had not been mysteriously consumed  in the user environment how easy it all would have been.  Thanks Sunitha for the great fix and also to Bryan for leaving such   incredibly useful breadcrumb trails in the error messages for known problem areas.  So glad we can now see the breadcrumbs.&lt;/p&gt;








</comment>
                            <comment id="12427365" author="kmarsden" created="Thu, 10 Aug 2006 23:48:20 +0100"  >&lt;p&gt;Checked into 10.1&lt;/p&gt;

&lt;p&gt;Date: Thu Aug 10 14:20:52 2006&lt;br/&gt;
New Revision: 430534&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=430534&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?rev=430534&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1456&quot; title=&quot;Network Server agentError calls log only to console and are hard to diagnose&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1456&quot;&gt;&lt;del&gt;DERBY-1456&lt;/del&gt;&lt;/a&gt; Network Server agentError calls log only to console and are hard to diagnose&lt;/p&gt;

&lt;p&gt;merge from trunk (svn 428012)&lt;/p&gt;

&lt;p&gt;Contributed by Sunitha Kambhampati &lt;/p&gt;

&lt;p&gt;I made an error on the bug number on checkin so the10.1  change does not show up in subversion commits for this issue but rather with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-353&quot; title=&quot;It is desirable to have IDENTITY_VAL_LOCAL() function return last recent user specified value or system generated value for BY DEFAULT identity columns.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-353&quot;&gt;&lt;del&gt;DERBY-353&lt;/del&gt;&lt;/a&gt;. I changed it wtih svn propedit but that does not fix Jira apparently.&lt;/p&gt;
</comment>
                            <comment id="12551360" author="fuzzylogic" created="Thu, 13 Dec 2007 09:05:00 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12337593" name="1456_notes.txt" size="5687" author="skambha" created="Wed, 26 Jul 2006 21:41:11 +0100"/>
                            <attachment id="12337591" name="derby1456.diff.txt" size="2680" author="skambha" created="Wed, 26 Jul 2006 21:41:11 +0100"/>
                            <attachment id="12337592" name="derby1456.stat.txt" size="72" author="skambha" created="Wed, 26 Jul 2006 21:41:11 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 26 Jul 2006 20:41:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29999</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy107j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39684</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>