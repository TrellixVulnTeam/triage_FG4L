<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:36:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1266/DERBY-1266.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1266] Client: Attempted deleteRow or updateRow while on insert row gives wrong error message</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1266</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;This fragment from deleteRowX shows the problem:&lt;/p&gt;

&lt;p&gt;&amp;gt; if (isOnInsertRow_) &lt;/p&gt;
{
&amp;gt;       throw new SqlException(agent_.logWriter_, 
&amp;gt;           new MessageId(SQLState.CURSOR_NOT_POSITIONED_ON_INSERT_ROW));
&amp;gt; }

&lt;p&gt;It should be the opposite: the problem is that the cursor &lt;b&gt;is&lt;/b&gt; on the&lt;br/&gt;
insert row, not that it isn&apos;t.&lt;/p&gt;

&lt;p&gt;These is a similar error in updateRowX.&lt;/p&gt;

&lt;p&gt;The client master files for updatableResultSet show the problem, so&lt;br/&gt;
the masters are wrong, too.&lt;/p&gt;

&lt;p&gt;&amp;gt; Negative Test 39.a - run updateRow on insertRow&lt;br/&gt;
&amp;gt; SQL State: XJ086&lt;br/&gt;
&amp;gt; Got expected exception: This method cannot be invoked while the&lt;br/&gt;
  cursor is not on the insert row or if the concurrency of this &lt;br/&gt;
  ResultSet object is CONCUR_READ_ONLY. &lt;/p&gt;</description>
                <environment>any</environment>
        <key id="12332847">DERBY-1266</key>
            <summary>Client: Attempted deleteRow or updateRow while on insert row gives wrong error message</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davidvc">David Van Couvering</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Sat, 29 Apr 2006 00:35:07 +0100</created>
                <updated>Fri, 19 May 2006 09:37:35 +0100</updated>
                            <resolved>Tue, 9 May 2006 06:39:09 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12377613" author="davidvc" created="Thu, 4 May 2006 03:14:47 +0100"  >&lt;p&gt;Hi, Dag.  There is an existing message&lt;/p&gt;

&lt;p&gt;&quot;XJ120.S=This method cannot be invoked while the cursor is on the insert row, if the cursor is not on a valid row, or if this ResultSet object has a concurrency of CONCUR_READ_ONLY.&quot;&lt;/p&gt;

&lt;p&gt;I don&apos;t know if this can be used in this instance or not.  I can alternately add a new message&lt;/p&gt;

&lt;p&gt;&quot;This method cannot be invoked while the cursor is on the insert row.&quot;&lt;/p&gt;

&lt;p&gt;Please let me know which you would prefer.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;David&lt;/p&gt;</comment>
                            <comment id="12377779" author="dagw" created="Thu, 4 May 2006 20:15:09 +0100"  >&lt;p&gt;David&amp;gt; &quot;XJ120.S=This method cannot be invoked while the cursor is on&lt;br/&gt;
David&amp;gt; the insert row, if the cursor is not on a valid row, or if this&lt;br/&gt;
David&amp;gt; ResultSet object has a concurrency of CONCUR_READ_ONLY.&quot;&lt;/p&gt;

&lt;p&gt;I checked the &lt;b&gt;embedded&lt;/b&gt; client: its method&lt;br/&gt;
EmbedResultSet#checkNotOnInsertRow is called from&lt;/p&gt;

&lt;p&gt;    deleteRow,&lt;br/&gt;
    updateRow and &lt;br/&gt;
    cancelRowUpdates (I forgot to mention that this method has the&lt;br/&gt;
                      same issue as well) &lt;/p&gt;

&lt;p&gt;In the embedded client, checkNotOnInsertRow gives&lt;br/&gt;
SQLState.NO_CURRENT_ROW (24000), whose wording in English is &quot;Invalid&lt;br/&gt;
cursor state - no current row.&quot;.&lt;/p&gt;

&lt;p&gt;That&apos;s not very precise, but shouldn&apos;t we strive to keep the clients in&lt;br/&gt;
synch?  I guess I would prefer to use the same state for both clients...&lt;/p&gt;

&lt;p&gt;I notice XJ120 which you mention is only ever used as a catch-all for&lt;br/&gt;
checks in the client&apos;s refreshRowX method, which currently does&lt;br/&gt;
nothing for the result sets we implement.. But it does employ XJ120&lt;br/&gt;
(CURSOR_CANNOT_INVOKE_ON_INSROW_OR_INVALIDROW_OR_READONLY).&lt;/p&gt;

&lt;p&gt;I think the checking in refreshRow should be split: If position is on&lt;br/&gt;
insertRow, we should throw same message as elsewhere in client (and&lt;br/&gt;
same as embedded); if one of the other error conditions is hit, you&lt;br/&gt;
could throw XJ120, but simplify its name and wording to invalid row,&lt;br/&gt;
which seems to be what&apos;s left of it (position is before first or after&lt;br/&gt;
last). Updatability is now is checked by the preceding test (call to&lt;br/&gt;
checkForUpdatableResultSet).  But then again, if invalid position is&lt;br/&gt;
the only condition remaining, I guess we can do away with XJ120&lt;br/&gt;
alltogether... and just use 24000.&lt;/p&gt;

&lt;p&gt;BTW, I notice that embedded throws an exception for refreshRow, it&lt;br/&gt;
seems the client does not....&lt;/p&gt;</comment>
                            <comment id="12377917" author="davidvc" created="Fri, 5 May 2006 07:58:18 +0100"  >&lt;p&gt;Dag says:&lt;/p&gt;

&lt;p&gt;&amp;lt;quote&amp;gt;&lt;br/&gt;
I checked the &lt;b&gt;embedded&lt;/b&gt; client: its method&lt;br/&gt;
EmbedResultSet#checkNotOnInsertRow is called from&lt;/p&gt;

&lt;p&gt;    deleteRow,&lt;br/&gt;
    updateRow and&lt;br/&gt;
    cancelRowUpdates (I forgot to mention that this method has the&lt;br/&gt;
                      same issue as well)&lt;/p&gt;

&lt;p&gt;In the embedded client, checkNotOnInsertRow gives&lt;br/&gt;
SQLState.NO_CURRENT_ROW (24000), whose wording in English is &quot;Invalid&lt;br/&gt;
cursor state - no current row.&quot;.&lt;/p&gt;

&lt;p&gt;That&apos;s not very precise, but shouldn&apos;t we strive to keep the clients in&lt;br/&gt;
synch? I guess I would prefer to use the same state for both clients...&lt;br/&gt;
&amp;lt;/quote&amp;gt;&lt;/p&gt;

&lt;p&gt;I agree.  I&apos;ll change it to use 24000&lt;/p&gt;

&lt;p&gt;Dag says&lt;/p&gt;

&lt;p&gt;&amp;lt;quote&amp;gt;&lt;br/&gt;
 notice XJ120 which you mention is only ever used as a catch-all for&lt;br/&gt;
checks in the client&apos;s refreshRowX method, which currently does&lt;br/&gt;
nothing for the result sets we implement.. But it does employ XJ120&lt;br/&gt;
(CURSOR_CANNOT_INVOKE_ON_INSROW_OR_INVALIDROW_OR_READONLY).&lt;/p&gt;

&lt;p&gt;I think the checking in refreshRow should be split: If position is on&lt;br/&gt;
insertRow, we should throw same message as elsewhere in client (and&lt;br/&gt;
same as embedded); if one of the other error conditions is hit, you&lt;br/&gt;
could throw XJ120, but simplify its name and wording to invalid row,&lt;br/&gt;
which seems to be what&apos;s left of it (position is before first or after&lt;br/&gt;
last). Updatability is now is checked by the preceding test (call to&lt;br/&gt;
checkForUpdatableResultSet). But then again, if invalid position is&lt;br/&gt;
the only condition remaining, I guess we can do away with XJ120&lt;br/&gt;
alltogether... and just use 24000. &lt;br/&gt;
&amp;lt;/quote&amp;gt;&lt;/p&gt;

&lt;p&gt;Hm.  I&apos;ll look at this.  If it gets a little too hairy, I may delay this for another patch.&lt;/p&gt;

&lt;p&gt;&amp;lt;quote&amp;gt;&lt;br/&gt;
BTW, I notice that embedded throws an exception for refreshRow, it&lt;br/&gt;
seems the client does not....&lt;br/&gt;
&amp;lt;/quote&amp;gt;&lt;/p&gt;

&lt;p&gt;OK, I&apos;ll look at that.&lt;/p&gt;</comment>
                            <comment id="12377935" author="davidvc" created="Fri, 5 May 2006 10:13:14 +0100"  >&lt;p&gt;Hi, Dag.  This is not tested, but it builds and I&apos;m running tests to adjust output files.  Does this look right to you?&lt;/p&gt;</comment>
                            <comment id="12378040" author="dagw" created="Fri, 5 May 2006 22:06:18 +0100"  >&lt;p&gt;This looks good to me, David! &lt;/p&gt;

&lt;p&gt;I verified that embedded also gives 24000 &lt;br/&gt;
NO_CURRENT_ROW when beforeFirst and afterLast (so &lt;br/&gt;
the checks in refreshRowX mirrors embedded as well).&lt;/p&gt;</comment>
                            <comment id="12378365" author="davidvc" created="Mon, 8 May 2006 12:13:25 +0100"  >&lt;p&gt;This attachment is with derbynetclientmats passing.  Take a look, Dag, and let me know if this is good to go.  Thanks!&lt;/p&gt;</comment>
                            <comment id="12378423" author="dagw" created="Mon, 8 May 2006 21:42:42 +0100"  >&lt;p&gt;It looks good to me, except I think you should update the 1.6 version of the canon, as well.&lt;br/&gt;
When that&apos;s done it is ready to go, I&apos;d say.&lt;/p&gt;</comment>
                            <comment id="12378530" author="davidvc" created="Tue, 9 May 2006 06:39:09 +0100"  >&lt;p&gt;Committed revision 405205&lt;/p&gt;</comment>
                            <comment id="12412464" author="dagw" created="Fri, 19 May 2006 09:37:35 +0100"  >&lt;p&gt;Fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12326288" name="DERBY-1266-1.diff" size="3052" author="davidvc" created="Fri, 5 May 2006 10:13:14 +0100"/>
                            <attachment id="12326363" name="DERBY-1266-2.diff" size="7213" author="davidvc" created="Mon, 8 May 2006 12:13:25 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 4 May 2006 02:14:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22407</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy16en:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40688</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>