<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:38 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1858/DERBY-1858.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1858] A schema can be dropped by a non-schema owner in SQL authorization mode</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1858</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;drop schema user2 restrict should fail since user3 does not own the schema user2.&lt;/p&gt;

&lt;p&gt;ij version 10.3&lt;br/&gt;
ij&amp;gt; connect &apos;wombat;create=true&apos; user &apos;user1&apos; as user1;&lt;br/&gt;
WARNING 01J14: SQL authorization is being used without first enabling authentication.&lt;br/&gt;
ij&amp;gt; connect &apos;wombat;create=true&apos; user &apos;user2&apos; as user2;&lt;br/&gt;
WARNING 01J01: Database &apos;wombat&apos; not created, connection made to existing database instead.&lt;br/&gt;
WARNING 01J14: SQL authorization is being used without first enabling authentication.&lt;br/&gt;
ij(USER2)&amp;gt; create schema user2;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij(USER2)&amp;gt; connect &apos;wombat;create=true&apos; user &apos;user3&apos; as user3;&lt;br/&gt;
WARNING 01J01: Database &apos;wombat&apos; not created, connection made to existing database instead.&lt;br/&gt;
WARNING 01J14: SQL authorization is being used without first enabling authentication.&lt;br/&gt;
ij(USER3)&amp;gt; drop schema user2 restrict;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;/p&gt;

&lt;p&gt;sysinfo:&lt;/p&gt;

&lt;p&gt;------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.4.2_12&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
Java home:       c:\jdk142\jre&lt;br/&gt;
Java classpath:  classes;.&lt;br/&gt;
OS name:         Windows XP&lt;br/&gt;
OS architecture: x86&lt;br/&gt;
OS version:      5.1&lt;br/&gt;
Java user name:  Yip&lt;br/&gt;
Java user home:  C:\Documents and Settings\Yip&lt;br/&gt;
Java user dir:   C:\work3\derby\trunk&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
java.specification.version: 1.4&lt;br/&gt;
--------- Derby Information --------&lt;br/&gt;
JRE - JDBC: J2SE 1.4.2 - JDBC 3.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;C:\work3\derby\trunk\classes&amp;#93;&lt;/span&gt; 10.3.0.0 alpha - (446666)&lt;br/&gt;
------------------------------------------------------&lt;br/&gt;
----------------- Locale Information -----------------&lt;br/&gt;
Current Locale :  [English/United States &lt;span class=&quot;error&quot;&gt;&amp;#91;en_US&amp;#93;&lt;/span&gt;]&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;de_DE&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (446666)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;es&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (446666)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;fr&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (446666)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;it&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (446666)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ja_JP&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (446666)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ko_KR&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (446666)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;pt_BR&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (446666)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;zh_CN&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (446666)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;zh_TW&amp;#93;&lt;/span&gt;&lt;br/&gt;
         version: 10.3.0.0 alpha - (446666)&lt;br/&gt;
------------------------------------------------------&lt;/p&gt;</description>
                <environment>Any</environment>
        <key id="12350064">DERBY-1858</key>
            <summary>A schema can be dropped by a non-schema owner in SQL authorization mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yipng">Yip Ng</assignee>
                                    <reporter username="yipng">Yip Ng</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Sep 2006 22:10:17 +0100</created>
                <updated>Thu, 13 Dec 2007 09:05:14 +0000</updated>
                            <resolved>Sun, 1 Oct 2006 18:00:30 +0100</resolved>
                                    <version>10.2.1.6</version>
                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12435277" author="yipng" created="Sun, 17 Sep 2006 00:39:22 +0100"  >&lt;p&gt;Attaching patch derby1858-trunk-diff01.txt for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1858&quot; title=&quot;A schema can be dropped by a non-schema owner in SQL authorization mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1858&quot;&gt;&lt;del&gt;DERBY-1858&lt;/del&gt;&lt;/a&gt;.  The problem is that DropSchemaNode&apos;s bind phase did not add the required schema privilege for it to check at runtime.  derbyall ran successfully.&lt;/p&gt;</comment>
                            <comment id="12435615" author="mikem" created="Tue, 19 Sep 2006 01:18:59 +0100"  >&lt;p&gt;patch is available, making it a 10.2 candidate.&lt;/p&gt;</comment>
                            <comment id="12435671" author="mamtas" created="Tue, 19 Sep 2006 06:47:55 +0100"  >&lt;p&gt;Yip, I did a review of the attached package and following couple questions/comments.&lt;/p&gt;

&lt;p&gt;1)I had question about changes to DropSchemaNode. I realize that my question here is related to pre-existing logic that you needed to extend for drop schema. But I wondered why for table privilege, we push the privilege requirement(select/trigger/update etc) by calling CompilerContext.pushCurrentPrivType and use that to determine what kind of privilege is required for the table in CompilerContextImpl.addRequiredTablePriv method. But for privilege requirement for schemas, we pass the privilege type to CompilerContextImpl.addRequiredSchemaPriv rather than pushing it onto CompilerContext and then popping it back from there at the right time. I should have asked this question when the code was originally checked in for CreateSchemaNode. This is not a biggie, just a curiosity question.&lt;/p&gt;

&lt;p&gt;2)In Authorizer.java, there is a constant called PRIV_TYPE_COUNT which has a value of 7. With the patch attached to this Jira entry, we have added 1 more privilege type. Do we need to change PRIV_TYPE_COUNT? May be the purpose of PRIV_TYPE_COUNT is to track only table and routine level privilege types and that is why we didn&apos;t need to modify it for this patch.&lt;/p&gt;

&lt;p&gt;3)Can we have some positive test cases for drop schema in grantRevokeDDL2.sql showing that a database owner or schema owner can successfully drop the schema?&lt;/p&gt;

&lt;p&gt;Other than that, the changes look pretty good to me. Thanks, Yip.&lt;/p&gt;</comment>
                            <comment id="12435725" author="yipng" created="Tue, 19 Sep 2006 09:36:38 +0100"  >&lt;p&gt;Thanks for reviewing the patch, Mamta.  My response to your comments:&lt;/p&gt;

&lt;p&gt;1)  Yes, I noticed that also.  If you look at the CREATE_SCHEMA_PRIV and MODIFY_SCHEMA_PRIV, they are of boolean types and not like the other 7 privilege types which are declared as integers.  So it looks like privilege collection for schema are done abit differently and they were not considered as an integral part of the push/pop privilege logic in compiler context.  (They could be, but its not necessary)  &lt;/p&gt;

&lt;p&gt;2)  The PRIV_TYPE_COUNT should still be 7 since those privilege types(select, insert, update, ..., etc.) are part of  &lt;br/&gt;
grant/revoke statement.  The other schema privileges are used sorely to differentiate what action to take during permission checking time.&lt;/p&gt;

&lt;p&gt;3)  Yes, there is already a testcase to test if database owner can drop the schema.  I believe I have uncommented that part of test in grantRevokeDDL2.sql to re-enable it for this jira.&lt;/p&gt;</comment>
                            <comment id="12435797" author="rhillegas" created="Tue, 19 Sep 2006 15:25:03 +0100"  >&lt;p&gt;Moving to 10.2.2.0.&lt;/p&gt;</comment>
                            <comment id="12437256" author="mikem" created="Sun, 24 Sep 2006 23:04:00 +0100"  >&lt;p&gt;I looked at applying this patch, but it failed with the following warning, not sure if it is my environment or that the patch needs to be regenerated:&lt;/p&gt;

&lt;p&gt;m1_ibm142:52&amp;gt;pwd&lt;br/&gt;
C:/p4/m1/opensource&lt;br/&gt;
m1_ibm142:53&amp;gt;patch --dry-run -p0 -i c:/tmp/derby1858-trunk-diff01.txt&lt;br/&gt;
patching file `java/engine/org/apache/derby/impl/sql/compile/CompilerContextImpl&lt;br/&gt;
.java&apos;&lt;br/&gt;
patching file `java/engine/org/apache/derby/impl/sql/compile/DropSchemaNode.java&lt;br/&gt;
&apos;&lt;br/&gt;
patching file `java/engine/org/apache/derby/iapi/sql/compile/CompilerContext.jav&lt;br/&gt;
a&apos;&lt;br/&gt;
patching file `java/engine/org/apache/derby/iapi/sql/conn/Authorizer.java&apos;&lt;br/&gt;
patching file `java/engine/org/apache/derby/iapi/sql/dictionary/StatementSchemaP&lt;br/&gt;
ermission.java&apos;&lt;br/&gt;
Hunk #3 FAILED at 66.&lt;br/&gt;
1 out of 3 hunks FAILED &amp;#8211; saving rejects to java/engine/org/apache/derby/iapi/s&lt;br/&gt;
ql/dictionary/StatementSchemaPermission.java.rej&lt;br/&gt;
patching file `java/testing/org/apache/derbyTesting/functionTests/tests/lang/gra&lt;br/&gt;
ntRevokeDDL2.sql&apos;&lt;br/&gt;
patching file `java/testing/org/apache/derbyTesting/functionTests/master/jdk16/g&lt;br/&gt;
rantRevokeDDL2.out&apos;&lt;br/&gt;
patching file `java/testing/org/apache/derbyTesting/functionTests/master/grantRe&lt;br/&gt;
vokeDDL2.out&apos;&lt;/p&gt;</comment>
                            <comment id="12437467" author="yipng" created="Mon, 25 Sep 2006 07:22:30 +0100"  >&lt;p&gt;Regenerate patch for trunk - derby1858-trunk-diff02.txt&lt;/p&gt;</comment>
                            <comment id="12437628" author="mikem" created="Mon, 25 Sep 2006 19:14:07 +0100"  >&lt;p&gt;thanks, the 2nd patch applied cleanly for me.&lt;/p&gt;</comment>
                            <comment id="12437701" author="mikem" created="Tue, 26 Sep 2006 01:07:47 +0100"  >&lt;p&gt;committed change to the trunk.&lt;/p&gt;

&lt;p&gt;m1_ibm142:161&amp;gt;svn commit&lt;/p&gt;

&lt;p&gt;Sending        java\engine\org\apache\derby\iapi\sql\compile\CompilerContext.jav&lt;br/&gt;
a&lt;br/&gt;
Sending        java\engine\org\apache\derby\iapi\sql\conn\Authorizer.java&lt;br/&gt;
Sending        java\engine\org\apache\derby\iapi\sql\dictionary\StatementSchemaP&lt;br/&gt;
ermission.java&lt;br/&gt;
Sending        java\engine\org\apache\derby\impl\sql\compile\CompilerContextImpl&lt;br/&gt;
.java&lt;br/&gt;
Sending        java\engine\org\apache\derby\impl\sql\compile\DropSchemaNode.java&lt;/p&gt;

&lt;p&gt;Sending        java\testing\org\apache\derbyTesting\functionTests\master\grantRe&lt;br/&gt;
vokeDDL2.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\master\jdk16\g&lt;br/&gt;
rantRevokeDDL2.out&lt;br/&gt;
Sending        java\testing\org\apache\derbyTesting\functionTests\tests\lang\gra&lt;br/&gt;
ntRevokeDDL2.sql&lt;br/&gt;
Transmitting file data ........&lt;br/&gt;
Committed revision 449869.&lt;/p&gt;</comment>
                            <comment id="12438823" author="yipng" created="Sat, 30 Sep 2006 00:03:51 +0100"  >&lt;p&gt;I think this jira can be marked as resolved once it is backported to 10.2.&lt;/p&gt;</comment>
                            <comment id="12438999" author="fuzzylogic" created="Sun, 1 Oct 2006 18:00:30 +0100"  >&lt;p&gt;Patch applied to trunk and 10.2. Marking resolved.&lt;/p&gt;</comment>
                            <comment id="12551421" author="fuzzylogic" created="Thu, 13 Dec 2007 09:05:14 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12340995" name="derby1858-trunk-diff01.txt" size="10658" author="yipng" created="Sun, 17 Sep 2006 00:39:22 +0100"/>
                            <attachment id="12341595" name="derby1858-trunk-diff02.txt" size="10750" author="yipng" created="Mon, 25 Sep 2006 07:22:30 +0100"/>
                            <attachment id="12340994" name="derby1858-trunk-stat01.txt" size="747" author="yipng" created="Sun, 17 Sep 2006 00:39:22 +0100"/>
                            <attachment id="12341594" name="derby1858-trunk-stat02.txt" size="747" author="yipng" created="Mon, 25 Sep 2006 07:22:30 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Sep 2006 00:18:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22755</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0zyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39643</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>