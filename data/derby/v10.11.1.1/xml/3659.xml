<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:23:40 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3659/DERBY-3659.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3659] revive tests with ldap references to be runnable as junit tests</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3659</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;During initial contribution some tests were created with references to ldap security mechanism.&lt;br/&gt;
However, because we don&apos;t have ourselves setup for a public ldap server, these tests have fallen by the wayside.&lt;br/&gt;
Specifically, there is still a secureUsers .out file in functionTests.master that uses some ldap references, and there&apos;s the -not running - jdbcapi.xaJNDI.java.&lt;/p&gt;

&lt;p&gt;These should be turned into junit tests out of these that take properties for the ldapserver, port, and dnString.&lt;br/&gt;
If we ever get a Zone, with an ldap server, or somehow get access to another public ldap server, then we can modify the tests to have the correct references.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12395226">DERBY-3659</key>
            <summary>revive tests with ldap references to be runnable as junit tests</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="myrna">Myrna van Lunteren</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 May 2008 22:39:44 +0100</created>
                <updated>Wed, 1 Jul 2009 00:45:32 +0100</updated>
                            <resolved>Wed, 4 Jun 2008 00:48:10 +0100</resolved>
                                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12593904" author="fuzzylogic" created="Fri, 2 May 2008 22:46:29 +0100"  >&lt;p&gt;Surely the Apache Directory project has a test server running somewhere. Maybe check on their dev and/or user list if they have a test server that they&apos;re ok having multiple automated Derby test clients hitting at all hours of the day.&lt;/p&gt;</comment>
                            <comment id="12594636" author="myrna" created="Tue, 6 May 2008 18:11:22 +0100"  >&lt;p&gt;Thx for your suggestions Andrew. I want to postpone sorting through finding a server until we have something that is runnable...&lt;/p&gt;</comment>
                            <comment id="12594640" author="myrna" created="Tue, 6 May 2008 18:24:40 +0100"  >&lt;p&gt;Attaching a patch with converted XAJDNITest.java (from xaJNDI.java), incl. policy file.&lt;br/&gt;
This file now uses 3 system properties, one of which is also used in the policy file:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;derbyTesting.ldapServer&lt;/li&gt;
	&lt;li&gt;derbyTesting.ldapPort&lt;/li&gt;
	&lt;li&gt;derbyTesting.dnString&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So, to run the test, currently you have to pass values in for an ldap server, like so (note, the host doesn&apos;t exist (I assume)):&lt;br/&gt;
java -DderbyTesting.ldapServer=ldapserverhost.apache.org -DderbyTesting.ldapPort=333 -DerbyTesting.dnString=approp.riate.string junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.jdbcapi.XAJNDITest&lt;/p&gt;

&lt;p&gt;Question:&lt;br/&gt;
The test compares a datasource with one created using ic.rebind and ic.lookup, and expects them to be the same.&lt;br/&gt;
Is that a valid assumption?&lt;br/&gt;
(If so, then there&apos;s a bug with NetworkServer, &apos;cause with network server the two are not identical (from a quick glance looks like the id is different. The original test only ran with embedded).&lt;/p&gt;

&lt;p&gt;Also, the original test went on to unset the property createDatabase, and then compare the two datasources (modified one &amp;amp; one created before using ic.rebind and ic.lookup). This is now different. However, I tried (by mistake) to blank out the databaseName property, and then the datasources are still the same. Does that make sense?&lt;/p&gt;</comment>
                            <comment id="12595429" author="myrna" created="Fri, 9 May 2008 00:52:37 +0100"  >&lt;p&gt;Logged &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3669&quot; title=&quot;ClientXADataSource fetched from JNDI not identical as originally bound; some properties have String &amp;quot;null&amp;quot; instead of null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3669&quot;&gt;&lt;del&gt;DERBY-3669&lt;/del&gt;&lt;/a&gt; to document that the xadatasource is not equal after bind and lookup from jndi with network server.&lt;/p&gt;</comment>
                            <comment id="12595430" author="myrna" created="Fri, 9 May 2008 00:53:17 +0100"  >&lt;p&gt;committed the patch with modifications, with revision 654656.&lt;/p&gt;</comment>
                            <comment id="12600313" author="myrna" created="Wed, 28 May 2008 00:41:42 +0100"  >&lt;p&gt;attaching a patch with 2 &apos;new&apos; tests, LDAPAuthenticationTest and InvalidLDAPServerAuthenticationTest.&lt;/p&gt;

&lt;p&gt;LDAPAuthenticationTest essentially tests what was contributed with master file &apos;secureUsersldap.out&apos;. It was never made into a test because there was no ldap server. This test will need to be run with 5 properties passed in; derbyTesting.ldapServer, derbyTesting.dnString, derbyTesting.ldapUser, derbyTesting.ldapPassword, and derbyTesting.ldapPort.&lt;br/&gt;
There should be 2 users on the ldap server, with ou=People;&lt;br/&gt;
mamta / yeehaLdap and kathy/kathyS.&lt;/p&gt;

&lt;p&gt;InvalidLDAPServerAuthenticationTest tests that an appropriate 08004 error is returned when the ldapServer used does not exist. It&apos;s a somewhat silly test, and only works without security manager (else, I got &lt;br/&gt;
security manager errors even though I had added the non-existing ldapServer to the policy files).&lt;/p&gt;

&lt;p&gt;I ran into one strange thing with these test:&lt;/p&gt;

&lt;p&gt;1.  re LDAPAuthenticationTest: the sql executed in ij as reflected in the secureUsersldap.out file resulted in a 08004 error when an invalid user attempted to shutdown the system.&lt;br/&gt;
-----------&lt;br/&gt;
ij&amp;gt; &amp;#8211; Derby system shutdown - check user - should fail&lt;br/&gt;
connect &apos;;user=jamie;password=LetMeIn;shutdown=true&apos;;&lt;br/&gt;
ERROR 08004: Connection refused : Invalid authentication.&lt;br/&gt;
-----------&lt;br/&gt;
However, when I attempted a similar construction in junit, connecting either with DataSources or DriverManager, I was able to successfully shutdown the system; at least, I got the XJ015 error (system shutdown). Anyone any suggestions on this?&lt;/p&gt;

&lt;p&gt;2. InvalidLDAPAuthenticationServerTest will result in an unusable database, and I tried to make it so the test would cleanup fine. However, the test does not cleanly delete db.lck, yet I don&apos;t see what is causing the test (framework?) to hang on to it. If anyone sees what I&apos;m missing?&lt;/p&gt;</comment>
                            <comment id="12600314" author="myrna" created="Wed, 28 May 2008 00:42:28 +0100"  >&lt;p&gt;I sent of a mail to the apache directory project. We&apos;ll see if someone has a server we can run our tests against.&lt;/p&gt;</comment>
                            <comment id="12601318" author="myrna" created="Sat, 31 May 2008 02:27:49 +0100"  >&lt;p&gt;attaching a second version of the patch.&lt;br/&gt;
I answered my two questions myself:&lt;br/&gt;
re InvalidLDAPAuthenticationServerTest - the failed connection attempts apparently caused the test to cling to the db.lck. I resolved the cleanup trouble by using a singleUseDatabaseDecoratorNoShutdown instead of singlueUseDatabaseDecorator - now the teardown doesn&apos;t attempt to connect &amp;amp; the cleanup runs smoothly.&lt;br/&gt;
re LDAPAuthenticationTest system shutdowns: the original out file was created using a derby.properties file that set requireAuthentication to true - that&apos;s why the shutdown with non-system users failed. This is already tested in AuthenticationTest, and isn&apos;t testing LDAP per se, so I felt it ok to remove it from the LDAP test.&lt;br/&gt;
I added the tests to jdbcapi/_Suite.java with an if block to ensure the ldapServer property is specified.&lt;br/&gt;
I am not sure how to force a more useful message to pop up. For now, if people don&apos;t set the derbyTesting.ldapServer, derbyTesting.ldapUser, derbyTesting.ldapPassword, derbyTesting.dnString, derbyTesting.ldapPort properties, the test will do nothing, which means no worse test coverage than we had before.&lt;br/&gt;
When the properties are set, and the extra user (kathy/kathyS) is specified, the test will run.&lt;/p&gt;</comment>
                            <comment id="12601319" author="myrna" created="Sat, 31 May 2008 02:30:11 +0100"  >&lt;p&gt;committed patch &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3659&quot; title=&quot;revive tests with ldap references to be runnable as junit tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3659&quot;&gt;&lt;del&gt;DERBY-3659&lt;/del&gt;&lt;/a&gt;-2b.diff with revision 661924.&lt;/p&gt;</comment>
                            <comment id="12602107" author="myrna" created="Wed, 4 Jun 2008 00:13:13 +0100"  >&lt;p&gt;some minor things popped up with these tests&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fails with jars&lt;/li&gt;
	&lt;li&gt;on re-checking, I found that only LDAPAuthenticationTest needs a special policy file. I don&apos;t know anymore why I thought one was needed for XAJNDITest - that test works fine with the default. Possibly initially at some point I had code making a connection.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I want to:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;rename the XAJNDITest.policy to LDAPTests.policy&lt;/li&gt;
	&lt;li&gt;add the permission grant to ldapServer to derby.jar section&lt;/li&gt;
	&lt;li&gt;make some minor adjustments to XAJNDITest, among others to remove reference to the policy file&lt;/li&gt;
	&lt;li&gt;make LDAPAuthenticationTest use LDAPTests.policy&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12602117" author="myrna" created="Wed, 4 Jun 2008 00:48:10 +0100"  >&lt;p&gt;closing after committing the minor changes of patch &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3659&quot; title=&quot;revive tests with ldap references to be runnable as junit tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3659&quot;&gt;&lt;del&gt;DERBY-3659&lt;/del&gt;&lt;/a&gt;-3 with revision 662920.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12383340" name="DERBY-3659-3.diff" size="24984" author="myrna" created="Wed, 4 Jun 2008 00:45:55 +0100"/>
                            <attachment id="12381517" name="DERBY-3659.diff" size="25428" author="myrna" created="Tue, 6 May 2008 18:24:40 +0100"/>
                            <attachment id="12382890" name="DERBY-3659_2.diff" size="25821" author="myrna" created="Wed, 28 May 2008 00:41:42 +0100"/>
                            <attachment id="12383160" name="DERBY-3659_2b.diff" size="27365" author="myrna" created="Sat, 31 May 2008 02:27:49 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 2 May 2008 21:46:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30940</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0tyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38673</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>