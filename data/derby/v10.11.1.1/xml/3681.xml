<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:07:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3681/DERBY-3681.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3681] When authenticating a user at connect time, verify that the user provided is not also a defined role name.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3681</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Although we try to avoid creating role that are not also valid Derby users (see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3673&quot; title=&quot;Add checks that a new role isn&amp;#39;t already a user authorization id&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3673&quot;&gt;&lt;del&gt;DERBY-3673&lt;/del&gt;&lt;/a&gt;), we cannot&lt;br/&gt;
in general know for sure that no such user exists; it could be added to derby.properties after&lt;br/&gt;
the role has been created, authentication could be LDAP or user-defined, in which cases&lt;br/&gt;
the check at role creation time will not work. So, in order to avoid collisions between user identifiers and role identifiers, we shoudl check at connect time that there is no role by same name as the supplied user name.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12396440">DERBY-3681</key>
            <summary>When authenticating a user at connect time, verify that the user provided is not also a defined role name.</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12380756">DERBY-3137</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 May 2008 19:45:41 +0100</created>
                <updated>Thu, 13 Jan 2011 17:20:17 +0000</updated>
                            <resolved>Fri, 23 May 2008 15:06:11 +0100</resolved>
                                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Services</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12598799" author="dagw" created="Wed, 21 May 2008 22:38:10 +0100"  >&lt;p&gt;Uploading patch derby-3681-1 which implements the check. Running&lt;br/&gt;
regression tests now.&lt;/p&gt;

&lt;p&gt;Patch details:&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/jdbc/EmbedConnection.java&lt;/p&gt;

&lt;p&gt;An extra test is added to checkUserCredentials when applicable&lt;br/&gt;
(dictionary &amp;gt;= 10.4 and sqlAuthorization is in use). A user name which&lt;br/&gt;
equals a role name will lead to connection level exception state&lt;br/&gt;
NET_CONNECT_AUTH_FAILED, i.e. 08004 and the connect will fail. I chose&lt;br/&gt;
not to add a new error message here, in the spirit of not providing&lt;br/&gt;
too much information when authentication fails. Admittedly, this could&lt;br/&gt;
cause some user confusion (&quot;this user is defined, why can&apos;t I&lt;br/&gt;
connect?&quot;), so a more helpful message is arguably better.&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/RolesTest.java&lt;/p&gt;

&lt;p&gt;Added a test case for the new check.&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/junit/DriverManagerConnector.java&lt;/p&gt;

&lt;p&gt;For the client, openConnection(String, String, String) can&apos;t reliably&lt;br/&gt;
determine if a 08004 means the database does not exist or if it is a&lt;br/&gt;
authentication problem, so before this fix, my new test failed because&lt;br/&gt;
the fallback here tried to create a new database in such cases. This&lt;br/&gt;
should also fail when using the provided user, but it did not, since the&lt;br/&gt;
fallback used a call to getConnectionByAttributes(url, &quot;create&quot;,&lt;br/&gt;
&quot;true&quot;). This uses the default user, not the one provided. &lt;br/&gt;
So i modified this code to try to create using the&lt;br/&gt;
provided user which seems more logical anyway..&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/junit/CleanDatabaseTestSetup.java&lt;/p&gt;

&lt;p&gt;Added code to remove any roles when cleaning a database. This was&lt;br/&gt;
necessary since the RolesTest left a role in the database called&lt;br/&gt;
&quot;bar&quot;, which the subsequent SQLGrantREvokeDDLTest tried to use as a&lt;br/&gt;
user name. The new check introduced with this issue made that fail.&lt;/p&gt;</comment>
                            <comment id="12598953" author="knutanders" created="Thu, 22 May 2008 10:22:51 +0100"  >&lt;p&gt;Hi Dag,&lt;/p&gt;

&lt;p&gt;The code in EmbedConnection looks good. One minor nit: @code&lt;/p&gt;
{lcc}
&lt;p&gt; in the javadoc should have been &lt;/p&gt;
{@code lcc}
&lt;p&gt;, I think. And, by the way, would it make sense to hide the version check in a helper method, for instance dd.supportsRoles()? I don&apos;t know how we usually check the dictionary version.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure that the change in DriverManagerConnector is correct. Using the default user ensures that the DBO is the same regardless of whether the database was created in that test or not. Not sure if this matters to any of the tests, though, I just wanted to raise the issue.&lt;/p&gt;

&lt;p&gt;In RolesTest, I think this code should be simplified:&lt;/p&gt;

&lt;p&gt;+            Connection cn = null;&lt;br/&gt;
+            try &lt;/p&gt;
{
+                // should work, not defined as a role yet
+                cn = openDefaultConnection(&quot;soonarole&quot;,&quot;whatever&quot;);
+            }
&lt;p&gt; finally {&lt;br/&gt;
+                try {&lt;br/&gt;
+                    if (cn != null) &lt;/p&gt;
{
+                        cn.close();
+                    }
&lt;p&gt;+                } catch (SQLException e) &lt;/p&gt;
{
+                }
&lt;p&gt;+            }&lt;/p&gt;

&lt;p&gt;As it is now, if openDefaultConnection() incorrectly returns null, it is silently ignored. Also, exceptions from cn.close() are swallowed. Couldn&apos;t it be replaced with this one-liner:&lt;/p&gt;

&lt;p&gt;    openDefaultConnection(&quot;soonarole&quot;, &quot;whatever&quot;).close();&lt;/p&gt;

&lt;p&gt;It&apos;s simpler, and it would fail on null values and SQLExceptions. (For readability, I would perhaps also have removed the finally clause in the try/finally near the end of testLoginWithUsernameWhichIsARole() too, but there it wouldn&apos;t have any effect on what is tested.)&lt;/p&gt;</comment>
                            <comment id="12599117" author="dagw" created="Thu, 22 May 2008 19:49:01 +0100"  >&lt;p&gt;Thanks for comments, Knut! The RolesTest simplifications are nice &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt; I&apos;m not sure that the change in DriverManagerConnector is correct. &lt;br/&gt;
&amp;gt; Using the default user ensures that the DBO is the &amp;gt; same regardless&lt;br/&gt;
&amp;gt; of whether the database was created in that test or not. Not sure if this &lt;br/&gt;
&amp;gt; matters to any of the tests, though, I just wanted to raise the issue.&lt;/p&gt;

&lt;p&gt;Yes I did consider this, but felt it was an very weird way of creating the database and the connection returned would be with another current user than the one requested, which seems plain wrong to me. Anyway, I ran the regression&lt;br/&gt;
tests successfully, so it seems this behavior is not counted upon.&lt;/p&gt;

&lt;p&gt;As far as checking the dictionary verision, it seems DataDictionary#checkVersion  is the one to use. The parser uses this, too. Interestingly, if the feature supplied is non-null it throws if the version is not new enough, if the&lt;br/&gt;
feature is null, it returns false...Struck me as a bit odd.&lt;/p&gt;</comment>
                            <comment id="12599122" author="dagw" created="Thu, 22 May 2008 20:04:01 +0100"  >&lt;p&gt;derby-3681-2 addresses Knuts comments for RoleTest.&lt;br/&gt;
Regressions ran OK for version 1 of the patch, and I tested RolesTest over again,&lt;br/&gt;
so if there are no further comments it should be ready for commit.&lt;/p&gt;</comment>
                            <comment id="12599285" author="knutanders" created="Fri, 23 May 2008 07:20:01 +0100"  >&lt;p&gt;The changes in derby-3681-2 look good. Thanks Dag! +1 to commit.&lt;/p&gt;</comment>
                            <comment id="12599375" author="dagw" created="Fri, 23 May 2008 15:06:11 +0100"  >&lt;p&gt;Thanks, Knut. Committed patch derby-3681-2 as svn 659543, resolving.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12382515" name="derby-3681-1.diff" size="8298" author="dagw" created="Wed, 21 May 2008 22:38:10 +0100"/>
                            <attachment id="12382516" name="derby-3681-1.stat" size="307" author="dagw" created="Wed, 21 May 2008 22:38:10 +0100"/>
                            <attachment id="12382592" name="derby-3681-2.diff" size="7889" author="dagw" created="Thu, 22 May 2008 20:04:00 +0100"/>
                            <attachment id="12382593" name="derby-3681-2.stat" size="307" author="dagw" created="Thu, 22 May 2008 20:04:01 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 May 2008 09:22:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30953</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0nq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37662</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>