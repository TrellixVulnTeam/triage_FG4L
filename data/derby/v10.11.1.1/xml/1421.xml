<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:50:46 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1421/DERBY-1421.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1421] ResultSet.updateBinaryStream fails when the result type is TYPE_SCROLL_INSENSITIVE</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1421</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Attaching test program for the above bug. The program however works fine when the ResultSetType is TYPE_FORWARD_ONLY.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12344507">DERBY-1421</key>
            <summary>ResultSet.updateBinaryStream fails when the result type is TYPE_SCROLL_INSENSITIVE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fernanda">Fernanda Pizzorno</assignee>
                                    <reporter username="narayanan">V.Narayanan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Jun 2006 22:47:10 +0100</created>
                <updated>Thu, 13 Dec 2007 09:04:58 +0000</updated>
                            <resolved>Fri, 30 Jun 2006 18:04:57 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12416532" author="narayanan" created="Fri, 16 Jun 2006 22:49:09 +0100"  >&lt;p&gt;The above program fails with the following message&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED statementContext is not expected to equal statementContexts&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:119)&lt;br/&gt;
        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.popStatementContext(GenericLanguageConnectionContext.java:2027)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedResultSet.updateRow(EmbedResultSet.java:3577)&lt;br/&gt;
        at TestUpdateBinaryStream.main(TestUpdateBinaryStream.java:43)&lt;br/&gt;
Java Result: 1&lt;/p&gt;</comment>
                            <comment id="12417052" author="fernanda" created="Wed, 21 Jun 2006 15:54:35 +0100"  >&lt;p&gt;ResultSet.updateBinaryStream() fails for scrollable updatable result sets because of a call to the method ExecRow.clone() that fails. When the clone method in the SQLBinary column is called, the stream has already been read and is closed, and an attempt to read this closed stream causes an exception. The streams used in this case are of type RemeberBytesInputStream. This type of stream keeps a copy of every byte that has been read or skipped, and can be re-read using a &quot;replay&quot; stream.&lt;/p&gt;

&lt;p&gt;This patch (derby-1421.diff) fixes this problem by using the &quot;replay&quot; stream to get the data, if the stream has previously been read. I have successfully run derbyall with this patch. Can someone please review it?&lt;/p&gt;

&lt;p&gt;Thank you in advance.&lt;/p&gt;</comment>
                            <comment id="12417988" author="andreask" created="Tue, 27 Jun 2006 17:30:31 +0100"  >&lt;p&gt;The patch looks good, however I have one issue which should be discussed/clarified:&lt;/p&gt;

&lt;p&gt;The patch makes use of an impl class (import org.apache.derby.impl.store.raw.data.RememberBytesInputStream) . I have not seen any other classes in the package org.apache.derby.iapi.types, make use of impl classes, so I am not sure if it breaks some design-rule in derby. In this case, it could probably be ok, since we are not exposing the impl class to the client, only using it in the implementation of a class.&lt;/p&gt;

&lt;p&gt;Another question is if we could avoid the cloning of the column somehow or if it is possible to use a shallow clone? As far as I can tell, the current cloning will do an inmemory copy of all data in the blob column, and if it is a 1GB blob, I think it will cause an OutOfMemory error.&lt;/p&gt;</comment>
                            <comment id="12418583" author="andreask" created="Fri, 30 Jun 2006 16:15:02 +0100"  >&lt;p&gt;As part of fixing &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-802&quot; title=&quot;OutofMemory Error when reading large blob when statement type is ResultSet.TYPE_SCROLL_INSENSITIVE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-802&quot;&gt;&lt;del&gt;DERBY-802&lt;/del&gt;&lt;/a&gt;, I found that the call to rowChanger.updateRow(..) has destructive effect on the Blob columns, so that they cannot be used again in source.updateRow(..) when doing clone or if it is to be used for writing it into a disk hash table.&lt;/p&gt;

&lt;p&gt;I have therefore replaced the order of the calls in UpdatableResultSet.java, so that they are now:&lt;/p&gt;

&lt;p&gt;				source.updateRow(newBaseRow);&lt;br/&gt;
				rowChanger.updateRow(row,newBaseRow,baseRowLocation);&lt;/p&gt;

&lt;p&gt;This means that the hashtable in ScrollInsensitiveResultSet will be updated before the actual row is updated, however from the user this is atomic.&lt;/p&gt;

&lt;p&gt;With the patch derby-1421v2.diff, I have kept all the tests in derby-1421.diff, however I have removed the changes in SQLBinary. The test passes.&lt;/p&gt;

&lt;p&gt;Using this patch, in combination with the removal of cloning in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-802&quot; title=&quot;OutofMemory Error when reading large blob when statement type is ResultSet.TYPE_SCROLL_INSENSITIVE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-802&quot;&gt;&lt;del&gt;DERBY-802&lt;/del&gt;&lt;/a&gt; I have been able to read and update 64MB blobs in scrollable insensitive result sets.&lt;/p&gt;</comment>
                            <comment id="12418591" author="fernanda" created="Fri, 30 Jun 2006 17:20:35 +0100"  >&lt;p&gt;The patch derby-1421v2.diff looks good. Since cloning is removed in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-802&quot; title=&quot;OutofMemory Error when reading large blob when statement type is ResultSet.TYPE_SCROLL_INSENSITIVE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-802&quot;&gt;&lt;del&gt;DERBY-802&lt;/del&gt;&lt;/a&gt;, changes to SQLBinary in derby-1421.diff would not be necessary.&lt;/p&gt;</comment>
                            <comment id="12418599" author="andreask" created="Fri, 30 Jun 2006 18:04:57 +0100"  >&lt;p&gt;Committed revision 418221.&lt;/p&gt;</comment>
                            <comment id="12551351" author="fuzzylogic" created="Thu, 13 Dec 2007 09:04:58 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12335554" name="TestUpdateBinaryStream.java" size="1575" author="narayanan" created="Fri, 16 Jun 2006 22:49:09 +0100"/>
                            <attachment id="12335697" name="derby-1421.diff" size="8737" author="fernanda" created="Wed, 21 Jun 2006 15:54:35 +0100"/>
                            <attachment id="12335698" name="derby-1421.stat" size="219" author="fernanda" created="Wed, 21 Jun 2006 15:54:35 +0100"/>
                            <attachment id="12336188" name="derby-1421v2.diff" size="8154" author="andreask" created="Fri, 30 Jun 2006 16:15:02 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 Jun 2006 14:54:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22495</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy1087:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39687</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>