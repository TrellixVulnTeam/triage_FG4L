<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:43:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-662/DERBY-662.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-662] during crash recovery of a drop table, on case insensitive files systems derby may delete wrong file</title>
                <link>https://issues.apache.org/jira/browse/DERBY-662</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Sometimes during redo the system will incorrectly remove the file associated&lt;br/&gt;
with a table.  The bug requires the following conditions to reproduce:&lt;br/&gt;
1) The OS/filesystem must be case insensitive such that a request to delete&lt;br/&gt;
   a file named C2080.dat would also remove c2080.dat.  This is true in&lt;br/&gt;
   windows default file systems, not true in unix/linux filesystems that&lt;br/&gt;
   I am aware of.&lt;br/&gt;
2) The system must be shutdown not in a clean manner, such that a subsequent&lt;br/&gt;
   access of the database causes a REDO recovery action of a drop table&lt;br/&gt;
   statement.  This means that a drop table statement must have happened&lt;br/&gt;
   since the last checkpoint in the log file.  Examples of things that cause&lt;br/&gt;
   checkpoints are:&lt;br/&gt;
   o clean shutdown from ij using the &quot;exit&quot; command&lt;br/&gt;
   o clean shutdown of database using the &quot;shutdown=true&quot; url&lt;br/&gt;
   o calling the checkpoint system procedure&lt;br/&gt;
   o generating enough log activity to cause a regularly scheduled checkpoint.&lt;br/&gt;
3) If the conglomerate number of the above described drop table is TABLE_1,&lt;br/&gt;
   then for a problem to occur there must also exist in the database a table&lt;br/&gt;
   such that it&apos;s HEX(TABLE_2) = TABLE_1&lt;br/&gt;
4) Either TABLE_2 must not be accessed during REDO prior to the REDO operation&lt;br/&gt;
   of the drop of TABLE_1 or there must be enough other table references during&lt;br/&gt;
   the REDO phase to push the caching of of the open of TABLE_2 out of cache.&lt;/p&gt;

&lt;p&gt;If all of the above conditions are met then during REDO the system will&lt;br/&gt;
incorrectly delete TABLE_2 while trying to redo the drop of TABLE_1.&lt;br/&gt;
&amp;lt;p&amp;gt;&lt;br/&gt;
I will be adding the following test to reproduce the problem:&lt;br/&gt;
1) create 500 tables, need enough tables to insure that conglomerate number&lt;br/&gt;
   2080 (c820.dat) and 8320 (c2080.dat) exist.&lt;br/&gt;
2) checkpoint the database so that create does not happen during REDO&lt;br/&gt;
3) drop table with conglomerate number 2080, mapping to c820.dat.  It looks&lt;br/&gt;
   it up in the catalog in case conglomerate number assignment changes for&lt;br/&gt;
   some reason.&lt;br/&gt;
4) exit the database without a clean shudown, this is the default for test&lt;br/&gt;
   suites which run multiple tests in a single db - no clean shutdown is done.&lt;br/&gt;
   Since we only do a single drop since the last checkpoint, test will cause&lt;br/&gt;
   the drop during the subsequent REDO.&lt;br/&gt;
5) run next test program dropcrash2, which will cause redo of the drop.  At&lt;br/&gt;
   this point the bug will cause file c2080.dat to be incorrectly deleted and&lt;br/&gt;
   thus accesses to conglomerate 8320 will throw container does not exist&lt;br/&gt;
   errors.&lt;br/&gt;
6) check the consistency of the database which will find the container does&lt;br/&gt;
   not exist error.&lt;/p&gt;</description>
                <environment>jvm/os/filesystem where file names are case insensitive such that delete of C2080.dat will remove c2080.dat if it exists.</environment>
        <key id="12325145">DERBY-662</key>
            <summary>during crash recovery of a drop table, on case insensitive files systems derby may delete wrong file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikem">Mike Matrigali</assignee>
                                    <reporter username="mikem">Mike Matrigali</reporter>
                        <labels>
                    </labels>
                <created>Sun, 30 Oct 2005 00:19:13 +0100</created>
                <updated>Wed, 12 Jul 2006 04:24:14 +0100</updated>
                            <resolved>Wed, 23 Nov 2005 04:01:31 +0000</resolved>
                                    <version>10.0.2.0</version>
                    <version>10.1.2.1</version>
                                    <fixVersion>10.0.2.2</fixVersion>
                    <fixVersion>10.1.2.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12356270" author="mikem" created="Sun, 30 Oct 2005 00:21:12 +0100"  >&lt;p&gt;I will be submitting a fix shortly, it took me a lot longer to figure out the scenario to cause the bug than the fix.  The problem is a rarely used  path through store that does not do the conglomerate number to hex  conversion.&lt;/p&gt;</comment>
                            <comment id="12356301" author="mikem" created="Sun, 30 Oct 2005 09:51:48 +0000"  >&lt;p&gt;patch file for fix to trunk&lt;/p&gt;</comment>
                            <comment id="12356375" author="mikem" created="Mon, 31 Oct 2005 13:36:50 +0000"  >&lt;p&gt;merged fix from trunk to 10.1 branch with svn 329733. &lt;/p&gt;</comment>
                            <comment id="12356664" author="kmarsden" created="Thu, 3 Nov 2005 06:55:48 +0000"  >&lt;p&gt;reopenning to update fixin&lt;/p&gt;</comment>
                            <comment id="12356665" author="kmarsden" created="Thu, 3 Nov 2005 06:56:36 +0000"  >&lt;p&gt;This was actually fixed after the version was bumped to 10.1.2.1. Updating fixin&lt;/p&gt;</comment>
                            <comment id="12358276" author="mikem" created="Wed, 23 Nov 2005 03:43:35 +0000"  >&lt;p&gt;merging fix into 10.0&lt;/p&gt;</comment>
                            <comment id="12358281" author="mikem" created="Wed, 23 Nov 2005 04:01:31 +0000"  >&lt;p&gt;committed patch to 10.0 line with svn  348213&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12320399" name="dropcrash.diff" size="14437" author="mikem" created="Sun, 30 Oct 2005 09:51:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Nov 2005 06:55:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22081</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy15h3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40537</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>