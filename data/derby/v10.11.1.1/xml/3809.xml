<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:19:18 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3809/DERBY-3809.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3809] Add a SHOW FUNCTIONS command to ij</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3809</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Currently, the ij SHOW command can give you information on a number of schema objects, including procedures. It should be fairly easy to add SHOW FUNCTIONS as well. This request surfaced on the user list: &lt;a href=&quot;http://www.nabble.com/How-can-i-see-my-self-defined-functions--td18773980.html#a18773980&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/How-can-i-see-my-self-defined-functions--td18773980.html#a18773980&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12401491">DERBY-3809</key>
            <summary>Add a SHOW FUNCTIONS command to ij</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sleroux">Sylvain Leroux</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Aug 2008 14:30:20 +0100</created>
                <updated>Thu, 2 May 2013 03:29:22 +0100</updated>
                            <resolved>Mon, 16 Nov 2009 09:08:33 +0000</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12625984" author="thinkallday" created="Wed, 27 Aug 2008 07:34:02 +0100"  >&lt;p&gt;I&apos;m sorry to not resolve this problem. I have do some hacking, but have not gotten what I expected.  Considering I&apos;m not free recently, I reassign the issue.&lt;/p&gt;</comment>
                            <comment id="12638889" author="kevinmowry" created="Sun, 12 Oct 2008 20:49:36 +0100"  >&lt;p&gt;Hello, I was planning on undertaking this task as part of a project in my DataBase System Implementation course and was looking for a few tips, possibly. Maybe just a reference location for where I should look for the commands available to the IJ tool. Thank you for any tips or guidance.&lt;/p&gt;</comment>
                            <comment id="12639039" author="rhillegas" created="Mon, 13 Oct 2008 13:52:09 +0100"  >&lt;p&gt;Hi Kevin,&lt;/p&gt;

&lt;p&gt;Thanks for your interest in this issue. A good place to start would be to look at the enabled-roles-3.diff patch which Dag attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3886&quot; title=&quot;SQL roles: ij show enabled and settable roles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3886&quot;&gt;&lt;del&gt;DERBY-3886&lt;/del&gt;&lt;/a&gt;. In that patch, Dag added 2 new ij SHOW commands for displaying information about ROLES. The patch steps you through all of the work which you need to do to add a new ij command, from adding your new command to the ij grammar in ij.jj all the way through to writing a regression test to verify that your command works. I would recommend starting in the ij.jj grammar and follow what Dag did for SHOW SETTABLE ROLES.&lt;/p&gt;</comment>
                            <comment id="12759285" author="sleroux" created="Thu, 24 Sep 2009 23:04:36 +0100"  >&lt;p&gt;Hi there,&lt;/p&gt;

&lt;p&gt;I&apos;d looked at enabled-roles-3.diff. The code doesn&apos;t seem to be too frightening. So, if this issue is still open, I&apos;ll be happy to work on it.&lt;/p&gt;

&lt;p&gt;Sylvain&lt;/p&gt;</comment>
                            <comment id="12759462" author="knutanders" created="Fri, 25 Sep 2009 10:40:08 +0100"  >&lt;p&gt;Hi Sylvain,&lt;/p&gt;

&lt;p&gt;Thanks for volunteering to work on this issue. I have added you to the derby-developers group in JIRA, so you should now be able to assign this issue to yourself. The wiki contains some useful information for new contributors: &lt;a href=&quot;http://wiki.apache.org/db-derby/DerbyDev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/DerbyDev&lt;/a&gt;. You&apos;ll probably need to fill out the ICLA form and send it to Apache for this contribution. Since it usually takes a while for the ICLA to be recorded, it&apos;s best if you do this as soon as possible. You&apos;ll find a link to the ICLA on the wiki.&lt;/p&gt;</comment>
                            <comment id="12759476" author="sleroux" created="Fri, 25 Sep 2009 11:13:35 +0100"  >&lt;p&gt;Thanks Knut,&lt;/p&gt;

&lt;p&gt;I send the ICLA as soon as possible.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Here is a first work on this issue.&lt;/p&gt;

&lt;p&gt;I&apos;ve  changed the ij grammar to add the following commands:&lt;br/&gt;
SHOW FUNCTIONS;&lt;br/&gt;
SHOW FUNCTIONS IN &amp;lt;schema&amp;gt;&lt;/p&gt;

&lt;p&gt;This has required to add the new FUNCTIONS token. &lt;/p&gt;

&lt;p&gt;Concerning the Java method &quot;ijResult showFunctions(String schema) throws SQLException&quot;, the request was borrowed from &lt;a href=&quot;http://www.nabble.com/Re%3A-How-can-i-see-my-self-defined-functions--p18774587.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/Re%3A-How-can-i-see-my-self-defined-functions--p18774587.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Despite the fact the parser only allows an identifier in the &quot;IN&quot; clause, I assume I should somehow escape the schema name. But I don&apos;t really know how to do that. Using a prepared statement seems to be a little bit excessive, isn&apos;t it?&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;At this point, I&apos;m having hard time running the test suites (most of the tests failed when using &quot;ant junit-all&quot;. I will check my configuration in order to find why).&lt;/p&gt;


&lt;p&gt;Sylvain&lt;/p&gt;</comment>
                            <comment id="12759493" author="knutanders" created="Fri, 25 Sep 2009 12:33:03 +0100"  >&lt;p&gt;Escaping the schema name sounds like a good idea, since we may make the syntax more liberal later. There&apos;s a method called IdUtil.normalToDelimited() that does this in the embedded driver. Unfortunately, this code cannot be called from ij, since derby.jar is not guaranteed to be on the classpath, but you can look at the method to see how to escape the identifier. Using a prepared statement sounds simpler and cleaner, though, so I think I would have preferred that.&lt;/p&gt;

&lt;p&gt;One minor issue with the patch: Derby&apos;s code uses tab size 4. The patch uses spaces for indentation, which is fine, but to match the surrounding code, it should use four spaces for each indentation level, not eight.&lt;/p&gt;

&lt;p&gt;By the way, JDBC 4.0 has a method in DatabaseMetaData called getFunctions() which is similar to the getProcedures() method used by SHOW PROCEDURES. This method is implemented in Derby&apos;s JDBC 3.0 drivers too, so we may consider using that method instead of querying the system tables directly. The benefit of using getFunctions() is that it will be more portable and work against other databases that have implemented that meta-data call. Since ij is compiled against the JDBC 3.0 libraries, we will need to use reflection to call it. I think it would be something along these lines:&lt;/p&gt;

&lt;p&gt;DatabaseMetaData dbmd = theConnection.getMetaData();&lt;br/&gt;
Method getFuncs;&lt;br/&gt;
try &lt;/p&gt;
{
    getFuncs = dbmd.getClass().getMethod(&quot;getFunctions&quot;, ...);
}
&lt;p&gt; catch (NoSuchMethodException nsme) &lt;/p&gt;
{
    throw new ijException.notAvailableForDriver(...);
}
&lt;p&gt;ResultSet rs = (ResultSet) getFuncs.invoke(dbmd, ...);&lt;/p&gt;</comment>
                            <comment id="12760231" author="sleroux" created="Mon, 28 Sep 2009 13:26:52 +0100"  >&lt;p&gt;Here is a new version of the patch.&lt;/p&gt;

&lt;p&gt;As you suggested, I used Java reflection to call the getFunctions method. As a side effect, I no longer need to escape the schema name.&lt;/p&gt;

&lt;p&gt;Concerning unit tests, I&apos;m not quite sure of myself: I add some lines to ij7.sql and ij7.out. It appears to do the job, but I don&apos;t know if this is enough.&lt;br/&gt;
On that matter, after I have changed the help message in toolsmessages.properties, I noticed all tests in org.apache.derbyTesting.functionTests.tests.tools._Suite still pass. Even before updating ij.out (whose last test check this help message) ???&lt;/p&gt;

&lt;p&gt;Finally, note that I use wider columns for the result set than showProcedures. I think those are are far too narrow, especially for the &quot;REMARKS&quot; column. As you will notice in the following example, the Java class name are truncated. So the result is not that useful.&lt;br/&gt;
ij&amp;gt; SHOW PROCEDURES IN SQLJ;&lt;br/&gt;
PROCEDURE_SCHEM     |PROCEDURE_NAME                |REMARKS             &lt;br/&gt;
------------------------------------------------------------------------&lt;br/&gt;
SQLJ                |INSTALL_JAR                   |org.apache.derby.ca&amp;amp;&lt;br/&gt;
SQLJ                |REMOVE_JAR                    |org.apache.derby.ca&amp;amp;&lt;br/&gt;
SQLJ                |REPLACE_JAR                   |org.apache.derby.ca&amp;amp;&lt;/p&gt;

&lt;p&gt;On the other hand, from the user point of view, I think that both showProcedures and showFunctions should produce a similar display. So I should normalize that one side or the other...&lt;/p&gt;

&lt;p&gt;Sylvain.&lt;/p&gt;</comment>
                            <comment id="12760270" author="knutanders" created="Mon, 28 Sep 2009 16:16:05 +0100"  >&lt;p&gt;Thanks for the new patch.&lt;/p&gt;

&lt;p&gt;The ij.sql test has not been converted to the JUnit harness yet, so it only runs as part of the old regression test suite (derbyall). To run the test, you could try one of these commands (you&apos;ll need jakarta-oro-2.0.8.jar in the classpath in addition to the jar files you need when you run the JUnit tests):&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Single test: java org.apache.derbyTesting.functionTests.harness.RunTest tools/ij.sql&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All tools tests: java org.apache.derbyTesting.functionTests.harness.RunSuite derbytools&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All tests in the old harness: java org.apache.derbyTesting.functionTests.harness.RunSuite derbyall&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;As to the column widths, I think SHOW PROCEDURES tried to make them fit in a standard terminal window (max 80 chars). But I kind of agree that having columns so narrow that they don&apos;t show the useful information doesn&apos;t make much sense.&lt;/p&gt;

&lt;p&gt;I&apos;m wondering about the code that catches InvocationTargetException, if it should re-throw the underlying exception instead of throwing notAvailableForDriver(). I think the ITE will be thrown only if getFunctions() raises an SQLException, which indicates that some database failure occurred, and not that the driver doesn&apos;t support the call.&lt;/p&gt;

&lt;p&gt;For completeness, perhaps we should also have a test case for &quot;SHOW FUNCTIONS&quot; without the &quot;IN &amp;lt;SCHEMA&amp;gt;&quot; clause.&lt;/p&gt;</comment>
                            <comment id="12761299" author="sleroux" created="Thu, 1 Oct 2009 19:49:41 +0100"  >&lt;p&gt;This time, I tried to narrow the result columns as much as possible to fit in 80 columns wide terminal. Giving as much space as possible to the REMARKS columns. This is better than the result of SHOW PROCEDURE I think, but class names are still truncated. &lt;/p&gt;

&lt;p&gt;Concerning InvocationTargetException of course you were right: I now re-throw the underlying exception.&lt;/p&gt;

&lt;p&gt;I add as test case for SHOW FUNCTIONS without an IN SCHEMA clause. Both JUnit and old tests pass well.&lt;/p&gt;</comment>
                            <comment id="12761507" author="knutanders" created="Fri, 2 Oct 2009 09:31:28 +0100"  >&lt;p&gt;Thanks! The patch looks good to me. I intend to commit it when your ICLA has been recorded here: &lt;a href=&quot;http://people.apache.org/~jim/committers.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~jim/committers.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve verified that it works fine with Java 1.4.2, both on with the embedded driver and the client driver, so the reflection does the trick on the JDBC 3.0 drivers. It also appears to work with MySQL&apos;s JDBC driver. The column widths looked fine too.&lt;/p&gt;</comment>
                            <comment id="12764640" author="sleroux" created="Mon, 12 Oct 2009 11:13:53 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I didn&apos;t have much time these weeks to deal with that, but since I still don&apos;t appear in the contributors list, I send a mail to secretary@ in order to know what&apos;s going on.&lt;/p&gt;

&lt;p&gt;By the way, I would like to thank you again Knut for your help during the process of submitting this patch. I&apos;m looking forward to work again on Derby, as soon I&apos;ll have more time - and that ICLA will be registered!&lt;/p&gt;

&lt;p&gt;Sylvain&lt;/p&gt;</comment>
                            <comment id="12768826" author="sleroux" created="Thu, 22 Oct 2009 20:24:14 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;My ICLA has finally been recorded! So I think all is OK now to commit the patch.&lt;/p&gt;</comment>
                            <comment id="12769126" author="knutanders" created="Fri, 23 Oct 2009 08:40:07 +0100"  >&lt;p&gt;Thanks a lot for working on this, Sylvain!&lt;/p&gt;

&lt;p&gt;I&apos;ve verified that the ICLA was recorded and committed the patch with revision 828950.&lt;/p&gt;

&lt;p&gt;I also added SHOW FUNCTIONS to the 10.6.1 feature list on the wiki: &lt;a href=&quot;http://wiki.apache.org/db-derby/DerbyTenSixOneRelease&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/DerbyTenSixOneRelease&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12777928" author="sleroux" created="Sat, 14 Nov 2009 13:59:38 +0000"  >&lt;p&gt;I re-open this issue due to to a slightly noisy behavior discovered when using SHOW FUNCTION against postgre-8.3:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; SHOW FUNCTIONS;&lt;br/&gt;
JAVA ERROR: java.lang.ClassCastException: java.lang.AbstractMethodError cannot be cast to java.sql.SQLException&lt;/p&gt;

&lt;p&gt;I think any JDBC driver build against JDBC3 but running on JDBC4 will exhibit the same behavior. The only thing I saw right now is to wrap AbstractMethodError in a &quot;notAvailableForDriver&quot; SQLException. &lt;/p&gt;</comment>
                            <comment id="12778009" author="knutanders" created="Sat, 14 Nov 2009 22:36:03 +0000"  >&lt;p&gt;+1. Catching AbstractMethodError and throwing notAvailableForDriver sounds like a reasonable approach.&lt;/p&gt;</comment>
                            <comment id="12778103" author="sleroux" created="Sun, 15 Nov 2009 14:10:50 +0000"  >&lt;p&gt;Surprisingly, it was not that instantaneous!&lt;/p&gt;

&lt;p&gt;AbstractMethodError should be wrapped in a InvocationTargetException. But, according to &lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6531596&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6531596&lt;/a&gt;, with some Sun VM this is not the case.&lt;/p&gt;

&lt;p&gt;So, I wrote the patch defensively against this by catching &quot;direct&quot; AbstractMethodError as well as those wrapped inside an InvocationTargetException.&lt;/p&gt;

&lt;p&gt;While running against Postgre-8.3 I now have the expected behavior:&lt;br/&gt;
ij&amp;gt; DRIVER &apos;org.postgresql.Driver&apos;;&lt;br/&gt;
ij&amp;gt; CONNECT &apos;jdbc:postgresql:ij?user=ij&amp;amp;password=ijpw&apos;;&lt;br/&gt;
ij&amp;gt; SHOW FUNCTIONS;&lt;br/&gt;
ij&amp;gt; IJ ERROR: command not available for this driver: PostgreSQL Native Driver&lt;/p&gt;

&lt;p&gt;Pass ToolScripts without error.&lt;/p&gt;</comment>
                            <comment id="12778270" author="knutanders" created="Mon, 16 Nov 2009 09:08:33 +0000"  >&lt;p&gt;Thanks, Sylvain! I reformatted the comments so the lines didn&apos;t exceed 80 characters, and committed the patch to trunk with revision 880680.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12440801">DERBY-4445</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12425000" name="DERBY-3809.patch" size="1526" author="sleroux" created="Sun, 15 Nov 2009 14:10:50 +0000"/>
                            <attachment id="12420698" name="show-functions-2.diff" size="7642" author="sleroux" created="Mon, 28 Sep 2009 13:26:51 +0100"/>
                            <attachment id="12421043" name="show-functions-3.diff" size="9166" author="sleroux" created="Thu, 1 Oct 2009 19:49:41 +0100"/>
                            <attachment id="12420543" name="show-functions.diff" size="4233" author="sleroux" created="Fri, 25 Sep 2009 11:13:35 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Aug 2008 06:34:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31011</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0phr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37948</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>