<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:13:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6351/DERBY-6351.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6351] Syntax error on equal transition table name and correlation name in statement trigger</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6351</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If a reference to a transition table in a statement trigger has a correlation name, and that correlation name is equal to the name of the transition table, the CREATE TRIGGER statement fails with a syntax error.&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ij version 10.10
ij&amp;gt; connect &apos;jdbc:derby:db;create=true&apos;;
ij&amp;gt; create table t1(x int);
0 rows inserted/updated/deleted
ij&amp;gt; create table t2(x int);
0 rows inserted/updated/deleted
ij&amp;gt; create trigger tr1 after insert on t1 referencing new table as n insert into t2 select x from n as n;
ERROR 42X01: Syntax error: Encountered &quot;as&quot; at line 1, column 89.
Issue the &apos;help&apos; command for general information on IJ command syntax.
Any unrecognized commands are treated as potential SQL commands and executed directly.
Consult your DBMS server reference documentation for details of the SQL syntax supported by your server.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12670239">DERBY-6351</key>
            <summary>Syntax error on equal transition table name and correlation name in statement trigger</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Sep 2013 11:13:22 +0100</created>
                <updated>Wed, 21 Jan 2015 00:23:50 +0000</updated>
                            <resolved>Thu, 26 Sep 2013 10:32:02 +0100</resolved>
                                    <version>10.4.1.3</version>
                    <version>10.5.1.1</version>
                    <version>10.6.1.0</version>
                    <version>10.7.1.1</version>
                    <version>10.8.1.2</version>
                    <version>10.9.1.0</version>
                    <version>10.10.1.1</version>
                                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13776178" author="knutanders" created="Tue, 24 Sep 2013 11:28:31 +0100"  >&lt;p&gt;The bug is caused by a flaw in the code that transforms the trigger action text for statement triggers and replaces references to transition tables with references to VTIs (org.apache.derby.catalog.TriggerOldTransitionRows and org.apache.derby.catalog.TriggerNewTransitionRows).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;CreateTriggerNode.bindReferencesClause()&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
				/*
				** If the user supplied a correlation, then just
				** pick it up automatically; otherwise, supply
				** the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.
				*/
				&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (refTableName.equals(baseTableName))
				{
					newText.append(baseTableName).append(&lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;);
				}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This code is supposed to add a correlation name to the transformed SQL text only if no correlation name is specified in the original SQL text. However, it does not distinguish between the case where no correlation name is specified and the case where the correlation name is equal to the base table name. If a correlation name equal to the base table name is specified, the transformed SQL text ends up with two correlation names for the table, which causes the syntax error.&lt;/p&gt;

&lt;p&gt;In the CREATE TRIGGER statement in the bug description,&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;insert into t2 select x from n as n&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;is rewritten to&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;insert into t2 select x from new org.apache.derby.catalog.TriggerNewTransitionRows() N as n&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;whereas it should have been rewritten to&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;insert into t2 select x from new org.apache.derby.catalog.TriggerNewTransitionRows() as n&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="13776242" author="knutanders" created="Tue, 24 Sep 2013 13:11:26 +0100"  >&lt;p&gt;d6351-1a.diff changes how the transformation code checks if a correlation name has been specified. Instead of checking it indirectly, by seeing if the table name and the base table name are equal, it now checks if getCorrelationName() returns null. This makes it handle the previously failing case correctly.&lt;/p&gt;

&lt;p&gt;The patch also adds a test case that verifies the fix.&lt;/p&gt;

&lt;p&gt;All regression tests ran cleanly.&lt;/p&gt;</comment>
                            <comment id="13778555" author="jira-bot" created="Thu, 26 Sep 2013 08:48:08 +0100"  >&lt;p&gt;Commit 1526406 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1526406&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1526406&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6351&quot; title=&quot;Syntax error on equal transition table name and correlation name in statement trigger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6351&quot;&gt;&lt;del&gt;DERBY-6351&lt;/del&gt;&lt;/a&gt;: Syntax error on equal transition table name and correlation name in statement trigger&lt;/p&gt;

&lt;p&gt;Change how CreateTriggerNode.bindReferencesClause() checks for the&lt;br/&gt;
lack of a correlation name. Instead of checking it indirectly (and&lt;br/&gt;
unreliably) by seeing if the table name matches the base table name,&lt;br/&gt;
check directly if the correlation name is null.&lt;/p&gt;</comment>
                            <comment id="13778603" author="jira-bot" created="Thu, 26 Sep 2013 10:31:45 +0100"  >&lt;p&gt;Commit 1526429 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1526429&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1526429&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6351&quot; title=&quot;Syntax error on equal transition table name and correlation name in statement trigger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6351&quot;&gt;&lt;del&gt;DERBY-6351&lt;/del&gt;&lt;/a&gt;: Syntax error on equal transition table name and correlation name in statement trigger&lt;/p&gt;

&lt;p&gt;Merged revision 1526406 from trunk.&lt;/p&gt;</comment>
                            <comment id="14284870" author="myrna" created="Wed, 21 Jan 2015 00:23:50 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12604786" name="d6351-1a.diff" size="4869" author="knutanders" created="Tue, 24 Sep 2013 13:11:26 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 26 Sep 2013 07:48:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>350068</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzi7d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>350362</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>