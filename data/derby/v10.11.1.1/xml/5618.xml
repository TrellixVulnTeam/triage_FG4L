<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:12:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5618/DERBY-5618.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5618] On Windows, orderly engine shutdown does not release the file handle on a jar file containing a database which was booted using the classpath subprotocol</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5618</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Boot a database in a jar file, using the classpath subprotocol, then shutdown the engine. This leaves the jar file still open on Windows. However, orderly engine shutdown correctly releases the file if you boot it using the jar subprotocol instead. I will attach a repro.&lt;/p&gt;</description>
                <environment>xp professional 5.1, oracle java 6, derby 10.9 trunk</environment>
        <key id="12542684">DERBY-5618</key>
            <summary>On Windows, orderly engine shutdown does not release the file handle on a jar file containing a database which was booted using the classpath subprotocol</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                            <label>derby_triage10_11</label>
                    </labels>
                <created>Wed, 15 Feb 2012 14:18:07 +0000</created>
                <updated>Wed, 21 Jan 2015 00:23:03 +0000</updated>
                            <resolved>Thu, 27 Mar 2014 08:55:18 +0000</resolved>
                                    <version>10.9.1.0</version>
                                                    <component>Services</component>
                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13208496" author="rhillegas" created="Wed, 15 Feb 2012 14:22:05 +0000"  >&lt;p&gt;Attaching a repro for this problem:&lt;/p&gt;

&lt;p&gt;1) FileUtils.java - A set of routines to perform file operations. These operations are used by the following script.&lt;/p&gt;

&lt;p&gt;2) 5618.sql - A script that shows the problem.&lt;/p&gt;

&lt;p&gt;Just compile FileUtils and put it on your classpath. Then run the script through ij.&lt;/p&gt;</comment>
                            <comment id="13208498" author="rhillegas" created="Wed, 15 Feb 2012 14:26:08 +0000"  >&lt;p&gt;Linking this issue to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-866&quot; title=&quot;Derby User Management Enhancements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-866&quot;&gt;&lt;del&gt;DERBY-866&lt;/del&gt;&lt;/a&gt;. This problem was discovered while writing tests for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-866&quot; title=&quot;Derby User Management Enhancements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-866&quot;&gt;&lt;del&gt;DERBY-866&lt;/del&gt;&lt;/a&gt;. A test case will have to be disabled on Windows until this bug is fixed. At that point, we should revisit the disabled test.&lt;/p&gt;</comment>
                            <comment id="13208536" author="kristwaa" created="Wed, 15 Feb 2012 15:19:45 +0000"  >&lt;p&gt;For clarity only, I assume the jar file is left open on other platforms than Windows too, but that on those other platforms you can write to the file even if another process has a file handle to it?&lt;/p&gt;</comment>
                            <comment id="13208553" author="rhillegas" created="Wed, 15 Feb 2012 16:09:04 +0000"  >&lt;p&gt;Hi Kristian,&lt;/p&gt;

&lt;p&gt;That is a good point. The file handle is probably still open on *nix platforms too. It&apos;s just that we notice the orphaned file handle on Windows. Note that in the repro, the same process runs the engine, shuts it down, and then tries to delete the jar file. Thanks.&lt;/p&gt;</comment>
                            <comment id="13212193" author="mikem" created="Mon, 20 Feb 2012 22:56:51 +0000"  >&lt;p&gt;10.9 triage &lt;br/&gt;
has a repro and is tests are disabled because of it, so would be nice to fix.  &lt;/p&gt;

&lt;p&gt;I don&apos;t know much about jar file databases.  Is derby meant to support booting from a jar file using &lt;br/&gt;
using the classpath subprotocol, or should one always use the jar subprotocol.&lt;/p&gt;</comment>
                            <comment id="13217194" author="rhillegas" created="Mon, 27 Feb 2012 13:54:40 +0000"  >&lt;p&gt;Hi Mike,&lt;/p&gt;

&lt;p&gt;I also am not an expert on accessing databases via the classpath subprotocol. However, the Developer&apos;s Guide says this in the section titled &quot;Accessing databases from the classpath&quot;:&lt;/p&gt;

&lt;p&gt;&quot;In most cases, you access databases from the file system. However, it is also possible to access databases from the classpath. The databases can be archived into a jar or zip file or left as is.&lt;/p&gt;

&lt;p&gt;All such databases are read-only.&lt;/p&gt;

&lt;p&gt;To access an unarchived database from the classpath, specify the name of the database relative to the directory in the classpath. You can use the classpath subprotocol if such a database is ambiguous within the directory system.&quot;&lt;/p&gt;</comment>
                            <comment id="13944959" author="knutanders" created="Mon, 24 Mar 2014 12:15:00 +0000"  >&lt;p&gt;This might be a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2162&quot; title=&quot;Shutting down a database loaded from a jar file via the classpath and URLClassLoader  leaves an open file reference to the jar file containing the database.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2162&quot;&gt;&lt;del&gt;DERBY-2162&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13949036" author="jira-bot" created="Thu, 27 Mar 2014 08:40:11 +0000"  >&lt;p&gt;Commit 1582220 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1582220&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1582220&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2162&quot; title=&quot;Shutting down a database loaded from a jar file via the classpath and URLClassLoader  leaves an open file reference to the jar file containing the database.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2162&quot;&gt;&lt;del&gt;DERBY-2162&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5618&quot; title=&quot;On Windows, orderly engine shutdown does not release the file handle on a jar file containing a database which was booted using the classpath subprotocol&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5618&quot;&gt;&lt;del&gt;DERBY-5618&lt;/del&gt;&lt;/a&gt;: Close the URLClassLoader when tests are done&lt;br/&gt;
with it so that file handles are freed and the jar files can be&lt;br/&gt;
deleted.&lt;/p&gt;</comment>
                            <comment id="13949049" author="knutanders" created="Thu, 27 Mar 2014 08:55:18 +0000"  >&lt;p&gt;The test cases that previously were disabled because of this bug, have now been enabled by the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2162&quot; title=&quot;Shutting down a database loaded from a jar file via the classpath and URLClassLoader  leaves an open file reference to the jar file containing the database.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2162&quot;&gt;&lt;del&gt;DERBY-2162&lt;/del&gt;&lt;/a&gt;, so I&apos;m resolving this issue as a duplicate.&lt;/p&gt;

&lt;p&gt;The repro attached to this issue still fails, but I believe that&apos;s expected since the URLClassLoader that references the jar file is still the context class loader of the main thread and open after the engine shutdown. As noted in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2162&quot; title=&quot;Shutting down a database loaded from a jar file via the classpath and URLClassLoader  leaves an open file reference to the jar file containing the database.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2162&quot;&gt;&lt;del&gt;DERBY-2162&lt;/del&gt;&lt;/a&gt;, Derby cannot close the application&apos;s class loaders at shutdown, since it cannot tell if the application will need them again, so it has to be the application&apos;s responsibility to close them down when they are no longer needed.&lt;/p&gt;</comment>
                            <comment id="14284737" author="myrna" created="Wed, 21 Jan 2015 00:23:03 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12358047">DERBY-2162</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12328052">DERBY-866</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12514643" name="5618.sql" size="1469" author="rhillegas" created="Wed, 15 Feb 2012 14:22:05 +0000"/>
                            <attachment id="12514642" name="FileUtils.java" size="4677" author="rhillegas" created="Wed, 15 Feb 2012 14:22:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 15 Feb 2012 15:19:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>227970</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0cvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35905</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>