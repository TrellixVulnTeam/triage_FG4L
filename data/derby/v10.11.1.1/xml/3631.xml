<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:45:17 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3631/DERBY-3631.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3631] UDF used with aggregate arguments results in error 30000</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3631</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;UDF used with aggregate arguments results in error 30000: The SELECT list of a grouped query contains at least one invalid expression. &lt;br/&gt;
CREATE FUNCTION MAXOF2(ONE DOUBLE, TWO DOUBLE) RETURNS DOUBLE &lt;br/&gt;
PARAMETER STYLE JAVA NO SQL LANGUAGE JAVA&lt;br/&gt;
EXTERNAL NAME &apos;java.lang.Math.max&apos;&lt;/p&gt;

&lt;p&gt;CREATE TABLE Test( GroupCol INT, Value1 INT, Value2 INT )&lt;br/&gt;
INSERT INTO Test VALUES (1, 1, 5)&lt;br/&gt;
INSERT INTO Test VALUES (2, -7, 2)&lt;br/&gt;
INSERT INTO Test VALUES (2, 1, -5)&lt;/p&gt;

&lt;p&gt;Using a built in function works:&lt;br/&gt;
SELECT GroupCol, MOD(SUM(Value1), SUM(Value2)) AS ModOf2 FROM Test GROUP BY GroupCol&lt;/p&gt;

&lt;p&gt;But using the UDF does not:&lt;br/&gt;
Both&lt;br/&gt;
SELECT GroupCol, MAXOF2(CAST(SUM(Value1) AS DOUBLE), CAST(SUM(Value2) AS DOUBLE)) AS MaxOf2 FROM Test GROUP BY GroupCol&lt;/p&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;SELECT GroupCol, MAXOF2(SUM(Value1), SUM(Value2)) AS MaxOf2 FROM Test GROUP BY GroupCol&lt;br/&gt;
fail&lt;/p&gt;
</description>
                <environment>Linux, Derby-10.3.2.1</environment>
        <key id="12394291">DERBY-3631</key>
            <summary>UDF used with aggregate arguments results in error 30000</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="donaldmunro">Donald Munro</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Apr 2008 10:52:24 +0100</created>
                <updated>Fri, 21 Jan 2011 17:51:54 +0000</updated>
                            <resolved>Wed, 19 Nov 2008 17:31:54 +0000</resolved>
                                    <version>10.3.2.1</version>
                                    <fixVersion>10.3.3.0</fixVersion>
                    <fixVersion>10.4.1.3</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12590436" author="rhillegas" created="Fri, 18 Apr 2008 14:07:35 +0100"  >&lt;p&gt;Thanks for finding this bug, Donald. I have verified it. As a workaround, you can put the aggregates in a view and invoke your user function on the view. E.g.:&lt;/p&gt;

&lt;p&gt;DROP FUNCTION MAXOF2;&lt;br/&gt;
DROP VIEW V;&lt;br/&gt;
DROP TABLE TEST;&lt;/p&gt;

&lt;p&gt;CREATE FUNCTION MAXOF2(ONE DOUBLE, TWO DOUBLE) RETURNS DOUBLE&lt;br/&gt;
PARAMETER STYLE JAVA NO SQL LANGUAGE JAVA&lt;br/&gt;
EXTERNAL NAME &apos;java.lang.Math.max&apos;;&lt;/p&gt;

&lt;p&gt;CREATE TABLE Test( GroupCol INT, Value1 INT, Value2 INT );&lt;br/&gt;
INSERT INTO Test VALUES (1, 1, 5);&lt;br/&gt;
INSERT INTO Test VALUES (2, -7, 2);&lt;br/&gt;
INSERT INTO Test VALUES (2, 1, -5);&lt;/p&gt;

&lt;p&gt;CREATE VIEW V ( GroupCol, a, b )&lt;br/&gt;
AS SELECT GroupCol, SUM(Value1), SUM(Value2) FROM Test GROUP BY GroupCol;&lt;/p&gt;

&lt;p&gt;SELECT GroupCol, MAXOF2( a, b ) as MAXOF2 from v;&lt;/p&gt;</comment>
                            <comment id="12648885" author="kmarsden" created="Wed, 19 Nov 2008 02:21:58 +0000"  >&lt;p&gt;This appears to be fixed with trunk and with 10.3.3.0.  I&apos;ll try to identify what fixed it.&lt;/p&gt;</comment>
                            <comment id="12649094" author="kmarsden" created="Wed, 19 Nov 2008 16:59:06 +0000"  >&lt;p&gt;It looks like this was fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3649&quot; title=&quot;can&amp;#39;t call a stored function with an aggregate argument without getting the following error: ERROR 42Y29&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3649&quot;&gt;&lt;del&gt;DERBY-3649&lt;/del&gt;&lt;/a&gt;, but after backing out that fix, instead of a 30000 exception I get 42Y30:&lt;br/&gt;
ij&amp;gt; SELECT GroupCol, MAXOF2(SUM(Value1), SUM(Value2)) AS MaxOf2 FROM Test GROUP BY GroupCol;&lt;br/&gt;
ERROR 42Y30: The SELECT list of a grouped query contains at least one invalid expression. If a SELECT list has a GROUP B&lt;br/&gt;
Y, the list may only contain valid grouping expressions and valid aggregate expressions.&lt;/p&gt;

&lt;p&gt;I went back to 10.3.2.1 against which the bug was reported and saw 42Y30 as well, so I will add a test and resolve this as a dup of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3649&quot; title=&quot;can&amp;#39;t call a stored function with an aggregate argument without getting the following error: ERROR 42Y29&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3649&quot;&gt;&lt;del&gt;DERBY-3649&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;
</comment>
                            <comment id="12649108" author="kmarsden" created="Wed, 19 Nov 2008 17:31:54 +0000"  >&lt;p&gt;Resolving as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3649&quot; title=&quot;can&amp;#39;t call a stored function with an aggregate argument without getting the following error: ERROR 42Y29&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3649&quot;&gt;&lt;del&gt;DERBY-3649&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12683488" author="dagw" created="Thu, 19 Mar 2009 15:38:06 +0000"  >&lt;p&gt;When backporting &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4071&quot; title=&quot;AssertFailure when selecting rows from a table with CHARACTER and VARCHAR columns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4071&quot;&gt;&lt;del&gt;DERBY-4071&lt;/del&gt;&lt;/a&gt; to the 10.4 branch, I noticed that a test case labelled 3631 (this issue) is present on trunk (svn 719015),&lt;br/&gt;
but not on 10.4. This issue is marked as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3649&quot; title=&quot;can&amp;#39;t call a stored function with an aggregate argument without getting the following error: ERROR 42Y29&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3649&quot;&gt;&lt;del&gt;DERBY-3649&lt;/del&gt;&lt;/a&gt;, which does have patches backported to 10.4.&lt;br/&gt;
Not sure if this is intentional, just though I&apos;d mention it.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12394939">DERBY-3649</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Apr 2008 13:07:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23756</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0lfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37290</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>