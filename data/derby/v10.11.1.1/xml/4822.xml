<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:11:08 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4822/DERBY-4822.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4822] DropSchemaConstantAction: could reuse the current connection provided by the available activation object</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4822</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In DropSchemaConstantAction.executeConstantAction, getSchemaDescriptor is called with a null parameter. Instead, one could reuse the current transaction controller directly available with &quot;activation.getLanguageConnectionContext().getTransactionExecute()&quot; as it&apos;s done with other subclasses of DDLConstantAction. &lt;/p&gt;

&lt;p&gt;Regards, --Martin&lt;/p&gt;

&lt;p&gt;Index: java/engine/org/apache/derby/impl/sql/execute/DropSchemaConstantAction.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; java/engine/org/apache/derby/impl/sql/execute/DropSchemaConstantAction.java (revision 1001658)&lt;br/&gt;
+++ java/engine/org/apache/derby/impl/sql/execute/DropSchemaConstantAction.java (working copy)&lt;br/&gt;
@@ -27,6 +27,7 @@&lt;br/&gt;
 import org.apache.derby.iapi.sql.dictionary.DataDictionary;&lt;br/&gt;
 import org.apache.derby.iapi.sql.dictionary.SchemaDescriptor;&lt;br/&gt;
 import org.apache.derby.iapi.sql.execute.ConstantAction;&lt;br/&gt;
+import org.apache.derby.iapi.store.access.TransactionController;&lt;/p&gt;

&lt;p&gt; /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This class  describes actions that are ALWAYS performed for a&lt;br/&gt;
@@ -82,6 +83,7 @@&lt;br/&gt;
        {&lt;br/&gt;
                LanguageConnectionContext lcc = activation.getLanguageConnectionContext();&lt;br/&gt;
                DataDictionary dd = lcc.getDataDictionary();&lt;br/&gt;
+               TransactionController tc = lcc.getTransactionExecute();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                /*&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;Inform the data dictionary that we are about to write to it.&lt;br/&gt;
@@ -94,7 +96,7 @@&lt;br/&gt;
                */&lt;br/&gt;
                dd.startWriting(lcc);&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SchemaDescriptor sd = dd.getSchemaDescriptor(schemaName, null, true);&lt;br/&gt;
+        SchemaDescriptor sd = dd.getSchemaDescriptor(schemaName, tc, true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         sd.drop(lcc, activation);&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475302">DERBY-4822</key>
            <summary>DropSchemaConstantAction: could reuse the current connection provided by the available activation object</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="monperrus">Martin Monperrus</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Sep 2010 14:26:14 +0100</created>
                <updated>Mon, 17 Jun 2013 10:19:16 +0100</updated>
                            <resolved>Mon, 18 Oct 2010 15:52:51 +0100</resolved>
                                    <version>10.7.1.1</version>
                                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12917898" author="monperrus" created="Tue, 5 Oct 2010 09:23:52 +0100"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Is the patch correct?&lt;/p&gt;

&lt;p&gt;Thanks, --Martin&lt;/p&gt;
</comment>
                            <comment id="12917935" author="kristwaa" created="Tue, 5 Oct 2010 11:12:25 +0100"  >&lt;p&gt;Hi Martin,&lt;/p&gt;

&lt;p&gt;Thanks for providing the patch.&lt;br/&gt;
It looks correct, but it&apos;s hard to say without further investigation. I&apos;ll apply the patch and run the tests as a first check.&lt;/p&gt;

&lt;p&gt;The potential difference introduced by the patch, is whether a nested transaction is used or not when accessing the data dictionary. This part of the API is confusing, as reported by Dan in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2490&quot; title=&quot;Clarify transaction management in LanguageConnectionContext.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2490&quot;&gt;DERBY-2490&lt;/a&gt;.&lt;br/&gt;
I&apos;m not 100% sure if it is necessary, but it would be nice if you could attach the patch as a file and tick the box for granting the license to ASF.&lt;/p&gt;


&lt;p&gt;Regards,&lt;/p&gt;</comment>
                            <comment id="12918450" author="kristwaa" created="Wed, 6 Oct 2010 10:51:23 +0100"  >&lt;p&gt;derbyall and suites.All passed without failures with the patch applied.&lt;/p&gt;</comment>
                            <comment id="12918471" author="monperrus" created="Wed, 6 Oct 2010 12:03:13 +0100"  >&lt;p&gt;Hi Kristian,&lt;/p&gt;

&lt;p&gt;Thanks for the answer. Here is the patch as file+license granting. &lt;/p&gt;

&lt;p&gt;--Martin&lt;/p&gt;</comment>
                            <comment id="12918476" author="monperrus" created="Wed, 6 Oct 2010 12:15:16 +0100"  >&lt;p&gt;Hi Kristian, &lt;/p&gt;

&lt;p&gt;Regarding the API and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2490&quot; title=&quot;Clarify transaction management in LanguageConnectionContext.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2490&quot;&gt;DERBY-2490&lt;/a&gt;, I noticed in DataDictionaryImpl that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;some methods require a TransactionController as parameter&lt;/li&gt;
	&lt;li&gt;others use the internal methods getTransactionExecute(), getTransactionCompile() which both use getLCC() internally&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In which case could it be harmful/less efficient to use the default transaction controller provided by getLCC() instead of using the one passed as parameter (if present)?&lt;/p&gt;

&lt;p&gt;Best regards,&lt;/p&gt;

&lt;p&gt;--Martin&lt;/p&gt;

</comment>
                            <comment id="12919273" author="kristwaa" created="Fri, 8 Oct 2010 13:59:36 +0100"  >&lt;p&gt;I don&apos;t think this is about efficiency, but about correctness for a few special cases - where a nested transaction has been created.&lt;br/&gt;
Derby might get into trouble if some of the work is performed using a nested transaction and some by the parent/main transaction. The nested transaction was introduced to be able to commit some work immediately without committing the work done by the parent transaction, or to release locks as early as possible where appropriate. I.e. typically do work with parent tx, do some (short duration) special work with nested tx, commit nested tx, continue with work using the parent tx.&lt;/p&gt;

&lt;p&gt;In terms of code, the difference boils down to the following:&lt;br/&gt;
        return tran;&lt;br/&gt;
  vs&lt;br/&gt;
        return (readOnlyNestedTransaction != null) ? readOnlyNestedTransaction : tran;&lt;/p&gt;

&lt;p&gt;In a scenario as mentioned above, it is important that the correct transaction is being used at all times.&lt;br/&gt;
From what I know about this issue, the patch looks correct - I&apos;m +1 to commit it.&lt;/p&gt;

&lt;p&gt;I will wait for a few more days to see if anyone with more knowledge about this pitches in.&lt;/p&gt;</comment>
                            <comment id="12922090" author="kristwaa" created="Mon, 18 Oct 2010 15:52:37 +0100"  >&lt;p&gt;I committed the patch to trunk with revision 1023824.&lt;/p&gt;

&lt;p&gt;Thanks for providing the patch, Martin &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12928587" author="rhillegas" created="Fri, 5 Nov 2010 13:43:41 +0000"  >&lt;p&gt;Removing the &lt;span class=&quot;error&quot;&gt;&amp;#91;patch&amp;#93;&lt;/span&gt; tag from the issue description. When those square brackets turn up in the release notes they will confuse the Forrest tool which creates a download page from our release notes.&lt;/p&gt;</comment>
                            <comment id="13685181" author="knutanders" created="Mon, 17 Jun 2013 10:19:16 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12456489" name="patch.txt" size="1212" author="monperrus" created="Wed, 6 Oct 2010 12:03:13 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 5 Oct 2010 10:12:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31395</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0oov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37818</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>