<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:14:11 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5292/DERBY-5292.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5292] SQLAuthorisation and views</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5292</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;in some cases there seem to be issues with SQLAuthorisation in conjunction with database VIEWS.&lt;br/&gt;
Please see attached files as repro (script.txt has only the SQL I executed, output is the output resulting when running the script). &lt;br/&gt;
I would think identical results should be returned in all cases and independent on how the view has been defined, but this to my surprise not being the case:&lt;/p&gt;

&lt;p&gt;1) Trying to select from view appl.&quot;VW_MyTasks&quot; - which is a simple view defined on just one table - leads to expected results, i.e. &quot;my&quot; tasks are being returned.&lt;br/&gt;
2) Trying to select from view appl.&quot;VW_MyPriorityTasks - which is a view defined on two joined tables without using an inner join clause - leads to expected results, i.e. &quot;my&quot; priority tasks are being returned.&lt;br/&gt;
3) Trying to select from view appl.&quot;VW2_MyPriorityTasks - which is the same view but now the two tables joined using an inner join clause - leads to an error and no tasks returned (when the same results as in 2) above were expected).&lt;br/&gt;
4) Trying to select from view appl.&quot;VW3_MyPriorityTasks&quot; - which is a view defined using a subselect - also unexpectedly leads to an error.&lt;/p&gt;

&lt;p&gt;Note: While I could rewrite each inner join clause with changing the syntax like in 2) above, this provides a simple work-around for such cases. May be there is a work-around for subselects also (not sure if every subselect could be rewritten to a join?). However when depending on using EXISTS constructs in the query there unfortunately is no way (I would know of) to get around this problem. Unfortuanetly a view that makes use of EXISTS is also one I would need to define in my data base...&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</description>
                <environment>windows xp</environment>
        <key id="12511260">DERBY-5292</key>
            <summary>SQLAuthorisation and views</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="thomashill">Thomas Hill</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Jun 2011 18:05:41 +0100</created>
                <updated>Mon, 17 Jun 2013 10:19:26 +0100</updated>
                            <resolved>Mon, 4 Jul 2011 12:58:58 +0100</resolved>
                                    <version>10.2.1.6</version>
                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                    <version>10.3.2.1</version>
                    <version>10.3.3.0</version>
                    <version>10.4.1.3</version>
                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                    <version>10.5.2.0</version>
                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                    <version>10.6.2.1</version>
                    <version>10.7.1.1</version>
                    <version>10.8.1.2</version>
                                    <fixVersion>10.8.2.2</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13057376" author="dagw" created="Wed, 29 Jun 2011 19:11:03 +0100"  >&lt;p&gt;Thanks for reporting this, Thomas. I can reproduce on trunk. Looks like a bug to me. &lt;/p&gt;</comment>
                            <comment id="13057727" author="dagw" created="Thu, 30 Jun 2011 10:53:34 +0100"  >&lt;p&gt;The problem appears to be a missing definition in TableOperatorNode of disablePrivilegeCollection. For views the premissions collection is disabled from tables in the query from-list with this QueryTreeNode#disablePrivilegeCollection. In the repro, where explicit JOINs are used, the disabling is not propagated down to the left and right tables of the join. The same error would appear for other subclasses of TableOperatorNode, e.g. set operations.&lt;/p&gt;
</comment>
                            <comment id="13057732" author="dagw" created="Thu, 30 Jun 2011 10:59:21 +0100"  >&lt;p&gt;Uploading a patch which makes the repro script work.&lt;br/&gt;
Not for commit, I still need to add new tests and check if there are other similar missing definitions.&lt;/p&gt;</comment>
                            <comment id="13057736" author="dagw" created="Thu, 30 Jun 2011 11:13:43 +0100"  >&lt;p&gt;Actually, the patch only solved the first failing case in the repro, so the patch is insufficient.&lt;/p&gt;</comment>
                            <comment id="13057826" author="dagw" created="Thu, 30 Jun 2011 14:59:05 +0100"  >&lt;p&gt;Uploading patch &quot;b&quot;, which makes both failing cases work.&lt;br/&gt;
The next missing pieces were sub-selects inside WHERE clause (and also HAVING clause, I found). I still need to add tests. Instead of populating the ValueNode hierarchy with new overrides, I used a CollectNodesVisitor so reach nested SELECT(s) to disable permission collection for them.&lt;/p&gt;</comment>
                            <comment id="13057866" author="knutanders" created="Thu, 30 Jun 2011 16:04:51 +0100"  >&lt;p&gt;Would an alternative be to remove all the overrides and use the visitor for all nodes? Since the disablePrivilegeCollection() method is defined in QueryTreeNode, and ValueNode is a subclass of QueryTreeNode, it feels a bit inconsistent to require overrides only in the non-ValueNode subclasses. Removing the overrides and relying on the visitor might reduce this code to just a single invocation of the visitor (with QueryTreeNode.class as argument instead of SelectNode.class) in FromBaseTable.bindNonVTITables().&lt;/p&gt;</comment>
                            <comment id="13058232" author="dagw" created="Fri, 1 Jul 2011 07:51:22 +0100"  >&lt;p&gt;Yes, that could be a natural further improvement, I agree. I didn&apos;t go there yet in the interest of a minimal change, but I think it&apos;s worth trying. It would definitely make the code simpler.&lt;/p&gt;</comment>
                            <comment id="13058478" author="dagw" created="Fri, 1 Jul 2011 12:10:45 +0100"  >&lt;p&gt;Uploading a patch &quot;c&quot;, which removes the overrides in favour of using a visitor always. This approach failed at first, because FromSubquery did not implement Visitable#acceptChildren, so I added that. I added a new test fixture to GrantRevokeTest: testViewDefinersRights based on the repro.&lt;/p&gt;

&lt;p&gt;Btw, it is not the first time we have had to add more implementations of acceptChildren to the node types. Maybe it&apos;s time to go through them to verify that all implement it correctly..&lt;/p&gt;

&lt;p&gt;Running regressions over again.&lt;/p&gt;</comment>
                            <comment id="13058591" author="knutanders" created="Fri, 1 Jul 2011 16:08:48 +0100"  >&lt;p&gt;The patch looks fine to me. There are two added svn:ignore properties though, that you may want to revert before committing (#SelectNode.java# and #GrantRevokeTest.java#).&lt;/p&gt;

&lt;p&gt;Perhaps we should also make QueryTreeNode.disablePrivilegeCollection() final now, so that we get a compile-time check that we haven&apos;t forgotten it somewhere or accidentally overridden it. And possibly also make it package private since it&apos;s only used in impl.sql.compile.&lt;/p&gt;</comment>
                            <comment id="13059394" author="dagw" created="Mon, 4 Jul 2011 12:24:44 +0100"  >&lt;p&gt;Yes, I saw those added properties, too.. Not sure how they got int there, maybe just the presence of those files is enough when I produced the diff? As for final,  I had a plan to do that but forgot it. Thanks for spotting it! Regressions ran OK.&lt;/p&gt;</comment>
                            <comment id="13059398" author="dagw" created="Mon, 4 Jul 2011 12:46:15 +0100"  >&lt;p&gt;Uploaded version &quot;d&quot; of this patch which removes the&lt;br/&gt;
extraneous properties settings and adds a &quot;final&quot; to QTN#disablePrivilegeCollection and makes the method package private.&lt;/p&gt;</comment>
                            <comment id="13059402" author="dagw" created="Mon, 4 Jul 2011 12:58:28 +0100"  >&lt;p&gt;Committed version &quot;d&quot; as svn 1142635. This is a back-port candidate, so I am not closing it yet.&lt;/p&gt;
</comment>
                            <comment id="13059584" author="dagw" created="Mon, 4 Jul 2011 20:25:27 +0100"  >&lt;p&gt;Backported to 10.8 branch as svn 1142773. Thomas, feel free to close this issue if you believe the issue has been resolved.&lt;/p&gt;</comment>
                            <comment id="13059620" author="thomashill" created="Mon, 4 Jul 2011 22:34:28 +0100"  >&lt;p&gt;Amazed again about level of support and timely feedback I am receiving from you and Derby community - thanks for this.&lt;br/&gt;
As I have never built Derby from source (and am not technical enough to start such an undertaking) I will need to wait for binaries before I can test. I think you advised me last time that there are periodic binary builds which are being produced? (but unfortunately I can&apos;t remember details). In regards to seeing the fix included in a &lt;b&gt;production&lt;/b&gt; release, is &apos;fix version&apos; 10.8.1.6 and 10.9.0 on this Jira indicating that this will be part of the next maintenance release 10.8.2 tentatively scheduled for middle Sep 2011?&lt;/p&gt;</comment>
                            <comment id="13059875" author="dagw" created="Tue, 5 Jul 2011 13:53:22 +0100"  >&lt;p&gt;Thanks, Thomas! Yes, &apos;fix version&apos; 10.8.1.6 does mean it will be part of the next maintenance release &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; You could pick up&lt;br/&gt;
tinderbox jars for head of the 10.8 branch here (debug jars) and see if they solve your issue (they should!):&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/Derby-branch-10.8/ws/10.8-head/jars/sane/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Derby-branch-10.8/ws/10.8-head/jars/sane/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(Please note that these jars are not intended for production.)&lt;/p&gt;</comment>
                            <comment id="13685238" author="knutanders" created="Mon, 17 Jun 2013 10:19:26 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12484754" name="derby5292a.diff" size="659" author="dagw" created="Thu, 30 Jun 2011 10:59:21 +0100"/>
                            <attachment id="12484769" name="derby5292b.diff" size="5946" author="dagw" created="Thu, 30 Jun 2011 14:59:05 +0100"/>
                            <attachment id="12484770" name="derby5292b.stat" size="645" author="dagw" created="Thu, 30 Jun 2011 14:59:05 +0100"/>
                            <attachment id="12484858" name="derby5292c.diff" size="13514" author="dagw" created="Fri, 1 Jul 2011 12:10:45 +0100"/>
                            <attachment id="12484859" name="derby5292c.stat" size="802" author="dagw" created="Fri, 1 Jul 2011 12:10:45 +0100"/>
                            <attachment id="12485134" name="derby5292d.diff" size="13270" author="dagw" created="Mon, 4 Jul 2011 12:46:15 +0100"/>
                            <attachment id="12485135" name="derby5292d.stat" size="678" author="dagw" created="Mon, 4 Jul 2011 12:46:15 +0100"/>
                            <attachment id="12483462" name="output.txt" size="6024" author="thomashill" created="Wed, 22 Jun 2011 18:07:20 +0100"/>
                            <attachment id="12483463" name="script.txt" size="3758" author="thomashill" created="Wed, 22 Jun 2011 18:07:20 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10367"><![CDATA[Deviation from standard]]></customfieldvalue>
    <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    <customfieldvalue key="10421"><![CDATA[Seen in production]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 29 Jun 2011 18:11:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24763</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0e3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36101</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>