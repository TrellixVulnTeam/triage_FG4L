<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:28:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2605/DERBY-2605.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2605] You can create BOOLEAN columns in 10.3</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2605</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The work on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-64&quot; title=&quot;Create a table with a query&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-64&quot;&gt;&lt;del&gt;DERBY-64&lt;/del&gt;&lt;/a&gt; seems to have opened up a wormhole by which you can create user tables with BOOLEAN columns. The following script shows how to do this:&lt;/p&gt;

&lt;p&gt;drop table foo;&lt;/p&gt;

&lt;p&gt;create table foo&lt;br/&gt;
as select systemalias from sys.sysaliases with no data;&lt;br/&gt;
rename column foo.systemalias to boolcol;&lt;br/&gt;
alter table foo&lt;br/&gt;
  alter column boolcol null;&lt;/p&gt;

&lt;p&gt;select c.columndatatype&lt;br/&gt;
from sys.syscolumns c, sys.systables t&lt;br/&gt;
where t.tableid=c.referenceid&lt;br/&gt;
and t.tablename=&apos;FOO&apos;;&lt;/p&gt;

&lt;p&gt;insert into foo( boolcol )&lt;br/&gt;
values&lt;br/&gt;
( 0 ),&lt;br/&gt;
( 1 ),&lt;br/&gt;
( cast (null as int) )&lt;br/&gt;
;&lt;/p&gt;

&lt;p&gt;select * from foo;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12368561">DERBY-2605</key>
            <summary>You can create BOOLEAN columns in 10.3</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="james.f.adams">James F. Adams</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 May 2007 15:50:13 +0100</created>
                <updated>Tue, 13 Jul 2010 20:23:49 +0100</updated>
                            <resolved>Fri, 18 May 2007 11:31:40 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12493402" author="army" created="Thu, 3 May 2007 16:40:13 +0100"  >&lt;p&gt;Last week I sent an email to derby-dev about the ability to create a decimal column with precision greater than 31:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://article.gmane.org/gmane.comp.apache.db.derby.devel/40881&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://article.gmane.org/gmane.comp.apache.db.derby.devel/40881&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I wonder if that issue and this one are related?  Ex. Should the CREATE TABLE AS functionality be performing checks on the column types that it creates?&lt;/p&gt;</comment>
                            <comment id="12493533" author="rhillegas" created="Thu, 3 May 2007 22:41:41 +0100"  >&lt;p&gt;That sounds like a reasonable approach to me. It may turn out that the checks are in the parser right now. What you&apos;re proposing may have to happen at bind() time.&lt;/p&gt;</comment>
                            <comment id="12495384" author="james.f.adams" created="Sun, 13 May 2007 18:35:50 +0100"  >&lt;p&gt;Attached is a patch that addresses the ability to create columns where the data type of the column is currently for internal use or otherwise not exposed to the user.&lt;/p&gt;

&lt;p&gt;I added an isInternalTypeId method to TypeId and defined the following types as being for internal use:&lt;/p&gt;

&lt;p&gt;BOOLEAN&lt;br/&gt;
NATIONAL CHAR&lt;br/&gt;
NATIONAL LONGVARCHAR&lt;br/&gt;
NATIONAL VARCHAR&lt;br/&gt;
REF&lt;br/&gt;
TINYINT&lt;br/&gt;
USERDEFINED&lt;br/&gt;
NCLOB&lt;/p&gt;

&lt;p&gt;CreateTableNode was updated to use this method to check the data type of each column.&lt;br/&gt;
A new message was added.&lt;br/&gt;
A new test was added.&lt;/p&gt;

&lt;p&gt;This patch does not address the situation with the VALUES statement desribed by Army.  I am wondering if the VALUES statement should even be allowed to create rows with invalid decimal precision.&lt;/p&gt;</comment>
                            <comment id="12495454" author="sv204098" created="Mon, 14 May 2007 04:31:46 +0100"  >&lt;p&gt;Hi James, your patch adds NATIONAL &amp;lt;CHAR&amp;gt; types also where as these are not supported by derby (see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2258&quot; title=&quot;DatabaseMetaData.getTypeInfo() does not list supported Derby SQL types correctly.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2258&quot;&gt;&lt;del&gt;DERBY-2258&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
Is their any specific reason for that?&lt;/p&gt;</comment>
                            <comment id="12495663" author="army" created="Mon, 14 May 2007 16:45:48 +0100"  >&lt;p&gt;Hi James,&lt;/p&gt;

&lt;p&gt;Thank you for your willingness to pick this up!  I think it&apos;d be great to fix this issue before the 10.3 release, to minimize impact on potential users.&lt;/p&gt;

&lt;p&gt;That said, I took a quick look at this issue on Friday and managed a small, incomplete patch that tried to solve this problem in a slightly different way.  I never got around to commenting or posting because other things came up.&lt;/p&gt;

&lt;p&gt;I&apos;m posting the &lt;b&gt;incomplete&lt;/b&gt; patch that I threw together here.  Note that right now the code just prints out an error &quot;OOPS&quot; instead of throwing an exception, and it doesn&apos;t have any test cases.  It also does not catch all of the types that your patch catches--though it should be possible to extend it in that way.  In any event, I thought I&apos;d post it as an alternate approach (&quot;food for thought&quot;) in case it&apos;s useful.&lt;/p&gt;

&lt;p&gt;The notable thing about d2605_inc_v1.patch is that it addresses the DECIMAL error that I mentioned on derby-dev.  It also avoids the need to add a new variable to TypeId...although that&apos;s probably not a big deal.&lt;/p&gt;

&lt;p&gt;&amp;gt; I am wondering if the VALUES statement should even be allowed to create rows&lt;br/&gt;
&amp;gt; with invalid decimal precision.&lt;/p&gt;

&lt;p&gt;I was wondering that, too.  And I&apos;m not sure what the answer is.  But for what it&apos;s worth, it looks we can actually catch this particular scenario at bind time &lt;b&gt;if&lt;/b&gt; the assumption is that the only way to create such a value is via a literal.  That seems like a valid assumption to me, but I haven&apos;t investigated fully and thus I could be wrong.&lt;/p&gt;

&lt;p&gt;Feel free to use or ignore the incomplete code as you see fit &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Either way, thanks again for choosing to work on this issue.&lt;/p&gt;</comment>
                            <comment id="12495850" author="james.f.adams" created="Tue, 15 May 2007 04:39:55 +0100"  >&lt;p&gt;A B,&lt;/p&gt;

&lt;p&gt;I think I prefer your approach.  I am updating my patch.&lt;/p&gt;

&lt;p&gt;I have however found a couple of interesting things with the precision/scale/maximum width check.&lt;/p&gt;

&lt;p&gt;1) Given table foo (x double precision), the check fails for:  create table bar&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; as select 2.0 * x from foo with no data&lt;br/&gt;
     because dtd.getScale() returns 1 and typeId.getMaximumScale() returns 0.  The datat ype of column y is double precision.&lt;/p&gt;

&lt;p&gt;2) The check fails for:   create table bar as select javaclassname from sys.sysaliases with no data&lt;br/&gt;
    because dtd.getMaximumWidth() returns 2147483647 and typeId.getMaximumMaximumWidth() returns 32700.&lt;br/&gt;
    The data type of javaclassname is LONG VARCHAR.  I would expect the maximum length to be 32700.  Integer.MAX_VALUE is specified&lt;br/&gt;
    as the maximum length of this column in SYSALIASESRowFactory.java.  I do not know if this is a bug or was intentional but the resulting&lt;br/&gt;
    maximum length certainly exceeds the documented value for a LONG VARCHAR.&lt;/p&gt;

&lt;p&gt;I am doing some more investigation.  I should be able to upload an updated patch in a couple of days.&lt;/p&gt;</comment>
                            <comment id="12496022" author="army" created="Tue, 15 May 2007 16:33:18 +0100"  >&lt;p&gt;&amp;gt; I have however found a couple of interesting things with the precision/scale/maximum width check. &lt;/p&gt;

&lt;p&gt;Thank you for pointing these out! I forgot to mention that I didn&apos;t do any extensive testing of the incomplete patch that I posted.&lt;/p&gt;

&lt;p&gt;&amp;gt; 1) Given table foo (x double precision), the check fails for: &amp;lt;snip query&amp;gt;&lt;/p&gt;

&lt;p&gt;Good catch.  I think that in this case there is an implicit scale/precision &quot;check&quot; because of the multiplication operation.  For example, the following currently works (even though precision is &amp;gt; 31):&lt;/p&gt;

&lt;p&gt;ij&amp;gt; values 12345678901234567890123456789012345678901234;&lt;/p&gt;

&lt;p&gt;but if we make that part of another Derby operation-&lt;del&gt;say multiplication&lt;/del&gt;-it fails:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; values 12345678901234567890123456789012345678901234 * 1.0;&lt;br/&gt;
ERROR 22003: The resulting value is outside the range for the data type DECIMAL/NUMERIC(31,1).&lt;/p&gt;

&lt;p&gt;The failure occurs as part of normal Derby processing for arithmetic operation.  So I wonder if we only have to worry about cases where we have a standalone constant?  If that&apos;s true then we could add a check for ConstantNode to the logic in CreateTableNode.  Something like:&lt;/p&gt;

&lt;p&gt;    DataTypeDescriptor dtd =&lt;br/&gt;
        (rc.getExpression() instanceof ConstantNode)&lt;br/&gt;
            ? rc.getExpressionType()&lt;br/&gt;
            : null;&lt;/p&gt;

&lt;p&gt;    if ((dtd != null) &amp;amp;&amp;amp; !dtd.isUserCreatableType())&lt;br/&gt;
        &amp;lt;error&amp;gt;&lt;/p&gt;

&lt;p&gt;I haven&apos;t tested that approach, but I wonder if it might solve the 1st problem that you discovered.&lt;/p&gt;

&lt;p&gt;&amp;gt; 2) The check fails for: create table bar as select javaclassname from sys.sysaliases with no data&lt;br/&gt;
&amp;gt;    because dtd.getMaximumWidth() returns 2147483647. &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;  The data type of javaclassname is&lt;br/&gt;
&amp;gt;    LONG VARCHAR.  I would expect the maximum length to be 32700.&lt;/p&gt;

&lt;p&gt;Hmm, I would expect a max length of 32700, as well.&lt;/p&gt;

&lt;p&gt;&amp;gt; I do not know if this is a bug or was intentional but the resulting maximum length certainly&lt;br/&gt;
&amp;gt; exceeds the documented value for a LONG VARCHAR. &lt;/p&gt;

&lt;p&gt;Sounds like a bug to me, though I do not know the history of this system table.  There are two other system tables that have LONG VARCHAR columns: SYSTRIGGERS and SYSSTATEMENTS.  The latter (SYSSTATEMENTS) uses TypeId.LONGVARCHAR_MAXWIDTH as the max width for the column, which I think is correct (that value is 32700).  SYSTRIGGERS uses Integer.MAX_VALUE just like SYSALIASES, but I do not think that&apos;s correct.&lt;/p&gt;

&lt;p&gt;&amp;gt; I am doing some more investigation. I should be able to upload an updated patch in a couple of days.&lt;/p&gt;

&lt;p&gt;I appreciate your time with this.  If you&apos;d like to post an incremental patch which just addresses the type problem (ex. BOOLEAN) for now, I think that would be fine.  You could then look into the scale/precision problem as a follow-up patch, if that makes things easier.  Or you can just post a single patch--whichever you prefer.&lt;/p&gt;</comment>
                            <comment id="12496175" author="james.f.adams" created="Wed, 16 May 2007 03:40:28 +0100"  >&lt;p&gt;Attached is a new version of a patch for consideration.&lt;/p&gt;</comment>
                            <comment id="12496724" author="army" created="Fri, 18 May 2007 00:25:59 +0100"  >&lt;p&gt;Thank you for the updated patch, James.  It looks good to me.  I ran derbyall and suites.All on SUSE Linux with no new failures, so I went ahead and committed d2605_v2.patch with svn commit #  539164:&lt;/p&gt;

&lt;p&gt;  URL: &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=539164&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=539164&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I can&apos;t tell from the comments if there is another patch coming or not, so I&apos;m not marking this issue as &quot;resolved&quot; yet.  If you are done, please feel free to resolve it on your own...&lt;/p&gt;

&lt;p&gt;Thanks again for addressing this issue!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="28326">DERBY-64</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12372511">DERBY-2879</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12357287" name="d2605_inc_v1.patch" size="3610" author="army" created="Mon, 14 May 2007 16:45:48 +0100"/>
                            <attachment id="12357193" name="d2605_v1.patch" size="8322" author="james.f.adams" created="Sun, 13 May 2007 18:35:50 +0100"/>
                            <attachment id="12357194" name="d2605_v1.stat" size="339" author="james.f.adams" created="Sun, 13 May 2007 18:35:50 +0100"/>
                            <attachment id="12357435" name="d2605_v2.patch" size="7268" author="james.f.adams" created="Wed, 16 May 2007 03:40:28 +0100"/>
                            <attachment id="12357436" name="d2605_v2.stat" size="351" author="james.f.adams" created="Wed, 16 May 2007 03:40:28 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 May 2007 15:40:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23124</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0pfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37938</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>