<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:27:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3645/DERBY-3645.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3645] Insert into selecting BLOB column twice leads to SQLException: Restore of a serializable or SQLData object of class error selecting from the table</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3645</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The following code which inserts into a table by selecting a blob column twice from another table, causes SQLException: Restore of a serializable or SQLData object of class error selecting from the table. See attached program DoubleInsertInto for full repro.  Stack trace is below.  Verified back to 10.3 but probably goes back further.&lt;/p&gt;



&lt;p&gt;        s.executeUpdate(&quot;CREATE TABLE T_MAIN(&quot; +&lt;br/&gt;
                &quot;ID INT  GENERATED ALWAYS AS IDENTITY PRIMARY KEY, &quot; +&lt;br/&gt;
                &quot;V BLOB(590473235) )&quot;);&lt;/p&gt;

&lt;p&gt;        String ins1 = &quot;INSERT INTO T_MAIN(V) VALUES &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&quot;;&lt;/p&gt;

&lt;p&gt;        PreparedStatement ps;&lt;br/&gt;
        ps = c.prepareStatement(ins1);&lt;br/&gt;
	byte[] bytes = new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;35000&amp;#93;&lt;/span&gt;;&lt;br/&gt;
	for (int i = 0; i &amp;lt; 35000; i++)&lt;br/&gt;
	    bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; = (byte) i ;&lt;br/&gt;
	ps.setBytes(1, bytes);&lt;br/&gt;
        ps.executeUpdate();&lt;br/&gt;
        ps.close();&lt;/p&gt;

&lt;p&gt;	s.executeUpdate(&quot;CREATE TABLE T_COPY ( V1 BLOB(2M), V2 BLOB(2M))&quot;);&lt;/p&gt;

&lt;p&gt;	Statement stmt = c.createStatement();&lt;br/&gt;
	stmt.executeUpdate(&quot;INSERT INTO T_COPY SELECT  V, V FROM T_MAIN&quot;);&lt;br/&gt;
	ResultSet rs = stmt.executeQuery(&quot;SELECT * FROM T_COPY&quot;);&lt;br/&gt;
	rs.next();&lt;br/&gt;
	String v1 = rs.getString(1);&lt;br/&gt;
	String v2 = rs.getString(2);&lt;br/&gt;
	System.out.println(&quot;v1:&quot; + v1);&lt;br/&gt;
	System.out.println(&quot;v2:&quot; + v2);&lt;br/&gt;
	System.out.println(&quot;I am done&quot;);&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.sql.SQLException: Restore of a serializable or SQLData object of class , attempted to re&lt;br/&gt;
ad more data than was originally stored&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:223)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:398)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2125)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedResultSet.closeOnTransactionError(EmbedResultSet.java:4320)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:463)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:367)&lt;br/&gt;
        at DoubleInsertInto.main(DoubleInsertInto.java:47)&lt;br/&gt;
Caused by: java.sql.SQLException: Restore of a serializable or SQLData object of class , attempted to read more data tha&lt;br/&gt;
n was originally stored&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:11&lt;br/&gt;
9)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)&lt;br/&gt;
        ... 10 more&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.io.EOFException&apos;.&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:11&lt;br/&gt;
9)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.javaException(Util.java:244)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)&lt;br/&gt;
        ... 8 more&lt;br/&gt;
Caused by: java.io.EOFException&lt;br/&gt;
        at org.apache.derby.iapi.types.SQLBinary.readBinaryLength(SQLBinary.java:350)&lt;br/&gt;
        at org.apache.derby.iapi.types.SQLBinary.readExternalFromArray(SQLBinary.java:328)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.StoredPage.readRecordFromArray(StoredPage.java:5568)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.StoredPage.restoreRecordFromSlot(StoredPage.java:1497)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BasePage.fetchFromSlot(BasePage.java:459)&lt;br/&gt;
        at org.apache.derby.impl.store.access.conglomerate.GenericScanController.fetchRows(GenericScanController.java:75&lt;br/&gt;
9)&lt;br/&gt;
        at org.apache.derby.impl.store.access.heap.HeapScan.fetchNextGroup(HeapScan.java:324)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.reloadArray(BulkTableScanResultSet.java:327)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.getNextRowCore(BulkTableScanResultSet.java:282)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:460)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:423)&lt;br/&gt;
        ... 2 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12394818">DERBY-3645</key>
            <summary>Insert into selecting BLOB column twice leads to SQLException: Restore of a serializable or SQLData object of class error selecting from the table</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Apr 2008 16:35:41 +0100</created>
                <updated>Wed, 12 Jan 2011 22:24:20 +0000</updated>
                            <resolved>Tue, 13 Jul 2010 18:01:04 +0100</resolved>
                                    <version>10.3.3.0</version>
                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12592455" author="kmarsden" created="Fri, 25 Apr 2008 19:08:48 +0100"  >&lt;p&gt;Interestingly, if I change the copy table to have the same size BLOB.  I get wrong results instead.&lt;br/&gt;
s.executeUpdate(&quot;CREATE TABLE T_COPY ( V1 BLOB(590473235), V2 BLOB(590473235))&quot;);&lt;br/&gt;
v1:000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f....&lt;br/&gt;
v2:9e9fa0a1a2a3a4a5a6a7a8a9aaabacadaeafb0b1b2b3b4b5b6b7b8b9ba&lt;/p&gt;

&lt;p&gt;This is more similar to the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2349&quot; title=&quot;Accessing a BLOB column twice in an INSERT trigger leads to errors in the value on-disk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2349&quot;&gt;&lt;del&gt;DERBY-2349&lt;/del&gt;&lt;/a&gt; case.&lt;/p&gt;</comment>
                            <comment id="12728056" author="knutanders" created="Tue, 7 Jul 2009 13:15:47 +0100"  >&lt;p&gt;Triaged for 10.5.2.&lt;/p&gt;</comment>
                            <comment id="12832456" author="kristwaa" created="Thu, 11 Feb 2010 11:55:46 +0000"  >&lt;p&gt;Fixed by the combination of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4477&quot; title=&quot;Selecting / projecting a column whose value is represented by a stream more than once fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4477&quot;&gt;&lt;del&gt;DERBY-4477&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4520&quot; title=&quot;Refactor and extend data type cloning facilities&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4520&quot;&gt;&lt;del&gt;DERBY-4520&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Verified against trunk revision 980933, but it would be nice if the reporter verified the fix as well.&lt;/p&gt;

&lt;p&gt;I do not plan to back-port the fix(es) due to the rather signficant changes involved, but it may be technically possible.&lt;/p&gt;</comment>
                            <comment id="12884456" author="kmarsden" created="Thu, 1 Jul 2010 23:07:27 +0100"  >&lt;p&gt;reopen for 10.5 back port&lt;/p&gt;</comment>
                            <comment id="12887845" author="kmarsden" created="Tue, 13 Jul 2010 17:56:38 +0100"  >&lt;p&gt;assigning to myself for back port to 10.5&lt;/p&gt;</comment>
                            <comment id="12887846" author="kmarsden" created="Tue, 13 Jul 2010 18:01:04 +0100"  >&lt;p&gt;This was back ported with the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3646&quot; title=&quot;Embedded returns wrong results when selecting a blob column twice and using getBinaryStream()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3646&quot;&gt;&lt;del&gt;DERBY-3646&lt;/del&gt;&lt;/a&gt; to 10.5&lt;br/&gt;
Resolving and assigning to Dag.&lt;/p&gt;

</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12363049">DERBY-2349</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12394819">DERBY-3646</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12443382">DERBY-4477</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12468384">DERBY-4728</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12380951" name="DoubleInsertInto.java" size="1916" author="kmarsden" created="Fri, 25 Apr 2008 16:36:39 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10364"><![CDATA[Data corruption]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 7 Jul 2009 12:15:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23766</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0o3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37721</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>