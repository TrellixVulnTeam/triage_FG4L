<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:08:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2444/DERBY-2444.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2444] Implement not implemented methods Blob.getBinaryStream(long pos, long length) and Clob. getCharacterStream(long pos, long length) in the Network Client</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2444</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The following methods were introduced in the java.sql.Clob and java.sql.Blob interface as part of JDBC 4.0 and need to be implemented.&lt;/p&gt;

&lt;p&gt;Clob&lt;br/&gt;
------&lt;/p&gt;

&lt;p&gt;getCharacterStream(long pos, long length)&lt;/p&gt;

&lt;p&gt;Blob&lt;br/&gt;
------&lt;/p&gt;

&lt;p&gt;getBinaryStream(long pos, long length)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12364647">DERBY-2444</key>
            <summary>Implement not implemented methods Blob.getBinaryStream(long pos, long length) and Clob. getCharacterStream(long pos, long length) in the Network Client</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="narayanan">V.Narayanan</assignee>
                                    <reporter username="narayanan">V.Narayanan</reporter>
                        <labels>
                    </labels>
                <created>Sat, 10 Mar 2007 14:18:11 +0000</created>
                <updated>Fri, 21 Jan 2011 17:49:56 +0000</updated>
                            <resolved>Wed, 18 Apr 2007 12:40:23 +0100</resolved>
                                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12479840" author="narayanan" created="Sat, 10 Mar 2007 14:23:48 +0000"  >&lt;p&gt;Add the tests to the jdbc4 suite&lt;/p&gt;

&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/jdbc4/BlobTest.java&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/tests/jdbc4/ClobTest.java&lt;/p&gt;

&lt;p&gt;Added the methods to the Blob and Clob implementations in the am interface&lt;/p&gt;

&lt;p&gt;M      java/client/org/apache/derby/client/am/Blob.java&lt;br/&gt;
M      java/client/org/apache/derby/client/am/Clob.java&lt;/p&gt;

&lt;p&gt;Tests Run&lt;br/&gt;
---------------&lt;/p&gt;

&lt;p&gt;ran derbyall and junit and no failures were there.&lt;/p&gt;</comment>
                            <comment id="12481645" author="narayanan" created="Fri, 16 Mar 2007 15:17:08 +0000"  >&lt;p&gt;I tried applying this patch to a freshworkspace. It did not show an conflicts with existing files while applying. I had also run the tests as indicated while submitting this patch. I request for this patch to be considered by a interested person for reviews, comments and if everything is OK a commit too.&lt;/p&gt;</comment>
                            <comment id="12483916" author="knutanders" created="Sun, 25 Mar 2007 09:57:35 +0100"  >&lt;p&gt;The patch looks good. Some minor comments/questions:&lt;br/&gt;
  1) Blob.getBinaryStream(long,long) creates a copy of the internal byte array and wraps it in a ByteArrayInputStream. Would it be better to use the ByteArrayInputStream constructor which takes three arguments (array, offset and length) and pass in a direct reference to binaryString_? This could reduce the memory footprint (except in the case where the Blob could be garbage collected before the stream). To achieve the same thing for Clob.getCharacterStream(), I think we would have to implement something like the LimitReader class in the engine code, but that&apos;s not required for this issue. Just throwing out some thoughts...&lt;br/&gt;
  2) Blob.getBinaryStream and Clob.getCharacterStream have almost identical code for checking position and length. Would it be possible to move that code into a common method in the base class (Lob)?&lt;br/&gt;
  3) The test code uses five blanks for indentation (should be four).&lt;br/&gt;
  4) The javadoc comments for getCharacterStream and getBinaryStream exceed 80 characters per line (as do a couple of lines in the methods&apos; bodies).&lt;/p&gt;</comment>
                            <comment id="12484095" author="narayanan" created="Mon, 26 Mar 2007 11:13:34 +0100"  >&lt;p&gt;Thank you for you comments. The patch addresses the issues you have pointed.&lt;/p&gt;</comment>
                            <comment id="12484096" author="narayanan" created="Mon, 26 Mar 2007 11:14:11 +0100"  >&lt;p&gt;I ran ClobTest and BlobTest and both of them passed.&lt;/p&gt;</comment>
                            <comment id="12484359" author="knutanders" created="Tue, 27 Mar 2007 09:52:56 +0100"  >&lt;p&gt;Thanks for the updated patch, Narayanan!&lt;/p&gt;

&lt;p&gt;I looked at the javadoc for Blob.getBinaryStream(long,long) at &lt;a href=&quot;http://java.sun.com/javase/6/docs/api/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/javase/6/docs/api/&lt;/a&gt;. It says&lt;/p&gt;

&lt;p&gt;Throws:&lt;br/&gt;
    SQLException - if pos is less than 1 or if pos is greater than the number of bytes in the Blob or if pos + length is greater than the number of bytes in the Blob &lt;/p&gt;

&lt;p&gt;(The wording is similar for Clob.getCharacterStream(long,long).)&lt;/p&gt;

&lt;p&gt;I don&apos;t think that matches the current checks. For instance, Lob.checkPosition() throws exception if (pos &amp;gt; length() + 1) whereas the it should throw exception if (pos &amp;gt; length()) . And checkLength() only checks whether length is negative. It would probably be good to add tests for these boundary cases in BlobTest/ClobTest as well.&lt;/p&gt;

&lt;p&gt;I don&apos;t think this part of getBinaryStream() is correct:&lt;br/&gt;
+            InputStream retVal = new java.io.ByteArrayInputStream&lt;br/&gt;
+                    (binaryString_, (int)(pos), (int)length);&lt;/p&gt;

&lt;p&gt;The pos argument starts on 1, whereas the offset argument to ByteArrayInputStream starts on 0. The tests in BlobTest passed, though, which I found a bit puzzling. It seems there is a dataOffset_ variable in Blob which, by accident, was one when running the tests, so the bug wasn&apos;t discovered. I believe pos should be replaced with (dataOffset_ + pos - 1).&lt;/p&gt;</comment>
                            <comment id="12484367" author="narayanan" created="Tue, 27 Mar 2007 10:10:51 +0100"  >&lt;p&gt;Thank you for the comments. Yes you are correct. I should have looked deeper into this. I am sorry, will fix this. &lt;/p&gt;

&lt;p&gt;There was a message on the comment notification email from JIRA that said you could reply to this email to place comments and they will appear in your issue. I did that and the comments did not come. Guess I made a mistake somewhere.&lt;/p&gt;</comment>
                            <comment id="12484379" author="knutanders" created="Tue, 27 Mar 2007 10:42:33 +0100"  >

&lt;p&gt;The comment is added to JIRA if you reply to jira@apache.org, but the&lt;br/&gt;
mailing list software rewrites the reply-to field and so that your&lt;br/&gt;
reply went directly to derby-dev. So it wasn&apos;t your fault! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;This mail was sent to jira@apache.org, so it will hopefully end up in&lt;br/&gt;
JIRA. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&amp;#8211; &lt;br/&gt;
Knut Anders&lt;/p&gt;</comment>
                            <comment id="12486391" author="narayanan" created="Tue, 3 Apr 2007 16:58:24 +0100"  >&lt;ul&gt;
	&lt;li&gt;I have checked for the cases pointed out as part of the&lt;br/&gt;
   comments to this issue. &lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;I removed the previous two methods checkPosition&lt;br/&gt;
   and checkLength from Lob class and added one &lt;br/&gt;
   method checkPosAndLength that checks for the &lt;br/&gt;
   position and length input parameters. &lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;To throw an exception in the case when pos+length&amp;gt;length&lt;br/&gt;
   of LOB I created a new SQLState.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;I have to add the tests for the cases when the exception are&lt;br/&gt;
   thrown. I will do this in a subsequent submission.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Pls consider this patch for reviews and comments.&lt;/p&gt;</comment>
                            <comment id="12486401" author="narayanan" created="Tue, 3 Apr 2007 17:14:54 +0100"  >&lt;p&gt;I haven&apos;t yet run tests on v3. I will post the test results tommorrow along with the tests that need to be run for the cases mentioned in the comments.&lt;/p&gt;</comment>
                            <comment id="12486939" author="narayanan" created="Thu, 5 Apr 2007 14:17:41 +0100"  >&lt;p&gt;I have addressed the comments pointed out in this issue&lt;/p&gt;

&lt;p&gt;The following can be highlighted with respect to this patch&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;pos has been replaced with (dataOffset_ + pos - 1) in the getBinaryStream(long, long)&lt;br/&gt;
    method implementation in am/Blob.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;added a checkPosAndLength method in the Lob class that verifies that pos and length&lt;br/&gt;
    of getCharacterStream(long, long) and getBinaryStream(long, long) satisfy the following&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     a) pos &amp;lt;= 0&lt;br/&gt;
     b) pos &amp;gt; (length of LOB)&lt;br/&gt;
     c) length &amp;lt; 0&lt;br/&gt;
     d) pos &amp;gt; (length of LOB)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Added tests to jdbc4/BlobTest and jdbc4/ClobTest that check for these conditions&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I have run derbyall and junit all and have the following failures that I can find in the tinderbox also.&lt;/p&gt;

&lt;p&gt;In my junit run&lt;br/&gt;
--------------------&lt;/p&gt;

&lt;p&gt;1) testMiscExpressions(org.apache.derbyTesting.functionTests.tests.lang.GroupByExpressionTest)java.sql.SQLSyntaxErrorException: The SELECT list of a grouped query contains at least one invalid expression. If a SELECT list has a GROUP BY, the list may only contain valid grouping expressions and valid aggregate expressions.&lt;/p&gt;

&lt;p&gt;There was 1 failure:&lt;br/&gt;
1) SecurityPolicyReloadingTest(  )junit.framework.AssertionFailedError: Policy file changed. Should not be able to read the property.&lt;/p&gt;

&lt;p&gt;In my derbyall run&lt;br/&gt;
-------------------------&lt;br/&gt;
derbyall/derbyall.fail:lang/grantRevokeDDL.sql&lt;/p&gt;

&lt;p&gt;I request for this patch to be considered for reviews and comments and if everything is ok a commit too.&lt;/p&gt;</comment>
                            <comment id="12486940" author="narayanan" created="Thu, 5 Apr 2007 14:19:04 +0100"  >&lt;p&gt;The last check should have been pos+length &amp;gt; (length of LOB) in the above comment. Sorry for the typo.&lt;/p&gt;</comment>
                            <comment id="12486941" author="narayanan" created="Thu, 5 Apr 2007 14:21:36 +0100"  >&lt;p&gt;Also it should not have been &quot;satisfy the following&quot; but rather &quot;do not violate the following&quot;. Sorry for the multiple comments.&lt;/p&gt;</comment>
                            <comment id="12488669" author="knutanders" created="Fri, 13 Apr 2007 14:48:05 +0100"  >&lt;p&gt;Thank you for addressing my comments, Narayanan! I think the patch looks good, and I will commit it when my test run has completed.&lt;/p&gt;

&lt;p&gt;One tiny nit (if you want to fix it, it is OK to do it as a follow-up). I think the check for (pos &amp;gt; this.length()) in Lob.checkPosAndLength() is redundant. Either (length &amp;lt; 0) or ((pos + length) &amp;gt; this.length()) must be true if (pos &amp;gt; this.length()), so an exception is thrown regardless of that check.&lt;/p&gt;

&lt;p&gt;Oh, and one more... There is a slight possibility that (pos+length) overflows and goes negative. For instance, a valid position combined with a length of Long.MAX_VALUE will not be detected as an error by checkPosAndLength(), I think. Changing the last check to (length &amp;gt; this.length() - pos) would eliminate the possibility for an overflow.&lt;/p&gt;</comment>
                            <comment id="12488706" author="knutanders" created="Fri, 13 Apr 2007 17:26:29 +0100"  >&lt;p&gt;Committed ClobBlobNotImplemented_v4.diff with revision 528546.&lt;/p&gt;</comment>
                            <comment id="12489002" author="narayanan" created="Mon, 16 Apr 2007 05:26:33 +0100"  >&lt;p&gt;Thank you for the commit Knut. I will submit a follow-up patch for the issue you have pointed.&lt;/p&gt;</comment>
                            <comment id="12489333" author="narayanan" created="Tue, 17 Apr 2007 09:07:04 +0100"  >&lt;p&gt;Addressed all the issues ppointed out. Also made changes to the test since the SQLState after the change in the caes where we test whether pos &amp;gt; length would be different. Changed the tests to test for the new SQLState.&lt;/p&gt;

&lt;p&gt;Since the new methods are tested only in jdbc4/BlobTest and jdbc4/ClobTest I have just run these two tests.&lt;/p&gt;

&lt;p&gt;I have however started the junit all run to not miss any failures that might occur. Will revert back with the results as soon as the test finishes.&lt;/p&gt;

&lt;p&gt;Pls consider this patch for reviews and comments.&lt;/p&gt;</comment>
                            <comment id="12489615" author="narayanan" created="Wed, 18 Apr 2007 06:52:27 +0100"  >&lt;p&gt;The junit All suite ran fine. There was just one failure which is already being seen in the tinderbox runs. &lt;/p&gt;

&lt;p&gt;1) testDSReference(org.apache.derbyTesting.functionTests.tests.jdbcapi.DataSourceReferenceTest)java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.jdbcapi.DataSourceReferenceTest.assertDataSourceReference(DataSourceReferenceTest.java:190)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.jdbcapi.DataSourceReferenceTest.testDSReference(DataSourceReferenceTest.java:143)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;/p&gt;

&lt;p&gt;I request for this patch to be considered for a commit.&lt;/p&gt;</comment>
                            <comment id="12489640" author="knutanders" created="Wed, 18 Apr 2007 09:02:18 +0100"  >&lt;p&gt;Thank you for addressing my comments Narayanan! I will take a look at the patch.&lt;/p&gt;</comment>
                            <comment id="12489701" author="knutanders" created="Wed, 18 Apr 2007 12:40:23 +0100"  >&lt;p&gt;Committed v5 with revision 529987.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12353047" name="ClobBlobNotImplemented_v1.diff" size="13341" author="narayanan" created="Sat, 10 Mar 2007 14:23:48 +0000"/>
                            <attachment id="12353048" name="ClobBlobNotImplemented_v1.stat" size="373" author="narayanan" created="Sat, 10 Mar 2007 14:23:48 +0000"/>
                            <attachment id="12354202" name="ClobBlobNotImplemented_v2.diff" size="12922" author="narayanan" created="Mon, 26 Mar 2007 11:13:34 +0100"/>
                            <attachment id="12354203" name="ClobBlobNotImplemented_v2.stat" size="428" author="narayanan" created="Mon, 26 Mar 2007 11:13:34 +0100"/>
                            <attachment id="12354859" name="ClobBlobNotImplemented_v3.diff" size="14329" author="narayanan" created="Tue, 3 Apr 2007 16:58:24 +0100"/>
                            <attachment id="12354860" name="ClobBlobNotImplemented_v3.stat" size="555" author="narayanan" created="Tue, 3 Apr 2007 16:58:24 +0100"/>
                            <attachment id="12355007" name="ClobBlobNotImplemented_v4.diff" size="22326" author="narayanan" created="Thu, 5 Apr 2007 14:17:41 +0100"/>
                            <attachment id="12355008" name="ClobBlobNotImplemented_v4.stat" size="648" author="narayanan" created="Thu, 5 Apr 2007 14:17:41 +0100"/>
                            <attachment id="12355672" name="ClobBlobNotImplemented_v5.diff" size="2470" author="narayanan" created="Tue, 17 Apr 2007 09:07:03 +0100"/>
                            <attachment id="12355673" name="ClobBlobNotImplemented_v5.stat" size="316" author="narayanan" created="Tue, 17 Apr 2007 09:07:04 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 25 Mar 2007 08:57:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30448</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0mkf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37474</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>