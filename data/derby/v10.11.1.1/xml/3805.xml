<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:19:20 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3805/DERBY-3805.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3805] Create a simple Blob performance regression test</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3805</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;A simple Blob performance regression test should exist to make it easier to detect performance degradations.&lt;br/&gt;
The test should be reasonably quick to complete.&lt;/p&gt;

&lt;p&gt;My plan is to focus on embedded first, then continue and enable all tests for client/server if possible.&lt;br/&gt;
Depending on the relative performance of embedded and client/server, the parameters might have to be tweaked to achieve an acceptable test duration.&lt;/p&gt;

&lt;p&gt;Note that the test results will only be valid for runs performed on the same machine. The intended purpose is to run the test against a clean trunk first, followed by a run with the patch possibly affecting the Blob performance.&lt;br/&gt;
Also note that the compared builds must have been built with the same sanity mode.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12401324">DERBY-3805</key>
            <summary>Create a simple Blob performance regression test</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Jul 2008 15:34:33 +0100</created>
                <updated>Wed, 1 Jul 2009 00:45:33 +0100</updated>
                            <resolved>Mon, 23 Mar 2009 08:21:30 +0000</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12618363" author="kristwaa" created="Wed, 30 Jul 2008 15:36:52 +0100"  >&lt;p&gt;&apos;derby-3805-1a-blobaccesstest.diff&apos; is the first revision of the Blob performance regression test.&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12618379" author="kristwaa" created="Wed, 30 Jul 2008 16:04:17 +0100"  >&lt;p&gt;I&apos;m attaching the two sets of output obtained from patch revision 1a. Don&apos;t pay to much attention to the absolute numbers, just the difference between the two sets. To make sure sanity checks didn&apos;t mess up the numbers, I ran with insane builds. The first set is from trunk, the second one is the same revision with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3766&quot; title=&quot;EmbedBlob.setPosition is highly ineffective for streams&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3766&quot;&gt;&lt;del&gt;DERBY-3766&lt;/del&gt;&lt;/a&gt; (2a) applied.&lt;/p&gt;

&lt;p&gt;----- clean trunk&lt;br/&gt;
java version &quot;1.6.0_06&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_06-b02)&lt;br/&gt;
Java HotSpot(TM) Client VM (build 10.0-b22, mixed mode)&lt;br/&gt;
.Test-testFetchSmallBlobs: framework:Embedded_40: run#0 iterations: 50 : elapsedTime(ms): 12311&lt;br/&gt;
Test-testFetchSmallBlobs: framework:Embedded_40: run#1 iterations: 50 : elapsedTime(ms): 11505&lt;br/&gt;
Test-testFetchSmallBlobs: framework:Embedded_40: run#2 iterations: 50 : elapsedTime(ms): 12715&lt;br/&gt;
Test-testFetchSmallBlobs: framework:Embedded_40:iterations: 50 : Avg elapsedTime(ms): 12110&lt;br/&gt;
.Test-testFetchSmallBlobsInaccurateLength: framework:Embedded_40: run#0 iterations: 50 : elapsedTime(ms): 12479&lt;br/&gt;
Test-testFetchSmallBlobsInaccurateLength: framework:Embedded_40: run#1 iterations: 50 : elapsedTime(ms): 12475&lt;br/&gt;
Test-testFetchSmallBlobsInaccurateLength: framework:Embedded_40: run#2 iterations: 50 : elapsedTime(ms): 11511&lt;br/&gt;
Test-testFetchSmallBlobsInaccurateLength: framework:Embedded_40:iterations: 50 : Avg elapsedTime(ms): 11993&lt;br/&gt;
.Test-testModifySmallBlobs: framework:Embedded_40: run#0 iterations: 50 : elapsedTime(ms): 11509&lt;br/&gt;
Test-testModifySmallBlobs: framework:Embedded_40: run#1 iterations: 50 : elapsedTime(ms): 11410&lt;br/&gt;
Test-testModifySmallBlobs: framework:Embedded_40: run#2 iterations: 50 : elapsedTime(ms): 13954&lt;br/&gt;
Test-testModifySmallBlobs: framework:Embedded_40:iterations: 50 : Avg elapsedTime(ms): 12682&lt;br/&gt;
.Test-testFetchLargeBlobs: framework:Embedded_40: run#0 iterations: 5 : elapsedTime(ms): 11023&lt;br/&gt;
Test-testFetchLargeBlobs: framework:Embedded_40: run#1 iterations: 5 : elapsedTime(ms): 9784&lt;br/&gt;
Test-testFetchLargeBlobs: framework:Embedded_40: run#2 iterations: 5 : elapsedTime(ms): 9812&lt;br/&gt;
Test-testFetchLargeBlobs: framework:Embedded_40:iterations: 5 : Avg elapsedTime(ms): 9798&lt;br/&gt;
.Test-testFetchLargeBlobOneByOneByteBaseline: framework:Embedded_40: run#0 iterations: 5 : elapsedTime(ms): 1350&lt;br/&gt;
Test-testFetchLargeBlobOneByOneByteBaseline: framework:Embedded_40: run#1 iterations: 5 : elapsedTime(ms): 987&lt;br/&gt;
Test-testFetchLargeBlobOneByOneByteBaseline: framework:Embedded_40: run#2 iterations: 5 : elapsedTime(ms): 1000&lt;br/&gt;
Test-testFetchLargeBlobOneByOneByteBaseline: framework:Embedded_40:iterations: 5 : Avg elapsedTime(ms): 993&lt;br/&gt;
.Test-testFetchLargeBlobOneByOneByteModified: framework:Embedded_40: run#0 iterations: 5 : elapsedTime(ms): 277649&lt;br/&gt;
Test-testFetchLargeBlobOneByOneByteModified: framework:Embedded_40: run#1 iterations: 5 : elapsedTime(ms): 277868&lt;br/&gt;
Test-testFetchLargeBlobOneByOneByteModified: framework:Embedded_40: run#2 iterations: 5 : elapsedTime(ms): 276765&lt;br/&gt;
Test-testFetchLargeBlobOneByOneByteModified: framework:Embedded_40:iterations: 5 : Avg elapsedTime(ms): 277316&lt;br/&gt;
.Test-testFetchLargeBlobOneByOneByte: framework:Embedded_40: run#0 iterations: 5 : elapsedTime(ms): 5173&lt;br/&gt;
Test-testFetchLargeBlobOneByOneByte: framework:Embedded_40: run#1 iterations: 5 : elapsedTime(ms): 5163&lt;br/&gt;
Test-testFetchLargeBlobOneByOneByte: framework:Embedded_40: run#2 iterations: 5 : elapsedTime(ms): 5116&lt;br/&gt;
Test-testFetchLargeBlobOneByOneByte: framework:Embedded_40:iterations: 5 : Avg elapsedTime(ms): 5139&lt;br/&gt;
.Test-testFetchLargeBlobPieceByPiece: framework:Embedded_40: run#0 iterations: 5 : elapsedTime(ms): 17344&lt;br/&gt;
Test-testFetchLargeBlobPieceByPiece: framework:Embedded_40: run#1 iterations: 5 : elapsedTime(ms): 17408&lt;br/&gt;
Test-testFetchLargeBlobPieceByPiece: framework:Embedded_40: run#2 iterations: 5 : elapsedTime(ms): 17437&lt;br/&gt;
Test-testFetchLargeBlobPieceByPiece: framework:Embedded_40:iterations: 5 : Avg elapsedTime(ms): 17422&lt;br/&gt;
.Test-testLargeBlobGetLength: framework:Embedded_40: run#0 iterations: 5 : elapsedTime(ms): 11&lt;br/&gt;
Test-testLargeBlobGetLength: framework:Embedded_40: run#1 iterations: 5 : elapsedTime(ms): 2&lt;br/&gt;
Test-testLargeBlobGetLength: framework:Embedded_40: run#2 iterations: 5 : elapsedTime(ms): 2&lt;br/&gt;
Test-testLargeBlobGetLength: framework:Embedded_40:iterations: 5 : Avg elapsedTime(ms): 2&lt;/p&gt;

&lt;p&gt;Time: 1,131.121&lt;/p&gt;

&lt;p&gt;OK (9 tests)&lt;/p&gt;


&lt;p&gt;real    18:51.7&lt;br/&gt;
user    11:07.9&lt;br/&gt;
sys      7:12.2&lt;/p&gt;


&lt;p&gt;----- trunk with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3766&quot; title=&quot;EmbedBlob.setPosition is highly ineffective for streams&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3766&quot;&gt;&lt;del&gt;DERBY-3766&lt;/del&gt;&lt;/a&gt; (2a) applied (I kept only the averages for conciseness)&lt;br/&gt;
java version &quot;1.6.0_06&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_06-b02)&lt;br/&gt;
Java HotSpot(TM) Client VM (build 10.0-b22, mixed mode)&lt;br/&gt;
Test-testFetchSmallBlobs: framework:Embedded_40:iterations: 50 : Avg elapsedTime(ms): 11841&lt;br/&gt;
Test-testFetchSmallBlobsInaccurateLength: framework:Embedded_40:iterations: 50 : Avg elapsedTime(ms): 12468&lt;br/&gt;
Test-testModifySmallBlobs: framework:Embedded_40:iterations: 50 : Avg elapsedTime(ms): 12164&lt;br/&gt;
Test-testFetchLargeBlobs: framework:Embedded_40:iterations: 5 : Avg elapsedTime(ms): 9773&lt;br/&gt;
Test-testFetchLargeBlobOneByOneByteBaseline: framework:Embedded_40:iterations: 5 : Avg elapsedTime(ms): 999&lt;br/&gt;
Test-testFetchLargeBlobOneByOneByteModified: framework:Embedded_40:iterations: 5 : Avg elapsedTime(ms): 272976&lt;br/&gt;
Test-testFetchLargeBlobOneByOneByte: framework:Embedded_40:iterations: 5 : Avg elapsedTime(ms): 5196&lt;br/&gt;
Test-testFetchLargeBlobPieceByPiece: framework:Embedded_40:iterations: 5 : Avg elapsedTime(ms): 159&lt;br/&gt;
Test-testLargeBlobGetLength: framework:Embedded_40:iterations: 5 : Avg elapsedTime(ms): 2&lt;br/&gt;
// Ignore this test (SingleRecordSelectClient) for now, it wasn&apos;t included in the clean trunk run.&lt;br/&gt;
.Number of threads:	16&lt;br/&gt;
Test duration (s):	60.009&lt;br/&gt;
Number of transactions:	1165902&lt;br/&gt;
Average throughput (tx/s):	19428.785682147678&lt;br/&gt;
Test-testConcurrency: framework:Embedded_40: run#0 iterations: 1 : elapsedTime(ms): 108794&lt;/p&gt;

&lt;p&gt;Time: 1,181.123&lt;/p&gt;

&lt;p&gt;OK (10 tests)&lt;/p&gt;


&lt;p&gt;real    19:42.0&lt;br/&gt;
user    12:51.2&lt;br/&gt;
sys      7:17.3&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;Looking at the results, the patch seems to have fixed one problem and not caused any regressions. This can be seen from the duration of the test &apos;testFetchLargeBlobPieceByPiece&apos;. It dropped from 17422 ms to 159 ms!!!&lt;br/&gt;
Also, there seems to be a serious problem when the Blob is modified and then read back byte by byte (&apos;testFetchLargeBlobOneByOneByteModified&apos;). My guess is this is either a buffering issue or a bad (positioning) algorithm somewhere.&lt;/p&gt;


&lt;p&gt;The current tests use around 20 minutes. We can add more tests, but I feel the test should take maximum one hour (preferably less).&lt;br/&gt;
Any suggestions for new tests?&lt;br/&gt;
Are any of the existing ones &quot;useless&quot;?&lt;/p&gt;</comment>
                            <comment id="12636609" author="kristwaa" created="Fri, 3 Oct 2008 12:34:40 +0100"  >&lt;p&gt;Attached updated version (1b).&lt;/p&gt;</comment>
                            <comment id="12636610" author="kristwaa" created="Fri, 3 Oct 2008 12:38:58 +0100"  >&lt;p&gt;Committed patch 1b to trunk with revision 701351.&lt;br/&gt;
I expect  a number of changes will be made later, for instance tuning the run parameters (iterations/repetitions) and adding/removing tests.&lt;/p&gt;</comment>
                            <comment id="12688240" author="kristwaa" created="Mon, 23 Mar 2009 08:21:30 +0000"  >&lt;p&gt;Closing the issue, as the first version of the test has been completed.&lt;br/&gt;
More work can be done, for instance investigate the performance with the client driver and add new/more tests.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12401493">DERBY-3810</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12387189" name="derby-3805-1a-blobaccesstest.diff" size="19622" author="kristwaa" created="Wed, 30 Jul 2008 15:36:52 +0100"/>
                            <attachment id="12391414" name="derby-3805-1b-blobaccesstest.diff" size="22628" author="kristwaa" created="Fri, 3 Oct 2008 12:34:40 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10362"><![CDATA[Performance]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31010</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0txz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38669</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>