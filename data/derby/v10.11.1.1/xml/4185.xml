<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:22:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4185/DERBY-4185.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4185] Make timeout settable or increase default for one replication message layer protocol.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4185</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When running the replication tests under machines with some load, I&lt;br/&gt;
experience intermittent errors (see also &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4175&quot; title=&quot;Instability in some replication tests under load, since tests don&amp;#39;t wait long enough for final state or anticipate intermediate states&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4175&quot;&gt;&lt;del&gt;DERBY-4175&lt;/del&gt;&lt;/a&gt;). The symptom is&lt;br/&gt;
that when one is trying to fail over from the master (or shutting down&lt;br/&gt;
the master which has the same effect), a REPLICATION_CONNECTION_LOST&lt;br/&gt;
(XRE04.U.2) is seen.&lt;/p&gt;

&lt;p&gt;The constant ReplicationMessageTransmit.DEFAULT_MESSAGE_RESPONSE_TIMEOUT is&lt;br/&gt;
hardwired to 5 seconds. &lt;br/&gt;
Cf Javadoc for ReplicationMessageTransmit.sendMessageWaitForReply:&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Send a replication message to the slave and return the&lt;/li&gt;
	&lt;li&gt;message received as a response. Will only wait&lt;/li&gt;
	&lt;li&gt;DEFAULT_MESSAGE_RESPONSE_TIMEOUT millis for the response&lt;/li&gt;
	&lt;li&gt;message. If not received when the wait times out, no message is&lt;/li&gt;
	&lt;li&gt;returned. ..&lt;/li&gt;
	&lt;li&gt;:&lt;/li&gt;
	&lt;li&gt;@throws StandardException if the response message has not been received&lt;/li&gt;
	&lt;li&gt;after DEFAULT_MESSAGE_RESPONSE_TIMEOUT millis&lt;br/&gt;
     */&lt;br/&gt;
    public synchronized ReplicationMessage&lt;br/&gt;
        sendMessageWaitForReply(ReplicationMessage message)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If this constant is increased to 10 seconds, I do not this see this&lt;br/&gt;
issue any longer on my machine (a fairly new Lenovo T61p, Intel Core 2&lt;br/&gt;
Duo CPU T9300 @ 2.50GHz).&lt;/p&gt;

&lt;p&gt;One concern here is the stability of the tests. Another is for user&lt;br/&gt;
applications. If the tests see this issue, user apps may as well. I am&lt;br/&gt;
unsure whether we should provide a knob to tweak this (user settable&lt;br/&gt;
attribute), or whether it would be sufficient to up the constant to&lt;br/&gt;
say, 10 or 20 seconds. I think one should be able to use Derby&lt;br/&gt;
replication also on machines with some load &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; What detrimental&lt;br/&gt;
effects could increasing this constant have?&lt;/p&gt;

&lt;p&gt;An example (See another example here:&lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/browse/DERBY-3417?focusedCommentId=12701731&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12701731&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/DERBY-3417?focusedCommentId=12701731&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12701731&lt;/a&gt;  ):&lt;/p&gt;

&lt;p&gt;There was 1 failure:&lt;br/&gt;
1) testReplication_Local_3_p4_StateNegativeTests(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p4)junit.framework.ComparisonFailure: Unexpected SQL state. expected:&amp;lt;XRE&lt;span class=&quot;error&quot;&gt;&amp;#91;20&amp;#93;&lt;/span&gt;&amp;gt; but was:&amp;lt;XRE&lt;span class=&quot;error&quot;&gt;&amp;#91;04&amp;#93;&lt;/span&gt;&amp;gt;&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:762)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:797)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:811)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.failOver_direct(ReplicationRun.java:1381)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.failOver(ReplicationRun.java:1302)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_3_p4.testReplication_Local_3_p4_StateNegativeTests(ReplicationRun_Local_3_p4.java:155)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:105)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
Caused by: java.sql.SQLNonTransientConnectionException: DERBY SQL error: SQLCODE: 0, SQLSTATE: XRE04, SQLERRMC: nullXRE04.U.2&lt;br/&gt;
	at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)&lt;br/&gt;
	at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:358)&lt;br/&gt;
	at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:367)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:149)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:582)&lt;br/&gt;
	at java.sql.DriverManager.getConnection(DriverManager.java:207)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.failOver_direct(ReplicationRun.java:1368)&lt;br/&gt;
	... 26 more&lt;br/&gt;
Caused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: 0, SQLSTATE: XRE04, SQLERRMC: nullXRE04.U.2&lt;br/&gt;
	at org.apache.derby.client.am.Connection.completeSqlca(Connection.java:2082)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseRdbAccessFailed(NetConnectionReply.java:540)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(NetConnectionReply.java:433)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(NetConnectionReply.java:297)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(NetConnectionReply.java:121)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(NetConnection.java:835)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(NetConnection.java:759)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowUSRIDONLconnect(NetConnection.java:592)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.flowConnect(NetConnection.java:399)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection.&amp;lt;init&amp;gt;(NetConnection.java:219)&lt;br/&gt;
	at org.apache.derby.client.net.NetConnection40.&amp;lt;init&amp;gt;(NetConnection40.java:77)&lt;br/&gt;
	at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl40.newNetConnection(ClientJDBCObjectFactoryImpl40.java:269)&lt;br/&gt;
	at org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:140)&lt;br/&gt;
	... 29 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12423714">DERBY-4185</key>
            <summary>Make timeout settable or increase default for one replication message layer protocol.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Apr 2009 17:52:35 +0100</created>
                <updated>Tue, 28 Jul 2009 22:42:34 +0100</updated>
                            <resolved>Wed, 29 Apr 2009 01:57:25 +0100</resolved>
                                    <version>10.6.1.0</version>
                                    <fixVersion>10.5.3.0</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Replication</component>
                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12702454" author="dagw" created="Fri, 24 Apr 2009 18:17:30 +0100"  >&lt;p&gt;It seems sendMessageWaitForReply is only ever used in&lt;/p&gt;

&lt;p&gt; a) ReplicationMessageTransmit.brokerConnection (from javadoc: &quot;Used to send initiator messages to the slave and receive information about the compatibility of the slave with the master)&lt;br/&gt;
 b) MsterController.startFailover (do fail-over from master)&lt;/p&gt;

&lt;p&gt;So, I think it should be safe to increase the default of this timeout even to 30 seconds without incurring any penalty.&lt;br/&gt;
This is better than making it a knob, I think. I will try to run the entire suite with 30 seconds and see if&lt;br/&gt;
it has any detrimental effects.&lt;/p&gt;


</comment>
                            <comment id="12702736" author="knutanders" created="Sat, 25 Apr 2009 18:38:04 +0100"  >&lt;p&gt;I agree that we should try to avoid adding a knob, and I also think it sounds fine to increase the timeout in those two cases (when starting the master and when initiating fail-over, right?). +1&lt;/p&gt;</comment>
                            <comment id="12703429" author="dagw" created="Mon, 27 Apr 2009 23:57:14 +0100"  >&lt;p&gt;Thanks, Knut. Uploading a patch to increase timeout to 30 seconds; it had no ill effects on the ReplicationSuite (as expected, now that we know what it&apos;s used for).&lt;/p&gt;</comment>
                            <comment id="12703929" author="dagw" created="Wed, 29 Apr 2009 01:57:25 +0100"  >&lt;p&gt;Committed patch as svn 769606, resolving.&lt;/p&gt;</comment>
                            <comment id="12736324" author="dagw" created="Tue, 28 Jul 2009 22:41:41 +0100"  >&lt;p&gt;Backported to 10.5 branch as svn 798715, closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12394296">DERBY-3632</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12406576" name="derby-4185.diff" size="723" author="dagw" created="Mon, 27 Apr 2009 23:55:08 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 25 Apr 2009 17:38:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31155</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ryn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38348</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>