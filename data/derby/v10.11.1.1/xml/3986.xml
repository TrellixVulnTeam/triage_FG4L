<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:52:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3986/DERBY-3986.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3986] Stop dropping build artifacts in the subversion-controlled source tree</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3986</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The Derby build drops various artifacts in the source tree. Build artifacts should not muddy subversion controlled directories but should, instead, go into temporary directories created by the the build. &lt;/p&gt;

&lt;p&gt;The following is a (perhaps partial) list of artifacts currently dropped into subversion-controlled space:&lt;/p&gt;

&lt;p&gt;Sanity directives&lt;br/&gt;
Generated grammars&lt;br/&gt;
The English error messages&lt;br/&gt;
Data type class sizes&lt;br/&gt;
Toursdb&lt;br/&gt;
Temporary class for verifying compiler level&lt;/p&gt;</description>
                <environment></environment>
        <key id="12410499">DERBY-3986</key>
            <summary>Stop dropping build artifacts in the subversion-controlled source tree</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Dec 2008 17:31:42 +0000</created>
                <updated>Thu, 11 Nov 2010 20:05:10 +0000</updated>
                                            <version>10.5.1.1</version>
                                                    <component>Build tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12657575" author="rhillegas" created="Wed, 17 Dec 2008 21:57:00 +0000"  >&lt;p&gt;Attaching derby-3986-01-aa-checkCompilerLevel.diff. This patch changes the way that we determine whether the compiler is at least at the Java 5 level. Instead of doing a dummy compile and checking for the output, we just check to see if the classpath contains a class added in Java 5.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;M      build.xml&lt;/p&gt;</comment>
                            <comment id="12657774" author="rhillegas" created="Thu, 18 Dec 2008 13:56:39 +0000"  >&lt;p&gt;Committed derby-3986-01-aa-checkCompilerLevel.diff at subversion revision 727725.&lt;/p&gt;</comment>
                            <comment id="12744576" author="myrna" created="Tue, 18 Aug 2009 17:06:16 +0100"  >&lt;p&gt;seems to me all currently available patches have been committed...&lt;/p&gt;</comment>
                            <comment id="12764605" author="knutanders" created="Mon, 12 Oct 2009 09:42:10 +0100"  >&lt;p&gt;Not only are the generated grammars dropped into the svn-controlled space, but at least two of the generated files are even checked in (impl/sql/compile/ParseException.java and impl/tools/ij/ParseException.java) so that they are not re-generated. I tried to remove them and did &quot;ant clobber&quot; + &quot;ant&quot; to regenerate them, and then some of the syntax errors actually became more helpful.&lt;/p&gt;

&lt;p&gt;For example, the error message for this statement&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table t;&lt;/p&gt;

&lt;p&gt;changed from&lt;/p&gt;

&lt;p&gt;ERROR 42X01: Syntax error: Encountered &quot;&amp;lt;EOF&amp;gt;&quot; at line 1, column 14.&lt;/p&gt;

&lt;p&gt;to the more helpful&lt;/p&gt;

&lt;p&gt;ERROR 42X01: Syntax error: Encountered &quot;&amp;lt;EOF&amp;gt;&quot; at line 1, column 14.&lt;br/&gt;
Was expecting one of:&lt;br/&gt;
    &quot;as&quot; ...&lt;br/&gt;
    &quot;(&quot; ...&lt;br/&gt;
    .&lt;/p&gt;

&lt;p&gt;Some of the error messages did however become very long after this change, like the error for &quot;select * from t1 inner join t2&quot; which listed more than 150 alternatives.&lt;/p&gt;</comment>
                            <comment id="12912575" author="rhillegas" created="Mon, 20 Sep 2010 17:51:01 +0100"  >&lt;p&gt;Attaching derby-3986-02-af-sanity-bin-toursdb-storeless-release.diff. This patch intends to put build artifacts in a directory tree separate from the subversion-controlled source tree. This writeup addresses the following topics:&lt;/p&gt;

&lt;p&gt;o Motivation&lt;/p&gt;

&lt;p&gt;o High level description&lt;/p&gt;

&lt;p&gt;o New tree for generated artifacts&lt;/p&gt;

&lt;p&gt;o Remaining work&lt;/p&gt;

&lt;p&gt;o State of testing&lt;/p&gt;

&lt;p&gt;o How to apply the patch&lt;/p&gt;

&lt;p&gt;o Patch details&lt;/p&gt;


&lt;p&gt;------------------ MOTIVATION ----------------&lt;/p&gt;

&lt;p&gt;Right now the Derby build drops artifacts into the subversion-controlled source tree. This makes it awkward to run multiple builds using different environments, since each new build clobbers the output of other builds. After this patch is applied, it should be possible to build Derby in different environments without clobbering the results of other builds. In particular, the following use-cases should be supported:&lt;/p&gt;

&lt;p&gt;o Building Derby in parallel using different rev levels of Java&lt;/p&gt;

&lt;p&gt;o Building Derby on a hypervisor whose guest operating systems share a read-only subversion client but compile into os-specific output directories.&lt;/p&gt;


&lt;p&gt;------------------ HIGH LEVEL DESCRIPTION ----------------&lt;/p&gt;

&lt;p&gt;This patch introduces two high level concepts:&lt;/p&gt;

&lt;p&gt;1) A new artifact directory called &quot;generated&quot;, which lives parallel to the classes, jars, and javadoc directories already created by the build machinery. This new directory is the root of a tree where the build puts generated java files and other artifacts which do not fit tidily into the existing classes, jars, or javadoc directories.&lt;/p&gt;

&lt;p&gt;2) A new variable $&lt;/p&gt;
{out.base} which you can customize in your ant.properties or on the command line. ${out.base}
&lt;p&gt; is the base directory for all build artifacts. It defaults to be $&lt;/p&gt;
{basedir}
&lt;p&gt;. That means that if you do not customize $&lt;/p&gt;
{out.base}, then most of your build artifacts (including classes, jars, and javadoc) will continue to be dropped into the same locations where they are dropped today. If you do customize ${out.base}
&lt;p&gt;, then all of the following artifacts will be dropped into the $&lt;/p&gt;
{out.base} directory:&lt;br/&gt;
&lt;br/&gt;
changenumber.properties&lt;br/&gt;
classes&lt;br/&gt;
classes.pptesting&lt;br/&gt;
classes.storeless&lt;br/&gt;
generated&lt;br/&gt;
jars&lt;br/&gt;
javadoc&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
------------------ NEW TREE FOR GENERATED ARTIFACTS ----------------&lt;br/&gt;
&lt;br/&gt;
After applying this patch and building Derby, you will see the following new subtree:&lt;br/&gt;
&lt;br/&gt;
generated&lt;br/&gt;
generated/bin&lt;br/&gt;
generated/bin/dblook&lt;br/&gt;
generated/bin/ij&lt;br/&gt;
generated/bin/NetworkServerControl&lt;br/&gt;
generated/bin/startNetworkServer&lt;br/&gt;
generated/bin/stopNetworkServer&lt;br/&gt;
generated/bin/sysinfo&lt;br/&gt;
generated/java&lt;br/&gt;
generated/java/org&lt;br/&gt;
generated/java/org/apache&lt;br/&gt;
generated/java/org/apache/derby&lt;br/&gt;
generated/java/org/apache/derby/iapi&lt;br/&gt;
generated/java/org/apache/derby/iapi/services&lt;br/&gt;
generated/java/org/apache/derby/iapi/services/cache&lt;br/&gt;
generated/java/org/apache/derby/iapi/services/cache/ClassSizeCatalog.java&lt;br/&gt;
generated/java/org/apache/derby/impl&lt;br/&gt;
generated/java/org/apache/derby/impl/sql&lt;br/&gt;
generated/java/org/apache/derby/impl/sql/compile&lt;br/&gt;
generated/java/org/apache/derby/impl/sql/compile/SQLParser.java&lt;br/&gt;
generated/java/org/apache/derby/impl/sql/compile/SQLParserConstants.java&lt;br/&gt;
generated/java/org/apache/derby/impl/sql/compile/SQLParserTokenManager.java&lt;br/&gt;
generated/java/org/apache/derby/impl/sql/compile/TokenMgrError.java&lt;br/&gt;
generated/java/org/apache/derby/impl/tools&lt;br/&gt;
generated/java/org/apache/derby/impl/tools/ij&lt;br/&gt;
generated/java/org/apache/derby/impl/tools/ij/CharStream.java&lt;br/&gt;
generated/java/org/apache/derby/impl/tools/ij/ij.java&lt;br/&gt;
generated/java/org/apache/derby/impl/tools/ij/ijConstants.java&lt;br/&gt;
generated/java/org/apache/derby/impl/tools/ij/ijTokenManager.java&lt;br/&gt;
generated/java/org/apache/derby/impl/tools/ij/mtGrammar.java&lt;br/&gt;
generated/java/org/apache/derby/impl/tools/ij/mtGrammarConstants.java&lt;br/&gt;
generated/java/org/apache/derby/impl/tools/ij/mtGrammarTokenManager.java&lt;br/&gt;
generated/java/org/apache/derby/impl/tools/ij/SimpleCharStream.java&lt;br/&gt;
generated/java/org/apache/derby/impl/tools/ij/Token.java&lt;br/&gt;
generated/java/org/apache/derby/impl/tools/ij/TokenMgrError.java&lt;br/&gt;
generated/java/org/apache/derby/loc&lt;br/&gt;
generated/java/org/apache/derby/loc/messages_en.properties&lt;br/&gt;
generated/java/org/apache/derby/shared&lt;br/&gt;
generated/java/org/apache/derby/shared/common&lt;br/&gt;
generated/java/org/apache/derby/shared/common/sanity&lt;br/&gt;
generated/java/org/apache/derby/shared/common/sanity/SanityState.java&lt;br/&gt;
generated/java/org/apache/derby/shared/common/sanity/state.properties&lt;br/&gt;
generated/toursdb&lt;br/&gt;
generated/toursdb/derby.log&lt;br/&gt;
generated/toursdb/toursdb&lt;br/&gt;
generated/toursdb/toursdb.jar&lt;br/&gt;
generated/toursdb/toursdb.out&lt;br/&gt;
generated/toursdb/toursdb/...&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
------------------ REMAINING WORK ----------------&lt;br/&gt;
&lt;br/&gt;
More work may be needed to relocate the special artifacts created by the release build targets. Those targets may not behave correctly if you customize ${out.base}
&lt;p&gt;.&lt;/p&gt;


&lt;p&gt;------------------ STATE OF TESTING ----------------&lt;/p&gt;

&lt;p&gt;I have tested building a subversion client on both a host operating system and a guest operating system, with each os building into its own artifact tree.&lt;/p&gt;

&lt;p&gt;I have also built a release on my host operating system using the default $&lt;/p&gt;
{out.base}. The following artifacts (now built into the generated tree) appear in the correct locations in the bin distributions:&lt;br/&gt;
&lt;br/&gt;
- merged scripts in the bin directory&lt;br/&gt;
- toursdb database in demo/databases&lt;br/&gt;
&lt;br/&gt;
I am running regression tests against the host os build to verify that everything was generated correctly.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
------------------ HOW TO APPLY THE PATCH ----------------&lt;br/&gt;
&lt;br/&gt;
To apply this patch, do the following:&lt;br/&gt;
&lt;br/&gt;
o First, &quot;ant clean&quot; your subversion client. This removes most of the generated artifacts from your client (there are some stragglers like changenumber.properties which will still hang around). Technically, this step should not be necessary and if you omit this step, the build probably will function correctly after you apply the patch. However, I have not tested the case of applying this patch to a dirty client, so I advise you to &quot;ant clean&quot; first.&lt;br/&gt;
&lt;br/&gt;
o Then apply the patch as you would normally do.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
------------------ PATCH DETAILS ----------------&lt;br/&gt;
&lt;br/&gt;
Touches the following files:&lt;br/&gt;
&lt;br/&gt;
------&lt;br/&gt;
&lt;br/&gt;
M     .&lt;br/&gt;
&lt;br/&gt;
Updates the svn:ignore property so that the new generated directory does not confuse &quot;ant status&quot;.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
------&lt;br/&gt;
&lt;br/&gt;
M      tools/ant/properties/dirs.properties&lt;br/&gt;
&lt;br/&gt;
Adds the ${out.base}
&lt;p&gt; variable and makes it the root of the artifact directories.&lt;/p&gt;

&lt;p&gt;------&lt;/p&gt;

&lt;p&gt;M      java/tools/org/apache/derby/impl/tools/build.xml&lt;/p&gt;

&lt;p&gt;Builds the tools grammar into the generated tree.&lt;/p&gt;

&lt;p&gt;------&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/build.xml&lt;/p&gt;

&lt;p&gt;Builds the SQL grammar into the generated tree. Deletes the 3 artifacts which are overridden by checked-in sources:&lt;/p&gt;

&lt;p&gt;CharStream.java&lt;br/&gt;
ParseException.java&lt;br/&gt;
Token.java&lt;/p&gt;

&lt;p&gt;As a follow-on effort, we may want to consider eliminating the checked-in sources.&lt;/p&gt;

&lt;p&gt;------&lt;/p&gt;

&lt;p&gt;M      java/demo/build.xml&lt;br/&gt;
M      java/demo/toursdb/build.xml&lt;/p&gt;

&lt;p&gt;Drops the toursdb database into the generated directory.&lt;/p&gt;

&lt;p&gt;------&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/loc/build.xml&lt;/p&gt;

&lt;p&gt;Drops the English messages into the generated directory.&lt;/p&gt;

&lt;p&gt;------&lt;/p&gt;

&lt;p&gt;M      java/shared/build.xml&lt;/p&gt;

&lt;p&gt;Drops the sanity state into the generated directory.&lt;/p&gt;

&lt;p&gt;------&lt;/p&gt;

&lt;p&gt;M      tools/release/build.xml&lt;/p&gt;

&lt;p&gt;Now looks into the generated tree for toursdb and the merged bin scripts.&lt;/p&gt;

&lt;p&gt;------&lt;/p&gt;

&lt;p&gt;M      build.xml&lt;/p&gt;

&lt;p&gt;Changes to the master build script to pull all of this together.&lt;/p&gt;</comment>
                            <comment id="12912767" author="rhillegas" created="Tue, 21 Sep 2010 00:04:29 +0100"  >&lt;p&gt;The regression tests passed cleanly for me on jars built using this patch.&lt;/p&gt;</comment>
                            <comment id="12912878" author="knutanders" created="Tue, 21 Sep 2010 09:43:55 +0100"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;This looks like a good improvement to me.&lt;/p&gt;

&lt;p&gt;I think clean and clobber are essentially the same now. So whereas &quot;ant insane; ant clean; ant&quot; would previously build non-debug classes, the same sequence of commands will build debug classes after the patch has been checked in. Does that sound about right? I don&apos;t think this is a problem, but it might come as a surprise on someone.&lt;/p&gt;

&lt;p&gt;While you&apos;re at it, do you think it would make sense to&lt;/p&gt;

&lt;p&gt;a) remove the cleanparsers, cleantoursdb, cleancatalog and cleanstate targets from build.xml, since these are all taken care of implicitly by the clean target now?&lt;/p&gt;

&lt;p&gt;b) clear the svn:ignore property in&lt;/p&gt;

&lt;p&gt;java/demo/toursdb&lt;br/&gt;
java/tools/org/apache/derby/impl/tools/ij&lt;br/&gt;
java/engine/org/apache/derby/impl/sql/compile&lt;br/&gt;
java/engine/org/apache/derby/loc&lt;br/&gt;
java/shared/org/apache/derby/shared/common/sanity/&lt;/p&gt;

&lt;p&gt;so that &quot;svn status&quot; will warn us if we have old files lying around by accident?&lt;/p&gt;</comment>
                            <comment id="12912973" author="rhillegas" created="Tue, 21 Sep 2010 14:37:49 +0100"  >&lt;p&gt;Thanks for the quick review, Knut. I am attaching a second rev of the patch which addresses your point (b): derby-3986-02-ag-sanity-bin-toursdb-storeless-release.diff&lt;/p&gt;

&lt;p&gt;More responses follow:&lt;/p&gt;


&lt;p&gt;kah&amp;gt; I think clean and clobber are essentially the same now. So whereas &quot;ant insane; ant clean; ant&quot; would previously build non-debug classes, the same sequence of commands will build debug classes after the patch has been checked in. Does that sound about right? I don&apos;t think this is a problem, but it might come as a surprise on someone.&lt;/p&gt;

&lt;p&gt;Thanks for catching that. It might not be what someone wants. I could move the deletion of the generated tree to a new cleangenerated target. Then clean would go back to just deleting the built classes.&lt;/p&gt;

&lt;p&gt;kah&amp;gt; While you&apos;re at it, do you think it would make sense to&lt;/p&gt;

&lt;p&gt;kah&amp;gt; a) remove the cleanparsers, cleantoursdb, cleancatalog and cleanstate targets from build.xml, since these are all taken care of implicitly by the clean target now?&lt;/p&gt;

&lt;p&gt;If I created a cleangenerated target, then the other clean targets would still make sense I think. I don&apos;t know who uses these targets. However, now that you bring my attention to these targets, I think that cleanparsers needs to be changed to refer to the generated tree rather than the source tree, and cleanstate needs a little touchup too.&lt;/p&gt;

&lt;p&gt;So would the following make sense:&lt;/p&gt;

&lt;p&gt;i) Move cleangenerated logic out of clean into its own target&lt;/p&gt;

&lt;p&gt;ii) Tidy up the cleanparsers and cleanstate targets&lt;/p&gt;

&lt;p&gt;Of course, I could also eliminate the cleanparsers, cleantoursdb, cleancatalog, and cleanstate targets as you suggest. But these targets may still be useful. They may have been created to compensate for the spotty dependency tracking in our build scripts. What do you think?&lt;/p&gt;

&lt;p&gt;kah&amp;gt; b) clear the svn:ignore property in&lt;/p&gt;

&lt;p&gt;Thanks for this suggestion. I have included this in the new version of the patch, which I&apos;m attaching.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="12913049" author="knutanders" created="Tue, 21 Sep 2010 17:00:37 +0100"  >&lt;p&gt;&amp;gt; So would the following make sense:&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; i) Move cleangenerated logic out of clean into its own target&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; ii) Tidy up the cleanparsers and cleanstate targets&lt;/p&gt;

&lt;p&gt;Yes, makes sense. +1&lt;/p&gt;

&lt;p&gt;&amp;gt; Of course, I could also eliminate the cleanparsers, cleantoursdb,&lt;br/&gt;
&amp;gt; cleancatalog, and cleanstate targets as you suggest. But these&lt;br/&gt;
&amp;gt; targets may still be useful. They may have been created to&lt;br/&gt;
&amp;gt; compensate for the spotty dependency tracking in our build&lt;br/&gt;
&amp;gt; scripts. What do you think?&lt;/p&gt;

&lt;p&gt;I don&apos;t see much value in these targets myself, so unless someone&lt;br/&gt;
speaks up and says they actually use them regularly, I&apos;d suggest that&lt;br/&gt;
we take this opportunity to trim down the size of the build&lt;br/&gt;
script. I&apos;d rather add it back later if it turns out to be needed,&lt;br/&gt;
instead of keeping all the old cruft in case some of it turns out to&lt;br/&gt;
be useful.&lt;/p&gt;</comment>
                            <comment id="12913107" author="rhillegas" created="Tue, 21 Sep 2010 18:43:33 +0100"  >&lt;p&gt;Thanks for the additional quick feedback, Knut. Attaching a third rev of the patch: derby-3986-02-ah-sanity-bin-toursdb-storeless-release.diff. This new version adds a cleangenerated target and tidies up the other clean targets. I am inclined to check this in soon unless you see some problem with it.&lt;/p&gt;

&lt;p&gt;I think we should delete the useless clean targets as a separate patch. I would wait a week or so after committing the first patch, in order to give people time to adjust to the new generated directory, just in case there are problems. The cleanstate target is still used by the release machinery when building both sane and insane distributions. I recommend the following course of action for the next patch:&lt;/p&gt;

&lt;p&gt;o Remove cleanparsers, cleancatalog, cleantoursb&lt;/p&gt;

&lt;p&gt;o Leave the other clean targets: clean, cleangenerated, cleanstate, clobber&lt;/p&gt;

&lt;p&gt;Beyond that, we could consider another patch to remove cleangenerated and cleanstate. As a final piece of work, we could consider making clean and clobber synonyms.&lt;/p&gt;</comment>
                            <comment id="12913196" author="knutanders" created="Tue, 21 Sep 2010 20:26:19 +0100"  >&lt;p&gt;&amp;gt; I am inclined to check this in soon unless you see some problem with it.&lt;/p&gt;

&lt;p&gt;+1 to checking in the patch, and to your proposed way forward.&lt;/p&gt;</comment>
                            <comment id="12913537" author="rhillegas" created="Wed, 22 Sep 2010 14:12:32 +0100"  >&lt;p&gt;Thanks, Knut. Committed derby-3986-02-ah-sanity-bin-toursdb-storeless-release.diff at subversion revision 999928.&lt;/p&gt;</comment>
                            <comment id="12913545" author="rhillegas" created="Wed, 22 Sep 2010 14:25:59 +0100"  >&lt;p&gt;I have created a new issue, &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4811&quot; title=&quot;Remove unused clean targets from the Derby build.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4811&quot;&gt;&lt;del&gt;DERBY-4811&lt;/del&gt;&lt;/a&gt;, to track the simplification of the clean targets.&lt;/p&gt;

&lt;p&gt;The following work remains to be done on this issue: Adjust the release build targets so that they stop dropping their artifacts in subversion-controlled space.&lt;/p&gt;</comment>
                            <comment id="12913645" author="knutanders" created="Wed, 22 Sep 2010 17:20:16 +0100"  >&lt;p&gt;I also removed the svn:ignore property on the bin directory and committed revision 1000066.&lt;/p&gt;</comment>
                            <comment id="12913648" author="knutanders" created="Wed, 22 Sep 2010 17:26:32 +0100"  >&lt;p&gt;I noticed that the generated bin scripts don&apos;t have the executable bit set after these changes. The attached patch (chmod.diff) corrects the path in the chmod command in the makebinscript target.&lt;/p&gt;

&lt;p&gt;Committed revision 1000068.&lt;/p&gt;</comment>
                            <comment id="12913779" author="knutanders" created="Wed, 22 Sep 2010 21:47:42 +0100"  >&lt;p&gt;I noticed that some automated build jobs started failing after these changes. The jobs did &quot;ant insane&quot; on a clean setup, and failed because the &quot;insane&quot; target tried to create state.properties in a directory that hadn&apos;t been created yet. The same problem can be seen by invoking &quot;ant sane&quot; or &quot;ant insane&quot; right after an &quot;ant clobber&quot;.&lt;/p&gt;

&lt;p&gt;Attaching a patch (mk-sanity-dir.diff) that makes the &quot;sane&quot; and &quot;insane&quot; targets depend on &quot;make-generated-dirs&quot;. I can now run &quot;ant sane&quot; and &quot;ant insane&quot; on a clean checkout again. Will commit shortly.&lt;/p&gt;</comment>
                            <comment id="12913782" author="knutanders" created="Wed, 22 Sep 2010 21:52:54 +0100"  >&lt;p&gt;Committed revision 1000219.&lt;/p&gt;</comment>
                            <comment id="12914102" author="kmarsden" created="Thu, 23 Sep 2010 18:09:54 +0100"  >&lt;p&gt;I noticed in my client and in the IBM nightly Linux build that ant clobber was not a good enough cleanup.&lt;br/&gt;
The following errors occurred:&lt;/p&gt;

&lt;p&gt;	    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /local1/cloudtst/dev/src/opensource/generated/java/org/apache/derby/impl/sql/compile/SQLParser.java:152: duplicate class: org.apache.derby.impl.sql.compile.SQLParser&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class SQLParser implements SQLParserConstants {&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /local1/cloudtst/dev/src/opensource/generated/java/org/apache/derby/impl/sql/compile/SQLParserConstants.java:25: duplicate class: org.apache.derby.impl.sql.compile.SQLParserConstants&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public interface SQLParserConstants {&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /local1/cloudtst/dev/src/opensource/generated/java/org/apache/derby/impl/sql/compile/SQLParserTokenManager.java:136: duplicate class: org.apache.derby.impl.sql.compile.SQLParserTokenManager&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class SQLParserTokenManager implements SQLParserConstants&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /local1/cloudtst/dev/src/opensource/generated/java/org/apache/derby/impl/sql/compile/TokenMgrError.java:25: duplicate class: org.apache.derby.impl.sql.compile.TokenMgrError&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class TokenMgrError extends Error&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; 4 errors&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /local1/cloudtst/dev/src/opensource/generated/java/org/apache/derby/impl/tools/ij/CharStream.java:19: duplicate class: org.apache.derby.impl.tools.ij.CharStream&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public interface CharStream {&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /local1/cloudtst/dev/src/opensource/generated/java/org/apache/derby/impl/tools/ij/SimpleCharStream.java:9: duplicate class: org.apache.derby.impl.tools.ij.SimpleCharStream&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class SimpleCharStream&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /local1/cloudtst/dev/src/opensource/generated/java/org/apache/derby/impl/tools/ij/Token.java:8: duplicate class: org.apache.derby.impl.tools.ij.Token&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class Token {&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /local1/cloudtst/dev/src/opensource/generated/java/org/apache/derby/impl/tools/ij/TokenMgrError.java:4: duplicate class: org.apache.derby.impl.tools.ij.TokenMgrError&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; public class TokenMgrError extends Error&lt;br/&gt;
		    &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; /local1/cloudtst/dev/src/opensource/generated/java/org/apache/derby/impl/tools/ij/ij.java:67: duplicate class: org.apache.derby.impl.tools.ij.ij&lt;/p&gt;


&lt;p&gt;I removed the following files that showed as ? in svn stat and did update to get toursdb and  then could build.&lt;br/&gt;
       java/tools/org/apache/derby/impl/tools/ij/ijConstants.java&lt;br/&gt;
       java/tools/org/apache/derby/impl/tools/ij/ijTokenManager.java&lt;br/&gt;
       java/tools/org/apache/derby/impl/tools/ij/TokenMgrError.java&lt;br/&gt;
       java/tools/org/apache/derby/impl/tools/ij/ij.java&lt;br/&gt;
       java/tools/org/apache/derby/impl/tools/ij/SimpleCharStream.java&lt;br/&gt;
       java/tools/org/apache/derby/impl/tools/ij/Token.java&lt;br/&gt;
       java/tools/org/apache/derby/impl/tools/ij/mtGrammarTokenManager.java&lt;br/&gt;
       java/tools/org/apache/derby/impl/tools/ij/mtGrammarConstants.java&lt;br/&gt;
       java/tools/org/apache/derby/impl/tools/ij/mtGrammar.java&lt;br/&gt;
       java/tools/org/apache/derby/impl/tools/ij/CharStream.java&lt;br/&gt;
       java/demo/toursdb/toursdb&lt;br/&gt;
       java/demo/toursdb/derby.log&lt;br/&gt;
       java/demo/toursdb/toursdb.out&lt;br/&gt;
       java/demo/toursdb/toursdb.jar&lt;br/&gt;
       java/engine/org/apache/derby/impl/sql/compile/SQLParserTokenManager.java&lt;br/&gt;
       java/engine/org/apache/derby/impl/sql/compile/SQLParser.java&lt;br/&gt;
       java/engine/org/apache/derby/impl/sql/compile/TokenMgrError.java&lt;br/&gt;
       java/engine/org/apache/derby/impl/sql/compile/SQLParserConstants.java&lt;br/&gt;
       java/engine/org/apache/derby/loc/messages_en.properties&lt;br/&gt;
       java/shared/org/apache/derby/shared/common/sanity/SanityState.java&lt;br/&gt;
       bin/NetworkServerControl&lt;br/&gt;
       bin/stopNetworkServer&lt;br/&gt;
       bin/sysinfo&lt;br/&gt;
       bin/startNetworkServer&lt;br/&gt;
       bin/ij&lt;br/&gt;
      bin/dblook&lt;/p&gt;

</comment>
                            <comment id="12914108" author="myrna" created="Thu, 23 Sep 2010 18:16:19 +0100"  >&lt;p&gt;Just to add my experience after these changes...&lt;br/&gt;
I found that ant clobber did not fully clean up the files left over.&lt;br/&gt;
Perhaps I should have done ant clobber &lt;b&gt;before&lt;/b&gt; svn update (...)&lt;/p&gt;

&lt;p&gt;Without doing a manual clean up of the tree (based on svn stat), I got errors about duplicate classes (in the parser area) which makes sense.&lt;/p&gt;

&lt;p&gt;Oddly enough, svn stat also showed up a number of files in the bin directory, like NetworkServerControl.&lt;br/&gt;
I assume I should have cleaned those up a long time ago?&lt;/p&gt;

&lt;p&gt;After cleaning up, in one of my environments, where I didn&apos;t set sane/insane at all, I then saw some errors indicating missing files, but running ant with -Dsane=false cleared that up, and all looks ok now for me.&lt;/p&gt;</comment>
                            <comment id="12914114" author="knutanders" created="Thu, 23 Sep 2010 18:34:53 +0100"  >&lt;p&gt;I think the issue Kathey experienced is expected if ant clobber wasn&apos;t performed before svn update. It should only happen once, since those files won&apos;t be generated in an updated checkout.&lt;/p&gt;

&lt;p&gt;The files Myrna found in bin are the scripts we generate at build time after &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3207&quot; title=&quot;The bin scripts should be able to run when DERBY_HOME is not set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3207&quot;&gt;&lt;del&gt;DERBY-3207&lt;/del&gt;&lt;/a&gt;. They went directly into the bin directory before Rick&apos;s changes, but now they go into the generated directory too.&lt;/p&gt;</comment>
                            <comment id="12914117" author="rhillegas" created="Thu, 23 Sep 2010 18:43:49 +0100"  >&lt;p&gt;Hi Kathey and Myrna,&lt;/p&gt;

&lt;p&gt;Did you perform the following steps in this order when you sync&apos;d up to the changes introduced by this patch:&lt;/p&gt;

&lt;p&gt;ant clobber&lt;br/&gt;
svn update&lt;/p&gt;

&lt;p&gt;That is the order of operations which is expected to work. The reverse order will leave a lot of cruft in the source tree. The cruft will confuse the build and produce a lot of noise for &quot;svn status&quot;. So just to repeat, the following sequence of steps will result in an experience which is consistent with the symptoms you are seeing:&lt;/p&gt;

&lt;p&gt;svn update&lt;br/&gt;
ant clobber&lt;/p&gt;

&lt;p&gt;If your environments are still broken, the following may help:&lt;/p&gt;

&lt;p&gt;1) Throw away your subversion client and re-initialize it from scratch. This is the technique used by Kristian and Knut to unwedge the automated builds.&lt;/p&gt;

&lt;p&gt;2) Or, set your client to before revision 999928, then do &quot;ant clobber&quot;, then do &quot;svn update&quot;&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="12914119" author="myrna" created="Thu, 23 Sep 2010 18:45:56 +0100"  >&lt;p&gt;I didn&apos;t study the build.xml closely, but is that something that will trip us up come release time? These files need to go into the bin dir in the bin distributions...&lt;/p&gt;</comment>
                            <comment id="12914124" author="rhillegas" created="Thu, 23 Sep 2010 18:53:42 +0100"  >&lt;p&gt;Hi Myrna,&lt;/p&gt;

&lt;p&gt;Thanks for bringing up this topic. I did edit the release targets and I did verify that the scripts are being dropped into the bin directories of the release distributions. See the STATE OF TESTING section of my long comment on 20-Sep-2010 above. The distributions look correct to me, but this is clearly an area we will have to watch closely when we release 10.7. Thanks.&lt;/p&gt;</comment>
                            <comment id="12914148" author="myrna" created="Thu, 23 Sep 2010 19:34:08 +0100"  >&lt;p&gt;Thanks for this improvement, Rick, looks like you thought of everything. Apologies for my lack of attention to your instructions. All works fine for me now.&lt;/p&gt;</comment>
                            <comment id="12914183" author="kmarsden" created="Thu, 23 Sep 2010 20:30:00 +0100"  >&lt;p&gt;yes, user error here too. It&apos;s probably not worth changing the nighties order of things although  it does make sense to clobber at the same level you built.&lt;/p&gt;</comment>
                            <comment id="12916453" author="knutanders" created="Thu, 30 Sep 2010 13:33:15 +0100"  >&lt;p&gt;I noticed some more automated build jobs that stopped working after these changes. These jobs were running &quot;ant release&quot; and failed with&lt;/p&gt;

&lt;p&gt;(...)/tools/release/build.xml:207: Class org.apache.tools.ant.taskdefs.Tar$TarFileSet doesn&apos;t support the &quot;filemode&quot; attribute.&lt;/p&gt;

&lt;p&gt;The problem was that the changes introduced a dependency on Ant 1.7, and the build jobs used Ant 1.6.5. Changing the build environment to something newer made the problem go away. I think this is fine, since BUILDING.html already states that Ant 1.7.0 or higher is required, but I thought I&apos;d mention it in case others come across the same issue.&lt;/p&gt;</comment>
                            <comment id="12916460" author="knutanders" created="Thu, 30 Sep 2010 13:52:03 +0100"  >&lt;p&gt;One small observation regarding the &quot;filemode&quot; attribute error mentioned above. The change that triggered it introduced a tiny inconsistency, as can be seen here:&lt;/p&gt;

&lt;p&gt;      &amp;lt;!-- bin --&amp;gt;&lt;br/&gt;
      &amp;lt;tarfileset dir=&quot;$&lt;/p&gt;
{basedir}
&lt;p&gt;/bin&quot; prefix=&quot;$&lt;/p&gt;
{derby.bin}/bin&quot; &lt;br/&gt;
                  mode=&quot;755&quot; includes=&quot;*&quot; excludes=&quot;templates&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;tarfileset dir=&quot;${generated.bin.dir}&quot; prefix=&quot;${derby.bin}
&lt;p&gt;/bin&quot; &lt;br/&gt;
                  filemode=&quot;755&quot; includes=&quot;*&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;The old target uses the &quot;mode&quot; attribute, whereas the new target uses &quot;filemode&quot;. We should use the same for both the tarfilesets. &quot;mode&quot; seems to work with both Ant 1.6.5 and Ant 1.7.x, but only &quot;filemode&quot; is mentioned in the 1.7.x manuals, as far as I can see, so we should probably stick to that one.&lt;/p&gt;

&lt;p&gt;Unless there are any objections, I plan to commit the attached patch (filemode.diff) to make both the tarfilesets use &quot;filemode&quot;.&lt;/p&gt;</comment>
                            <comment id="12916807" author="knutanders" created="Fri, 1 Oct 2010 08:12:25 +0100"  >&lt;p&gt;Committed revision 1003408.&lt;/p&gt;</comment>
                            <comment id="12916986" author="rhillegas" created="Fri, 1 Oct 2010 19:13:14 +0100"  >&lt;p&gt;Attaching derby-3986-03-aa-release.diff. This patch changes the build so that release artifacts are now dropped outside subversion-controlled space as other build artifacts are. This change should not disrupt the build for most people. Committed at subversion revision 1003607.&lt;/p&gt;

&lt;p&gt;This patch makes a number of changes:&lt;/p&gt;

&lt;p&gt;1) Creates a new artifact directory called &quot;release&quot; rooted off $&lt;/p&gt;
{out.base}. This new directory sits parallel to classes, generated, jars, and javadoc. This directory will now be created every time you build Derby and the directory will be deleted when you issue an &quot;ant clobber&quot;.&lt;br/&gt;
&lt;br/&gt;
2) Drops all release artifacts into the new release tree. This includes snapshots, release distributions, and the temporary directories needed to create them.&lt;br/&gt;
&lt;br/&gt;
3) Eliminates the packaging.properties file, which release managers were expected to create from packaging.tmpl. Instead, the release machinery now just uses packaging.tmpl directly. Rather than creating packaging.properties to override the default values in packaging.tmpl, now you just override the release properties the same way you override other build properties: i.e., by putting overrides in your ant.properties or specifying them on the command line.&lt;br/&gt;
&lt;br/&gt;
4) Makes environment variables visible to the release-building machinery. This makes it possible for you to phrase your ant.properties in terms of environment variables which can be overridden in your shell or script. An ant reference to an environment variable looks like this:&lt;br/&gt;
&lt;br/&gt;
  ${env.FOO}&lt;br/&gt;
&lt;br/&gt;
where FOO is an environment variable set by a shell statement like this:&lt;br/&gt;
&lt;br/&gt;
  export FOO=/bar/wibble/wombat&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Touches the following files:&lt;br/&gt;
&lt;br/&gt;
---------&lt;br/&gt;
&lt;br/&gt;
 M     .&lt;br/&gt;
&lt;br/&gt;
Adds the new release directory to the list of files ignored by &quot;svn status&quot;.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
---------&lt;br/&gt;
&lt;br/&gt;
M      tools/ant/properties/dirs.properties&lt;br/&gt;
M      tools/ant/properties/packaging.tmpl&lt;br/&gt;
&lt;br/&gt;
Defines release directories relative to ${out.base}
&lt;p&gt;.&lt;/p&gt;


&lt;p&gt;---------&lt;/p&gt;

&lt;p&gt;M      build.xml&lt;br/&gt;
M      tools/release/build.xml&lt;/p&gt;

&lt;p&gt;Wires these changes into the release machinery.&lt;/p&gt;</comment>
                            <comment id="12930179" author="rhillegas" created="Tue, 9 Nov 2010 16:11:48 +0000"  >&lt;p&gt;Attaching derby-3986-04-aa-toursdb-load-tables.diff. This fixes something broken by the 02 patch: Starting with the previous patch, the loading of the toursdb tables stopped working because the loadTables.sql script ran other scripts using file names relative to the current directory. The previous patch changed the current directory of the ij invocation, moving from the source tree into the generated tree. Committed at subversion revision 1033052.&lt;/p&gt;

&lt;p&gt;This patch introduces a new runijscript target and runs each of the smaller load scripts individually.&lt;/p&gt;

&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;M      java/demo/toursdb/build.xml&lt;/p&gt;</comment>
                            <comment id="12931177" author="rhillegas" created="Thu, 11 Nov 2010 20:05:10 +0000"  >&lt;p&gt;Attaching derby-3986-05-aa-class_size_catalog.diff. This patch improves the dependency tracking for ClassSizeCatalog. Committed at subversion revision 1034093.&lt;/p&gt;

&lt;p&gt;Right now we are running the class_size_catalog target every time we build because we are still looking for ClassSizeCatalog over in the source tree. But this intermediate source file now lives in the generated source directory. This patch corrects the dependency tracking to look for ClassSizeCatalog in the generated tree rather than in the source tree.&lt;/p&gt;

&lt;p&gt;Touches the following file:&lt;/p&gt;

&lt;p&gt;M      build.xml&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12478881">DERBY-4882</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12474815">DERBY-4811</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12455278" name="chmod.diff" size="474" author="knutanders" created="Wed, 22 Sep 2010 17:26:32 +0100"/>
                            <attachment id="12396347" name="derby-3986-01-aa-checkCompilerLevel.diff" size="937" author="rhillegas" created="Wed, 17 Dec 2008 21:57:00 +0000"/>
                            <attachment id="12455052" name="derby-3986-02-af-sanity-bin-toursdb-storeless-release.diff" size="23893" author="rhillegas" created="Mon, 20 Sep 2010 17:51:01 +0100"/>
                            <attachment id="12455140" name="derby-3986-02-ag-sanity-bin-toursdb-storeless-release.diff" size="24998" author="rhillegas" created="Tue, 21 Sep 2010 14:37:49 +0100"/>
                            <attachment id="12455164" name="derby-3986-02-ah-sanity-bin-toursdb-storeless-release.diff" size="26293" author="rhillegas" created="Tue, 21 Sep 2010 18:43:33 +0100"/>
                            <attachment id="12456150" name="derby-3986-03-aa-release.diff" size="11292" author="rhillegas" created="Fri, 1 Oct 2010 19:13:14 +0100"/>
                            <attachment id="12459164" name="derby-3986-04-aa-toursdb-load-tables.diff" size="3845" author="rhillegas" created="Tue, 9 Nov 2010 16:11:48 +0000"/>
                            <attachment id="12459376" name="derby-3986-05-aa-class_size_catalog.diff" size="696" author="rhillegas" created="Thu, 11 Nov 2010 20:05:10 +0000"/>
                            <attachment id="12456005" name="filemode.diff" size="658" author="knutanders" created="Thu, 30 Sep 2010 13:52:03 +0100"/>
                            <attachment id="12455308" name="mk-sanity-dir.diff" size="816" author="knutanders" created="Wed, 22 Sep 2010 21:47:42 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 18 Aug 2009 16:06:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31084</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0p4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37888</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>