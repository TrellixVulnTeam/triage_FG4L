<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:48:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4667/DERBY-4667.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4667] BootLockTest.testBootLock()  sometimes fails with connection refused.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4667</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;It may just be related to firewall interference, but sometimes testBootLock fails with:&lt;/p&gt;

&lt;p&gt;1) testBootLock(org.apache.derbyTesting.functionTests.tests.store.BootLockTest)j&lt;br/&gt;
unit.framework.AssertionFailedError: Minion did not start or boot db in 60 secon&lt;br/&gt;
ds.&lt;br/&gt;
----Minion&apos;s stderr:&lt;br/&gt;
java.net.ConnectException: Connection refused: connect  at java.net.PlainSocketI&lt;br/&gt;
mpl.socketConnect(Native Method)        at java.net.PlainSocketImpl.doConnect(Pl&lt;br/&gt;
ainSocketImpl.java:352) at java.net.PlainSocketImpl.connectToAddress(PlainSocket&lt;br/&gt;
Impl.java:214)  at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:201)at&lt;br/&gt;
java.net.SocksSocketImpl.connect(SocksSocketImpl.java:378)      at java.net.Sock&lt;br/&gt;
et.connect(Socket.java:537)     at java.net.Socket.connect(Socket.java:487)&lt;br/&gt;
----Minion&apos;s stderr ended&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.store.BootLockTest.testBo&lt;br/&gt;
otLock(BootLockTest.java:173)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.&lt;br/&gt;
java:48)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces&lt;br/&gt;
sorImpl.java:37)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:&lt;br/&gt;
109)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:16)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57&lt;br/&gt;
)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:16)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:16)&lt;/p&gt;

&lt;p&gt;It used to pass on my machine, but I got this today and I think the IBM nightly runs have been hitting the problem.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12464990">DERBY-4667</key>
            <summary>BootLockTest.testBootLock()  sometimes fails with connection refused.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 May 2010 03:48:32 +0100</created>
                <updated>Wed, 12 Jan 2011 22:24:41 +0000</updated>
                            <resolved>Fri, 18 Jun 2010 19:39:23 +0100</resolved>
                                    <version>10.7.1.1</version>
                                    <fixVersion>10.7.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12869460" author="mamtas" created="Thu, 20 May 2010 04:16:48 +0100"  >&lt;p&gt;I saw it to today on my windows xp with ibm16&lt;/p&gt;

&lt;p&gt;1) testBootLock(org.apache.derbyTesting.functionTests.tests.store.BootLockTest)junit.framework.AssertionFailedError: Minion did not start or boot db in 60 seconds.&lt;br/&gt;
----Minion&apos;s stderr:&lt;br/&gt;
java.net.ConnectException: Connection refused: connect	at java.net.PlainSocketImpl.socketConnect(Native Method)	at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:352)	at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:214)	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:201)	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:368)	at java.net.Socket.connect(Socket.java:526)	at java.net.Socket.connect(Socket.java:476)&lt;br/&gt;
----Minion&apos;s stderr ended&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.store.BootLockTest.testBootLock(BootLockTest.java:173)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:16)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:16)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:16)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 12500,  Failures: 1,  Errors: 0&lt;/p&gt;</comment>
                            <comment id="12870123" author="kmarsden" created="Fri, 21 May 2010 20:30:33 +0100"  >&lt;p&gt;Below are my brief  and somewhat random thoughts on this issue.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;My gut feel is that this is some sort of firewall interference.  If someone can reproduce, you might want to turn your firewall off to verify.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The test coordinates launch of a spawned process with a socket, but it actually uses the same port as network server and the java in $JAVA_HOME/bin so while it feels like a firewall issue, I am don&apos;t really understand why the firewall would complain.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Mike suggested a previous tests network server process might be interfering and the port reused too quickly but I think if the previous tests network server did a clean shutdown that should not be the problem.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I thought maybe the test could instead of opening a socket,  verify that the spawned test had booted derby by just checking for the lock file, but if that is the solution, it would be good to understand first why the socket solution sometimes fails.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12870135" author="mamtas" created="Fri, 21 May 2010 20:59:34 +0100"  >&lt;p&gt;I ran the test stand alone handful of times and can&apos;t reproduce the problem. Following is the screen output of one of the test runs.&lt;/p&gt;

&lt;p&gt;$ java  -Dderby.tests.trace=true  -Xmx256M -XX:MaxPermSize=128M junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.store.BootLockTest&lt;br/&gt;
.&lt;br/&gt;
testBootLock used 14375 ms&lt;br/&gt;
Time: 16.5&lt;/p&gt;

&lt;p&gt;OK (1 test)&lt;/p&gt;</comment>
                            <comment id="12870139" author="mamtas" created="Fri, 21 May 2010 21:10:25 +0100"  >&lt;p&gt;I will run the store suite org.apache.derbyTesting.functionTests.tests.store._Suite (this suite includes BootLockTest) to see if the previous test(s) might be interfering with BootLockTest.&lt;/p&gt;</comment>
                            <comment id="12870246" author="dagw" created="Sat, 22 May 2010 01:41:51 +0100"  >&lt;p&gt;Would changing the port to the one used by the replication tests for example, make the problem go away? Or could it be that the minion somehow races past the parent (including creating a Derby database..??!) before the parent has set up the server port?&lt;br/&gt;
In the latter case, a solution could be to set up the port &lt;b&gt;before&lt;/b&gt; forking. Weird..&lt;/p&gt;</comment>
                            <comment id="12870711" author="mamtas" created="Mon, 24 May 2010 18:01:24 +0100"  >&lt;p&gt;BTW, I ran the store suite multiple times on my laptop and didn&apos;t see the failure.&lt;/p&gt;</comment>
                            <comment id="12871446" author="mamtas" created="Wed, 26 May 2010 01:07:28 +0100"  >&lt;p&gt;Thought I would share that the test problem didn&apos;t repro on IBM&apos;s nightly machine either. I tried it both standalone and as part of store suite.&lt;/p&gt;</comment>
                            <comment id="12871466" author="kmarsden" created="Wed, 26 May 2010 01:48:35 +0100"  >&lt;p&gt;Mamta, do you have the test directory of a failing run?    If so, might there be some clues in there as to the reason for the failure, like something in the derby.log?  Otherwise could we add more debug information in the event of a failure?&lt;/p&gt;</comment>
                            <comment id="12871834" author="mamtas" created="Wed, 26 May 2010 18:24:16 +0100"  >&lt;p&gt;I do not have the test directory from my laptop. If I see the failure again, I will surely attach the derby.log and any other information that might look relevant. &lt;/p&gt;

&lt;p&gt;In the mean time, I will look into adding some debug info in the test. Does anyone have any ideas on what might be useful to dump in case of failures? I have not looked at the test myself yet.&lt;/p&gt;</comment>
                            <comment id="12874812" author="kmarsden" created="Wed, 2 Jun 2010 22:39:36 +0100"  >&lt;p&gt;I am attaching the output from this failure when it once happened.   &lt;/p&gt;

&lt;p&gt;The interesting things I noticed are:&lt;br/&gt;
1) The  BootLockTestDB  database got created just fine by the forked process at 2010-06-02 09:25:34.284 GMT&lt;br/&gt;
2) The last thing in the parent process (derby.log) were a start and stop of network server at:&lt;br/&gt;
 2010-06-02 09:25:32.862 GMT : Apache Derby Network Server - 10.7.0.0 alpha - (949333) started and ready to accept connections on port 1527&lt;/p&gt;

&lt;p&gt;2010-06-02 09:25:33.268 GMT : Apache Derby Network Server - 10.7.0.0 alpha - (949333) shutdown&lt;/p&gt;

&lt;p&gt;My impression is that even though the test is not running any fixtures in network sever mode it is starting and stopping network server for some reason and doing so, so close to the time  that the port is being used for the synchronization that it interferes.  I&apos;ll take a look at the test.&lt;/p&gt;</comment>
                            <comment id="12874852" author="kmarsden" created="Thu, 3 Jun 2010 00:21:15 +0100"  >&lt;p&gt;I think the quick start and stop of network server is from the previous test Derby151Test, which has just one fixture which doesn&apos;t actually run on the IBM jvm, because of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4463&quot; title=&quot;JMX test in nightly test suite failed with:  JMXTest:clientjava.lang.InterruptedException:  &quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4463&quot;&gt;&lt;del&gt;DERBY-4463&lt;/del&gt;&lt;/a&gt;.  I am moving the vm logic outside of the fixture to avoid this and will let the IBM run, run tonight as I am curious if that is causing the problem.&lt;/p&gt;

</comment>
                            <comment id="12879560" author="kmarsden" created="Wed, 16 Jun 2010 23:38:13 +0100"  >&lt;p&gt;Attached is a new patch for this issue. I removed the socket synchronization and just have the calling test wait for the lock file to be created before attempting the dual boot.  I can&apos;t say I totally understand the socket issue, but since the new approach doesn&apos;t use sockets, it should be ok.&lt;/p&gt;


</comment>
                            <comment id="12880273" author="kmarsden" created="Fri, 18 Jun 2010 19:14:46 +0100"  >&lt;p&gt;I think this is actually just a trunk issue. Only trunk  has the converted test.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12446180" name="BootLockTestFailure.zip" size="69315" author="kmarsden" created="Wed, 2 Jun 2010 22:39:36 +0100"/>
                            <attachment id="12447290" name="derby-4664_diff.txt" size="1459" author="kmarsden" created="Wed, 16 Jun 2010 23:38:13 +0100"/>
                            <attachment id="12446198" name="reorgDerby151TestForDerby4667_diff.txt" size="2321" author="kmarsden" created="Thu, 3 Jun 2010 00:21:15 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 20 May 2010 03:16:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0nw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37689</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>