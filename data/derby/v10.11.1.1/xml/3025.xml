<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:18:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3025/DERBY-3025.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3025] NPE when connecting to database with securityMechanism=8</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3025</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If derby.drda.securityMechanism has &lt;b&gt;not&lt;/b&gt; been set to STRONG_PASSWORD_SUBSTITUTE_SECURITY and the database is opened with the securityMechanism=8 property set, a NPE is thrown:&lt;/p&gt;

&lt;p&gt;// Try opening the database.&lt;br/&gt;
Properties props = new Properties();&lt;br/&gt;
props.put(&quot;securityMechanism&quot;, &quot;8&quot;);&lt;br/&gt;
props.put(&quot;user&quot;, dbUser);&lt;br/&gt;
props.put(&quot;password&quot;, dbPass);&lt;br/&gt;
Connection db = null;&lt;br/&gt;
try &lt;/p&gt;
{
    StringBuilder sb = new StringBuilder(&quot;jdbc:derby:&quot;);
    sb.append(dbName);
    db = DriverManager.getConnection(sb.toString(), props);
}
&lt;p&gt;    // Handle exception&lt;br/&gt;
} &lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&apos;. &lt;span class=&quot;error&quot;&gt;&amp;#91;XJ001&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection30.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection40.&amp;lt;init&amp;gt;(Unknown Source)&lt;br/&gt;
        at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Unknown Source)&lt;br/&gt;
        at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source)&lt;br/&gt;
        at org.apache.derby.jdbc.AutoloadedDriver.connect(Unknown Source)&lt;br/&gt;
        at java.sql.DriverManager.getConnection(DriverManager.java:582)&lt;br/&gt;
        at java.sql.DriverManager.getConnection(DriverManager.java:154)&lt;br/&gt;
        at org.opensolaris.auth.db.DBManager.openDatabase(DBManager.java:152)&lt;br/&gt;
        ... 1 more&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)&lt;br/&gt;
        ... 16 more&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derby.impl.jdbc.authentication.AuthenticationServiceBase.substitutePassword(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.authentication.BasicAuthenticationServiceImpl.authenticateUser(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.authentication.AuthenticationServiceBase.authenticate(Unknown Source)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.checkUserCredentials(Unknown Source)&lt;br/&gt;
        ... 10 more &lt;/p&gt;</description>
                <environment>Solaris x86</environment>
        <key id="12376701">DERBY-3025</key>
            <summary>NPE when connecting to database with securityMechanism=8</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="alanbur">Alan Burlison</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Aug 2007 11:28:56 +0100</created>
                <updated>Fri, 21 Jan 2011 17:50:47 +0000</updated>
                            <resolved>Wed, 29 Aug 2007 08:03:17 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.2.1</fixVersion>
                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12522723" author="knutanders" created="Sat, 25 Aug 2007 08:00:03 +0100"  >&lt;p&gt;Link to discussion on derby-user: &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/db-derby-user/200708.mbox/%3c46CCA045.50406@sun.com%3e&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/db-derby-user/200708.mbox/%3c46CCA045.50406@sun.com%3e&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12522726" author="knutanders" created="Sat, 25 Aug 2007 08:28:30 +0100"  >&lt;p&gt;I think the problem is that the embedded driver will try to use the securityMechanism attribute even though it does not make any sense in an embedded context.&lt;/p&gt;

&lt;p&gt;If I use a debug-enabled build, I get an assert failure instead of a NullPointerException:&lt;/p&gt;

&lt;p&gt;Caused by: org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED Unexpected: Requester or server seed not available&lt;br/&gt;
        at org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:120)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.authentication.AuthenticationServiceBase.substitutePassword(AuthenticationServiceBase.java:489)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.authentication.BasicAuthenticationServiceImpl.authenticateUser(BasicAuthenticationServiceImpl.java:228)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.authentication.AuthenticationServiceBase.authenticate(AuthenticationServiceBase.java:222)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.checkUserCredentials(EmbedConnection.java:582)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.&amp;lt;init&amp;gt;(EmbedConnection.java:280)&lt;br/&gt;
        ... 17 more&lt;/p&gt;

&lt;p&gt;Perhaps we could remove the assert and instead throw a real SQLException with a message saying &quot;The securityMechanism connection attribute should not be used on an embedded connection.&quot;&lt;/p&gt;</comment>
                            <comment id="12522759" author="knutanders" created="Sat, 25 Aug 2007 16:49:10 +0100"  >&lt;p&gt;Alan Burlison said on derby-user (and he is quite right):&lt;/p&gt;

&lt;p&gt;Hmm, aren&apos;t unrecognised properties just silently ignored?  Shouldn&apos;t&lt;br/&gt;
this be the same?&lt;/p&gt;</comment>
                            <comment id="12522760" author="knutanders" created="Sat, 25 Aug 2007 16:54:07 +0100"  >&lt;p&gt;Attaching a patch (d3025-test.diff) which adds a test case which reproduces the bug to NSSecurityMechanismTest.&lt;/p&gt;</comment>
                            <comment id="12522765" author="knutanders" created="Sat, 25 Aug 2007 17:32:30 +0100"  >&lt;p&gt;Attaching a patch which seems to fix the bug. I haven&apos;t run the regression tests yet.&lt;/p&gt;

&lt;p&gt;When the client driver connects to the server with securityMechanism in the connection attributes, the attribute is stripped off by the client driver and the security mechanism is specified in a field defined by the DRDA protocol instead. On the server, information about the security mechanism is extracted and put back into the connection attributes and used when creating an embedded connection. The connection attributes used on the server include securityMechanism and possibly some internal attributes. The problem is caused by the server reusing the attribute name securityMechanism. The authentication code (within the embedded driver) should only care about the attribute if it was added by the server, but there is no way to figure out whether that was the case.&lt;/p&gt;

&lt;p&gt;The patch fixes the problem by using an internal attribute name (drdaSecMec) instead of securityMechanism to communicate to the embedded driver that a security mechanism is used. Of course, this doesn&apos;t prevent a user from specifying drdaSecMec when connecting to the embedded driver, but it is less likely that a user by mistake types an internal attribute name than the name of a documented client driver attribute.&lt;/p&gt;</comment>
                            <comment id="12522837" author="knutanders" created="Sun, 26 Aug 2007 09:35:04 +0100"  >&lt;p&gt;The regression tests passed.&lt;/p&gt;</comment>
                            <comment id="12523308" author="dagw" created="Tue, 28 Aug 2007 20:01:51 +0100"  >&lt;p&gt;I looked at this patch and it looks clean to me.&lt;/p&gt;

&lt;p&gt;I ran the expanded test (NSSecurityMechanismTest) without the&lt;br/&gt;
main patch and it failed as expected. With the patch it worked.&lt;/p&gt;

&lt;p&gt;+1 to commit.&lt;/p&gt;</comment>
                            <comment id="12523361" author="forsini" created="Tue, 28 Aug 2007 22:51:52 +0100"  >&lt;p&gt;Interesting case indeed.&lt;/p&gt;

&lt;p&gt;Patch looks good Knut. Thanks for fixing it.&lt;/p&gt;

&lt;p&gt;+1 to commit&lt;/p&gt;</comment>
                            <comment id="12523484" author="knutanders" created="Wed, 29 Aug 2007 08:03:17 +0100"  >&lt;p&gt;Thanks Dag and Francois for reviewing the patch!&lt;br/&gt;
Committed revision 570663.&lt;/p&gt;</comment>
                            <comment id="12523538" author="knutanders" created="Wed, 29 Aug 2007 12:09:38 +0100"  >&lt;p&gt;Merged fix to 10.3 (rev 570752).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12364557" name="d3025-test.diff" size="2461" author="knutanders" created="Sat, 25 Aug 2007 16:54:07 +0100"/>
                            <attachment id="12364558" name="d3025.diff" size="2544" author="knutanders" created="Sat, 25 Aug 2007 17:32:30 +0100"/>
                            <attachment id="12364559" name="d3025.stat" size="227" author="knutanders" created="Sat, 25 Aug 2007 17:32:30 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 25 Aug 2007 07:00:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23381</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0m3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37397</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>