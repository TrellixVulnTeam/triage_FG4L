<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:51:20 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5559/DERBY-5559.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5559] AssertFailures (7, or 8) with ibm 1.6 and 1.5 on Windows XP in lang.NativeAuthProcs fixture testAll</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5559</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Since revision 1221569, on windows XP I see some failures in the nightly test like this:&lt;/p&gt;

&lt;p&gt;1) testAll(org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs)junit.framework.AssertionFailedError&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs.vetResetPassword(NativeAuthProcs.java:364)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs.resetPasswordTests(NativeAuthProcs.java:332)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs.testAll(NativeAuthProcs.java:189)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:116)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;

&lt;p&gt;See for instance: &lt;a href=&quot;http://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/ibm15/1222901-suites.All_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/ibm15/1222901-suites.All_diff.txt&lt;/a&gt;&lt;br/&gt;
There might be an intermittent issue here, one of the runs lists only 7 failures. But mostly there&apos;s 8.&lt;br/&gt;
This does not occur on Linux with the same jvm versions.&lt;/p&gt;

&lt;p&gt;The changes between this run and the previous one when these failures did not occur: &lt;br/&gt;
================&lt;br/&gt;
SUBVERSION LOG FROM 1221076 TO 1221569:&lt;br/&gt;
------------------------------------------------------------------------&lt;br/&gt;
r1221456 | rhillegas | 2011-12-20 11:35:44 -0800 (Tue, 20 Dec 2011) | 1 line&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-866&quot; title=&quot;Derby User Management Enhancements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-866&quot;&gt;&lt;del&gt;DERBY-866&lt;/del&gt;&lt;/a&gt;: Add regression tests for GRANT/REVOKE on new procedures supporting NATIVE authentication.&lt;br/&gt;
------------------------------------------------------------------------&lt;br/&gt;
r1221434 | rhillegas | 2011-12-20 10:59:09 -0800 (Tue, 20 Dec 2011) | 1 line&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-866&quot; title=&quot;Derby User Management Enhancements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-866&quot;&gt;&lt;del&gt;DERBY-866&lt;/del&gt;&lt;/a&gt;: Adjust RolesTest to account for new tuple in SYSROUTINEPERMS.&lt;br/&gt;
------------------------------------------------------------------------&lt;br/&gt;
r1221423 | rhillegas | 2011-12-20 10:44:33 -0800 (Tue, 20 Dec 2011) | 1 line&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-866&quot; title=&quot;Derby User Management Enhancements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-866&quot;&gt;&lt;del&gt;DERBY-866&lt;/del&gt;&lt;/a&gt;: Add syscs_reset_password() and syscs_modify_password() system procedures.&lt;br/&gt;
================&lt;/p&gt;


&lt;p&gt;derby.log in the failed directory only shows a start and shutdown.&lt;/p&gt;</description>
                <environment>Windows XP, IBM 1.6 SR9 FP1, IBM 1.5. SR13</environment>
        <key id="12536433">DERBY-5559</key>
            <summary>AssertFailures (7, or 8) with ibm 1.6 and 1.5 on Windows XP in lang.NativeAuthProcs fixture testAll</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikem">Mike Matrigali</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Dec 2011 19:23:13 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:38 +0100</updated>
                            <resolved>Fri, 13 Jan 2012 18:02:22 +0000</resolved>
                                    <version>10.9.1.0</version>
                                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13181773" author="mikem" created="Sat, 7 Jan 2012 01:47:39 +0000"  >&lt;p&gt;I checked in a change to add printout of values when the asserts are hit.  All the problems seem to be with timestamp comparisons where the&lt;br/&gt;
tests seem to be waiting a minimal amount of time to make sure that the assert are correct.  The current settings are not working for my laptop&lt;br/&gt;
running XP and ibm 16 jvm.&lt;/p&gt;

&lt;p&gt;With the change I got 2 failures just running the single test in sane mode.  In both cases the test is counting on the timestamp progressing but&lt;br/&gt;
in both cases the timestamp before and after is the same.  &lt;/p&gt;

&lt;p&gt;One option is to just go and bump the various waits in the test until it passes on my machine and then let others adjust as it fails on their&lt;br/&gt;
machines, but would like some feedback to make sure there is not something better&lt;br/&gt;
to be done for the tests.&lt;/p&gt;

&lt;p&gt;Here is the output:&lt;/p&gt;

&lt;p&gt;There were 2 failures:&lt;br/&gt;
1) testAll(org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs$NoAuthorization)junit.framework.AssertionFailedError: expected newLastModified &amp;gt; oldLastModified, but instead: newLastModified = 1325899678421; oldLastModified  = 1325899678421&lt;br/&gt;
    at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs.vetResetPassword(NativeAuthProcs.java:391)&lt;br/&gt;
    at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs.resetPasswordTests(NativeAuthProcs.java:353)&lt;br/&gt;
    at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs.testAll(NativeAuthProcs.java:201)&lt;br/&gt;
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60)&lt;br/&gt;
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)&lt;br/&gt;
    at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:116)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
2) testAll(org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs$NoAuthorization)junit.framework.AssertionFailedError: expected newLastModified &amp;gt; lastModified, but instead: newLastModified = 1325899727468; lastModified  = 1325899727468&lt;br/&gt;
    at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs.resetPasswordTests(NativeAuthProcs.java:367)&lt;br/&gt;
    at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthProcs.testAll(NativeAuthProcs.java:201)&lt;br/&gt;
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60)&lt;br/&gt;
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)&lt;br/&gt;
    at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:116)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 8,  Failures: 2,  Errors: 0&lt;/p&gt;


&lt;p&gt;OK (10 tests)&lt;/p&gt;</comment>
                            <comment id="13182875" author="mikem" created="Mon, 9 Jan 2012 22:35:27 +0000"  >&lt;p&gt;In this patch I upped the wait time in the test from 1ms to 10ms and added a few other waits at appropriate places.   This set of changes seems to fix the problems on my laptop while just running the single test alone.  I ran the test 60 times with the changes and it passed each time.&lt;br/&gt;
The test still failed with just the waits increased, the added waits were necessary.&lt;/p&gt;</comment>
                            <comment id="13182988" author="kmarsden" created="Tue, 10 Jan 2012 01:29:58 +0000"  >&lt;p&gt;Mike, I haven&apos;t looked closely, but I am wondering, is the test waiting for something specific that can be checked?  I have noticed in the past that arbitrary waits tend to have problems in different configurations especially with slow jvm options like JIT turned off.&lt;/p&gt;
</comment>
                            <comment id="13183360" author="mikem" created="Tue, 10 Jan 2012 16:28:31 +0000"  >&lt;p&gt;there is not really anything to wait for other than the passing of time.  At high level the test is doing something like:&lt;br/&gt;
get timestamp of password file&lt;br/&gt;
do an action expecting timestamp of password file to change&lt;br/&gt;
get new timestamp of password file&lt;br/&gt;
assert that new timestamp is bigger than old timestamp&lt;/p&gt;

&lt;p&gt;The waits are there to make sure that time between getting the first timestamp and doing the action time changes.  On some JVM&apos;s it looks like&lt;br/&gt;
1 ms is not long enough to wait.  &lt;/p&gt;

&lt;p&gt;I agree the wait is arbitrary, hopefully at tleast if it still breaks the new errors will make it more obvious what is going on.&lt;/p&gt;

&lt;p&gt;Maybe Rick could comment if there is a better approach for the test, or if the above interpretation of intent of the test is right?&lt;/p&gt;</comment>
                            <comment id="13183372" author="myrna" created="Tue, 10 Jan 2012 16:51:20 +0000"  >&lt;p&gt;I moved the tests to a different, faster (2 CPU) machine, and now the test doesn&apos;t fail in the nightly run...&lt;/p&gt;</comment>
                            <comment id="13183373" author="kmarsden" created="Tue, 10 Jan 2012 16:51:45 +0000"  >&lt;p&gt;Thanks Mike for the explanation. , That sounds reasonable to wait for 10ms then and should be portable except possibly on vmware where I recall  we have seen time go backwards. It seems reasonable to just wait and see if the failure comes up elsewhere with the change.&lt;/p&gt;
</comment>
                            <comment id="13184067" author="rhillegas" created="Wed, 11 Jan 2012 13:41:59 +0000"  >&lt;p&gt;Thanks for running these experiments on these platforms, Mike, Myrna, and Kathey. I don&apos;t have these platforms so I can&apos;t reproduce the problem you are seeing. I think that increasing the timeout is the best solution. There are only 2 columns which we can check to verify whether these procedures ran: HASHINGSCHEME and LASTMODIFIED. The USERNAME column won&apos;t change and the PASSWORD column cannot be inspected via SQL.&lt;/p&gt;

&lt;p&gt;When I wrote these tests, the HASHINGSCHEME column was just filled with dummy content. Checking it would have been useless. Since then, I have wired up password hashing, so HASHINGSCHEME now contains real content. We can make the value of HASHINGSCHEME change (by changing the values of the Derby properties which control password hashing behavior). However, I think the test will give us more confidence that we&apos;re testing what we want to (viz, that the procedures ran) if we don&apos;t resort to turning other knobs in order to generate a visible result. I can look into making that change if the problem is not fixed by increasing the timeout. Sounds like increasing the timeout is working for you though.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13184114" author="dagw" created="Wed, 11 Jan 2012 15:01:46 +0000"  >&lt;p&gt;I just saw this with Oracle JVM 7u4 prerelease on 64 bits Windows (VirtualBox), reproducable.&lt;/p&gt;</comment>
                            <comment id="13184129" author="mikem" created="Wed, 11 Jan 2012 15:34:22 +0000"  >&lt;p&gt;What build did you see it on dag?  I checked in a change that fixed all the issues I was seeing at 1229835.&lt;/p&gt;</comment>
                            <comment id="13184806" author="dagw" created="Thu, 12 Jan 2012 08:10:03 +0000"  >&lt;p&gt;I saw it at 1229481, so older than your fix. Thanks!&lt;/p&gt;</comment>
                            <comment id="13185711" author="mikem" created="Fri, 13 Jan 2012 18:02:22 +0000"  >&lt;p&gt;This fixed the problem which was reproduceable in my environment.  And I have not seen any errors in this test in the nightly&apos;s since i checked it in.  Closing it as resolved.&lt;/p&gt;</comment>
                            <comment id="13685306" author="knutanders" created="Mon, 17 Jun 2013 10:19:38 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12509970" name="derby-5559.diff" size="1905" author="mikem" created="Mon, 9 Jan 2012 22:35:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 7 Jan 2012 01:47:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>222116</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ea7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36132</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>