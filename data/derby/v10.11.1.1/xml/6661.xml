<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:33:51 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6661/DERBY-6661.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6661] dblook does not recognize the deferrability of deferrable constraints</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6661</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If you create a table with a deferrable primary key constraint and then run dblook, the recreation ddl does not flag the primary key as deferrable. I suspect that this applies to other kinds of constraints as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12727140">DERBY-6661</key>
            <summary>dblook does not recognize the deferrability of deferrable constraints</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                            <label>derby_backport_reject_10_10</label>
                    </labels>
                <created>Mon, 14 Jul 2014 19:16:45 +0100</created>
                <updated>Thu, 25 Sep 2014 00:15:53 +0100</updated>
                            <resolved>Tue, 15 Jul 2014 22:34:29 +0100</resolved>
                                    <version>10.11.1.1</version>
                                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14062512" author="rhillegas" created="Tue, 15 Jul 2014 20:14:58 +0100"  >&lt;p&gt;Attaching derby-6661-01-aa-recreateDeferrableConstraints.diff. This patch adds dblook support for deferrable constraints. I will run tests.&lt;/p&gt;


&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;--------------&lt;/p&gt;

&lt;p&gt;M       java/tools/org/apache/derby/impl/tools/dblook/DB_Check.java&lt;br/&gt;
M       java/tools/org/apache/derby/impl/tools/dblook/DB_Key.java&lt;br/&gt;
M       java/engine/org/apache/derby/impl/sql/catalog/SYSCONSTRAINTSRowFactory.java&lt;/p&gt;

&lt;p&gt;Adds code to dblook to handle deferrable constraints. I had to clone some code in the DataDictionary because the code can&apos;t be shared today due to the way we factor Derby into jar files. We expect that dblook can be run client-side without an engine jar file.&lt;/p&gt;

&lt;p&gt;--------------&lt;/p&gt;

&lt;p&gt;A       java/testing/org/apache/derbyTesting/functionTests/tests/tools/Test_6661.java&lt;br/&gt;
M       java/testing/org/apache/derbyTesting/functionTests/tests/tools/dblook_test.java&lt;br/&gt;
M       java/testing/org/apache/derbyTesting/functionTests/tests/tools/_Suite.java&lt;/p&gt;

&lt;p&gt;Adds a test to verify that dblook correctly recreates deferrable primary, unique, foreign, and check constraints.&lt;/p&gt;</comment>
                            <comment id="14062773" author="knutanders" created="Tue, 15 Jul 2014 23:29:21 +0100"  >&lt;p&gt;Thanks for adding this improvement, Rick.&lt;/p&gt;

&lt;p&gt;I ran some quick tests, and dblook now seems to produce the correct DDL as far as I can tell.&lt;/p&gt;

&lt;p&gt;One little nit: The patch seems to be generous with the blanks around DEFERRABLE and INITIALLY DEFERRED. For example, given the database created by this script:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
connect &apos;jdbc:derby:db;create=true&apos;;
create table t1(x int, constraint t1_pk primary key (x));
create table t2(x int, constraint t2_fk foreign key (x) references t1 initially deferred);
create table t3(x int, constraint t3_fk foreign key (x) references t1 initially immediate);
create table t4(x int, constraint t4_fk foreign key (x) references t1 deferrable);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I see this output from dblook:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;
-- ----------------------------------------------&lt;/span&gt;
-- DDL Statements for tables
-- ----------------------------------------------

CREATE TABLE &lt;span class=&quot;code-quote&quot;&gt;&quot;APP&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;T2&quot;&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;X&quot;&lt;/span&gt; INTEGER);

CREATE TABLE &lt;span class=&quot;code-quote&quot;&gt;&quot;APP&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;T1&quot;&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;X&quot;&lt;/span&gt; INTEGER NOT NULL);

CREATE TABLE &lt;span class=&quot;code-quote&quot;&gt;&quot;APP&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;T4&quot;&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;X&quot;&lt;/span&gt; INTEGER);

CREATE TABLE &lt;span class=&quot;code-quote&quot;&gt;&quot;APP&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;T3&quot;&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;X&quot;&lt;/span&gt; INTEGER);

-- ----------------------------------------------
-- DDL Statements for keys
-- ----------------------------------------------

-- PRIMARY/UNIQUE
ALTER TABLE &lt;span class=&quot;code-quote&quot;&gt;&quot;APP&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;T1&quot;&lt;/span&gt; ADD CONSTRAINT &lt;span class=&quot;code-quote&quot;&gt;&quot;T1_PK&quot;&lt;/span&gt; PRIMARY KEY (&lt;span class=&quot;code-quote&quot;&gt;&quot;X&quot;&lt;/span&gt;);

-- FOREIGN
ALTER TABLE &lt;span class=&quot;code-quote&quot;&gt;&quot;APP&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;T2&quot;&lt;/span&gt; ADD CONSTRAINT &lt;span class=&quot;code-quote&quot;&gt;&quot;T2_FK&quot;&lt;/span&gt; FOREIGN KEY (&lt;span class=&quot;code-quote&quot;&gt;&quot;X&quot;&lt;/span&gt;) REFERENCES &lt;span class=&quot;code-quote&quot;&gt;&quot;APP&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;T1&quot;&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;X&quot;&lt;/span&gt;) ON &lt;span class=&quot;code-keyword&quot;&gt;DELETE&lt;/span&gt; NO ACTION ON &lt;span class=&quot;code-keyword&quot;&gt;UPDATE&lt;/span&gt; NO ACTION DEFERRABLE  INITIALLY DEFERRED ;

ALTER TABLE &lt;span class=&quot;code-quote&quot;&gt;&quot;APP&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;T4&quot;&lt;/span&gt; ADD CONSTRAINT &lt;span class=&quot;code-quote&quot;&gt;&quot;T4_FK&quot;&lt;/span&gt; FOREIGN KEY (&lt;span class=&quot;code-quote&quot;&gt;&quot;X&quot;&lt;/span&gt;) REFERENCES &lt;span class=&quot;code-quote&quot;&gt;&quot;APP&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;T1&quot;&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;X&quot;&lt;/span&gt;) ON &lt;span class=&quot;code-keyword&quot;&gt;DELETE&lt;/span&gt; NO ACTION ON &lt;span class=&quot;code-keyword&quot;&gt;UPDATE&lt;/span&gt; NO ACTION DEFERRABLE ;

ALTER TABLE &lt;span class=&quot;code-quote&quot;&gt;&quot;APP&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;T3&quot;&lt;/span&gt; ADD CONSTRAINT &lt;span class=&quot;code-quote&quot;&gt;&quot;T3_FK&quot;&lt;/span&gt; FOREIGN KEY (&lt;span class=&quot;code-quote&quot;&gt;&quot;X&quot;&lt;/span&gt;) REFERENCES &lt;span class=&quot;code-quote&quot;&gt;&quot;APP&quot;&lt;/span&gt;.&lt;span class=&quot;code-quote&quot;&gt;&quot;T1&quot;&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;X&quot;&lt;/span&gt;) ON &lt;span class=&quot;code-keyword&quot;&gt;DELETE&lt;/span&gt; NO ACTION ON &lt;span class=&quot;code-keyword&quot;&gt;UPDATE&lt;/span&gt; NO ACTION;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice that there are two blanks between DEFERRABLE and INITIALLY DEFERRED, and there is an extra blank before the semicolon in the ALTER TABLE statements for all the deferrable constraints.&lt;/p&gt;</comment>
                            <comment id="14063412" author="rhillegas" created="Wed, 16 Jul 2014 13:01:20 +0100"  >&lt;p&gt;Hi Knut,&lt;/p&gt;

&lt;p&gt;Thanks for test-driving the changes. The extra spaces are a bit of defensive coding and future-proofing. Thanks.&lt;/p&gt;</comment>
                            <comment id="14147013" author="mikem" created="Wed, 24 Sep 2014 23:43:49 +0100"  >&lt;p&gt;I believe this bugs is specific to deferrable constraints so marking as not appropriate to backport to 10.10 and previous releases.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12313704">DERBY-532</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12655844" name="derby-6661-01-aa-recreateDeferrableConstraints.diff" size="17999" author="rhillegas" created="Tue, 15 Jul 2014 20:14:58 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Jul 2014 22:29:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>405247</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzrlj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>405275</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10050"><![CDATA[Blocker]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>