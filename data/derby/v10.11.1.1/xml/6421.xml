<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:16:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6421/DERBY-6421.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6421] Cast to UDT in CHECK constraint causes NPE or assert failure</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6421</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;ij version 10.10&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:memory:db;create=true&apos;;&lt;br/&gt;
ij&amp;gt; create type typ external name &apos;java.util.ArrayList&apos; language java;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create table ttt(x int, check (cast(null as typ) is null));&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into ttt values 1,2,3;&lt;br/&gt;
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;/p&gt;

&lt;p&gt;or with debug build:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; insert into ttt values 1,2,3;&lt;br/&gt;
ERROR XJ001: Java exception: &apos;ASSERT FAILED no current dependent for compilation: org.apache.derby.shared.common.sanity.AssertFailure&apos;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12681082">DERBY-6421</key>
            <summary>Cast to UDT in CHECK constraint causes NPE or assert failure</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Nov 2013 17:12:01 +0000</created>
                <updated>Wed, 21 Jan 2015 00:23:29 +0000</updated>
                            <resolved>Thu, 5 Dec 2013 12:09:08 +0000</resolved>
                                    <version>10.10.1.1</version>
                                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13836137" author="knutanders" created="Sun, 1 Dec 2013 22:59:36 +0000"  >&lt;p&gt;Also affects generated columns:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ij&amp;gt; create table t1(x typ generated always as (cast(null as typ)));
0 rows inserted/updated/deleted
ij&amp;gt; insert into t1 values default;
ERROR XJ001: Java exception: &apos;ASSERT FAILED no current dependent for compilation: org.apache.derby.shared.common.sanity.AssertFailure&apos;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13836371" author="knutanders" created="Mon, 2 Dec 2013 08:48:57 +0000"  >&lt;p&gt;The problem is that CastNode&apos;s constructor calls ValueNode.setType(), which attempts to bind the UDT. Since CastNode&apos;s constructor can be called during parsing, this means some binding happens during parsing. The compiler context used when parsing a generation clause or a CHECK constraint in a DML statement, is not set up to handle binding (for example, it&apos;s not setting current dependent or compilation schema). One might be able to work around it by setting up a more complete compiler context for the parser, but I think a more correct approach is to move the binding of the UDT from parse time to bind time.&lt;/p&gt;</comment>
                            <comment id="13836726" author="knutanders" created="Mon, 2 Dec 2013 17:47:36 +0000"  >&lt;p&gt;The attached patch fixes the assert failure and adds a regression test case that verifies the fix.&lt;/p&gt;

&lt;p&gt;As far as I could see, CastNode was the only place ValueNode.setType() was called before the bind phase, so I think it&apos;s ok to preserve the bind logic in setType(). Instead, I changed CastNode so that it doesn&apos;t call setType() from the constructor if the target type is a UDT. Now CastNode&apos;s constructor just stores the unbound type descriptor in a field and waits until bindExpression() or bindCastNodeOnly() is called before it actually binds it.&lt;/p&gt;

&lt;p&gt;All regression tests passed with the patch.&lt;/p&gt;</comment>
                            <comment id="13840042" author="jira-bot" created="Thu, 5 Dec 2013 12:09:01 +0000"  >&lt;p&gt;Commit 1548104 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1548104&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1548104&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6421&quot; title=&quot;Cast to UDT in CHECK constraint causes NPE or assert failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6421&quot;&gt;&lt;del&gt;DERBY-6421&lt;/del&gt;&lt;/a&gt;: Cast to UDT in CHECK constraint causes NPE or assert failure&lt;/p&gt;

&lt;p&gt;Delay binding of target UDT in CastNode till bind time.&lt;/p&gt;</comment>
                            <comment id="14284812" author="myrna" created="Wed, 21 Jan 2015 00:23:29 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12616580" name="d6421-1a.diff" size="4593" author="knutanders" created="Mon, 2 Dec 2013 17:47:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Dec 2013 12:09:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>360347</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzjypr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>360646</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>