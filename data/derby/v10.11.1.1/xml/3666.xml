<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:34:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3666/DERBY-3666.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3666] Make role descriptor a dependency Provider</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3666</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Since dropping roles and revoking role grants (and setting the current&lt;br/&gt;
role) can effect dependent objects, we need to track such&lt;br/&gt;
dependencies. Derby already has a system for this, so we make the role&lt;br/&gt;
descriptor as Provider in that system. This allows us to track&lt;br/&gt;
dependencies that view, constraints and triggers, as well&lt;br/&gt;
prepared statements and/or activations, may have on roles.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12395431">DERBY-3666</key>
            <summary>Make role descriptor a dependency Provider</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12383067">DERBY-3223</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 May 2008 16:45:05 +0100</created>
                <updated>Tue, 30 Jun 2009 01:14:35 +0100</updated>
                            <resolved>Wed, 28 May 2008 01:50:01 +0100</resolved>
                                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12594610" author="dagw" created="Tue, 6 May 2008 16:59:45 +0100"  >&lt;p&gt;Patch derby-3666-1 makes the role descriptor a dependency Provider.&lt;br/&gt;
Regression tests ran OK.&lt;/p&gt;

&lt;p&gt;Detailed patch comments:&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/iapi/sql/dictionary/RoleDescriptor.java&lt;/p&gt;

&lt;p&gt;This change makes the role (or technically, the role descriptor, as&lt;br/&gt;
stored in SYS.SYSROLES) a Derby Provider by having RoleDescriptor&lt;br/&gt;
implement the Provider interface. That is, other Derby objects can&lt;br/&gt;
register dependencies against role grants (role definitions are also&lt;br/&gt;
technically a grant) and get invalidation actions performed, for&lt;br/&gt;
example when a role is dropped, when a session&apos;s current role is&lt;br/&gt;
changed, or when a role grant is revoked. The role as provider is&lt;br/&gt;
persistent, since it is stored in SYS.SYSROLES. Being a persistent&lt;br/&gt;
provider relies on the UUID of the role descriptor (we introduced an&lt;br/&gt;
UUID earlier for this purpose, see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3137&quot; title=&quot;SQL roles: add catalog support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3137&quot;&gt;&lt;del&gt;DERBY-3137&lt;/del&gt;&lt;/a&gt;-uuid*). Dependents can&lt;br/&gt;
be in-memory (e.g prepared statements or maybe activations,&lt;br/&gt;
cf. discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2207&quot; title=&quot;Improve usability of Derby&amp;#39;s client/server security by implementing ANSI Roles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2207&quot;&gt;&lt;del&gt;DERBY-2207&lt;/del&gt;&lt;/a&gt; with Dan) or persistent (views,&lt;br/&gt;
constraints, triggers).&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/catalog/Dependable.java&lt;/p&gt;

&lt;p&gt;Adds role grant to the universe of known dependables (a Provider is a&lt;br/&gt;
Dependable, which is a super-interface for Providers and Dependents).&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/iapi/services/io/RegisteredFormatIds.java&lt;br/&gt;
M      java/engine/org/apache/derby/iapi/services/io/StoredFormatIds.java&lt;/p&gt;

&lt;p&gt;Registering a format id for role grant formatable, to be handled by&lt;br/&gt;
the class CoreDDFinderClassInfo.&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/iapi/sql/depend/DependencyManager.java&lt;/p&gt;

&lt;p&gt;Adds a new &quot;REVOKE ROLE&quot; action to handle invalidation when a role&lt;br/&gt;
grant is revoke or a role is dropped.&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/depend/BasicDependencyManager.java&lt;/p&gt;

&lt;p&gt;Adds an entry to getActionString for the &quot;REVOKE ROLE&quot; action.&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/catalog/DDdependableFinder.java&lt;/p&gt;

&lt;p&gt;Extends this to handle role grant.&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/catalog/CoreDDFinderClassInfo.java&lt;/p&gt;

&lt;p&gt;Specifies that DDdependableFinder is to be used for role grant.&lt;/p&gt;

&lt;p&gt;In the experimental patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3223&quot; title=&quot;SQL roles: make use of privileges granted to roles in actual privilege checking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3223&quot;&gt;&lt;del&gt;DERBY-3223&lt;/del&gt;&lt;/a&gt;,&lt;br/&gt;
DDdependableFinder#findDependable is never called for role grants,&lt;br/&gt;
since role grants do no rely on other objects, only vice versa. I&lt;br/&gt;
added the code to CoreDDFinderClassInfo and DDdependableFinder for&lt;br/&gt;
completeness anyway, since, as a Provider it is a dependable. If&lt;br/&gt;
someone thinks this is the wrong decision, I can backtrack it.&lt;/p&gt;</comment>
                            <comment id="12596803" author="rhillegas" created="Wed, 14 May 2008 16:54:04 +0100"  >&lt;p&gt;Thanks for the patch, Dag. It looks good to me. I have a couple comments:&lt;/p&gt;

&lt;p&gt;RoleDescriptor.getObjectName()&lt;/p&gt;

&lt;p&gt;The string returned by this method can appear inside a localizable&lt;br/&gt;
exception thrown by GenericLanguageConnectionContext. So I think it&lt;br/&gt;
would be better if this method returned something without hard-coded&lt;br/&gt;
English bits. I realize that the corresponding method in RoutinePermisionsDescriptor&lt;br/&gt;
hard-codes English text too--I think that&apos;s a bad model.&lt;/p&gt;


&lt;p&gt;RoleDescriptor vs. RoleGrantDescriptor&lt;/p&gt;

&lt;p&gt;I wonder whether we are going to be confused in the future about the&lt;br/&gt;
name of this class. &quot;RoleDescriptor&quot; seems like a good name for a&lt;br/&gt;
collection of privileges which have been packaged up as a Role. This&lt;br/&gt;
class doesn&apos;t seem to be a collection. Instead, it seems to describe&lt;br/&gt;
a single arc in the Grant Graph. Might &quot;RoleGrantDescriptor&quot; be a&lt;br/&gt;
better name for this class? I realize that a similar question could be&lt;br/&gt;
asked about PermissionsDescriptor. I think that the distinction&lt;br/&gt;
between a Permission and a PermissionGrant is a little muddy and may&lt;br/&gt;
not be providing a good model here.&lt;/p&gt;</comment>
                            <comment id="12597103" author="dagw" created="Thu, 15 May 2008 12:52:46 +0100"  >&lt;p&gt;Thanks for reviewing this patch, Rick!&lt;/p&gt;

&lt;p&gt;a) RoleDescriptor.getObjectName: I agree.&lt;/p&gt;

&lt;p&gt;b) RoleDescriptor vs. RoleGrantDescriptor : I agree this can be a bit&lt;br/&gt;
confusing.  SQL models a role creation as a grant, too (grantor:&lt;br/&gt;
_SYSTEM), which is reflected in the implementation.  In some contexts,&lt;br/&gt;
especially if we later want to implement the full standard for roles&lt;br/&gt;
(non-dbo can define a role, WITH ADMIN option, grantor specification),&lt;br/&gt;
it will be useful to view the descriptor as a grant, other times as&lt;br/&gt;
the role definition. But in any case, since all SYSROLES rows are&lt;br/&gt;
representable with the current RoleDescriptor, RoleGrantDescriptor&lt;br/&gt;
would just as suitable as a name. Let me think about this one; right&lt;br/&gt;
now I favor your suggestion.&lt;/p&gt;

</comment>
                            <comment id="12599414" author="dagw" created="Fri, 23 May 2008 17:10:15 +0100"  >&lt;p&gt;I made a patch to address your comments, Rick, but the renaming&lt;br/&gt;
you suggested, RoleDescriptor to RoleGrantDescriptor, turned out to&lt;br/&gt;
create some volume which makes the intent of the patch harder to see, so&lt;br/&gt;
I will do that in a separate patch. So the first patch will just include&lt;br/&gt;
the basic functionality plus your point a), then the subsequent patch will address&lt;br/&gt;
your point b).&lt;/p&gt;</comment>
                            <comment id="12599517" author="dagw" created="Fri, 23 May 2008 22:49:58 +0100"  >&lt;p&gt;Uploading derby-3666-2. It is the same as version 1, except I have changed the text of RoleDescriptor.getObjectName to only use the appropriate SQL keywords (in caps), so that way there should not be a localization issue for the inlined strings.&lt;/p&gt;</comment>
                            <comment id="12599582" author="dagw" created="Sat, 24 May 2008 13:33:58 +0100"  >&lt;p&gt;derby-3666-2 committed as svn 659805.&lt;/p&gt;</comment>
                            <comment id="12599644" author="dagw" created="Sun, 25 May 2008 02:39:16 +0100"  >&lt;p&gt;Rick, I have made a patch which addresses your renaming suggestion&lt;br/&gt;
as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3137&quot; title=&quot;SQL roles: add catalog support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3137&quot;&gt;&lt;del&gt;DERBY-3137&lt;/del&gt;&lt;/a&gt;-rename; I felt it belonged there rather than in this issue.&lt;br/&gt;
If you concur I can close this issue.&lt;/p&gt;</comment>
                            <comment id="12600232" author="rhillegas" created="Tue, 27 May 2008 19:17:49 +0100"  >&lt;p&gt;Hi Dag. The renaming patch looks good to me and derby-3137 seems like a fine place for it. Cheers-Rick&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12381515" name="derby-3666-1.diff" size="7331" author="dagw" created="Tue, 6 May 2008 17:19:32 +0100"/>
                            <attachment id="12381512" name="derby-3666-1.stat" size="600" author="dagw" created="Tue, 6 May 2008 16:59:45 +0100"/>
                            <attachment id="12382699" name="derby-3666-2.diff" size="7400" author="dagw" created="Fri, 23 May 2008 22:49:58 +0100"/>
                            <attachment id="12382700" name="derby-3666-2.stat" size="600" author="dagw" created="Fri, 23 May 2008 22:49:58 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 14 May 2008 15:54:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30945</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0vaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38887</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>