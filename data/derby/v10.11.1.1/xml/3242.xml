<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:21:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3242/DERBY-3242.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3242] ij doesn&apos;t understand bracketed comments</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3242</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When I execute this sql script in ij&lt;/p&gt;

&lt;p&gt;------&lt;br/&gt;
create table t (x int);&lt;br/&gt;
/*&lt;br/&gt;
insert into t values 1, 2, 3;&lt;br/&gt;
insert into t values 4, 5, 6;&lt;br/&gt;
*/&lt;br/&gt;
------&lt;/p&gt;

&lt;p&gt;the first INSERT statement in the comment is correctly ignored, but the second one is executed. So after running the script, table T contains these rows:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select * from t;&lt;br/&gt;
X          &lt;br/&gt;
-----------&lt;br/&gt;
4          &lt;br/&gt;
5          &lt;br/&gt;
6          &lt;/p&gt;

&lt;p&gt;3 rows selected&lt;/p&gt;</description>
                <environment></environment>
        <key id="12383725">DERBY-3242</key>
            <summary>ij doesn&apos;t understand bracketed comments</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="james.f.adams">James F. Adams</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Sat, 1 Dec 2007 23:33:01 +0000</created>
                <updated>Thu, 2 May 2013 03:29:11 +0100</updated>
                            <resolved>Mon, 17 Dec 2007 13:57:08 +0000</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>SQL</component>
                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12547534" author="knutanders" created="Sat, 1 Dec 2007 23:36:12 +0000"  >&lt;p&gt;Attached is the script I used for testing. This is what ij prints when I run it:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; run &apos;/tmp/comment.sql&apos;;&lt;br/&gt;
ij&amp;gt; create table t (x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; /*&lt;br/&gt;
insert into t values 1, 2, 3;&lt;br/&gt;
ERROR 42X01: Syntax error: Encountered &quot;&amp;lt;EOF&amp;gt;&quot; at line 2, column 28.&lt;br/&gt;
ij&amp;gt; insert into t values 4, 5, 6;&lt;br/&gt;
3 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; */&lt;br/&gt;
;&lt;br/&gt;
ERROR 42X01: Syntax error: Encountered &quot;*&quot; at line 1, column 1.&lt;/p&gt;</comment>
                            <comment id="12550040" author="james.f.adams" created="Mon, 10 Dec 2007 12:42:47 +0000"  >&lt;p&gt;Attached a patch proposal that addresses this issue.  Modified StatementFinder.java to recognize nested brackted comments.  Added a test to IJRunScriptTest.java to verify bracketed comment support in ij.&lt;/p&gt;

&lt;p&gt;Ran derbyAll and suites.All and saw no errors I could attribute to this patch.&lt;/p&gt;</comment>
                            <comment id="12550877" author="knutanders" created="Wed, 12 Dec 2007 08:07:15 +0000"  >&lt;p&gt;Thanks for the patch, James! Your approach looks fine, and it seems to work correctly in most cases. The one thing that didn&apos;t seem to work, was when a script ended with a comment. Apparently, ij then thinks we have started a new statement and emits a syntax error on EOF. I have attached a repro as comment2.sql.&lt;/p&gt;

&lt;p&gt;By the way, the indentation in readBracketedComment() is a bit funny. Each line starts with a single tab character which is followed by a number of space characters. I think it would be better not to mix different indentation characters on the same line.&lt;/p&gt;

&lt;p&gt;StatementFinder defines constants for some &quot;special state-changing characters&quot;. Would the code be more consistent if readBracketedComment() used those? At least, it defines a slash constant, but it seems like we need to add a constant for asterisk ourselves.&lt;/p&gt;

&lt;p&gt;I was also wondering if readBracketedComment() would be simpler if we used peekChar()/readChar() instead of maintaining the flags lookingForSlash and lookingForAsterisk. Something like:&lt;/p&gt;

&lt;p&gt;char peek = peekChar();&lt;br/&gt;
if (nextChar == ASTERISK &amp;amp;&amp;amp; peek == SLASH) &lt;/p&gt;
{
    readChar();
    ...
}
&lt;p&gt; else if (nextChar == SLASH &amp;amp;&amp;amp; peek == ASTERISK) &lt;/p&gt;
{
    readChar();
    ....
}
&lt;p&gt; else &lt;/p&gt;
{
    ....
}

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="12551669" author="james.f.adams" created="Fri, 14 Dec 2007 01:27:49 +0000"  >&lt;p&gt;Thanks Knut for spending the time to review my previous patch proposal.  I have prepared a new patch proposal (Derby-3241-v2.txt) that incorporates your suggestions.&lt;/p&gt;

&lt;p&gt;In particular:&lt;/p&gt;

&lt;p&gt;Scripts ending with bracketed comments are correctly handled.&lt;br/&gt;
I cleaned up the indentation to be in the style of the surrounding code.&lt;br/&gt;
Added the missing constants and removed the unnecessary state flags.&lt;/p&gt;

&lt;p&gt;Ran derbyAll and suites.All and saw no errors I could attribute to this patch. &lt;/p&gt;</comment>
                            <comment id="12551808" author="knutanders" created="Fri, 14 Dec 2007 14:15:06 +0000"  >&lt;p&gt;Thanks again, James. I think the last patch is very close, but there seems to be a problem with nested comments. Please see the attached sql script.&lt;/p&gt;

&lt;p&gt;$ java -jar derbyrun.jar ij comment3.sql&lt;br/&gt;
ij version 10.4&lt;br/&gt;
ij&amp;gt; /* let&apos;s start the file with a /* nested comment */ and see what happens */&lt;br/&gt;
connect &apos;jdbc:derby:d3242;create=true&apos;;&lt;br/&gt;
IJ ERROR: Unable to establish connection&lt;br/&gt;
ij&amp;gt; values &apos;hi!&apos;;&lt;br/&gt;
IJ ERROR: Unable to establish connection&lt;br/&gt;
ij&amp;gt;&lt;/p&gt;

&lt;p&gt;This script works if the comment isn&apos;t nested. I don&apos;t know what&apos;s causing this, but I suspect that it&apos;s the rather cryptic regex you uncommented in ij.jj that doesn&apos;t handle nested comments. Nested comments in the middle of a statement do however work correctly.&lt;/p&gt;</comment>
                            <comment id="12552150" author="james.f.adams" created="Sat, 15 Dec 2007 23:27:36 +0000"  >&lt;p&gt;Knut, thanks for reviewing the previous patch.  I have uploaded another, and hopefully final, patch proposal.  I modified ij.jj to recognize nested bracketed comments and added an additional test to IJRunScriptTest.java.&lt;/p&gt;

&lt;p&gt;Ran derbyAll and suites.All and saw no errors I could attribute to this patch.&lt;/p&gt;</comment>
                            <comment id="12552412" author="knutanders" created="Mon, 17 Dec 2007 13:57:08 +0000"  >&lt;p&gt;Great! Seems like everything is covered now. Committed revision 604871.&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12394049">DERBY-3626</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12348467">DERBY-1749</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12384926">DERBY-3289</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12371648" name="Derby-3241-v2.txt" size="5814" author="james.f.adams" created="Fri, 14 Dec 2007 01:27:48 +0000"/>
                            <attachment id="12371355" name="Derby-3242.txt" size="4492" author="james.f.adams" created="Mon, 10 Dec 2007 12:42:47 +0000"/>
                            <attachment id="12371740" name="Derby3242-v3.txt" size="6379" author="james.f.adams" created="Sat, 15 Dec 2007 23:27:36 +0000"/>
                            <attachment id="12370767" name="comment.sql" size="90" author="knutanders" created="Sat, 1 Dec 2007 23:36:12 +0000"/>
                            <attachment id="12371491" name="comment2.sql" size="88" author="knutanders" created="Wed, 12 Dec 2007 08:07:15 +0000"/>
                            <attachment id="12371674" name="comment3.sql" size="130" author="knutanders" created="Fri, 14 Dec 2007 14:15:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 10 Dec 2007 12:42:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23515</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0yy7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39480</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>