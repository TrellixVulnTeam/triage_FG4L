<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:07:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4027/DERBY-4027.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4027] An attempt was made to access an out of range slot on a page</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4027</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When running our application we get the following error message:&lt;/p&gt;

&lt;p&gt;An attempt was made to access an out of range slot on a page:&lt;/p&gt;

&lt;p&gt;INSERT INTO orders (operation, receptacle, vehicle_id, iata_origin, icao_origin, sta, eta, ata, pta, onb, arr_stand_id, arr_gate, arr_flight_no, arr_remarks, flight_no, icao_flight_no, icao_callsign, iata_destination, icao_destination, std, etd, atd, ofb, stand_id, pit_code, gate, aircraft_subtype_code, aircraft_registration, fuel_request, canceled, delay_ind, remarks, ptd, slot_request_code, slot_request, slot_granted, terminal, customer_name, customer_type, supplier_id, carnet_no, carnet_expiry, contract_id, authorization_reference, service_level, standby_at, started_at, completed_at, status, comment, meter1_start_volume_automatic, meter1_start_volume_manual, meter1_stop_volume_automatic, meter1_stop_volume_manual, meter2_start_volume_automatic, meter2_start_volume_manual, meter2_stop_volume_automatic, meter2_stop_volume_manual, temperature, density, created_at, updated_at, fuel_on_board, id) VALUES(&apos;FUELLING&apos;, NULL, NULL, NULL, NULL, &apos;2009-01-22 07:25:00&apos;, &apos;2009-01-22 07:30:00&apos;, &apos;2009-01-22 07:27:00&apos;, &apos;2009-01-22 07:27:00&apos;, &apos;2009-01-22 07:29:46&apos;, &apos;anAEBO3yqr3zaaabxfoB_Q&apos;, NULL, &apos;DY 0201&apos;, NULL, &apos;DY 0242&apos;, &apos;NAX0242&apos;, &apos;NAX242&apos;, &apos;TOS&apos;, &apos;ENTC&apos;, &apos;2009-01-22 07:50:00&apos;, NULL, &apos;2009-01-22 08:13:00&apos;, &apos;2009-01-22 08:06:08&apos;, &apos;anAEBO3yqr3zaaabxfoB_Q&apos;, NULL, &apos;18&apos;, &apos;733&apos;, &apos;LNKHA&apos;, 7200, 0, &apos;X&apos;, NULL, &apos;2009-01-22 08:13:00&apos;, NULL, NULL, NULL, &apos;1&apos;, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, &apos;2009-01-21 08:04:54&apos;, &apos;2009-01-22 13:24:59&apos;, 0, &apos;aV9HYQ55ir3B9DabxfoB_Q&apos;)&lt;/p&gt;

&lt;p&gt;The error occurs several times per day on different systems.  It started yesterday&lt;/p&gt;</description>
                <environment>Fedora 10 and Ubuntu 8.04&lt;br/&gt;
Sun Java 1.6.0_07 and 1.6.0_11&lt;br/&gt;
derby 10.4.2.0</environment>
        <key id="12412996">DERBY-4027</key>
            <summary>An attempt was made to access an out of range slot on a page</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="donv">Uwe Kubosch</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Jan 2009 14:36:43 +0000</created>
                <updated>Fri, 21 Jan 2011 17:52:13 +0000</updated>
                            <resolved>Wed, 18 Feb 2009 12:04:47 +0000</resolved>
                                    <version>10.4.2.0</version>
                                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12666156" author="knutanders" created="Thu, 22 Jan 2009 14:46:48 +0000"  >&lt;p&gt;Do you also have the stack trace for the exception?&lt;/p&gt;</comment>
                            <comment id="12666162" author="donv" created="Thu, 22 Jan 2009 15:02:07 +0000"  >&lt;p&gt;Thank you for your reply. &lt;/p&gt;

&lt;p&gt;I guess you mean an exception stack trace in derby.log?  The log was deleted when I restored the database, so I will send it the next time the problem occurs.&lt;/p&gt;

&lt;p&gt;If you need something else than output from the derby.log, please specify.&lt;/p&gt;</comment>
                            <comment id="12666164" author="knutanders" created="Thu, 22 Jan 2009 15:07:34 +0000"  >&lt;p&gt;Yes, the exception stack trace in derby.log would be fine.&lt;/p&gt;</comment>
                            <comment id="12667128" author="donv" created="Sun, 25 Jan 2009 19:44:57 +0000"  >&lt;p&gt;So, it has happened a couple of more times now, but when we look in the derby.log file, there is no exception.  There are only the startup messages:&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
2009-01-25 11:23:35.851 GMT:&lt;br/&gt;
 Booting Derby version The Apache Software Foundation - Apache Derby - 10.4.2.0 - (689064): instance a816c00e-011f-0d87-c36b-0000003a8778&lt;br/&gt;
on database directory /home/uwe/workspace/aifudis/aifudis.operator/javadb-activemq  &lt;/p&gt;

&lt;p&gt;Database Class Loader started - derby.database.classpath=&apos;&apos;&lt;br/&gt;
----------------------------------------------------------------&lt;br/&gt;
2009-01-25 11:23:38.219 GMT:&lt;br/&gt;
 Booting Derby version The Apache Software Foundation - Apache Derby - 10.4.2.0 - (689064): instance 80840021-011f-0d87-c36b-0000003a8778&lt;br/&gt;
on database directory /home/uwe/workspace/aifudis/aifudis.operator/javadb-development  &lt;/p&gt;

&lt;p&gt;Database Class Loader started - derby.database.classpath=&apos;&apos;&lt;/p&gt;


&lt;p&gt;Please advise my next step.&lt;/p&gt;</comment>
                            <comment id="12667240" author="knutanders" created="Mon, 26 Jan 2009 13:09:25 +0000"  >&lt;p&gt;It looks like this error has statement severity, which is not logged by default, so the derby.stream.error.logSeverityLevel property needs to be set to 20000 or lower in order to get it logged in derby.log. Set it to 0 to get all exceptions logged. &lt;a href=&quot;http://db.apache.org/derby/docs/10.4/tuning/rtunproper26985.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/10.4/tuning/rtunproper26985.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively, you could modify your application to print the stack trace instead of just the error message.&lt;/p&gt;

&lt;p&gt;Any information about the transaction mix and the database schema would also be helpful.&lt;/p&gt;</comment>
                            <comment id="12667627" author="donv" created="Tue, 27 Jan 2009 09:36:13 +0000"  >&lt;p&gt;I have attached a derby.log for after the problem occurs.  Please look at it and see if you can see how to solve the problem.&lt;br/&gt;
I&apos;ll start reproducing the problem and attach another derby.log with the first exception we get, which is different.&lt;/p&gt;</comment>
                            <comment id="12667639" author="kristwaa" created="Tue, 27 Jan 2009 10:21:52 +0000"  >&lt;p&gt;Can you try to run with the Derby debug version?&lt;br/&gt;
Looking at your derby.log, the exception can be thrown in two places. By running with the debug build, we&apos;ll either get the line number of the exception, or possibly an assert error somewhere else. The debug version can be downloaded from the Apache Derby site.&lt;/p&gt;

&lt;p&gt;There two cases are:&lt;br/&gt;
 1) There is not enough data in the page to read the header (2 bytes).&lt;br/&gt;
 2) There is not enough data in the page to read the user data according to the encoded byte length in the header.&lt;/p&gt;

&lt;p&gt;Possible causes:&lt;br/&gt;
 o The page is somehow corrupt.&lt;br/&gt;
 o The header is wrong.&lt;br/&gt;
 o A bug where wrong information about the field data is used.&lt;br/&gt;
(o I also note that JRuby is being used.)&lt;/p&gt;

&lt;p&gt;To investigate further, we need more information. The easiest thing to do is to run with the debug version to obtain line numbers (or an assert).&lt;br/&gt;
I don&apos;t know too much about JRuby, but I assume you are not using JDBC directly?&lt;br/&gt;
Also, is the data you are inserting ASCII only, or are you inserting for instance CJK or nordic characters?&lt;/p&gt;

&lt;p&gt;Another thing to do for those looking into this, could be to understand what exactly is going on in the BTree (i.e. comparePreviousRecord).&lt;/p&gt;


&lt;p&gt;Finally, in the description you wrote &quot;It started yesterday&quot;. Does this mean that the application has been running successfully for a longer period of time?&lt;br/&gt;
And on the different systems, are you running against the same database or regenerating it from scratch?&lt;/p&gt;</comment>
                            <comment id="12667655" author="knutanders" created="Tue, 27 Jan 2009 11:57:52 +0000"  >&lt;p&gt;comparePreviousRecord() is used by B-trees that back a unique constraint on columns that could be null (new feature in Derby 10.4). Some possible problems with that method were identified in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4028&quot; title=&quot;two rows can be inserted with the same value in a column that a unique constraint on that column should prevent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4028&quot;&gt;&lt;del&gt;DERBY-4028&lt;/del&gt;&lt;/a&gt;. I don&apos;t know if it&apos;s related, though, since the data corruption may very well have happened before that method was called.&lt;/p&gt;

&lt;p&gt;The original bug report mentioned another error message. If that error occurs again, it would be great if you could post that stack trace too.&lt;/p&gt;</comment>
                            <comment id="12667669" author="donv" created="Tue, 27 Jan 2009 13:55:03 +0000"  >&lt;p&gt;Here is a derby.log with debug information.  I hope you can make sense out of it.&lt;/p&gt;

&lt;p&gt;An additional information:  We recently (less than 2 weeks ago), started persisting ActiveMQ messages using derby.  ActiveMQ is running embedded in the same JVM, so we access 2 derby databases in the same JVM.&lt;/p&gt;

&lt;p&gt;&amp;gt; I don&apos;t know too much about JRuby, but I assume you are not using JDBC directly?&lt;/p&gt;

&lt;p&gt;We access JDBC using ActiveRecord, but I expect this should not make a difference.&lt;/p&gt;

&lt;p&gt;&amp;gt; Also, is the data you are inserting ASCII only, or are you inserting for instance CJK or nordic characters?&lt;/p&gt;

&lt;p&gt;Nordic characters are definitely possible.&lt;/p&gt;

&lt;p&gt;&amp;gt; Finally, in the description you wrote &quot;It started yesterday&quot;. Does this mean that the application has been running successfully for a longer period of time?&lt;/p&gt;

&lt;p&gt;Yes, the application has been running for long durations earlier, but we constantly develop the application, so circumstances change, and we regularly recreate the development database.&lt;/p&gt;

&lt;p&gt;Two production databases are still running without problems, so something we changed in the last few days is triggering the error, but we are unable to identify any special changes.  We are possibly exercising the database slightly more than earlier by deleting/inserting some rows that were updated earlier.&lt;/p&gt;

&lt;p&gt;&amp;gt; And on the different systems, are you running against the same database or regenerating it from scratch?&lt;/p&gt;

&lt;p&gt;All systems own their own embedded derby database.  There is no database network access.&lt;/p&gt;</comment>
                            <comment id="12667674" author="kristwaa" created="Tue, 27 Jan 2009 14:21:59 +0000"  >&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;Is it possible for you to post the schema of the database (javadb-development)?&lt;br/&gt;
If that isn&apos;t possible, can you confirm if you are using a unique nullable constraint/index on one of the character columns?&lt;/p&gt;</comment>
                            <comment id="12667679" author="donv" created="Tue, 27 Jan 2009 14:25:20 +0000"  >&lt;p&gt;I can indeed confirm that we are using a unique nullable constraint (not index since it does not allow multiple rows with NULL) in a character column.&lt;/p&gt;

&lt;p&gt;Are we close?&lt;/p&gt;</comment>
                            <comment id="12667681" author="donv" created="Tue, 27 Jan 2009 14:32:24 +0000"  >&lt;p&gt;Here is a slightly different derby.log, with a slightly different error message.  I hope it helps.&lt;/p&gt;</comment>
                            <comment id="12667686" author="donv" created="Tue, 27 Jan 2009 14:50:13 +0000"  >&lt;p&gt;My mistake: There are indeed nullable unique indexes on the orders table.&lt;/p&gt;

&lt;p&gt;Do you still want the database schema?  Can you please tell me the easiest way to dump it?  We have ij available.&lt;/p&gt;

&lt;p&gt;Have you found a probable cause for the error?&lt;/p&gt;</comment>
                            <comment id="12667689" author="kristwaa" created="Tue, 27 Jan 2009 14:54:30 +0000"  >&lt;p&gt;Well, there&apos;s no repro available to test against...&lt;br/&gt;
One step forward would be to determine if the error is made when writing the page/record or when it is being read back.&lt;/p&gt;

&lt;p&gt;As a work-around, maybe you could remove the constraint (or use just unique and insert unique values)? If that works, it strengthens the suspicion against the unique nullable code.&lt;/p&gt;</comment>
                            <comment id="12667692" author="knutanders" created="Tue, 27 Jan 2009 15:03:37 +0000"  >&lt;p&gt;Looks like the latest error also happened in the index backing the nullable unique constraint (compareLeftAndRightSiblings() is only used by that kind of index):&lt;/p&gt;

&lt;p&gt;ERROR XSDA1: An attempt was made to access an out of range slot on a page&lt;br/&gt;
	at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:276)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BasePage.checkSlotOnPage(BasePage.java:1838)&lt;br/&gt;
	at org.apache.derby.impl.store.raw.data.BasePage.fetchFromSlot(BasePage.java:431)&lt;br/&gt;
	at org.apache.derby.impl.store.access.btree.BTreeController.compareNextRecord(BTreeController.java:454)&lt;br/&gt;
	at org.apache.derby.impl.store.access.btree.BTreeController.compareLeftAndRightSiblings(BTreeController.java:555)&lt;br/&gt;
	at org.apache.derby.impl.store.access.btree.BTreeController.doIns(BTreeController.java:812)&lt;/p&gt;</comment>
                            <comment id="12667693" author="knutanders" created="Tue, 27 Jan 2009 15:06:32 +0000"  >&lt;p&gt;The easiest way to dump the database schema is to use dblook.&lt;/p&gt;

&lt;p&gt;$ java -jar derbyrun.jar dblook -d jdbc:derby:mydb -o dblook.txt&lt;/p&gt;</comment>
                            <comment id="12670321" author="kristwaa" created="Wed, 4 Feb 2009 12:37:16 +0000"  >&lt;p&gt;Uwe Kubosch wrote:&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Do you still want the database schema?&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Yes, please.&lt;br/&gt;
It would also help to know more about the data you are inserting, and the access pattern.&lt;br/&gt;
The more information you provide, the better &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12670528" author="donv" created="Wed, 4 Feb 2009 22:15:20 +0000"  >&lt;p&gt;I attached a schema dump with the unique constraints.&lt;/p&gt;

&lt;p&gt;I used the command mentioned in this issue.  Is there a way to make the dump sorted the same way each time to enable easy diff of changes?&lt;/p&gt;

&lt;p&gt;Our usage pattern when triggering the error is typically to delete all rows in the orders table, and then insert about 1000 rows similar to the one in the description of this issue.&lt;/p&gt;</comment>
                            <comment id="12670565" author="kmarsden" created="Wed, 4 Feb 2009 23:58:51 +0000"  >&lt;p&gt;I was able to reproduce the error with the attached program Derby4027Repro.java.  To reproduce, create a database wombat and run the schema.sql script to set up the schema, then run the program.  It will fail with&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;C:/kmarsden/repro/derby-4027&amp;#93;&lt;/span&gt; java Derby4027Repro&lt;br/&gt;
Exception in thread &quot;main&quot; java.sql.SQLException: An attempt was made to access an out of range slot on a page&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:201)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:391)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2201)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1323)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1648)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:294)&lt;br/&gt;
        at Derby4027Repro.main(Derby4027Repro.java:15)&lt;br/&gt;
Caused by: java.sql.SQLException: An attempt was made to access an out of range slot on a page&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:11&lt;br/&gt;
9)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)&lt;br/&gt;
        ... 9 more&lt;br/&gt;
Caused by: ERROR XSDA1: An attempt was made to access an out of range slot on a page&lt;br/&gt;
        at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:276)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BasePage.checkSlotOnPage(BasePage.java:1830)&lt;br/&gt;
        at org.apache.derby.impl.store.raw.data.BasePage.fetchFromSlot(BasePage.java:431)&lt;br/&gt;
        at org.apache.derby.impl.store.access.btree.BTreeController.compareNextRecord(BTreeController.java:455)&lt;br/&gt;
        at org.apache.derby.impl.store.access.btree.BTreeController.compareLeftAndRightSiblings(BTreeController.java:556&lt;br/&gt;
)&lt;br/&gt;
        at org.apache.derby.impl.store.access.btree.BTreeController.doIns(BTreeController.java:813)&lt;br/&gt;
        at org.apache.derby.impl.store.access.btree.BTreeController.insert(BTreeController.java:1261)&lt;br/&gt;
        at org.apache.derby.impl.store.access.btree.index.B2IController.insert(B2IController.java:210)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.IndexChanger.insertAndCheckDups(IndexChanger.java:439)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.IndexChanger.doInsert(IndexChanger.java:383)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.IndexChanger.insert(IndexChanger.java:589)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.IndexSetChanger.insert(IndexSetChanger.java:267)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:453)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1022)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:495)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:297)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)&lt;br/&gt;
        ... 3 more&lt;/p&gt;

</comment>
                            <comment id="12670577" author="kmarsden" created="Thu, 5 Feb 2009 00:23:46 +0000"  >&lt;p&gt;confirmed this is a regression and does not occur with 10.3.3.1 &lt;/p&gt;</comment>
                            <comment id="12670694" author="knutanders" created="Thu, 5 Feb 2009 09:44:46 +0000"  >&lt;p&gt;So now we have a way to reproduce it. Great! Thanks, Uwe and Kathey.&lt;/p&gt;

&lt;p&gt;I&apos;m unchecking the regression checkbox since the repro uses a feature that is not present in 10.3 &amp;#8211; unique constraint on possibly null columns. The stack trace shows that the exception is thrown when updating an index for such a constraint. The reason why it works on 10.3 is that adding the unique constraint failed when running schema.sql:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; ALTER TABLE &quot;AIFUDIS&quot;.&quot;ORDERS&quot; ADD CONSTRAINT &quot;ORDERS_FLIGHT_NO_STD_INDEX&quot; UNIQUE (&quot;FLIGHT_NO&quot;, &quot;STD&quot;);&lt;br/&gt;
ERROR 42831: &apos;FLIGHT_NO&apos; cannot be a column of a primary key or unique key because it can contain null values.&lt;br/&gt;
ij&amp;gt; ALTER TABLE &quot;AIFUDIS&quot;.&quot;ORDERS&quot; ADD CONSTRAINT &quot;ORDERS_ICAO_FLIGHT_NO_STD_INDEX&quot; UNIQUE (&quot;ICAO_FLIGHT_NO&quot;, &quot;STD&quot;);&lt;br/&gt;
ERROR 42831: &apos;ICAO_FLIGHT_NO&apos; cannot be a column of a primary key or unique key because it can contain null values.&lt;/p&gt;</comment>
                            <comment id="12670720" author="knutanders" created="Thu, 5 Feb 2009 11:09:09 +0000"  >&lt;p&gt;BTreeController.compareNextRecord() and comparePreviousRecord() are on a page boundary and therefore need to check the first record of the next page or the last record of the previous page, they don&apos;t check if the slot number is out of bounds when they go to the next/previous page. This causes problems if the neighbour page doesn&apos;t have any records. The attached patch (recheck-slot.diff) makes the methods recheck that the slot numbers are within bounds after moving to another page.&lt;/p&gt;

&lt;p&gt;What I don&apos;t quite understand about the code, is that the record with slot number 0 is not used. That is, the code only looks at slots 1 ... (recordCount() - 1). Does anyone know why? Slot 0 is a valid slot, as far as I read the code, but if I change those methods to look at slot 0, they start throwing EOFException.&lt;/p&gt;

&lt;p&gt;I haven&apos;t run the regression tests, but at least the repro ran without errors with the patch.&lt;/p&gt;</comment>
                            <comment id="12670806" author="knutanders" created="Thu, 5 Feb 2009 16:07:41 +0000"  >&lt;p&gt;FWIW, all regression tests ran cleanly.&lt;/p&gt;</comment>
                            <comment id="12673577" author="donv" created="Sun, 15 Feb 2009 08:16:48 +0000"  >&lt;p&gt;So, this patch will be included in 10.4.2.1 ?&lt;/p&gt;</comment>
                            <comment id="12673682" author="mikem" created="Sun, 15 Feb 2009 17:24:09 +0000"  >&lt;p&gt;In btree pages, the first row, ie. the row in slot 0 is a special row and not a normal key row.  It is a control row that has whatever meta data is necessary for linking up the pages.  There are 2 different control rows depending on whether it is a leaf or branch.  See BranchControlRow.java and LeafControlRow.java for details on what is in each.  &lt;/p&gt;</comment>
                            <comment id="12673862" author="knutanders" created="Mon, 16 Feb 2009 12:31:30 +0000"  >&lt;p&gt;Thanks for the explanation, Mike.&lt;/p&gt;

&lt;p&gt;Here&apos;s a new version of the patch. Same code changes as before, but now with comments. Also added a simplified version of Kathey&apos;s test case to NullableUniqueConstraintTest.&lt;/p&gt;</comment>
                            <comment id="12673868" author="knutanders" created="Mon, 16 Feb 2009 12:45:22 +0000"  >&lt;p&gt;Uwe, I&apos;m planning to commit the fix to trunk so that it will be part of the upcoming 10.5.1 release (&lt;a href=&quot;http://wiki.apache.org/db-derby/DerbyTenFiveOneRelease&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/DerbyTenFiveOneRelease&lt;/a&gt;), and also to backport it to the 10.4 branch so that it will be part of the next 10.4 release if there will be one.&lt;/p&gt;</comment>
                            <comment id="12673878" author="donv" created="Mon, 16 Feb 2009 13:48:33 +0000"  >&lt;p&gt;Excellent!  Thank you!&lt;/p&gt;

&lt;p&gt;Out of curiosity:  What about version 10.5.0.0 ? Where can I read about what the parts of the derby version numbers mean?&lt;/p&gt;</comment>
                            <comment id="12673892" author="knutanders" created="Mon, 16 Feb 2009 14:27:49 +0000"  >&lt;p&gt;10.5.0.0 is the version number used for everything that is checked in on the development branch (trunk) until we create a separate 10.5 stable branch. There won&apos;t be a 10.5.0.0 release, instead the version number is bumped to 10.5.1.x when we create the stable branch. Some more explanation here: &lt;a href=&quot;http://db.apache.org/derby/papers/versionupgrade.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/papers/versionupgrade.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12673894" author="donv" created="Mon, 16 Feb 2009 14:36:15 +0000"  >&lt;p&gt;Thank you for the explanation and the link.&lt;/p&gt;</comment>
                            <comment id="12674192" author="knutanders" created="Tue, 17 Feb 2009 12:18:39 +0000"  >&lt;p&gt;Committed to trunk with revision 744984.&lt;/p&gt;</comment>
                            <comment id="12674582" author="knutanders" created="Wed, 18 Feb 2009 12:04:47 +0000"  >&lt;p&gt;I merged the fix to the 10.4 branch and committed revision 745485.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12399497" name="Derby4027Repro.java" size="2142" author="kmarsden" created="Wed, 4 Feb 2009 23:58:51 +0000"/>
                            <attachment id="12400273" name="d4027.diff" size="3377" author="knutanders" created="Mon, 16 Feb 2009 12:31:29 +0000"/>
                            <attachment id="12398817" name="derby.log" size="181334" author="donv" created="Tue, 27 Jan 2009 14:32:23 +0000"/>
                            <attachment id="12398814" name="derby.log" size="176863" author="donv" created="Tue, 27 Jan 2009 13:55:03 +0000"/>
                            <attachment id="12398807" name="derby.log" size="119611" author="donv" created="Tue, 27 Jan 2009 09:36:13 +0000"/>
                            <attachment id="12399556" name="recheck-slot.diff" size="927" author="knutanders" created="Thu, 5 Feb 2009 11:09:09 +0000"/>
                            <attachment id="12399487" name="schema.sql" size="17724" author="donv" created="Wed, 4 Feb 2009 22:15:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10364"><![CDATA[Data corruption]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 Jan 2009 14:46:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23974</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10422"><![CDATA[High Value Fix]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0l8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37258</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10050"><![CDATA[Blocker]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>