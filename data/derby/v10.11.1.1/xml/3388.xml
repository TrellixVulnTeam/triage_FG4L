<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:43:58 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3388/DERBY-3388.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3388] Improve message handling for replication messages to derby.log</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3388</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The asynchronous replication functionality writes information to the derby log. It would be good to improve this in the following ways:&lt;/p&gt;

&lt;p&gt;1: startSlave and stopSlave stack traces are written twice to the log - one is obviously enough &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
2: It should be possible to configure if replication messages written to the log should be followed by a stack trace of the cause.&lt;br/&gt;
3: logged messages should have a timestamp &lt;/p&gt;</description>
                <environment></environment>
        <key id="12387866">DERBY-3388</key>
            <summary>Improve message handling for replication messages to derby.log</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jorgenlo">J&#248;rgen L&#248;land</assignee>
                                    <reporter username="jorgenlo">J&#248;rgen L&#248;land</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Feb 2008 10:40:05 +0000</created>
                <updated>Wed, 2 Jun 2010 12:14:12 +0100</updated>
                            <resolved>Thu, 26 Nov 2009 06:12:15 +0000</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12571354" author="jorgenlo" created="Fri, 22 Feb 2008 10:59:00 +0000"  >&lt;p&gt;Patch derby-3388-tstamp-and-properties-1a adds a timestamp to replication messages written to derby.log. The following replication properties are also made configurable:&lt;/p&gt;

&lt;p&gt;derby.replication.verbose -&amp;gt; true/false - replication messages are written to log&lt;br/&gt;
derby.replication.logBufferSize -&amp;gt; the size of the replication log buffers&lt;br/&gt;
derby.replication.minLogShippingInterval -&amp;gt; the shortest interval between two consecutive log shipments&lt;br/&gt;
derby.replication.maxLogShippingInterval  -&amp;gt; the longest interval between two consecutive log shipments (a &quot;soft&quot; guarantee that the slave will not deviate more than this amount of millis from the master)&lt;/p&gt;

&lt;p&gt;All tests passed. The patch is ready for review.&lt;/p&gt;</comment>
                            <comment id="12571385" author="knutanders" created="Fri, 22 Feb 2008 12:47:47 +0000"  >&lt;p&gt;The patch basically looks good. A couple of small questions/comments:&lt;/p&gt;

&lt;p&gt;  1) You didn&apos;t say, but I assume these properties will be added to the user documentation?&lt;/p&gt;

&lt;p&gt;  2) String.toLowerCase() is locale dependent, so this code may not work in all locales:&lt;br/&gt;
+    private static final boolean LOG_REPLICATION_MESSAGES =&lt;br/&gt;
+       (PropertyUtil.getSystemProperty(Property.REPLICATION_VERBOSE) != null &amp;amp;&amp;amp;&lt;br/&gt;
+        PropertyUtil.getSystemProperty(Property.REPLICATION_VERBOSE).&lt;br/&gt;
+            toLowerCase().equals(&quot;false&quot;))&lt;br/&gt;
+       ? false&lt;br/&gt;
+       : true;&lt;br/&gt;
    It&apos;s better to use PropertyUtil.getSystemBoolean().&lt;/p&gt;

&lt;p&gt;  3) The code mentioned in (2) will read the property when the class is loaded. Couldn&apos;t that mean that it is read before the driver is loaded, so that code like this would not always behave correctly:&lt;br/&gt;
    System.setProperty(&quot;derby.replication.verbose&quot;, &quot;true&quot;);&lt;br/&gt;
    Class.forName(&quot;...EmbeddedDriver&quot;).forName();&lt;/p&gt;

&lt;p&gt;  4) Nit: I think it&apos;s better to give Monitor.logTextMessage() the date object, rather than a string representation returned by &quot;new Date().toString()&quot;. toString() will localize the date according to the JVM&apos;s locale, I think, whereas it will be localized together with the message according to the database&apos;s locale if the Date object is passed unmodified to logTextMessage(). (Monitor.logTextMessage() does take an Object argument)&lt;/p&gt;

&lt;p&gt;  5) It&apos;s probably better to use PropertyUtil.getSystemInt() than getSystemProperty() + parseInt().&lt;/p&gt;

&lt;p&gt;  6) Should the intervals and the buffer size be database properties so that you can make them persistent?&lt;/p&gt;</comment>
                            <comment id="12575618" author="jorgenlo" created="Thu, 6 Mar 2008 08:54:55 +0000"  >&lt;p&gt;Thanks for reviewing the patch, Knut. Patch v1b addresses your comments:&lt;/p&gt;

&lt;p&gt;1: yes - will be documented&lt;br/&gt;
2: changed to getSystemBoolean, but have to check if the property is set first because I want it to default to true. &lt;br/&gt;
3: I now create a ReplicationLogger object instead of using static logging methods. That will ensure that the check is performed at the time replication is started&lt;br/&gt;
4, 5: agree. done&lt;br/&gt;
6: good point. I&apos;ll address this in a followup patch&lt;/p&gt;

&lt;p&gt;All tests except the ones who fail in tinderbox (predicatePushdown.sql, TransactionTable.sql) passed.&lt;/p&gt;</comment>
                            <comment id="12575653" author="knutanders" created="Thu, 6 Mar 2008 10:58:07 +0000"  >&lt;p&gt;Thanks J&#248;rgen. I have started the regression tests and intend to commit the patch.&lt;/p&gt;

&lt;p&gt;A couple of minor nits that could be addressed in the follow-up patch if you agree:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;AsynchronousLogShipper.repLogger could be final.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Why not make the constant ReplicationLogBuffer.DEFAULT_NUMBER_LOG_BUFFERS public and skip the getNumberLogBuffers() method?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The fields LOG_REPLICATION_MESSAGES and DBNAME in ReplicationLogger aren&apos;t static any more, so I think they should have camel-cased names instead of upper-cased names.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ReplicationLogger&apos;s constructor could perhaps have a small comment explaining that the extra complexity is there to ensure that the derby.replication.verbose property defaults to true. Or perhaps the cleanest way would be to create a new getSystemBoolean() method in PropertyUtil that takes a default value. I see that other methods like getSystemInt() do this.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12575654" author="knutanders" created="Thu, 6 Mar 2008 11:03:05 +0000"  >&lt;p&gt;By the way, I think my question (6) was a bit inaccurate. It seems like the intervals and the buffer size can be persisted in derby.properties (since PropertyUtil.getSystemProperty() doesn&apos;t only look at system properties, as I though it did). But still, it would make sense to have those properties configurable with database granularity instead of system granularity, wouldn&apos;t it?&lt;/p&gt;</comment>
                            <comment id="12575699" author="jorgenlo" created="Thu, 6 Mar 2008 13:37:56 +0000"  >&lt;p&gt;Hi Knut,&lt;/p&gt;

&lt;p&gt;I noticed that a recent commit invalidated the 1b patch. The attached patch fixes the problem with the recent commit and your suggested improvements. I have not run tests yet&lt;/p&gt;</comment>
                            <comment id="12575734" author="knutanders" created="Thu, 6 Mar 2008 15:05:47 +0000"  >&lt;p&gt;Thanks for the updated patch, J&#248;rgen. I&apos;ll run some sanity checks and commit it.&lt;/p&gt;

&lt;p&gt;One final nit:&lt;/p&gt;

&lt;p&gt;Since ReplicationLogBuffer.DEFAULT_NUMBER_LOG_BUFFERS is static, I guess it&apos;s better if we replace&lt;br/&gt;
+        int buffers = logBuffer.DEFAULT_NUMBER_LOG_BUFFERS;&lt;br/&gt;
with&lt;br/&gt;
    int buffers = ReplicationLogBuffer.DEFAULT_NUMBER_LOG_BUFFERS;&lt;/p&gt;</comment>
                            <comment id="12576088" author="knutanders" created="Fri, 7 Mar 2008 08:53:31 +0000"  >&lt;p&gt;Committed revision 634586.&lt;/p&gt;</comment>
                            <comment id="12706899" author="kmarsden" created="Thu, 7 May 2009 14:39:31 +0100"  >&lt;p&gt;Can this be resolved?  I see a patch was committed.&lt;/p&gt;</comment>
                            <comment id="12874548" author="kristwaa" created="Wed, 2 Jun 2010 12:14:12 +0100"  >&lt;p&gt;Closing issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12376220" name="derby-3388-tstamp-and-properties-1a.diff" size="16308" author="jorgenlo" created="Fri, 22 Feb 2008 10:59:00 +0000"/>
                            <attachment id="12376221" name="derby-3388-tstamp-and-properties-1a.stat" size="486" author="jorgenlo" created="Fri, 22 Feb 2008 10:59:00 +0000"/>
                            <attachment id="12377234" name="derby-3388-tstamp-and-properties-1b.diff" size="20968" author="jorgenlo" created="Thu, 6 Mar 2008 08:54:55 +0000"/>
                            <attachment id="12377233" name="derby-3388-tstamp-and-properties-1b.stat" size="650" author="jorgenlo" created="Thu, 6 Mar 2008 08:54:55 +0000"/>
                            <attachment id="12377254" name="derby-3388-tstamp-and-properties-1c.diff" size="23075" author="jorgenlo" created="Thu, 6 Mar 2008 13:37:56 +0000"/>
                            <attachment id="12377253" name="derby-3388-tstamp-and-properties-1c.stat" size="727" author="jorgenlo" created="Thu, 6 Mar 2008 13:37:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 22 Feb 2008 12:47:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30832</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0q53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38053</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>