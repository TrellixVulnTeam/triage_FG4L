<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:22:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1137/DERBY-1137.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1137] Implement the new method introduced in CommonDataSource for Embedded Driver</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1137</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description></description>
                <environment>jdk1.6 jdbc4.0</environment>
        <key id="12330537">DERBY-1137</key>
            <summary>Implement the new method introduced in CommonDataSource for Embedded Driver</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12329433">DERBY-1051</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anurag">Anurag Shekhar</assignee>
                                    <reporter username="anurag">Anurag Shekhar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Mar 2006 16:10:35 +0000</created>
                <updated>Thu, 13 Dec 2007 09:04:51 +0000</updated>
                            <resolved>Wed, 26 Apr 2006 00:18:26 +0100</resolved>
                                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12371391" author="anurag" created="Wed, 22 Mar 2006 16:20:11 +0000"  >&lt;p&gt;Description of patch&lt;br/&gt;
This patch contains the implementation of new methods in javax.sql.CommonDataSource for Embedded jdbc driver.&lt;/p&gt;

&lt;p&gt;JDBC4.0 introduces a new method getQueryObjectGenerator () in java.sql.CommonDataSource. This class is base class of javax.sql.DataSource, javax.sql.ConnectionPoolDataSource and javax.sql.XADataSource. So the new methods needs to implemented by three DataSource available in derby.&lt;/p&gt;

&lt;p&gt;Return type of this method is java.sql.QueryObjectGenerator which is a jdbc4.0 &lt;br/&gt;
class. due to this class implementing this method should be in a class which is used only with jdbc4.0.&lt;/p&gt;

&lt;p&gt;This patch also introduces the connection classes required due to introduction of new methods in PoolableConnection. The new methods introduced in PoolableMethods are addConnectionEventListener and addStatementEventListener. These two methods needs to implemented in jdbc4.0 implementation of PoolableConnection and XAConnection.&lt;/p&gt;

&lt;p&gt;Newly introduced classes in this patch follows the similar inheritance hierarchy used in existing classes &lt;br/&gt;
ie&lt;br/&gt;
    EmbeddedDataSource40 extends from EmbeddedDataSource&lt;br/&gt;
    EmbeddedConnectionPoolDataSource40 and EmbeddedXADataSource40 extends from EmbeddedDataSource&lt;/p&gt;

&lt;p&gt;    EmbeddedPooledConnection40 extends from EmbeddedPooledConnection&lt;br/&gt;
    EmbeddedXAConnection40 extends from EmbeddedPooledConnection40&lt;/p&gt;

&lt;p&gt;EmbeddedXAConnection40 implements XAResource too.&lt;/p&gt;

&lt;p&gt;EmbeddedXAConnection has some methods (most of it inherited from BrokeredConnection and EmbeddedConnection) which is used by many internal classes. Even though these methods are available in EmbeddedXAConnection40 these two not compatible because of no inheritance relationship. To over come this problem I have introduced a new interface InternalXAConnection which has methods used in internal classes. &lt;br/&gt;
EmbeddedXAConnection and EmbeddedXAConnection40 implement this method.&lt;/p&gt;

&lt;p&gt;To share the XAResource implementation a new class InternalXAResource is introduced and the XAResource calls to EmbeddedXAConnection and EmbeddedXAConnection40 is redirected to InternalXAResource.&lt;/p&gt;

&lt;p&gt;Due to introduction of interface InternalXAConnection some of the method needed to change the access modifier. Two of such methods were getUser and getPassword. I assumed the restricted access to this method is due to security reason so it wasn&apos;t a good idea to make these method public. To overcome this problem I have introduced a new class UserInfo. The public method in InternalXAConnection returns UserInfo object which has two getter and these getters can be accessed only from the same package.In addition to this the class is immutable and values are transient.&lt;/p&gt;
</comment>
                            <comment id="12371590" author="dagw" created="Fri, 24 Mar 2006 01:10:03 +0000"  >&lt;p&gt;I noticed javadoc was missing in this patch on some new methods/classes.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;EmbedPooledConnection.java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;These new public (or changed to public) methods lack javadoc:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  getUserInfo&lt;br/&gt;
  openRealConnection&lt;br/&gt;
  getNewCurrentConnectionHandle&lt;br/&gt;
  resetRealConnection&lt;br/&gt;
  checkActive&lt;br/&gt;
  realConnection&lt;br/&gt;
  getCurrentConnectionHandle&lt;br/&gt;
  setRealConnection&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;EmbedXAConnection.java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;New public methods lack javadoc:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  getResourceAdapter&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;EmbedXAConnection40.java:&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public class EmbedXAConnection40 lacks javadoc.&lt;/li&gt;
&lt;/ul&gt;



&lt;ul&gt;
	&lt;li&gt;EmbedPooledConnection40.java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public class EmbedPooledConnection40 lacks javadoc.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12371629" author="anurag" created="Fri, 24 Mar 2006 03:55:18 +0000"  >&lt;p&gt;Thanks for looking into the patch.&lt;br/&gt;
I have added the java doc in public methods and classes.&lt;/p&gt;</comment>
                            <comment id="12371655" author="djd" created="Fri, 24 Mar 2006 07:42:54 +0000"  >&lt;p&gt;I&apos;m looking at this patch. Thanks for the good explanation.&lt;/p&gt;

&lt;p&gt;I am concerned by the number of methods that have become public, which allows applications to get underlying information,&lt;br/&gt;
but I need to study the patch a little more to see why they became public.&lt;/p&gt;

&lt;p&gt;Also it&apos;s unclear to me why some of the new classes, such as EmbedPooledConnection40 are public, is that required?&lt;/p&gt;

&lt;p&gt;InternalXAResource says it&apos;s an implementation of XAResource, but it isn&apos;t. The class does not implement that interface.&lt;br/&gt;
I would actually think it would be much cleaner if InternalXAResource did implement XAResource, and then the XAConnection&lt;br/&gt;
implementation&apos;s used an instance of it, rather than implementing XAResource themself. I would recommend this approach&lt;br/&gt;
and calling the class EmbedXAResource to match the existing naming scheme. This may have a knock on approach that&lt;br/&gt;
InternalXAConnection is not required, but I haven&apos;t looked into that fully yet.&lt;/p&gt;

&lt;p&gt;EmbeddedXADataSource40 and EmbeddedConnectionPoolDataSource40 follow the existing model that they also implement&lt;br/&gt;
DataSource, but we have had concerns in the past that they should not. I wonder if JDBC 4.0 would be a good time to break&lt;br/&gt;
that link, and have these two classes not implement javax.sql.DataSource.&lt;/p&gt;

&lt;p&gt;To my thinking this is a possibly a case where the incremental development could have been used. For example re-factoring&lt;br/&gt;
EmbedXAResource is one change, refactoring the code to use InternalXAConnection another and then finally adding the 4.0 classes.&lt;br/&gt;
With the one big patch it&apos;s hard to see why a specific change was made, which re-factoring was driving it. I guess this is just a plea&lt;br/&gt;
to think about such issues on future changes.&lt;/p&gt;

&lt;p&gt;Minor comment on modifying javadoc comments: In EmbeddedDataSource you have this:&lt;/p&gt;

&lt;p&gt;+    /**&lt;br/&gt;
+     * Moved this code from EmbeddedXADatasource to &lt;br/&gt;
+     * share the method between different versions of XADataSource           &lt;br/&gt;
+     * This method attenpts to create resource adapter to database&lt;/p&gt;

&lt;p&gt;The primary description for a method (or any javadoc comment) is the first sentence in the Javadoc, which means this method&lt;br/&gt;
will now be described as &quot;Moved this code from EmbeddedXADatasource to &lt;br/&gt;
+     * share the method between different versions of XADataSource  ....&quot;&lt;br/&gt;
which is not its function.  The first sentence should be the purpose of the method, I&apos;m not sure it&apos;s even useful having comments that it moved.&lt;/p&gt;</comment>
                            <comment id="12371699" author="anurag" created="Fri, 24 Mar 2006 18:33:42 +0000"  >&lt;p&gt;Thanks for review &lt;br/&gt;
I also think seperating XAResource from XAConnection will be good idea. &lt;/p&gt;

&lt;p&gt;This patch can be broken into three parts&lt;br/&gt;
1. Sperating XAResource and XAConnection&lt;br/&gt;
2. Implementation of jadbc 4.0 XAConnection PooledConnection&lt;br/&gt;
3. Implementation of jdbc4.0 DataSource classes&lt;/p&gt;

&lt;p&gt;If we decide to do away with XADataSource and ConnectionPoolDataSource  implementing javax.sql.DataSource &lt;br/&gt;
the patch will change substantially and can redo it in three steps.&lt;/p&gt;

&lt;p&gt;I have changes some of the methods to make public because they were accessed via interface InternalXAConnection. &lt;br/&gt;
If we decide to seperate the XAResource and XAConnection there won&apos;t be any need of this interface &lt;br/&gt;
(XAResource implementation can directly use the PooledConnection, EmbedXAConnection and EmbedXAConnection40) &lt;br/&gt;
and those methods can be left intact. &lt;/p&gt;

&lt;p&gt;EmbedPooledConnection40 need not be public I will change the scope of this class.&lt;/p&gt;</comment>
                            <comment id="12372925" author="anurag" created="Mon, 3 Apr 2006 19:06:21 +0100"  >&lt;p&gt;This patch uses EmbedPooledConnection40 and EmbedXAConnection40 which is available as part of patch in&lt;br/&gt;
derby-1163.&lt;/p&gt;

&lt;p&gt;This patch introduces the jdbc 4.0 implementation of XADataSource and ConnectionPoolDataSource&lt;br/&gt;
EmbedConnectionPoolDataSource40 extends from EmbedDataSource40 and EmbedXADataSource40 extends from&lt;br/&gt;
EmbedConnectionPoolDataSource40. &lt;/p&gt;

&lt;p&gt;Modifed classes&lt;br/&gt;
EmbedDataSource&lt;br/&gt;
EmbedXADataSource&lt;br/&gt;
      Moved part of the code to create RA to EmbeddedDataSource to share this beween EmbedXADataSource and &lt;br/&gt;
EmbedXADataSource40.&lt;/p&gt;

&lt;p&gt;xaHelper&lt;br/&gt;
      Added code to check if its running under jdk1.6 if it is tries to instantiate EmbedXADataSource40. If it fails assumes jdbc4.0 support is not available and continues with EmbedXADataSource.&lt;/p&gt;

&lt;p&gt;Testcase&lt;br/&gt;
     Test suite xa will use 40 classes if running under jdk1.6 with jdbc4.0 support available.&lt;/p&gt;</comment>
                            <comment id="12373090" author="rhillegas" created="Tue, 4 Apr 2006 22:39:05 +0100"  >&lt;p&gt;The jdbc4 tests run cleanly. So does derbyall modulo the expected diffs in wisconsin, sysinfo, and sysinfo_withproperties.&lt;/p&gt;</comment>
                            <comment id="12373140" author="rhillegas" created="Wed, 5 Apr 2006 01:47:11 +0100"  >&lt;p&gt;Hey Dan,&lt;/p&gt;

&lt;p&gt;I&apos;m ready to commit this patch if you think it&apos;s good to go. Thanks-Rick&lt;/p&gt;</comment>
                            <comment id="12373153" author="djd" created="Wed, 5 Apr 2006 03:08:16 +0100"  >&lt;p&gt;Not sure -  it seems the foundation that this is being built on has gone in a strange direction.&lt;/p&gt;

&lt;p&gt;EmbedXAConnection40 extends EmbedPooledConnection40 instread of EmbedXAConnection.&lt;/p&gt;

&lt;p&gt;That&apos;s a concern to me. This approach has lead to 11 real methods being copied into EmbedXAConnection40  from EmbedXAConnection&lt;br/&gt;
to save copying two new un-implemented methods. Seems a strange choice to me.&lt;/p&gt;

&lt;p&gt;Why not have EmbedXAConnection40 extend EmbedXAConnection. and then we would only have two methods copied&lt;br/&gt;
across EmbedPooledConnection40  and EmbedXAConnection40, rather than 11 across the current mix.&lt;/p&gt;</comment>
                            <comment id="12373392" author="anurag" created="Thu, 6 Apr 2006 01:20:52 +0100"  >&lt;p&gt;I have used this hirarchy to remain consistent with the current structure.&lt;br/&gt;
If its ok to change the exiting structure I can resubmit derby-1163&lt;/p&gt;</comment>
                            <comment id="12373998" author="anurag" created="Tue, 11 Apr 2006 19:16:27 +0100"  >&lt;p&gt;This patch depends on the latest patch available in 1163 (derby-1163_3.diff)&lt;br/&gt;
Description of tyhe patch&lt;/p&gt;

&lt;p&gt;I have changes the inheritance structure of XADatasource and ConnectionPoolDatasource as suggested in the privious reviews.&lt;br/&gt;
EmbedXADataSource40 extends from EmbedXADataSource and EmbedConnectionPoolDataSource40 extends from EmbedConnectionPoolDataSource. &lt;br/&gt;
I have added new protected methods in  EmbedConnectionPoolDataSource and EmbedXADataSource to create connection. These methods are over written in coresponding 40 classes to return jdbc4.0 version of XA and PooledConnections.&lt;/p&gt;</comment>
                            <comment id="12374332" author="rhillegas" created="Thu, 13 Apr 2006 21:52:15 +0100"  >&lt;p&gt;JDBC4 tests run cleanly. Derbyall runs cleanly modulo the wisconsin diff. Committed at subversion revision 393791.&lt;/p&gt;</comment>
                            <comment id="12551327" author="fuzzylogic" created="Thu, 13 Dec 2007 09:04:51 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12330843">DERBY-1163</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12324437" name="derby-1137.diff" size="105970" author="anurag" created="Wed, 22 Mar 2006 16:20:11 +0000"/>
                            <attachment id="12324520" name="derby-1137_2.diff" size="107687" author="anurag" created="Fri, 24 Mar 2006 03:55:17 +0000"/>
                            <attachment id="12324878" name="derby-1137_3.diff" size="15742" author="anurag" created="Mon, 3 Apr 2006 19:06:20 +0100"/>
                            <attachment id="12325185" name="derby-1137_4.diff" size="11206" author="anurag" created="Tue, 11 Apr 2006 19:16:26 +0100"/>
                            <attachment id="12324438" name="stat.out" size="975" author="anurag" created="Wed, 22 Mar 2006 16:20:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 24 Mar 2006 01:10:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29869</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy10bz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39704</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>