<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:10:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4594/DERBY-4594.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4594] ArrayIndexOutOfBoundsException thrown in PreparedStatement execution</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4594</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I am encountering the following exception when trying to execute a PreparedStatement:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.sql.SQLException: The exception &apos;java.lang.ArrayIndexOutOfBoundsException: -1&apos; was thrown while evaluating an expression.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)&lt;br/&gt;
	...&lt;br/&gt;
Caused by: java.lang.ArrayIndexOutOfBoundsException: -1&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.BaseActivation.getColumnFromRow(Unknown Source)&lt;br/&gt;
	at org.apache.derby.exe.ac80220011x0127x90baxe992x000075337d882.g0(Unknown Source)&lt;br/&gt;
	at org.apache.derby.exe.ac80220011x0127x90baxe992x000075337d882.e1(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.services.reflect.DirectCall.invoke(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.JoinResultSet.openCore(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)&lt;br/&gt;
	... 5 more&lt;/p&gt;

&lt;p&gt;The query I am executing is:&lt;br/&gt;
SELECT R.report_id, ER.entity_id FROM reports AS R &lt;br/&gt;
   LEFT JOIN entity_reports AS ER ON R.report_id = ER.report_id &lt;br/&gt;
WHERE R.details LIKE ? &lt;br/&gt;
   AND COALESCE(ER.entity_id, 0) != ? &lt;/p&gt;

&lt;p&gt;The table &apos;reports&apos; can be prepared with the following SQL:&lt;br/&gt;
ij&amp;gt; CREATE TABLE reports (report_id bigint PRIMARY KEY, document_num varchar(50), status varchar(100), type varchar(100) NOT NULL, specific varchar(100), owner varchar(100), summary clob, details clob, closing_remarks clob, occurred date, opened date, closed date, reference_guid varchar(50) NOT NULL);&lt;br/&gt;
ij&amp;gt; INSERT INTO reports (report_id, type, summary, details, reference_guid) VALUES (1, &apos;Type 1&apos;, &apos;Summary 1&apos;, &apos;Details 1&apos;, &apos;guid 1&apos;);&lt;/p&gt;

&lt;p&gt;The table &quot;entity_reports&quot; can be prepared with:&lt;br/&gt;
ij&amp;gt; CREATE TABLE entity_reports (report_id bigint, entity_id bigint, primary key (report_id, entity_id));&lt;br/&gt;
The error happens regardless of whether this table has rows in it or not. Technically both report_id and entity_id are foreign keys but that doesn&apos;t seem to make a difference.&lt;/p&gt;

&lt;p&gt;Executing the above SQL on a new derby database and then running the query, whether it&apos;s via JDBC from Java or directly through ij, causes the problem to occur. &lt;br/&gt;
Here is a copy of the query suitable for execution in ij (i.e., the values are filled out):&lt;br/&gt;
SELECT R.report_id, ER.entity_id FROM reports AS R &lt;br/&gt;
   LEFT JOIN entity_reports AS ER ON R.report_id = ER.report_id &lt;br/&gt;
WHERE R.details LIKE &apos;%Details%&apos; &lt;br/&gt;
   AND COALESCE(ER.entity_id, 0) != 1;&lt;/p&gt;

&lt;p&gt;I&apos;m open to the idea that I&apos;m doing something wrong, but the same code works against our test MSSQL db.&lt;br/&gt;
Thank you for your time.&lt;/p&gt;</description>
                <environment>Derby 10.5.3.0_1&lt;br/&gt;
Windows XP SP3&lt;br/&gt;
</environment>
        <key id="12460123">DERBY-4594</key>
            <summary>ArrayIndexOutOfBoundsException thrown in PreparedStatement execution</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="doleraj">Arthur Doler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Mar 2010 16:02:59 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:23 +0100</updated>
                            <resolved>Thu, 25 Mar 2010 14:47:38 +0000</resolved>
                                    <version>10.2.2.0</version>
                    <version>10.3.3.0</version>
                    <version>10.4.2.0</version>
                    <version>10.5.3.0</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12849248" author="doleraj" created="Wed, 24 Mar 2010 16:10:18 +0000"  >&lt;p&gt;Attached an sql script to create the test DB, create the tables, add the data, and run the failing query. Script does not disconnect or exit ij.&lt;/p&gt;</comment>
                            <comment id="12849256" author="kristwaa" created="Wed, 24 Mar 2010 16:17:01 +0000"  >&lt;p&gt;Thanks for reporting the bug and providing a repro, Arthur.&lt;/p&gt;

&lt;p&gt;Run with a trunk debug build the following assert is triggered:&lt;/p&gt;

&lt;p&gt;ERROR XJ001: Java exception: &apos;ASSERT FAILED sourceResultSetNumber expected to be &amp;gt;= 0 for ER.ENTITY_ID: org.apache.derby.shared.common.sanity.AssertFailure&apos;.&lt;br/&gt;
java.sql.SQLException: Java exception: &apos;ASSERT FAILED sourceResultSetNumber expected to be &amp;gt;= 0 for ER.ENTITY_ID: org.apache.derby.shared.common.sanity.AssertFailure&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2269)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:614)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:555)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:367)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:521)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:363)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:261)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.go(Main.java:229)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184)&lt;br/&gt;
	at org.apache.derby.impl.tools.ij.Main.main(Main.java:75)&lt;br/&gt;
	at org.apache.derby.tools.ij.main(ij.java:59)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at jline.ConsoleRunner.main(ConsoleRunner.java:69)&lt;br/&gt;
Caused by: java.sql.SQLException: Java exception: &apos;ASSERT FAILED sourceResultSetNumber expected to be &amp;gt;= 0 for ER.ENTITY_ID: org.apache.derby.shared.common.sanity.AssertFailure&apos;.&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)&lt;br/&gt;
	... 21 more&lt;br/&gt;
Caused by: org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED sourceResultSetNumber expected to be &amp;gt;= 0 for ER.ENTITY_ID&lt;br/&gt;
	at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:162)&lt;br/&gt;
	at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ColumnReference.generateExpression(ColumnReference.java:972)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.CoalesceFunctionNode.generateExpression(CoalesceFunctionNode.java:262)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.BinaryOperatorNode.generateExpression(BinaryOperatorNode.java:550)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.BinaryLogicalOperatorNode.generateExpression(BinaryLogicalOperatorNode.java:157)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1523)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1334)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.JoinNode.getJoinArguments(JoinNode.java:1632)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.JoinNode.generateCore(JoinNode.java:1610)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.JoinNode.generateCore(JoinNode.java:1547)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.HalfOuterJoinNode.generate(HalfOuterJoinNode.java:694)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1382)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1334)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1479)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1334)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.ScrollInsensitiveResultSetNode.generate(ScrollInsensitiveResultSetNode.java:109)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.CursorNode.generate(CursorNode.java:608)&lt;br/&gt;
	at org.apache.derby.impl.sql.compile.StatementNode.generate(StatementNode.java:347)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:469)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:90)&lt;br/&gt;
	at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:828)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:606)&lt;br/&gt;
	... 14 more&lt;/p&gt;</comment>
                            <comment id="12849264" author="kristwaa" created="Wed, 24 Mar 2010 16:24:58 +0000"  >&lt;p&gt;Bug exists back to 10.2, didn&apos;t try earlier versions (not readily available atm).&lt;/p&gt;</comment>
                            <comment id="12849521" author="knutanders" created="Wed, 24 Mar 2010 23:10:57 +0000"  >&lt;p&gt;Here&apos;s a stripped down repro:&lt;/p&gt;

&lt;p&gt;CREATE TABLE t1(a1 INT);&lt;br/&gt;
CREATE TABLE t2(a2 INT);&lt;br/&gt;
INSERT INTO t1 VALUES 1;&lt;/p&gt;

&lt;p&gt;This statement will cause an ArrayIndexOutOfBoundsException:&lt;/p&gt;

&lt;p&gt;SELECT 1 FROM t1 LEFT JOIN t2 ON 1=1 WHERE COALESCE(a2, 0) != 1;&lt;/p&gt;

&lt;p&gt;Whereas this statement will cause a NullPointerException:&lt;/p&gt;

&lt;p&gt;SELECT 1 FROM t1 JOIN t2 ON 1=1 WHERE COALESCE(a2, 0) != 1;&lt;/p&gt;</comment>
                            <comment id="12849554" author="knutanders" created="Thu, 25 Mar 2010 00:43:30 +0000"  >&lt;p&gt;The problem appears to be that CoalesceFunctionNode lacks an override of the categorize() method. The repro runs successfully with the attached patch.&lt;/p&gt;</comment>
                            <comment id="12849713" author="knutanders" created="Thu, 25 Mar 2010 14:47:17 +0000"  >&lt;p&gt;Added a comment and a regression test case and committed the changes to trunk with revision 927430.&lt;/p&gt;</comment>
                            <comment id="12849915" author="knutanders" created="Thu, 25 Mar 2010 21:45:01 +0000"  >&lt;p&gt;Merged fix to the 10.5 branch and committed revision 927599.&lt;/p&gt;</comment>
                            <comment id="13685224" author="knutanders" created="Mon, 17 Jun 2013 10:19:23 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12436643">DERBY-4389</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12439740" name="categorize.diff" size="1198" author="knutanders" created="Thu, 25 Mar 2010 00:43:30 +0000"/>
                            <attachment id="12439668" name="script.sql" size="760" author="doleraj" created="Wed, 24 Mar 2010 16:10:18 +0000"/>
                            <attachment id="12439779" name="with_tests.diff" size="2814" author="knutanders" created="Thu, 25 Mar 2010 14:47:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 24 Mar 2010 16:17:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24355</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0q4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38052</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>