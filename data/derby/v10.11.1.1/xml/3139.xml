<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:40:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3139/DERBY-3139.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3139] setObject and other setXXX methods on PreparedStatement throw different exceptions in Network Server when parameter number is out of range</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3139</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In Network Server, when a user executes PreparedStatement.setObject with out of range parameter number, the exception thrown is XCL13 but when the user tries PreparedStatement.setString with out of range parameter number, the exception thrown in Network Server is XCL14. We should throw same exception for both the cases. &lt;/p&gt;

&lt;p&gt;The reason for this difference in behavior is client.am.PreparedStatement.setObject calls checkForValidParameterIndex for parameter number checking and that method throws exception XCL13. &lt;/p&gt;

&lt;p&gt;All the other PreparedStatement.setXXX methods end up calling getColumnMetaDataX().getColumnType(parameterIndex); which results into call to client.am.ColumnMetaData:getColumnType() which in turn calls checkForValidColumnIndex for parameter number checking and that method throws exception XCL14. &lt;/p&gt;

&lt;p&gt;I am adding a test case for this in derbynet.PrepareStatementTest.&lt;/p&gt;

&lt;p&gt;I am wondering if the community has any objection to one of the error message getting changed into another. I wonder if it will cause user applications to break because they rely of different error message. And if not, any ideas on which one we should get rid of?&lt;/p&gt;

&lt;p&gt;Also, the exception thrown for these 2 cases in Embedded server is same but it is not XCL14 or XCL13. I will work on entering another jira entry for difference in exception for embedded and network server.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12380803">DERBY-3139</key>
            <summary>setObject and other setXXX methods on PreparedStatement throw different exceptions in Network Server when parameter number is out of range</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mamtas">Mamta A. Satoor</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Oct 2007 20:23:19 +0100</created>
                <updated>Thu, 7 May 2009 16:56:24 +0100</updated>
                                            <version>10.3.1.4</version>
                    <version>10.4.1.3</version>
                                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12536365" author="kmarsden" created="Fri, 19 Oct 2007 23:34:56 +0100"  >&lt;p&gt;I think since this is pretty much a usage error, probably noone is going to have their app check for this particular exception.  We document that network client SQLStates might change in:&lt;br/&gt;
&lt;a href=&quot;http://db.apache.org/derby/docs/10.1/ref/rrefexcept71493.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/10.1/ref/rrefexcept71493.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;so if we change it I think it would be best to keep the embedded state.&lt;/p&gt;
</comment>
                            <comment id="12537503" author="mamtas" created="Thu, 25 Oct 2007 06:52:57 +0100"  >&lt;p&gt;I will work on this tomorrow ie change the SQL State for network server to match embedded state. I wonder why we used a different SQL state in network server to start with. Maybe just an oversight.&lt;/p&gt;</comment>
                            <comment id="12537842" author="mamtas" created="Fri, 26 Oct 2007 07:03:09 +0100"  >&lt;p&gt;I want to summarize the status of this Jira entry. &lt;/p&gt;

&lt;p&gt;When I filed this Jira entry, there were 2 items that needed to be tackled.&lt;/p&gt;

&lt;p&gt;1)When PreparedStatement does not have any parameter, and a user tries to use setObject(int,Object,int) on it, Embedded threw SQL State 07009 whereas Network Server threw XCL13. I fixed this change in behavior as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3046&quot; title=&quot;setObj(int,Object,int) causes NPE if no parameter markers are present; should generate SQLException as for setObject(int,Object)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3046&quot;&gt;&lt;del&gt;DERBY-3046&lt;/del&gt;&lt;/a&gt; (trunk revision 588527).&lt;/p&gt;

&lt;p&gt;2)The second issue is specific to Network Server. &lt;br/&gt;
If the PreparedStatement has non-zero number of parameters and user tries to use setObject with out of range parameter number, Network Server throws XCL13(which is same as Embedded Server). This exception is thrown by method org.apache.derby.client.am.PreparedStatement:checkForValidParameterIndex which is called at line 1439 in org.apache.derby.client.am.PreparedStatement:setObject. &lt;br/&gt;
But if the user tries to use say setString with out of range parameter number, Network Server throws XCL14(Embedded throws XCL13). This is because for setString in NetworkServer, we do not call org.apache.derby.client.am.PreparedStatement:checkForValidParameterIndex. Instead, we call (line 931 in org.apache.derby.client.am.PreparedStatement:setString) org.apache.derby.client.am.ColumnMetaData:checkForValidColumnIndex which throws XCL14. I can&apos;t change org.apache.derby.client.am.ColumnMetaData:checkForValidColumnIndex to throw XCL13 because that method is also used for calls like ResultSetMetaData:isNullable and if isNullable is called with invalid column number, we do want to throw XCL14. &lt;br/&gt;
One way to fix this problem is to have setString call org.apache.derby.client.am.PreparedStatement:checkForValidParameterIndex just like setObject but that means that for every setString in Network Server, there will 2 checks made for valid parameter number. One check will be in org.apache.derby.client.am.PreparedStatement:checkForValidParameterIndex and next check will be in org.apache.derby.client.am.ColumnMetaData:checkForValidColumnIndex. If the parameter number indeed is invalid, it will be caught in the parameter check in PreparedStatement:checkForValidParameterIndex but if it is valid, then we will do unnecessary check for parameter number again in ColumnMetaData:checkForValidColumnIndex. &lt;br/&gt;
Since all this is happening at compile time, may be it is ok to let the checking happen 2 times. I haven&apos;t spent enough time on this to figure out if we can do this in a different way so that we always throw XCL13 when the parameter number for setObject and setString is out of range. Also, the same issue exists for setShort, setInt, setBlob etc&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10363"><![CDATA[Embedded/Client difference]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 19 Oct 2007 22:34:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30738</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0x3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39180</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>