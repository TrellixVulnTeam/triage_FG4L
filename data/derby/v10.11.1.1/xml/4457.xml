<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:41:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4457/DERBY-4457.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4457] &apos;Column value mismatch&apos; in &apos;testDistinctInsertWithGeneratedColumn(...lang.DistinctTest)&apos; on Jvm 1.5, 1.4, phoneME.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4457</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>
&lt;p&gt;See e.g. &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/sol/885498-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/sol/885498-suitesAll_diff.txt&lt;/a&gt; :&lt;/p&gt;

&lt;p&gt;1) testDistinctInsertWithGeneratedColumn(org.apache.derbyTesting.functionTests.tests.lang.DistinctTest)junit.framework.AssertionFailedError: Column value mismatch @ column &apos;C12&apos;, row 1:&lt;br/&gt;
    Expected: &amp;gt;1&amp;lt;&lt;br/&gt;
    Found:    &amp;gt;2&amp;lt;&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:1081)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertRowInResultSet(JDBC.java:993)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:881)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:819)&lt;br/&gt;
	at org.apache.derbyTesting.junit.JDBC.assertFullResultSet(JDBC.java:777)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.DistinctTest.testDistinctInsertWithGeneratedColumn(DistinctTest.java:462)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
	at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
	at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
	at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;/p&gt;</description>
                <environment>JVM:&lt;br/&gt;
Sun Microsystems Inc.&lt;br/&gt;
java version &amp;quot;1.5.0_14&amp;quot;&lt;br/&gt;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_14-b03)&lt;br/&gt;
Java HotSpot(TM) Server VM (build 1.5.0_14-b03 mixed mode 32-bit)&lt;br/&gt;
&lt;br/&gt;
Sun Microsystems Inc.&lt;br/&gt;
java version &amp;quot;1.4.2_02&amp;quot;&lt;br/&gt;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.4.2_02-b03)&lt;br/&gt;
Java HotSpot(TM) Client VM (build 1.4.2_02-b03 mixed mode 32-bit)&lt;br/&gt;
&lt;br/&gt;
Product: phoneME Advanced (phoneme_advanced_mr2-b116)&lt;br/&gt;
Profile: Foundation Profile Specification 1.1&lt;br/&gt;
JVM:     CVM phoneme_advanced_mr2-b116 (interpreter loop)&lt;br/&gt;
</environment>
        <key id="12442061">DERBY-4457</key>
            <summary>&apos;Column value mismatch&apos; in &apos;testDistinctInsertWithGeneratedColumn(...lang.DistinctTest)&apos; on Jvm 1.5, 1.4, phoneME.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="olesolberg">Ole Solberg</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Dec 2009 08:25:57 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:32 +0100</updated>
                            <resolved>Fri, 9 Jul 2010 00:29:37 +0100</resolved>
                                    <version>10.6.1.0</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12784168" author="knutanders" created="Tue, 1 Dec 2009 10:48:52 +0000"  >&lt;p&gt;This failure was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4442&quot; title=&quot;Evaluation of default value and identity in an INSERT result set evaluated too early.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4442&quot;&gt;&lt;del&gt;DERBY-4442&lt;/del&gt;&lt;/a&gt;, and the root cause is that the test relies on a specific implicit ordering of the results that&apos;s not guaranteed.&lt;/p&gt;

&lt;p&gt;In short, the following sequence of statements (simplified test case)&lt;/p&gt;

&lt;p&gt;create table source (x int);&lt;br/&gt;
insert into source values 1,2;&lt;br/&gt;
create table dest (x int, y int generated always as identity);&lt;br/&gt;
insert into dest&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; select distinct x from source;&lt;/p&gt;

&lt;p&gt;used to result in the table DEST containing the rows (1,1) and (2,2) regardless of JVM.&lt;/p&gt;

&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4442&quot; title=&quot;Evaluation of default value and identity in an INSERT result set evaluated too early.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4442&quot;&gt;&lt;del&gt;DERBY-4442&lt;/del&gt;&lt;/a&gt;, it contains (1,1), (2,2) with Sun&apos;s JVM version 1.6 or later, whereas earlier JVM versions produce a table that contains the rows (2,1) and (1,2).&lt;/p&gt;

&lt;p&gt;Even without the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4442&quot; title=&quot;Evaluation of default value and identity in an INSERT result set evaluated too early.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4442&quot;&gt;&lt;del&gt;DERBY-4442&lt;/del&gt;&lt;/a&gt; patch, one will see that &quot;SELECT DISTINCT X FROM SOURCE&quot; gives different results on different JVMs. But before &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4442&quot; title=&quot;Evaluation of default value and identity in an INSERT result set evaluated too early.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4442&quot;&gt;&lt;del&gt;DERBY-4442&lt;/del&gt;&lt;/a&gt;, a SELECT DISTINCT that acted as a source for an INSERT statement would go through a sort if the target table contained an identity column, so the rows would happen to be inserted in sorted order. After &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4442&quot; title=&quot;Evaluation of default value and identity in an INSERT result set evaluated too early.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4442&quot;&gt;&lt;del&gt;DERBY-4442&lt;/del&gt;&lt;/a&gt;, a sort is no longer needed, and the rows are inserted in the same order by which they returned from the DistinctScanResultSet.&lt;/p&gt;

&lt;p&gt;Since the insertion order is not guaranteed unless there&apos;s an ORDER BY clause (which is not accepted syntax until &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4&quot; title=&quot;&amp;quot;order by&amp;quot; is not supported for &amp;quot;insert ... select&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4&quot;&gt;&lt;del&gt;DERBY-4&lt;/del&gt;&lt;/a&gt; is fixed), the difference in the results depending on JVM is OK, and the test should be changed to be independent of the JVM&apos;s hash implementation.&lt;/p&gt;</comment>
                            <comment id="12784169" author="knutanders" created="Tue, 1 Dec 2009 10:52:06 +0000"  >&lt;p&gt;The attached patch makes the test more robust against variations in the ordering of the results.&lt;/p&gt;</comment>
                            <comment id="12784172" author="knutanders" created="Tue, 1 Dec 2009 10:55:42 +0000"  >&lt;p&gt;Committed revision 885726.&lt;/p&gt;</comment>
                            <comment id="12784231" author="bryanpendleton" created="Tue, 1 Dec 2009 14:03:28 +0000"  >&lt;p&gt;Does this indicate the need for a release note on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4442&quot; title=&quot;Evaluation of default value and identity in an INSERT result set evaluated too early.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4442&quot;&gt;&lt;del&gt;DERBY-4442&lt;/del&gt;&lt;/a&gt;, to warn users about the possible behavior change?&lt;/p&gt;</comment>
                            <comment id="12784244" author="knutanders" created="Tue, 1 Dec 2009 14:36:37 +0000"  >&lt;p&gt;Since the ordering is unspecified, and it could vary depending on available indexes and which plan was chosen even before &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4442&quot; title=&quot;Evaluation of default value and identity in an INSERT result set evaluated too early.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4442&quot;&gt;&lt;del&gt;DERBY-4442&lt;/del&gt;&lt;/a&gt;, I don&apos;t think a release note is needed. Here&apos;s an example with 10.5.3.0 showing that different plans could cause different ordering with this kind of query earlier as well:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table dest(x int, y int generated always as identity);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into dest&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; select distinct x from source;&lt;br/&gt;
5 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select * from dest;&lt;br/&gt;
X          |Y          &lt;br/&gt;
-----------------------&lt;br/&gt;
1          |1          &lt;br/&gt;
2          |2          &lt;br/&gt;
3          |3          &lt;br/&gt;
4          |4          &lt;br/&gt;
5          |5          &lt;/p&gt;

&lt;p&gt;5 rows selected&lt;br/&gt;
ij&amp;gt; delete from dest;&lt;br/&gt;
5 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create index idx on source(x desc);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into dest&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; select distinct x from source;&lt;br/&gt;
5 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; select * from dest;&lt;br/&gt;
X          |Y          &lt;br/&gt;
-----------------------&lt;br/&gt;
1          |10         &lt;br/&gt;
2          |9          &lt;br/&gt;
3          |8          &lt;br/&gt;
4          |7          &lt;br/&gt;
5          |6          &lt;/p&gt;

&lt;p&gt;5 rows selected&lt;/p&gt;</comment>
                            <comment id="12886549" author="mikem" created="Fri, 9 Jul 2010 00:21:11 +0100"  >&lt;p&gt;reopening issue to backport it to 10.5 to fix some nightly diffs showing up against ibm jvm&apos;s after recent backports.&lt;/p&gt;</comment>
                            <comment id="12886552" author="mikem" created="Fri, 9 Jul 2010 00:29:37 +0100"  >&lt;p&gt;backported fix #885726 from trunk to 10.5, resolving as fixed, and resetting original owner.&lt;/p&gt;

&lt;p&gt;s105_ibm16:28&amp;gt;svn commit&lt;/p&gt;

&lt;p&gt;Sending        java\testing\org\apache\derbyTesting\functionTests\test\lang\DistinctTest.java&lt;br/&gt;
Transmitting file data .&lt;br/&gt;
Committed revision 962152.&lt;/p&gt;</comment>
                            <comment id="13685271" author="knutanders" created="Mon, 17 Jun 2013 10:19:31 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12440634">DERBY-4442</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12442131">DERBY-4460</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12426524" name="d4457.diff" size="1430" author="knutanders" created="Tue, 1 Dec 2009 10:52:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Dec 2009 10:48:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24269</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0pmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37969</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>