<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:43:40 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4323/DERBY-4323.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4323] test failure in lang.ErrorMessageTest with IBM iseries IBM 1.5</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4323</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;There was this error during the 10.5.2.0 test run - when the ErrorMessageTest was run by itself later there was no problem, and neither did this show up during the ibm 1.6 run:&lt;/p&gt;

&lt;p&gt;1) testDeadlockTimeout(org.apache.derbyTesting.functionTests.tests.lang.ErrorMessageTest)junit.framework.ComparisonFailure: Not a deadlock expected:&amp;lt;...001&amp;gt; but was:&amp;lt;...XL2&amp;gt;&lt;/p&gt;</description>
                <environment>IBM iseries, OS: AS/400; OS version: V5R4M0, IBM 1.5 (1.5.0_13-b05)&lt;br/&gt;
</environment>
        <key id="12431594">DERBY-4323</key>
            <summary>test failure in lang.ErrorMessageTest with IBM iseries IBM 1.5</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                            <label>derby_triage10_8</label>
                    </labels>
                <created>Tue, 28 Jul 2009 15:56:35 +0100</created>
                <updated>Wed, 3 Sep 2014 09:31:20 +0100</updated>
                            <resolved>Thu, 25 Oct 2012 16:49:10 +0100</resolved>
                                    <version>10.5.2.0</version>
                                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12736092" author="myrna" created="Tue, 28 Jul 2009 15:58:23 +0100"  >&lt;p&gt;derby.log output and error stack trace from the fail directory.&lt;/p&gt;</comment>
                            <comment id="12744009" author="knutanders" created="Mon, 17 Aug 2009 10:44:32 +0100"  >&lt;p&gt;The log shows that a timeout exception was thrown instead of a deadlock exception. The lock table does however show that there is a deadlock, so either the deadlock detection algorithm must have failed to detect it, or the deadlock didn&apos;t happen until after the deadlock detection algorithm had completed. My guess is on the latter. If it happens again, we could try to increase the deadlock timeout in the test (currently two seconds) to give it more time to get into the expected state before deadlock detection is performed.&lt;/p&gt;</comment>
                            <comment id="12966295" author="myrna" created="Thu, 2 Dec 2010 21:48:36 +0000"  >&lt;p&gt;I saw this again while testing 10.7.1.0 and again with 10.7.1.1 - but both times only with ibm 1.6, not ibm 1.5. Note that it didn&apos;t fail during the 10.6.2.0 nor 10.6.2.1 test runs, using the same os &amp;amp; jvm versions.&lt;br/&gt;
In short, it seems somewhat intermittent.&lt;/p&gt;

&lt;p&gt;I am hesitant to increase the deadlocktimeout in the test, wouldn&apos;t that make the test slow down always? &lt;br/&gt;
On the other hand, it&apos;s bothersome to have another intermittent failure if there&apos;s no bug, and I also don&apos;t want to add yet another optional flag. I&apos;ll experiment modifying the test to force the failure, then decide...&lt;/p&gt;</comment>
                            <comment id="13483358" author="knutanders" created="Wed, 24 Oct 2012 17:23:58 +0100"  >&lt;p&gt;I saw this now with Java SE Embedded 7 running on a 720MHz ARM processor (timing issues are to be expected, as suites.All takes 14 hours to complete on this platform).&lt;/p&gt;

&lt;p&gt;I think it should be possible to reduce the risk of these timing problems without increasing the deadlock timeout. For example, we could compile both of the SELECT statements that we set up for deadlock, before we execute them. This way, the time it takes to compile the queries doesn&apos;t eat up parts of the two-second time slot we have available for getting the statements to execute and reach the point where they lock the row. I&apos;ll give it a try.&lt;/p&gt;</comment>
                            <comment id="13483991" author="knutanders" created="Thu, 25 Oct 2012 10:05:47 +0100"  >&lt;p&gt;I haven&apos;t been able to reproduce the failure, but here&apos;s a patch that I&apos;m planning to commit, and that I expect to reduce the risk of this happening again.&lt;/p&gt;

&lt;p&gt;Currently, the test has a race between two threads that perform the following steps:&lt;/p&gt;

&lt;p&gt;T1_1: compile query&lt;br/&gt;
T1_2: start executing query&lt;br/&gt;
T1_3: lock row&lt;/p&gt;

&lt;p&gt;T2_1: start new thread&lt;br/&gt;
T2_2: compile query&lt;br/&gt;
T2_3: start executing query&lt;br/&gt;
T2_4: lock row&lt;/p&gt;

&lt;p&gt;The events T1_3 and T2_4 must happen no more than 2 seconds apart.&lt;/p&gt;

&lt;p&gt;The patch makes sure that both of the two threads have completed the query compilation before the race starts. Since there are less steps to be done concurrently, and also the amount of work done concurrently is more evenly distributed, the chance of a big time difference in the last step should be smaller.&lt;/p&gt;

&lt;p&gt;It does this by splitting up Statement.executeQuery() into prepareStatement() + executeQuery() and introducing a barrier before the executeQuery() calls to make sure they start at the same time.&lt;/p&gt;

&lt;p&gt;I factored out the already existing Barrier classes from IndexSplitDeadlockTest and DeadlockDetectionTest for this purpose (since we cannot use java.util.concurrent.CyclicBarrier as long as we support platforms less capable than Java 5).&lt;/p&gt;</comment>
                            <comment id="13484007" author="knutanders" created="Thu, 25 Oct 2012 10:42:23 +0100"  >&lt;p&gt;Committed revision 1402043.&lt;/p&gt;

&lt;p&gt;It&apos;s difficult to say if this is enough to fix the problem, since it&apos;s so hard to reproduce. Should we resolve for now and reopen/file a new report if it happens again?&lt;/p&gt;</comment>
                            <comment id="13484204" author="myrna" created="Thu, 25 Oct 2012 16:49:10 +0100"  >&lt;p&gt;Thank you for looking into this failure!&lt;br/&gt;
I did not see this failure in the testing for any more recent releases on this OS (i.e. ibm iseries - not for any 10.8 release (or candidate), nor 10.9). I think this coincides with a change in hardware and OS version. I can&apos;t remember having seen this anywhere else (I usually add a comment in an open test issue if I see it again, and I have not done that for this one, so it&apos;s likely I didn&apos;t see it again).&lt;br/&gt;
I think closing is appropriate, and if this occurs again, we can reopen or open a new issue. &lt;br/&gt;
I&apos;m resolving instead of closing, in case we want to backport this.&lt;/p&gt;</comment>
                            <comment id="14119537" author="knutanders" created="Wed, 3 Sep 2014 09:31:20 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12617075">DERBY-6001</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12414746" name="ErrorMessageTest_derby.log" size="935474" author="myrna" created="Tue, 28 Jul 2009 15:58:23 +0100"/>
                            <attachment id="12550757" name="d4323-1a.diff" size="12156" author="knutanders" created="Thu, 25 Oct 2012 10:05:47 +0100"/>
                            <attachment id="12414747" name="error-stacktrace.out" size="11608" author="myrna" created="Tue, 28 Jul 2009 15:58:23 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 17 Aug 2009 09:44:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24184</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0hin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36656</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>