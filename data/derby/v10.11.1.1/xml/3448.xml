<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:08:37 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3448/DERBY-3448.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3448] Allow the MailJdbc system test to run under junit.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3448</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;It would be good to get the mailjdbc test to run under junit to allow use of the utilities there and decorators such as running the test getting all connections from a data source with a statement caching.&lt;/p&gt;

&lt;p&gt;Could still allow the test to run standalone in its current form&lt;/p&gt;</description>
                <environment></environment>
        <key id="12389346">DERBY-3448</key>
            <summary>Allow the MailJdbc system test to run under junit.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="djd">Daniel John Debrunner</reporter>
                        <labels>
                            <label>derby_triage10_11</label>
                    </labels>
                <created>Fri, 22 Feb 2008 20:01:30 +0000</created>
                <updated>Fri, 14 Jun 2013 00:25:09 +0100</updated>
                                                                            <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12571583" author="djd" created="Fri, 22 Feb 2008 20:35:42 +0000"  >&lt;p&gt;Minor cleanup of DbTasks class&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;no need to implement Thread since it is never used as a thread&lt;/li&gt;
	&lt;li&gt;don&apos;t set system property for authorization as it is set in the required derby.properties&lt;/li&gt;
	&lt;li&gt;fix mt issue for getting connections (remove shared properties object)&lt;/li&gt;
	&lt;li&gt;don&apos;t have if != null checks for objects that cannot be null.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12571588" author="djd" created="Fri, 22 Feb 2008 20:46:30 +0000"  >&lt;p&gt;Another mt issue is the re-setting of the auto-commit state in DbTasks, it uses a static field so all threads will be using it at the same time. Better just to use a local variable, or even set the threads up once to use autocommit false all the time if that&apos;s what really is going on.&lt;/p&gt;

&lt;p&gt;While the auto-commit state is reset carefully (though not mt safe) the isolation level is not handled the same way. The read mail method sets the isolation to read-uncommitted but never resets it, that thread may then proceed to update the database using read-uncommitted. I don&apos;t think this is intentional, it would be good to clean this up to ensure that the logical actions are occurring at the intended isolation level.&lt;/p&gt;</comment>
                            <comment id="12572649" author="mkutty" created="Tue, 26 Feb 2008 20:51:34 +0000"  >&lt;p&gt;Here is a patch that addresses the autocommit and isolation level issue. Please review and if looks good please commit. The junit part is not yet ready&lt;/p&gt;</comment>
                            <comment id="12572696" author="mkutty" created="Tue, 26 Feb 2008 22:26:40 +0000"  >&lt;p&gt;Realised that I uploaded the patch after applying Dan&apos;s patch. Here is the new patch&lt;/p&gt;</comment>
                            <comment id="12572702" author="djd" created="Tue, 26 Feb 2008 22:41:07 +0000"  >&lt;p&gt;Could you explain the benefit of the complexity of adding the getAutoCommit() and getIsolationLevel() methods?&lt;br/&gt;
Without comments I can&apos;t really see why they are there, it seems to only to track errors, but when setting auto-commit or isolation level errors&lt;br/&gt;
are not tracked in the same way are they?&lt;/p&gt;
</comment>
                            <comment id="12572710" author="mkutty" created="Tue, 26 Feb 2008 23:03:18 +0000"  >&lt;p&gt;I added the new get methods so that I can initialize them to the current autocommit state/isolation level. If not, it was complaining the local variable is not initialized properly. &lt;/p&gt;</comment>
                            <comment id="12572717" author="djd" created="Tue, 26 Feb 2008 23:34:37 +0000"  >&lt;p&gt;I think that&apos;s because your save state and reset logic is not laid out correctly. The code is logically currently laid out like this:&lt;/p&gt;

&lt;p&gt; boolean ac = conn.getAutoCommit();&lt;br/&gt;
 try &lt;/p&gt;
{
   // do SQL stuff
  conn.setAutoCommit(ac);
 }
&lt;p&gt; catch (SQLException sqle)&lt;/p&gt;
 {
   // error handling
 }&lt;br/&gt;
&lt;br/&gt;
The issue with this is that if the SQL stuff throws an exception then you will never reset the auto-commit state (and the isolation state in the real code).&lt;br/&gt;
&lt;br/&gt;
If you want to ensure the state is always reset then you need to put in the finally block, or after the try-catch block if the catch block does not re-thrown an exception, e.g.&lt;br/&gt;
&lt;br/&gt;
boolean ac = conn.getAutoCommit();&lt;br/&gt;
 try {
   // do SQL stuff
  
 } catch (SQLException sqle)&lt;br/&gt;
 {
   // error handling
 }
&lt;p&gt; finallly {&lt;/p&gt;
 {
    conn.setAutoCommit(ac);
 }

&lt;p&gt;Now this does lead to your outer method having to throw SQLException, but I think that&apos;s just a fact of life with JDBC applications.&lt;/p&gt;

&lt;p&gt;In fact the whole code may become clearer if you only catch SQLException&apos;s at a very high level rather than in each logical operation.&lt;br/&gt;
So only have try/catch blocks where you need to perform some action (e.g. rollback, resetting connection state) rather than just for error logging.&lt;/p&gt;</comment>
                            <comment id="12572718" author="djd" created="Tue, 26 Feb 2008 23:41:31 +0000"  >&lt;p&gt;The class org.apache.derbyTesting.system.oe.direct.Standard has some examples:&lt;/p&gt;

&lt;p&gt;scheduleDelivery - resetting isolation level&lt;br/&gt;
payment - executing a rollback in the catch block and rethrowing the exception&lt;/p&gt;
</comment>
                            <comment id="12573099" author="mkutty" created="Wed, 27 Feb 2008 23:25:30 +0000"  >&lt;p&gt;Thanks for the suggestions Dan. Please review the updated patch. &lt;/p&gt;</comment>
                            <comment id="12577234" author="mkutty" created="Mon, 10 Mar 2008 22:36:36 +0000"  >&lt;p&gt;Can any one please review this patch?&lt;/p&gt;</comment>
                            <comment id="12578034" author="kmarsden" created="Wed, 12 Mar 2008 21:54:34 +0000"  >&lt;p&gt;Hi Manjula,&lt;/p&gt;

&lt;p&gt;I took a quick look at your patch.  It looks ok to me except there seem to be some indentation issues spaces vs tabs, that you can see by looking at the diff in a text editor. I had one question. The rollback exceptions that are now being thrown, will they get logged somewhere or will we just rely on what&apos;s in the derby.log?&lt;/p&gt;


&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12578057" author="mkutty" created="Wed, 12 Mar 2008 22:49:40 +0000"  >&lt;p&gt;Thanks for looking in to the patch. Those Roll back exceptions will be in the derby.log and while running the test I would re-direct the output to a file to catch any error message printed on the console.&lt;/p&gt;</comment>
                            <comment id="12578439" author="myrna" created="Thu, 13 Mar 2008 18:40:15 +0000"  >&lt;p&gt;I committed patch &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3448&quot; title=&quot;Allow the MailJdbc system test to run under junit.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3448&quot;&gt;DERBY-3448&lt;/a&gt;_diff_02_27.txt with revision 636829, after first addressing the space/tab issues.&lt;/p&gt;</comment>
                            <comment id="12578491" author="myrna" created="Thu, 13 Mar 2008 21:05:56 +0000"  >&lt;p&gt;The DbTasks after revision 636829 causes a build problem because the calling methods don&apos;t handle the SQLExceptions.&lt;br/&gt;
I backed out the change with revision 636892.&lt;/p&gt;

&lt;p&gt;The build failure was: &lt;br/&gt;
mailjdbc:&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Compiling 10 source files to Apache/TinderBox_Derby/trunk/classes&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Apache/TinderBox_Derby/trunk/java/testing/org/apache/derbyTesting/system/mailjdbc/tasks/Backup.java:78: unreported exception java.lang.Exception; must be caught or declared to be thrown&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;             dbtasks.compressTable(conn, &quot;INBOX&quot;, this.getName());&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                      ^&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Apache/TinderBox_Derby/trunk/java/testing/org/apache/derbyTesting/system/mailjdbc/tasks/Backup.java:79: unreported exception java.lang.Exception; must be caught or declared to be thrown&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;             dbtasks.compressTable(conn, &quot;ATTACH&quot;, this.getName());&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                                      ^&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; Apache/TinderBox_Derby/trunk/java/testing/org/apache/derbyTesting/system/mailjdbc/tasks/Backup.java:83: unreported exception java.lang.Exception; must be caught or declared to be thrown&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;             dbtasks.Backup(conn, this.getName());&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt;                               ^&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;javac&amp;#93;&lt;/span&gt; 3 errors&lt;/p&gt;

&lt;p&gt;BUILD FAILED&lt;br/&gt;
Apache/TinderBox_Derby/trunk/build.xml:452: The following error occurred while executing this line:&lt;br/&gt;
Apache/TinderBox_Derby/trunk/java/testing/build.xml:87: The following error occurred while executing this line:&lt;br/&gt;
Apache/TinderBox_Derby/trunk/java/testing/org/apache/derbyTesting/system/mailjdbc/build.xml:70: Compile failed; see the compiler error output for details.&lt;/p&gt;

&lt;p&gt;I didn&apos;t do a clean build, and apparently neither did Manjula. &lt;/p&gt;</comment>
                            <comment id="12578526" author="mkutty" created="Thu, 13 Mar 2008 22:59:56 +0000"  >&lt;p&gt;Sorry for the build trouble. Please find the updated patch that resolves the build problem. It build fine on my machine.&lt;/p&gt;</comment>
                            <comment id="12578539" author="myrna" created="Thu, 13 Mar 2008 23:57:35 +0000"  >&lt;p&gt;Did you kick off the tests with your latest changes? You didn&apos;t say...&lt;/p&gt;</comment>
                            <comment id="12578845" author="mkutty" created="Fri, 14 Mar 2008 16:43:16 +0000"  >&lt;p&gt;Yes I did. And the test is still running without any problem&lt;/p&gt;</comment>
                            <comment id="12579626" author="myrna" created="Mon, 17 Mar 2008 21:51:07 +0000"  >&lt;p&gt;committed the latest patch with revision 638077.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12362379">DERBY-2314</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12376559" name="DERBY-3448_diff.txt_02_26_ver2.txt" size="7841" author="mkutty" created="Tue, 26 Feb 2008 22:26:40 +0000"/>
                            <attachment id="12376544" name="DERBY-3448_diff_02_26.txt" size="12864" author="mkutty" created="Tue, 26 Feb 2008 20:51:34 +0000"/>
                            <attachment id="12376678" name="DERBY-3448_diff_02_27.txt" size="13816" author="mkutty" created="Wed, 27 Feb 2008 23:25:30 +0000"/>
                            <attachment id="12376543" name="DERBY-3448_stat_02_26.txt" size="80" author="mkutty" created="Tue, 26 Feb 2008 20:51:33 +0000"/>
                            <attachment id="12377844" name="DERBY_3448_diff_03_13.txt" size="5395" author="mkutty" created="Thu, 13 Mar 2008 22:59:56 +0000"/>
                            <attachment id="12377843" name="DERBY_3448_stat_03_13.txt" size="396" author="mkutty" created="Thu, 13 Mar 2008 22:59:56 +0000"/>
                            <attachment id="12376264" name="derby_3448_dbtasks_cleanup.txt" size="6120" author="djd" created="Fri, 22 Feb 2008 20:35:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 26 Feb 2008 20:51:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30858</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0x3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39181</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10053"><![CDATA[Low]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>