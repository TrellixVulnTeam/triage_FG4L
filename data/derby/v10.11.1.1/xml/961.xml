<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:38:34 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-961/DERBY-961.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-961] Error 22001 can include &apos;XX-RESOLVE-XX&apos; which should be removed</title>
                <link>https://issues.apache.org/jira/browse/DERBY-961</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;In some cases, error 22001 can come up as follows: &lt;br/&gt;
A truncation error was encountered trying to shrink CHAR () FOR BIT DATA &apos;XX-RESOLVE-XX&apos; to length 40.&lt;/p&gt;

&lt;p&gt;This message makes it appear as if there is a column called XX-RESOLVE-XX, however, this string is coming out of SQLBinary.java.&lt;/p&gt;

&lt;p&gt;It should be removed from the message.&lt;/p&gt;

&lt;p&gt;Other references for this string are in the masters for updatableResultSet.out, and in the test lang/concateTests.java (referring to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-124&quot; title=&quot;Result type for CONCAT operator with blobs appears to be incorrect.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-124&quot;&gt;&lt;del&gt;DERBY-124&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
So, running updatableResultSet will generate the message.&lt;/p&gt;

&lt;p&gt;The stack trace I saw:&lt;br/&gt;
 at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:362)&lt;br/&gt;
 at org.apache.derby.iapi.types.SQLBinary.checkHostVariable(SQLBinary.java:977)&lt;br/&gt;
 at org.apache.derby.exe.ac05550069x0109x5d95xbdfcxffff9c80fb80163.e0 (Unknown Source)&lt;br/&gt;
 at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:138)&lt;br/&gt;
 at org.apache.derby.impl.sql.execute.RowResultSet.getNextRowCore(RowResultSet.java:155)&lt;br/&gt;
 at org.apache.derby.impl.sql.execute.NormalizeResultSet.getNextRowCore (NormalizeResultSet.java:204)&lt;br/&gt;
 at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:123)&lt;br/&gt;
 at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:521)&lt;br/&gt;
 at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:359)&lt;br/&gt;
 at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1142)&lt;br/&gt;
 at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1421)&lt;br/&gt;
 at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:263)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12328891">DERBY-961</key>
            <summary>Error 22001 can include &apos;XX-RESOLVE-XX&apos; which should be removed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Feb 2006 18:37:07 +0000</created>
                <updated>Mon, 4 May 2009 19:22:33 +0100</updated>
                            <resolved>Fri, 5 Sep 2008 00:10:13 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12614861" author="bryanpendleton" created="Fri, 18 Jul 2008 21:25:10 +0100"  >&lt;p&gt;I took a look at the message in question, and it appears&lt;br/&gt;
that the intent of the XX-RESOLVE-XX message parameter&lt;br/&gt;
is to hold the actual value which could not be shrunk to fit&lt;br/&gt;
in the column.&lt;/p&gt;

&lt;p&gt;I imagine that the reason for the XX-RESOLVE-XX is&lt;br/&gt;
because for a SQLBinary data type, the actual value may&lt;br/&gt;
not be human-readable, and so cannot be displayed.&lt;/p&gt;

&lt;p&gt;So I created the attached experimental diff (tweakMsg.diff),&lt;br/&gt;
which changes the XX-RESOLVE-XX parameter to the&lt;br/&gt;
message to &quot;(Binary data value not displayed)&quot;, which&lt;br/&gt;
I hope would give a better hint to the person who received&lt;br/&gt;
this error message about what was going on.&lt;/p&gt;

&lt;p&gt;I ran the entire regression suite with the modified test, and got&lt;br/&gt;
no failures, and I also grepped the source tree for XX-RESOLVE-XX&lt;br/&gt;
and got no hits.&lt;/p&gt;

&lt;p&gt;However, I&apos;m not totally sure how to make this problem occur,&lt;br/&gt;
in order to verify that the new message in fact looks better&lt;br/&gt;
than the old one.&lt;/p&gt;

&lt;p&gt;In order to make this a complete fix worthy of submitting, I&lt;br/&gt;
think I&apos;ll need to find a test case which provokes this error,&lt;br/&gt;
and verify that the error message looks better.&lt;/p&gt;

&lt;p&gt;But in the meantime, if anybody has any comments on this&lt;br/&gt;
approach, I&apos;d be most grateful.&lt;/p&gt;</comment>
                            <comment id="12614868" author="kmarsden" created="Fri, 18 Jul 2008 21:51:32 +0100"  >&lt;p&gt;In The test memory.BlobMemTest you can change the table to be too small and get this message.&lt;br/&gt;
Change line 77 to be &lt;br/&gt;
s.executeUpdate(&quot;CREATE TABLE BLOBTAB (K INT CONSTRAINT PK PRIMARY KEY, B BLOB(&quot; + 17000000 + &quot;))&quot;);&lt;br/&gt;
and you will get failures like:&lt;/p&gt;

&lt;p&gt;3) testBlobLength(org.apache.derbyTesting.functionTests.tests.memory.BlobMemTest)java.sql.SQLException: A truncation err&lt;br/&gt;
or was encountered trying to shrink BLOB &apos;XX-RESOLVE-XX&apos; to length 17000000.&lt;/p&gt;</comment>
                            <comment id="12614936" author="bryanpendleton" created="Sat, 19 Jul 2008 02:56:56 +0100"  >&lt;p&gt;Thanks Kathey! That test indeed provokes the error, just as you predicted.&lt;/p&gt;

&lt;p&gt;I verified that the error message was displayed as I expected it to be,&lt;br/&gt;
then modified the patch proposal to include a tweak to BlobMemTest&lt;br/&gt;
to provoke the truncation error intentionally and verify that the 22001&lt;br/&gt;
SQLState was returned.&lt;/p&gt;

&lt;p&gt;Attached is the modified patch proposal.&lt;/p&gt;

&lt;p&gt;Please let me know of any comments.&lt;/p&gt;</comment>
                            <comment id="12615644" author="bryanpendleton" created="Tue, 22 Jul 2008 16:18:50 +0100"  >&lt;p&gt;Committed msgChangeWithTest.diff to the trunk as revision 678769&lt;/p&gt;

&lt;p&gt;I don&apos;t intend to merge this to any of the prior branches at this time, so&lt;br/&gt;
I&apos;m marking the issue resolved.&lt;/p&gt;</comment>
                            <comment id="12616838" author="knutanders" created="Fri, 25 Jul 2008 11:31:56 +0100"  >&lt;p&gt;The new message is not internationalized and will be printed in English in all locales. Should we do something to make it possible to translate the message (for instance, creating a message id and adding it to messages.xml)?&lt;/p&gt;</comment>
                            <comment id="12617178" author="myrna" created="Sat, 26 Jul 2008 15:08:18 +0100"  >&lt;p&gt;I was a little hasty closing this - didn&apos;t notice the last comment.&lt;br/&gt;
It seems a lot of work for a minor issue, but I agree, to cross all t&apos;s we should have a translated (at least, translatable) message...&lt;/p&gt;</comment>
                            <comment id="12617185" author="bryanpendleton" created="Sat, 26 Jul 2008 15:47:18 +0100"  >&lt;p&gt;I agree with the observation that the English text for the message&lt;br/&gt;
parameter should not be hard-coded, but should be fetched from&lt;br/&gt;
a message file.&lt;/p&gt;

&lt;p&gt;I&apos;ll have a look at this and see what I can do.&lt;/p&gt;</comment>
                            <comment id="12617223" author="bryanpendleton" created="Sun, 27 Jul 2008 00:19:51 +0100"  >&lt;p&gt;Attached is a patch proposal to internationalize the message&lt;br/&gt;
parameter which indicates that the binary data has been hidden.&lt;/p&gt;

&lt;p&gt;I&apos;m a bit unfamiliar with the I18N message support so please&lt;br/&gt;
have a look and let me know if I&apos;m misunderstanding the message&lt;br/&gt;
infrastructure.&lt;/p&gt;

&lt;p&gt;The intent of the patch is to provide the same error message, but&lt;br/&gt;
with the string extracted from a message file so that it can be&lt;br/&gt;
translated if desired.&lt;/p&gt;

&lt;p&gt;I verified the patch by tweaking BlobMemTest to print out the&lt;br/&gt;
22001 exception that it receives in the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-961&quot; title=&quot;Error 22001 can include &amp;#39;XX-RESOLVE-XX&amp;#39; which should be removed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-961&quot;&gt;&lt;del&gt;DERBY-961&lt;/del&gt;&lt;/a&gt; test, and I&lt;br/&gt;
visually inspected the message and it looked OK to me.&lt;/p&gt;</comment>
                            <comment id="12617336" author="knutanders" created="Sun, 27 Jul 2008 22:23:15 +0100"  >&lt;p&gt;Thanks Bryan. The patch looks fine to me. Since the message is only used as part of another message and is not a full error message in itself, it would perhaps be better to give it an identifier that doesn&apos;t look like an SQL state and move the constant from SQLState.java to MessageId.java. Then the message should also be moved to another section of messages.xml. Look for the section with this heading in messages.xml:&lt;/p&gt;

&lt;p&gt;&amp;lt;!-- &lt;br/&gt;
This section contains all of the internationalized messages which are&lt;br/&gt;
undocumented. This includes messages with handles which are&lt;br/&gt;
pseudo-SQLStates, documented in SQLState.java. This also includes&lt;br/&gt;
messages with non-SQLState handles which are documented in&lt;br/&gt;
MessageId.java.&lt;br/&gt;
--&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;section&amp;gt;&lt;br/&gt;
        &amp;lt;desc&amp;gt;Undocumented messages with pseudo-SQLStates or no SQLStates&amp;lt;/desc&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12617931" author="bryanpendleton" created="Tue, 29 Jul 2008 21:16:17 +0100"  >&lt;p&gt;Thanks Knut, that makes sense. I&apos;ll have a look at this, but probably&lt;br/&gt;
won&apos;t get around to it right away because I&apos;m going to be out on holiday.&lt;/p&gt;</comment>
                            <comment id="12627763" author="bryanpendleton" created="Tue, 2 Sep 2008 18:49:52 +0100"  >&lt;p&gt;Attached patch &apos;nonSQLStateMessage.diff&apos; moves the&lt;br/&gt;
new internal translatable string to MessageId.java as&lt;br/&gt;
Knut suggested. I re-ran the BlobMemTest and confirmed&lt;br/&gt;
that the resulting message looks correct.&lt;/p&gt;

&lt;p&gt;Please let me know of any additional feedback on this proposal.&lt;/p&gt;</comment>
                            <comment id="12627998" author="knutanders" created="Wed, 3 Sep 2008 14:47:02 +0100"  >&lt;p&gt;The patch looks good to me. +1&lt;/p&gt;</comment>
                            <comment id="12628512" author="bryanpendleton" created="Fri, 5 Sep 2008 00:10:13 +0100"  >&lt;p&gt;Committed nonSQLStateMessage.diff to the trunk as revision 692298.&lt;/p&gt;</comment>
                            <comment id="12654389" author="kristwaa" created="Mon, 8 Dec 2008 12:06:09 +0000"  >&lt;p&gt;The only reference to &quot;XX-RESOLVE-XX&quot; I can find now, is in a comment in the test tests/lang/concateTests.java.&lt;br/&gt;
Can the issue be closed, or should the comment be refreshed (last change from 2005)?&lt;/p&gt;</comment>
                            <comment id="12654428" author="bryanpendleton" created="Mon, 8 Dec 2008 14:39:31 +0000"  >&lt;p&gt;Hi Kristian, thanks for spotting this! &lt;/p&gt;

&lt;p&gt;I&apos;ll adjust the comment, and then close this issue once that&apos;s done.&lt;/p&gt;
</comment>
                            <comment id="12654656" author="bryanpendleton" created="Tue, 9 Dec 2008 00:09:07 +0000"  >&lt;p&gt;Updated the stale comment with revision 724560, and marked issue closed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12386964" name="i18nHiddenString.txt" size="2486" author="bryanpendleton" created="Sun, 27 Jul 2008 00:19:51 +0100"/>
                            <attachment id="12386454" name="msgChangeWithTest.diff" size="4119" author="bryanpendleton" created="Sat, 19 Jul 2008 02:56:56 +0100"/>
                            <attachment id="12389360" name="nonSQLStateMessage.diff" size="2561" author="bryanpendleton" created="Tue, 2 Sep 2008 18:49:52 +0100"/>
                            <attachment id="12386433" name="tweakMsg.diff" size="577" author="bryanpendleton" created="Fri, 18 Jul 2008 21:25:10 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Jul 2008 20:25:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22221</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0xjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39254</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>