<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:18:43 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-522/DERBY-522.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-522] ERROR X0Y79 raised when adding comments using &quot;--&quot; before sql queries with Network Client</title>
                <link>https://issues.apache.org/jira/browse/DERBY-522</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Comments before a  select statement Throws exception with Network Client&lt;br/&gt;
For Example a statement like the one below in the attached program with throw an exception.&lt;/p&gt;

&lt;p&gt;stmt.execute(&quot;-- This is a comment \n Select c11 from TAB1&quot;);&lt;/p&gt;



&lt;p&gt;org.apache.derby.client.am.SqlException: Statement.executeUpdate() cannot be called with a statement that returns a ResultSet.&lt;br/&gt;
        at org.apache.derby.client.am.Statement.completeSqlca(Statement.java:1354)&lt;br/&gt;
        at org.apache.derby.client.am.Statement.completeExecuteImmediate(Statement.java:964)&lt;br/&gt;
        at org.apache.derby.client.net.NetStatementReply.parseEXCSQLIMMreply(NetStatementReply.java:199)&lt;br/&gt;
        at org.apache.derby.client.net.NetStatementReply.readExecuteImmediate(NetStatementReply.java:50)&lt;br/&gt;
        at org.apache.derby.client.net.StatementReply.readExecuteImmediate(StatementReply.java:44)&lt;br/&gt;
        at org.apache.derby.client.net.NetStatement.readExecuteImmediate_(NetStatement.java:123)&lt;br/&gt;
        at org.apache.derby.client.am.Statement.readExecuteImmediate(Statement.java:960)&lt;br/&gt;
        at org.apache.derby.client.am.Statement.flowExecute(Statement.java:1587)&lt;br/&gt;
        at org.apache.derby.client.am.Statement.executeX(Statement.java:631)&lt;br/&gt;
        at org.apache.derby.client.am.Statement.execute(Statement.java:622)&lt;br/&gt;
        at CommentBeforeSelect.createAndPopulateTable(CommentBeforeSelect.java:70)&lt;br/&gt;
        at CommentBeforeSelect.main(CommentBeforeSelect.java:35)&lt;br/&gt;
$&lt;br/&gt;
To reproduce run the attached program &lt;br/&gt;
java CommentBeforeSelect&lt;/p&gt;</description>
                <environment></environment>
        <key id="12313585">DERBY-522</key>
            <summary>ERROR X0Y79 raised when adding comments using &quot;--&quot; before sql queries with Network Client</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="army">A B</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Aug 2005 08:19:17 +0100</created>
                <updated>Thu, 26 Jan 2006 01:58:35 +0000</updated>
                            <resolved>Thu, 20 Oct 2005 04:56:09 +0100</resolved>
                                    <version>10.1.1.0</version>
                    <version>10.1.2.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.2.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12319436" author="kmarsden" created="Sat, 20 Aug 2005 08:27:29 +0100"  >&lt;p&gt;The problem comes I think because the client looks at the SQL statement and sends it as  EXCSQLIMM ,  because it does not  start with SELECT, VALUES, etc.&lt;br/&gt;
EXCSQLIMM cannot be used for a statement that returns result sets.&lt;/p&gt;

&lt;p&gt;Client needs to treat the statement as a select and handle it properly.&lt;/p&gt;

&lt;p&gt;Note:&lt;br/&gt;
Currently IJ currently has code to strip out the comments for Network Client so the issue will not reproduce with IJ.&lt;/p&gt;

</comment>
                            <comment id="12331444" author="army" created="Thu, 6 Oct 2005 09:33:32 +0100"  >&lt;p&gt;Changing fixin to be 10.1.2.0 and 10.2.0.0 since I have a fix ready and will be posting it once I have written corresponding tests.  The fix should be ready for the 10.1.2 bug fix release, and of course it should go into the trunk, as well, hence my choice of fixin values.&lt;/p&gt;</comment>
                            <comment id="12331609" author="army" created="Sat, 8 Oct 2005 02:25:04 +0100"  >&lt;p&gt;Attaching a patch for this issue.  The patch does the following:&lt;/p&gt;

&lt;p&gt;1) Updates client to look for statements that begin with comments and to ignore the comments when deciding the kind of statement that is being executed.&lt;br/&gt;
2) Adds test cases for statements that begin with comments to the jdbcapi/nullSQLText.java test&lt;br/&gt;
3) Creates two new masters for nullSQLText: one for DerbyNet, one for DerbyNetClient, to reflect the additional test cases.&lt;br/&gt;
4) Updates lang/syscat.sql master for DerbyNetClient to match the new behavior.&lt;/p&gt;

&lt;p&gt;I couldn&apos;t find an existing test that really matched the condition, so I chose &quot;nullSQLText&quot; since it involves testing edge cases for statements that are passed to Derby via the JDBC &quot;execute&quot; call, which is similar to what the new tests do.  If, however, anyone thinks I should create a new test for this particular issue (for the sake of clarity), I can certainly go ahead and do so.&lt;/p&gt;

&lt;p&gt;I ran derbyall with Sun JDK 1.4 on Windows 2000 and saw no failures.&lt;/p&gt;

&lt;p&gt;Many thanks to Kathey for the helpful comment regarding where the problem was--she was absolutely right.&lt;/p&gt;</comment>
                            <comment id="12331731" author="kmarsden" created="Tue, 11 Oct 2005 03:46:49 +0100"  >&lt;p&gt;I know there is code in ij that strips of the comments for client. It would be great if  it could be changed to not strip off the comments for a 10.2 client.  Then you will see that there are actually lots of test cases checked in in many of the sql files.  I think ij should remain the same and strip off the comments for 10.1 clients even when this is ported to 10.1, so as not to cause trouble with old clients.    &lt;/p&gt;

&lt;p&gt;I wonder about comments before Stored procedures that return result sets.  Do those work ok?&lt;/p&gt;



</comment>
                            <comment id="12332017" author="army" created="Fri, 14 Oct 2005 02:19:12 +0100"  >&lt;p&gt;Attaching an second version of the patch that has the following changes (w.r.t the first version):&lt;/p&gt;

&lt;p&gt;1) Logic in client/am/Statement.java has been re-written to account for some edge cases that weren&apos;t covered in the initial patch.&lt;/p&gt;

&lt;p&gt;2) Per Kathey Marsden&apos;s suggestion, the ij code has been changed so that it no longer strips leading comments when passing statements to the Derby Client.  NOTE: to be safe, this particular part of the patch probably should &lt;em&gt;not&lt;/em&gt; be ported to 10.1.&lt;/p&gt;

&lt;p&gt;3) In working with this patch, I noticed that statements which &lt;em&gt;end&lt;/em&gt; in comments do not work when passed through JDBC--rather, the result will be a syntax error in all modes (embedded, Derby Client, and JCC); see below for more on that issue.  The new version of the patch fixes that problem in addition to the other documented problems in this Jira issue.&lt;/p&gt;

&lt;p&gt;4) Updated additional master files to reflect the new changes.&lt;/p&gt;

&lt;p&gt;------&lt;br/&gt;
NOTES:&lt;br/&gt;
------&lt;/p&gt;

&lt;p&gt;Regarding #3 above: it turns out that if one tries to execute a SQL statement that &lt;em&gt;ends&lt;/em&gt; with a comment via JDBC, the result will be a syntax error.  This occurs in embedded mode as well as client/server mode.  Ex:&lt;/p&gt;

&lt;p&gt;    ResultSet rs = st.execute(&quot;values 2, 3, 4\n-- trailing comment&quot;);&lt;/p&gt;

&lt;p&gt;will result in the following error:&lt;/p&gt;

&lt;p&gt; ERROR 42X01: Syntax error: Encountered &quot;-&quot; at line 2, column 1.&lt;/p&gt;

&lt;p&gt;Note, though, that if you add an end-of-line character to the exact same statement, it will work:&lt;/p&gt;

&lt;p&gt;    ResultSet rs = st.execute(&quot;values 2, 3, 4\n-- trailing comment\n&quot;);&lt;/p&gt;

&lt;p&gt;The reason is because the grammar in sqlgrammar.jj defines a comment as always ending with either &quot;\n&quot;, &quot;\r&quot;, or &quot;\r\n&quot;.  Thus, in the first example above, since the comment doesn&apos;t end with any of these three characters, the result is a syntax error.&lt;/p&gt;

&lt;p&gt;To fix this, I just made the final &quot;\n&quot;, &quot;\r&quot;, or &quot;\r\n&quot; optional--then in situations where the comment is the last part of the statement and there&apos;s no trailing newline, it will still be recognized as a comment and processed accordingly (i.e. ignored).&lt;/p&gt;

&lt;p&gt;I ran derbyall after making this simple change and there were no failures, so I &lt;em&gt;think&lt;/em&gt; it&apos;s safe.  However, I&apos;m hoping to get a second opinion on this, just to be safe.&lt;/p&gt;

&lt;p&gt;Note that this change WILL have one side effect: in the edge case where a user tries to execute a statement that consists of ALL  comments, the error message will now be:&lt;/p&gt;

&lt;p&gt; ERROR 42X01: Syntax error: Encountered &quot;&amp;lt;EOF&amp;gt;&quot; at line 1, column 3.&lt;/p&gt;

&lt;p&gt;instead of:&lt;/p&gt;

&lt;p&gt; ERROR 42X01: Syntax error: Encountered &quot;-&quot; at line 1, column 3.&lt;/p&gt;

&lt;p&gt;To me, this seems like an acceptable change in behavior since the new behavior matches what currently happens if the user passes in an empty string--and, if the entire statement is just comments, that is in effect the what we&apos;re doing.  However, if anyone thinks this is unacceptable, please let me know and I&apos;ll just file a separate JIRA entry for that issue, to be addressed later.&lt;/p&gt;

&lt;p&gt;Finally, regarding Kathey&apos;s question of whether or not this fix will work if a comment precedes a stored procedure call that returns result sets, the answer is &quot;Yes.&quot;  I ran something like:&lt;/p&gt;

&lt;p&gt;  ResultSet rs = st.executeQuery(&quot;-- leading comment\ncall proc1()&quot;);&lt;/p&gt;

&lt;p&gt;and was able to process the results successfully.  Did you have a particular concern with this Kathey?  I added this test case to the set of cases for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-522&quot; title=&quot;ERROR X0Y79 raised when adding comments using &amp;quot;--&amp;quot; before sql queries with Network Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-522&quot;&gt;&lt;del&gt;DERBY-522&lt;/del&gt;&lt;/a&gt; in jdbcapi/nullSQLText.java, just to be certain.&lt;/p&gt;

&lt;p&gt;I ran derbyall on Windows 2000 with Sun JDK 1.4.2 with this patch and saw no failures.&lt;/p&gt;

&lt;p&gt;Many thanks to anyone who has additional comments/feedback on this patch.&lt;/p&gt;</comment>
                            <comment id="12332094" author="kmarsden" created="Sat, 15 Oct 2005 03:57:29 +0100"  >&lt;p&gt;I reviewed this patch and my only comment is that I think that the ij change should strip comments for JCC or for     Derby client drivers  whose version is less than 10.2.  That way the behaviour is dependent upon which client the ij tool is working with and a 10.2 ij will continue to work with 10.1 client.&lt;/p&gt;
</comment>
                            <comment id="12332095" author="army" created="Sat, 15 Oct 2005 04:18:17 +0100"  >&lt;p&gt;Thanks for the review, Kathey.  I misunderstood what you meant when you initially talked about not trimming for the 10.1 or earlier clients, hence my last patch didn&apos;t deal with that (sorry).  I&apos;ll work on another version of the patch and will post it soon.  Thanks again!&lt;/p&gt;</comment>
                            <comment id="12332151" author="army" created="Sun, 16 Oct 2005 00:58:11 +0100"  >&lt;p&gt;Updated patch so that ij will continue to remove comments from a statement against the Derby Client driver &lt;em&gt;if&lt;/em&gt; the client version is earlier than 10.2.  This makes it so that a 10.2 ij will still work a 10.1 Derby Client.  Thanks for catching this, Kathey.&lt;/p&gt;</comment>
                            <comment id="12332304" author="kmarsden" created="Tue, 18 Oct 2005 08:52:30 +0100"  >&lt;p&gt;Committed this to the trunk:  Please submit the merge command for merge to 10.1 when ready.&lt;/p&gt;

&lt;p&gt;Date: Mon Oct 17 15:41:03 2005&lt;br/&gt;
New Revision: 325993&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewcvs?rev=325993&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=325993&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-522&quot; title=&quot;ERROR X0Y79 raised when adding comments using &amp;quot;--&amp;quot; before sql queries with Network Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-522&quot;&gt;&lt;del&gt;DERBY-522&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1) Updates client to look for statements that begin with comments and to ignore the comments when deciding the kind of statement that is being executed.&lt;br/&gt;
2) Changes ij to only strip comments for client versions less than 10.2&lt;br/&gt;
3) Adds test cases for statements that begin with comments to the jdbcapi/nullSQLText.java test&lt;br/&gt;
4) Updates masters&lt;/p&gt;</comment>
                            <comment id="12332388" author="army" created="Wed, 19 Oct 2005 04:29:49 +0100"  >&lt;p&gt;Command to merge to 10.1 is:&lt;br/&gt;
 svn merge -r 325992:325993 &lt;a href=&quot;https://svn.apache.org/repos/asf/db/derby/code/trunk&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/db/derby/code/trunk&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12332424" author="army" created="Wed, 19 Oct 2005 09:40:14 +0100"  >&lt;p&gt;Attaching a master update for the &lt;em&gt;10.1&lt;/em&gt; codeline that fixes a diff for lang/forUpdate.sql.&lt;/p&gt;

&lt;p&gt;The new logic in ij only strips comments if the client is 10.1 or earlier, and since the original patch was against 10.2, the master file that was submitted reflects the fact that the comments were NOT stripped.  For the 10.1 branch, the comments are still stripped, hence the diff.  The attached &quot;d10_1Master.patch&quot; file fixes that diff for 10.1.&lt;/p&gt;

&lt;p&gt;Could a committer please commit?&lt;/p&gt;</comment>
                            <comment id="12332499" author="army" created="Thu, 20 Oct 2005 04:56:09 +0100"  >&lt;p&gt;Patch for this has been committed:&lt;/p&gt;

&lt;p&gt;svn 325993  &amp;#8211; 10.2&lt;br/&gt;
svn 326222, 326308 &amp;#8211; 10.1&lt;/p&gt;

&lt;p&gt;I&apos;ve verified the repro and the new test cases in both the 10.2 and 10.1 branches and all looks to be correct.  So I&apos;m marking this as  resolved.&lt;/p&gt;

&lt;p&gt;Kathey, I&apos;ll leave it to you to close this issue if everything looks okay.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12311857" name="CommentBeforeSelect.java" size="4759" author="kmarsden" created="Sat, 20 Aug 2005 08:28:07 +0100"/>
                            <attachment id="12314946" name="d10_1Master.patch" size="1329" author="army" created="Wed, 19 Oct 2005 09:40:14 +0100"/>
                            <attachment id="12314901" name="d522_v3.patch" size="21911" author="army" created="Sun, 16 Oct 2005 00:58:11 +0100"/>
                            <attachment id="12314902" name="d522_v3.stat" size="733" author="army" created="Sun, 16 Oct 2005 00:58:11 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 6 Oct 2005 08:33:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21996</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy17an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40832</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>