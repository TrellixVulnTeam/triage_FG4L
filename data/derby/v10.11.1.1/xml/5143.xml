<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:41:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5143/DERBY-5143.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5143] Remove unnecessary copying of the map in getTypeMap()</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5143</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The JDBC 4.0 Connection classes implement getTypeMap() by calling super.getTypeMap() and copying the resulting map. This is done to prevent an unchecked compiler warning that we would see if we simply returned super.getTypeMap() in this method. It would be cheaper and simpler to return super.getTypeMap() and ignore the warning.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12501912">DERBY-5143</key>
            <summary>Remove unnecessary copying of the map in getTypeMap()</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Mar 2011 00:34:32 +0000</created>
                <updated>Thu, 30 Jun 2011 10:21:43 +0100</updated>
                            <resolved>Mon, 21 Mar 2011 19:41:11 +0000</resolved>
                                    <version>10.8.1.2</version>
                                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13008991" author="knutanders" created="Mon, 21 Mar 2011 00:38:34 +0000"  >&lt;p&gt;One unintended side effect from the copying is that the returned map is mutable when using the JDBC 4.0 driver, whereas it&apos;s immutable with the JDBC 3.0 driver.&lt;/p&gt;</comment>
                            <comment id="13008996" author="knutanders" created="Mon, 21 Mar 2011 00:57:24 +0000"  >&lt;p&gt;The attached patch shows how to silence the compiler warning without copying the map.&lt;/p&gt;

&lt;p&gt;A side effect of this change is that the returned map in the JDBC 4.0 driver is exactly the same as the one that would have been returned by the JDBC 3.0 driver, and it is immutable. One of the JDBC 4.0 tests (ConnectionTest.testGetTypeMapReturnsAsExpected) calls put() on the returned map, and therefore starts failing with an UnsupportedOperationException now that the returned map isn&apos;t mutable. I think the test should be changed, and the map should stay immutable.&lt;/p&gt;</comment>
                            <comment id="13008998" author="dbrosius@apache.org" created="Mon, 21 Mar 2011 01:04:21 +0000"  >&lt;p&gt;It seems to me like the entire NetConnection40.getTypeMap method can be removed, as the parent class always just returns an empty Map. In fact, Connection.getTypeMap, could just return a static field Map defined as&lt;/p&gt;

&lt;p&gt;static final Map typeMap = Collections.unmodfiableSet(new HashSet());&lt;/p&gt;

&lt;p&gt;or perhaps even better, just return Collections.EMPTY_SET;&lt;/p&gt;</comment>
                            <comment id="13009099" author="knutanders" created="Mon, 21 Mar 2011 10:57:22 +0000"  >&lt;p&gt;I think the reason why we added the getTypeMap() method in the first place was that the compilation of NetConnection40 would generate the following warning:&lt;/p&gt;

&lt;p&gt;Compiling 1 source file to /code/derby/trunk0/classes&lt;br/&gt;
/code/derby/trunk0/java/client/org/apache/derby/client/net/NetConnection40.java:48: warning: getTypeMap() in org.apache.derby.client.am.Connection implements getTypeMap() in java.sql.Connection; return type requires unchecked conversion&lt;br/&gt;
found   : java.util.Map&lt;br/&gt;
required: java.util.Map&amp;lt;java.lang.String,java.lang.Class&amp;lt;?&amp;gt;&amp;gt;&lt;br/&gt;
public class  NetConnection40 extends org.apache.derby.client.net.NetConnection {&lt;br/&gt;
1 warning&lt;/p&gt;

&lt;p&gt;And suppressing unchecked warnings for the entire class wasn&apos;t considered a good alternative. There may be other ways to silence this specific warning only, but I&apos;m not aware of any.&lt;/p&gt;

&lt;p&gt;You&apos;re of course right that Connection.getTypeMap() should return Collections.EMPTY_MAP. I thought it already did, but that&apos;s only on the embedded driver. Will fix that too.&lt;/p&gt;</comment>
                            <comment id="13009108" author="knutanders" created="Mon, 21 Mar 2011 12:10:10 +0000"  >&lt;p&gt;Attaching a new patch (derby-5143-1a.diff) with the following changes from the initial patch:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;simplified the getTypeMap() overrides a little more&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;made the client implementation return EMPTY_MAP (immutable) instead of an empty HashMap (mutable), to match the embedded implementation&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;updated ConnectionTest to expect the returned map to be immutable&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13009286" author="lilywei" created="Mon, 21 Mar 2011 18:50:27 +0000"  >&lt;p&gt;Thank you so much, Knut. I run derby-5143-1a.diff patch for ConnectionTest test against JDBC 3.0 and JDBC 4.1. +1 for the patch.&lt;/p&gt;</comment>
                            <comment id="13009329" author="knutanders" created="Mon, 21 Mar 2011 19:41:11 +0000"  >&lt;p&gt;Thank you, Lily, for testing the patch. I also ran suites.All and derbyall with Java 6 without any failures.&lt;/p&gt;

&lt;p&gt;Committed revision 1083917.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12474173" name="derby-5143-1a.diff" size="6169" author="knutanders" created="Mon, 21 Mar 2011 12:10:10 +0000"/>
                            <attachment id="12474140" name="getTypeMap-warning.diff" size="4306" author="knutanders" created="Mon, 21 Mar 2011 00:57:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 21 Mar 2011 01:04:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31522</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ftz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36383</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>