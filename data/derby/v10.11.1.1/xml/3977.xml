<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:36:33 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3977/DERBY-3977.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3977] Clob.truncate with a value greater than the Clob length raises different exceptions in embedded and client driver</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3977</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Calling Clob.truncate with a value that is greater then the Clob length raises different SQLExceptions in the client and the embedded driver.&lt;br/&gt;
 o Client: SQLState.BLOB_LENGTH_TOO_LONG - XJ079&lt;br/&gt;
 o Embedded: SQLState.BLOB_POSITION_TOO_LARGE - XJ076&lt;/p&gt;

&lt;p&gt;I believe the fix is simple enough  - change one of the exceptions.&lt;br/&gt;
Which one most closely describes the situation?&lt;/p&gt;

&lt;p&gt;A release note is needed for this fix.&lt;/p&gt;

&lt;p&gt;Also note the following from the Java API docs:&lt;br/&gt;
&quot;void truncate(long len)&lt;br/&gt;
              throws SQLException&lt;/p&gt;

&lt;p&gt;    Truncates the CLOB value that this Clob designates to have a length of len characters.&lt;/p&gt;

&lt;p&gt;    Note: If the value specified for pos is greater then the length+1 of the CLOB value then the behavior is undefined. Some JDBC drivers may throw a SQLException while other drivers may support this operation.&lt;br/&gt;
&quot;&lt;/p&gt;

&lt;p&gt;This opens for a change of behavior as well.&lt;br/&gt;
There seems to an inconsistency in the docs, possibly due to rephrasing - it references both len and pos. The latter isn&apos;t used anywhere else in the JavaDoc for truncate.&lt;br/&gt;
And what should the result of truncate(length+1) be?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12410189">DERBY-3977</key>
            <summary>Clob.truncate with a value greater than the Clob length raises different exceptions in embedded and client driver</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Dec 2008 13:12:10 +0000</created>
                <updated>Mon, 4 May 2009 19:22:45 +0100</updated>
                            <resolved>Mon, 5 Jan 2009 11:30:14 +0000</resolved>
                                    <version>10.3.3.0</version>
                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12654789" author="knutanders" created="Tue, 9 Dec 2008 12:55:15 +0000"  >&lt;p&gt;Since it&apos;s a length and not a position, I guess the exception thrown by the client is more accurate.&lt;/p&gt;

&lt;p&gt;If we throw exceptions for length+2 and up, I think it&apos;s reasonable to throw an exception for length+1 as well, even though the wording in the spec is a bit unclear. Do we have any other alternatives?&lt;/p&gt;</comment>
                            <comment id="12654808" author="kristwaa" created="Tue, 9 Dec 2008 14:32:22 +0000"  >&lt;p&gt;We don&apos;t have any good alternatives in my opinion, but I&apos;m curious about what the databases that do support truncating to length+1 do!&lt;/p&gt;

&lt;p&gt;I&apos;ll make a patch for the issue.&lt;/p&gt;</comment>
                            <comment id="12654827" author="knutanders" created="Tue, 9 Dec 2008 15:26:29 +0000"  >&lt;p&gt;PostgreSQL&apos;s JDBC driver doesn&apos;t appear to throw an exception for len&amp;gt;=length+1. In code called from Clob.truncate(), I found this comment:&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Truncates the large object to the given length in bytes.&lt;/li&gt;
	&lt;li&gt;If the number of bytes is larger than the current large&lt;/li&gt;
	&lt;li&gt;object length, the large object will be filled with zero&lt;/li&gt;
	&lt;li&gt;bytes.  This method does not modify the current file offset.&lt;br/&gt;
     */&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The comment talks about bytes, but the code is also used for character data, so I guess truncate(length+1) appends &quot;\u0000&quot;.&lt;/p&gt;

&lt;p&gt;MySQL Connector/J throws an exception, if I read the code correctly.&lt;/p&gt;</comment>
                            <comment id="12654845" author="kmarsden" created="Tue, 9 Dec 2008 16:50:39 +0000"  >&lt;p&gt;JCC 3.57 with DB2 throws an SQLException, SQLState 42815. Invalid length x&lt;/p&gt;</comment>
                            <comment id="12655227" author="kristwaa" created="Wed, 10 Dec 2008 14:32:31 +0000"  >&lt;p&gt;Patch 1a changes the exception thrown in the embedded driver from XJ076 to XJ079. It now matches the client driver.&lt;br/&gt;
I ran derbyall and suites.All, and got no failures due to the change of exception (except for the two new tests, which I have modified in the patch).&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12655587" author="kristwaa" created="Thu, 11 Dec 2008 09:50:55 +0000"  >&lt;p&gt;Attached a first revision of the release notes. Please give me feedback on it.&lt;/p&gt;

&lt;p&gt;I also discovered a typo in the error message for one of the exceptions.&lt;br/&gt;
Fixing that doesn&apos;t warrant another release note, does it?&lt;/p&gt;</comment>
                            <comment id="12656021" author="knutanders" created="Fri, 12 Dec 2008 14:28:45 +0000"  >&lt;p&gt;The release note looks good to me. Some minor comments:&lt;br/&gt;
Perhaps the example error messages should have a real number instead of &lt;/p&gt;
{0}
&lt;p&gt; in them? And maybe that section is clearer if we say &quot;Before: XJ076: ....&quot; and &quot;Now: XJ079: ....&quot;.&lt;br/&gt;
In the &quot;Application Changes Required&quot; section, we should repeat that it&apos;s only when calling Clob.truncate() one should look for XJ079 instead of XJ076, since we still use XJ076 other places. For example: &quot;Look for SQLState XJ079 instead of XJ076 when Clob.truncate() is called.&quot;&lt;/p&gt;</comment>
                            <comment id="12656625" author="kristwaa" created="Mon, 15 Dec 2008 13:40:11 +0000"  >&lt;p&gt;Thank you for the feedback, Knut Anders.&lt;/p&gt;

&lt;p&gt;Attaching new revision of the release notes where the suggested changes have  been addressed.&lt;/p&gt;</comment>
                            <comment id="12656626" author="kristwaa" created="Mon, 15 Dec 2008 13:43:16 +0000"  >&lt;p&gt;Patch 2a fixes the typo in the error message. The XML file and 4 translation files are touched.&lt;/p&gt;</comment>
                            <comment id="12656628" author="kristwaa" created="Mon, 15 Dec 2008 13:48:51 +0000"  >&lt;p&gt;Committed patch 1a to trunk with revision 726695.&lt;/p&gt;</comment>
                            <comment id="12656970" author="knutanders" created="Tue, 16 Dec 2008 12:02:40 +0000"  >&lt;p&gt;Thanks for the updated release note. It looks good to me.&lt;/p&gt;</comment>
                            <comment id="12660727" author="kristwaa" created="Mon, 5 Jan 2009 11:30:14 +0000"  >&lt;p&gt;Issue has been fixed.&lt;br/&gt;
Thanks for the feedback on the release notes, Knut Anders.&lt;/p&gt;</comment>
                            <comment id="12661942" author="kristwaa" created="Thu, 8 Jan 2009 11:32:22 +0000"  >&lt;p&gt;Release note attached and the issue has been fixed. Closing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12395738" name="derby-3977-1a-change_emb_exception.diff" size="1915" author="kristwaa" created="Wed, 10 Dec 2008 14:32:31 +0000"/>
                            <attachment id="12396095" name="derby-3977-2a-error_message_typo_fix.diff" size="4566" author="kristwaa" created="Mon, 15 Dec 2008 13:43:16 +0000"/>
                            <attachment id="12396096" name="derby-3977-2a-error_message_typo_fix.stat" size="146" author="kristwaa" created="Mon, 15 Dec 2008 13:43:16 +0000"/>
                            <attachment id="12396094" name="releaseNote.html" size="4376" author="kristwaa" created="Mon, 15 Dec 2008 13:40:11 +0000"/>
                            <attachment id="12395820" name="releaseNote.html" size="4315" author="kristwaa" created="Thu, 11 Dec 2008 09:50:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10363"><![CDATA[Embedded/Client difference]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 9 Dec 2008 12:55:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23954</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0xdz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39227</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>