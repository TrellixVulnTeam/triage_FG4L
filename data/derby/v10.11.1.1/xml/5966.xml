<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:33:59 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5966/DERBY-5966.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5966] NativeAuthenticationServiceTest.testAll() failure: [ FILE, NATIVE authentication on, LOCAL authentication ON, Authentication/Authorization turned OFF, SecurityManager ON, Embedded ]: Connection to fifthDB unexpectedly failed.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5966</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Saw these failures on multiple platforms around the time Europe switched from DST:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/sles/1402814-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/sles/1402814-suitesAll_diff.txt&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/sparc/1402814-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/sparc/1402814-suitesAll_diff.txt&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/vista/1402814-suitesAll_diff.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.5/testing/testlog/vista/1402814-suitesAll_diff.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;3) testAll(org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest)junit.framework.AssertionFailedError: [ FILE, NATIVE authentication on, LOCAL authentication ON, Authentication/Authorization turned OFF, SecurityManager ON, Embedded ]: Connection to fifthDB unexpectedly failed.&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest.getConnection(NativeAuthenticationServiceTest.java:1604)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest.getConnection(NativeAuthenticationServiceTest.java:1570)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest.getConnection(NativeAuthenticationServiceTest.java:1564)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest.vetPasswordLifetime(NativeAuthenticationServiceTest.java:1385)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest.testAll(NativeAuthenticationServiceTest.java:618)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12613881">DERBY-5966</key>
            <summary>NativeAuthenticationServiceTest.testAll() failure: [ FILE, NATIVE authentication on, LOCAL authentication ON, Authentication/Authorization turned OFF, SecurityManager ON, Embedded ]: Connection to fifthDB unexpectedly failed.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Oct 2012 12:26:33 +0000</created>
                <updated>Mon, 17 Jun 2013 10:27:17 +0100</updated>
                            <resolved>Fri, 2 Nov 2012 07:47:56 +0000</resolved>
                                    <version>10.10.1.1</version>
                                    <fixVersion>10.10.1.1</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13486048" author="rhillegas" created="Mon, 29 Oct 2012 14:31:32 +0000"  >&lt;p&gt;The error in question managed to print a complete stack trace for the problem to *suitesAll.diff.txt:&lt;/p&gt;

&lt;p&gt;(emb)lang.NativeAuthenticationServiceTest.testAll junit.framework.AssertionFailedError: [ FILE, NATIVE authentication on, LOCAL authentication ON, Authentication/Authorization turned OFF, SecurityManager ON, Embedded ]: Connection to fifthDB should have failed.&lt;br/&gt;
	at junit.framework.Assert.fail(Assert.java:47)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest.getConnection(NativeAuthenticationServiceTest.java:1583)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest.getConnection(NativeAuthenticationServiceTest.java:1570)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest.getConnection(NativeAuthenticationServiceTest.java:1564)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest.vetPasswordLifetime(NativeAuthenticationServiceTest.java:1385)&lt;br/&gt;
	at org.apache.derbyTesting.functionTests.tests.lang.NativeAuthenticationServiceTest.testAll(NativeAuthenticationServiceTest.java:618)&lt;/p&gt;

&lt;p&gt;This indicates that the test was expecting a connection failure by a user whose password had expired. But the connection succeeded. I can see this situation arising if clocks change during the test run. There may be a product issue here but I am not sure how serious it is. Inside Derby, a comparison is being made between the current time returned by System.currentTimeMillis() and the contents of a SQL TIMESTAMP stored in SYS.SYSUSERS.LASTMODIFIED. My suspicion would be that the on-disk and in-memory representations of TIMESTAMPs have some interesting convertibility behavior during the twilit hour of overlap when the time zone changes.&lt;/p&gt;</comment>
                            <comment id="13486854" author="knutanders" created="Tue, 30 Oct 2012 13:13:26 +0000"  >&lt;p&gt;That sounds right. I&apos;d guess it&apos;s similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5964&quot; title=&quot;Timestamp comparison failure in AutomaticIndexStatisticsTest.testStatisticsCorrectness&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5964&quot;&gt;&lt;del&gt;DERBY-5964&lt;/del&gt;&lt;/a&gt;, where a timestamp is stored in the local time zone in the database. Since Derby doesn&apos;t store the time zone alongside the timestamp, the timestamps are ambiguous around the time the time zone changes, and they may come out one hour off when they are read from the database.&lt;/p&gt;

&lt;p&gt;I suppose that in most cases it doesn&apos;t matter much if a password expires one hour too soon or too late, as the password lifetime would be significantly longer than that. However, derby.authentication.native.passwordLifetimeMillis allows specification of password expiry with millisecond granularity, so one cannot completely rule out the possibility that some applications use sub-hour password expiry.&lt;/p&gt;</comment>
                            <comment id="13486856" author="rhillegas" created="Tue, 30 Oct 2012 13:24:54 +0000"  >&lt;p&gt;I am reluctant to change the stored format of Derby TIMESTAMPs. I am also reluctant to build complicated timezone-aware machinery to police this problem. I am inclined to add a warning to the documentation for SYSCS_UTIL.SYSCS_CREATE_USER, SYSCS_UTIL.SYSCS_MODIFY_PASSWORD, and SYSCS_UTIL.SYSCS_RESET_PASSWORD: password lifetimes may be skewed by timezone changes.&lt;/p&gt;</comment>
                            <comment id="13486901" author="knutanders" created="Tue, 30 Oct 2012 14:23:01 +0000"  >&lt;p&gt;An alternative may be to store the timestamp in GMT, which would not be affected by time zone changes.&lt;/p&gt;

&lt;p&gt;It might be as simple as changing this code in SYSUSERSRowFactory.makeRow() from&lt;/p&gt;

&lt;p&gt;            /* 4th column is LASTMODIFIED (timestamp) */&lt;br/&gt;
            row.setColumn( LASTMODIFIED_COL_NUM, new SQLTimestamp( lastModified ) );&lt;/p&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;p&gt;            /* 4th column is LASTMODIFIED (timestamp) */&lt;br/&gt;
            SQLTimestamp universalModTime = new SQLTimestamp();&lt;br/&gt;
            universalModTime.setValue(lastModified, Calendar.getInstance(TimeZone.getTimeZone(&quot;GMT&quot;)));&lt;br/&gt;
            row.setColumn( LASTMODIFIED_COL_NUM, universalModTime);&lt;/p&gt;

&lt;p&gt;and in buildDescriptor() from&lt;/p&gt;

&lt;p&gt;            /* 4th column is LASTMODIFIED */&lt;br/&gt;
            col = row.getColumn( LASTMODIFIED_COL_NUM );&lt;br/&gt;
            lastModified = col.getTimestamp( new java.util.GregorianCalendar() );&lt;/p&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;p&gt;            /* 4th column is LASTMODIFIED */&lt;br/&gt;
            col = row.getColumn( LASTMODIFIED_COL_NUM );&lt;br/&gt;
            lastModified = col.getTimestamp(Calendar.getInstance(TimeZone.getTimeZone(&quot;GMT&quot;)));&lt;/p&gt;</comment>
                            <comment id="13487765" author="rhillegas" created="Wed, 31 Oct 2012 13:28:18 +0000"  >&lt;p&gt;Thanks for that suggestion, Knut. I think it will work. However, it requires different (de)serialization logic for LASTMODIFIED stamps, depending on whether they were written to SYSUSERS before or after the fix is applied.&lt;/p&gt;

&lt;p&gt;1) One approach to this problem would be to overload HASHINGSCHEME so that it both describes the technique used to hash PASSWORD as well as the technique used to serialize LASTMODIFIED. We could introduce a new prefix for the HASHINGSCHEME column: ID_PATTERN_CONFIGURABLE_STRETCHED_SCHEME_GMT. This prefix would imply hashing behavior identical to ID_PATTERN_CONFIGURABLE_STRETCHED_SCHEME but it would encode the fact that LASTMODIFIED was shifted to GMT before being serialized.&lt;/p&gt;

&lt;p&gt;2) Another approach would be to add a timezone column to SYS.SYSUSERS.&lt;/p&gt;

&lt;p&gt;3) Another approach would be to add a time-zone aware variant of SQLTIMESTAMP and store that in LASTMODIFIED.&lt;/p&gt;

&lt;p&gt;Other suggestions?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="13487784" author="knutanders" created="Wed, 31 Oct 2012 14:00:01 +0000"  >&lt;p&gt;Option 3 might actually be a good first step for implementing &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4611&quot; title=&quot;Add new datatypes: TIME WITH TIMEZONE and TIMESTAMP WITH TIMEZONE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4611&quot;&gt;DERBY-4611&lt;/a&gt; (TIMESTAMP WITH TIMEZONE). Option 1 sounds like less work.&lt;/p&gt;

&lt;p&gt;Or we could just release note that already persisted passwords may have a few hours added to or removed from their lifetimes on upgrade, and skip the upgrade logic. Since the feature is so new, I wouldn&apos;t expect that many have started using it in ways that depend on the exact lifetime of the passwords, so hopefully that could be enough to manage any upgrade issues.&lt;/p&gt;</comment>
                            <comment id="13487885" author="rhillegas" created="Wed, 31 Oct 2012 15:57:51 +0000"  >&lt;p&gt;I have logged &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5974&quot; title=&quot;Convert TIMESTAMP metadata columns to TIMESTAMP WITH TIMEZONE after we implement that datatype.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5974&quot;&gt;DERBY-5974&lt;/a&gt;, an enhancement for converting all of the TIMESTAMP metadata columns to TIMESTAMP WITH TIMEZONE (after we implement that datatype). As part of that issue, I suspect that we would convert all TIMESTAMP metadata to GMT, including SYS.SYSUSERS.LASTMODIFIED. Until we make that change, I propose that we live with the defect tracked by this bug and address it with some weasel words in the Reference Manual sections on the password management procs. Does that seem sufficient? Thanks.&lt;/p&gt;</comment>
                            <comment id="13487907" author="knutanders" created="Wed, 31 Oct 2012 16:19:58 +0000"  >&lt;p&gt;Yes, I think that would be OK. We should probably also add a decorator around the test to silence it for future time zone changes until &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4611&quot; title=&quot;Add new datatypes: TIME WITH TIMEZONE and TIMESTAMP WITH TIMEZONE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4611&quot;&gt;DERBY-4611&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5974&quot; title=&quot;Convert TIMESTAMP metadata columns to TIMESTAMP WITH TIMEZONE after we implement that datatype.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5974&quot;&gt;DERBY-5974&lt;/a&gt; have been fixed.&lt;/p&gt;</comment>
                            <comment id="13489301" author="knutanders" created="Fri, 2 Nov 2012 07:47:27 +0000"  >&lt;p&gt;Attaching a patch that makes the test run in the GMT time zone for now. Let&apos;s revisit and see if we can get it to run in the local time zone once &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5974&quot; title=&quot;Convert TIMESTAMP metadata columns to TIMESTAMP WITH TIMEZONE after we implement that datatype.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5974&quot;&gt;DERBY-5974&lt;/a&gt; is fixed.&lt;/p&gt;

&lt;p&gt;Committed revision 1404888.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12614192">DERBY-5974</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12551832" name="d5966-1a-gmt.diff" size="1898" author="knutanders" created="Fri, 2 Nov 2012 07:47:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 29 Oct 2012 14:31:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>252764</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy72n3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75085</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>