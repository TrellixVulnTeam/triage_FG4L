<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:20:59 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2153/DERBY-2153.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2153] suites.All falls over with foundation after revision 482433; java.lang.NoClassFoundError: javax.xml.parsers.DocumentBuilderFactory</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2153</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When attempting to run:&lt;br/&gt;
&amp;lt;j9binpath&amp;gt;/j9 -jcl:foun10 -Dderby.system.home=&amp;lt;testhome&amp;gt; -DderbyTesting.serverhost=localhost -DderbyTesting.clienthost=localhost -DderbyTesting.codeclasses=&lt;a href=&quot;file:/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/&lt;/a&gt;&amp;lt;classesdir&amp;gt;/ -DderbyTesting.junit=&lt;a href=&quot;file://unused&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file://unused&lt;/a&gt; -DderbyTesting.antjunit=&lt;a href=&quot;file://unused&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file://unused&lt;/a&gt; -Djava.security.policy=&lt;a href=&quot;file:/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/&lt;/a&gt;&amp;lt;classesdir&amp;gt;/org/apache/derbyTesting/functionTests/util/derby_tests.policy -Xbootclasspath/a:&amp;lt;j9libpath&amp;gt;/jdbc.jar -cp &amp;lt;classesdir&amp;gt;;junit.jar junit.textui.TestRunner org.apache.derbyTesting.functionTests.suites.All &lt;/p&gt;

&lt;p&gt;The textui.TestRunner keels over with the following error:&lt;br/&gt;
Failed to invoke suite():java.lang.NoClassDefFoundError: javax.xml.parsers.DocumentBuilderFactory&lt;/p&gt;

&lt;p&gt;This happens after, but not before revision 482433. &lt;/p&gt;</description>
                <environment>IBM&amp;#39;s wctme5.7 (a.k.a. j9) jcl Foundation libraries (j2MEjdk 1.0)</environment>
        <key id="12357819">DERBY-2153</key>
            <summary>suites.All falls over with foundation after revision 482433; java.lang.NoClassFoundError: javax.xml.parsers.DocumentBuilderFactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="army">A B</assignee>
                                    <reporter username="myrna">Myrna van Lunteren</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Dec 2006 21:14:57 +0000</created>
                <updated>Tue, 30 Jun 2009 16:55:45 +0100</updated>
                            <resolved>Mon, 11 Dec 2006 16:35:33 +0000</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12455764" author="army" created="Tue, 5 Dec 2006 21:39:37 +0000"  >&lt;p&gt;This is caused by addition of the DocumentBuilderFactory to junit/XML.java.  When I added the import I knew it would make it so that the XML tests would fail with 1.3 JVMs, as indicated by this diff:&lt;/p&gt;

&lt;p&gt;+/* The following import is for a JDBC 3.0 JAXP class, which means that&lt;br/&gt;
+ * this file can only be built with 1.4 or later (see build.xml in&lt;br/&gt;
+ * this directory).  This means that 1.3 JVMs will not be able to&lt;br/&gt;
+ * instantiate this class--but since 1.3 is deprecated as of 10.3,&lt;br/&gt;
+ * we do not worry about that here.&lt;br/&gt;
+ */&lt;br/&gt;
+import javax.xml.parsers.DocumentBuilderFactory;&lt;br/&gt;
+&lt;/p&gt;

&lt;p&gt;But of course, I failed to realize that wctme is (apparently?) based on a 1.3 JVM and it (wctme) is &lt;b&gt;not&lt;/b&gt; deprecated as of 10.3.  So my mistake.&lt;/p&gt;

&lt;p&gt;I think the fix here is going to be to create a separate file in the juni/t directory that is only instantiated when all required XML classes are in the classpath (similar to the SqlXmlUtil.java class in the engine).  I&apos;ll look into making that change.&lt;/p&gt;

&lt;p&gt;Just as a sidenote: if you have the required XML classes (esp. xml-apis.jar, a JAXP parser, and Xalan) in your classpath, the tests should run fine with wctme5.7.  It&apos;s only  if those jars are missing that this will be a problem.&lt;/p&gt;

&lt;p&gt;Thanks for catching this!&lt;/p&gt;</comment>
                            <comment id="12456156" author="djd" created="Wed, 6 Dec 2006 18:30:19 +0000"  >&lt;p&gt;The code that uses DocumentBuilderFactory in junit.XML has this&lt;/p&gt;

&lt;p&gt;Class.forName(DocumentBuilderFactory.newInstance().getClass().getName())&lt;/p&gt;

&lt;p&gt;I think that could be simplified with:&lt;/p&gt;

&lt;p&gt;DocumentBuilderFactory.newInstance().getClass()&lt;/p&gt;

&lt;p&gt;and then reading the comments above this line, I wonder if this could have been used instead?&lt;/p&gt;

&lt;p&gt;DocumentBuilderFactory.class&lt;/p&gt;
</comment>
                            <comment id="12456159" author="djd" created="Wed, 6 Dec 2006 18:35:49 +0000"  >&lt;p&gt;Just to be clear Derby is supoorted on J2ME/CDC/Foundation 1.0 with JSR 169.&lt;br/&gt;
J2ME/CDC/Foundation 1.0 is separate to J2SE 1.3 (but I think was derived from JDK 1.3, though it also includes additional classes.&lt;br/&gt;
JSR169 is a subset of JDBC 3.0&lt;/p&gt;

&lt;p&gt;Also the coment you quoted above says &quot;The following import is for a JDBC 3.0 JAXP class&quot;.&lt;br/&gt;
I think you meant to say something instead of JDBC 3.0, since JAXP is not part of JDBC.&lt;/p&gt;</comment>
                            <comment id="12456171" author="army" created="Wed, 6 Dec 2006 19:20:43 +0000"  >&lt;p&gt;&amp;gt; I think that could be simplified with:&lt;br/&gt;
&amp;gt;    DocumentBuilderFactory.newInstance().getClass()&lt;/p&gt;

&lt;p&gt;Yes, you&apos;re absolutely right.  I&apos;ll include this in my patch for this issue.&lt;/p&gt;

&lt;p&gt;&amp;gt; and then reading the comments above this line, I wonder if this could have been&lt;br/&gt;
&amp;gt; used instead?&lt;br/&gt;
&amp;gt;    DocumentBuilderFactory.class &lt;/p&gt;

&lt;p&gt;I don&apos;t think this will always work.  The 1.4, 1.5, and 1.6 JVMs (at least, Sun and IBM) all embed the JAXP API classes.  But in the case of, say, Sun 1.5, the JAXP &lt;b&gt;implementation&lt;/b&gt; classes are not embedded.  So if we&apos;re running with Sun 1.5 then any attempts to look up the URL for &quot;DocumentBuilderFactory.class&quot; would return null because it&apos;s embedded within the JVM.  But if we have an external JAXP implementation (say Xerces) in the classpath, we need to find that jar file.  By instantiating the DocBuilderFactory class and using the the &lt;b&gt;implementation&lt;/b&gt;-specific class name we ensure that, for external (w.r.t the JVM) JAXP implementations, we can find the implementation jar file and thus we can assign the correct permissions.&lt;/p&gt;

&lt;p&gt;Note that I haven&apos;t tried it yet, but if the user was using Sun 1.5 and &lt;b&gt;endorsed&lt;/b&gt; the JAXP parser, I think the use of DocumentBuilderFactory.class would work.  But I don&apos;t think we want to make that a requirement, do we?&lt;/p&gt;

&lt;p&gt;&amp;gt; Also the coment you quoted above says &quot;The following import is for a JDBC 3.0 JAXP class&quot;.&lt;br/&gt;
&amp;gt; I think you meant to say something instead of JDBC 3.0, since JAXP is not part of JDBC. &lt;/p&gt;

&lt;p&gt;Okay, I think I&apos;ve made this mistake before (sorry).  Will change it in my patch.&lt;/p&gt;</comment>
                            <comment id="12456250" author="army" created="Wed, 6 Dec 2006 23:01:32 +0000"  >&lt;p&gt;Attaching a patch, d2153_v1.patch, to create a new file, junit/JAXPFinder.java, that is only instantiated when all required XML classes are in the classpath.  The patch then moves the import of DocumentBuilderFactory out of junit/XML.java and into junit/JAXPFinder.java.  This extra level of indirection combined with the conditional instantiation of JAXPFinder ensures that we do not attempt to instantiate a DocumentBuilderFactory unless we have the necessary JAXP classes.  Thus the NoClassFoundError will no longer occur for wctme5.7 (j9).&lt;/p&gt;

&lt;p&gt;The patch also makes the changes suggested by Dan in his previous comments (thanks Dan!).&lt;/p&gt;

&lt;p&gt;I ran suites.All with wctme5.7 and saw 8 failures:&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 1166,  Failures: 0,  Errors: 8&lt;/p&gt;

&lt;p&gt;All eight failures are covered by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2157&quot; title=&quot;SqlExceptionTest.testChainedException and .testNextException fail with wctme5.7 foundation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2157&quot;&gt;&lt;del&gt;DERBY-2157&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2158&quot; title=&quot;test lang.UpdatableResultSetTest.testUpdateXXXWithAllDatatypes fails with wctme5.7 (j9) foundation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2158&quot;&gt;&lt;del&gt;DERBY-2158&lt;/del&gt;&lt;/a&gt; and are not related to my changes.  I also ran XMLSuite using wctme after putting the required JAXP and Xalan classes in the classpath; all XML tests then ran without error, as expected.&lt;/p&gt;

&lt;p&gt;Patch is ready for review.  I tried to add extensive comments explaining why these changes are needed, so it&apos;d be great if people can at least review the comments and let me know what I can do to improve them.&lt;/p&gt;

&lt;p&gt;And as a final note, I tried running suites.All with wctme5.7 without the patch and I did indeed see the error reported here--so hopefully that means I&apos;m running the wctme tests correctly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12456257" author="djd" created="Wed, 6 Dec 2006 23:24:50 +0000"  >&lt;p&gt;Patch enables me to run the junit tests under J2ME/CDC/Foundation again.&lt;/p&gt;</comment>
                            <comment id="12456481" author="army" created="Thu, 7 Dec 2006 16:51:23 +0000"  >&lt;p&gt;Thank you for verifying the patch, Dan.  I went ahead and committed the changes  with svn 483532 since it allows J2ME tests to run again and since it does not appear to break anything else.&lt;/p&gt;

&lt;p&gt;If anyone is/was/would like to review, though, please feel free to do so.  I will gladly post follow-up patches as necessary.  In the absence of any further comments, I&apos;ll resolve/close this issue in a day or two.&lt;/p&gt;</comment>
                            <comment id="12457397" author="army" created="Mon, 11 Dec 2006 16:35:33 +0000"  >&lt;p&gt;Patch committed on 12/07 and no further comments/issues have come up, so resolving/closing this Jira entry.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12346599" name="d2153_v1.patch" size="13108" author="army" created="Wed, 6 Dec 2006 23:01:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 5 Dec 2006 21:39:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22911</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0uwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38824</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>