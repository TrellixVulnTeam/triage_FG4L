<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:30:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2385/DERBY-2385.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2385] create the stored procedures called by LOB related JDBC methods during upgrade</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2385</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;DataDictionaryImpl.create_10_3_LOB_Specific_functions() has to be called from DD_Version.doFullUpgrade() in order to create the procedures when upgrading from 10.2 or earlier versions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12363865">DERBY-2385</key>
            <summary>create the stored procedures called by LOB related JDBC methods during upgrade</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="narayanan">V.Narayanan</assignee>
                                    <reporter username="narayanan">V.Narayanan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Mar 2007 10:52:48 +0000</created>
                <updated>Fri, 21 Jan 2011 17:49:50 +0000</updated>
                            <resolved>Tue, 8 May 2007 16:43:48 +0100</resolved>
                                    <version>10.3.1.4</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12481917" author="narayanan" created="Sun, 18 Mar 2007 08:05:04 +0000"  >&lt;p&gt;The patch as such involved just calling the create_10_3_LOB_Specific_functions in doFullUpgrade of DD_Version. Going forward create_10_3_functions should be the only function that should be called in doFullUpgrade and create_10_3_LOB_Specific_Functions should be called from create_10_3_Functions. &lt;/p&gt;

&lt;p&gt;I have not done this as part of this patch since create_10_3_functions already contains functionality I guess related to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-378&quot; title=&quot;support for  import/export  of  tables with clob/blob and the other binary data types   will be good addition to derby,&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-378&quot;&gt;&lt;del&gt;DERBY-378&lt;/del&gt;&lt;/a&gt; and I am not sure if Upgrade will be done in a future phase of solutions to this issue.&lt;/p&gt;

&lt;p&gt;I have also added tests to UpgradeTester to test the stored procedures. I was not sure if this were required since I had to update upgrade cannons with metadata output related to the stored functions I create. If people feel the additional tests I have added are not necessary I will remove them.&lt;/p&gt;

&lt;p&gt;I have run only the upgrade suite and it passed. However since I have modified DD_version and DataDictionaryImpl classes I will run derbyall and junit tests and shall post the outputs for the same. &lt;/p&gt;

&lt;p&gt;I request for the patch I am attaching to be considered for reviews and comments.&lt;/p&gt;</comment>
                            <comment id="12481946" author="djd" created="Sun, 18 Mar 2007 14:53:24 +0000"  >&lt;p&gt;Could you add the tests to the new upgrade JUnit based test instead of the old harness based test?&lt;/p&gt;

&lt;p&gt;I &apos;m just about to remove the old harness test as I&apos;ve fully converted it. It&apos;s runnable at the moment, the current committed version is just missing a minor test case.&lt;/p&gt;

&lt;p&gt;See;&lt;br/&gt;
&lt;a href=&quot;http://wiki.apache.org/db-derby/DerbyTopLevelJunitTests&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/DerbyTopLevelJunitTests&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You would need to add test fixture(s) to Changes10_3.&lt;/p&gt;</comment>
                            <comment id="12482009" author="narayanan" created="Mon, 19 Mar 2007 03:40:42 +0000"  >&lt;p&gt;I will do this. Thank you for informing me and and also for the pointers.&lt;/p&gt;</comment>
                            <comment id="12484149" author="narayanan" created="Mon, 26 Mar 2007 17:19:44 +0100"  >&lt;p&gt;In trying to produce a solution for this I wanted to do two things&lt;/p&gt;

&lt;p&gt;Development code&lt;br/&gt;
----------------------------&lt;/p&gt;

&lt;p&gt;In the call to doFullUpgrade in DD_Version I wanted to call create_10_3_system_procedures and I wanted that method to handle all the stored procedures for 10.3. I thought this was a more elegant method than calling multiple methods here. &lt;/p&gt;

&lt;p&gt;Since the Stored Procedures for the locator implementation of the LOB related JDBC methods are created in the SYSIBM schema and create_10_3_system_procedures accepts a schema parameter as of know I could not use it to create the locator related procedures in the SYSIBM schema.&lt;/p&gt;

&lt;p&gt;I decided to make create_10_3_system_procedures accept the tc as a parameter and handle the creation of the stored procedures in the different schema here.&lt;/p&gt;

&lt;p&gt;Testing Code&lt;br/&gt;
------------------&lt;/p&gt;

&lt;p&gt;In my previous attachment to this issue I had written code as part of the upgrade tests to test the locator related stored procedures (in the old suite). This was code replication and seemed wrong to me. I could reuse the tests in jdbcapi/ClobStoredProcedureTest and jdbcapi/BlobStoredProcedureTest&lt;/p&gt;

&lt;p&gt;I had the following conditions&lt;/p&gt;

&lt;p&gt;1) The suites needed to be created during the HARD_UPGRADE and PH_HARD_UPGRADE phases.&lt;br/&gt;
2) The tests need not be run when the old release is greater than 10.3&lt;/p&gt;

&lt;p&gt;I took a few tips from how DatabaseMetaDataTest is run today as part of uprgade. That seemed a great way of doing this without code replication&lt;/p&gt;

&lt;p&gt;In the baseSuite method of UpgradeRun I create these suites to the base suite during the HARD_UPGRADE and the PH_HARD_UPGRADE phases.&lt;/p&gt;

&lt;p&gt;I have not tested this code. I just finished coding. So I thought I could put this in to get a few comments and views on whether this is the right way to do this.&lt;/p&gt;

&lt;p&gt;Pls note that I have not run it and seen and it is only for comments.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;THIS PATCH IS NOT FOR A COMMIT&lt;/b&gt;&lt;/p&gt;</comment>
                            <comment id="12485168" author="narayanan" created="Thu, 29 Mar 2007 13:53:41 +0100"  >&lt;p&gt;I have changed the tests to match the advice I got from the community. &lt;/p&gt;

&lt;p&gt;1) passed the phase into the suite method of Changes10_3&lt;br/&gt;
2) Add the ClobStoredProcedureTest and BlobStoredProcedureTest suites to the suite returned from Changes10_3 when the phase is PH_HARD_UPGRADE.&lt;/p&gt;

&lt;p&gt;I ran derbyall and had 0 failures&lt;/p&gt;

&lt;p&gt;I copied the 10.2 jars to a directory named &amp;lt;parent&amp;gt;/10.2.2.0 and used the following command to run the tests&lt;/p&gt;

&lt;p&gt;java -DderbyTesting.oldReleasePath=&amp;lt;parent&amp;gt; junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.upgradeTests._Suite &lt;/p&gt;

&lt;p&gt;The tests ran without failures. I had run it earlier and noticed 71 runs. With my patch it has 87 test runs (16 of the tests for the locator related stored procedures.).&lt;/p&gt;

&lt;p&gt;I HAVE NOT run junit tests (except for upgrade). I was planning to run it tonight and am confident that I will not have any failures there.&lt;/p&gt;

&lt;p&gt;I request this patch to be considered for reviews and comments and if everything is ok a commit too.&lt;/p&gt;</comment>
                            <comment id="12485385" author="djd" created="Fri, 30 Mar 2007 00:58:26 +0100"  >&lt;p&gt;The changes to UpgradeRun.java look incorrect.&lt;/p&gt;

&lt;p&gt;I would have thought the only change would be to pass the phase into the Changes10_3.suite() method.&lt;/p&gt;

&lt;p&gt;Can you explain why the Changes10_3 are now added in a different way to the other Changes10_x tests?&lt;/p&gt;</comment>
                            <comment id="12485414" author="narayanan" created="Fri, 30 Mar 2007 06:06:32 +0100"  >&lt;p&gt;&amp;gt; I would have thought the only change would be to pass the phase into the &amp;gt; Changes10_3.suite() method.&lt;/p&gt;

&lt;p&gt;I agree. &lt;/p&gt;

&lt;p&gt;I had earlier got confused with the PH_POST_HARD_UPGRADE phase and thought I should run the locator related tests in that phase also. I later realized that in that phase your database will not boot and the phase has been created to ensure that it doesn&apos;t. I had moved the Changes10_3.suite() code to enable addition in the PH_POST_HARD_UPGRADE phase but missed moving it back. &lt;/p&gt;

&lt;p&gt;It wouldn&apos;t have affected the current runs but was not a clean solution and was unnecessary.&lt;/p&gt;

&lt;p&gt;I have addressed the issue in the current patch and have moved the code back.&lt;/p&gt;

&lt;p&gt;thanx for pointing it out !&lt;/p&gt;

&lt;p&gt;I ran the upgrade tests they passed with 87 runs as expected.&lt;/p&gt;

&lt;p&gt;I am running junit tests to ensure no failures are there.&lt;/p&gt;

&lt;p&gt;Pls consider the patch for reviews and comments. I will post the junit all run shortly.&lt;/p&gt;</comment>
                            <comment id="12485493" author="narayanan" created="Fri, 30 Mar 2007 13:02:29 +0100"  >&lt;p&gt;I ran junit suites.All on this patch.&lt;/p&gt;

&lt;p&gt;I got the following errors&lt;/p&gt;

&lt;p&gt;SecurityPolicyReloadingTest(  )java.lang.NullPointerException (this has been failing in the main trunk too)&lt;/p&gt;

&lt;p&gt;and lot of exceptions like  (These occured in my environment WITH and WITHOUT the patch. So they seem to be more related to my environment than my patch changes)&lt;/p&gt;

&lt;p&gt; Encryption Algorithm: defaultjava.security.AccessControlException: access denied (java.util.PropertyPermission derby.system.home read)&lt;br/&gt;
    at java.security.AccessControlContext.checkPermission(AccessControlContext.java:323)&lt;br/&gt;
    at java.security.AccessController.checkPermission(AccessController.java:546)&lt;br/&gt;
    at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)&lt;br/&gt;
    at java.lang.SecurityManager.checkPropertyAccess(SecurityManager.java:1285)&lt;br/&gt;
    at java.lang.System.getProperty(System.java:652)&lt;br/&gt;
    at org.apache.derbyTesting.junit.BaseTestCase$3.run(BaseTestCase.java:202)&lt;br/&gt;
    at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
    at org.apache.derbyTesting.junit.BaseTestCase.getSystemProperty(BaseTestCase.java:198)&lt;br/&gt;
    at org.apache.derbyTesting.junit.DropDatabaseSetup.removeDatabase(DropDatabaseSetup.java:88)&lt;br/&gt;
    at org.apache.derbyTesting.junit.DropDatabaseSetup.tearDown(DropDatabaseSetup.java:80)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:20)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;br/&gt;
    at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)&lt;br/&gt;
    at junit.extensions.TestSetup$1.protect(TestSetup.java:19)&lt;br/&gt;
    at junit.extensions.TestSetup.run(TestSetup.java:23)&lt;/p&gt;

&lt;p&gt;I did not understand how to resolve the above. However my runs without my patch reproduced the same and I was able to conclude that this is independent of my patch.&lt;/p&gt;

&lt;p&gt;I request for the patch upgrade_v4.diff to be considered for reviews and comments and if everything is ok a commit too.&lt;/p&gt;</comment>
                            <comment id="12491591" author="narayanan" created="Wed, 25 Apr 2007 11:32:08 +0100"  >&lt;p&gt;I applied upgrade_v4.diff to a new workspace. It did not seem to have conflicts in any class it affects. &lt;/p&gt;

&lt;p&gt;Also I ran the junit All suite and there were no failures. &lt;/p&gt;

&lt;p&gt;I request for a interested person to consider upgrade_v4.diff  for reviews and comments and if everything is OK a commit too.&lt;/p&gt;
</comment>
                            <comment id="12492787" author="rhillegas" created="Mon, 30 Apr 2007 21:41:55 +0100"  >&lt;p&gt;Thanks for this patch, Narayanan. I am running regression tests now.&lt;/p&gt;

&lt;p&gt;I have one question, which won&apos;t prevent me from committing this good, incremental work: In Chnages10_3.testImportExportLobsProcedures(), why is the PH_POST_SOFT_UPGRADE case a NOP? Shouldn&apos;t this case have the same behavior as PH_SOFT_UPGRADE?&lt;/p&gt;</comment>
                            <comment id="12492826" author="rhillegas" created="Tue, 1 May 2007 01:27:36 +0100"  >&lt;p&gt;Committed upgrade_v4.diff at subversion revision 533893.&lt;/p&gt;</comment>
                            <comment id="12493062" author="narayanan" created="Wed, 2 May 2007 10:45:03 +0100"  >&lt;p&gt;&amp;gt;I have one question, which won&apos;t prevent me from committing this good, incremental work: In Chnages10_3.testImportExportLobsProcedures(), why &amp;gt;is the PH_POST_SOFT_UPGRADE case a NOP? Shouldn&apos;t this case have the same behavior as PH_SOFT_UPGRADE? &lt;/p&gt;

&lt;p&gt;I have not changed anything related to this code. These changes don&apos;t seem to be part of this patch Rick. &lt;/p&gt;

&lt;p&gt;The only changes to Changes10_3.java in my patch is this&lt;/p&gt;

&lt;p&gt;+   &lt;br/&gt;
+    /**&lt;br/&gt;
+     * Return the suite of tests to test the changes made in 10.3.&lt;br/&gt;
+     * @param phase an integer that indicates the current phase in&lt;br/&gt;
+     *              the upgrade test.&lt;br/&gt;
+     * @return the test suite created.&lt;br/&gt;
+     */   &lt;br/&gt;
+    public static Test suite(int phase) {&lt;br/&gt;
         TestSuite suite = new TestSuite(&quot;Upgrade changes for 10.3&quot;);&lt;/p&gt;

&lt;p&gt;         suite.addTestSuite(Changes10_3.class);&lt;br/&gt;
+        &lt;br/&gt;
+        //Add the tests for the Stored procedures related to the locator&lt;br/&gt;
+        //implementation of the LOB related JDBC methods. This needs to be done&lt;br/&gt;
+        //only during the hard(full) upgrade phase.&lt;br/&gt;
+        if(phase == PH_HARD_UPGRADE) &lt;/p&gt;
{
+            //Tests for the Blob related locator StoredProcedures
+            suite.addTestSuite(BlobStoredProcedureTest.class);
+            //Tests for the Clob related locator StoredProcedures
+            suite.addTestSuite(ClobStoredProcedureTest.class);
+        }
&lt;p&gt;+        &lt;/p&gt;</comment>
                            <comment id="12493063" author="narayanan" created="Wed, 2 May 2007 10:46:12 +0100"  >&lt;p&gt;Thank you for reviewing the v4 patch and giving it a commit Rick!&lt;/p&gt;</comment>
                            <comment id="12494310" author="narayanan" created="Tue, 8 May 2007 16:43:48 +0100"  >&lt;p&gt;The final patch has been submitted and committed. Resolving this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12360843">DERBY-2257</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12353584" name="upgrade_v1.diff" size="31137" author="narayanan" created="Sun, 18 Mar 2007 08:05:04 +0000"/>
                            <attachment id="12353585" name="upgrade_v1.stat" size="422" author="narayanan" created="Sun, 18 Mar 2007 08:05:04 +0000"/>
                            <attachment id="12354227" name="upgrade_v2.diff" size="6464" author="narayanan" created="Mon, 26 Mar 2007 17:19:44 +0100"/>
                            <attachment id="12354228" name="upgrade_v2.stat" size="332" author="narayanan" created="Mon, 26 Mar 2007 17:19:44 +0100"/>
                            <attachment id="12354509" name="upgrade_v3.diff" size="6920" author="narayanan" created="Thu, 29 Mar 2007 13:53:41 +0100"/>
                            <attachment id="12354510" name="upgrade_v3.stat" size="426" author="narayanan" created="Thu, 29 Mar 2007 13:53:41 +0100"/>
                            <attachment id="12354577" name="upgrade_v4.diff" size="6786" author="narayanan" created="Fri, 30 Mar 2007 06:06:32 +0100"/>
                            <attachment id="12354578" name="upgrade_v4.stat" size="426" author="narayanan" created="Fri, 30 Mar 2007 06:06:32 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 18 Mar 2007 14:53:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30412</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0mlr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37480</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>