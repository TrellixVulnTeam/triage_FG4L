<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:34:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2370/DERBY-2370.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2370] EXISTS may return the wrong value for sub-queries involving set operations</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2370</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;It seems like EXISTS on a SELECT returning zero rows returns false (as&lt;br/&gt;
expected), but EXISTS on INTERSECT of two disjunct sets returns true,&lt;br/&gt;
e.g EXISTS (values 1 intersect values 2).&lt;/p&gt;

&lt;p&gt;Yip Ng wrote on derby-dev:&lt;br/&gt;
I believe its probably got to do with the EXISTS subquery transforming&lt;br/&gt;
the original RCL to&lt;br/&gt;
a TRUE boolean value for the INTERSECT.  So during row comparison at&lt;br/&gt;
execution time&lt;br/&gt;
for INTERSECT processing since true == true(thus intersects), so it&lt;br/&gt;
will always return &apos;BAD&apos;.  Likewise,&lt;/p&gt;

&lt;p&gt;select * from ( values &apos;OK&apos; ) as T where exists (values 1 except values 2);&lt;/p&gt;

&lt;p&gt;This supposedly should return &apos;OK&apos; but because of the boolean&lt;br/&gt;
transformation mentioned&lt;br/&gt;
above for EXISTS subquery, it will return no rows for EXCEPT&lt;br/&gt;
processing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12363469">DERBY-2370</key>
            <summary>EXISTS may return the wrong value for sub-queries involving set operations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="army">A B</assignee>
                                    <reporter username="dyret">Dyre Tjeldvoll</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Feb 2007 09:14:08 +0000</created>
                <updated>Tue, 30 Jun 2009 17:12:56 +0100</updated>
                            <resolved>Tue, 22 May 2007 22:24:25 +0100</resolved>
                                    <version>10.2.2.0</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12475296" author="dyret" created="Fri, 23 Feb 2007 09:15:57 +0000"  >&lt;p&gt;ij script to reproduce the bug.&lt;/p&gt;</comment>
                            <comment id="12490469" author="army" created="Fri, 20 Apr 2007 23:52:17 +0100"  >&lt;p&gt;Yip was exactly right in his diagnosis of the problem.  I&apos;m attaching a short writeup of the problem and a proposed solution as d2370_writeup_v1.patch.&lt;/p&gt;

&lt;p&gt;I&apos;m also attaching a patch, d2370_engine_v1.patch, that implements the change by doing the following:&lt;/p&gt;

&lt;p&gt;  1. Adds the ability to mark a FromList as &quot;transparent&quot;, and updates FromList.bindExpressions() to&lt;br/&gt;
     pass the outer FROM list down (instead of &quot;this&quot;) if the FromList is transparent.&lt;br/&gt;
  2. Updates FromList.expandAll(...) to account for the fact that outer FROM tables might now appear&lt;br/&gt;
     in a nested FromList (as a result of &quot;transparent&quot; FromLists; see code comments for details).&lt;br/&gt;
  3. Modifies the &quot;setResultToBooleanTrue()&quot; signature to return a ResultSetNode (it was &quot;void&quot; previously).&lt;br/&gt;
  4. Modifies ResultSetNode.setResultToBooleanTrue() to always return &quot;this&quot;.&lt;br/&gt;
  5. Modifies SetOperatorNode.setResultToBooleanTrue() so that it now creates an internal &quot;SELECT *&quot; query&lt;br/&gt;
     whose FROM list contains just the SetOperatorNode. Then we transform the &quot;*&quot; for the new SELECT into&lt;br/&gt;
     &quot;TRUE&quot; and leave the SetOperatorNode&apos;s result columns UN-transformed.  Finally, we mark the new&lt;br/&gt;
     SelectNode&apos;s FromList as &quot;transparent&quot; and return the new SelectNode.&lt;/p&gt;

&lt;p&gt;I&apos;ve included a corresponding patch, d2370_tests_v1.patch, that contains slight modifications to two tests: lang/union.sql and lang/ResultSetsFromPreparedStatementTest.  The latter changes are expected based on comments in the test; the former (lang/union.sql) has a couple of queries that now fail when they used to succeed.  However, I think the failures are correct-&lt;del&gt;i.e. that Derby should have been failing prior to these changes and was not&lt;/del&gt;-so I&apos;ve updated lang/union.sql accordingly.  I will send an email about this to derby-dev to see if I can get any feedback/suggestions around this.  And finally, d2370_tests_v1.patch creates a new JUnit test, lang/ExistsWithSetOpsTest, which captures and builds on the repro.sql script attached to this issue.&lt;/p&gt;

&lt;p&gt;I ran derbyall and suites.All with a single failure:&lt;/p&gt;

&lt;p&gt;   jdbcapi/parameterMetaDataJdbc30.java&lt;/p&gt;

&lt;p&gt;This failure only occurred for the client framework and the diff showed a failure to connect--which doesn&apos;t seem related to my changes.  When I ran the test independently it passed as expected.  So I think it was just a fluke.&lt;/p&gt;

&lt;p&gt;Reviews or other feedback would be greatly appreciated, as always.&lt;/p&gt;</comment>
                            <comment id="12491606" author="dyret" created="Wed, 25 Apr 2007 12:13:59 +0100"  >&lt;p&gt;I have looked at the writeup and and also looked at the&lt;br/&gt;
patch. While I am certainly no expert in this area I think the&lt;br/&gt;
explanation and solution in the writeup looks very sound. The&lt;br/&gt;
patch seem to implement what is suggested, it is clear, well&lt;br/&gt;
documented and tested. +1 from me.&lt;/p&gt;</comment>
                            <comment id="12491823" author="army" created="Wed, 25 Apr 2007 23:30:58 +0100"  >&lt;p&gt;Thank you for the review, Dyre.  I synced with the latest codeline and re-ran derbyall and suites.All as a sanity check, then committed the patch with svn #532509:&lt;/p&gt;

&lt;p&gt;  URL: &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=532509&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;rev=532509&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As I haven&apos;t heard any comments regarding the new behavior for certain queries (namely, throwing an error where Derby used to succeed in some cases), I&apos;m working under the assumption that this is okay and am marking the issue RESOLVED.&lt;/p&gt;

&lt;p&gt;Many thanks for your time!&lt;/p&gt;</comment>
                            <comment id="12498016" author="army" created="Tue, 22 May 2007 22:22:57 +0100"  >&lt;p&gt;Reopening to attach release note.&lt;/p&gt;</comment>
                            <comment id="12498017" author="army" created="Tue, 22 May 2007 22:23:32 +0100"  >&lt;p&gt;Attaching first draft of the release note.&lt;/p&gt;</comment>
                            <comment id="12498020" author="army" created="Tue, 22 May 2007 22:24:25 +0100"  >&lt;p&gt;Marking issue resolved (again).  I&apos;ll wait a few days before closing it in case there are comments on the release note...&lt;/p&gt;</comment>
                            <comment id="12505486" author="rhillegas" created="Sat, 16 Jun 2007 17:35:34 +0100"  >&lt;p&gt;Scrub the html in the release note so that it can be digested by the SAX parser in the release note generator.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12408608">DERBY-3951</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12354628">DERBY-2034</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12355963" name="d2370_engine_v1.patch" size="13057" author="army" created="Fri, 20 Apr 2007 23:52:17 +0100"/>
                            <attachment id="12355964" name="d2370_tests_v1.patch" size="24068" author="army" created="Fri, 20 Apr 2007 23:52:17 +0100"/>
                            <attachment id="12355965" name="d2370_v1.stat" size="829" author="army" created="Fri, 20 Apr 2007 23:52:39 +0100"/>
                            <attachment id="12355962" name="d2370_writeup_v1.html" size="24401" author="army" created="Fri, 20 Apr 2007 23:52:17 +0100"/>
                            <attachment id="12359931" name="releaseNote.html" size="5532" author="rhillegas" created="Sat, 16 Jun 2007 17:35:34 +0100"/>
                            <attachment id="12357926" name="releaseNote.html" size="5148" author="army" created="Tue, 22 May 2007 22:23:32 +0100"/>
                            <attachment id="12351872" name="repro.sql" size="1481" author="dyret" created="Fri, 23 Feb 2007 09:15:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 20 Apr 2007 22:52:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23025</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10101"><![CDATA[Release Note Needed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0uc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38733</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>