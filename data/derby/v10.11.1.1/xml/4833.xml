<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:13:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4833/DERBY-4833.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4833] Prepare existing JUnit tests for running with automatic index statistics generation</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4833</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;During prototyping of a mechanism to create and update index statistics automatically (see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4771&quot; title=&quot;Continue investigation of automatic creation/update of index statistics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4771&quot;&gt;&lt;del&gt;DERBY-4771&lt;/del&gt;&lt;/a&gt;) it turned out that some of the tests fail due to the presence of &lt;span class=&quot;error&quot;&gt;&amp;#91;improved&amp;#93;&lt;/span&gt; index statistics.&lt;br/&gt;
Where appropriate the tests should be adjusted to cope with this background activity, and where not appropriate it should be noted such that the feature, when introduced, can be disabled.&lt;/p&gt;

&lt;p&gt;As part of this effort I will introduce a utility class for dealing with index statistics in tests. These will be used by some existing tests and also the new tests that will be written for the new feature.&lt;/p&gt;

&lt;p&gt;At this point two tests requiring adjustments have been identified (OrderByAndSortAvoidance, UpdateStatisticsTest), and one is under investigation (AutoIncrementTest). More may surface as the work on the feature progress.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12476686">DERBY-4833</key>
            <summary>Prepare existing JUnit tests for running with automatic index statistics generation</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Oct 2010 16:59:22 +0100</created>
                <updated>Thu, 7 Jul 2011 20:15:00 +0100</updated>
                            <resolved>Thu, 7 Jul 2011 12:38:41 +0100</resolved>
                                    <version>10.7.1.1</version>
                                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="12918598" author="kristwaa" created="Wed, 6 Oct 2010 18:07:13 +0100"  >&lt;p&gt;Added link to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4804&quot; title=&quot;Make database used in store.OSReadOnlyTest fully read-only&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4804&quot;&gt;&lt;del&gt;DERBY-4804&lt;/del&gt;&lt;/a&gt;, since the problem was detected due to the automatic index statistics update prototype.&lt;/p&gt;</comment>
                            <comment id="12918842" author="kristwaa" created="Thu, 7 Oct 2010 09:55:05 +0100"  >&lt;p&gt;Attaching patch 1a, which removes two (identical) asserts in the lang.OrderByAndSortAvoidance test.&lt;br/&gt;
Depending on whether index statistics are present or not, Derby will choose a table scan or an index scan. This choice is not crucial to the issue being tested, so it should be safe to remove the assert.&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12919264" author="kristwaa" created="Fri, 8 Oct 2010 13:26:45 +0100"  >&lt;p&gt;Committed patch 1a to trunk with revision 1005804.&lt;/p&gt;</comment>
                            <comment id="12970228" author="kristwaa" created="Fri, 10 Dec 2010 16:45:17 +0000"  >&lt;p&gt;Attaching patch 2a, which disabled automatic index stats update for the test store/updatelocks.sql.&lt;br/&gt;
The locks taken, or possibly timing differences, are interfering with the test.There are also reports of intermittent failures for this test (before any of the new istat code was added).&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12970776" author="knutanders" created="Mon, 13 Dec 2010 10:50:22 +0000"  >&lt;p&gt;Patch 2a looks fine to me. This is a problem that can happen in any test that checks the contents of the lock table, isn&apos;t it? Do you think we&apos;ll need some systematic approach to handle this problem, or would it be good enough to handle each occurrence on a case-by-case basis as they show up? (With systematic approach I was thinking something like disabling automatic index statistics update in every test that queries SYSCS_DIAG.LOCK_TABLE, or adding a procedure that waits until the update thread&apos;s queue is empty, similar to T_Access.waitForPostCommitToFinish().)&lt;/p&gt;</comment>
                            <comment id="12972076" author="kristwaa" created="Thu, 16 Dec 2010 13:33:47 +0000"  >&lt;p&gt;Yes, this can happen in all tests that query the lock table, but there are various prerequisites that must be met before the automatic index statistics updates kick in (these may change with the implementation/tuning).&lt;br/&gt;
A quick find/grep resulted in something like 22 hits (on the file level) in the tests directory, and 24 in the masters directory.&lt;/p&gt;

&lt;p&gt;I have run both suites.All and derbyall numerours times without having seen other problems, but that may change on other machines and operating systems.&lt;br/&gt;
If we address this up-front, I would lean towards adding a way to wait for the updates to finish to potentially get more test coverage for the feature, but disabling it would also work fine.&lt;/p&gt;

&lt;p&gt;I don&apos;t have any strong feelings about this right now, and more importantly, I don&apos;t have much time to work on it now...&lt;br/&gt;
If people start seeing intermittent failures when the feature has been committed, it would probably be best to address all affected tests in one go.&lt;/p&gt;</comment>
                            <comment id="12972429" author="knutanders" created="Fri, 17 Dec 2010 10:24:48 +0000"  >&lt;p&gt;It sounds reasonable to wait and see if intermittent failures start appearing in those test, and addressing all in one go if they do. Since the statistics updates don&apos;t kick in unless the tables are above a certain minimum size, it might not be a problem in most of those tests anyway.&lt;/p&gt;</comment>
                            <comment id="13039713" author="kristwaa" created="Thu, 26 May 2011 15:02:26 +0100"  >&lt;p&gt;The initial istat related problems seen with the updatelocksX were solved by changing the threshold values (i.e. upping the minimum number of rows required before the istat daemon considers an update). This means patch 2a probably doesn&apos;t need to be committed.&lt;br/&gt;
In any case, there are still problems with the updatelocksX tests, but it is my impression that they&apos;re not caused by the istat feature. Keeping this issue open a little while longer, hoping we figure out what the underlying problem is.&lt;/p&gt;</comment>
                            <comment id="13061221" author="kristwaa" created="Thu, 7 Jul 2011 12:38:41 +0100"  >&lt;p&gt;Closing issue.&lt;br/&gt;
The failing updateLocks tests have now been rewritten to JUnit, see &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5305&quot; title=&quot;Convert store/updatelocks.sql to JUnit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5305&quot;&gt;&lt;del&gt;DERBY-5305&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13061506" author="dagw" created="Thu, 7 Jul 2011 20:15:00 +0100"  >&lt;p&gt;Not sure which one failed here, but the updateLocksJDBC30.sql is not converted yet.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12498557">DERBY-5038</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12474359">DERBY-4804</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12512171">DERBY-5305</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12456580" name="derby-4833-1a-orderbyandsortavoidancetest_adjustment.diff" size="1030" author="kristwaa" created="Thu, 7 Oct 2010 09:55:05 +0100"/>
                            <attachment id="12465999" name="derby-4833-2a-updatelocks_disable_autostats.diff" size="1549" author="kristwaa" created="Fri, 10 Dec 2010 16:45:17 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12476688">DERBY-4834</subtask>
                            <subtask id="12476751">DERBY-4837</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 13 Dec 2010 10:50:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31400</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0fpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36364</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>