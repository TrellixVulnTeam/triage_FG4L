<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:20:56 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4982/DERBY-4982.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4982] Retrying after interrupts in store pops a bug in derbyall/storeall/storeunit/T_RawStoreFactory in some cases</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4982</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Cf Myrna&apos;s comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4741&quot; title=&quot;Make embedded Derby work reliably in the presence of thread interrupts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4741&quot;&gt;&lt;del&gt;DERBY-4741&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&quot;I think the latest check-in has caused the following tinderbox failure:&lt;/p&gt;

&lt;p&gt;derbyall/storeall/storeall.fail:unit/T_RawStoreFactory.unit&lt;/p&gt;

&lt;p&gt;see: &lt;a href=&quot;http://dbtg.foundry.sun.com/derby/test/tinderbox_trunk16/jvm1.6/testing/testlog/SunOS-5.10_i86pc-i386/1061516-derbyall_diff.txt:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://dbtg.foundry.sun.com/derby/test/tinderbox_trunk16/jvm1.6/testing/testlog/SunOS-5.10_i86pc-i386/1061516-derbyall_diff.txt:&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;
			&lt;ul&gt;
				&lt;li&gt;
				&lt;ul&gt;
					&lt;li&gt;
					&lt;ul&gt;
						&lt;li&gt;
						&lt;ul&gt;
							&lt;li&gt;
							&lt;ul&gt;
								&lt;li&gt;
								&lt;ul&gt;
									&lt;li&gt;Diff file derbyall/storeall/storeunit/T_RawStoreFactory.diff&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
			&lt;li&gt;Start: T_RawStoreFactory jdk1.6.0_18 storeall:storeunit 2011-01-20 23:22:23 ***&lt;br/&gt;
2 del&lt;br/&gt;
&amp;lt; &amp;#8211; Unit Test T_RawStoreFactory finished&lt;br/&gt;
2 add&lt;br/&gt;
&amp;gt; ran out of time&lt;br/&gt;
&amp;gt; Exit due to time bomb&lt;br/&gt;
Test Failed.&lt;/li&gt;
			&lt;li&gt;End: T_RawStoreFactory jdk1.6.0_18 storeall:storeunit 2011-01-21 00:22:54 ***&lt;br/&gt;
&quot;&lt;br/&gt;
It failed in the nightly runs with ibm 1.6 also (and 1.4.2 and 1.5). &lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12496358">DERBY-4982</key>
            <summary>Retrying after interrupts in store pops a bug in derbyall/storeall/storeunit/T_RawStoreFactory in some cases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 Jan 2011 02:04:13 +0000</created>
                <updated>Mon, 17 Jun 2013 10:19:16 +0100</updated>
                            <resolved>Thu, 27 Jan 2011 02:15:56 +0000</resolved>
                                    <version>10.8.1.2</version>
                                    <fixVersion>10.8.1.2</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12986207" author="dagw" created="Tue, 25 Jan 2011 04:05:40 +0000"  >&lt;p&gt;This error is due to the way the method T_Unit#checkGetLatchedPage works. This method calls into the internal Derby Page classes to test latching of pages. The structure of this test code mirrors how the code in BasePage#setExclusive works in the following scenario:&lt;/p&gt;

&lt;p&gt;The Derby store code is wrong internally somehow, so an attempt is made to grab the same latch twice. This condition is tested for by checkGetLatchedPage and it treats it differently in sane and insane mode as does store. BasePage#setExclusive does the following:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;in sane mode,  an assert error is thrown&lt;/li&gt;
	&lt;li&gt;in insane mode, the code will do a wait on the monitor and rely on lock time-out to break the stalemate (waiting for itself...)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Now, the test  T_RawStoreFactory#P024 calls T_Unit#checkGetLatchedPage. The latter &quot;knows&quot; that in insane mode, a hang can be expected when it tries&lt;br/&gt;
to acquire a lack for the second time, so to get out of this, it fires off a thread which will shoot down the hanging user thread with an interrupt, so as to get control back: 08000 is expected. &lt;/p&gt;

&lt;p&gt;With the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4741&quot; title=&quot;Make embedded Derby work reliably in the presence of thread interrupts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4741&quot;&gt;&lt;del&gt;DERBY-4741&lt;/del&gt;&lt;/a&gt;, interrupting the test thread no longer works, since  the wait in setExclusive just retries. This means that in insane mode, the tests hangs until the harness&apos; time bomb goes off. I ran my regression tests in sane mode, which wasn&apos;t affected by this logic, and was thus blind-sided.&lt;/p&gt;</comment>
                            <comment id="12986221" author="dagw" created="Tue, 25 Jan 2011 04:52:36 +0000"  >&lt;p&gt;Uploading a patch which makes store throw a session level exception (the cleanup will possibly release the latch if held by this transaction, not sure) for both sane and insane, instead of assert for sane, and in stead of waiting eternally fo insane,  In stead of 08000, I made a new error, DATA_DOUBLE_LATCH_INTERNAL_ERROR for this situation.I chose not to make it database level since the the thread is only dead-locked with itself and we have no sign that the database is compromised. Maybe it is overkill to make a new error for this internal error which is not expected to happen, but according to Knut, waiting for lock timeout is no longer an option: we get an eternal hang. Opinions are welcome as always.&lt;/p&gt;

&lt;p&gt;The test code has been adjusted accordingly.&lt;/p&gt;

&lt;p&gt;Running regressions.&lt;/p&gt;</comment>
                            <comment id="12986295" author="knutanders" created="Tue, 25 Jan 2011 09:39:14 +0000"  >&lt;p&gt;I think failing in both sane and insane is fine when we attempt to double-latch a page. That&apos;s what this code did before &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2107&quot; title=&quot;Move page latching out of the lock manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2107&quot;&gt;&lt;del&gt;DERBY-2107&lt;/del&gt;&lt;/a&gt;, only difference was that it would be a deadlock exception from the lock manager after a 20 second delay. This should never happen unless we have a bug somewhere, so what we chose to do is mainly a question about how keep the internal API testable. And if we should have a bug that causes double-latching, a message telling that that&apos;s what happened is probably more helpful than a hang.&lt;/p&gt;

&lt;p&gt;The comment in BasePage.setExclusive() doesn&apos;t say that this is an attempt to double-latch a page anymore. Perhaps expand on the comment to make it clearer why we error out?&lt;/p&gt;

&lt;p&gt;The new message takes a parameter, but no value is provided in the call to newException().&lt;/p&gt;</comment>
                            <comment id="12986629" author="dagw" created="Tue, 25 Jan 2011 19:28:05 +0000"  >&lt;p&gt;Thanks, Knut.&lt;br/&gt;
Regressions rans fine in insane mode. I&apos;ll expand on the comment and fix the error parameter.&lt;/p&gt;</comment>
                            <comment id="12986677" author="dagw" created="Tue, 25 Jan 2011 20:39:07 +0000"  >&lt;p&gt;Uploading revision &quot;b&quot;, which adds a more verbose comment, and inserts the &lt;br/&gt;
missing parameter. I reran storeunit, ok.&lt;/p&gt;</comment>
                            <comment id="12986697" author="knutanders" created="Tue, 25 Jan 2011 21:33:37 +0000"  >&lt;p&gt;Thanks, Dag! The &quot;b&quot; patch looks good. +1&lt;/p&gt;</comment>
                            <comment id="12986735" author="dagw" created="Tue, 25 Jan 2011 22:47:12 +0000"  >&lt;p&gt;Uploading patch &quot;c&quot; which fixes a bad cut &amp;amp; paste job: the type of message argument is wrong in messages.xml.&lt;/p&gt;</comment>
                            <comment id="12987355" author="dagw" created="Thu, 27 Jan 2011 02:15:56 +0000"  >&lt;p&gt;Committed as svn 1063960, resolving.  storeall should now we back in shape in the dailies.&lt;/p&gt;</comment>
                            <comment id="13685183" author="knutanders" created="Mon, 17 Jun 2013 10:19:16 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12469090">DERBY-4741</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12469237" name="derby-4982.diff" size="3935" author="dagw" created="Tue, 25 Jan 2011 04:52:36 +0000"/>
                            <attachment id="12469238" name="derby-4982.stat" size="273" author="dagw" created="Tue, 25 Jan 2011 04:52:36 +0000"/>
                            <attachment id="12469330" name="derby-4982b.diff" size="4311" author="dagw" created="Tue, 25 Jan 2011 20:39:07 +0000"/>
                            <attachment id="12469331" name="derby-4982b.stat" size="273" author="dagw" created="Tue, 25 Jan 2011 20:39:07 +0000"/>
                            <attachment id="12469350" name="derby-4982c.diff" size="4312" author="dagw" created="Tue, 25 Jan 2011 22:47:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 25 Jan 2011 09:39:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24572</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0gjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36500</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>