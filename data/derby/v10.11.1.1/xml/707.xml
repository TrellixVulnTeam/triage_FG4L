<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:53:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-707/DERBY-707.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-707] providing RowLocation for deleted+purged row to GenericConglomerateController causes nullpointerexception</title>
                <link>https://issues.apache.org/jira/browse/DERBY-707</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;To provide scrollable updatable resultsets, we will store the RowLocation for every row in the ResultSet in a temporary table (backingstore hashtable).  The RowLocation is used to reposition the cursor before an update.&lt;/p&gt;

&lt;p&gt;The problem is when the row for the RowLocation has been deleted and purged by another transaction.  The update will then fail with a NullPointerException in GenericConglomerateController.replace(..):&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
        at org.apache.derby.impl.store.access.conglomerate.GenericConglomerateController.replace(GenericConglomerateController.java:465)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.RowChangerImpl.updateRow(RowChangerImpl.java:516)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.UpdateResultSet.collectAffectedRows(UpdateResultSet.java:577)&lt;br/&gt;
        at org.apache.derby.impl.sql.execute.UpdateResultSet.open(UpdateResultSet.java:276)&lt;br/&gt;
        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:368)&lt;br/&gt;
        at org.apache.derby.impl.jdbc.EmbedResultSet.updateRow(EmbedResultSet.java:3256) &lt;/p&gt;

&lt;p&gt;It fails when checking if the row has been deleted (not purged) , because pos.current_page is null:&lt;/p&gt;

&lt;p&gt;        if (pos.current_page.isDeletedAtSlot(pos.current_slot))&lt;/p&gt;
        {
            ret_val = false;
        }


&lt;p&gt;The proposed fix is to use the return value from open_conglom.latchPage(..).  If it returns false, the RowLocation is invalid (deleted+purged). &lt;/p&gt;</description>
                <environment>Java 1.4</environment>
        <key id="12325671">DERBY-707</key>
            <summary>providing RowLocation for deleted+purged row to GenericConglomerateController causes nullpointerexception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="andreask">Andreas Korneliussen</assignee>
                                    <reporter username="andreask">Andreas Korneliussen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Nov 2005 22:24:11 +0000</created>
                <updated>Thu, 17 Nov 2005 21:50:55 +0000</updated>
                            <resolved>Thu, 17 Nov 2005 21:46:48 +0000</resolved>
                                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12357711" author="andreask" created="Wed, 16 Nov 2005 01:57:41 +0000"  >&lt;p&gt;The attached files addresses this issue by checking the return value from open_conglom.latchPage(..) in GenericConglomerateController. Previously the return value has only been used in one of the four calls to open_conglom.latchPage(..) in this file, the patch also does the same for all three other places this is called (fetch, delete and replace).&lt;br/&gt;
Please review if this could be an appropriate patch for the problem reported. &lt;/p&gt;</comment>
                            <comment id="12357787" author="andreask" created="Wed, 16 Nov 2005 23:54:27 +0000"  >&lt;p&gt;The patch has been updated with testing. The test T_AccessFactory.readUncommitted previously tested one of the fetch(..) methods using a RowLocation for a row which does not exist, and for a RowLocation for a row where the page does not exist.  The test was extended to also test the overloaded fetch(..) and delete(..) and replace(..) methods.&lt;/p&gt;</comment>
                            <comment id="12357883" author="andreask" created="Thu, 17 Nov 2005 21:50:55 +0000"  >&lt;p&gt;Fix has been committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12320727" name="DERBY-707.diff" size="4972" author="andreask" created="Wed, 16 Nov 2005 23:54:27 +0000"/>
                            <attachment id="12320728" name="DERBY-707.stat" size="183" author="andreask" created="Wed, 16 Nov 2005 23:54:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22102</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy17jz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40874</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>