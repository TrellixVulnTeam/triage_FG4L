<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:54:32 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3306/DERBY-3306.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3306] jdbc4.StatementEventsTest cannot be run individually in a clean environment</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3306</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;jdbc4.StatementEventsTest cannot be run individually in a clean environment because the test database is not created if it does not exist.&lt;/p&gt;

&lt;p&gt;Excerpt of output from JUnit:&lt;br/&gt;
32) testErrorEventOnClosedConnection_pooled_prepared(org.apache.derbyTesting.functionTests.tests.jdbc4.StatementEventsTest)java.sql.SQLNonTransientConnectionException: The connection was refused because the database wombat was not found.&lt;br/&gt;
        at org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)&lt;br/&gt;
        at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:362)&lt;br/&gt;
        at org.apache.derby.client.ClientPooledConnection.&amp;lt;init&amp;gt;(ClientPooledConnection.java:89)&lt;br/&gt;
        at org.apache.derby.client.ClientPooledConnection40.&amp;lt;init&amp;gt;(ClientPooledConnection40.java:47)&lt;br/&gt;
        at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl40.newClientPooledConnection(ClientJDBCObjectFactoryImpl40.java:73)&lt;br/&gt;
        at org.apache.derby.jdbc.ClientConnectionPoolDataSource.getPooledConnectionX(ClientConnectionPoolDataSource.java:100)&lt;br/&gt;
        at org.apache.derby.jdbc.ClientConnectionPoolDataSource.getPooledConnection(ClientConnectionPoolDataSource.java:63)&lt;br/&gt;
        at org.apache.derbyTesting.functionTests.tests.jdbc4.StatementEventsTest.setUp(StatementEventsTest.java:125)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:96)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)&lt;br/&gt;
        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)&lt;br/&gt;
        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)&lt;br/&gt;
        at junit.extensions.TestSetup.run(TestSetup.java:25)&lt;br/&gt;
Caused by: org.apache.derby.client.am.DisconnectException: The connection was refused because the database wombat was not found.&lt;br/&gt;
        at org.apache.derby.client.net.NetConnectionReply.parseRDBNFNRM(NetConnectionReply.java:1022)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(NetConnectionReply.java:448)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(NetConnectionReply.java:306)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(NetConnectionReply.java:133)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(NetConnection.java:887)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(NetConnection.java:799)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnection.flowUSRIDPWDconnect(NetConnection.java:620)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnection.flowConnect(NetConnection.java:435)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnection.initialize(NetConnection.java:296)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnection.&amp;lt;init&amp;gt;(NetConnection.java:280)&lt;br/&gt;
        at org.apache.derby.client.net.NetConnection40.&amp;lt;init&amp;gt;(NetConnection40.java:125)&lt;br/&gt;
        at org.apache.derby.client.net.ClientJDBCObjectFactoryImpl40.newNetConnection(ClientJDBCObjectFactoryImpl40.java:260)&lt;br/&gt;
        at org.apache.derby.client.ClientPooledConnection.&amp;lt;init&amp;gt;(ClientPooledConnection.java:75)&lt;br/&gt;
        ... 29 more&lt;/p&gt;

&lt;p&gt;FAILURES!!!&lt;br/&gt;
Tests run: 32,  Failures: 0,  Errors: 32&lt;/p&gt;</description>
                <environment></environment>
        <key id="12385849">DERBY-3306</key>
            <summary>jdbc4.StatementEventsTest cannot be run individually in a clean environment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kristwaa">Kristian Waagan</assignee>
                                    <reporter username="kristwaa">Kristian Waagan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Jan 2008 10:45:14 +0000</created>
                <updated>Fri, 29 Feb 2008 13:53:55 +0000</updated>
                            <resolved>Thu, 21 Feb 2008 17:54:45 +0000</resolved>
                                    <version>10.4.1.3</version>
                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12565684" author="kristwaa" created="Tue, 5 Feb 2008 10:19:18 +0000"  >&lt;p&gt;&apos;derby-3306-1a-create_db_by_default.diff&apos; is a suggestion for how the problem can be solved.&lt;br/&gt;
The data sources will now by default have the createDatabase property set to &apos;create&apos;, and a database will be created if it does not exist. This is in line with how TestConfiguration.openDefaultConnection behaves.&lt;/p&gt;

&lt;p&gt;I have verified that jdbc4.StatementEventsTest can be run individually with the patch applied, and now I&apos;m running the regression tests to ensure the patch does not break any other test.&lt;br/&gt;
One thing that can cause problems, is if a data source is used to test what happens when you try to connect to a non-existing databases. If there are such tests, these have to explicitly (un)set createDatabase.&lt;/p&gt;

&lt;p&gt;Note that the patch will affect both JDBCDataSource and J2EEDataSource.&lt;/p&gt;

&lt;p&gt;Patch ready for comments / review.&lt;/p&gt;</comment>
                            <comment id="12565772" author="kristwaa" created="Tue, 5 Feb 2008 15:24:33 +0000"  >&lt;p&gt;&apos;derby-3306-errors_with_patch_1a.txt&apos; contains the errors I got when running suites.All with patch 1a.&lt;br/&gt;
The only ones I couldn&apos;t easily fix right away was the failing tests in jdbcapi.DboPowersTest (and I haven&apos;t look at the upgrade test yet).&lt;br/&gt;
There were 7 failures and 8 errors out of 10063 tests, and the following tests were affected:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;upgradeTests.???&lt;/li&gt;
	&lt;li&gt;lang.DatabaseClassLoadingTest (fixed)&lt;/li&gt;
	&lt;li&gt;jdbcapi.PoolXADSCreateShutdownDBTest (fixed)&lt;/li&gt;
	&lt;li&gt;jdbcapi.DataSourceTest (fixed)&lt;/li&gt;
	&lt;li&gt;jdbcapi.DboPowersTest&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I will have another look tomorrow, and see if I can make a patch that makes suites.All run without errors. If so, I would appreciate if people could take a look at that patch (and patch 1a) to verify that the changes I do are valid.&lt;br/&gt;
There might be better ways of handling the overall issue, so I&apos;m open for suggestions.&lt;/p&gt;</comment>
                            <comment id="12565773" author="kristwaa" created="Tue, 5 Feb 2008 15:25:09 +0000"  >&lt;p&gt;Removing patch available until I have a patch that makes all the errors go away.&lt;/p&gt;</comment>
                            <comment id="12566165" author="kristwaa" created="Wed, 6 Feb 2008 15:50:00 +0000"  >&lt;p&gt;&apos;derby-3306-1b-create_db_by_default_and_test_fixes.diff&apos; contains the same change as in version 1a and in addition the changes that were required to get the tests to run without failures.&lt;/p&gt;

&lt;p&gt;I ran all the tests individually without errors, and I&apos;m now running suites.All to confirm. Will post the results tomorrow.&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12566499" author="kristwaa" created="Thu, 7 Feb 2008 08:40:49 +0000"  >&lt;p&gt;suites.All ran without errors (Sun JDK 1.4, 1.5 and 1.6) with patch 1b.&lt;/p&gt;</comment>
                            <comment id="12567617" author="kristwaa" created="Mon, 11 Feb 2008 12:48:33 +0000"  >&lt;p&gt;&apos;derby-3306-1c-create_db_by_default_and_test_fixes.diff&apos; is a refreshed patch.&lt;br/&gt;
Version 1b failed to apply cleanly due to other, unrelated changes in DataSourceTest.&lt;/p&gt;

&lt;p&gt;The changes made to the tests fell into one of the following categories:&lt;br/&gt;
 a) creating connections to non-existing databases&lt;br/&gt;
 b) asserting no warnings (got warning about connection to existing database)&lt;br/&gt;
 c) using connection attributes conflicting with creating a new database&lt;/p&gt;

&lt;p&gt;I haven&apos;t received any negative feedback on the patch, so I&apos;m committing it.&lt;br/&gt;
Note that when the patch is committed, connections created from data sources obtained through the JUnit *DataSource utility classes will have the createDatabase property set to &quot;create&quot; by default.&lt;/p&gt;</comment>
                            <comment id="12567623" author="kristwaa" created="Mon, 11 Feb 2008 13:03:23 +0000"  >&lt;p&gt;Committed &apos;derby-3306-1c-create_db_by_default_and_test_fixes.diff&apos; to trunk with revision 620480.&lt;br/&gt;
Awaiting tinderbox test confirmation for a clean test run.&lt;/p&gt;</comment>
                            <comment id="12568260" author="kristwaa" created="Tue, 12 Feb 2008 18:04:50 +0000"  >&lt;p&gt;tinderbox completed without errors. Closing issue.&lt;/p&gt;</comment>
                            <comment id="12569030" author="mikem" created="Thu, 14 Feb 2008 18:09:50 +0000"  >&lt;p&gt;I believe the checking on 2/11 for this issue is causing the failures in the junit tests reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3412&quot; title=&quot;junit regression test failure on j2me  in testForwardOnlyNegative(org.apache.derbyTesting.functionTests.tests.lang.ScrollCursors2Test)junit.framework.AssertionFailedError&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3412&quot;&gt;&lt;del&gt;DERBY-3412&lt;/del&gt;&lt;/a&gt;.  I don&apos;t know why these failures seem to be JVM specific.&lt;/p&gt;</comment>
                            <comment id="12570605" author="kristwaa" created="Wed, 20 Feb 2008 08:51:37 +0000"  >&lt;p&gt;Reopening to back out what I believe was an inappropriate change (&apos;derby-3306-1c-create_db_by_default_and_test_fixes.diff &apos;, revision 620480).&lt;br/&gt;
This commit caused a test regression on the J2ME platform, and it also brings along some unneeded complexity in the JUnit framework.&lt;br/&gt;
The commit was done on the false assumption that there were many tests that had the same problem as jdbc4.StatementEventsTest, but after writing a script to run every test individually I found out that test is the only one.&lt;/p&gt;

&lt;p&gt;Since the commit cannot be backed out cleanly (a test has been split into two files), I will attach a patch that backs out the changes, fixes the jdbc4.StatementEventsTest and resolves the test regression logged as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3412&quot; title=&quot;junit regression test failure on j2me  in testForwardOnlyNegative(org.apache.derbyTesting.functionTests.tests.lang.ScrollCursors2Test)junit.framework.AssertionFailedError&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3412&quot;&gt;&lt;del&gt;DERBY-3412&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12570607" author="kristwaa" created="Wed, 20 Feb 2008 08:55:26 +0000"  >&lt;p&gt;Regarding Mikes comment on the 14th of February:&lt;br/&gt;
The failures are only indirectly JVM specific, as you will only see the failures when the connections are obtained through a DataSource.&lt;br/&gt;
Since the J2ME platform doesn&apos;t support DriverManager, a DataSource is used.&lt;/p&gt;</comment>
                            <comment id="12570616" author="kristwaa" created="Wed, 20 Feb 2008 09:03:42 +0000"  >&lt;p&gt;&apos;derby-3306-2a-backout_and_alternative_fix.diff&apos; backs out the 1c patch  (unclean merge, needed trivial tweaking) and implements a simpler alternative fix.&lt;/p&gt;

&lt;p&gt;Patch ready for review.&lt;/p&gt;</comment>
                            <comment id="12571119" author="kristwaa" created="Thu, 21 Feb 2008 17:54:45 +0000"  >&lt;p&gt;Committed &apos;derby-3306-2a-backout_and_alternative_fix.diff&apos; to trunk with revision 629894.&lt;br/&gt;
Hopefully the fix is sound this time...&lt;/p&gt;

&lt;p&gt;I also expect this commit to fix the test regression filed under &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3412&quot; title=&quot;junit regression test failure on j2me  in testForwardOnlyNegative(org.apache.derbyTesting.functionTests.tests.lang.ScrollCursors2Test)junit.framework.AssertionFailedError&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3412&quot;&gt;&lt;del&gt;DERBY-3412&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12573744" author="kristwaa" created="Fri, 29 Feb 2008 13:53:55 +0000"  >&lt;p&gt;Problems fixed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12388499">DERBY-3412</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12374752" name="derby-3306-1a-create_db_by_default.diff" size="2260" author="kristwaa" created="Tue, 5 Feb 2008 10:19:18 +0000"/>
                            <attachment id="12374876" name="derby-3306-1b-create_db_by_default_and_test_fixes.diff" size="7889" author="kristwaa" created="Wed, 6 Feb 2008 15:50:00 +0000"/>
                            <attachment id="12374877" name="derby-3306-1b-create_db_by_default_and_test_fixes.stat" size="553" author="kristwaa" created="Wed, 6 Feb 2008 15:50:00 +0000"/>
                            <attachment id="12375226" name="derby-3306-1c-create_db_by_default_and_test_fixes.diff" size="7487" author="kristwaa" created="Mon, 11 Feb 2008 12:48:33 +0000"/>
                            <attachment id="12376002" name="derby-3306-2a-backout_and_alternative_fix.diff" size="9000" author="kristwaa" created="Wed, 20 Feb 2008 09:03:42 +0000"/>
                            <attachment id="12374777" name="derby-3306-errors_with_patch_1a.txt" size="46484" author="kristwaa" created="Tue, 5 Feb 2008 15:24:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 14 Feb 2008 18:09:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23561</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0z9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39532</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>