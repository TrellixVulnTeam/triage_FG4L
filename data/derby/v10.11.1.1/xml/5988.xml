<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:07:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5988/DERBY-5988.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5988] Instability in DataSourceTest: some test fixture orderings makes test_jdbc4_1 fail</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5988</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If this test fixture is executed before the driver is loaded the first time, a call to EmbeddedDataSource40.getParentLogger will fail with this symptom:&lt;/p&gt;

&lt;p&gt;org.apache.derby.impl.jdbc.EmbedSQLException cannot be cast to java.sql.SQLFeatureNotSupportedException&lt;/p&gt;

&lt;p&gt;at org.apache.derby.jdbc.EmbeddedDataSource40.getParentLogger(EmbeddedDataSource40.java:193)&lt;br/&gt;
at org.apache.derbyTesting.functionTests.tests.jdbc4.Wrapper41DataSource.getParentLogger(Wrapper41DataSource.java:81)&lt;br/&gt;
at org.apache.derbyTesting.functionTests.tests.jdbc4.DataSourceTest.vetDSjdbc4_1(DataSourceTest.java:318)&lt;br/&gt;
at org.apache.derbyTesting.functionTests.tests.jdbc4.DataSourceTest.test_jdbc4_1(DataSourceTest.java:307)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)&lt;br/&gt;
at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBareOverridable(BaseJDBCTestCase.java:424)&lt;br/&gt;
at org.apache.derbyTesting.junit.BaseJDBCTestCase.runBare(BaseJDBCTestCase.java:441)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12615666">DERBY-5988</key>
            <summary>Instability in DataSourceTest: some test fixture orderings makes test_jdbc4_1 fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                            <label>derby_triage10_11</label>
                    </labels>
                <created>Sun, 11 Nov 2012 23:00:58 +0000</created>
                <updated>Thu, 20 Jun 2013 20:54:09 +0100</updated>
                                                                            <component>JDBC</component>
                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13495031" author="dagw" created="Sun, 11 Nov 2012 23:03:15 +0000"  >&lt;p&gt;Attaching DataSourceTest as repro: this version only adds the fixture in question to show the issue.&lt;/p&gt;</comment>
                            <comment id="13495038" author="dagw" created="Sun, 11 Nov 2012 23:16:21 +0000"  >&lt;p&gt;The problem seems to be that the call to EmbeddedDataSource40#getParentLogger tries to raise an &lt;/p&gt;

&lt;p&gt;   throw (SQLFeatureNotSupportedException) Util.notImplemented( &quot;getParentLogger()&quot; );&lt;/p&gt;

&lt;p&gt;However, at this point in time the Util has the wrong version (pre-Java 6) of the exception factory, which leads to the SQLException object being created as a plain SQLException instance, whereas it should be created as a SQLFeatureNotSupportedException.&lt;br/&gt;
By default the exception factory used by Util#newEmbedSQLException is initialized to &lt;/p&gt;

&lt;p&gt;    SQLExceptionFactory.&lt;/p&gt;

&lt;p&gt;When Driver40 is loaded, Driver40#boot calls &lt;/p&gt;

&lt;p&gt;   Util.setExceptionFactory (new SQLExceptionFactory40 ());&lt;/p&gt;

&lt;p&gt;however, in our case, this has not yet happened, so instead of producing an exception with SQLExceptionFactory40, we erroneously employ SQLExceptionFactory, leading to missing use of SQLFeatureNotSupportedException.&lt;/p&gt;

&lt;p&gt;I guess calling EmbeddedDataSource40#getParentLogger before trying to get a connection (which would make the correct driver and and hence exception factory load) is not a common use case, but I think this is still a product error, so I mark it as such for now.&lt;/p&gt;

&lt;p&gt;The user would possibly expect an SQLException but not a java.lang.ClassCastException,&lt;/p&gt;
</comment>
                            <comment id="13495041" author="dagw" created="Sun, 11 Nov 2012 23:21:40 +0000"  >&lt;p&gt;Btw, I saw this using Java 7; we have automatic fixture ordering based on class introspection will vary then.&lt;/p&gt;</comment>
                            <comment id="13495054" author="dagw" created="Mon, 12 Nov 2012 00:16:25 +0000"  >&lt;p&gt;Note: The repro shows this using the embedded driver, but I actually only saw this in the original test suite for the client driver, probably because the embedded driver is &lt;b&gt;always&lt;/b&gt; loaded as part of the call to CleanDatabaseTestSetup used by defaultSuite. In the repro I don&apos;t do that so the error also manifests for embedded driver.&lt;/p&gt;</comment>
                            <comment id="13495055" author="dagw" created="Mon, 12 Nov 2012 00:40:02 +0000"  >&lt;p&gt;For client, the corresponding issue happens not in Util, but rather in org.apache.derby.client.am.SqlException#exceptionFactory: the call org.apache.derby.client.am.SqlException#setExceptionFactory is missing unless we load the client driver cf this call in ClinetDriver:&lt;/p&gt;

&lt;p&gt;conn = (org.apache.derby.client.net.NetConnection)getFactory().&lt;br/&gt;
                    newNetConnection((org.apache.derby.client.net.NetLogWriter) &lt;br/&gt;
                    dncLogWriter,&lt;br/&gt;
                    java.sql.DriverManager.getLoginTimeout(),&lt;br/&gt;
                    server,&lt;br/&gt;
                    port,&lt;br/&gt;
                    database,&lt;br/&gt;
                    augmentedProperties);&lt;/p&gt;

&lt;p&gt;Note the call to &quot;getFactory&quot; here, which makes sure the right factory is initialized, cf. ClientDriver#createJDBC40FactoryImpl called from getFactory.&lt;/p&gt;

&lt;p&gt;So, the same problem is present for both drivers.&lt;/p&gt;</comment>
                            <comment id="13542012" author="dagw" created="Wed, 2 Jan 2013 05:47:16 +0000"  >&lt;p&gt;Committed a symptom fix patch &quot;derby-5988&quot; at svn 1427660 to make ordering fixed for now to avoid intermittent errors.&lt;/p&gt;


</comment>
                            <comment id="13679432" author="knutanders" created="Mon, 10 Jun 2013 12:12:22 +0100"  >&lt;p&gt;The client-side part of this problem seems to have been fixed by the changes that went in as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6213&quot; title=&quot;Deprecate support for Java 5 and CDC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6213&quot;&gt;&lt;del&gt;DERBY-6213&lt;/del&gt;&lt;/a&gt;. I believe &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6253&quot; title=&quot;Collapse SQLException factories&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6253&quot;&gt;&lt;del&gt;DERBY-6253&lt;/del&gt;&lt;/a&gt; will fix it on the embedded side.&lt;/p&gt;</comment>
                            <comment id="13689569" author="rhillegas" created="Thu, 20 Jun 2013 20:54:09 +0100"  >&lt;p&gt;Has this bug been fixed now?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12646087">DERBY-6213</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12651646">DERBY-6253</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12553055" name="DataSourceTest.java" size="11503" author="dagw" created="Sun, 11 Nov 2012 23:03:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10367"><![CDATA[Deviation from standard]]></customfieldvalue>
    <customfieldvalue key="10369"><![CDATA[Regression Test Failure]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 10 Jun 2013 11:12:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256967</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hycvmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>109100</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>