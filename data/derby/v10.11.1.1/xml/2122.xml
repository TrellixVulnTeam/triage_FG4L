<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:45:45 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2122/DERBY-2122.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2122] Optimize ContainerLock.isCompatible()</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2122</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The numbers at &lt;a href=&quot;http://wiki.apache.org/db-derby/Derby1961MethodCalls&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/Derby1961MethodCalls&lt;/a&gt; indicate that ContainerLock.isCompatible() is called many times per transaction, at least when there are multiple concurrent clients operating on the same containers. Currently, it looks into a two-dimensional array to find out whether two locks are compatible. This could be implemented more efficiently, for instance by having a bit pattern in each ContainerLock object representing which lock types it is compatible with.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12357168">DERBY-2122</key>
            <summary>Optimize ContainerLock.isCompatible()</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Nov 2006 18:53:57 +0000</created>
                <updated>Mon, 29 Jun 2009 15:22:08 +0100</updated>
                            <resolved>Fri, 1 Dec 2006 08:17:31 +0000</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12454086" author="knutanders" created="Tue, 28 Nov 2006 19:27:57 +0000"  >&lt;p&gt;The attached patch removes the compatibility matrix from ContainerLock and instead maintains a bit mask containing the type ids of the compatible lock types. Compatibility checking between two lock types could therefore be performed by a bitwise and of the the bit mask and the type id.&lt;/p&gt;

&lt;p&gt;Similar changes were made to RowLock to keep the two classes consistent.&lt;/p&gt;

&lt;p&gt;I have run some experiments with this patch and the test client from &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1961&quot; title=&quot;Investigate resource usage for different types of load on an in-memory database&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1961&quot;&gt;&lt;del&gt;DERBY-1961&lt;/del&gt;&lt;/a&gt; (single-record selects with 16 concurrent clients on embedded Derby).&lt;/p&gt;

&lt;p&gt;Experiment 1: 40 runs (20 with clean trunk, 20 with patch for ContainerLock only) consisting of 30 seconds warm-up and 60 seconds counting transactions. Result: Average throughput increased by 1.2% with the patch.&lt;/p&gt;

&lt;p&gt;Experiment 2: Same as above, but counting transactions for 100 seconds instead of 60 seconds. Result: Average throughput increased by 1.7% with the patch.&lt;/p&gt;

&lt;p&gt;Experiment 3: Same as above, but with the full patch (that is, both ContainerLock and RowLock changed). Result: Average throughput increased by 1.9% with the patch.&lt;/p&gt;

&lt;p&gt;I don&apos;t have a fancy script that calculates how significant these numbers are (can do it on request, since I really need to refresh my statistics skills), but they at least give an indication that the patch has a small positive impact.&lt;/p&gt;

&lt;p&gt;Reviews would be appreciated. Thanks.&lt;/p&gt;</comment>
                            <comment id="12454087" author="knutanders" created="Tue, 28 Nov 2006 19:29:31 +0000"  >&lt;p&gt;Oh, I forgot... Derbyall and the JUnit tests ran cleanly.&lt;/p&gt;</comment>
                            <comment id="12454100" author="mikem" created="Tue, 28 Nov 2006 20:24:55 +0000"  >&lt;p&gt;I think you should add back some sort of compatibility &quot;table&quot; documentation.  It may just be me but I often refer to this &lt;br/&gt;
source code to figure out what locks are compatible with what.  Since the previous implementation had it as a 2-d array&lt;br/&gt;
with true/false I didn&apos;t need extra comments.  But I find it harder to read the code encoding into bit maps. I wouldn&apos;t hold&lt;br/&gt;
up a commit for this. &lt;/p&gt;

&lt;p&gt;I hand checked all the compatibility conversions and they all looked right.  &lt;/p&gt;</comment>
                            <comment id="12454117" author="knutanders" created="Tue, 28 Nov 2006 20:49:56 +0000"  >&lt;p&gt;Thanks Mike, that&apos;s a good point. Perhaps it would be even better if we left the 2-d arrays and built the bit masks from them at initialization time.&lt;/p&gt;</comment>
                            <comment id="12454317" author="knutanders" created="Wed, 29 Nov 2006 14:06:09 +0000"  >&lt;p&gt;New and simpler patch attached (v2). This patch keeps the compatibility arrays and builds bit masks from the arrays when the lock type objects are created. I had to move the definition of the compatibility arrays to make their values visible in the constructors (the constructors are called from static initializers, so the definition order of the static final variables matters).&lt;/p&gt;

&lt;p&gt;Derbyall and the JUnit tests ran cleanly. Please review.&lt;/p&gt;</comment>
                            <comment id="12454829" author="knutanders" created="Fri, 1 Dec 2006 08:17:31 +0000"  >&lt;p&gt;Committed v2 patch with revision 481181.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12345959" name="derby-2122-v1.diff" size="9999" author="knutanders" created="Tue, 28 Nov 2006 19:27:57 +0000"/>
                            <attachment id="12345960" name="derby-2122-v1.stat" size="272" author="knutanders" created="Tue, 28 Nov 2006 19:27:57 +0000"/>
                            <attachment id="12346027" name="derby-2122-v2.diff" size="6534" author="knutanders" created="Wed, 29 Nov 2006 14:06:09 +0000"/>
                            <attachment id="12346028" name="derby-2122-v2.stat" size="134" author="knutanders" created="Wed, 29 Nov 2006 14:06:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10362"><![CDATA[Performance]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 28 Nov 2006 20:24:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30284</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0wm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39102</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>