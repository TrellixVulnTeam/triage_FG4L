<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:46:09 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-137/DERBY-137.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-137] Derby metadata always returns JDBC 2 result sets, even when JDBC 3 result sets are required.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-137</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;BACKGROUND:&lt;/p&gt;

&lt;p&gt;Derby&apos;s implementation of the JDBC class java.sql.DatabaseMetaData returns result sets that are defined by the SQL queries in impl/jdbc/metadata.properties.&lt;/p&gt;

&lt;p&gt;PROBLEM:&lt;/p&gt;

&lt;p&gt;The current queries in the metadata.properties file are for JDBC 2 only.  The queries do NOT account for the result sets as defined by JDBC 3, and thus even when JDBC 3 result sets should be returned, a user will get metadata correlating to the JDBC 2 standard.&lt;/p&gt;

&lt;p&gt;Just for reference, here are a couple of examples of changes that have been made from JDBC 2 to JDBC 3:&lt;/p&gt;

&lt;p&gt;1) getColumns(): JDBC 2 specifies 18 columns, JDBC 3 specifies 22 (the four extra columns are SCOPE_CATALOG, SCOPE_SCHEMA, SCOPE_TABLE, and SOURCE_DATA_TYPE).&lt;/p&gt;

&lt;p&gt;2) getTables(): JDBC 2 specifics 5 columns, JDBC 3 specifies 10 (the five extra columns are TYPE_CAT, TYPE_SCHEM, TYPE_NAME, SELF_REFERENCING_COL_NAME, and REF_GENERATION).&lt;/p&gt;

&lt;p&gt;3) getProcedureColumns(): JDBC 2 specifies that DATA_TYPE is a &quot;short&quot;; JDBC 3 specifies that DATA_TYPE is an &quot;int&quot;.&lt;/p&gt;

&lt;p&gt;NOTES:&lt;/p&gt;

&lt;p&gt;JDBC 3 needs to be backward compatible with JDBC 2, so it should be okay to just modify metadata.properties to return JDBC 3 result sets...&lt;/p&gt;</description>
                <environment></environment>
        <key id="29871">DERBY-137</key>
            <summary>Derby metadata always returns JDBC 2 result sets, even when JDBC 3 result sets are required.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Feb 2005 06:12:15 +0000</created>
                <updated>Thu, 17 Nov 2011 13:51:51 +0000</updated>
                            <resolved>Wed, 28 Jun 2006 00:19:48 +0100</resolved>
                                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12416092" author="rhillegas" created="Wed, 14 Jun 2006 06:21:13 +0100"  >&lt;p&gt;Bumping the priority of this bug.&lt;/p&gt;</comment>
                            <comment id="12416518" author="knutanders" created="Fri, 16 Jun 2006 22:26:11 +0100"  >&lt;p&gt;I have (or more precisely, a test program of mine has) gone through all the DatabaseMetaData methods and compared them to the JDBC 4 spec. This is what I found:&lt;/p&gt;

&lt;p&gt;1) Columns are missing from getColumns(), getTables() and getUDTs().&lt;/p&gt;

&lt;p&gt;2) Some columns that the spec says should be &quot;int&quot; are returned as &quot;SMALLINT&quot;, and some columns that should be &quot;short&quot; are returned as &quot;INTEGER&quot;.&lt;/p&gt;

&lt;p&gt;What&apos;s the best solution for 2? Changing all queries so that short maps to SMALLINT and int to INTEGER? Or should we accept other types as long as they could contain all values of the specified type (that is, allow short to be returned as INTEGER, but not int as SMALLINT)?&lt;/p&gt;</comment>
                            <comment id="12417102" author="knutanders" created="Wed, 21 Jun 2006 21:12:21 +0100"  >&lt;p&gt;The attached patch changes the data types and adds missing columns so&lt;br/&gt;
that the result sets returned from DatabaseMetaData methods match the&lt;br/&gt;
latest revision of the JDBC 4.0 spec. Derbyall ran cleanly on Sun JVM&lt;br/&gt;
1.5.0/Solaris 10 x64.&lt;/p&gt;

&lt;p&gt;Summary of the changes:&lt;/p&gt;

&lt;p&gt;  DatabaseMetaData:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getProcedureColumns: modified VTI to return an int instead of a&lt;br/&gt;
      short for the DATA_TYPE column&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getTables: new columns: TYPE_CAT, TYPE_SCHEM, TYPE_NAME,&lt;br/&gt;
      SELF_REFERENCING_COL_NAME, REF_GENERATION (all null since Derby&lt;br/&gt;
      doesn&apos;t support typed tables)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getColumns: DATA_TYPE changed from SMALLINT to INTEGER. New&lt;br/&gt;
      columns: SCOPE_CATLOG, SCOPE_SCHEMA, SCOPE_TABLE,&lt;br/&gt;
      SOURCE_DATATYPE (all null since Derby doesn&apos;t support the REF or&lt;br/&gt;
      DISTINCT data types)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getVersionColumns: SCOPE, DECIMAL_DIGITS and PSEUDO_COLUMN&lt;br/&gt;
      changed from INTEGER to SMALLINT&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getPrimaryKeys: KEY_SEQ changed from INTEGER to SMALLINT&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getTypeInfo: DATA_TYPE, NULLABLE, SEARCHABLE, MINIMUM_SCALE and&lt;br/&gt;
      MAXIMUM_SCALE changed from SMALLINT to INTEGER. &lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getIndexInfo: ORDINAL_POSITION changed from INTEGER to SMALLINT&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getBestRowIdentifier: DATA_TYPE changed from SMALLINT to INTEGER&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getUDTs: new columm: BASE_TYPE (null since Derby doesn&apos;t support&lt;br/&gt;
      the DISTINCT type or SELF_REFERENCING_COLUMN)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  ODBCMetadataGenerator:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;cast DATA_TYPE columns to SMALLINT (as defined by ODBC)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  Tests:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;updated master files for metadata, odbc_metadata,&lt;br/&gt;
      bestrowidentifier, declareGlobalTempTableJava and&lt;br/&gt;
      Upgrade_10_1_10_2 (new columns and modified data types)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;odbc_metadata.java: added information about nullability for some&lt;br/&gt;
      of the new columns to avoid ArrayIndexOutOfBoundsException&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12417103" author="knutanders" created="Wed, 21 Jun 2006 21:13:53 +0100"  >&lt;p&gt;Patch is available and ready for review. Thanks!&lt;/p&gt;</comment>
                            <comment id="12417738" author="knutanders" created="Mon, 26 Jun 2006 15:08:46 +0100"  >&lt;p&gt;I plan to commit this patch tomorrow. If someone is planning to review, please let me know and I&apos;ll hold the commit. Thanks!&lt;/p&gt;</comment>
                            <comment id="12417835" author="army" created="Mon, 26 Jun 2006 23:57:57 +0100"  >&lt;p&gt;I hope to review these changes today (06/26 PST) and will post comments as appropriate.  Thanks for your patience...&lt;/p&gt;</comment>
                            <comment id="12417860" author="army" created="Tue, 27 Jun 2006 01:56:45 +0100"  >&lt;p&gt;Knut Anders Hatlen (JIRA) wrote:&lt;/p&gt;

&lt;p&gt;&amp;gt;     [ &lt;a href=&quot;http://issues.apache.org/jira/browse/DERBY-137?page=comments#action_12417738&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/DERBY-137?page=comments#action_12417738&lt;/a&gt; ] &lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Knut Anders Hatlen commented on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-137&quot; title=&quot;Derby metadata always returns JDBC 2 result sets, even when JDBC 3 result sets are required.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-137&quot;&gt;&lt;del&gt;DERBY-137&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
&amp;gt; ------------------------------------------&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; I plan to commit this patch tomorrow. If someone is planning to review, &lt;br/&gt;
&amp;gt; please let me know and I&apos;ll hold the commit. Thanks!&lt;/p&gt;

&lt;p&gt;Changes look good to me.  Thanks for outlining the changes in the above comment, and for taking care to preserve ODBC metadata compatibility.&lt;/p&gt;

&lt;p&gt;I have two very minor comments/questions, but I don&apos;t think either is important enough to block the commit of this patch; I&apos;m just wondering a couple of things...&lt;/p&gt;

&lt;p&gt;First:&lt;/p&gt;

&lt;p&gt;&amp;gt; - getVersionColumns: SCOPE, DECIMAL_DIGITS and PSEUDO_COLUMN&lt;br/&gt;
&amp;gt;      changed from INTEGER to SMALLINT &lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; - getPrimaryKeys: KEY_SEQ changed from INTEGER to SMALLINT &lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; - getIndexInfo: ORDINAL_POSITION changed from INTEGER to SMALLINT &lt;/p&gt;

&lt;p&gt;Are the casts to SMALLINT in ODBCMetadataGenerator for these columns still necessary, then?  I&apos;m not saying you have to remove the casts, but doing so would (slightly) simplify the ODBC-generated queries.  On the other hand, maybe it&apos;s safer to leave the casts in place--could perhaps play a role in soft-upgrade...?  I haven&apos;t looked at this very closely, but since it&apos;s not wrong to leave the casts in, and since there may be cases (w.r.t upgrade) where it&apos;s useful, I guess it&apos;s fine to leave the casts in.  Just thought I&apos;d mention it, though, &quot;for the record&quot;... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getTypeInfo: DATA_TYPE, NULLABLE, SEARCHABLE, MINIMUM_SCALE and&lt;br/&gt;
      MAXIMUM_SCALE changed from SMALLINT to INTEGER. &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;When I look at the SE v1.4.2 document, NULLABLE, SEARCHABLE, MINIMUM_SCALE and MAXIMUM_SCALE are still listed as &quot;short&quot; instead of &quot;integer&quot;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://java.sun.com/j2se/1.4.2/docs/api/java/sql/DatabaseMetaData.html#getTypeInfo(&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/j2se/1.4.2/docs/api/java/sql/DatabaseMetaData.html#getTypeInfo(&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;In your comment you noted that your changes are in accordance with the &quot;latest revision of the JDBC 4.0 spec&quot;--i.e. not JDBC 3, which is what the &quot;Summary&quot; field of this Jira issue says.  But theoretically JDBC 4 should be backward compatible with JDBC 3, so I guess this is okay...?&lt;/p&gt;

&lt;p&gt;But that said, I also noticed that the JDK 6 API (SE 6 b89 API) lists &quot;short&quot; instead of &quot;integer&quot;, as well:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://download.java.net/jdk6/doc/api/java/sql/DatabaseMetaData.html#getTypeInfo(&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.java.net/jdk6/doc/api/java/sql/DatabaseMetaData.html#getTypeInfo(&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;I&apos;m assuming that&apos;s just because those pages haven&apos;t been updated to reflect the latest JDBC 4 spec...?&lt;/p&gt;

&lt;p&gt;But again, these are minor nits--just looking for some clarification.  The changes look good to me and the master updates look to be complete.  Thanks again for being thorough, esp. w.r.t to ODBC.&lt;/p&gt;</comment>
                            <comment id="12417999" author="knutanders" created="Tue, 27 Jun 2006 18:25:01 +0100"  >&lt;p&gt;Thank you very much for reviewing, A B!&lt;/p&gt;

&lt;p&gt;You are right; NULLABLE, SEARCHABLE, MINIMUM_SCALE and MAXIMUM_SCALE&lt;br/&gt;
are still listed as short in the javadoc. I meant to say that they had&lt;br/&gt;
been changed from INT to SMALLINT in the queries (which is what the&lt;br/&gt;
patch actually did). This means the casts are not necessary for these&lt;br/&gt;
columns either in the ODBC queries.&lt;/p&gt;

&lt;p&gt;I don&apos;t think changing the ODBC rewriting should affect soft upgrade&lt;br/&gt;
in any way. Derby will read the new queries directly from&lt;br/&gt;
metadata.properties, and they don&apos;t require any 10.2 features that are&lt;br/&gt;
not available in soft-upgrade mode.&lt;/p&gt;

&lt;p&gt;I have attached a new patch (v2) which removes the unnecessary casts&lt;br/&gt;
to SMALLINT generated by the ODBC generator. With that change,&lt;br/&gt;
getPrimaryKeys() is ODBC compliant, so&lt;br/&gt;
SystemProcedures.SQLPRIMARYKEYS() now uses the JDBC query for ODBC&lt;br/&gt;
requests.&lt;/p&gt;

&lt;p&gt;Derbyall (including the upgrade test) still passes. Do you think these&lt;br/&gt;
changes are OK?&lt;/p&gt;</comment>
                            <comment id="12418050" author="army" created="Tue, 27 Jun 2006 23:35:06 +0100"  >&lt;p&gt;&amp;gt; Derbyall (including the upgrade test) still passes. Do you think these changes are OK?&lt;/p&gt;

&lt;p&gt;Yes, the latest patch looks good to me.  Thanks much for addressing my comments.&lt;/p&gt;

&lt;p&gt;+1 to commit.&lt;/p&gt;</comment>
                            <comment id="12418056" author="knutanders" created="Wed, 28 Jun 2006 00:19:48 +0100"  >&lt;p&gt;Thanks again for the quick review, A B! Committed v2 patch into trunk with revision 417497.&lt;/p&gt;</comment>
                            <comment id="12420380" author="army" created="Wed, 12 Jul 2006 01:53:01 +0100"  >&lt;p&gt;Fix contributed and committed by Knut, so I&apos;m closing the issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12529525">DERBY-5488</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12335712" name="derby-137-v1.diff" size="334882" author="knutanders" created="Wed, 21 Jun 2006 21:12:21 +0100"/>
                            <attachment id="12335713" name="derby-137-v1.stat" size="1334" author="knutanders" created="Wed, 21 Jun 2006 21:12:21 +0100"/>
                            <attachment id="12335986" name="derby-137-v2.diff" size="337815" author="knutanders" created="Tue, 27 Jun 2006 18:25:01 +0100"/>
                            <attachment id="12335987" name="derby-137-v2.stat" size="1400" author="knutanders" created="Tue, 27 Jun 2006 18:25:01 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 14 Jun 2006 05:21:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21790</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ekf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36178</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>