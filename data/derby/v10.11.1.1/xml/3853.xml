<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:30:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3853/DERBY-3853.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3853] Behaviour of setTypeMap() differs between embedded and client</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3853</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;On the embedded driver, Connection.setTypeMap() behaves like this (when the connection is not closed):&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if the map argument is null, throw an SQLException with SQLState XJ081&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if the map is not null and not empty, throw an SQLException with SQLState 0A000&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if the map is not null and empty, do nothing&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The behaviour on the client driver is this:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;always throw an SQLException with SQLState 0A000&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We should try to make the two drivers behave the same way when setTypeMap() is called. (This would also allow us to simplify some of the tests in J2EEDataSourceTest).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12403071">DERBY-3853</key>
            <summary>Behaviour of setTypeMap() differs between embedded and client</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yunlee">Yun Lee</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Aug 2008 15:20:49 +0100</created>
                <updated>Tue, 30 Jun 2009 17:06:45 +0100</updated>
                            <resolved>Sat, 11 Apr 2009 18:07:01 +0100</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12693529" author="yunlee" created="Sun, 29 Mar 2009 09:15:16 +0100"  >&lt;p&gt;I have changed the EmbedConnection.setTypeMap() to act as the same way of Connection. They all throw a &quot;0A000&quot; Exc\eption now. The new change aslo performs in the J2EEDataSourceTest.java.&lt;/p&gt;

&lt;p&gt;Please check it. Thanks!&lt;/p&gt;</comment>
                            <comment id="12693714" author="knutanders" created="Mon, 30 Mar 2009 11:18:03 +0100"  >&lt;p&gt;Thanks for the patch. With that solution some of the calls to setTypeMap() that used to succeed on the embedded driver will start throwing exceptions. This may break existing applications, so I think it&apos;s probably safer to make the changes on the client driver instead.&lt;/p&gt;

&lt;p&gt;Some minor comments about the test changes:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I don&apos;t think the calls to sqle.getNextException() are necessary when invoking assertSQLState(), since assertSQLState() is supposed to follow the exception chain until it finds a match&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Code like the example below should have a call to fail() at the end of the try block in order to detect if the code didn&apos;t throw any exception:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+        try &lt;/p&gt;
{
+            cs.execute();
+        }
&lt;p&gt; catch (SQLException sqle) &lt;/p&gt;
{
+            assertSQLState(&quot;0A000&quot;, sqle.getNextException());
+        }</comment>
                            <comment id="12694116" author="yunlee" created="Tue, 31 Mar 2009 14:46:45 +0100"  >&lt;p&gt;Knut, thanks for your comments.  I will turn back on weekend to provide new patch adopting your advice,&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12697042" author="yunlee" created="Wed, 8 Apr 2009 15:42:12 +0100"  >&lt;p&gt;Knut, I have provided a new patch with changes:&lt;/p&gt;

&lt;p&gt;1.) make the changes on the client driver instead of on EmbedConnection;&lt;br/&gt;
2.) remove sqle.getNextException() when invoking assertSQLState();&lt;br/&gt;
3.) add fail() at the end of the try block in many places.&lt;/p&gt;

&lt;p&gt;However,  I think it&apos;s the same safe to make change on EmbedConneciton with on client driver, as whatever, the test data ----EmptyMapValue, NullMapValue and MapMapValue ---- for testAllDataSource() has changed, &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;Wish for your check!&lt;/p&gt;

&lt;p&gt;Also, I&apos;m a bit strange to have found the source code of Derby doesn&apos;t follow a uniform style, such as &apos;=&apos; accompanied by space characters, and the indent for curly braces. Aren&apos;t they?&lt;/p&gt;

&lt;p&gt;Yun&lt;/p&gt;</comment>
                            <comment id="12697807" author="knutanders" created="Fri, 10 Apr 2009 14:55:23 +0100"  >&lt;p&gt;Hi Yun,&lt;/p&gt;

&lt;p&gt;Thanks for the new patch! It looks good to me. I&apos;ll run some tests and commit it if I don&apos;t find any problems.&lt;/p&gt;

&lt;p&gt;The reason why I felt it was safer to make the changes on the client driver, was that the changes there would be that things that failed would start working or that they would fail with another error code. If we had made the change on the embedded driver, things that used to work would stop working, which is worse.&lt;/p&gt;

&lt;p&gt;But as you said, there are changes on the client side too, so we may consider writing a release note warning users that the error code has changed. Though I&apos;m not sure if we have bothered release noting changes from &quot;0A000 - not implemented&quot; before.&lt;/p&gt;

&lt;p&gt;You&apos;re right about the inconsistent coding style. There was a vote once where it was decided that the Java coding conventions&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; (with some amendments that I don&apos;t remember right now) was the recommended style for new code. It was not decided that the entire code base should be reformatted, so we still have to live with different styles.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://java.sun.com/docs/codeconv/html/CodeConvTOC.doc.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/docs/codeconv/html/CodeConvTOC.doc.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12698056" author="yunlee" created="Sat, 11 Apr 2009 07:39:02 +0100"  >&lt;p&gt;Knut, I&apos;m happy to hear it will be commited soon! Thanks!&lt;/p&gt;

&lt;p&gt;By what you explained so clearly, I&apos;ve got why it&apos;s better to make changes on client side now.&lt;/p&gt;

&lt;p&gt;I have browsed the coding convention doc, and will follow it in my work on Derby.&lt;/p&gt;

&lt;p&gt;Yun&lt;/p&gt;


</comment>
                            <comment id="12698109" author="knutanders" created="Sat, 11 Apr 2009 18:07:01 +0100"  >&lt;p&gt;Committed revision 764217.&lt;br/&gt;
I wasn&apos;t planning to backport this fix to the 10.5 branch.&lt;/p&gt;

&lt;p&gt;Checking &quot;Release Note Needed&quot; since the fix changes an error code.&lt;/p&gt;</comment>
                            <comment id="12698110" author="knutanders" created="Sat, 11 Apr 2009 18:07:57 +0100"  >&lt;p&gt;Here&apos;s an attempt on a release note for this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="32841">DERBY-310</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12404074" name="DERBY-3853-1.patch" size="3065" author="yunlee" created="Sun, 29 Mar 2009 09:15:16 +0100"/>
                            <attachment id="12404075" name="DERBY-3853-1.stat" size="165" author="yunlee" created="Sun, 29 Mar 2009 09:15:16 +0100"/>
                            <attachment id="12404967" name="DERBY-3853-2.patch" size="15807" author="yunlee" created="Wed, 8 Apr 2009 15:42:12 +0100"/>
                            <attachment id="12404968" name="DERBY-3853-2.stat" size="160" author="yunlee" created="Wed, 8 Apr 2009 15:42:12 +0100"/>
                            <attachment id="12405238" name="releaseNote.html" size="4108" author="knutanders" created="Sat, 11 Apr 2009 18:07:57 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10363"><![CDATA[Embedded/Client difference]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 29 Mar 2009 08:15:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31030</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ulj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38775</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>