<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:37:22 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5681/DERBY-5681.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5681] When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5681</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If you drop the foreign key constraint for a table, the statistics row does not get removed.   This affects the indexStat daemon because it now finds these statistics row which always appear as out of date, causing an update to be scheduled.&lt;/p&gt;

&lt;p&gt;Here is how to get it to happen:&lt;/p&gt;

&lt;p&gt;set schema app;&lt;/p&gt;

&lt;p&gt;CREATE TABLE TEST_TAB_1&lt;br/&gt;
(&lt;br/&gt;
    ID INTEGER PRIMARY KEY NOT NULL&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;CREATE TABLE TEST_TAB_2&lt;br/&gt;
(&lt;br/&gt;
   ID INTEGER PRIMARY KEY NOT NULL&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;ALTER TABLE TEST_TAB_2&lt;br/&gt;
ADD CONSTRAINT TEST_TAB_2_FK_1&lt;br/&gt;
FOREIGN KEY (ID) REFERENCES TEST_TAB_1(ID);&lt;/p&gt;

&lt;p&gt;insert into app.TEST_TAB_1 values (1);&lt;br/&gt;
insert into test_tab_2 values(1);&lt;/p&gt;

&lt;p&gt;call syscs_util.syscs_update_statistics(&apos;APP&apos;, &apos;TEST_TAB_2&apos;, null);&lt;/p&gt;

&lt;p&gt;select&lt;br/&gt;
c.TABLEID,&lt;br/&gt;
c.CONGLOMERATENUMBER,&lt;br/&gt;
c.CONGLOMERATENAME,&lt;br/&gt;
c.ISINDEX,&lt;br/&gt;
c.ISCONSTRAINT,&lt;br/&gt;
c.CONGLOMERATEID,&lt;br/&gt;
t.TABLEID,&lt;br/&gt;
t.TABLENAME,&lt;br/&gt;
t.TABLETYPE,&lt;br/&gt;
s.STATID,&lt;br/&gt;
s.REFERENCEID,&lt;br/&gt;
s.TABLEID,&lt;br/&gt;
s.CREATIONTIMESTAMP,&lt;br/&gt;
s.TYPE,&lt;br/&gt;
s.VALID,&lt;br/&gt;
s.COLCOUNT,&lt;br/&gt;
CAST(STATISTICS AS VARCHAR(40)) as STATISTICS&lt;br/&gt;
from sys.SYSCONGLOMERATES c join sys.SYSTABLES t on c.TABLEID = t.TABLEID join sys.SYSSTATISTICS s on s.TABLEID = t.TABLEID&lt;br/&gt;
where t.TABLENAME = &apos;TEST_TAB_2&apos; and c.ISINDEX = false;&lt;/p&gt;

&lt;p&gt;&amp;#8211; At this point there are two statistic rows&lt;/p&gt;

&lt;p&gt;TABLEID CONGLOMERATENUMBER      CONGLOMERATENAME        ISINDEX ISCONSTRAINT    CONGLOMERATEID  TABLEID TABLENAME       TABLETYPE       STATID  REFERENCEID     TABLEID CREATIONTIMESTAMP       TYPE    VALID   COLCOUNT        STATISTICS&lt;br/&gt;
84490209-0136-6999-c1b4-000065089f97    348432  84490209-0136-6999-c1b4-000065089f97    false   false   cccb420a-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    TEST_TAB_2      T       edbc8255-0136-6999-c1b4-000065089f97    55410238-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    2012-03-31 17:36:49.629 I       true    1       numunique= 1 numrows= 1&lt;br/&gt;
84490209-0136-6999-c1b4-000065089f97    348432  84490209-0136-6999-c1b4-000065089f97    false   false   cccb420a-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    TEST_TAB_2      T       05278254-0136-6999-c1b4-000065089f97    63454207-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    2012-03-31 17:36:49.628 I       true    1       numunique= 1 numrows= 1&lt;/p&gt;

&lt;p&gt;&amp;#8211; Now drop the constraint&lt;/p&gt;

&lt;p&gt;alter table TEST_TAB_2&lt;br/&gt;
drop constraint TEST_TAB_2_FK_1;&lt;/p&gt;

&lt;p&gt;select&lt;br/&gt;
c.TABLEID,&lt;br/&gt;
c.CONGLOMERATENUMBER,&lt;br/&gt;
c.CONGLOMERATENAME,&lt;br/&gt;
c.ISINDEX,&lt;br/&gt;
c.ISCONSTRAINT,&lt;br/&gt;
c.CONGLOMERATEID,&lt;br/&gt;
t.TABLEID,&lt;br/&gt;
t.TABLENAME,&lt;br/&gt;
t.TABLETYPE,&lt;br/&gt;
s.STATID,&lt;br/&gt;
s.REFERENCEID,&lt;br/&gt;
s.TABLEID,&lt;br/&gt;
s.CREATIONTIMESTAMP,&lt;br/&gt;
s.TYPE,&lt;br/&gt;
s.VALID,&lt;br/&gt;
s.COLCOUNT,&lt;br/&gt;
CAST(STATISTICS AS VARCHAR(40)) as STATISTICS&lt;br/&gt;
from sys.SYSCONGLOMERATES c join sys.SYSTABLES t on c.TABLEID = t.TABLEID join sys.SYSSTATISTICS s on s.TABLEID = t.TABLEID&lt;br/&gt;
where t.TABLENAME = &apos;TEST_TAB_2&apos; and c.ISINDEX = false;&lt;/p&gt;

&lt;p&gt;&amp;#8211; There are still two statistic rows&lt;/p&gt;

&lt;p&gt;TABLEID CONGLOMERATENUMBER      CONGLOMERATENAME        ISINDEX ISCONSTRAINT    CONGLOMERATEID  TABLEID TABLENAME       TABLETYPE       STATID  REFERENCEID     TABLEID CREATIONTIMESTAMP       TYPE    VALID   COLCOUNT        STATISTICS&lt;br/&gt;
84490209-0136-6999-c1b4-000065089f97    348432  84490209-0136-6999-c1b4-000065089f97    false   false   cccb420a-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    TEST_TAB_2      T       edbc8255-0136-6999-c1b4-000065089f97    55410238-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    2012-03-31 17:36:49.629 I       true    1       numunique= 1 numrows= 1&lt;br/&gt;
84490209-0136-6999-c1b4-000065089f97    348432  84490209-0136-6999-c1b4-000065089f97    false   false   cccb420a-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    TEST_TAB_2      T       05278254-0136-6999-c1b4-000065089f97    63454207-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    2012-03-31 17:36:49.628 I       true    1       numunique= 1 numrows= 1&lt;/p&gt;

&lt;p&gt;&amp;#8211; Add another row&lt;/p&gt;

&lt;p&gt;insert into app.TEST_TAB_1 values (2);&lt;br/&gt;
insert into test_tab_2 values(2);&lt;/p&gt;

&lt;p&gt;&amp;#8211; Update the statistics&lt;/p&gt;

&lt;p&gt;call syscs_util.syscs_update_statistics(&apos;APP&apos;, &apos;TEST_TAB_2&apos;, null);&lt;/p&gt;

&lt;p&gt;select&lt;br/&gt;
c.TABLEID,&lt;br/&gt;
c.CONGLOMERATENUMBER,&lt;br/&gt;
c.CONGLOMERATENAME,&lt;br/&gt;
c.ISINDEX,&lt;br/&gt;
c.ISCONSTRAINT,&lt;br/&gt;
c.CONGLOMERATEID,&lt;br/&gt;
t.TABLEID,&lt;br/&gt;
t.TABLENAME,&lt;br/&gt;
t.TABLETYPE,&lt;br/&gt;
s.STATID,&lt;br/&gt;
s.REFERENCEID,&lt;br/&gt;
s.TABLEID,&lt;br/&gt;
s.CREATIONTIMESTAMP,&lt;br/&gt;
s.TYPE,&lt;br/&gt;
s.VALID,&lt;br/&gt;
s.COLCOUNT,&lt;br/&gt;
CAST(STATISTICS AS VARCHAR(40)) as STATISTICS&lt;br/&gt;
from sys.SYSCONGLOMERATES c join sys.SYSTABLES t on c.TABLEID = t.TABLEID join sys.SYSSTATISTICS s on s.TABLEID = t.TABLEID&lt;br/&gt;
where t.TABLENAME = &apos;TEST_TAB_2&apos; and c.ISINDEX = false;&lt;/p&gt;

&lt;p&gt;&amp;#8211; There are still two rows but now one show 1 row and one shows 2 rows&lt;/p&gt;

&lt;p&gt;TABLEID CONGLOMERATENUMBER      CONGLOMERATENAME        ISINDEX ISCONSTRAINT    CONGLOMERATEID  TABLEID TABLENAME       TABLETYPE       STATID  REFERENCEID     TABLEID CREATIONTIMESTAMP       TYPE    VALID   COLCOUNT        STATISTICS&lt;br/&gt;
84490209-0136-6999-c1b4-000065089f97    348432  84490209-0136-6999-c1b4-000065089f97    false   false   cccb420a-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    TEST_TAB_2      T       edbc8255-0136-6999-c1b4-000065089f97    55410238-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    2012-03-31 17:36:49.629 I       true    1       numunique= 1 numrows= 1&lt;br/&gt;
84490209-0136-6999-c1b4-000065089f97    348432  84490209-0136-6999-c1b4-000065089f97    false   false   cccb420a-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    TEST_TAB_2      T       18438274-0136-6999-c1b4-000065089f97    63454207-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    2012-03-31 17:41:19.164 I       true    1       numunique= 2 numrows= 2&lt;/p&gt;

&lt;p&gt;&amp;#8211; Add the constraint back on&lt;/p&gt;

&lt;p&gt;ALTER TABLE TEST_TAB_2&lt;br/&gt;
ADD CONSTRAINT TEST_TAB_2_FK_1&lt;br/&gt;
FOREIGN KEY (ID) REFERENCES TEST_TAB_1(ID);&lt;/p&gt;

&lt;p&gt;&amp;#8211; Insert another row&lt;/p&gt;

&lt;p&gt;insert into app.TEST_TAB_1 values (3);&lt;br/&gt;
insert into test_tab_2 values(3);&lt;/p&gt;

&lt;p&gt;&amp;#8211; Update the statistics&lt;/p&gt;

&lt;p&gt;call syscs_util.syscs_update_statistics(&apos;APP&apos;, &apos;TEST_TAB_2&apos;, null);&lt;/p&gt;

&lt;p&gt;select&lt;br/&gt;
c.TABLEID,&lt;br/&gt;
c.CONGLOMERATENUMBER,&lt;br/&gt;
c.CONGLOMERATENAME,&lt;br/&gt;
c.ISINDEX,&lt;br/&gt;
c.ISCONSTRAINT,&lt;br/&gt;
c.CONGLOMERATEID,&lt;br/&gt;
t.TABLEID,&lt;br/&gt;
t.TABLENAME,&lt;br/&gt;
t.TABLETYPE,&lt;br/&gt;
s.STATID,&lt;br/&gt;
s.REFERENCEID,&lt;br/&gt;
s.TABLEID,&lt;br/&gt;
s.CREATIONTIMESTAMP,&lt;br/&gt;
s.TYPE,&lt;br/&gt;
s.VALID,&lt;br/&gt;
s.COLCOUNT,&lt;br/&gt;
CAST(STATISTICS AS VARCHAR(40)) as STATISTICS&lt;br/&gt;
from sys.SYSCONGLOMERATES c join sys.SYSTABLES t on c.TABLEID = t.TABLEID join sys.SYSSTATISTICS s on s.TABLEID = t.TABLEID&lt;br/&gt;
where t.TABLENAME = &apos;TEST_TAB_2&apos; and c.ISINDEX = false;&lt;/p&gt;

&lt;p&gt;&amp;#8211; Now there are 3 rows&lt;/p&gt;

&lt;p&gt;TABLEID CONGLOMERATENUMBER      CONGLOMERATENAME        ISINDEX ISCONSTRAINT    CONGLOMERATEID  TABLEID TABLENAME       TABLETYPE       STATID  REFERENCEID     TABLEID CREATIONTIMESTAMP       TYPE    VALID   COLCOUNT        STATISTICS&lt;br/&gt;
84490209-0136-6999-c1b4-000065089f97    348432  84490209-0136-6999-c1b4-000065089f97    false   false   cccb420a-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    TEST_TAB_2      T       edbc8255-0136-6999-c1b4-000065089f97    55410238-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    2012-03-31 17:36:49.629 I       true    1       numunique= 1 numrows= 1&lt;br/&gt;
84490209-0136-6999-c1b4-000065089f97    348432  84490209-0136-6999-c1b4-000065089f97    false   false   cccb420a-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    TEST_TAB_2      T       45eb02e8-0136-6999-c1b4-000065089f97    63454207-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    2012-03-31 17:46:00.211 I       true    1       numunique= 3 numrows= 3&lt;br/&gt;
84490209-0136-6999-c1b4-000065089f97    348432  84490209-0136-6999-c1b4-000065089f97    false   false   cccb420a-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    TEST_TAB_2      T       0ea502e9-0136-6999-c1b4-000065089f97    7ab90278-0136-6999-c1b4-000065089f97    84490209-0136-6999-c1b4-000065089f97    2012-03-31 17:46:00.212 I       true    1       numunique= 3 numrows= 3&lt;/p&gt;

&lt;p&gt;Note that dropping that recreating the constraint or compressing the table does not fix the problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12548973">DERBY-5681</key>
            <summary>When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="bbergquist">Brett Bergquist</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 Apr 2012 00:07:52 +0100</created>
                <updated>Wed, 3 Sep 2014 09:31:44 +0100</updated>
                            <resolved>Fri, 18 May 2012 23:45:32 +0100</resolved>
                                    <version>10.8.2.2</version>
                                    <fixVersion>10.3.3.1</fixVersion>
                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.5.3.2</fixVersion>
                    <fixVersion>10.6.2.4</fixVersion>
                    <fixVersion>10.7.1.4</fixVersion>
                    <fixVersion>10.8.3.0</fixVersion>
                    <fixVersion>10.9.1.0</fixVersion>
                                    <component>SQL</component>
                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13243595" author="bbergquist" created="Sun, 1 Apr 2012 00:09:22 +0100"  >&lt;p&gt;This is one way in which the &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt; will find statistics rows that don&apos;t make sense and try to update over and over.&lt;/p&gt;</comment>
                            <comment id="13243601" author="mikem" created="Sun, 1 Apr 2012 00:29:32 +0100"  >&lt;p&gt;just changing the component, the problem is most likely in the drop constraint code in the sql layer of the system.  The storage layer does not&lt;br/&gt;
know anything about the sysstatistics catalog.&lt;/p&gt;</comment>
                            <comment id="13246926" author="mamtas" created="Thu, 5 Apr 2012 02:25:08 +0100"  >&lt;p&gt;I have added some test cases which are attached as a patch to this jira(DERBY5681_patch1_diff.txt)&lt;/p&gt;

&lt;p&gt;I am seeing left over statistics row for the test case provided by Brett in this jira in my junit test as well but Unique key on nullable and non-nullable column and primary key constraints are working fine ie no left over statistics after those constraints are dropped.&lt;/p&gt;</comment>
                            <comment id="13255743" author="mamtas" created="Tue, 17 Apr 2012 18:24:43 +0100"  >&lt;p&gt;I am debugging this jira. Not finished yet but it may be related to the changes that went in for  &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3299&quot; title=&quot;Uniqueness violation error (23505) occurs after dropping a PK constraint if there exists a foreign key on the same columns.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3299&quot;&gt;&lt;del&gt;DERBY-3299&lt;/del&gt;&lt;/a&gt; (Uniqueness violation error (23505) occurs after dropping a PK constraint if there exists a foreign key on the same columns). Will debug further and post the finidings. I think this is yet another case where same backing index is being used by multiple constraints.&lt;/p&gt;</comment>
                            <comment id="13256838" author="mamtas" created="Wed, 18 Apr 2012 20:03:29 +0100"  >&lt;p&gt;I debugged Derby code for this jira and found the problem to be in iapi.sql.dictionary.ConglomerateDescriptor:drop() method&lt;br/&gt;
One of the checks being made in this method is as follows&lt;br/&gt;
		if (congDescs.length == 1)&lt;br/&gt;
			dropConglom = true;&lt;br/&gt;
		else&lt;br/&gt;
		{&lt;br/&gt;
In case of this jira, we have multiple constraints sharing the same backing index and hence we go to the else code of the above if else code. In this code, based on some conditions, we check if we need to drop and recreate the backing index. I need to study this code further to see how we decide whether we should recreate a new backing index. But it appears, in our specific case, we do not drop and recreate the backing index and that might be the cause behind statistics not getting dropped when foreign constraint is dropped. I will post more as I find more info.&lt;/p&gt;</comment>
                            <comment id="13257955" author="mamtas" created="Fri, 20 Apr 2012 01:49:01 +0100"  >&lt;p&gt;While going through the code, I found following comment in CreateIndexConstantAction about what will determine if a backing index will be shared by multiple constraints.&lt;/p&gt;

&lt;p&gt;			/* The conditions which allow an index to share an existing&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;conglomerate are as follows:&lt;br/&gt;
			 *&lt;/li&gt;
	&lt;li&gt;1. the set of columns (both key and include columns) and their&lt;/li&gt;
	&lt;li&gt;order in the index is the same as that of an existing index AND&lt;br/&gt;
			 *&lt;/li&gt;
	&lt;li&gt;2. the ordering attributes are the same AND&lt;br/&gt;
			 *&lt;/li&gt;
	&lt;li&gt;3. one of the following is true:&lt;/li&gt;
	&lt;li&gt;a) the existing index is unique, OR&lt;/li&gt;
	&lt;li&gt;b) the existing index is non-unique with uniqueWhenNotNulls&lt;/li&gt;
	&lt;li&gt;set to TRUE and the index being created is non-unique, OR&lt;/li&gt;
	&lt;li&gt;c) both the existing index and the one being created are&lt;/li&gt;
	&lt;li&gt;non-unique and have uniqueWithDuplicateNulls set to FALSE.&lt;br/&gt;
			 */ &lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13258417" author="mamtas" created="Fri, 20 Apr 2012 18:54:01 +0100"  >&lt;p&gt;Attaching a patch which fixes the problem associated with this jira. Basically, when two constraints share the same backing index, we conditionally dropped the statistics. Instead, this fix will make sure that the statistics are always dropped even if the underneath backing index is still valid(and hence won&apos;t be dropped and recreated) for other constraints. I ran derbyall and junit suite and they both ran fine with no errors. Please let me know if there is any feedback on the patch. I have also added few tests for the issue.&lt;/p&gt;</comment>
                            <comment id="13258455" author="mamtas" created="Fri, 20 Apr 2012 19:35:26 +0100"  >&lt;p&gt;If we go with patch DERBY5681_patch2_diff.txt, then it will be fine to backport it to earlier releases.&lt;/p&gt;</comment>
                            <comment id="13277040" author="mamtas" created="Wed, 16 May 2012 20:26:58 +0100"  >&lt;p&gt;Have backported the changes to 10.4 but in trunk , for this jira, we added some tests which use upgrade statistics procedure but since that procedure doesn&apos;t exist in 10.4 and before, the new tests for this jira from trunk couldn&apos;t be backported to 10.4 without changes. In 10.4, I added those tests to a new class, namely Derby5681Test.java and these tests donot use update statisitcs procedure. But, because of the absence of update statisitcs procedure and &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5702&quot; title=&quot;Creating a foreign key constraint does not automatically create a statistics row if foreign key constraint will share a backing index created for a primary key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5702&quot;&gt;DERBY-5702&lt;/a&gt;, we can&apos;t quite have a statistics row for a constraint which shares a backing index in 10.4 and before. The test in 10.4 will just have a test to drop constraint(that shares a backing index with another constraint) and show that it doesn&apos;t break anything. Once &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5702&quot; title=&quot;Creating a foreign key constraint does not automatically create a statistics row if foreign key constraint will share a backing index created for a primary key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5702&quot;&gt;DERBY-5702&lt;/a&gt; is fixed and backported to 10.4 and before, we will have a statistics row for a constraint which shares a backing index and we will be able to show that as a fix of this jira, that statistics row will get dropped when the constraint is dropped.&lt;/p&gt;</comment>
                            <comment id="13280124" author="kristwaa" created="Mon, 21 May 2012 13:52:58 +0100"  >&lt;p&gt;Attaching patch 3a, which makes the test testIndexAndColumnNamedStatistics less sensitive to statistics created by other tests.&lt;/p&gt;

&lt;p&gt;Committed to trunk with revision 1341002.&lt;br/&gt;
Cleanup code in testDisposableStatsEagerness was added as part of addressing &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5774&quot; title=&quot;Failures in UpdateStatisticsTest (order-dependent test cases)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5774&quot;&gt;DERBY-5774&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13280305" author="mamtas" created="Mon, 21 May 2012 18:45:46 +0100"  >&lt;p&gt;Kristian, thanks for making the test more independent of other tests.&lt;/p&gt;</comment>
                            <comment id="13695631" author="jira-bot" created="Fri, 28 Jun 2013 19:23:27 +0100"  >&lt;p&gt;Commit 1497868 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1497868&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1497868&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt;( indexStat daemon processing tables over and over even when there are no changes in the tables )&lt;/p&gt;

&lt;p&gt;Backporting the 3 commits that went in for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt; to 10.8. The 3 commits were 1340549, 1341622, 1341629. The first two commits were easy to backport using svn merge command but the third commit 1341629 ran into conflicts. For that backport, hand made the changes since there were not too many changes.&lt;/p&gt;

&lt;p&gt;The changes for this jira has added a new property derby.storage.indexStats.debug.keepDisposableStats. The intention of the property is that if the property is set to true, we do not delete the orphaned/disposable stats. If the property is set to false, the orphaned/disposable stats will get dropped by the index stats daemon. Currently known reasons for orphaned/disposable stats are&lt;br/&gt;
1)&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5681&quot; title=&quot;When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5681&quot;&gt;&lt;del&gt;DERBY-5681&lt;/del&gt;&lt;/a&gt;(When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed). Fix for this has been backported all the way to 10.3&lt;br/&gt;
2)&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3790&quot; title=&quot;Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3790&quot;&gt;&lt;del&gt;DERBY-3790&lt;/del&gt;&lt;/a&gt;(Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.) Fix for this is in 10.9 and higher&lt;/p&gt;

&lt;p&gt;A junit test was added for this new property but it went in as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3790&quot; title=&quot;Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3790&quot;&gt;&lt;del&gt;DERBY-3790&lt;/del&gt;&lt;/a&gt;. The name of the junit test is store.KeepDisposableStatsPropertyTest. Had to make changes to this test to backport it to 10.8 but without the fix for DEBRY-3790 and with the absence of drop statistics procedure, the test really does not make much sense for 10.8 codeline. The test uses drop statistics procedure and it is mainly testing &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3790&quot; title=&quot;Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3790&quot;&gt;&lt;del&gt;DERBY-3790&lt;/del&gt;&lt;/a&gt; to make sure that the orphaned stats are being deleted or left behind based on whether the property is set to true or false. But since we do not have drop statistics procedure and we do not have &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3790&quot; title=&quot;Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3790&quot;&gt;&lt;del&gt;DERBY-3790&lt;/del&gt;&lt;/a&gt; fixed in 10.8, we can&apos;t really meaningfully run the KeepDisposableStatsPropertyTest in 10.8. In any case, I have changed the test so that atleast it will not fail in 10.8 but it is not able to truly test the property. May be we can test this property through upgrade suite where we will create orphaned stats because of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5681&quot; title=&quot;When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5681&quot;&gt;&lt;del&gt;DERBY-5681&lt;/del&gt;&lt;/a&gt; on older releases and we will find that when the property is set to true, even after upgrade, we will have orphaned stats but when property is set to false, after upgrade, orphaned stats are deleted.&lt;/p&gt;</comment>
                            <comment id="13695636" author="jira-bot" created="Fri, 28 Jun 2013 19:23:31 +0100"  >&lt;p&gt;Commit 1497868 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mamtas&quot; class=&quot;user-hover&quot; rel=&quot;mamtas&quot;&gt;Mamta A. Satoor&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1497868&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1497868&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt;( indexStat daemon processing tables over and over even when there are no changes in the tables )&lt;/p&gt;

&lt;p&gt;Backporting the 3 commits that went in for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5680&quot; title=&quot;indexStat daemon processing tables over and over even when there are no changes in the tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5680&quot;&gt;&lt;del&gt;DERBY-5680&lt;/del&gt;&lt;/a&gt; to 10.8. The 3 commits were 1340549, 1341622, 1341629. The first two commits were easy to backport using svn merge command but the third commit 1341629 ran into conflicts. For that backport, hand made the changes since there were not too many changes.&lt;/p&gt;

&lt;p&gt;The changes for this jira has added a new property derby.storage.indexStats.debug.keepDisposableStats. The intention of the property is that if the property is set to true, we do not delete the orphaned/disposable stats. If the property is set to false, the orphaned/disposable stats will get dropped by the index stats daemon. Currently known reasons for orphaned/disposable stats are&lt;br/&gt;
1)&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5681&quot; title=&quot;When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5681&quot;&gt;&lt;del&gt;DERBY-5681&lt;/del&gt;&lt;/a&gt;(When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed). Fix for this has been backported all the way to 10.3&lt;br/&gt;
2)&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3790&quot; title=&quot;Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3790&quot;&gt;&lt;del&gt;DERBY-3790&lt;/del&gt;&lt;/a&gt;(Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.) Fix for this is in 10.9 and higher&lt;/p&gt;

&lt;p&gt;A junit test was added for this new property but it went in as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3790&quot; title=&quot;Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3790&quot;&gt;&lt;del&gt;DERBY-3790&lt;/del&gt;&lt;/a&gt;. The name of the junit test is store.KeepDisposableStatsPropertyTest. Had to make changes to this test to backport it to 10.8 but without the fix for DEBRY-3790 and with the absence of drop statistics procedure, the test really does not make much sense for 10.8 codeline. The test uses drop statistics procedure and it is mainly testing &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3790&quot; title=&quot;Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3790&quot;&gt;&lt;del&gt;DERBY-3790&lt;/del&gt;&lt;/a&gt; to make sure that the orphaned stats are being deleted or left behind based on whether the property is set to true or false. But since we do not have drop statistics procedure and we do not have &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3790&quot; title=&quot;Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3790&quot;&gt;&lt;del&gt;DERBY-3790&lt;/del&gt;&lt;/a&gt; fixed in 10.8, we can&apos;t really meaningfully run the KeepDisposableStatsPropertyTest in 10.8. In any case, I have changed the test so that atleast it will not fail in 10.8 but it is not able to truly test the property. May be we can test this property through upgrade suite where we will create orphaned stats because of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5681&quot; title=&quot;When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5681&quot;&gt;&lt;del&gt;DERBY-5681&lt;/del&gt;&lt;/a&gt; on older releases and we will find that when the property is set to true, even after upgrade, we will have orphaned stats but when property is set to false, after upgrade, orphaned stats are deleted.&lt;/p&gt;</comment>
                            <comment id="14119642" author="knutanders" created="Wed, 3 Sep 2014 09:31:44 +0100"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;bulk update&amp;#93;&lt;/span&gt; Close all resolved issues that haven&apos;t been updated for more than one year.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12551931">DERBY-5702</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12655383">DERBY-6283</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12548851">DERBY-5680</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12419334">DERBY-4115</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12521442" name="DERBY5681_patch1_diff.txt" size="11025" author="mamtas" created="Thu, 5 Apr 2012 02:25:08 +0100"/>
                            <attachment id="12523527" name="DERBY5681_patch2_diff.txt" size="7369" author="mamtas" created="Fri, 20 Apr 2012 18:54:01 +0100"/>
                            <attachment id="12528416" name="derby-5681-3a-test.diff" size="3116" author="kristwaa" created="Mon, 21 May 2012 13:52:58 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 31 Mar 2012 23:29:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234046</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0bpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35714</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>