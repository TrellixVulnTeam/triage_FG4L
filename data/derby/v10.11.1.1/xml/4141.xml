<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:30:11 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4141/DERBY-4141.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4141] XAExceptions thrown by Derby can have errorCode 0 </title>
                <link>https://issues.apache.org/jira/browse/DERBY-4141</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When an XAException occurs during xa.start() or other XA operation, because of an SQLException, we have an errorCode of 0, regardless of the severity.  I would suggest XAER_RMFAIL for SESSION_SEVERITY or greater and XAER_RMERR for lower severity exceptions. See thread &lt;a href=&quot;http://www.nabble.com/XAException.errorCode-on-XAException-caused-by-an-SQLException-tt22832423.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/XAException.errorCode-on-XAException-caused-by-an-SQLException-tt22832423.html&lt;/a&gt;  for more detail and a reproduction.&lt;/p&gt;



</description>
                <environment></environment>
        <key id="12421929">DERBY-4141</key>
            <summary>XAExceptions thrown by Derby can have errorCode 0 </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kmarsden">Kathey Marsden</assignee>
                                    <reporter username="kmarsden">Kathey Marsden</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Apr 2009 00:12:09 +0100</created>
                <updated>Tue, 14 Apr 2009 17:13:42 +0100</updated>
                            <resolved>Mon, 13 Apr 2009 23:22:18 +0100</resolved>
                                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                    <version>10.3.3.0</version>
                    <version>10.4.2.0</version>
                    <version>10.5.1.1</version>
                    <version>10.6.1.0</version>
                                    <fixVersion>10.3.3.1</fixVersion>
                    <fixVersion>10.4.2.1</fixVersion>
                    <fixVersion>10.5.1.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12697640" author="kmarsden" created="Thu, 9 Apr 2009 21:33:42 +0100"  >&lt;p&gt;Well these changes look pretty straight forward for embedded. See attached preliminary patch (derby-4141_embedded_diff1.txt), but looking at the client code in NetXAResource it seems for any SQLException we use errorCode XAER_RMERR.  I am not sure how to determine if it is a session ending exception on client. Does anyone know how to do this?&lt;/p&gt;

&lt;p&gt;Also, I need a better test to provoke an SQLException within an XA operation.  My current test case, which shuts down the database causes an assertion on the server and a NPE on the client when run with network server.  Any ideas on a better test case would be welcome.  I don&apos;t really see the assertion and the NPE as bugs as Derby can&apos;t really be so defensive as to gracefully handle someone shutting the database down from underneath.&lt;/p&gt;

&lt;p&gt;The patch is not tested and is not ready for commit, but adapts the client model of setting both the message and the errorCode for all XAExceptions.  If not one of the SQLStates with a straightforward mapping, it will set the errrorCode to XAER_RMFAIL for SESSION_SEVERITY or greater and XAER_RMERR for less severe errors. With the old code for embedded we would set either the message or the errorCode, but not both.&lt;/p&gt;</comment>
                            <comment id="12697664" author="kmarsden" created="Thu, 9 Apr 2009 22:49:16 +0100"  >&lt;p&gt;I see am.SqlCode has the disconnect exception at 40000, so I could use XAER_RMFAIL for those but I think that severe exceptions from the server don&apos;t get that code.&lt;/p&gt;</comment>
                            <comment id="12697671" author="kmarsden" created="Thu, 9 Apr 2009 23:10:02 +0100"  >&lt;p&gt;Just closing the XAConnection gives me a good enough reproduction for the XAER_RMFAIL case and in that case the XAER_RMFAIL errrorCode seems to get transfered properly to client.&lt;/p&gt;</comment>
                            <comment id="12698027" author="kmarsden" created="Sat, 11 Apr 2009 01:01:56 +0100"  >&lt;p&gt;The attached patch (derby-4141_diff.txt) has the client and embedded changes and adds a test for the XAER_RMFAIL case.  I couldn&apos;t figure out a case for testing the XAER_RMERR case, (non-session ending exception that causes an xa operation to fail), but if anyone has any ideas, please let me know and I&apos;ll add a test for that too.&lt;/p&gt;

&lt;p&gt;For client I mapped the disconnect exception to XAException.XAER_RMFAIL  and verified that server side exceptions that  cause XAExceptions do indeed get the errorCode from the server.  I think this resolves my concerns about client side SQLExcetptions.&lt;/p&gt;

&lt;p&gt;Running tests now.  I would like to backport this change to 10.3. It is a behavior change, but I think a sensible one that is low risk. Please let me know if you have any concerns.&lt;/p&gt;</comment>
                            <comment id="12698146" author="kmarsden" created="Sun, 12 Apr 2009 00:42:30 +0100"  >&lt;p&gt;Tests passed. please review.&lt;/p&gt;</comment>
                            <comment id="12698574" author="kmarsden" created="Mon, 13 Apr 2009 23:22:18 +0100"  >&lt;p&gt;Myrna asked me to pre-close this issue so it makes the 10.5.1.1 release notes. I actually plan to check into 10.5 tomorrow morning after checking the nightly runs.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12405210" name="derby-4141_diff.txt" size="8657" author="kmarsden" created="Sat, 11 Apr 2009 01:01:56 +0100"/>
                            <attachment id="12405101" name="derby-4141_embbeded_diff1.txt" size="2875" author="kmarsden" created="Thu, 9 Apr 2009 21:33:42 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24054</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0y7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39361</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>