<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:11:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3352/DERBY-3352.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3352] truncateTable crashed, Caused by: java.lang.NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3352</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Since derby 10.3.2.1, when truncate a table which has index , a java.lang.NullPointerException is throwed;but the same src runs successfully with derby 10.2.2.0&#12290;&lt;/p&gt;

&lt;p&gt;here&apos;s the example source code and stack trace:&lt;/p&gt;

&lt;p&gt;Src:&lt;br/&gt;
        public static void main(String[] args)&lt;br/&gt;
	{&lt;/p&gt;

&lt;p&gt;		try&lt;/p&gt;
		{
			Class.forName(&quot;org.apache.derby.jdbc.EmbeddedDriver&quot;);
			
			Connection conn = DriverManager.getConnection(&quot;jdbc:derby:test;create=true&quot;);
			
			Statement stat = conn.createStatement();
			stat.executeUpdate(&quot;create table m (uri varchar(256),f int)&quot;);
			stat.executeUpdate(&quot;create index aa on m (uri)&quot;);
			stat.executeUpdate(&quot;truncate table m&quot;);
			
			System.out.println(&quot;Truncate table m successfully&#65281;&quot;);
		}
&lt;p&gt;		catch (Exception ex)&lt;/p&gt;
		{
			ex.printStackTrace();
		}
&lt;p&gt;	}&lt;br/&gt;
Error:&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: Java Exception:&quot;:java.lang.NullPointerException&quot;&#12290;&lt;br/&gt;
	at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.Util.javaException(Util.java:245)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1574)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1315)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:618)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(EmbedStatement.java:176)&lt;br/&gt;
	at update.UpdateURI.main(UpdateURI.java:34)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.AlterTableConstantAction.truncateTable(AlterTableConstantAction.java:1462)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.AlterTableConstantAction.executeConstantAction(AlterTableConstantAction.java:531)&lt;br/&gt;
	at org.apache.derby.impl.sql.execute.MiscResultSet.open(MiscResultSet.java:64)&lt;br/&gt;
	at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370)&lt;br/&gt;
	at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1225)&lt;br/&gt;
	... 3 more&lt;/p&gt;</description>
                <environment>Windows XP.SP2 , Eclipse 3.2.2 , JDK 1.5_05 </environment>
        <key id="12387118">DERBY-3352</key>
            <summary>truncateTable crashed, Caused by: java.lang.NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dyret">Dyre Tjeldvoll</assignee>
                                    <reporter username="don.wind">QingpingXu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Jan 2008 03:40:57 +0000</created>
                <updated>Fri, 21 Jan 2011 17:51:23 +0000</updated>
                            <resolved>Mon, 31 Mar 2008 15:57:24 +0100</resolved>
                                    <version>10.3.1.4</version>
                    <version>10.3.2.1</version>
                                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12562388" author="knutanders" created="Fri, 25 Jan 2008 07:54:04 +0000"  >&lt;p&gt;When I run the repro (tried it on trunk, 10.3.2.1, 10.3.1.4, 10.2.2.1, 10.1.3.1) I get this error:&lt;/p&gt;

&lt;p&gt;    ERROR 0A000: Feature not implemented: truncate table.&lt;/p&gt;

&lt;p&gt;Am I doing something wrong?&lt;/p&gt;</comment>
                            <comment id="12562417" author="don.wind" created="Fri, 25 Jan 2008 09:45:36 +0000"  >&lt;p&gt;i download the source code from svn and compile it all by myself.&lt;/p&gt;</comment>
                            <comment id="12562418" author="knutanders" created="Fri, 25 Jan 2008 09:56:03 +0000"  >&lt;p&gt;Thanks, I also see the NPE when I run with a debug-enabled build.&lt;/p&gt;

&lt;p&gt;That&apos;s very strange. With a debug-enabled build, it works without failure on 10.2, but fails with NPE on 10.3 and trunk. With a non-debug build, it fails with 0A000 (feature not implemented) on all versions.&lt;/p&gt;</comment>
                            <comment id="12562420" author="knutanders" created="Fri, 25 Jan 2008 10:05:01 +0000"  >&lt;p&gt;I found this comment in AlterTableNode.init(Object):&lt;/p&gt;

&lt;p&gt;		//truncate table is not suppotted in this release&lt;br/&gt;
		//semantics are not yet clearly defined by SQL Council yet&lt;br/&gt;
		//truncate will be allowed only in DEBUG builds for testing purposes.&lt;/p&gt;

&lt;p&gt;That explains why we get 0A000 on the released jars, at least.&lt;/p&gt;</comment>
                            <comment id="12577386" author="knutanders" created="Tue, 11 Mar 2008 10:54:28 +0000"  >&lt;p&gt;The NullPointerException seems to have been introduced in this commit:&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------&lt;br/&gt;
r528033 | mikem | 2007-04-12 18:58:30 +0200 (Thu, 12 Apr 2007) | 6 lines&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2537&quot; title=&quot;implement pushing collation info to store, storing collation info in store metadata, and creating templates based on store metadata&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2537&quot;&gt;&lt;del&gt;DERBY-2537&lt;/del&gt;&lt;/a&gt;, 1st incremental checking for this issue.  This changes builds&lt;br/&gt;
the framework for storing/retrieving the collation metadata in store and for&lt;br/&gt;
passing that info down from language into store.  Some paths still have&lt;br/&gt;
default collation hard coded and have been marked TODO-COLLATION.&lt;/p&gt;


&lt;p&gt;------------------------------------------------------------------------&lt;/p&gt;</comment>
                            <comment id="12578144" author="djd" created="Thu, 13 Mar 2008 04:41:16 +0000"  >&lt;p&gt;Implementing truncate table is entered as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-268&quot; title=&quot;Add Support for truncate table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-268&quot;&gt;&lt;del&gt;DERBY-268&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12582539" author="dyret" created="Thu, 27 Mar 2008 08:11:54 +0000"  >&lt;p&gt;I think the problem seen in debug mode is caused by the &apos;AlterTableConstantAction.collation&apos; array not being initialized. I&apos;ve attached a patch (derby-3352.diff) which initializes &apos;collation&apos; along with &apos;ordering&apos; which appears to be used in a similar way in truncateTable. With this change the repro runs without an NPE. All tests pass.&lt;/p&gt;

&lt;p&gt;I guess one could make the argument that truncate table should be disabled in debug mode as well, but I have not looked into that.&lt;/p&gt;</comment>
                            <comment id="12582602" author="knutanders" created="Thu, 27 Mar 2008 11:30:58 +0000"  >&lt;p&gt;I&apos;m not familiar with this code, but the fix looks simple and correct to me. To see that it actually did what it intended to do, I wrote a small JUnit test that verified that the NPE was fixed and that the table was correctly truncated. See the attached patch. The test also checks that a &quot;not implemented&quot; exception is thrown in insane builds.&lt;/p&gt;

&lt;p&gt;If we keep the TRUNCATE TABLE code in trunk, although only enabled in debug builds, I think it is worth checking in the test. Since we don&apos;t know the state of this code, it&apos;s good to have a place where we can add tests for it as a first step towards enabling it in non-debug builds as well (if it&apos;s decided that it&apos;s a good thing to have TRUNCATE TABLE in Derby).&lt;/p&gt;</comment>
                            <comment id="12583697" author="dyret" created="Mon, 31 Mar 2008 15:09:38 +0100"  >&lt;p&gt;Thanks for review and test case, Knut.&lt;br/&gt;
Committed revision 642996. (Both the patch and the JUnit tests).  &lt;/p&gt;</comment>
                            <comment id="12583708" author="dyret" created="Mon, 31 Mar 2008 15:57:24 +0100"  >&lt;p&gt;Merged to 10.4 in revision 643002.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="32428">DERBY-268</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12378688" name="derby-3352.diff" size="567" author="dyret" created="Thu, 27 Mar 2008 08:11:54 +0000"/>
                            <attachment id="12378710" name="test.diff" size="4146" author="knutanders" created="Thu, 27 Mar 2008 11:30:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 25 Jan 2008 07:54:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23589</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0lr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37342</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>