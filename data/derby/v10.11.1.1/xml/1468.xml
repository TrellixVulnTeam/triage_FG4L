<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:44:49 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1468/DERBY-1468.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1468] Server returns data when it receives a QRYROWSET value of zero on an OPNQRY, which doesn&apos;t follow DRDA protocol.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1468</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When a client sends a QRYROWSET value of zero to the server, DRDA indicates that the server should not return any rows.  But the current Derby Server treats a qryrowset value of 0 (zero) the same as it does a value of 1 (one) and thus performs pre-fetching (as of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-822&quot; title=&quot;Client driver: Pre-fetch data on executeQuery()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-822&quot;&gt;&lt;del&gt;DERBY-822&lt;/del&gt;&lt;/a&gt;), which it shouldn&apos;t do.&lt;/p&gt;

&lt;p&gt;As a result, clients that send a QRYROWSET of 0 and do not expect data could see unexpected results--for example, the DB2 ODBC driver will return the first row of data twice for scrollable cursors because of this issue.&lt;/p&gt;

&lt;p&gt;Relevant discussion:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://article.gmane.org/gmane.comp.apache.db.derby.devel/22659&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://article.gmane.org/gmane.comp.apache.db.derby.devel/22659&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Some quotes from DRDA manuals:&lt;/p&gt;

&lt;p&gt;1) DRDA Manual v3 for OPNQRY:&lt;/p&gt;

&lt;p&gt;The qryrowset parameter specifies whether a rowset of rows is to be returned with the command.  This is only honored for non-dynamic scrollable cursors (QRYATTSNS not equal to QRYSNSDYN) and for non-scrollable cursors conforming to the limited block query protocol.  The target server fetches no more than the requested number of rows. It may fetch fewer rows if it is restricted by extra query block limits, or if a fetch operation results in a negative SQLSTATE or an SQLSTATE of 02000.&lt;/p&gt;

&lt;p&gt;2) Page 698 of V.3 says:&lt;/p&gt;

&lt;p&gt;A QRYROWSET value of zero on the OPNQRY and EXCSQLSTT commands instructs the server to return no rows with the OPNQRYRM for the cursor or result set. A QRYROWSET value of zero on the CNTQRY command is invalid for non-rowset cursors and results in the application server generating a SYNTAXRM with a SYNERRCD value of &apos;15&apos;x (reserved value not allowed).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12345259">DERBY-1468</key>
            <summary>Server returns data when it receives a QRYROWSET value of zero on an OPNQRY, which doesn&apos;t follow DRDA protocol.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="army">A B</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Jun 2006 23:33:48 +0100</created>
                <updated>Tue, 30 Jun 2009 16:55:39 +0100</updated>
                            <resolved>Mon, 3 Jul 2006 13:57:25 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12418698" author="knutanders" created="Sat, 1 Jul 2006 03:35:22 +0100"  >&lt;p&gt;The attached patch (v1) disables pre-fetching for LMTBLKPRC when QRYROWSET=0. Army could you please see if solves the issue with the ODBC driver?&lt;/p&gt;

&lt;p&gt;Since there is no way I know of to reproduce the bug with the network client driver, I have added a test case to the protocol test which sends an OPNQRY for a scrollable cursor with QRYROWSET=0. The test case fails without the patch and succeeds with the patch. I think the test case mimics the behaviour of the ODBC driver.&lt;/p&gt;

&lt;p&gt;One thing to note about the patch: It does revert the handling of the specific case to pre-822 behaviour, but it does nothing with writeQRYDTA and writeFDODTA to make them handle QRYROWSET=0. writeQRYDTA() can still be called with QRYROWSET=0 on EXCSQLSTT. I&apos;m not sure whether that is a problem, and the code that enables this was not touched by &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-822&quot; title=&quot;Client driver: Pre-fetch data on executeQuery()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-822&quot;&gt;&lt;del&gt;DERBY-822&lt;/del&gt;&lt;/a&gt;. EXCSQLSTT should probably have a similar fix for completeness. (A possible way to try to provoke this with the ODBC driver could be to execute a stored procedure that returns a scrollable result set.)&lt;/p&gt;

&lt;p&gt;Derbyall runs cleanly with the patch.&lt;/p&gt;</comment>
                            <comment id="12418737" author="army" created="Sat, 1 Jul 2006 08:02:45 +0100"  >&lt;p&gt;&amp;gt; Army could you please see if solves the issue with the ODBC driver? &lt;/p&gt;

&lt;p&gt;I&apos;m not able to run the full set of ODBC tests because the harness on my machine is currently in a bad state (sigh), but I was able to run the repro that prompted the filing of this issue, and I have confirmed that with your patch applied the ODBC repro runs as it should.&lt;/p&gt;

&lt;p&gt;&amp;gt; Since there is no way I know of to reproduce the bug with the network &lt;br/&gt;
&amp;gt; client driver, I have added a test case to the protocol test which sends &lt;br/&gt;
&amp;gt; an OPNQRY for a scrollable cursor with QRYROWSET=0.&lt;/p&gt;

&lt;p&gt;Good thinking--sounds like a great plan.  I ran the test with and without your patch, and it behaves as you describe.&lt;/p&gt;

&lt;p&gt;&amp;gt; EXCSQLSTT should probably have a similar fix for completeness. (A &lt;br/&gt;
&amp;gt; possible way to try to provoke this with the ODBC driver could be to &lt;br/&gt;
&amp;gt; execute a stored procedure that returns a scrollable result set.) &lt;/p&gt;

&lt;p&gt;When I can find the time I will experiment with this.  If this proves to be a problem then I&apos;ll create a separate Jira issue to address it--one that is &lt;em&gt;not&lt;/em&gt; considered a regression of &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-822&quot; title=&quot;Client driver: Pre-fetch data on executeQuery()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-822&quot;&gt;&lt;del&gt;DERBY-822&lt;/del&gt;&lt;/a&gt; since, as you said, the relevant code wasn&apos;t touched with 822.&lt;/p&gt;

&lt;p&gt;Thanks for addressing this so quickly!&lt;/p&gt;</comment>
                            <comment id="12418902" author="knutanders" created="Mon, 3 Jul 2006 13:57:25 +0100"  >&lt;p&gt;Thanks for the review, Army! Committed revision 418691.&lt;/p&gt;</comment>
                            <comment id="12420387" author="army" created="Wed, 12 Jul 2006 02:07:02 +0100"  >&lt;p&gt;Fix committed and I verified using the ODBC test that prompted the filing of the issue.  Thanks for addressing this, Knut  Anders.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12336215" name="derby-1468-v1.diff" size="3086" author="knutanders" created="Sat, 1 Jul 2006 03:35:22 +0100"/>
                            <attachment id="12336216" name="derby-1468-v1.stat" size="234" author="knutanders" created="Sat, 1 Jul 2006 03:35:22 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 1 Jul 2006 02:35:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22525</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0v0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38843</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>