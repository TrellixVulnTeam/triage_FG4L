<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:08:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-6371/DERBY-6371.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-6371] DROP COLUMN looks in wrong schema when checking trigger dependencies</title>
                <link>https://issues.apache.org/jira/browse/DERBY-6371</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;If you define a trigger in another schema than the current schema, and the trigger action references tables in the current schema without explicit schema names, ALTER TABLE DROP COLUMN may get confused when checking dependencies.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table s1.t1(x int, y int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create table s1.t2(x int, y int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; set schema s1;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create trigger s2.tr after update of x on t1 for each row insert into t2&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; select x from t1;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; alter table s1.t1 drop column y restrict;&lt;br/&gt;
ERROR X0Y25: Operation &apos;DROP COLUMN&apos; cannot be performed on object &apos;Y&apos; because TRIGGER &apos;TR&apos; is dependent on that object.&lt;/p&gt;

&lt;p&gt;The ALTER TABLE statement should have succeeded, because the trigger does not depend on column Y.&lt;/p&gt;

&lt;p&gt;If you create dummy tables in S2 with the same names as those in S1, the same ALTER TABLE statement succeeds:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; create table s2.t1(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; create table s2.t2(x int);&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; alter table s1.t1 drop column y restrict;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;/p&gt;

&lt;p&gt;The existence of these unrelated tables should not affect whether you&apos;re allowed to drop the column.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12672322">DERBY-6371</key>
            <summary>DROP COLUMN looks in wrong schema when checking trigger dependencies</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Oct 2013 12:52:41 +0100</created>
                <updated>Wed, 21 Jan 2015 00:23:35 +0000</updated>
                            <resolved>Thu, 10 Oct 2013 12:06:06 +0100</resolved>
                                    <version>10.10.1.1</version>
                    <version>10.10.2.0</version>
                                    <fixVersion>10.10.2.0</fixVersion>
                    <fixVersion>10.11.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13786106" author="knutanders" created="Fri, 4 Oct 2013 13:25:47 +0100"  >&lt;p&gt;It seems to behave more reasonably in the example above if AlterTableConstantAction.columnDroppedAndTriggerDependencies() is changed to set compSchema to the SPS&apos;s compilation schema instead of the trigger&apos;s schema. See the attached patch compSchema.diff (not tested, except with the repro for this bug).&lt;/p&gt;</comment>
                            <comment id="13789070" author="knutanders" created="Tue, 8 Oct 2013 10:44:36 +0100"  >&lt;p&gt;Attaching derby-6371-1a.diff which fixes the bug by making the dependency checking use the same schema as the trigger (re-)compilation. The patch adds a test case that verifies that it is now possible to drop columns not referenced by the trigger in the case where it previously failed. The test also exercises the dependency check with compilation schema NULL (when the trigger was created by a user with no schema) to make sure the fix doesn&apos;t introduce problems like those reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6361&quot; title=&quot;Valid statements rejected if Derby has not implicitly created the current user&amp;#39;s schema.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6361&quot;&gt;&lt;del&gt;DERBY-6361&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;All regression tests passed.&lt;/p&gt;</comment>
                            <comment id="13790145" author="jira-bot" created="Wed, 9 Oct 2013 08:55:51 +0100"  >&lt;p&gt;Commit 1530517 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1530517&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1530517&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6371&quot; title=&quot;DROP COLUMN looks in wrong schema when checking trigger dependencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6371&quot;&gt;&lt;del&gt;DERBY-6371&lt;/del&gt;&lt;/a&gt;: DROP COLUMN looks in wrong schema when checking trigger dependencies&lt;/p&gt;

&lt;p&gt;Use the same schema during dependency checking as during compilation&lt;br/&gt;
of the trigger action.&lt;/p&gt;</comment>
                            <comment id="13791371" author="knutanders" created="Thu, 10 Oct 2013 11:31:31 +0100"  >&lt;p&gt;Reopening the issue since there&apos;s one more occurrence of the wrong schema in the trigger dependency tracking, in TriggerDescriptor.getActionSPS().&lt;/p&gt;

&lt;p&gt;That occurrence doesn&apos;t cause any problems, as far as I can see, because it only parses the trigger action. Problems would not surface until bind time, but the returned parse tree is not passed on to binding. (It is used for rewriting the trigger action statement to replace references to OLD/NEW transition variables with internal method call syntax.)&lt;/p&gt;

&lt;p&gt;Even though it doesn&apos;t currently cause any problems, I think we should fix it for consistency.&lt;/p&gt;</comment>
                            <comment id="13791374" author="knutanders" created="Thu, 10 Oct 2013 11:36:20 +0100"  >&lt;p&gt;Attaching derby-6371-2a.diff, which makes TriggerDescriptor.getActionSPS() use the compilation schema rather than the trigger&apos;s schema when parsing the trigger definition.&lt;/p&gt;

&lt;p&gt;Running regression tests.&lt;/p&gt;</comment>
                            <comment id="13791379" author="jira-bot" created="Thu, 10 Oct 2013 11:57:59 +0100"  >&lt;p&gt;Commit 1530913 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knutanders&quot; class=&quot;user-hover&quot; rel=&quot;knutanders&quot;&gt;Knut Anders Hatlen&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1530913&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1530913&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6371&quot; title=&quot;DROP COLUMN looks in wrong schema when checking trigger dependencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6371&quot;&gt;&lt;del&gt;DERBY-6371&lt;/del&gt;&lt;/a&gt;: DROP COLUMN looks in wrong schema when checking trigger dependencies&lt;/p&gt;

&lt;p&gt;Fix another occurrence where the wrong schema is used. This occurrence&lt;br/&gt;
doesn&apos;t cause any problems currently, since it&apos;s only used for&lt;br/&gt;
parsing, and the problems wouldn&apos;t appear until one attempt to do&lt;br/&gt;
binding with the incorrect schema. Fix it anyway for consistency.&lt;/p&gt;</comment>
                            <comment id="13791392" author="knutanders" created="Thu, 10 Oct 2013 12:06:06 +0100"  >&lt;p&gt;All tests passed with the 2a patch, and I&apos;ve committed it. Marking the issue as resolved again.&lt;/p&gt;</comment>
                            <comment id="13913293" author="mikem" created="Wed, 26 Feb 2014 18:41:24 +0000"  >&lt;p&gt;consider for 10.10 backport&lt;/p&gt;</comment>
                            <comment id="13915169" author="myrna" created="Thu, 27 Feb 2014 23:11:31 +0000"  >&lt;p&gt;I am looking at backporting this one.&lt;/p&gt;</comment>
                            <comment id="13915249" author="jira-bot" created="Fri, 28 Feb 2014 00:08:54 +0000"  >&lt;p&gt;Commit 1572788 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=myrna&quot; class=&quot;user-hover&quot; rel=&quot;myrna&quot;&gt;Myrna van Lunteren&lt;/a&gt; in branch &apos;code/branches/10.10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1572788&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1572788&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-6371&quot; title=&quot;DROP COLUMN looks in wrong schema when checking trigger dependencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-6371&quot;&gt;&lt;del&gt;DERBY-6371&lt;/del&gt;&lt;/a&gt;; DROP COLUMN looks in wrong schema when checking trigger dependencies&lt;br/&gt;
  backport of revisions 1530517 and 1530913 from trunk&lt;/p&gt;</comment>
                            <comment id="14284825" author="myrna" created="Wed, 21 Jan 2015 00:23:35 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12695601">DERBY-6481</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12606776" name="compSchema.diff" size="924" author="knutanders" created="Fri, 4 Oct 2013 13:25:47 +0100"/>
                            <attachment id="12607339" name="derby-6371-1a.diff" size="5927" author="knutanders" created="Tue, 8 Oct 2013 10:44:36 +0100"/>
                            <attachment id="12607778" name="derby-6371-2a.diff" size="1673" author="knutanders" created="Thu, 10 Oct 2013 11:36:20 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Oct 2013 07:55:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>351948</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hziiwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352236</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>