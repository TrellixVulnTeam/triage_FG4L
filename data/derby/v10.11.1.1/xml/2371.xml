<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:34:25 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2371/DERBY-2371.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2371] Setting a default value for a VARCHAR column fails when column contains data</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2371</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I&apos;m seeing a problem updating the default value for a VARCHAR column when the column already contains data. I&apos;m, using:&lt;/p&gt;

&lt;p&gt;alter table TABLE_NAME alter column COL_NAME DEFAULT &apos;new value&apos;&lt;/p&gt;

&lt;p&gt;and with some VARCHAR columns I get an error like this:&lt;/p&gt;

&lt;p&gt;Invalid character string format for type long.; nested exception is java.sql.SQLException: Invalid character string format for type long.&lt;br/&gt;
Caused by: ERROR 22018: Invalid character string format for type long.&lt;br/&gt;
       at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)&lt;br/&gt;
       at org.apache.derby.iapi.types.SQLChar.getLong(Unknown Source)&lt;br/&gt;
       at org.apache.derby.impl.sql.execute.AlterTableConstantAction.getColumnMax(Unknown Source)&lt;br/&gt;
       at org.apache.derby.impl.sql.execute.AlterTableConstantAction.modifyColumnDefault(Unknown Source)&lt;br/&gt;
       at org.apache.derby.impl.sql.execute.AlterTableConstantAction.execGuts(Unknown Source)&lt;br/&gt;
       at org.apache.derby.impl.sql.execute.AlterTableConstantAction.executeConstantAction(Unknown Source)&lt;br/&gt;
       at org.apache.derby.impl.sql.execute.MiscResultSet.open(Unknown Source)&lt;br/&gt;
       at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)&lt;br/&gt;
       at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)&lt;br/&gt;
       at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)&lt;br/&gt;
       at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)&lt;/p&gt;


&lt;p&gt;This only happens on VARCHAR columns containing data. Columns that are entirely NULL update fine. &lt;/p&gt;

&lt;p&gt;This was discussed on users mailing list:&lt;br/&gt;
&lt;a href=&quot;http://www.nabble.com/problem-with-ALTER-COLUMN-DEFAULT-on-VARCHAR-column-tf3274046.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/problem-with-ALTER-COLUMN-DEFAULT-on-VARCHAR-column-tf3274046.html&lt;/a&gt;&lt;br/&gt;
and the conclusion was that it is related to this statement being run internally as part of the updata process:&lt;br/&gt;
SELECT MAX(COL_NAME) FROM TABLE_NAME  &lt;/p&gt;

&lt;p&gt;As reported in that discussion:&lt;/p&gt;

&lt;p&gt;-bash-2.05b$ java org.apache.derby.tools.ij&lt;br/&gt;
ij version 10.3&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:brydb&apos;;&lt;br/&gt;
ij&amp;gt; create table t (a varchar(10));&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; alter table t alter column a default &apos;my val&apos;;&lt;br/&gt;
0 rows inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; insert into t (a) values (&apos;hi&apos;);&lt;br/&gt;
1 row inserted/updated/deleted&lt;br/&gt;
ij&amp;gt; alter table t alter column a default &apos;another val&apos;;&lt;br/&gt;
ERROR 22018: Invalid character string format for type long.&lt;/p&gt;
</description>
                <environment>This probably affects all platforms.</environment>
        <key id="12363497">DERBY-2371</key>
            <summary>Setting a default value for a VARCHAR column fails when column contains data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="tdudgeon">Tim Dudgeon</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Feb 2007 16:13:47 +0000</created>
                <updated>Fri, 21 Jan 2011 17:49:49 +0000</updated>
                            <resolved>Tue, 27 Feb 2007 17:41:18 +0000</resolved>
                                    <version>10.2.1.6</version>
                    <version>10.2.2.0</version>
                                    <fixVersion>10.2.2.1</fixVersion>
                    <fixVersion>10.3.1.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12475654" author="bryanpendleton" created="Sat, 24 Feb 2007 21:31:08 +0000"  >&lt;p&gt;The problem arises in AlterTableConstantAction.modifyColumnDefault, which &lt;br/&gt;
only understands two types of modifications that can be made to a column&apos;s default value:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;changing the INCREMENT BY value for a generated IDENTITY column&lt;/li&gt;
	&lt;li&gt;changing the RESTART WITH value for a generated IDENTITY column&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But there is a third type of modification that can be made to a column&apos;s default&lt;br/&gt;
value, which is simply to change the default value that is to be used for an&lt;br/&gt;
ordinary column if no value is provided when inserting a new row into that table.&lt;/p&gt;

&lt;p&gt;The fix is to add a new ColumnInfo modification type code:&lt;br/&gt;
   MODIFY_COLUMN_DEFAULT_VALUE&lt;br/&gt;
and to teach ModifyColumnNode and AlterTableConstantAction what to do&lt;br/&gt;
for modifications of type MODIFY_COLUMN_DEFAULT_VALUE.&lt;/p&gt;

&lt;p&gt;I&apos;ve got a diff ready, and will post it after running the regression tests.&lt;/p&gt;</comment>
                            <comment id="12475694" author="bryanpendleton" created="Sun, 25 Feb 2007 04:54:35 +0000"  >&lt;p&gt;All the regression tests passed (once I remembered to up the memory for the &lt;br/&gt;
JUnit suite). Attached is modifyValue.diff, a proposed patch for this issue. &lt;/p&gt;

&lt;p&gt;The patch adds a new action code to the ModifyColumnNode to distinguish&lt;br/&gt;
the case where the column modification is for changing the default value,&lt;br/&gt;
and does not  involve any generated identity column.&lt;/p&gt;

&lt;p&gt;A new test case is added to altertable.sql, based directly on the repro script.&lt;/p&gt;

&lt;p&gt;Please let me know your comments and suggestions.&lt;/p&gt;</comment>
                            <comment id="12475820" author="sv204098" created="Mon, 26 Feb 2007 05:31:16 +0000"  >&lt;p&gt;Hi Bryan, I did some quick tests on your patch &amp;amp; it works perfectly fine. &lt;/p&gt;

&lt;p&gt;+1 to commit.&lt;/p&gt;

&lt;p&gt;Saurabh&lt;/p&gt;</comment>
                            <comment id="12475893" author="bryanpendleton" created="Mon, 26 Feb 2007 16:36:34 +0000"  >&lt;p&gt;Thanks Saurabh!&lt;/p&gt;

&lt;p&gt;I intend to commit this patch to the trunk in the next day or so, and then merge the change to 10.2.&lt;/p&gt;</comment>
                            <comment id="12476008" author="bryanpendleton" created="Mon, 26 Feb 2007 21:27:32 +0000"  >&lt;p&gt;Committed to the trunk as revision 512019. Will merge to 10.2 now.&lt;/p&gt;</comment>
                            <comment id="12476241" author="bryanpendleton" created="Tue, 27 Feb 2007 17:41:18 +0000"  >&lt;p&gt;Merged the trunk change to the 10.2 branch. The altertable.sql file &lt;br/&gt;
needed hand-resolution of the merge, but the rest of the merging&lt;br/&gt;
was straightforward. 10.2 regression tests passed without error.&lt;/p&gt;

&lt;p&gt;Committed the change to the 10.2 branch as revision 512334.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12351996" name="modifyValue.diff" size="6102" author="bryanpendleton" created="Sun, 25 Feb 2007 04:54:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 24 Feb 2007 21:31:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23026</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0mmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37483</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>