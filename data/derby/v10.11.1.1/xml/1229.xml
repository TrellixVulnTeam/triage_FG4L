<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:10:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1229/DERBY-1229.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1229] sysinfo and sysinfo_withproperties.java fail with java.lang.RuntimePermission getProtectionDomain when db2jcc.jar is in same dir as the derby-jars</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1229</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The problem I&apos;ve been seeing is that if I run:&lt;/p&gt;

&lt;p&gt;java -Dframework=DerbyNetClient org.apache.derbyTesting.functionTests.harness.RunTest derbynet/sysinfo.java&lt;/p&gt;

&lt;p&gt;in a configuration where my db2jcc.jar is located in the same directory as all the other derby-jars, then the test fails with a diff caused by a RuntimeException. If I change nothing else then moving that db2jcc.jar out of that directory (and making the appropriate classpath change) then the test succeeds.&lt;/p&gt;

&lt;p&gt;The reason is that the test fails to get the permission for doing getProtectionDomain().getCodeSource() on class com.ibm.db2.jcc.DB2Driver. Below follows relevant output from my system that might be useful to debug this:&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;/p&gt;

&lt;p&gt;vo136787@khepri32:~/tmp/test&amp;gt; env |grep CLAS CLASSPATH=/home/vo136787/derby/tmp/testbuild/lib/derby.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyTesting.jar:/home/vo136787/derby/tmp/testbuild/lib/derbytools.jar:/home/vo136787/derby/tmp/testbuild/lib/derbynet.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyclient.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyrun.jar:/home/vo136787/derby/tmp/testbuild/lib/junit.jar:/home/vo136787/derby/tmp/testbuild/lib/db2jcc.jar:/home/vo136787/derby/tmp/testbuild/lib/db2jcc_license_c.jar:/home/vo136787/derby/tmp/testbuild/lib/jakarta-oro-2.0.8.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_de_DE.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_es.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_fr.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_it.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_ja_JP.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_ko_KR.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_pt_BR.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_zh_CN.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_zh_TW.jar&lt;br/&gt;
vo136787@khepri32:~/tmp/test&amp;gt; java -Dframework=DerbyNetClient org.apache.derbyTesting.functionTests.harness.RunTest derbynet/sysinfo.java&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;Start: sysinfo jdk1.5.0_06 DerbyNetClient 2006-04-19 13:00:33 ***&lt;br/&gt;
Initialize for framework: DerbyNetClient&lt;br/&gt;
java -Dderby.system.home=/home/vo136787/tmp/test/DerbyNetClient/sysinfo -Djava.security.manager -Djava.security.policy=/home/vo136787/tmp/test/derby_tests.policy -DderbyTesting.codejar=&lt;a href=&quot;file:/home/vo136787/derby/tmp/testbuild/lib/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/home/vo136787/derby/tmp/testbuild/lib/&lt;/a&gt; -DderbyTesting.codedir=/home/vo136787/derby/tmp/testbuild/lib -DderbyTesting.serverhost=localhost -DderbyTesting.clienthost=localhost -DderbyTesting.codeclasses=&lt;a href=&quot;file://unused/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file://unused/&lt;/a&gt; org.apache.derby.drda.NetworkServerControl start&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;SecurityManager not installed &amp;#8211;&lt;br/&gt;
Attempt to shutdown framework: DerbyNetClient&lt;br/&gt;
14a15&lt;br/&gt;
&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Unable to access Protection Domain or Code Source for class class com.ibm.db2.jcc.DB2Driver: access denied (java.lang.RuntimePermission getProtectionDomain)&amp;#93;&lt;/span&gt; 2.4 - (17)&lt;br/&gt;
41a43&lt;br/&gt;
&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Unable to access Protection Domain or Code Source for class class com.ibm.db2.jcc.DB2Driver: access denied (java.lang.RuntimePermission getProtectionDomain)&amp;#93;&lt;/span&gt; 2.4 - (17)&lt;br/&gt;
69a72&lt;br/&gt;
&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Unable to access Protection Domain or Code Source for class class com.ibm.db2.jcc.DB2Driver: access denied (java.lang.RuntimePermission getProtectionDomain)&amp;#93;&lt;/span&gt; 2.4 - (17)&lt;br/&gt;
Test Failed.
		&lt;ul&gt;
			&lt;li&gt;End:   sysinfo jdk1.5.0_06 DerbyNetClient 2006-04-19 13:00:40 ***&lt;br/&gt;
vo136787@khepri32:~/tmp/test&amp;gt; java org.apache.derby.tools.sysinfo
			&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
				&lt;li&gt;
				&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
					&lt;li&gt;
					&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
						&lt;li&gt;
						&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
							&lt;li&gt;
							&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
								&lt;li&gt;
								&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
									&lt;li&gt;
									&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
										&lt;li&gt;
										&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
											&lt;li&gt;
											&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
												&lt;li&gt;
												&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
													&lt;li&gt;
													&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
														&lt;li&gt;
														&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
															&lt;li&gt;
															&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
																&lt;li&gt;
																&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
																	&lt;li&gt;
																	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
																		&lt;li&gt;Java Information ------------------&lt;br/&gt;
Java Version:    1.5.0_06&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
Java home:       /usr/jdk/instances/jdk1.5.0/jre&lt;br/&gt;
Java classpath:  /home/vo136787/derby/tmp/testbuild/lib/derby.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyTesting.jar:/home/vo136787/derby/tmp/testbuild/lib/derbytools.jar:/home/vo136787/derby/tmp/testbuild/lib/derbynet.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyclient.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyrun.jar:/home/vo136787/derby/tmp/testbuild/lib/junit.jar:/home/vo136787/derby/tmp/testbuild/lib/db2jcc.jar:/home/vo136787/derby/tmp/testbuild/lib/db2jcc_license_c.jar:/home/vo136787/derby/tmp/testbuild/lib/jakarta-oro-2.0.8.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_de_DE.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_es.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_fr.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_it.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_ja_JP.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_ko_KR.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_pt_BR.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_zh_CN.jar:/home/vo136787/derby/tmp/testbuild/lib/derbyLocale_zh_TW.jar&lt;br/&gt;
OS name:         SunOS&lt;br/&gt;
OS architecture: x86&lt;br/&gt;
OS version:      5.10&lt;br/&gt;
Java user name:  vo136787&lt;br/&gt;
Java user home:  /home/vo136787&lt;br/&gt;
Java user dir:   /home/vo136787/tmp/test&lt;br/&gt;
java.specification.name: Java Platform API Specification&lt;br/&gt;
java.specification.version: 1.5&lt;/li&gt;
																	&lt;/ul&gt;
																	&lt;/li&gt;
																&lt;/ul&gt;
																&lt;/li&gt;
															&lt;/ul&gt;
															&lt;/li&gt;
														&lt;/ul&gt;
														&lt;/li&gt;
													&lt;/ul&gt;
													&lt;/li&gt;
												&lt;/ul&gt;
												&lt;/li&gt;
											&lt;/ul&gt;
											&lt;/li&gt;
										&lt;/ul&gt;
										&lt;/li&gt;
									&lt;/ul&gt;
									&lt;/li&gt;
									&lt;li&gt;Derby Information --------&lt;br/&gt;
JRE - JDBC: J2SE 5.0 - JDBC 3.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/vo136787/derby/tmp/testbuild/lib/derby.jar&amp;#93;&lt;/span&gt; 10.2.0.0 alpha - (394991)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/vo136787/derby/tmp/testbuild/lib/derbytools.jar&amp;#93;&lt;/span&gt; 10.2.0.0 alpha - (394991)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/vo136787/derby/tmp/testbuild/lib/derbynet.jar&amp;#93;&lt;/span&gt; 10.2.0.0 alpha - (394991)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/vo136787/derby/tmp/testbuild/lib/derbyclient.jar&amp;#93;&lt;/span&gt; 10.2.0.0 alpha - (394991)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/vo136787/derby/tmp/testbuild/lib/db2jcc.jar&amp;#93;&lt;/span&gt; 2.4 - (17)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/vo136787/derby/tmp/testbuild/lib/db2jcc_license_c.jar&amp;#93;&lt;/span&gt; 2.4 - (17)&lt;br/&gt;
------------------------------------------------------
									&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
										&lt;li&gt;
										&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
											&lt;li&gt;
											&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
												&lt;li&gt;
												&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
													&lt;li&gt;
													&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
														&lt;li&gt;
														&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
															&lt;li&gt;
															&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
																&lt;li&gt;
																&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
																	&lt;li&gt;Locale Information -----------------&lt;br/&gt;
Current Locale :  [English/United States &lt;span class=&quot;error&quot;&gt;&amp;#91;en_US&amp;#93;&lt;/span&gt;]&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;de_DE&amp;#93;&lt;/span&gt;&lt;br/&gt;
        version: 10.2.0.0 alpha - (394991)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;es&amp;#93;&lt;/span&gt;&lt;br/&gt;
        version: 10.2.0.0 alpha - (394991)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;fr&amp;#93;&lt;/span&gt;&lt;br/&gt;
        version: 10.2.0.0 alpha - (394991)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;it&amp;#93;&lt;/span&gt;&lt;br/&gt;
        version: 10.2.0.0 alpha - (394991)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ja_JP&amp;#93;&lt;/span&gt;&lt;br/&gt;
        version: 10.2.0.0 alpha - (394991)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;ko_KR&amp;#93;&lt;/span&gt;&lt;br/&gt;
        version: 10.2.0.0 alpha - (394991)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;pt_BR&amp;#93;&lt;/span&gt;&lt;br/&gt;
        version: 10.2.0.0 alpha - (394991)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;zh_CN&amp;#93;&lt;/span&gt;&lt;br/&gt;
        version: 10.2.0.0 alpha - (394991)&lt;br/&gt;
Found support for locale: &lt;span class=&quot;error&quot;&gt;&amp;#91;zh_TW&amp;#93;&lt;/span&gt;&lt;br/&gt;
        version: 10.2.0.0 alpha - (394991)&lt;br/&gt;
------------------------------------------------------&lt;br/&gt;
vo136787@khepri32:~/tmp/test&amp;gt; java org.apache.derby.tools.sysinfo -cp&lt;br/&gt;
Testing for presence of all Derby-related libraries; typically, only some are needed.&lt;br/&gt;
For a list of possible arguments, type java org.apache.derby.tools.sysinfo -cp args&lt;br/&gt;
FOUND IN CLASS PATH:&lt;/li&gt;
																&lt;/ul&gt;
																&lt;/li&gt;
															&lt;/ul&gt;
															&lt;/li&gt;
														&lt;/ul&gt;
														&lt;/li&gt;
													&lt;/ul&gt;
													&lt;/li&gt;
												&lt;/ul&gt;
												&lt;/li&gt;
											&lt;/ul&gt;
											&lt;/li&gt;
										&lt;/ul&gt;
										&lt;/li&gt;
									&lt;/ul&gt;
									&lt;/li&gt;
								&lt;/ul&gt;
								&lt;/li&gt;
							&lt;/ul&gt;
							&lt;/li&gt;
						&lt;/ul&gt;
						&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  Derby embedded engine library (derby.jar)&lt;br/&gt;
  /home/vo136787/derby/tmp/testbuild/lib/derby.jar&lt;/p&gt;


&lt;p&gt;  Derby embedded engine library (derby.jar)&lt;br/&gt;
  /home/vo136787/derby/tmp/testbuild/lib/derby.jar&lt;/p&gt;


&lt;p&gt;  Derby Network Server library (derbynet.jar)&lt;br/&gt;
  /home/vo136787/derby/tmp/testbuild/lib/derbynet.jar&lt;/p&gt;


&lt;p&gt;  Derby Client libraries (db2jcc.jar)&lt;br/&gt;
  /home/vo136787/derby/tmp/testbuild/lib/db2jcc.jar&lt;/p&gt;


&lt;p&gt;  Derby Client libraries (derbyclient.jar)&lt;br/&gt;
  /home/vo136787/derby/tmp/testbuild/lib/derbyclient.jar&lt;/p&gt;



&lt;p&gt;NOT FOUND IN CLASS PATH:&lt;/p&gt;

&lt;p&gt;  Derby tools library (derbytools.jar)&lt;br/&gt;
   (org.apache.derby.tools.ij not found.)&lt;/p&gt;</description>
                <environment>Solaris 10 x86&lt;br/&gt;
Sun JDK &lt;br/&gt;
java version &amp;quot;1.5.0_06&amp;quot;&lt;br/&gt;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_06-b05)&lt;br/&gt;
Java HotSpot(TM) Client VM (build 1.5.0_06-b05, mixed mode, sharing)&lt;br/&gt;
</environment>
        <key id="12332420">DERBY-1229</key>
            <summary>sysinfo and sysinfo_withproperties.java fail with java.lang.RuntimePermission getProtectionDomain when db2jcc.jar is in same dir as the derby-jars</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanpendleton">Bryan Pendleton</assignee>
                                    <reporter username="vemund">Vemund &#216;stgaard</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Apr 2006 18:03:59 +0100</created>
                <updated>Wed, 1 Jul 2009 01:09:08 +0100</updated>
                            <resolved>Sun, 7 May 2006 04:38:36 +0100</resolved>
                                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Test</component>
                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12375657" author="bryanpendleton" created="Sat, 22 Apr 2006 08:26:51 +0100"  >&lt;p&gt;Can you confirm that if you add the following line to derby_tests.policy, the problem goes away? The line should be added to all three of the derby.jar, derbynet.jar, and derbytools.jar sections, which is easiest to do if you just search for &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-622&quot; title=&quot;sysinfo incorrectly requires permission on Derby jar files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-622&quot;&gt;&lt;del&gt;DERBY-622&lt;/del&gt;&lt;/a&gt;&quot; and then add this line right after it:&lt;/p&gt;

&lt;p&gt;permission java.lang.RuntimePermission &quot;getProtectionDomain&quot;;&lt;/p&gt;

&lt;p&gt;In some ways, what&apos;s confusing about this bug is not that you have to add this line, it&apos;s that nobody else has had to add this line. From what I can tell by reading the Sun javadocs, everybody should have needed the getProtectionDomain permission, and certainly when I wrote a simple standalone test program, the program failed unless I gave it the getProtectionDomain permission. So I don&apos;t understand why the rest of us have been getting away without having this permission in place.&lt;/p&gt;

&lt;p&gt;If you could please try adding the permission to the derby_tests.policy file, and verify that the sysinfo and sysinfo_withproperties tests then pass, that would be nice. Thanks!&lt;/p&gt;</comment>
                            <comment id="12377039" author="kmarsden" created="Sat, 29 Apr 2006 08:05:45 +0100"  >&lt;p&gt;I am concerned about  adding this line to the test policy file.&lt;br/&gt;
Does this mean that&lt;/p&gt;

&lt;p&gt;permission java.lang.RuntimePermission &quot;getProtectionDomain&quot;; &lt;/p&gt;

&lt;p&gt;is now required for the product or  is it just for sysinfo?&lt;/p&gt;

&lt;p&gt;I have three concerns.&lt;br/&gt;
1) This is a fairly dangerous permission.&lt;br/&gt;
2) Policy files are often site specific and difficult to modify  in a product roll out scenario to require new permissions .&lt;br/&gt;
3) Such a change  breaks backward compatibility in my view as this permission has not been required before.&lt;br/&gt;
4) Even if the permission is just for sysinfo, if you add it to the derby_tests.policy file it means that a new change could make the product require it and we would catch it.&lt;/p&gt;

&lt;p&gt;Even for sysinfo  I didn&apos;t like this,  but since right now it is only really suitable as a command-line tool,  I thought maybe it was ok.   I  am starting to think that maybe sysinfo&lt;br/&gt;
should at least print abbreviated information and  a warning if it could not do whatever it is trying to do with getProtectionDomain instead of giving this error. &lt;/p&gt;

&lt;p&gt;Kathey&lt;/p&gt;</comment>
                            <comment id="12377042" author="bryanpendleton" created="Sat, 29 Apr 2006 08:19:48 +0100"  >&lt;p&gt;&amp;gt; maybe sysinfo should at least print abbreviated information and a warning if it could not do whatever it is trying to do with getProtectionDomain instead of giving this error.&lt;/p&gt;

&lt;p&gt;Good point. I believe that Sysinfo actually already has the behavior you desire. The &quot;error&quot; that the bug reporter is experiencing is in fact just the warning message that sysinfo prints when it is refused information about the underlying jar file&apos;s locaion due to the lack of getProtectionDomain permission.&lt;/p&gt;

&lt;p&gt;The issue is that our current sysinfo test script master files are written assuming that you have this permission. So, the alternate fix is that we could change our master files to assume that you do &lt;b&gt;not&lt;/b&gt; have this permission when you run. &lt;br/&gt;
The curious thing is, sometimes you don&apos;t seem to need this permission, and I can&apos;t currently explain this behavior. I don&apos;t understand why most of the people on derby-dev (including myself) do not see this problem, and yet 2 or 3 people see it reliably.&lt;/p&gt;

&lt;p&gt;Since I can&apos;t make it happen in any of the environments I have access to, I&apos;m sort of confused.&lt;/p&gt;</comment>
                            <comment id="12377045" author="kmarsden" created="Sat, 29 Apr 2006 08:41:57 +0100"  >&lt;p&gt;Thanks for explaining the issue.  Whatever   solution we go with,  I don&apos;t think it should be to  grant getProtectionDomain permission for all the jars  for every test we run.&lt;/p&gt;
</comment>
                            <comment id="12377046" author="bryanpendleton" created="Sat, 29 Apr 2006 08:44:13 +0100"  >&lt;p&gt;I got a little tongue-tied in my previous comment. Let me try again:&lt;/p&gt;

&lt;p&gt;My preferred fix would be to:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;leave derby_tests.policy alone, &lt;b&gt;without&lt;/b&gt; the getProtectionDomain permission&lt;/li&gt;
	&lt;li&gt;change the sysinfo test master files to match the behavior that we (should) get without the permission. That is, to have the warning message in them.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;However, in my environment at least, my derby_tests.policy file does &lt;b&gt;not&lt;/b&gt; have the permission, and yet I &lt;b&gt;don&apos;t&lt;/b&gt; get the warning. So I&apos;m confused.&lt;/p&gt;</comment>
                            <comment id="12377054" author="bryanpendleton" created="Sat, 29 Apr 2006 09:48:17 +0100"  >&lt;p&gt;OK, I think I am starting to understand this problem. I think that the try {} block in Main.getAllInfo() is too broad in scope. Once a security problem occurs with &lt;b&gt;any&lt;/b&gt; element on the classpath, the try block skips the rest of the classpath and just prints a very terse message.&lt;/p&gt;

&lt;p&gt;Let me work on this one for a while; I think I&apos;ve got some clues about why it works better for some people than others, depending on the details of their classpath.&lt;/p&gt;

&lt;p&gt;Kathey, thanks for encouraging me not to take the easy way out. It is nice to work with people who are so dedicated to doing it right!&lt;/p&gt;</comment>
                            <comment id="12377058" author="fuzzylogic" created="Sat, 29 Apr 2006 10:49:05 +0100"  >&lt;p&gt;This and a couple of other similar permissions issues (like &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-622&quot; title=&quot;sysinfo incorrectly requires permission on Derby jar files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-622&quot;&gt;&lt;del&gt;DERBY-622&lt;/del&gt;&lt;/a&gt;) are leading me to believe that what we really need most for these issues are test-specific policy files. That issue is already filed as &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-892&quot; title=&quot;add mechanism for specifying policy file for individual function tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-892&quot;&gt;&lt;del&gt;DERBY-892&lt;/del&gt;&lt;/a&gt;. I had already investigated that issue earlier and I have a solution brewing. This would allow us to add the permissions this test needs for this test only, which should resolve Kathey&apos;s primary concern. I&apos;ll try to have something ready for &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-892&quot; title=&quot;add mechanism for specifying policy file for individual function tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-892&quot;&gt;&lt;del&gt;DERBY-892&lt;/del&gt;&lt;/a&gt; early next week.&lt;/p&gt;</comment>
                            <comment id="12377098" author="bryanpendleton" created="Sun, 30 Apr 2006 00:32:29 +0100"  >&lt;p&gt;Attached is a proposed patch (derby-1229.diff) and a discussion of the patch (notes.html). Please read the notes.html (it&apos;s a quick read), and let me know what you think.&lt;/p&gt;

&lt;p&gt;If it sounds reasonable, I&apos;d love to hear from a few reviewers whether this patch works successfully in their environment, since we all seem to have radically different classpath configurations.&lt;/p&gt;

&lt;p&gt;thanks,&lt;/p&gt;

&lt;p&gt;bryan&lt;/p&gt;</comment>
                            <comment id="12377111" author="fuzzylogic" created="Sun, 30 Apr 2006 02:17:33 +0100"  >&lt;p&gt;Bryan, thanks again for the detailed analysis. I agree that the correct thing to do in this case is to properly report the exception (and then sed it out), not add the getProtectionDomain permission to the test. I&apos;d say go ahead and commit this.&lt;/p&gt;</comment>
                            <comment id="12377114" author="fuzzylogic" created="Sun, 30 Apr 2006 02:43:32 +0100"  >&lt;p&gt;One minor comment after rereading the patch, i&apos;m pretty sure that the message SIF03.C was only used in the one location where you&apos;ve replaced it with SIF03.D, so it might make sense to just reuse the old SIF03.C message id.&lt;/p&gt;</comment>
                            <comment id="12377176" author="kmarsden" created="Mon, 1 May 2006 02:47:57 +0100"  >&lt;p&gt;Thank you Bryan for the excellent explanation and preserving testing for  product compatibility with documented  policy file permissions.   Preservation of  this testing  is  something you will never hear requested on derby-user, nor will  you&apos;ll ever  hear a cheer  from the installed user base that you made an effort to make sure we don&apos;t regress in this area, but  we  certainly would  hear something if suddenly on upgrade existing policy files worked no more.   So,   thank you so much Bryan  for the extra effort.&lt;/p&gt;

&lt;p&gt;Perhaps a follow up task could be filed  to improve the sysinfo warnings if this permission is not granted  so that they are not so alarming.&lt;br/&gt;
 For Network Server we stress the importance of  running under security manager  and we provide NetworkServerControl sysinfo to show version and other diagnostic info, so the assumption  is that really anyone running NetworkServerControl sysinfo  is going  to see  these  getProtectionDomain Exceptions.  It seems a little odd as the expected default output.  I am concerned that that will confuse people in a diagnostic situation to think  that they need to add this  permission to get useful sysinfo output or worse yet think it is the root cause of whatever problem they are diagnosing.&lt;/p&gt;
</comment>
                            <comment id="12377975" author="fuzzylogic" created="Fri, 5 May 2006 15:44:13 +0100"  >&lt;p&gt;Hi Bryan, if you have some time, please take a look at the patch I attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1273&quot; title=&quot;Sysinfo should print a better  message when it gets Security Exceptions accessing classpath info when run under security manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1273&quot;&gt;DERBY-1273&lt;/a&gt;, the derby-1273-v2.diff patch. With that patch I attempted to get around the need to have the getProtectionDomain permission at all. I still think that your patch for this issue, which improves the output of the security exceptions on items in the classpath to which access has been restricted, is valuable and should be committed. But my patch attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1273&quot; title=&quot;Sysinfo should print a better  message when it gets Security Exceptions accessing classpath info when run under security manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1273&quot;&gt;DERBY-1273&lt;/a&gt; handles the getProtectionDomain issue in a different way.&lt;/p&gt;

&lt;p&gt;I was prompted to investigate removing the need for the getProtectionDomain permission due to Kathey&apos;s concerns. I&apos;m not sure I&apos;ve tested all of the many scenarios of classloader/environment/securitymanager/sysinfo-argument execution paths that are possible, and I&apos;m hoping that with a couple more eyes on it we can ensure that we get the maximum useful information out of sysinfo with the fewest possible permissions granted to it.&lt;/p&gt;</comment>
                            <comment id="12378088" author="bryanpendleton" created="Sat, 6 May 2006 02:13:51 +0100"  >&lt;p&gt;Attached is &quot;fix-with-reused-message.diff&quot;, an updated patch proposal which re-uses message SIF03.C rather than creating a new message SIF03.D.&lt;/p&gt;

&lt;p&gt;Andrew and I were not able to think of any cases in which re-using the same message and adding a parameter to it would cause any compatibility problems. The message is only used in this one sysinfo file.&lt;/p&gt;

&lt;p&gt;I intend to commit this fix in the next few days.&lt;/p&gt;</comment>
                            <comment id="12378248" author="bryanpendleton" created="Sun, 7 May 2006 04:38:36 +0100"  >&lt;p&gt;Patch fix-with-reused-message committed to subversion as revision 400366:&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewcvs?rev=400366&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs?rev=400366&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Vemund, if you could please verify that this change fixes the problem for you,&lt;br/&gt;
and then close the bug, that would be nice.&lt;/p&gt;</comment>
                            <comment id="12378606" author="vemund" created="Tue, 9 May 2006 19:26:43 +0100"  >&lt;p&gt;The problem has disappeared in my environment now. Thanks again, Bryan.&lt;/p&gt;

&lt;p&gt;I don&apos;t seem to have access to close the report, though.&lt;/p&gt;</comment>
                            <comment id="12379013" author="vemund" created="Thu, 11 May 2006 14:44:15 +0100"  >&lt;p&gt;Problem fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12326051" name="derby-1229.diff" size="2826" author="bryanpendleton" created="Sun, 30 Apr 2006 00:32:29 +0100"/>
                            <attachment id="12326319" name="fix-with-reused-message.diff" size="7552" author="bryanpendleton" created="Sat, 6 May 2006 02:13:51 +0100"/>
                            <attachment id="12326050" name="notes.html" size="19630" author="bryanpendleton" created="Sun, 30 Apr 2006 00:32:29 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 22 Apr 2006 07:26:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22386</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0tlb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38612</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>