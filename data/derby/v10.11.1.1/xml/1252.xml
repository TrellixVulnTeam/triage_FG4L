<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:40:56 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1252/DERBY-1252.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1252] Old clients with new server return wrong database metadata values for some methods</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1252</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;With an old client (10.1.1, 10.1.2) accessing a new (10.2) server,&lt;br/&gt;
some metadata calls will return the wrong value for both the JCC and&lt;br/&gt;
the Derby clients:&lt;/p&gt;

&lt;p&gt;	 deletesAreDetected(TYPE_SCROLL_INSENSITIVE) -&amp;gt; true&lt;br/&gt;
	 updatedAreDetected(TYPE_SCROLL_INSENSITIVE) -&amp;gt; true&lt;br/&gt;
	 ownDeletesAreVisible(TYPE_SCROLL_INSENSITIVE) -&amp;gt; true&lt;br/&gt;
	 ownUpdatesAreVisible(TYPE_SCROLL_INSENSITIVE) -&amp;gt; true&lt;/p&gt;

&lt;p&gt;This happens because these values were changed for the 10.2 with&lt;br/&gt;
the addition of updatable scrollable insensitive result sets (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-775&quot; title=&quot;Network client: Add support for scrollable, updatable, insensitive result sets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-775&quot;&gt;&lt;del&gt;DERBY-775&lt;/del&gt;&lt;/a&gt;),&lt;br/&gt;
combined with a weakness in the way the client and the server &lt;br/&gt;
cooperates to answer these metadata calls.&lt;/p&gt;

&lt;p&gt;Presently, when the client application invokes these methods, the&lt;br/&gt;
results will be returned by the server without regard to the identity&lt;br/&gt;
of the client, i.e. the 2-tuple &lt;/p&gt;
{JCC or Derby client, client version}
&lt;p&gt;.&lt;br/&gt;
The values to be returned for the methods in question are based solely&lt;br/&gt;
on the values found in the file metadata_net.properties, which is part&lt;br/&gt;
of the server.&lt;/p&gt;

&lt;p&gt;In general, some database metadata is dependent on the combination of&lt;br/&gt;
the capabilities in the client and the server and the returned values&lt;br/&gt;
should reflect this, which in general implies negotiating (down) to&lt;br/&gt;
values which are correct for the actual combination of client and&lt;br/&gt;
server.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12332699">DERBY-1252</key>
            <summary>Old clients with new server return wrong database metadata values for some methods</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="dagw">Dag H. Wanvik</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Apr 2006 05:59:41 +0100</created>
                <updated>Tue, 30 Jun 2009 16:55:49 +0100</updated>
                            <resolved>Thu, 3 Aug 2006 21:37:42 +0100</resolved>
                                    <version>10.1.1.0</version>
                    <version>10.1.2.1</version>
                    <version>10.1.3.1</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>JDBC</component>
                    <component>Network Client</component>
                    <component>Network Server</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12423188" author="kmarsden" created="Tue, 25 Jul 2006 00:08:04 +0100"  >&lt;p&gt;This issue is a regression.   It would be ideal to release Derby 10.2 without any known regressions so we don&apos;t have to even think about where to draw the line for acceptable regressions,  so before I think too much about where to draw that line, I ask: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;How hard this is to fix?&lt;/li&gt;
	&lt;li&gt;Does anyone plan to pick this up for 10.2?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12423191" author="djd" created="Tue, 25 Jul 2006 00:15:37 +0100"  >&lt;p&gt;How would this regression manifest itself in a working application?&lt;/p&gt;</comment>
                            <comment id="12423343" author="dagw" created="Tue, 25 Jul 2006 15:30:28 +0100"  >&lt;p&gt;Impact:&lt;/p&gt;

&lt;p&gt;This regression affects client which do not support updatable,&lt;br/&gt;
scrollable, insensitive result sets; i.e. JCC and Derby client driver&lt;br/&gt;
&amp;lt;= 10.1.x.&lt;/p&gt;

&lt;p&gt;Since the metadata methods which experience the regression all concern&lt;br/&gt;
either detectability or visibility of updatable, scrollable,&lt;br/&gt;
insensitive result sets, which is a new feature in 10.2, it seems a&lt;br/&gt;
long stretch to imagine existing applications being negatively&lt;br/&gt;
impacted: Why would an application ask about details of a feature not&lt;br/&gt;
supported? [DataBaseMetaData#supportsResultSetConcurrency and&lt;br/&gt;
supportsResultSetType should be used to determine if SUR is supported,&lt;br/&gt;
and these work correctly for the mixed scenarios (derby 10.1/derby&lt;br/&gt;
10.2 server and jcc client/derby 10.2 server&#185;).&lt;/p&gt;

&lt;p&gt;&#185;Albeit due to luck; a bug in the parsing of a returned metadata&lt;br/&gt;
 column in both JCC and Derby client &amp;lt;= 10.1, see also this thread:&lt;br/&gt;
 &lt;a href=&quot;http://www.mail-archive.com/derby-dev@db.apache.org/msg18334.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.mail-archive.com/derby-dev@db.apache.org/msg18334.html&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;In general, though, the bug reveals an exisiting weakness in the&lt;br/&gt;
design of the mechanism to answer database metadata methods on the&lt;br/&gt;
client; the server does not take the client version into account when&lt;br/&gt;
answering (negotiate down). Mostly, this should only be a problem when&lt;br/&gt;
the server is newer (has more features) than the client can support.&lt;/p&gt;

&lt;p&gt;Possible Solutions:&lt;/p&gt;

&lt;p&gt;One solution could be: If in a mixed scenario, make the stored&lt;br/&gt;
procedure SYSIBM.METADATA() being executed on the server on behalf of&lt;br/&gt;
the client, return data from a 10.1-compatible version of the&lt;br/&gt;
metadata.&lt;/p&gt;

&lt;p&gt;The query METADATA in the file metadata_net.properties is used to construct&lt;br/&gt;
the stored prepared statement used by SYSIBM.METADATA(). We could have&lt;br/&gt;
a &quot;client &amp;lt;= 10.1&quot; version of the query which can be referenced by&lt;br/&gt;
SYSIBM.METADATA(). This presupposes that the JCC driver also accesses&lt;br/&gt;
the metadata via the stored procedure SYSIBM.METADATA().&lt;/p&gt;

&lt;p&gt;Downside: Redundancy in data, possible proliferation of more version&lt;br/&gt;
specific versions later? I presume we need to keep them&lt;br/&gt;
around til we hit Derby 11.&lt;/p&gt;

&lt;p&gt;An alternative (more ad hoc and ugly) would be to always let the&lt;br/&gt;
server return false for these metadata calls, and let the derby client&lt;br/&gt;
ignore the values returned and hardcode the values for these methods&lt;br/&gt;
into the derby driver based on which version of the server it is&lt;br/&gt;
talking to: server &amp;lt; 10.2 false, server &amp;gt;= 10.2 : true.&lt;/p&gt;

&lt;p&gt;Not sure I like either of the approaches.. But is the regression too&lt;br/&gt;
risky to accept?&lt;/p&gt;



</comment>
                            <comment id="12423873" author="rhillegas" created="Thu, 27 Jul 2006 18:44:34 +0100"  >&lt;p&gt;It seems to me that SYSIBM.METADATA exists to support the JCC driver. Maybe we could let this procedure continue to return the 10.1 answers; the 10.2 client could return the 10.2 answers when talking to a 10.2 server.&lt;/p&gt;</comment>
                            <comment id="12423879" author="dagw" created="Thu, 27 Jul 2006 19:09:44 +0100"  >&lt;p&gt;Yes, that&apos;s what I had in mind for my &quot;alternative two&quot; above. If&lt;br/&gt;
people are OK with that approach I can make a patch for it.&lt;/p&gt;

&lt;p&gt;People finding this solution unacceptable should speak out now. I will&lt;br/&gt;
start on it in within a couple of days if there is no push back.&lt;/p&gt;</comment>
                            <comment id="12425042" author="dagw" created="Tue, 1 Aug 2006 23:22:56 +0100"  >&lt;p&gt;Two patches are uploaded to solve this issue.&lt;/p&gt;

&lt;p&gt;    derby1252-10.1.&lt;/p&gt;
{diff,stat} &lt;br/&gt;
    derby1252.{diff,stat}
&lt;p&gt; &lt;/p&gt;

&lt;p&gt;The first patch to the 10.1 trunk contains extensions to&lt;br/&gt;
jdbcapi/metadata_test.java (plus updated masters, hope I got them&lt;br/&gt;
all..) which can be used to verify the regression; the old version did&lt;br/&gt;
not contain the calls to the methods of interest, see below. I am not&lt;br/&gt;
sure it is necessary to commit this patch, but it is useful when&lt;br/&gt;
verifying the main patch.&lt;/p&gt;

&lt;p&gt;The main patch to 10.2. trunk implements &quot;alternative 2&quot; outlined&lt;br/&gt;
earlier in this issue. BTW, alternative 1 is not workable since all&lt;br/&gt;
logic on the server side is generic query processing making it ugly to&lt;br/&gt;
differentiate between clients.&lt;/p&gt;

&lt;p&gt;Patch details:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;metadata_net.properties has been rolled back to the 10.1 version of&lt;br/&gt;
  the four values which gave regression:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  deletesAreDetected(TYPE_SCROLL_INSENSITIVE) &lt;br/&gt;
  updatedAreDetected(TYPE_SCROLL_INSENSITIVE)&lt;br/&gt;
  ownDeletesAreVisible(TYPE_SCROLL_INSENSITIVE)&lt;br/&gt;
  ownUpdatesAreVisible(TYPE_SCROLL_INSENSITIVE)&lt;/p&gt;

&lt;p&gt;  Derbynet master has been updated to reflect this (existing master&lt;br/&gt;
  reflects the regression).&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;am/DatabaseMetaData.java contains logic to override these to &quot;true&quot;&lt;br/&gt;
  when running against a &amp;gt;= 10.2. server.  I also added code, which is&lt;br/&gt;
  presently commented out, to negotiate down (effectivly an &quot;AND&quot; for&lt;br/&gt;
  these boolean values) once the server can start returning the&lt;br/&gt;
  correct values. As far as I can understand, this cannot happen until&lt;br/&gt;
  we hit the next major release, 11, due to the forward compatibility&lt;br/&gt;
  requirements for client/server,&lt;br/&gt;
  cf. &lt;a href=&quot;http://wiki.apache.org/db-derby/ForwardCompatibility&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/ForwardCompatibility&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If the present solution is committed I will file a JIRA to be fixed&lt;br/&gt;
  for Derby 11 (not possible yet?) , to move to the new regime from&lt;br/&gt;
  Derby 11.0.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Testing:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ran derbyall on 10.1 trunk with the extended 10.1 metadata test&lt;br/&gt;
  (derby1252-10.1.diff):&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     derbyall/derbynetmats/derbynetmats.fail:derbynet/DerbyNetAutoStart.java&lt;br/&gt;
     derbyall/derbyall.fail:unit/T_Diagnosticable.unit&lt;/p&gt;

&lt;p&gt;  This is unrelated.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ran derbyall on 10.2 trunk with the patch (derby1252.diff):&lt;br/&gt;
  wisconsin fails for all clients, plus store/TransactionTable.sql&lt;br/&gt;
  (same as tinderbox).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ran 10.1 client and extended 10.1 metadata test against current 10.2&lt;br/&gt;
  to show regression: Ok, shows regression.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ran JCC client and extended 10.1 metadata test against current 10.2&lt;br/&gt;
  to show regression: Ok, shows regression.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ran 10.1 client and extended 10.1 metadata test against patched 10.2&lt;br/&gt;
  to show regression has gone away: OK.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ran JCC client and extended 10.1 metadata test against patched 10.2&lt;br/&gt;
  to show regression has gone away: OK.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ran patched 10.2 client against 10.1 server and and extended 10.1&lt;br/&gt;
  metadata test to see that the patched 10.2 client downgrades&lt;br/&gt;
  correctly: OK&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The patch is ready for review.&lt;/p&gt;</comment>
                            <comment id="12425044" author="dagw" created="Tue, 1 Aug 2006 23:27:58 +0100"  >&lt;p&gt;whitespace fix for derby1252.diff&lt;/p&gt;</comment>
                            <comment id="12425602" author="rhillegas" created="Thu, 3 Aug 2006 21:14:15 +0100"  >&lt;p&gt;Thanks, Dag. The fix looks solid. Derbyall had two diffs for me: 1) the wisconsin noise, 2) XATest under DerbyNetClient (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-1640&quot; title=&quot;Instability in XATest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-1640&quot;&gt;&lt;del&gt;DERBY-1640&lt;/del&gt;&lt;/a&gt;). Committed at subversion revision 428510.&lt;/p&gt;</comment>
                            <comment id="12425609" author="kmarsden" created="Thu, 3 Aug 2006 21:46:35 +0100"  >&lt;p&gt;now that this is fixed , is there still existing application impact?  If not then we should uncheck the box.&lt;br/&gt;
&quot;Existing application impact&quot;  should a field  users can query on to see if there have been changes that might affect their application. Once a regression is fixed it can be unchecked if there is nothing that remains that might impact users.&lt;/p&gt;

</comment>
                            <comment id="12425630" author="dagw" created="Thu, 3 Aug 2006 23:46:34 +0100"  >&lt;p&gt;regression gone after fix&lt;/p&gt;</comment>
                            <comment id="12425648" author="dagw" created="Fri, 4 Aug 2006 02:12:32 +0100"  >&lt;p&gt;Setting regression again, this field should reflect bug property and not be removed when&lt;br/&gt;
issue is fixed, cf mail thread &lt;a href=&quot;http://www.nabble.com/Jira-field-definition-clarification-for-Derby-tf2024859.html#a5567827&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.nabble.com/Jira-field-definition-clarification-for-Derby-tf2024859.html#a5567827&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12427889" author="dagw" created="Mon, 14 Aug 2006 15:04:56 +0100"  >&lt;p&gt;Verified on trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12328898">DERBY-965</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12337938" name="derby1252-10.1.diff" size="27624" author="dagw" created="Tue, 1 Aug 2006 23:15:01 +0100"/>
                            <attachment id="12337936" name="derby1252-10.1.stat" size="622" author="dagw" created="Tue, 1 Aug 2006 23:05:52 +0100"/>
                            <attachment id="12337939" name="derby1252.diff" size="9287" author="dagw" created="Tue, 1 Aug 2006 23:27:58 +0100"/>
                            <attachment id="12337935" name="derby1252.diff" size="8657" author="dagw" created="Tue, 1 Aug 2006 23:05:52 +0100"/>
                            <attachment id="12337934" name="derby1252.stat" size="390" author="dagw" created="Tue, 1 Aug 2006 23:05:52 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10420"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 24 Jul 2006 23:08:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22397</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0utr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38812</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10051"><![CDATA[Urgent]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>