<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:43:44 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3142/DERBY-3142.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3142] sysinfo ignores derby.ui.locale</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3142</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Sysinfo messages are localized using the system&apos;s default locale instead of the locale specified by derby.ui.locale.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;$ java -Dderby.ui.locale=de_DE -jar derbyrun.jar sysinfo|head                  &lt;br/&gt;
------------------ Java Information ------------------&lt;br/&gt;
Java Version:    1.6.0_01&lt;br/&gt;
Java Vendor:     Sun Microsystems Inc.&lt;br/&gt;
Java home:       /usr/jdk/instances/jdk1.6.0/jre&lt;br/&gt;
Java classpath:  derbyrun.jar&lt;br/&gt;
OS name:         SunOS&lt;br/&gt;
OS architecture: x86&lt;br/&gt;
OS version:      5.11&lt;br/&gt;
Java user name:  kah&lt;br/&gt;
Java user home:  /home/kah&lt;/p&gt;

&lt;p&gt;Setting the default locale works correctly:&lt;/p&gt;

&lt;p&gt;$ LC_ALL=de_DE.UTF-8 java -jar derbyrun.jar sysinfo|head&lt;br/&gt;
------------------ Java-Informationen ------------------&lt;br/&gt;
Java-Version: 1.6.0_01&lt;br/&gt;
Java-Anbieter: Sun Microsystems Inc.&lt;br/&gt;
Java-Home: /usr/jdk/instances/jdk1.6.0/jre&lt;br/&gt;
Java-Klassenpfad: derbyrun.jar&lt;br/&gt;
Name des Betriebssystems: SunOS&lt;br/&gt;
Architektur des Betriebssystems: x86&lt;br/&gt;
Betriebssystemversion: 5.11&lt;br/&gt;
Java-Benutzername: kah&lt;br/&gt;
Java-Benutzerausgangsverzeichnis: /home/kah&lt;/p&gt;</description>
                <environment></environment>
        <key id="12380826">DERBY-3142</key>
            <summary>sysinfo ignores derby.ui.locale</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Oct 2007 17:49:49 +0100</created>
                <updated>Thu, 3 Jan 2008 09:48:13 +0000</updated>
                            <resolved>Mon, 26 Nov 2007 08:39:33 +0000</resolved>
                                    <version>10.2.2.0</version>
                    <version>10.3.1.4</version>
                    <version>10.4.1.3</version>
                                    <fixVersion>10.3.2.1</fixVersion>
                    <fixVersion>10.4.1.3</fixVersion>
                                    <component>Localization</component>
                    <component>Tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12536445" author="knutanders" created="Sat, 20 Oct 2007 18:09:05 +0100"  >&lt;p&gt;It seems like the code intends to use derby.ui.locale. Here&apos;s the start of its main() method (in impl.tools.sysinfo.Main):&lt;/p&gt;

&lt;p&gt;  public static void main(String args[]) {&lt;br/&gt;
        // adjust the application in accordance with derby.ui.locale and derby.ui.codeset&lt;br/&gt;
        LocalizedResource.getInstance();&lt;/p&gt;

&lt;p&gt;This should normally work, but unlike the other tools, sysinfo has its own message file which is not read by LocalizedResource (because sysinfo is included in all jars, not only in derbytools.jar). So when sysinfo fetches the resource bundle with this call&lt;/p&gt;

&lt;p&gt;    return ResourceBundle.getBundle(&quot;org.apache.derby.loc.sysinfoMessages&quot;);&lt;/p&gt;

&lt;p&gt;the default locale is used instead of derby.ui.locale.&lt;/p&gt;</comment>
                            <comment id="12536459" author="knutanders" created="Sat, 20 Oct 2007 20:18:00 +0100"  >&lt;p&gt;The attached patch seems to fix the problem. It loads the sysinfo&apos;s ResourceBundle through LocalizedResource and therefore gets the bundle localized for derby.ui.locale if it&apos;s set.&lt;/p&gt;

&lt;p&gt;I haven&apos;t written any new tests, and no tests have been run yet.&lt;/p&gt;</comment>
                            <comment id="12536543" author="knutanders" created="Sun, 21 Oct 2007 22:43:58 +0100"  >&lt;p&gt;I played a little more with my patch, and then I found a bug in LocalizedResource that was exposed by the fix in sysinfo.Main. If derby.ui.locale was set to &quot;none&quot;, the wrong message bundle was used. LocalizedResource.setResource() contains this code fragment:&lt;/p&gt;

&lt;p&gt; 		if ( locale == null || locale.toString().equals(&quot;none&quot;) )&lt;/p&gt;
{
 			res = ResourceBundle.getBundle(MESSAGE_FILE);
 		}
&lt;p&gt; 		else&lt;br/&gt;
 		try &lt;/p&gt;
{
 			res = ResourceBundle.getBundle(messageFileName,locale);
 		}
&lt;p&gt; 		catch(java.util.MissingResourceException e)&lt;/p&gt;
{
 			res = ResourceBundle.getBundle(messageFileName,Locale.ENGLISH);
 		}

&lt;p&gt;The first branch of the if statement should use messageFileName instead of MESSAGE_FILE. This bug wasn&apos;t exposed before because the two variables always have the same value for the other tools.&lt;/p&gt;</comment>
                            <comment id="12536548" author="knutanders" created="Sun, 21 Oct 2007 23:27:00 +0100"  >&lt;p&gt;Attaching an updated patch which also fixes the bug in LocalizedResource. All the tests ran cleanly.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure how to add a test for this bug. I know how to do it in the old test harness, but not in the new harness. The problem is that to run the tools (not only sysinfo) with different derby.ui.locale values, their classes need to be unloaded, since they store their locale and resource bundles in static fields. This means we either need a class-loader stunt or we need to spawn a new java process to run sysinfo. While spawning a process is not very difficult, making it portable is. If I remember correctly, the old harness contained lots of logic to make sure that the spawning of java processes worked correctly on all supported platforms (not all of which start java processes with a command named &quot;java&quot;). Suggestions would be welcome.&lt;/p&gt;</comment>
                            <comment id="12543561" author="knutanders" created="Mon, 19 Nov 2007 13:38:30 +0000"  >&lt;p&gt;Updated patch to resolve conflict with &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-2903&quot; title=&quot;RunClassPathTester regression test gets diff because of error message difference&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-2903&quot;&gt;&lt;del&gt;DERBY-2903&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12544744" author="knutanders" created="Thu, 22 Nov 2007 09:39:46 +0000"  >&lt;p&gt;I have now added a test to the patch. Derbyall and suites.All ran cleanly.&lt;/p&gt;

&lt;p&gt;The test loads the sysinfo class in a separate class loader a number of times with different combinations of default locale and derby.ui.locale. A separate class loader was needed because the tools detect which locale they are running under the first time they are loaded, and they will not detect changes to the locale setting unless the classes are unloaded and then reloaded.&lt;/p&gt;

&lt;p&gt;Also, the test does not run under a security manager. The reason for this is that the test requires permission to create a class loader. I see in other tests (such as AggregateClassLoadingTest) that we don&apos;t want to grant that permission to derbyTesting.jar since then no tests fail if code in derby.jar forgets to use privileged blocks when creating class loaders.&lt;/p&gt;</comment>
                            <comment id="12544950" author="knutanders" created="Fri, 23 Nov 2007 09:20:32 +0000"  >&lt;p&gt;Committed revision 597610.&lt;/p&gt;

&lt;p&gt;If this check-in doesn&apos;t cause any regression test failures the next few days, I intend to back-port it to 10.3.&lt;/p&gt;</comment>
                            <comment id="12545360" author="knutanders" created="Mon, 26 Nov 2007 08:39:33 +0000"  >&lt;p&gt;Merged to 10.3 with revision 598163.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12368085" name="d3142-1.diff" size="2103" author="knutanders" created="Sat, 20 Oct 2007 20:18:00 +0100"/>
                            <attachment id="12368107" name="d3142-2.diff" size="2644" author="knutanders" created="Sun, 21 Oct 2007 23:27:00 +0100"/>
                            <attachment id="12369786" name="d3142-2a.diff" size="3176" author="knutanders" created="Mon, 19 Nov 2007 13:38:30 +0000"/>
                            <attachment id="12370053" name="d3142-with-test.diff" size="11619" author="knutanders" created="Thu, 22 Nov 2007 09:39:45 +0000"/>
                            <attachment id="12370054" name="d3142-with-test.stat" size="313" author="knutanders" created="Thu, 22 Nov 2007 09:39:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23459</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0ztr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39622</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>