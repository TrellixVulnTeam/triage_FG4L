<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:46:40 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-704/DERBY-704.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-704] Large page cache kills initial performance</title>
                <link>https://issues.apache.org/jira/browse/DERBY-704</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;When the page cache is large the performance gets lower as the page&lt;br/&gt;
cache is being filled. As soon as the page cache is filled, the&lt;br/&gt;
throughput increases. In the period with low performance, the CPU&lt;br/&gt;
usage is high, and when the performance increases the CPU usage is&lt;br/&gt;
lower.&lt;/p&gt;

&lt;p&gt;This behaviour is caused by the algorithm for finding free slots in&lt;br/&gt;
the page cache. If there are invalid pages in the page cache, it will&lt;br/&gt;
be scanned to find one of those pages. However, when multiple clients&lt;br/&gt;
access the database, the invalid pages are often already taken. This&lt;br/&gt;
means that the entire page cache will be scanned, but no free invalid&lt;br/&gt;
page is found. Since the scan of the page cache is synchronized on the&lt;br/&gt;
cache manager, all other threads that want to access the page cache&lt;br/&gt;
have to wait. When the page cache is large, this will kill the&lt;br/&gt;
performance.&lt;/p&gt;

&lt;p&gt;When the page cache is full, this is not a problem, as there will be&lt;br/&gt;
no invalid pages.&lt;/p&gt;</description>
                <environment>All platforms</environment>
        <key id="12325622">DERBY-704</key>
            <summary>Large page cache kills initial performance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knutanders">Knut Anders Hatlen</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Nov 2005 17:41:43 +0000</created>
                <updated>Mon, 29 Jun 2009 15:44:06 +0100</updated>
                            <resolved>Thu, 25 May 2006 20:27:11 +0100</resolved>
                                    <version>10.1.1.0</version>
                    <version>10.1.2.1</version>
                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.1.3.1</fixVersion>
                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Services</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12357567" author="knutanders" created="Mon, 14 Nov 2005 17:57:57 +0000"  >&lt;p&gt;Attached patch and report from running derbyall (no tests failed).&lt;/p&gt;

&lt;p&gt;The patch modifies the search for a free slot in the page cache&lt;br/&gt;
(org.apache.derby.impl.services.cache.Clock.findFreeItem()) in the&lt;br/&gt;
following way:&lt;/p&gt;

&lt;p&gt;  1) find out how many invalid pages there are in the page cache&lt;br/&gt;
  2) check whether pages that are skipped in the search are invalid&lt;br/&gt;
  3) if the number of skipped invalid pages equals the number of&lt;br/&gt;
     invalid pages, stop the search for invalid pages&lt;/p&gt;

&lt;p&gt;Could someone please review the patch? Thanks.&lt;/p&gt;</comment>
                            <comment id="12357569" author="knutanders" created="Mon, 14 Nov 2005 18:15:34 +0000"  >&lt;p&gt;Attached graphs showing the throughput and CPU usage running with and&lt;br/&gt;
without the patch. The graphs show the average of seven runs,&lt;br/&gt;
throughput and CPU usage were reported every 30 seconds.&lt;/p&gt;

&lt;p&gt;12 clients were running an update-intensive load on the database. The&lt;br/&gt;
database had 10 GB of user data, and the page cache size was 512&lt;br/&gt;
MB. The CPU usage is relatively low because the tests were run on an&lt;br/&gt;
8-CPU machine.&lt;/p&gt;

&lt;p&gt;The first 30 minutes the CPU usage was higher and the throughput&lt;br/&gt;
significantly lower without the patch than with the patch.&lt;/p&gt;</comment>
                            <comment id="12357574" author="knutanders" created="Mon, 14 Nov 2005 19:18:24 +0000"  >&lt;p&gt;Sorry, I forgot the output from svn stat.&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/services/cache/Clock.java&lt;/p&gt;</comment>
                            <comment id="12357639" author="davidvc" created="Tue, 15 Nov 2005 08:39:05 +0000"  >&lt;p&gt;Hi, Knut.  Normally I wouldn&apos;t review a kernel change, but this is a very simple change, it seems to have a lot of value, and it makes sense to me.  I&apos;ll do a sanity build and test and then I will go ahead and check in.  If a kernel developer would like to review, please do so.&lt;/p&gt;</comment>
                            <comment id="12357640" author="davidvc" created="Tue, 15 Nov 2005 08:49:50 +0000"  >&lt;p&gt;Checked in patch, revision number 344270&lt;/p&gt;

&lt;p&gt;bash-2.05$ svn commit&lt;br/&gt;
Sending        java/engine/org/apache/derby/impl/services/cache/Clock.java&lt;br/&gt;
Transmitting file data .&lt;br/&gt;
Committed revision 344270.&lt;/p&gt;</comment>
                            <comment id="12357677" author="knutanders" created="Tue, 15 Nov 2005 18:14:04 +0000"  >&lt;p&gt;Fixed in revision 344270.&lt;/p&gt;</comment>
                            <comment id="12357777" author="knutanders" created="Wed, 16 Nov 2005 22:26:02 +0000"  >&lt;p&gt;Issue is reopened in order to add more comments to the code.&lt;/p&gt;</comment>
                            <comment id="12357778" author="knutanders" created="Wed, 16 Nov 2005 22:36:06 +0000"  >&lt;p&gt;Patch &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-704&quot; title=&quot;Large page cache kills initial performance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-704&quot;&gt;&lt;del&gt;DERBY-704&lt;/del&gt;&lt;/a&gt;-extra-comments.diff adds the following comments&lt;br/&gt;
to the code:&lt;/p&gt;

&lt;p&gt;  // 1) find out how many invalid items there are in the&lt;br/&gt;
  //    cache&lt;br/&gt;
  // 2) search for a free invalid item&lt;br/&gt;
  // 3) stop searching when there are no more invalid&lt;br/&gt;
  //    items to find&lt;/p&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;  // Invalid items might occur in the cache when&lt;br/&gt;
  //   a) a new item is created in growCache(), but it&lt;br/&gt;
  //      is not in use yet, or&lt;br/&gt;
  //   b) an item is deleted (usually when a table is&lt;br/&gt;
  //      dropped)&lt;/p&gt;

&lt;p&gt;  // It is critical to break out of the loop as soon as&lt;br/&gt;
  // possible since we are blocking others trying to&lt;br/&gt;
  // access the page cache. New items are added to the&lt;br/&gt;
  // end of the page cache, so the search for invalid&lt;br/&gt;
  // items should start from the end.&lt;/p&gt;

&lt;p&gt;If the comments are OK, could a committer please commit this change?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;svn stat:&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/impl/services/cache/Clock.java&lt;/p&gt;</comment>
                            <comment id="12357861" author="knutanders" created="Thu, 17 Nov 2005 19:09:34 +0000"  >&lt;p&gt;Fixed in revision 344270. Extra comments put into the code in revision 345215.&lt;/p&gt;</comment>
                            <comment id="12413242" author="knutanders" created="Thu, 25 May 2006 20:20:04 +0100"  >&lt;p&gt;Reopening to port to 10.1.&lt;/p&gt;</comment>
                            <comment id="12413243" author="knutanders" created="Thu, 25 May 2006 20:27:11 +0100"  >&lt;p&gt;Fix merged cleanly. Derbyall ran with two failures on Solaris 10 x86/Sun JVM 1.5 (derbynet/testSecMec.java and unit/T_Diagnosticable.unit), but these are also seen in Ole&apos;s regression tests.&lt;/p&gt;

&lt;p&gt;Committed to 10.1 with revision 409374.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12320724" name="DERBY-704-extra-comments.diff" size="1241" author="knutanders" created="Wed, 16 Nov 2005 22:36:06 +0000"/>
                            <attachment id="12320671" name="DERBY-704.diff" size="1142" author="knutanders" created="Mon, 14 Nov 2005 17:57:57 +0000"/>
                            <attachment id="12320674" name="cpu-usage.png" size="7191" author="knutanders" created="Mon, 14 Nov 2005 18:15:34 +0000"/>
                            <attachment id="12320672" name="derbyall_report.txt" size="3765" author="knutanders" created="Mon, 14 Nov 2005 17:57:57 +0000"/>
                            <attachment id="12320673" name="throughput.png" size="7242" author="knutanders" created="Mon, 14 Nov 2005 18:15:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10362"><![CDATA[Performance]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Nov 2005 08:39:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22101</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0we7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39066</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>