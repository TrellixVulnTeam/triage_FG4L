<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:45:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-3969/DERBY-3969.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-3969] NPE if you declare a constraint on a generated column and omit the datatype</title>
                <link>https://issues.apache.org/jira/browse/DERBY-3969</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;The following script shows the problem for CHECK constraints. Other NPEs occur for PRIMARY, FOREIGN KEY, and NOT NULL constraints.&lt;/p&gt;

&lt;p&gt;drop table t_ccnd_1;&lt;/p&gt;

&lt;p&gt;&amp;#8211; raises a null pointer exception&lt;br/&gt;
create table t_ccnd_1( a int, b generated always as ( -a ) check ( b &amp;lt; 0 ) );&lt;/p&gt;</description>
                <environment></environment>
        <key id="12409668">DERBY-3969</key>
            <summary>NPE if you declare a constraint on a generated column and omit the datatype</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhillegas">Rick Hillegas</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Dec 2008 17:48:15 +0000</created>
                <updated>Tue, 13 Jul 2010 20:14:16 +0100</updated>
                            <resolved>Thu, 4 Dec 2008 21:02:30 +0000</resolved>
                                    <version>10.5.1.1</version>
                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12652947" author="rhillegas" created="Wed, 3 Dec 2008 20:16:20 +0000"  >&lt;p&gt;Attaching derby-3969-01-aa-constraintsNoDatatype.diff. This fixes the known NPEs raised when declaring generated columns without datatypes but with constraints. Will run tests.&lt;/p&gt;

&lt;p&gt;1) For FOREIGN and PRIMARY keys, the NPEs occurred because datatypes were being checked before the generation clauses were bound and the their datatypes determined. The solution was to move the datatype checks after the generation clauses are bound.&lt;/p&gt;

&lt;p&gt;2) For CHECK constraints, the NPE occurred because the CHECK constraints were bound against a dummy table which was constructed before the generation clauses were bound. The solution was to update the datatypes in that table after binding the generation clauses.&lt;/p&gt;

&lt;p&gt;3) For NOT NULL constraints, the NPE was occurring in the parser. I chose not to fix this problem. Instead, I raise an error if the user tries to declare a NOT NULL constraint on a generated column which lacks an explicit datatype. I decided not to tackle this case because I was up against a flaw in the Derby data design: in Derby (as in many other RDBMSes), the NOT NULL constraint is modelled as an aspect of the datatype. Getting this aspect of a datatype to behave like a constraint looked like a tricky bit of brittle code which I did not think was justified by the benefit provided. The workaround is to explicitly declare the datatype of the generated column--this does not seem like on onerous limitation to me. If someone thinks this syntactic sugar is worth the effort, they are welcome to tackle this one.&lt;/p&gt;


&lt;p&gt;Touches the following files:&lt;/p&gt;

&lt;p&gt;M      java/engine/org/apache/derby/loc/messages.xml&lt;br/&gt;
M      java/shared/org/apache/derby/shared/common/reference/SQLState.java&lt;br/&gt;
M      java/engine/org/apache/derby/impl/sql/compile/sqlgrammar.jj&lt;/p&gt;

&lt;p&gt;Now the parser raises an error if  you try to declare an untyped generated column as NOT NULL.&lt;/p&gt;


&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/compile/TableElementList.java&lt;/p&gt;

&lt;p&gt;A couple changes were made to this class: Moved the nullability-setting logic out of the validation logic for constraints so that it could be called after generation clauses were bound-&lt;del&gt;this supports (1) above. Also updated the corresponding datatype in the dummy table after binding a generation clause&lt;/del&gt;-this supports (2) above.&lt;/p&gt;


&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/compile/AlterTableNode.java&lt;br/&gt;
M      java/engine/org/apache/derby/impl/sql/compile/CreateTableNode.java&lt;/p&gt;

&lt;p&gt;Binding logic changed to call the new method in TableElementList which supports (1).&lt;/p&gt;


&lt;p&gt;M      java/engine/org/apache/derby/impl/sql/compile/ResultColumnList.java&lt;/p&gt;

&lt;p&gt;Introduced a new method for looking up a ResultColumn by name. The original method set a referenced bit which broke the check that generation clauses can&apos;t mention other generated columns.&lt;/p&gt;


&lt;p&gt;M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/GeneratedColumnsTest.java&lt;br/&gt;
M      java/testing/org/apache/derbyTesting/functionTests/tests/lang/GeneratedColumnsHelper.java&lt;/p&gt;

&lt;p&gt;Added new tests.&lt;/p&gt;</comment>
                            <comment id="12653114" author="rhillegas" created="Thu, 4 Dec 2008 01:42:22 +0000"  >&lt;p&gt;Tests passed for me on derby-3969-01-aa-constraintsNoDatatype.diff except for diffs in stress multi tests. Committed at subversion revision 723184.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12312855">DERBY-481</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12395208" name="derby-3969-01-aa-constraintsNoDatatype.diff" size="22032" author="rhillegas" created="Wed, 3 Dec 2008 20:16:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23949</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10102"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0pj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37954</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>