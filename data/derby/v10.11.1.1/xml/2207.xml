<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:13:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-2207/DERBY-2207.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-2207] Improve usability of Derby&apos;s client/server security by implementing ANSI Roles</title>
                <link>https://issues.apache.org/jira/browse/DERBY-2207</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Implementing ANSI Roles will make it easier to manage security for multi-user applications with high user turnover.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12359718">DERBY-2207</key>
            <summary>Improve usability of Derby&apos;s client/server security by implementing ANSI Roles</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dagw">Dag H. Wanvik</assignee>
                                    <reporter username="rhillegas">Rick Hillegas</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Jan 2007 17:09:21 +0000</created>
                <updated>Tue, 13 Jul 2010 20:24:18 +0100</updated>
                            <resolved>Sat, 22 Nov 2008 02:06:48 +0000</resolved>
                                                    <fixVersion>10.5.1.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="12467607" author="fuzzylogic" created="Thu, 25 Jan 2007 20:38:27 +0000"  >&lt;p&gt;Unsetting Fix Version on unassigned issues.&lt;/p&gt;</comment>
                            <comment id="12469543" author="dagw" created="Thu, 1 Feb 2007 18:42:15 +0000"  >&lt;p&gt;I have made a Wiki page for this topic and added some thoughts from&lt;br/&gt;
a preliminary investigation. Please see:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://wiki.apache.org/db-derby/SqlRoles&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/db-derby/SqlRoles&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12524587" author="dagw" created="Mon, 3 Sep 2007 23:38:18 +0100"  >&lt;p&gt;I have started working on roles for Derby. I plan to make a functional&lt;br/&gt;
specification based on a subset of the SQL standard. I will be uploading drafts, so I can get early feedback. &lt;/p&gt;

&lt;p&gt;If anybody has an interest in participating in this effort, please let me know &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Any spare cycles would be appreciated! Since roles builds on the privileges work done for 10.2, any help from people who know this part of Derby will be especially appreciated!&lt;/p&gt;

</comment>
                            <comment id="12526184" author="dagw" created="Mon, 10 Sep 2007 17:22:24 +0100"  >&lt;p&gt;Uploading a first draft of the func spec. Please have a look!&lt;/p&gt;</comment>
                            <comment id="12526270" author="rhillegas" created="Mon, 10 Sep 2007 22:20:11 +0100"  >&lt;p&gt;Thanks for the great spec, Dag. I have a couple comments.&lt;/p&gt;

&lt;p&gt;General - I think that it would be nice if the introductory paragraphs of section 5 spelled out the semantics of ANSI roles in greater detail. For instance, I think that something like the following is true, but the spec doesn&apos;t exactly say this:&lt;/p&gt;

&lt;p&gt;&quot;At any given time, a session has a user and a role associated with it. At that point in time, the session enjoys all of the privileges explicitly granted to the user plus the transitive closure of all privileges granted to the role and its ancestors in the role graph.&quot;&lt;/p&gt;

&lt;p&gt;A related, recurrent usage confuses me. Throughout the spec, statements like the following appear: &quot;the privilege is revoked from any user who has the role&quot;. I don&apos;t think that granting a role to a user results in the role&apos;s privileges being granted to the user. I don&apos;t think that you can revoke those privileges from the user--you can only revoke them from the role.&lt;/p&gt;

&lt;p&gt;Also, it would be nice if divergences from the standard were highlighted somehow.&lt;/p&gt;


&lt;p&gt;5.6 (Granting a role to a role) - I think that cycles are not allowed in the role graph. Do you agree?&lt;/p&gt;


&lt;p&gt;5.7 (Revoking privileges from a role) - The phrasing confuses me (see my general comment above).  I think what you are saying is that, after revoking privilege P from role A, then P is no longer enjoyed by a session operating as A or s one of its descendants in the role graph. Even this is not strictly speaking true, though--or so it seems to me. The session could still enjoy P if P is granted to some other ancestor of the current role.&lt;/p&gt;

&lt;p&gt;I am afraid I became terribly muddled from paragraph 4 onward. It might help if you could tease apart the concepts of session, user, and role.&lt;/p&gt;


&lt;p&gt;5.8 (Revoking a role from a user) - I got muddled in paragraph 2. Maybe teasing apart the concepts, again, would help.&lt;/p&gt;


&lt;p&gt;5.9 (Revoking a role from a role) - I did not understand what was meant by saying that role A is also role C. I did not understand the reference to drop behavior in the previous section.&lt;/p&gt;


&lt;p&gt;5.10 (Setting a role) - I recommend moving this section further up. I think that it will give the reader more context for understanding how a session enjoys privileges by changing role.&lt;/p&gt;


&lt;p&gt;6.1 (The name authorization identifier name space issue) - There is lots of good discussion of the issues in this section. However, I did not come away with a clear picture of  what behavior will be implemented.&lt;/p&gt;


&lt;p&gt;6.2 &amp;amp; 5.4 - I get the sense that we may be diverging from the standard here. Is this because the current GRANT/REVOKE behavior diverges from the standard?&lt;/p&gt;

&lt;p&gt;Would it be fair to say that the set of roles is determined by the following query &quot;select distinct roleid from sys.sysroles where grantor=&apos;_SYSTEM&apos;&quot;. This might argue for adding a secondary index on (grantor, roleid).&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="12526290" author="dagw" created="Mon, 10 Sep 2007 23:41:57 +0100"  >&lt;p&gt;Thanks for the quick response, Rick!&lt;/p&gt;

&lt;p&gt;I will answer your comments here for now and upload a new version as&lt;br/&gt;
soon as I have incorporated your suggestions.&lt;/p&gt;


&lt;p&gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; Rick Hillegas (JIRA) writes:&lt;/p&gt;

&lt;p&gt;Rick&amp;gt; General - I think that it would be nice if the introductory&lt;br/&gt;
Rick&amp;gt; paragraphs of section 5 spelled out the semantics of ANSI roles&lt;br/&gt;
Rick&amp;gt; in greater detail. For instance, I think that something like the&lt;br/&gt;
Rick&amp;gt; following is true, but the spec doesn&apos;t exactly say this: &lt;br/&gt;
Rick&amp;gt;&lt;br/&gt;
Rick&amp;gt; &quot;At any given time, a session has a user and a role associated&lt;br/&gt;
Rick&amp;gt; with it. At that point in time, the session enjoys all of the&lt;br/&gt;
Rick&amp;gt; privileges explicitly granted to the user plus the transitive&lt;br/&gt;
Rick&amp;gt; closure of all privileges granted to the role and its ancestors&lt;br/&gt;
Rick&amp;gt; in the role graph.&quot;&lt;/p&gt;

&lt;p&gt;You are right, it will be good to spell out basic behavior better in&lt;br/&gt;
the introductory paragraph. &lt;/p&gt;

&lt;p&gt;Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; A related, recurrent usage confuses me. Throughout the spec,&lt;br/&gt;
Rick&amp;gt; statements like the following appear: &quot;the privilege is revoked&lt;br/&gt;
Rick&amp;gt; from any user who has the role&quot;. I don&apos;t think that granting a&lt;br/&gt;
Rick&amp;gt; role to a user results in the role&apos;s privileges being granted to&lt;br/&gt;
Rick&amp;gt; the user. &lt;/p&gt;

&lt;p&gt;You are correct.  A user session that has set the role, however, could&lt;br/&gt;
possibly lose that privilege from its set of current privileges. I&lt;br/&gt;
will try to find such occurences and clarify.&lt;/p&gt;

&lt;p&gt;Rick&amp;gt; I don&apos;t think that you can revoke those privileges&lt;br/&gt;
Rick&amp;gt; from the user--you can only revoke them from the role.&lt;/p&gt;

&lt;p&gt;Correct. Revoking a privilege from a role only revokes it from the&lt;br/&gt;
set of privileges granted to that role. Only a &quot;revoke privilege from&lt;br/&gt;
user&quot; statement will revoke privileges from a user. &lt;/p&gt;

&lt;p&gt;Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; Also, it would be nice if divergences from the standard were highlighted somehow.&lt;/p&gt;

&lt;p&gt;Agreed. I will do that.&lt;/p&gt;

&lt;p&gt;Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; 5.6 (Granting a role to a role) - I think that cycles are not&lt;br/&gt;
Rick&amp;gt; allowed in the role graph. Do you agree?&lt;/p&gt;

&lt;p&gt;I think I say that in the first paragraph of 5.6 ? &quot;.. can not contain&lt;br/&gt;
cycles..&quot;&lt;/p&gt;

&lt;p&gt;Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; 5.7 (Revoking privileges from a role) - The phrasing confuses me&lt;br/&gt;
Rick&amp;gt; (see my general comment above).  I think what you are saying is&lt;br/&gt;
Rick&amp;gt; that, after revoking privilege P from role A, then P is no&lt;br/&gt;
Rick&amp;gt; longer enjoyed by a session operating as A or s one of its&lt;br/&gt;
Rick&amp;gt; descendants in the role graph. Even this is not strictly&lt;br/&gt;
Rick&amp;gt; speaking true, though--or so it seems to me. The session could&lt;br/&gt;
Rick&amp;gt; still enjoy P if P is granted to some other ancestor of the&lt;br/&gt;
Rick&amp;gt; current role.&lt;/p&gt;

&lt;p&gt;Again, I see I have used &quot;user&quot; when thinking of &quot;user session&quot;, will&lt;br/&gt;
clarify throughout, thanks! What you say next is also correct.&lt;/p&gt;

&lt;p&gt;Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; I am afraid I became terribly muddled from paragraph 4&lt;br/&gt;
Rick&amp;gt; onward. It might help if you could tease apart the concepts of&lt;br/&gt;
Rick&amp;gt; session, user, and role.&lt;br/&gt;
Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; 5.8 (Revoking a role from a user) - I got muddled in paragraph&lt;br/&gt;
Rick&amp;gt; 2. Maybe teasing apart the concepts, again, would help.&lt;/p&gt;

&lt;p&gt;I am afraid the lack of precision reflects my own process of digesting&lt;br/&gt;
this and trying to paraphrase the verbose semantic descriptions in the&lt;br/&gt;
standard down to something readable,  Rick! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I will have another go&lt;br/&gt;
at this section!&lt;/p&gt;

&lt;p&gt;Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; 5.9 (Revoking a role from a role) - I did not understand what&lt;br/&gt;
Rick&amp;gt; was meant by saying that role A is also role C. I did not&lt;br/&gt;
Rick&amp;gt; understand the reference to drop behavior in the previous&lt;br/&gt;
Rick&amp;gt; section.&lt;/p&gt;

&lt;p&gt;It should read &quot;unless A is also contained in (not through B) another&lt;br/&gt;
role C&quot;. &lt;/p&gt;

&lt;p&gt;Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; 5.10 (Setting a role) - I recommend moving this section further&lt;br/&gt;
Rick&amp;gt; up. I think that it will give the reader more context for&lt;br/&gt;
Rick&amp;gt; understanding how a session enjoys privileges by changing role.&lt;/p&gt;

&lt;p&gt;Good idea, thanks.&lt;/p&gt;

&lt;p&gt;Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; 6.1 (The name authorization identifier name space issue) - There&lt;br/&gt;
Rick&amp;gt; is lots of good discussion of the issues in this&lt;br/&gt;
Rick&amp;gt; section. However, I did not come away with a clear picture of&lt;br/&gt;
Rick&amp;gt; what behavior will be implemented.&lt;/p&gt;

&lt;p&gt;Right, I have not decided. Suggestions are welcome!&lt;/p&gt;

&lt;p&gt;Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; 6.2 &amp;amp; 5.4 - I get the sense that we may be diverging from the&lt;br/&gt;
Rick&amp;gt; standard here. Is this because the current GRANT/REVOKE behavior&lt;br/&gt;
Rick&amp;gt; diverges from the standard?&lt;/p&gt;

&lt;p&gt;Do you mean &quot;5.2 No initial role&quot;? This is according to the standard.&lt;br/&gt;
For 5.4, yes, I think this is a deviation, in the the dbo has&lt;br/&gt;
automatic power to gtant any privilege. I model this on the current&lt;br/&gt;
behavior (who can grant a privilege to a user: dbo + object owner).&lt;/p&gt;

&lt;p&gt;Rick&amp;gt; &lt;br/&gt;
Rick&amp;gt; Would it be fair to say that the set of roles is determined by&lt;br/&gt;
Rick&amp;gt; the following query &quot;select distinct roleid from sys.sysroles&lt;br/&gt;
Rick&amp;gt; where grantor=&apos;_SYSTEM&apos;&quot;. &lt;/p&gt;

&lt;p&gt;Yes.&lt;/p&gt;

&lt;p&gt;Rick&amp;gt; This might argue for adding a secondary index on (grantor,&lt;br/&gt;
Rick&amp;gt; roleid).&lt;/p&gt;

&lt;p&gt;Yes, I agree.&lt;/p&gt;</comment>
                            <comment id="12527311" author="dagw" created="Fri, 14 Sep 2007 00:26:14 +0100"  >&lt;p&gt;Uploading revision 2.0 of the spec for roles. Hopefully this version&lt;br/&gt;
is more readable the the first attempt.&lt;/p&gt;</comment>
                            <comment id="12527522" author="rhillegas" created="Fri, 14 Sep 2007 15:50:48 +0100"  >&lt;p&gt;Thanks for rev 2 of the spec, Dag. This is very clear now! I have a couple small remarks:&lt;/p&gt;

&lt;p&gt;5.4 (Granting a privilege to a role) I became a little muddled reading this section. I think it would be easier to understand if the next to last paragraph read &quot;grant privileges on that object to a role&quot;&lt;/p&gt;

&lt;p&gt;5.8 (Revoking privileges from a role) I became a little muddled by the reference to PUBLIC. Is PUBLIC semantically a) the union of all users, b) the root of the role graph, or c) both? I suspect it is (a). I think this section would be easier to read if it were phrased in terms of the privileges enjoyed by the session.&lt;/p&gt;

&lt;p&gt;6.2 (Catalog changes) +1 to the ISDEF field!&lt;/p&gt;
</comment>
                            <comment id="12527550" author="dagw" created="Fri, 14 Sep 2007 17:03:02 +0100"  >&lt;p&gt;Thanks, Rick!&lt;/p&gt;

&lt;p&gt;It is option a): &quot;PUBLIC&quot; means all authentication identifiers,&lt;br/&gt;
cf. section 12.3 GR 2:&lt;/p&gt;

&lt;p&gt;&quot;A &amp;lt;grantee&amp;gt; of PUBLIC denotes at all times a list of &amp;lt;grantee&amp;gt;s&lt;br/&gt;
containing all of the &amp;lt;authorization identifier&amp;gt;s in the&lt;br/&gt;
SQL-environment.&quot;&lt;/p&gt;

&lt;p&gt;I added a sentence to explain PUBLIC on first reference to it,&lt;br/&gt;
and reworked the wording a bit in 5.8.&lt;/p&gt;

&lt;p&gt;Uploaded a new revision.&lt;/p&gt;</comment>
                            <comment id="12527561" author="rhillegas" created="Fri, 14 Sep 2007 17:49:21 +0100"  >&lt;p&gt;Thanks, Dag. Crystal clear now!&lt;/p&gt;</comment>
                            <comment id="12531714" author="dagw" created="Tue, 2 Oct 2007 09:29:50 +0100"  >&lt;p&gt;New version (4.0) of the specification, added support for ? in prepared&lt;br/&gt;
statement for SET ROLE, similar to what exists for SET SCHEMA. Added&lt;br/&gt;
some small clarifications.&lt;/p&gt;</comment>
                            <comment id="12540196" author="dagw" created="Mon, 5 Nov 2007 14:32:09 +0000"  >&lt;p&gt;New rev of specification, just minor changes.&lt;/p&gt;</comment>
                            <comment id="12553412" author="djd" created="Wed, 19 Dec 2007 17:49:03 +0000"  >&lt;p&gt;I believe that according to 4.27.3 of the SQL Standard that a SET ROLE within a routine should only take affect during the routine&apos;s execution.&lt;br/&gt;
One the routine returns the current role should revert to its previous value.&lt;/p&gt;</comment>
                            <comment id="12555545" author="dagw" created="Thu, 3 Jan 2008 12:24:33 +0000"  >&lt;p&gt;Yes, that&apos;s how I read it too. It is not implemented yet; not sure how&lt;br/&gt;
to do it, lcc (LanguageConnectionContext) is shared between root and nested&lt;br/&gt;
connections, but seemed the natural place for holding current role.&lt;br/&gt;
The authorization stack that the standard prescribes would need to be&lt;br/&gt;
implemented somehow. &lt;/p&gt;

&lt;p&gt;Btw, it would seem we need this for running with definer&apos;s right&lt;br/&gt;
(stored procedures) as well? (if we want to allow that in future, I&lt;br/&gt;
see vol 13, section 4.10 says its implementation defined.)&lt;/p&gt;

&lt;p&gt;Is setting isolation level currently persistent beyond a nested&lt;br/&gt;
connection?&lt;/p&gt;</comment>
                            <comment id="12555550" author="dagw" created="Thu, 3 Jan 2008 12:39:21 +0000"  >&lt;p&gt;&amp;gt; Is setting isolation level currently persistent beyond a nested&lt;br/&gt;
&amp;gt; connection? &lt;/p&gt;

&lt;p&gt;Tried this, and the answer is yes.&lt;/p&gt;</comment>
                            <comment id="12560002" author="dagw" created="Thu, 17 Jan 2008 17:22:32 +0000"  >&lt;p&gt;Added &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3327&quot; title=&quot;SQL roles: Implement authorization stack (and SQL session context to hold it)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3327&quot;&gt;&lt;del&gt;DERBY-3327&lt;/del&gt;&lt;/a&gt; for implementing an authorization stack to keep&lt;br/&gt;
current role name, cf. discussion above.&lt;/p&gt;</comment>
                            <comment id="12561058" author="dagw" created="Mon, 21 Jan 2008 16:52:20 +0000"  >&lt;p&gt;Uploading rev. 6.0 of the specification.&lt;/p&gt;</comment>
                            <comment id="12561420" author="djd" created="Tue, 22 Jan 2008 19:03:50 +0000"  >&lt;p&gt;Couple of questions about section 5.3 of the spec.&lt;/p&gt;

&lt;p&gt;Section 5.3) &amp;gt; (Implementation restriction) Currently in Derby, user identifier can be max 30 characters long. Until this restriction is lifted, roles will have the same limit,&lt;/p&gt;

&lt;p&gt;     Can this restriction be explained? Since a role is not a user identifier, why should a limit on user identifier impact role name?&lt;/p&gt;

&lt;p&gt;Section  6.1 The name authorization identifier name space issue or maybe section 5.4&lt;/p&gt;

&lt;p&gt;   When granting a privilege can you specify the behaviour for roles/users. I think it is that if the grantee exists as a role then the privilege is granted to that role, otherwise grantee is treated as a user identifier. I think this falls out of the current grant implementation, ie. the grant doesn&apos;t actually care if grantee is a role name or a user name, it just updates the catalogs. Good to be explicit here.&lt;/p&gt;
</comment>
                            <comment id="12561425" author="dagw" created="Tue, 22 Jan 2008 19:20:46 +0000"  >&lt;p&gt;Thanks for looking at the specification again!&lt;/p&gt;

&lt;p&gt;&amp;gt; Section 5.3) &amp;gt; (Implementation restriction) Currently in Derby, user&lt;br/&gt;
&amp;gt; identifier can be max 30 characters long. Until this restriction is&lt;br/&gt;
&amp;gt; lifted, roles will have the same limit,&lt;br/&gt;
&amp;gt; Can this restriction be explained? Since a role is not a user&lt;br/&gt;
&amp;gt; identifier, why should a limit on user identifier impact role name?&lt;/p&gt;

&lt;p&gt;I think the only reason I inherited this restriction is that&lt;br/&gt;
the system tables represent GRANTEE/GRANTOR as VARCHAR(30), but I&lt;br/&gt;
could change that I guess? It may be only the documentation which says&lt;br/&gt;
max 30, I think the actual column is SQLIdentifier&lt;br/&gt;
(VARCHAR(255)). I&apos;ll see if I can remove this restriction from&lt;br/&gt;
roles.&lt;/p&gt;

&lt;p&gt;&amp;gt; &lt;br/&gt;
&amp;gt; Section 6.1 The name authorization identifier name space issue or&lt;br/&gt;
&amp;gt; maybe section 5.4&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; When granting a privilege can you specify the behaviour for&lt;br/&gt;
&amp;gt; roles/users. I think it is that if the grantee exists as a role then&lt;br/&gt;
&amp;gt; the privilege is granted to that role, otherwise grantee is treated&lt;br/&gt;
&amp;gt; as a user identifier. I think this falls out of the current grant&lt;br/&gt;
&amp;gt; implementation, ie. the grant doesn&apos;t actually care if grantee is a&lt;br/&gt;
&amp;gt; role name or a user name, it just updates the catalogs. Good to be&lt;br/&gt;
&amp;gt; explicit here.&lt;/p&gt;

&lt;p&gt;Yes, this is how I understand it also. Will add some explicitness here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12561472" author="djd" created="Tue, 22 Jan 2008 21:18:59 +0000"  >&lt;p&gt;The system columns for grantee/grantor are VARCHAR(128) - this was discussed during the grant/revoke implementation and I think the func spec was never updated which lead to the documentation being wrong.&lt;/p&gt;</comment>
                            <comment id="12563603" author="djd" created="Tue, 29 Jan 2008 18:33:24 +0000"  >&lt;p&gt;The SQL TECHNICAL CORRIGENDUM 1 section 18.3 changes the syntax rules for SET ROLE. My reading of it is that NONE can now only appear as a keyword, NONE as a value expression does not mean set the current role to nothing. Not sure what the code is doing at the moment, I couldn&apos;t see any processing for NONE.&lt;/p&gt;

&lt;p&gt;For connection pooling I think that the reset of a connection from Derby&apos;s PooledConnection needs to reset the role to nothing. Is that being handled?&lt;/p&gt;</comment>
                            <comment id="12563612" author="djd" created="Tue, 29 Jan 2008 18:43:21 +0000"  >&lt;p&gt;Another question around SET ROLE.&lt;/p&gt;

&lt;p&gt;What happens to a connection&apos;s prepared statements that were prepared when a role was in effect and now the role is not in effect?&lt;/p&gt;

&lt;p&gt;E.g.&lt;/p&gt;

&lt;p&gt;SET ROLE PAYROLL_ADMIN&lt;/p&gt;

&lt;p&gt;prepare statement P1 &amp;#8211; which requires role PAYROLL_ADMIN&lt;/p&gt;

&lt;p&gt;execute P1&lt;/p&gt;

&lt;p&gt;SET ROLE NONE&lt;/p&gt;

&lt;p&gt;execute P1 &amp;#8211; what happens here?&lt;/p&gt;</comment>
                            <comment id="12563653" author="dagw" created="Tue, 29 Jan 2008 20:35:55 +0000"  >&lt;p&gt;As for the setting of NONE, please also see the discussion here: &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3137?focusedCommentId=12540465#action_12540465&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/DERBY-3137?focusedCommentId=12540465#action_12540465&lt;/a&gt;&lt;br/&gt;
I think I agree that your reading is correct, but it seems restrictive..&lt;/p&gt;

&lt;p&gt;I also notice that the corrigendum also now states in 18.3 (my emphasis):&lt;/p&gt;

&lt;p&gt;&quot;Set the &lt;b&gt;SQL-session role name&lt;/b&gt; and the current role name for the current SQL-session context.&quot;&lt;/p&gt;

&lt;p&gt;whereas previously it said:&lt;/p&gt;

&lt;p&gt;&quot;Set the current role name for the current SQL-session context.&quot;&lt;/p&gt;

&lt;p&gt;Does this mean that the role set inside a stored procedure should be in effect also after returning? Or is it just semantic&lt;br/&gt;
finery?&lt;/p&gt;</comment>
                            <comment id="12563655" author="dagw" created="Tue, 29 Jan 2008 20:37:44 +0000"  >&lt;p&gt;&amp;gt; For connection pooling I think that the reset of a connection from Derby&apos;s PooledConnection needs to reset the role to nothing. Is that being handled?&lt;/p&gt;

&lt;p&gt;I have not handled this area yet, it sounds reasonable. Thanks for the reminder!&lt;/p&gt;</comment>
                            <comment id="12563673" author="dagw" created="Tue, 29 Jan 2008 21:17:57 +0000"  >&lt;p&gt;Re: changing current role after a prepare of a statement.&lt;/p&gt;

&lt;p&gt;I am working on code to register dependencies of prepared statements (or just the activation?)  as well as triggers, views and constraints, of one (or more) roles being depended on (for the authorization check to succeed), cf. discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3223&quot; title=&quot;SQL roles: make use of privileges granted to roles in actual privilege checking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3223&quot;&gt;&lt;del&gt;DERBY-3223&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think the changing of the current role (or dropping of a role which the ps depends on) should invalidate the (activation of) the prepared statement&lt;br/&gt;
here, forcing a re-check at the second execute.&lt;/p&gt;</comment>
                            <comment id="12563677" author="djd" created="Tue, 29 Jan 2008 21:24:06 +0000"  >&lt;p&gt;Section 4.34.1.1 says the SQL-session role name is a property of the authorization stack and that is a property of the SQL-session context.&lt;/p&gt;

&lt;p&gt;Section 10.4 says a routine invocation pushes a new  SQL-session context.&lt;/p&gt;

&lt;p&gt;So I think the role still needs to be reverted when a routine is completed.&lt;/p&gt;</comment>
                            <comment id="12563682" author="djd" created="Tue, 29 Jan 2008 21:29:34 +0000"  >&lt;p&gt;&amp;gt; I think the changing of the current role should invalidate the (activation of) the prepared statement here, forcing a re-check at the second execute. &lt;/p&gt;

&lt;p&gt;Is this some new mechanism, because today prepared statements are invalidated, not activations?&lt;/p&gt;

&lt;p&gt;I think invalidating the prepared statements is a bad plan. A SET ROLE will become a common operation, especially for routines. Having a routine execution invalidate any prepared statements will cause tremendous performance problems as all users executing the routine will be constantly invalidating each other&apos;s plans.&lt;/p&gt;

&lt;p&gt;I agree dropping a role should perform the invalidations, but not resetting a role.&lt;/p&gt;</comment>
                            <comment id="12563707" author="dagw" created="Tue, 29 Jan 2008 22:41:03 +0000"  >&lt;p&gt;&amp;gt; Is this some new mechanism, because today prepared statements are&lt;br/&gt;
&amp;gt; invalidated, not activations?&lt;/p&gt;

&lt;p&gt;Yes, one I was contemplating..&lt;/p&gt;

&lt;p&gt;&amp;gt; I think invalidating the prepared statements is a bad plan. A SET ROLE&lt;br/&gt;
&amp;gt; will become a common operation, especially for routines. Having a&lt;br/&gt;
&amp;gt; routine execution invalidate any prepared statements will cause&lt;br/&gt;
&amp;gt; tremendous performance problems as all users executing the routine&lt;br/&gt;
&amp;gt; will be constantly invalidating each other&apos;s plans.&lt;/p&gt;

&lt;p&gt;Yes, this was my worry too, which is why I considered invalidating&lt;br/&gt;
just the activation.&lt;/p&gt;

&lt;p&gt;&amp;gt; I agree dropping a role should perform the invalidations, but not&lt;br/&gt;
&amp;gt; resetting a role.&lt;/p&gt;

&lt;p&gt;This seems right for persistent objects (view, triggers, constraints),&lt;br/&gt;
but in the case of the prepared statement (your example), it seems to&lt;br/&gt;
me be the role should still be in place when the execute is performed?&lt;br/&gt;
(although not for every cursor access &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;If so, some kind of invalidation seems called for...?&lt;/p&gt;

&lt;p&gt;We could just wave our hands and say the check is only performed on&lt;br/&gt;
the first execute of a ps (when the checks are done for the activation&lt;br/&gt;
as it is created) I guess. Maybe that is acceptable although not&lt;br/&gt;
strictly compliant? Or does your interpretation lead you to believe it &lt;b&gt;is&lt;/b&gt; compliant?&lt;/p&gt;</comment>
                            <comment id="12563728" author="djd" created="Tue, 29 Jan 2008 23:21:22 +0000"  >&lt;p&gt;I meant using the existing prepared statement invalidation was too heavy for SET ROLE.&lt;/p&gt;

&lt;p&gt;Something is needed to ensure security is maintained and that one cannot execute a statement that requires role R if R is not the current role.&lt;/p&gt;</comment>
                            <comment id="12563735" author="djd" created="Tue, 29 Jan 2008 23:31:37 +0000"  >&lt;p&gt;Minor comment on the spec, the syntax section for SET ROLE says it supports a value specification or NONE.&lt;/p&gt;

&lt;p&gt;However the text indicates it &lt;b&gt;also&lt;/b&gt; supports an identifier, the syntax section should be updated to reflect what is planned.&lt;/p&gt;</comment>
                            <comment id="12563787" author="dagw" created="Wed, 30 Jan 2008 01:28:24 +0000"  >&lt;p&gt;Uploaded revision 7.0 of the specification. Adds missing syntax alternative to SET ROLE; thanks, Dan!&lt;/p&gt;</comment>
                            <comment id="12563790" author="dagw" created="Wed, 30 Jan 2008 01:31:58 +0000"  >&lt;p&gt;&amp;gt; I meant using the existing prepared statement invalidation was too&lt;br/&gt;
&amp;gt; heavy for SET ROLE. Something is needed to ensure security is&lt;br/&gt;
&amp;gt; maintained and that one cannot execute a statement that requires role&lt;br/&gt;
&amp;gt; R if R is not the current role.&lt;/p&gt;

&lt;p&gt;Then we are in agreement &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; What do you think of the idea of making is&lt;br/&gt;
possible to invalidate activations? Anyway, I&apos;ll keep looking for a good way to&lt;br/&gt;
solve this...&lt;/p&gt;</comment>
                            <comment id="12570077" author="dagw" created="Tue, 19 Feb 2008 01:36:04 +0000"  >&lt;p&gt;Updated specification to lift maximum role name identifier length to 128,&lt;br/&gt;
and to reserve SYS prefix for role names.&lt;/p&gt;</comment>
                            <comment id="12571535" author="djd" created="Fri, 22 Feb 2008 19:09:32 +0000"  >&lt;p&gt;Need to ensure CREATE ROLE PUBLIC is not allowed before any release. Last time I tried it worked.&lt;/p&gt;</comment>
                            <comment id="12642991" author="dagw" created="Mon, 27 Oct 2008 18:11:38 +0000"  >&lt;p&gt;Uploading a new version of the specification, rev. 9.0:&lt;/p&gt;

&lt;p&gt;      Brought in line with final implementation. &lt;br/&gt;
      Most sections were sections touched, changed tense from future to present.&lt;br/&gt;
      Added design and implementation information.&lt;/p&gt;</comment>
                            <comment id="12642996" author="dagw" created="Mon, 27 Oct 2008 18:16:53 +0000"  >&lt;p&gt;I notice I forgot to answer Dan&apos;s comment:&lt;/p&gt;

&lt;p&gt;&amp;gt; Need to ensure CREATE ROLE PUBLIC is not allowed before any release.&lt;/p&gt;

&lt;p&gt;This has been fixed long ago with svn 655948 (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3333&quot; title=&quot;User name corresponding to authentication identifier PUBLIC must be rejected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3333&quot;&gt;DERBY-3333&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="12643288" author="rhillegas" created="Tue, 28 Oct 2008 17:48:07 +0000"  >&lt;p&gt;Hi Dag,&lt;/p&gt;

&lt;p&gt;Thanks for the revised spec. As I read section 5.9, I wondered if you could clarify what should happen in the following situation:&lt;/p&gt;

&lt;p&gt;create role A;&lt;br/&gt;
create role B;&lt;br/&gt;
grant A to B;&lt;br/&gt;
grant B to FRED;&lt;br/&gt;
revoke A from FRED;&lt;/p&gt;

&lt;p&gt;At this point should FRED be able to do the following:&lt;/p&gt;

&lt;p&gt;1) &quot;set role A&quot;&lt;br/&gt;
2) &quot;set role B&quot; then access objects which need privileges granted to A?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Rick&lt;/p&gt;</comment>
                            <comment id="12643296" author="dagw" created="Tue, 28 Oct 2008 18:25:40 +0000"  >&lt;p&gt;Thanks for looking at the updated spec, Rick!&lt;/p&gt;

&lt;p&gt;You can&apos;t revoke A from FRED because A was never granted to FRED.&lt;br/&gt;
A is only enabled for FRED due to it being contained in B. By the same token,&lt;br/&gt;
FRED can&apos;t set A, either.&lt;/p&gt;

&lt;p&gt;Uploading the spec again, fixing some opaque phrases that Kim spotted working on &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3193&quot; title=&quot;SQL roles: Add documentation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3193&quot;&gt;&lt;del&gt;DERBY-3193&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12643517" author="dagw" created="Wed, 29 Oct 2008 15:33:22 +0000"  >&lt;p&gt;Uploaded version 10.0, adding VTI SYSCS_DIAG.CONTAINED_ROLES notes.&lt;/p&gt;</comment>
                            <comment id="12644138" author="dagw" created="Thu, 30 Oct 2008 22:30:00 +0000"  >&lt;p&gt;Uploading version 11 of the spec to cater for changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3930&quot; title=&quot;SQL roles: Add VTI for CONTAINED_ROLES&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3930&quot;&gt;&lt;del&gt;DERBY-3930&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12649885" author="dagw" created="Sat, 22 Nov 2008 02:06:48 +0000"  >&lt;p&gt;Resolving; I don&apos;t intend to improve this functionality further for now.&lt;br/&gt;
The present functionality should implement the specification, modulo bugs.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12378213">DERBY-3073</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12382113">DERBY-3191</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12386518">DERBY-3327</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12380756">DERBY-3137</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12382200">DERBY-3193</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12383067">DERBY-3223</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12395511">DERBY-3667</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12405853">DERBY-3901</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12386639">DERBY-3333</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12407413">DERBY-3928</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12407414">DERBY-3929</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12406143">DERBY-3906</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12389469">DERBY-3460</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12396397" name="spec.html" size="58349" author="dagw" created="Thu, 18 Dec 2008 16:12:58 +0000"/>
                            <attachment id="12393111" name="spec.html" size="58171" author="dagw" created="Thu, 30 Oct 2008 22:30:00 +0000"/>
                            <attachment id="12392993" name="spec.html" size="58050" author="dagw" created="Wed, 29 Oct 2008 15:33:22 +0000"/>
                            <attachment id="12392946" name="spec.html" size="57589" author="dagw" created="Tue, 28 Oct 2008 18:25:40 +0000"/>
                            <attachment id="12392878" name="spec.html" size="57560" author="dagw" created="Mon, 27 Oct 2008 18:11:37 +0000"/>
                            <attachment id="12375878" name="spec.html" size="43997" author="dagw" created="Tue, 19 Feb 2008 01:36:04 +0000"/>
                            <attachment id="12374322" name="spec.html" size="43784" author="dagw" created="Wed, 30 Jan 2008 01:28:24 +0000"/>
                            <attachment id="12373694" name="spec.html" size="43469" author="dagw" created="Mon, 21 Jan 2008 17:04:44 +0000"/>
                            <attachment id="12368978" name="spec.html" size="43013" author="dagw" created="Mon, 5 Nov 2007 14:32:09 +0000"/>
                            <attachment id="12366891" name="spec.html" size="41860" author="dagw" created="Tue, 2 Oct 2007 09:29:50 +0100"/>
                            <attachment id="12365876" name="spec.html" size="41175" author="dagw" created="Fri, 14 Sep 2007 17:03:02 +0100"/>
                            <attachment id="12365783" name="spec.html" size="40608" author="dagw" created="Fri, 14 Sep 2007 00:26:14 +0100"/>
                            <attachment id="12365486" name="spec.html" size="34704" author="dagw" created="Mon, 10 Sep 2007 17:22:24 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12403193">DERBY-3859</subtask>
                            <subtask id="12404336">DERBY-3877</subtask>
                            <subtask id="12407415">DERBY-3930</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10361"><![CDATA[Security]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 25 Jan 2007 20:38:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30322</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0pfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37937</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>