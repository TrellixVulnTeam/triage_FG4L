<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:43:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-1661/DERBY-1661.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-1661] Create index on large tables fails with too many open files , FileNotFoundException.</title>
                <link>https://issues.apache.org/jira/browse/DERBY-1661</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;Create index fails on a table with 18million rows during sort with too many open files error&lt;/p&gt;

&lt;p&gt;This error was first seen when running against a tpcc-like test.  The test creates the tables, inserts data and then creates the indexes &amp;amp; adds constraints.&lt;/p&gt;

&lt;p&gt;Customer table has 18 million rows in this case. The below error is thrown on create index. &lt;/p&gt;

&lt;p&gt;ij&amp;gt; create index customer_last on customer(c_w_id, c_d_id, c_last);&lt;br/&gt;
ERROR XSDF1: Exception during creation of file /home/cloudtst/SinglePerf/testruns/scripts/dbtpcc/tmp/T1128794811044.tmp for container&lt;br/&gt;
ERROR XJ001: Java exception: &apos;/home/cloudtst/SinglePerf/testruns/scripts/dbtpcc/tmp/T1128794811044.tmp (Too many open files): java.io.FileNotFoundException&apos;.&lt;br/&gt;
ij&lt;/p&gt;</description>
                <environment></environment>
        <key id="12347716">DERBY-1661</key>
            <summary>Create index on large tables fails with too many open files , FileNotFoundException.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="skambha">Sunitha Kambhampati</assignee>
                                    <reporter username="skambha">Sunitha Kambhampati</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Aug 2006 17:34:29 +0100</created>
                <updated>Thu, 13 Dec 2007 09:05:08 +0000</updated>
                            <resolved>Fri, 11 Aug 2006 00:38:56 +0100</resolved>
                                    <version>10.0.2.0</version>
                    <version>10.0.2.1</version>
                    <version>10.1.1.0</version>
                    <version>10.1.2.1</version>
                    <version>10.1.3.1</version>
                    <version>10.2.1.6</version>
                                    <fixVersion>10.2.1.6</fixVersion>
                                    <component>Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12427291" author="skambha" created="Thu, 10 Aug 2006 18:59:13 +0100"  >&lt;p&gt;I am attaching a patch derby1661.diff.txt to fix this issue.   &lt;/p&gt;

&lt;p&gt;This patch changes the max size for merge runs to 512 from 1024.&lt;/p&gt;

&lt;p&gt;For more notes on this issue, please see 1661_notes.txt.  Also attached is an excel sheet  with some numbers.  &lt;/p&gt;

&lt;p&gt;svn stat&lt;br/&gt;
M      java\engine\org\apache\derby\impl\store\access\sort\ExternalSortFactory.java&lt;/p&gt;

&lt;p&gt;I ran derbyall on windows/jdk142 ok with this patch.&lt;/p&gt;

&lt;p&gt;Can someone please review.  Thanks. &lt;/p&gt;</comment>
                            <comment id="12427366" author="mikem" created="Fri, 11 Aug 2006 00:02:57 +0100"  >&lt;p&gt;I have reviewed and committed this change.  To me I think this is a reasonable 1st step to addressing this&lt;br/&gt;
issue, it should avoid most errors when doing large index builds on default linux systems.  I hope that &lt;br/&gt;
in subsequent releases the additional changes Sunitha proposes in her notes can be looked at.  &lt;/p&gt;

&lt;p&gt;Looking at upping the default 1 meg in memory part of the sort should be looked at, this is incredibly small&lt;br/&gt;
for a large number of the system we are running on.  &lt;/p&gt;

&lt;p&gt;Also putting each sort merge run in a separate file was the easiest at the time, but does use up a lot of &lt;br/&gt;
filesystem resources.  In any case the entire derby server should maintain some control on open files,&lt;br/&gt;
currently the sort module can eat  up 512 open files per connections in worst case.  Some other solutions&lt;br/&gt;
would be to tie the open files into something like the open file cache in the store, or maybe just store all&lt;br/&gt;
the sort runs in a single file - i think they are written sequentially so may not be hard to do using existing&lt;br/&gt;
streamed file support in the store.&lt;/p&gt;

&lt;p&gt;m1_142:134&amp;gt;svn commit&lt;/p&gt;

&lt;p&gt;Sending        java\engine\org\apache\derby\impl\store\access\sort\ExternalSortFactory.java&lt;br/&gt;
Transmitting file data .&lt;br/&gt;
Committed revision 430578.&lt;/p&gt;</comment>
                            <comment id="12427374" author="skambha" created="Fri, 11 Aug 2006 00:38:56 +0100"  >&lt;p&gt;Thanks Mike for the commit.  &lt;/p&gt;</comment>
                            <comment id="12551393" author="fuzzylogic" created="Thu, 13 Dec 2007 09:05:08 +0000"  >&lt;p&gt;This issue has been resolved for over a year with no further movement. Closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12347813">DERBY-1676</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12347815">DERBY-1677</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12347820">DERBY-1679</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12338618" name="1661_Notes.txt" size="5145" author="skambha" created="Thu, 10 Aug 2006 18:59:13 +0100"/>
                            <attachment id="12338619" name="1661_PerfResults.xls" size="32256" author="skambha" created="Thu, 10 Aug 2006 18:59:13 +0100"/>
                            <attachment id="12338617" name="derby1661.diff.txt" size="761" author="skambha" created="Thu, 10 Aug 2006 18:59:13 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Aug 2006 23:02:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22627</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy102v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39663</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>