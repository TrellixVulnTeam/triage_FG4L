<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:23:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-5806/DERBY-5806.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-5806] Trying to prepare statement with no text causes DRDA protocol exception</title>
                <link>https://issues.apache.org/jira/browse/DERBY-5806</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;I accidentally stumbled into a rather awkward bit of error handling.&lt;/p&gt;

&lt;p&gt;On an IJ session running client/server, I tried:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; connect &apos;jdbc:derby://localhost:1527/brydb&apos;;&lt;br/&gt;
ij&amp;gt; prepare seeMenu as &apos;&apos;;&lt;br/&gt;
ERROR 08006: A network protocol error was encountered and the connection has been terminated: A PROTOCOL Data Stream Syntax Error was detected.  Reason: 0x9,236. Plaintext connection attempt to an SSL enabled server?&lt;/p&gt;

&lt;p&gt;On the Network Server side, I see:&lt;/p&gt;

&lt;p&gt;Sat Jun 09 09:28:51 PDT 2012 : Execution failed because of a Distributed Protocol Error:  DRDA_Proto_SYNTAXRM; CODPNT arg  = 2414; Error Code Value = e. Plaintext connection attempt from an SSL enabled client?&lt;br/&gt;
org.apache.derby.impl.drda.DRDAProtocolException: Execution failed because of a Distributed Protocol Error:  DRDA_Proto_SYNTAXRM; CODPNT arg  = 2414; Error Code Value = e. Plaintext connection attempt from an SSL enabled client?&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.throwSyntaxrm(DRDAConnThread.java:537)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.missingCodePoint(DRDAConnThread.java:567)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parsePRPSQLSTTobjects(DRDAConnThread.java:3858)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.parsePRPSQLSTT(DRDAConnThread.java:3788)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:831)&lt;br/&gt;
	at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:295)&lt;/p&gt;

&lt;p&gt;It seems like the error handling could be improved here, for what is essentially a syntax error on my part.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12560052">DERBY-5806</key>
            <summary>Trying to prepare statement with no text causes DRDA protocol exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dyret">Dyre Tjeldvoll</assignee>
                                    <reporter username="bryanpendleton">Bryan Pendleton</reporter>
                        <labels>
                            <label>derby_triage10_10</label>
                            <label>derby_triage10_11</label>
                    </labels>
                <created>Sat, 9 Jun 2012 17:33:59 +0100</created>
                <updated>Wed, 21 Jan 2015 00:23:40 +0000</updated>
                            <resolved>Fri, 1 Nov 2013 09:52:16 +0000</resolved>
                                    <version>10.10.1.1</version>
                                                    <component>Network Client</component>
                    <component>Network Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13292882" author="kmarsden" created="Mon, 11 Jun 2012 18:01:01 +0100"  >&lt;p&gt;Marking newcomer and repro attached. This would be an interesting issue for a new developer with interest in DRDA protocol and also possibly as a coverage issue.&lt;/p&gt;</comment>
                            <comment id="13808840" author="dyret" created="Wed, 30 Oct 2013 08:13:28 +0000"  >&lt;p&gt;Attaching a patch which:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Addresses the root cause which appears to be that &lt;tt&gt;DRDAConnThread.parseCcsidMBC()&lt;/tt&gt; incorrectly returns &lt;tt&gt;null&lt;/tt&gt; for a zero-length string value.&lt;/li&gt;
	&lt;li&gt;Fixes &lt;tt&gt;DRDAStatement.isCallableSQL()&lt;/tt&gt; so that it handles an empty string, (it uses &lt;tt&gt;StringTokenizer&lt;/tt&gt; and assumed that it would always be safe to call &lt;tt&gt;nextToken()&lt;/tt&gt;).&lt;/li&gt;
	&lt;li&gt;Extends &lt;tt&gt;NullSQLTextTest&lt;/tt&gt; with test cases where the input is an empty string.&lt;/li&gt;
	&lt;li&gt;Fixes an additional problem uncovered by the new test cases where the client driver sets &lt;tt&gt;ClientStatement.sqlMode_&lt;/tt&gt; to &lt;tt&gt;ClientStatement.isQuery_&amp;#95;&lt;/tt&gt; for all empty statements, which causes the client driver to fail in the cases where &lt;tt&gt;sqlMode_&lt;/tt&gt; is not compatible with &lt;tt&gt;executeType&lt;/tt&gt;, and throw a different error than the expected syntax error thrown by the embedded driver.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13811136" author="jira-bot" created="Fri, 1 Nov 2013 09:50:29 +0000"  >&lt;p&gt;Commit 1537874 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dyret&quot; class=&quot;user-hover&quot; rel=&quot;dyret&quot;&gt;Dyre Tjeldvoll&lt;/a&gt; in branch &apos;code/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1537874&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1537874&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-5806&quot; title=&quot;Trying to prepare statement with no text causes DRDA protocol exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-5806&quot;&gt;&lt;del&gt;DERBY-5806&lt;/del&gt;&lt;/a&gt;: Fix parsing of empty string in DRDAConnThread. Set ClientStatement.sqlMode_ correctly for empty statements.&lt;/p&gt;</comment>
                            <comment id="13811260" author="knutanders" created="Fri, 1 Nov 2013 14:01:56 +0000"  >&lt;p&gt;Thanks for fixing this bug, Dyre.&lt;/p&gt;

&lt;p&gt;Just one question about this part of the fix:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--- db/derby/code/trunk/java/drda/org/apache/derby/impl/drda/DRDAConnThread.java (original)
+++ db/derby/code/trunk/java/drda/org/apache/derby/impl/drda/DRDAConnThread.java Fri Nov  1 09:50:15 2013
@@ -5920,7 +5920,9 @@ class DRDAConnThread extends Thread {
         String ccsidMBCEncoding = currentStatement.ccsidMBCEncoding;
 
         if (length == 0) {
-            return null;
+            // Can&apos;t return null here as that will indicate that the cp is 
+            // missing, when it in fact was present, but contained an empty string
+            return &quot;&quot;; 
         }
         byte [] byteStr = reader.readBytes(length);
         if (ccsidMBCEncoding != null)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks to me as if the method would have returned &quot;&quot; when length == 0 if we&apos;d just let it go through the normal code path below. Would it make sense to remove the special handling of length == 0 and use the same code path for all cases?&lt;/p&gt;</comment>
                            <comment id="14284840" author="myrna" created="Wed, 21 Jan 2015 00:23:40 +0000"  >&lt;p&gt;bulk change to close all issues resolved but not closed and not changed since June 1, 2014.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12611005" name="derby-5806a.diff" size="4181" author="dyret" created="Wed, 30 Oct 2013 08:13:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310200" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Bug behavior facts</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10365"><![CDATA[Crash]]></customfieldvalue>
    <customfieldvalue key="10363"><![CDATA[Embedded/Client difference]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Jun 2012 17:01:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245790</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10423"><![CDATA[Newcomer]]></customfieldvalue>
    <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy09pb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35390</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>