<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 03:28:59 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/DERBY-4365/DERBY-4365.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[DERBY-4365] NullPointerException when preparing LEFT OUTER JOIN between VALUES statements</title>
                <link>https://issues.apache.org/jira/browse/DERBY-4365</link>
                <project id="10594" key="DERBY">Derby</project>
                    <description>&lt;p&gt;ij version 10.5&lt;br/&gt;
ij&amp;gt; connect &apos;jdbc:derby:db;create=true&apos;;&lt;br/&gt;
ij&amp;gt; select a.* from (values (&apos;a&apos;),(&apos;b&apos;),(null)) a&lt;br/&gt;
    left outer join (values (&apos;c&apos;),(&apos;d&apos;)) b on 1=1;&lt;br/&gt;
ERROR XJ001: Java exception: &apos;: java.lang.NullPointerException&apos;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12434421">DERBY-4365</key>
            <summary>NullPointerException when preparing LEFT OUTER JOIN between VALUES statements</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mamtas">Mamta A. Satoor</assignee>
                                    <reporter username="knutanders">Knut Anders Hatlen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Aug 2009 13:21:31 +0100</created>
                <updated>Tue, 2 Feb 2010 09:57:42 +0000</updated>
                            <resolved>Fri, 13 Nov 2009 21:27:14 +0000</resolved>
                                    <version>10.5.3.0</version>
                                    <fixVersion>10.5.3.1</fixVersion>
                    <fixVersion>10.6.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12773394" author="mamtas" created="Wed, 4 Nov 2009 06:53:50 +0000"  >&lt;p&gt;I think the culprit here is the null value in values clause. A bit smaller repro is&lt;br/&gt;
select a.* from (values (null)) a &lt;br/&gt;
    left outer join (values (&apos;a&apos;)) b on 1=1; &lt;/p&gt;


&lt;p&gt;I tried without the left outer join&lt;br/&gt;
select a.* from (values (null)) a;&lt;br/&gt;
The above query actually gave an error&lt;br/&gt;
ERROR 42X07: Null is only allowed in a VALUES clause within an INSERT statement.&lt;/p&gt;

&lt;p&gt;Maybe same error has to be thrown for the left outer join case since according to the above error message, Null should not be allowed for our query since it is not an INSERT statement.&lt;/p&gt;</comment>
                            <comment id="12773408" author="mamtas" created="Wed, 4 Nov 2009 07:48:57 +0000"  >&lt;p&gt;I see that we are not doing bindUntypedNullsToResultColumns() for the resultsets involved in the join clause. I will look further into it.&lt;/p&gt;</comment>
                            <comment id="12773669" author="bryanpendleton" created="Wed, 4 Nov 2009 22:21:19 +0000"  >&lt;p&gt;According to my (ancient) copy of Date &amp;amp; Darwen&apos;s &lt;em&gt;A Guide to the SQL Standard&lt;/em&gt;:&lt;/p&gt;

&lt;p&gt;  DEFAULT and NULL are permitted only if the row constructor is being used to&lt;br/&gt;
  specify the source, or part of the source, for an INSERT statement.&lt;/p&gt;
</comment>
                            <comment id="12773725" author="mamtas" created="Thu, 5 Nov 2009 00:24:51 +0000"  >&lt;p&gt;Thanks, Bryan, for verifying what the SQL spec says. So, it seems that we should throw an exception for the following query&lt;br/&gt;
select a.* from (values (&apos;a&apos;),(&apos;b&apos;),(null)) a &lt;br/&gt;
    left outer join (values (&apos;c&apos;),(&apos;d&apos;)) b on 1=1; &lt;/p&gt;</comment>
                            <comment id="12773825" author="knutanders" created="Thu, 5 Nov 2009 08:13:58 +0000"  >&lt;p&gt;That&apos;s my understanding too. It should be OK to specify NULL if it&apos;s wrapped in a CAST, though. So this query should still be accepted:&lt;/p&gt;

&lt;p&gt;ij&amp;gt; select a.* from (values (&apos;a&apos;),(&apos;b&apos;),(cast(null as char(1)))) a left outer join (values (&apos;c&apos;),(&apos;d&apos;)) b on 1=1;&lt;br/&gt;
1   &lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;a   &lt;br/&gt;
a   &lt;br/&gt;
b   &lt;br/&gt;
b   &lt;br/&gt;
NULL&lt;br/&gt;
NULL&lt;/p&gt;

&lt;p&gt;6 rows selected&lt;/p&gt;</comment>
                            <comment id="12773992" author="mamtas" created="Thu, 5 Nov 2009 17:38:45 +0000"  >&lt;p&gt;I have a patch which I am ready to commit if noone has any objection to it. Basically, for some reason, for JOIN, we were doing a no-op in the method bindUntypedNullsToResultColumns(ResultColumnList) rather than checking for untyped nulls for the left and right resultsets. I have made changes so that check is made. I have added couple more tests (including the one provided by Knut, where a CAST of NULL values should work fine). I will plan on committing the patch tomorrow if there is no feedback. The derbyall and junit suites ran fine with the exception of known intermittent (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3757&quot; title=&quot;&amp;#39;ASSERT FAILED transaction table has null entry when running new StressMultiTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3757&quot;&gt;&lt;del&gt;DERBY-3757&lt;/del&gt;&lt;/a&gt;) &apos;ASSERT FAILED transaction table has null entry when running new StressMultiTest&lt;/p&gt;</comment>
                            <comment id="12774250" author="knutanders" created="Fri, 6 Nov 2009 09:20:55 +0000"  >&lt;p&gt;Good catch, Mamta! The fix looks correct to me. +1 to commit.&lt;/p&gt;</comment>
                            <comment id="12774306" author="mamtas" created="Fri, 6 Nov 2009 15:09:20 +0000"  >&lt;p&gt;Knut, thanks for reviewing the patch. I have committed into trunk using revision 833430. The commit comments were as follows&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-4365&quot; title=&quot;NullPointerException when preparing LEFT OUTER JOIN between VALUES statements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-4365&quot;&gt;&lt;del&gt;DERBY-4365&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For JOIN, we were doing a no-op in the method bindUntypedNullsToResultColumns(ResultColumnList) rather than checking for untyped nulls for the left and right resultsets. The changes through this commit now checks for untyped nulls for joins. Added couple more tests (including where a CAST of NULL values should work fine). The derbyall and junit suites ran fine with the exception of known intermittent (&lt;a href=&quot;https://issues.apache.org/jira/browse/DERBY-3757&quot; title=&quot;&amp;#39;ASSERT FAILED transaction table has null entry when running new StressMultiTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DERBY-3757&quot;&gt;&lt;del&gt;DERBY-3757&lt;/del&gt;&lt;/a&gt;) &apos;ASSERT FAILED transaction table has null entry when running new StressMultiTest &lt;/p&gt;</comment>
                            <comment id="12777669" author="mamtas" created="Fri, 13 Nov 2009 21:27:14 +0000"  >&lt;p&gt;Backported the change into 10.5 codeline. I ran derbyall succesfully. Junit suite (specifically upgrade test) has been running into connectivity issues which might be local to my machine configuration. I will keep an eye open to see if this commit causes any failure on 10.5 codeline but the change has been running fine on trunk for sometime now.&lt;/p&gt;</comment>
                            <comment id="12777779" author="mamtas" created="Sat, 14 Nov 2009 00:52:05 +0000"  >&lt;p&gt;I rerean the junit tests on 10.5 with my changes and this time there were no connection related failures for upgrade tests. Everything ran fine. &lt;/p&gt;</comment>
                            <comment id="12828570" author="knutanders" created="Tue, 2 Feb 2010 09:57:42 +0000"  >&lt;p&gt;Verified fix on trunk. Closing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12424140" name="DERBY4365_NULLinValues_diff_patch1.txt" size="2921" author="mamtas" created="Thu, 5 Nov 2009 17:38:45 +0000"/>
                            <attachment id="12424141" name="DERBY4365_NULLinValues_stat_patch1.txt" size="163" author="mamtas" created="Thu, 5 Nov 2009 17:38:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 4 Nov 2009 06:53:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24210</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Issue &amp; fix info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10424"><![CDATA[Repro attached]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hy0r8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38231</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310050" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Urgency</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10052"><![CDATA[Normal]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>