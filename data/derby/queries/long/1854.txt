Running the following short SQL script from ij will cause an error "ERROR XSAI2: The conglomerate (817) requested does not exist.".  It appears that the SYSCS_COMPRESS_TABLE function corrupts tables that have a single column which is both a primary key and a foreign key.


connect 'jdbc:derby:/testdb;create=true';

CREATE TABLE users (
 user_id INT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
 user_login VARCHAR(255) NOT NULL,
 PRIMARY KEY (user_id));

CREATE TABLE admins (
 user_id INT NOT NULL,
 PRIMARY KEY (user_id),
 CONSTRAINT admin_uid_fk FOREIGN KEY (user_id) REFERENCES users (user_id));

INSERT INTO users (user_login) VALUES('TEST1');
INSERT INTO admins VALUES (VALUES IDENTITY_VAL_LOCAL());

CALL SYSCS_UTIL.SYSCS_COMPRESS_TABLE('APP', 'ADMINS', 0);

SELECT * from admins;