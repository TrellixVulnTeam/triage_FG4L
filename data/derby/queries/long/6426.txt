code treats any StandardException as a login exception due to curious no-op code. Added login state check to make it work as expected.