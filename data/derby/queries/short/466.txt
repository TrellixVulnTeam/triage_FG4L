Distinct in subselect can return wrong results