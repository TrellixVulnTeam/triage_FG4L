Rolling back a transaction leads to an inconsistent state