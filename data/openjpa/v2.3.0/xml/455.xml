<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:44:11 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-455/OPENJPA-455.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-455] Incorrect MySQL DDL Generation for integer types</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-455</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Opening a JIRA report on Tim&apos;s behalf. &lt;/p&gt;

&lt;p&gt;I turned the schema tool loose on a MySQL production database this&lt;br/&gt;
afternoon and it failed. The essence of the problem appears that DDL was&lt;br/&gt;
being generated with a type declaration of this form:&lt;/p&gt;

&lt;p&gt;int unsigned(10)&lt;/p&gt;

&lt;p&gt;In MySQL, the proper form is:&lt;/p&gt;

&lt;p&gt;int(10) unsigned&lt;/p&gt;

&lt;p&gt;viz:&lt;/p&gt;

&lt;p&gt;ALTER TABLE fubar MODIFY col1 int(10) unsigned;&lt;/p&gt;

&lt;p&gt;Checking other options indicates that similar constructs such as CREATE&lt;br/&gt;
TABLE are likewise defective.&lt;/p&gt;

&lt;p&gt;I looked at the svn trunk head source code in&lt;br/&gt;
org.apache.openjpa.jdbc.sql.MySQLDictionary.java and the parent class&lt;br/&gt;
DBDictionary.java. The offending method appears to be:&lt;/p&gt;

&lt;p&gt;1508:     public String getTypeName(Column col)&lt;/p&gt;

&lt;p&gt;This method has no override in MySQLDictionary, but apparently needs&lt;br/&gt;
one. I think it&apos;s a minor mod, but I&apos;m not currently set up to build and&lt;br/&gt;
test in the environment where the offending database exists.&lt;/p&gt;

&lt;p&gt;This is a SEVERE error. It causes generation of defective SQL for&lt;br/&gt;
SQL-generating options and causes live updates to schemas to fail.&lt;/p&gt;

&lt;p&gt;I don&apos;t have a Jira login at present, so if someone could log this, it&lt;br/&gt;
would be appreciated.&lt;/p&gt;

&lt;p&gt;  Thanks,&lt;/p&gt;

&lt;p&gt;   Tim Holloway&lt;/p&gt;</description>
                <environment></environment>
        <key id="12383365">OPENJPA-455</key>
            <summary>Incorrect MySQL DDL Generation for integer types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pcl">Patrick Linskey</assignee>
                                    <reporter username="mikedd">Michael Dick</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Nov 2007 23:44:28 +0000</created>
                <updated>Thu, 30 Jul 2009 15:04:39 +0100</updated>
                            <resolved>Wed, 30 Jan 2008 06:30:46 +0000</resolved>
                                    <version>1.0.0</version>
                    <version>1.0.1</version>
                                    <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12546396" author="mikedd" created="Wed, 28 Nov 2007 21:00:39 +0000"  >&lt;p&gt;Attaching potential patch. I&apos;ll commit this when I&apos;ve had a chance to do a little more testing. &lt;/p&gt;</comment>
                            <comment id="12563570" author="joe weinstein" created="Tue, 29 Jan 2008 16:36:34 +0000"  >&lt;p&gt;Hi. I think I&apos;ve found a problem here. Oracle has a NUMBER&lt;br/&gt;
column type, which may be specified with sizes, eg:&lt;br/&gt;
NUMBER(7), or NUMBER(9,3), but may also be unsized,&lt;br/&gt;
eg: NUMBER. Since this fix, the new code is failing to&lt;br/&gt;
process the &quot;NUMBER&lt;/p&gt;
{0}&quot; template for non-sized&lt;br/&gt;
columns, so the DDL sent to the DBMS is like:&lt;br/&gt;
&lt;br/&gt;
CREATE TABLE ABSTRACTMAPPEDAPPIDSUPER ( ..., VERSN NUMBER{0}
&lt;p&gt;, ...&lt;/p&gt;

&lt;p&gt;which needless to say, dies.&lt;/p&gt;

&lt;p&gt;The change I made that fixed this is:&lt;/p&gt;

&lt;p&gt;    protected String insertSize(String typeName, String size) {&lt;br/&gt;
        if(StringUtils.isEmpty(size)) {&lt;/p&gt;

&lt;p&gt;          int idx = typeName.indexOf(&quot;&lt;/p&gt;
{0}&quot;);  // remove the size token if not needed...&lt;br/&gt;
          if (idx != -1) {
            return typeName.substring(0,idx);
          }&lt;br/&gt;
          return typeName;&lt;br/&gt;
        }&lt;br/&gt;
&lt;br/&gt;
        int idx = typeName.indexOf(&quot;{0}
&lt;p&gt;&quot;);&lt;br/&gt;
...&lt;/p&gt;



&lt;p&gt;ie:&lt;/p&gt;

&lt;p&gt;Index: openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java    (revision 61099&lt;br/&gt;
9)&lt;br/&gt;
+++ openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java    (working copy)&lt;br/&gt;
@@ -1648,8 +1648,13 @@&lt;br/&gt;
      */&lt;br/&gt;
     protected String insertSize(String typeName, String size) {&lt;br/&gt;
        if(StringUtils.isEmpty(size)) &lt;/p&gt;
{
-               return typeName;
-       }
&lt;p&gt;+&lt;br/&gt;
+          int idx = typeName.indexOf(&quot;&lt;/p&gt;
{0}&quot;);&lt;br/&gt;
+          if (idx != -1) {
+            return typeName.substring(0,idx);
+         }&lt;br/&gt;
+         return typeName;&lt;br/&gt;
+       }&lt;br/&gt;
&lt;br/&gt;
         int idx = typeName.indexOf(&quot;{0}
&lt;p&gt;&quot;);&lt;br/&gt;
         if (idx != -1) {&lt;/p&gt;

&lt;p&gt;Please let me know what you think, and how to absorb this&lt;br/&gt;
change, or it&apos;s purpose. thanks,&lt;br/&gt;
Joe Weinstein at BEA Systems&lt;/p&gt;</comment>
                            <comment id="12563851" author="pcl" created="Wed, 30 Jan 2008 06:30:46 +0000"  >&lt;p&gt;Re-resolving, since Joe opened a new issue for the problem he found.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12387408">OPENJPA-505</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12370450" name="OPENJPA-455.patch.txt" size="4768" author="mikedd" created="Wed, 28 Nov 2007 21:00:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 29 Jan 2008 16:36:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160776</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyswmv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202635</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>