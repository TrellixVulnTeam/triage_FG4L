<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:46:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1168/OPENJPA-1168.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1168] NPE in UUIDGenerator.initializeForType1()</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1168</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;When UUIDGenerator.createType1() is called by more than one thread at &lt;b&gt;nearly&lt;/b&gt; the same time AND UUIDGenerator.createType1() wasn&apos;t called previously, a small timing window exists where a NPE will result.&lt;/p&gt;

&lt;p&gt;Scenario:&lt;br/&gt;
Thread 1 calls UUIDGenerator.createType1() and RANDOM == null so initializeForType1() is called. While that thread is in initializeForType1(), it sets the static variable RANDOM so that value is no longer null. Now Thread 2 calls UUIDGenerator.createType1() and RANDOM is no longer null, so it proceeds to the call System.arraycopy(IP, 0, uuid, 10, IP.length);. At this point Thread 1 hasn&apos;t got to initializing IP yet, so Thread 2 gets hits a NPE.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12429866">OPENJPA-1168</key>
            <summary>NPE in UUIDGenerator.initializeForType1()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikedd">Michael Dick</assignee>
                                    <reporter username="curtisr7">Rick Curtis</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jul 2009 23:00:13 +0100</created>
                <updated>Tue, 9 Mar 2010 18:31:18 +0000</updated>
                            <resolved>Tue, 14 Jul 2009 18:57:45 +0100</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-M3</fixVersion>
                                    <component>lib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12728926" author="curtisr7" created="Wed, 8 Jul 2009 23:06:50 +0100"  >&lt;p&gt;The patch includes a test case and the fix for this issue. &lt;/p&gt;

&lt;p&gt;Since this bug is a timing window, running this test case against an un-patched tree may work from time to time. Please let me know if you want me to post some more information in the test case about why I did what I did.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Rick&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12728994" author="mikedd" created="Thu, 9 Jul 2009 02:29:16 +0100"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;I&apos;m unable to hit the timing window you mention on my system, but your explanation is sound. &lt;/p&gt;

&lt;p&gt;That said there&apos;s still a window where IP can be initialized (non null) but not copied. Another thread could hit this window when IP was empty and get a non-unique id. It&apos;s probably safer to set a different flag at the end of the method and key off that instead of IP or RANDOM.&lt;/p&gt;

&lt;p&gt;Thanks for the patch though - I doubt this was easy to find.  &lt;/p&gt;</comment>
                            <comment id="12729259" author="curtisr7" created="Thu, 9 Jul 2009 14:25:59 +0100"  >&lt;p&gt;Nice catch Mike. &lt;/p&gt;

&lt;p&gt;I updated the patch as recommended.&lt;/p&gt;</comment>
                            <comment id="12729304" author="curtisr7" created="Thu, 9 Jul 2009 16:49:58 +0100"  >&lt;p&gt;Fixed a problem in the test case that was introduced because of the previous patch.&lt;/p&gt;</comment>
                            <comment id="12729310" author="milosz" created="Thu, 9 Jul 2009 17:17:42 +0100"  >&lt;p&gt;This reminds me of a test case which sometimes fails for me while running against MySQL and which I did not have time to look at. Maybe this is connected although the test case is single-threaded. The stack trace I am receiving is:&lt;/p&gt;

&lt;p&gt;testDefaultValues(org.apache.openjpa.persistence.generationtype.TestGeneratedValues)  Time elapsed: 0.787 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
junit.framework.AssertionFailedError&lt;br/&gt;
        at junit.framework.Assert.fail(Assert.java:47)&lt;br/&gt;
        at junit.framework.Assert.assertTrue(Assert.java:20)&lt;br/&gt;
        at junit.framework.Assert.assertFalse(Assert.java:34)&lt;br/&gt;
        at junit.framework.Assert.assertFalse(Assert.java:41)&lt;br/&gt;
        at org.apache.openjpa.persistence.generationtype.TestGeneratedValues.testDefaultValues(TestGeneratedValues.java:49)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at junit.framework.TestCase.runTest(TestCase.java:154)&lt;br/&gt;
        at junit.framework.TestCase.runBare(TestCase.java:127)&lt;br/&gt;
        at org.apache.openjpa.persistence.test.PersistenceTestCase.runBare(PersistenceTestCase.java:466)&lt;br/&gt;
        at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
        at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
        at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
        at junit.framework.TestCase.run(TestCase.java:118)&lt;br/&gt;
        at org.apache.openjpa.persistence.test.PersistenceTestCase.run(PersistenceTestCase.java:181)&lt;br/&gt;
        at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
        at junit.framework.TestSuite.run(TestSuite.java:203)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.apache.maven.surefire.junit.JUnitTestSet.execute(JUnitTestSet.java:213)&lt;br/&gt;
        at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:140)&lt;br/&gt;
        at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:127)&lt;br/&gt;
        at org.apache.maven.surefire.Surefire.run(Surefire.java:177)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:345)&lt;br/&gt;
        at org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:1009)&lt;/p&gt;

&lt;p&gt;The TestGeneratedValues.java:49 contains:&lt;/p&gt;

&lt;p&gt;        assertFalse(gv.getUuidstring().equals(gv2.getUuidstring()));&lt;/p&gt;

&lt;p&gt;This means UUID generator sometimes generates duplicates.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12413032" name="OPENJPA-1168.patch" size="3722" author="curtisr7" created="Thu, 9 Jul 2009 16:49:58 +0100"/>
                            <attachment id="12413018" name="OPENJPA-1168.patch" size="3539" author="curtisr7" created="Thu, 9 Jul 2009 14:25:59 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 9 Jul 2009 01:29:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38625</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt2ov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203616</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>