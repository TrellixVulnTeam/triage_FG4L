<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:37:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1593/OPENJPA-1593.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1593] Create an OSGiManagedRuntime</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1593</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Follow-on to &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1524&quot; title=&quot;ManagedRuntime does not work for OSGi&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1524&quot;&gt;&lt;del&gt;OPENJPA-1524&lt;/del&gt;&lt;/a&gt; to create a generic OSGiManagedRuntime class that would work for vendors/frameworks other than Apache Aries.  &lt;/p&gt;

&lt;p&gt;Tim&apos;s original suggestion was - One implementation suggestion would be to use a ServiceTracker to keep track of the JTA services. This would allow for lazy lookup and also provide a notification if the service is unregistered. &lt;br/&gt;
This should then be possible to implement as a relatively simple subclass of RegistryManagedRuntime that overrides getTransactionManager(). I don&apos;t know if you have a nice mechanism to pass a BundleContext yet, but I don&apos;t think that should pose a significant problem.&lt;/p&gt;

&lt;p&gt;Now that we have a BundleUtils.java to require OSGi classes in our runtime, we should be able to lookup &quot;javax.transaction.TransactionSynchronizationRegistry&quot; from the ServiceRegistry to use, instead of relying on the current JNDI lookup which is Aries specific.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12459900">OPENJPA-1593</key>
            <summary>Create an OSGiManagedRuntime</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12456798">OPENJPA-1524</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikedd">Michael Dick</assignee>
                                    <reporter username="drwoods">Donald Woods</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Mar 2010 19:13:26 +0000</created>
                <updated>Wed, 13 Jul 2011 17:11:19 +0100</updated>
                            <resolved>Thu, 17 Feb 2011 04:28:07 +0000</resolved>
                                    <version>2.0.0-beta</version>
                                    <fixVersion>2.2.0</fixVersion>
                                    <component>osgi</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12978244" author="wolfgang.glas@ev-i.at" created="Thu, 6 Jan 2011 09:37:31 +0000"  >&lt;p&gt;The way to go here is to register a service listener for a javax.transaction.TransactionManager inside&lt;/p&gt;

&lt;p&gt;    org.apache.openjpa.persistence.osgi.PersistenceActivator.start(BundleContext)&lt;/p&gt;

&lt;p&gt;with a filter expression of&lt;/p&gt;

&lt;p&gt;  &quot;(objectClass=javax.transaction.TransactionManager)&quot;&lt;/p&gt;

&lt;p&gt;The best solution would be to let OSGiManagedRuntime implement OSGi&apos;s ServiceListener and openjpa&apos;s ManagedRuntime interfaces and maintain&lt;br/&gt;
a synchronized copy of the TransactionManager inside OSGiManagedRuntime.&lt;/p&gt;

&lt;p&gt;  And yes, I would really like to have this feature in openjpa-2.1.0 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;  Best regards,&lt;/p&gt;

&lt;p&gt;    Wolfgang&lt;/p&gt;</comment>
                            <comment id="12980961" author="wolfgang.glas@ev-i.at" created="Wed, 12 Jan 2011 22:04:15 +0000"  >&lt;p&gt;I&apos;ve attached patch, which adds an OSGiManagedRuntime. I&apos;ve carefully debugged this stuff an tracked all possible start/stop combinations of the transaction and the openjpa bundle carefully.&lt;/p&gt;

&lt;p&gt;Please review and possibly apply my patch, which has been generated for the 2.1.x branch.&lt;/p&gt;

&lt;p&gt;  Best regards, Wolfgang&lt;/p&gt;</comment>
                            <comment id="12981266" author="mikedd" created="Thu, 13 Jan 2011 14:32:38 +0000"  >&lt;p&gt;I took a quick look through the patch, and nothing major jumped out at me. &lt;/p&gt;

&lt;p&gt;My main concern is that the new managed runtime gets tested. Can you elaborate on what you&apos;ve done to exercise the new class? &lt;/p&gt;

&lt;p&gt;One other nit - I noticed a lot of one line if statements that don&apos;t have curly braces, could you add those in? &lt;/p&gt;</comment>
                            <comment id="12981529" author="wolfgang.glas@ev-i.at" created="Thu, 13 Jan 2011 22:46:42 +0000"  >&lt;p&gt;Michael,&lt;/p&gt;

&lt;p&gt;Thanks for reviewing my stuff, I&apos;ve attached a version with slight javadoc improvements and with curly braces add to all if-statements.&lt;/p&gt;

&lt;p&gt;I don&apos;t know how to test OSGi service discovery inside a JUnit test.&lt;/p&gt;

&lt;p&gt;What I&apos;ve done is to attach a remote debugger to my apache karaf an add breakpoints in side the ServiceListener and the bunde startup and shutdown code. I then started and stopped the openjpa bundle with the transaction bundle started or stopped. Then I started and stopped the transaction bundle while the openjpa bundle was up in order to verify that the cached transaction manager instance is reliably removed in all possible situations.&lt;/p&gt;

&lt;p&gt;Ideas for automating these test are very much welcome &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;   Best regards,  Wolfgang&lt;/p&gt;</comment>
                            <comment id="12981681" author="wolfgang.glas@ev-i.at" created="Fri, 14 Jan 2011 08:54:49 +0000"  >&lt;p&gt;Well, another cup of sleep brought to me the idea of testing the servicediscovery using a fake BundleContext implementation.&lt;/p&gt;

&lt;p&gt;Attached you will find the leatest an greatest version of my patch with a testcase and a cleanup of the code, which now calls BundelContext.ungetReference() as specified by the OSGi specs.&lt;/p&gt;

&lt;p&gt;  Best regards, Wolfgang&lt;/p&gt;</comment>
                            <comment id="12981745" author="wolfgang.glas@ev-i.at" created="Fri, 14 Jan 2011 13:01:48 +0000"  >&lt;p&gt;I&apos;ve just browsed through org.apache.openjpa.ee.AutomaticManagedRuntime and got the impression, that OSGiManageRuntime should be integrated in the service dicovery mode, if running under OSGi.&lt;/p&gt;

&lt;p&gt;Is there someone eligible for undertaking this task?&lt;/p&gt;</comment>
                            <comment id="12981792" author="mikedd" created="Fri, 14 Jan 2011 15:35:38 +0000"  >&lt;p&gt;I don&apos;t see a testcase in the attached patches, did it get missed when you ran svn add? &lt;/p&gt;

&lt;p&gt;Adding it to AutomaticManagedRuntime should probably wait for 2.2.0 - not sure we&apos;ll find any takers in the next couple of days that can take it on. If you have a unit test that manually specifies it we might be able to get that into 2.1.0 though..&lt;/p&gt;</comment>
                            <comment id="12981797" author="wolfgang.glas@ev-i.at" created="Fri, 14 Jan 2011 15:43:36 +0000"  >&lt;p&gt;OK, I&apos;ve forgot to &apos;svn add&apos; my testcase, so it was missed by &apos;svn diff&apos;.&lt;/p&gt;

&lt;p&gt;This new version should include everything you need &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;  Wolfgang&lt;/p&gt;</comment>
                            <comment id="12992131" author="mikedd" created="Tue, 8 Feb 2011 19:30:42 +0000"  >&lt;p&gt;Mailing list post jogged my memory to look at the patch, which looks good. &lt;/p&gt;

&lt;p&gt;The only question I have is with the service registration triggered in PersistenceActivator. It looks benign but it&apos;d be nice to know whether there&apos;s an effect when running with Aries before we commit. &lt;/p&gt;</comment>
                            <comment id="12995661" author="mikedd" created="Thu, 17 Feb 2011 04:28:07 +0000"  >&lt;p&gt;Fixed in r1068588. &lt;/p&gt;</comment>
                            <comment id="12995721" author="wolfgang.glas@ev-i.at" created="Thu, 17 Feb 2011 08:32:55 +0000"  >&lt;p&gt;Michael,&lt;/p&gt;

&lt;p&gt;  Thanks for applying the patch,&lt;/p&gt;

&lt;p&gt;    Best regards, Wolfgang&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12456798">OPENJPA-1524</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12468175" name="OPENJPA-1593-1.patch" size="8968" author="wolfgang.glas@ev-i.at" created="Wed, 12 Jan 2011 22:04:15 +0000"/>
                            <attachment id="12468303" name="OPENJPA-1593-2.patch" size="9015" author="wolfgang.glas@ev-i.at" created="Thu, 13 Jan 2011 22:46:42 +0000"/>
                            <attachment id="12468356" name="OPENJPA-1593-3.patch" size="9676" author="wolfgang.glas@ev-i.at" created="Fri, 14 Jan 2011 08:54:49 +0000"/>
                            <attachment id="12468378" name="OPENJPA-1593-4.patch" size="26947" author="wolfgang.glas@ev-i.at" created="Fri, 14 Jan 2011 15:43:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 6 Jan 2011 09:37:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>68172</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt6fb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204221</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>