<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:37:51 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1119/OPENJPA-1119.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1119] NPE in InstrumentationFactory</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1119</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;As reported in the dev forum &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; InstrumentationFactory.class.getProtectionDomain().getCodeSource() returns null, causing a NPE.&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.openjpa.enhance.InstrumentationFactory.getAgentJar(InstrumentationFactory.java:204)&lt;br/&gt;
        at org.apache.openjpa.enhance.InstrumentationFactory.access$200(InstrumentationFactory.java:47)&lt;br/&gt;
        at org.apache.openjpa.enhance.InstrumentationFactory$1.run(InstrumentationFactory.java:99)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at org.apache.openjpa.enhance.InstrumentationFactory.getInstrumentation(InstrumentationFactory.java:87)&lt;br/&gt;
        at org.apache.openjpa.enhance.PCEnhancerAgent.loadDynamicAgent(PCEnhancerAgent.java:95)&lt;br/&gt;
        at org.apache.openjpa.persistence.PersistenceProviderImpl.loadAgent(PersistenceProviderImpl.java:243)&lt;br/&gt;
        at org.apache.openjpa.persistence.PersistenceProviderImpl.createEntityManagerFactory(PersistenceProviderImpl.java:91)&lt;br/&gt;
        at org.apache.openjpa.persistence.PersistenceProviderImpl.createEntityManagerFactory(PersistenceProviderImpl.java:119)&lt;br/&gt;
        at org.apache.openjpa.persistence.PersistenceProviderImpl.createEntityManagerFactory(PersistenceProviderImpl.java:55)&lt;br/&gt;
        at javax.persistence.Persistence.createFactory(Persistence.java:172)&lt;br/&gt;
        ... 51 more&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://n2.nabble.com/Error-loading-agent-with-Openjpa2-td3024299.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://n2.nabble.com/Error-loading-agent-with-Openjpa2-td3024299.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12427147">OPENJPA-1119</key>
            <summary>NPE in InstrumentationFactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="curtisr7">Rick Curtis</assignee>
                                    <reporter username="curtisr7">Rick Curtis</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Jun 2009 21:03:19 +0100</created>
                <updated>Tue, 9 Mar 2010 18:31:16 +0000</updated>
                            <resolved>Mon, 22 Jun 2009 20:16:40 +0100</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0-M3</fixVersion>
                                    <component>kernel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <timeoriginalestimate seconds="0">0h</timeoriginalestimate>
                            <timeestimate seconds="0">0h</timeestimate>
                                        <comments>
                            <comment id="12716742" author="curtisr7" created="Fri, 5 Jun 2009 21:13:35 +0100"  >&lt;p&gt;Made code change to detect when the ProtectionDomain returns NULL for a code source.&lt;/p&gt;</comment>
                            <comment id="12718143" author="curtisr7" created="Wed, 10 Jun 2009 18:21:55 +0100"  >&lt;p&gt;Refactored code for a more &apos;complete&apos; fix. This new patch fixes the NPE, but also does some additional manifest validation. &lt;/p&gt;

&lt;p&gt;If it is determined that the InstrumentationFactory was loaded from a jar file, that jar file is opened up and the manifest is examined. If the InstrumentationFactory is defined as the Agent-Class, we will go ahead and use that as an argument to the attach api. If the InstrumentationFactory isn&apos;t defined as the Agent-Class, we will go off and create a temporary file. &lt;/p&gt;

&lt;p&gt;Currently the openjpa-all.xxxx.jar and openjpa-kernal.xx.jar files do not have the InstrumentationFactory defined as the Agent-Class and I will address that issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1117&quot; title=&quot;Missing AgentClass attribute in openjpa-all-xxx.jar manifest.mf&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1117&quot;&gt;&lt;del&gt;OPENJPA-1117&lt;/del&gt;&lt;/a&gt;. I can hypothesize that the InstrumentationFactory could be loaded from a jar that doesn&apos;t have the Agent-Class defined if a user were to repackage OpenJPA and not properly copy the manifest attributes over.&lt;/p&gt;

&lt;p&gt;While testing this patch I uncovered 33 new test failures when running on Sun 1.6. After looking closer at the failures, most of the tests are named TestUnenhancedxxxxx. After looking at the commit comment for &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-293&quot; title=&quot;OpenJPA should not require managed type enhancement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-293&quot;&gt;OPENJPA-293&lt;/a&gt;, it appears that it was known that these tests would fail when using redefinition. Now that it is possible to use redefinition, these tests are failing. Since it appears &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; that we are going to disable support for the redefinition(subclassing) I am going to exclude these failing tests from the build. Three other tests are also failing due to the dynamic enhancer, so I am excluding those tests also.&lt;/p&gt;

&lt;p&gt;I also updated the openjpa-persistence-jdbc/pom.xml and added -XX:MaxPermSize=256m to the test.jvm.arguments to take care of the Sun PermGen OOM problems that I run into when running on Sun 1.6. &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;http://n2.nabble.com/&lt;del&gt;VOTE&lt;/del&gt;-Turn-off-enhancement-by-subclassing-as-the-default-td1616140.html#a2950000&lt;/p&gt;</comment>
                            <comment id="12720356" author="mikedd" created="Tue, 16 Jun 2009 22:16:15 +0100"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;Before we commit the patch could we make the perm gen size configurable? 256m doesn&apos;t seem to be enough for 64 bit JVMs so it might make sense to user a variable in pom.xml; set the variable to a default value (if we can it&apos;d be neat to set it differently for 64 vs 32 bit jvms automagically), but let the build override it with  -Dtest.permgen.size=512m. &lt;/p&gt;

&lt;p&gt;Sorry I didn&apos;t try it on 64 bit JVMs until now. &lt;/p&gt;</comment>
                            <comment id="12720680" author="curtisr7" created="Wed, 17 Jun 2009 15:14:29 +0100"  >&lt;p&gt;Updated the patch so that the jvm arg -XX:MaxPermSize is configurable via -Dtest.permgen.size=xxxm. I also increased the default value to 512m rather than 256m.&lt;/p&gt;

&lt;p&gt;-Rick&lt;/p&gt;</comment>
                            <comment id="12720814" author="mikedd" created="Wed, 17 Jun 2009 19:32:23 +0100"  >&lt;p&gt;Thanks Rick. I haven&apos;t found a value that works on my 64 bit config with Sun JDK6 (tried up to 1024m which seems extreme). When I find a value that works I&apos;ll commit the patch. &lt;/p&gt;</comment>
                            <comment id="12721297" author="drwoods" created="Thu, 18 Jun 2009 16:09:16 +0100"  >&lt;p&gt;Michael, which OS are you seeing OOM for?&lt;/p&gt;

&lt;p&gt;I&apos;m running with the 64bit Sun JDK 1.6 on MacOSX -&lt;br/&gt;
java version &quot;1.6.0_13&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_13-b03-211)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 11.3-b02-83, mixed mode)&lt;/p&gt;

&lt;p&gt;with the following in o-p-j/pom.xml -&lt;br/&gt;
+        &amp;lt;test.jvm.maxpermsize&amp;gt;256m&amp;lt;/test.jvm.maxpermsize&amp;gt;    &lt;br/&gt;
+        &amp;lt;test.jvm.maxheapsize&amp;gt;512m&amp;lt;/test.jvm.maxheapsize&amp;gt; &lt;/p&gt;

&lt;p&gt;and MAVEN_OPTS=&quot;-Xmx1024m -XX:MaxPermSize=256m&quot;&lt;/p&gt;
</comment>
                            <comment id="12721324" author="mikedd" created="Thu, 18 Jun 2009 16:59:38 +0100"  >&lt;p&gt;It&apos;s not actually an OOM, it&apos;s a case of running out of perm gen space. I&apos;ve only see it happen with Linux + Sun JDK6.. Maybe I need to upgrade my JDK (and only with the patch applied). &lt;/p&gt;

&lt;p&gt;$java -version&lt;br/&gt;
java version &quot;1.6.0_13&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_13-b03)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 11.3-b02, mixed mode)&lt;/p&gt;</comment>
                            <comment id="12721891" author="drwoods" created="Fri, 19 Jun 2009 18:25:09 +0100"  >&lt;p&gt;Updated patch after &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1117&quot; title=&quot;Missing AgentClass attribute in openjpa-all-xxx.jar manifest.mf&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1117&quot;&gt;&lt;del&gt;OPENJPA-1117&lt;/del&gt;&lt;/a&gt; commit that works for me w/ Sun 64bit JDK 6 on MacOSX (if you exclude the criteria tests.)  Will try running on 64bit Linux before committing.&lt;/p&gt;</comment>
                            <comment id="12721901" author="drwoods" created="Fri, 19 Jun 2009 18:50:11 +0100"  >&lt;p&gt;Only seeing the OOM PermGen space on 64bit Sun JDK 6 on Linux (SLES 10 SP 2 on x86_64  in this case)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12411244" name="OPENJPA-1119-dwoods.patch" size="6407" author="drwoods" created="Fri, 19 Jun 2009 18:25:09 +0100"/>
                            <attachment id="12410936" name="OPENJPA-1119.PATCH" size="7514" author="curtisr7" created="Wed, 17 Jun 2009 15:14:29 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 Jun 2009 21:16:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38610</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt5en:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204056</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>