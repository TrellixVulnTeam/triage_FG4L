<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:33:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1494/OPENJPA-1494.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1494] Criteria query IN predicate generates incorrect SQL </title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1494</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Junit regression uncovered following problems:&lt;br/&gt;
1.a testcase error in TestTypesafeCriteria.testValues5() : this test is currently annotated @AllowFailure.&lt;br/&gt;
      the expected sql string is incorrect. &lt;br/&gt;
         String sql = &quot;SELECT t0.name, t2.id, t2.label FROM CR_ITEM t0 &quot;&lt;br/&gt;
            + &quot;INNER JOIN CR_ITEM_photos t1 ON t0.id = t1.ITEM_ID &quot;&lt;br/&gt;
            + &quot;INNER JOIN CR_PHT t2 ON t1.VALUE_ID = t2.id WHERE &quot;&lt;br/&gt;
            + &quot;(0 = (SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM CR_ITEM_photos t3 WHERE &quot;&lt;br/&gt;
            + &quot;(t3.VALUE_ID = ? OR t3.VALUE_ID = ? OR t3.VALUE_ID = ? OR t3.VALUE_ID = ? OR t3.VALUE_ID = ?) &quot;&lt;br/&gt;
            + &quot;AND (t0.id = t3.ITEM_ID) AND t0.id = t3.ITEM_ID) &quot;&lt;br/&gt;
            + &quot;AND 0 &amp;lt; (SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM CR_ITEM_photos WHERE CR_ITEM_photos.ITEM_ID = t0.id))&quot;;&lt;/p&gt;

&lt;p&gt;      in  the last SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, the FROM table does not have table alias assigned.&lt;br/&gt;
 2. NOT IN expression is transformed into a QueryExpression which resulting SQL subselects with SELECT COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &amp;#8211; there could be a problem in how query expression tree is built in Criteria Query for IN-Expression.&lt;/p&gt;

&lt;p&gt;3: ((CriteriaQueryImpl)q).toCQL() produces the following JPQL string which has syntax error.&lt;br/&gt;
     JPQL=SELECT i.name, i.photos FROM Item i INNER JOIN i.photos ? WHERE i.photos IN (&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.openjpa.persistence.criteria.Photo@22de22de, org.apache.openjpa.persistence.criteria.Photo@23122312, org.apache.openjpa.persistence.criteria.Photo@23462346, org.apache.openjpa.persistence.criteria.Photo@226e226e, org.apache.openjpa.persistence.criteria.Photo@22aa22aa&amp;#93;&lt;/span&gt;)&lt;/p&gt;

&lt;p&gt;if toCQL() produced  the following JPQL, then semantically they would be equavilence:&lt;br/&gt;
      SELECT i.name, p FROM Item i INNER JOIN i.photos p where p  NOT IN ?1&lt;/p&gt;

&lt;p&gt;      but JPQL BNF does not allow Object-value &apos;p&apos; in &lt;span class=&quot;error&quot;&gt;&amp;#91;NOT&amp;#93;&lt;/span&gt; IN conditional expression.&lt;/p&gt;

&lt;p&gt; 4. There is no JPQL equivalence query for the criteria query in  testValues5().&lt;br/&gt;
     a closer JPQL string could be:&lt;br/&gt;
       SELECT i.name, p FROM Item i INNER JOIN i.photos p where p.id NOT IN ?1&lt;br/&gt;
       where ?1 is a collection-valued-parameter that contains a list of Photo IDs.&lt;br/&gt;
     The above JPQL generates following SQL:&lt;br/&gt;
      8500  test  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Query - Executing query: &lt;span class=&quot;error&quot;&gt;&amp;#91;SELECT i.name, p FROM Item i INNER JOIN i.photos p WHERE p.id not IN ?1&amp;#93;&lt;/span&gt; with parameters: &lt;/p&gt;
{1=[0, 0, 0, 0, 0]}
&lt;p&gt;8750  test  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.jdbc.SQL - &amp;lt;t 108529272, conn 1628201228&amp;gt; executing prepstmnt 1532713819 SELECT t0.name, t2.id, t2.label FROM CR_ITEM t0 INNER JOIN CR_ITEM_photos t1 ON t0.id = t1.ITEM_ID INNER JOIN CR_PHT t2 ON t1.VALUE_ID = t2.id WHERE (NOT (t1.VALUE_ID IN (?, ?, ?, ?, ?)))  &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 0, (int) 0, (int) 0, (int) 0, (int) 0&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;   as shown in the above, a NOT IN JPQL generated a NOT IN SQL.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12455142">OPENJPA-1494</key>
            <summary>Criteria query IN predicate generates incorrect SQL </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="faywang">Fay Wang</assignee>
                                    <reporter username="fancy">Catalina Wei</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Feb 2010 06:17:15 +0000</created>
                <updated>Tue, 9 Mar 2010 18:29:26 +0000</updated>
                            <resolved>Fri, 5 Feb 2010 19:13:45 +0000</resolved>
                                    <version>2.0.0-beta</version>
                                    <fixVersion>2.0.0-beta2</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12830238" author="faywang" created="Fri, 5 Feb 2010 19:13:35 +0000"  >&lt;p&gt;The code fix is checked into JIRA-1493.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 5 Feb 2010 19:13:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161758</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysy5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202881</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>