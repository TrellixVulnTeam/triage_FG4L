<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:30:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-2440/OPENJPA-2440.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-2440] foreign key drop leaks jdbc connections</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-2440</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Hi some connections are not closed when dropping fk, here is a proposed patch:&lt;/p&gt;

&lt;p&gt;Index: openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaTool.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaTool.java	(revision 1531344)&lt;br/&gt;
+++ openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaTool.java	(working copy)&lt;br/&gt;
@@ -18,6 +18,23 @@&lt;br/&gt;
  */&lt;br/&gt;
 package org.apache.openjpa.jdbc.schema;&lt;/p&gt;

&lt;p&gt;+import org.apache.commons.lang.StringUtils;&lt;br/&gt;
+import org.apache.openjpa.conf.OpenJPAConfiguration;&lt;br/&gt;
+import org.apache.openjpa.jdbc.conf.JDBCConfiguration;&lt;br/&gt;
+import org.apache.openjpa.jdbc.conf.JDBCConfigurationImpl;&lt;br/&gt;
+import org.apache.openjpa.jdbc.identifier.DBIdentifier;&lt;br/&gt;
+import org.apache.openjpa.jdbc.sql.DBDictionary;&lt;br/&gt;
+import org.apache.openjpa.jdbc.sql.SQLExceptions;&lt;br/&gt;
+import org.apache.openjpa.lib.conf.Configurations;&lt;br/&gt;
+import org.apache.openjpa.lib.jdbc.DelegatingDataSource;&lt;br/&gt;
+import org.apache.openjpa.lib.log.Log;&lt;br/&gt;
+import org.apache.openjpa.lib.meta.MetaDataSerializer;&lt;br/&gt;
+import org.apache.openjpa.lib.util.Files;&lt;br/&gt;
+import org.apache.openjpa.lib.util.Localizer;&lt;br/&gt;
+import org.apache.openjpa.lib.util.Options;&lt;br/&gt;
+import org.apache.openjpa.util.InvalidStateException;&lt;br/&gt;
+&lt;br/&gt;
+import javax.sql.DataSource;&lt;br/&gt;
 import java.io.File;&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
 import java.io.PrintWriter;&lt;br/&gt;
@@ -33,24 +50,7 @@&lt;br/&gt;
 import java.util.LinkedHashSet;&lt;br/&gt;
 import java.util.LinkedList;&lt;br/&gt;
 import java.util.Set;&lt;br/&gt;
-import javax.sql.DataSource;&lt;/p&gt;

&lt;p&gt;-import org.apache.commons.lang.StringUtils;&lt;br/&gt;
-import org.apache.openjpa.conf.OpenJPAConfiguration;&lt;br/&gt;
-import org.apache.openjpa.jdbc.conf.JDBCConfiguration;&lt;br/&gt;
-import org.apache.openjpa.jdbc.conf.JDBCConfigurationImpl;&lt;br/&gt;
-import org.apache.openjpa.jdbc.identifier.DBIdentifier;&lt;br/&gt;
-import org.apache.openjpa.jdbc.sql.DBDictionary;&lt;br/&gt;
-import org.apache.openjpa.jdbc.sql.SQLExceptions;&lt;br/&gt;
-import org.apache.openjpa.lib.conf.Configurations;&lt;br/&gt;
-import org.apache.openjpa.lib.jdbc.DelegatingDataSource;&lt;br/&gt;
-import org.apache.openjpa.lib.log.Log;&lt;br/&gt;
-import org.apache.openjpa.lib.meta.MetaDataSerializer;&lt;br/&gt;
-import org.apache.openjpa.lib.util.Files;&lt;br/&gt;
-import org.apache.openjpa.lib.util.Localizer;&lt;br/&gt;
-import org.apache.openjpa.lib.util.Options;&lt;br/&gt;
-import org.apache.openjpa.util.InvalidStateException;&lt;br/&gt;
-&lt;br/&gt;
 /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The SchemaTool is used to manage the database schema. Note that the&lt;/li&gt;
	&lt;li&gt;tool never adds or drops unique constraints from existing tables, because&lt;br/&gt;
@@ -1099,7 +1099,12 @@&lt;br/&gt;
      */&lt;br/&gt;
     public boolean dropForeignKey(ForeignKey fk)&lt;br/&gt;
         throws SQLException {&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return executeSQL(_dict.getDropForeignKeySQL(fk,_ds.getConnection()));&lt;br/&gt;
+        final Connection connection = _ds.getConnection();&lt;br/&gt;
+        try 
{
+            return executeSQL(_dict.getDropForeignKeySQL(fk, connection));
+        }
&lt;p&gt; finally &lt;/p&gt;
{
+            connection.close();
+        }
&lt;p&gt;     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     /**&lt;/p&gt;</description>
                <environment></environment>
        <key id="12674126">OPENJPA-2440</key>
            <summary>foreign key drop leaks jdbc connections</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="struberg">Mark Struberg</assignee>
                                    <reporter username="romain.manni-bucau">Romain Manni-Bucau</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Oct 2013 14:53:08 +0100</created>
                <updated>Fri, 18 Oct 2013 22:28:58 +0100</updated>
                            <resolved>Fri, 18 Oct 2013 22:28:43 +0100</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13799300" author="struberg" created="Fri, 18 Oct 2013 18:04:00 +0100"  >&lt;p&gt;Actually I&apos;ve found that our SchemaTool source is full with NOT freeing up our connections properly it seems.&lt;/p&gt;</comment>
                            <comment id="13799338" author="struberg" created="Fri, 18 Oct 2013 18:50:01 +0100"  >&lt;p&gt;patch against 2.3.x. Please review! Like to commit this tonight...&lt;/p&gt;</comment>
                            <comment id="13799532" author="jira-bot" created="Fri, 18 Oct 2013 22:25:57 +0100"  >&lt;p&gt;Commit 1533640 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=struberg&quot; class=&quot;user-hover&quot; rel=&quot;struberg&quot;&gt;Mark Struberg&lt;/a&gt; in branch &apos;openjpa/branches/2.3.x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1533640&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1533640&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2440&quot; title=&quot;foreign key drop leaks jdbc connections&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2440&quot;&gt;&lt;del&gt;OPENJPA-2440&lt;/del&gt;&lt;/a&gt; close connection after not using it anymore&lt;/p&gt;

&lt;p&gt;this prevents leaks like the one reported by rmannibucau.&lt;/p&gt;</comment>
                            <comment id="13799534" author="struberg" created="Fri, 18 Oct 2013 22:28:43 +0100"  >&lt;p&gt;Thanks for the report, Romain!&lt;/p&gt;

&lt;p&gt;I also fixed the other similar situations. Applied to 2.3.x and trunk&lt;/p&gt;</comment>
                            <comment id="13799535" author="jira-bot" created="Fri, 18 Oct 2013 22:28:58 +0100"  >&lt;p&gt;Commit 1533641 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=struberg&quot; class=&quot;user-hover&quot; rel=&quot;struberg&quot;&gt;Mark Struberg&lt;/a&gt; in branch &apos;openjpa/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1533641&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1533641&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2440&quot; title=&quot;foreign key drop leaks jdbc connections&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2440&quot;&gt;&lt;del&gt;OPENJPA-2440&lt;/del&gt;&lt;/a&gt; close connection after not using it anymore&lt;/p&gt;

&lt;p&gt;this prevents leaks like the one reported by rmannibucau.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12609176" name="OPENJPA-2440.patch" size="2353" author="struberg" created="Fri, 18 Oct 2013 18:50:01 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Oct 2013 17:04:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353749</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hziu0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354041</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>