<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:35:58 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-2141/OPENJPA-2141.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-2141] Lazy fetch of embedded attributes does not work properly</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-2141</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;OpenJPA&apos;s @Persistent annotation and configuration via OpenJPA&apos;s xml extensions provide a mechanism to mark embedded fields lazy.  When trying to use this facility I found a couple bugs.&lt;br/&gt;
Bug 1: The xml extension does not process the fetch attribute, so the field is never marked lazy.&lt;br/&gt;
Bug 2: If marked lazy via the annotation or xml (with a fix) the lazy field does not get loaded along with the entity (as expected), but then will not load when accessed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12543987">OPENJPA-2141</key>
            <summary>Lazy fetch of embedded attributes does not work properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="techhusky">Jeremy Bauer</assignee>
                                    <reporter username="techhusky">Jeremy Bauer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Feb 2012 13:23:49 +0000</created>
                <updated>Thu, 26 Apr 2012 18:02:02 +0100</updated>
                                            <version>2.2.1</version>
                    <version>2.3.0</version>
                                                    <component>jdbc</component>
                        <due>Fri, 24 Feb 2012 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13215606" author="jpyeron" created="Fri, 24 Feb 2012 13:44:12 +0000"  >&lt;p&gt;Do you think you could attach an example that I can use for testing?&lt;br/&gt;
Do you have the patch for the xml &quot;fix&quot;?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13215608" author="techhusky" created="Fri, 24 Feb 2012 13:54:25 +0000"  >&lt;p&gt;Fix and test committed to trunk (2.3.0) under rev 1293250.&lt;/p&gt;</comment>
                            <comment id="13215651" author="techhusky" created="Fri, 24 Feb 2012 14:52:07 +0000"  >&lt;p&gt;Note: the fix I committed does not yet handle the &quot;embedded&quot; attribute via XML.  The field still needs to be annotated or tagged embeddable in xml.  There&apos;s a bit more code and testing to handle this attribute.  I plan to work on that item in the future.  &lt;/p&gt;</comment>
                            <comment id="13262681" author="struberg" created="Thu, 26 Apr 2012 16:43:07 +0100"  >&lt;p&gt;Actually I found a bug which could be related to this.&lt;/p&gt;

&lt;p&gt;I have an Entity (Course) with a simple @Embedded field and a @Lob. I do not use any LAZY attribution on them! &lt;/p&gt;


&lt;p&gt;If I do a normal em.find, the entity will be loaded as a whole (all the fields, including the embedded and the lob will be fetched immediately). &lt;br/&gt;
Sidenote: the Lecturer referred in the select is defined as&lt;br/&gt;
    @OneToMany(mappedBy = &quot;course&quot;,&lt;br/&gt;
            cascade = &lt;/p&gt;
{CascadeType.PERSIST, CascadeType.REMOVE, CascadeType.MERGE}
&lt;p&gt;,&lt;br/&gt;
            orphanRemoval = true, fetch = FetchType.EAGER)&lt;br/&gt;
    @OrderColumn(name = &quot;POSITION&quot;)&lt;br/&gt;
    private List&amp;lt;Lecturer&amp;gt; lecturers;&lt;/p&gt;

&lt;p&gt;The following selects DO work  &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&quot;select c from Course c join c.lecturers l &quot;&lt;/li&gt;
	&lt;li&gt;&quot;select distinct c from Course c&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The following selects create tons of subqueries! 1 separate sub-query for each @Embedded field, and also for each @Lob&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&quot;select distinct c from Course c join  c.lecturers l &quot;&lt;/li&gt;
	&lt;li&gt;&quot;select distinct c from Lecturer l join l.course c&quot;&lt;/li&gt;
	&lt;li&gt;&quot;select c from Lecturer l join l.course c&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Should I create a separate issue or do you think it&apos;s related?&lt;/p&gt;</comment>
                            <comment id="13262728" author="techhusky" created="Thu, 26 Apr 2012 17:48:17 +0100"  >&lt;p&gt;Mark - given that none of your fields are marked lazy, I&apos;d guess what you&apos;ve described is a separate issue.  It looks like our logic to determine whether a lob can be fetched inline may need to be reviewed for certain queries.  Each DB vendor also has various levels of support for inlining so what you see could be DB specific as well.  Unless the fields in the embeddable are tagged as lazy, I&apos;m not sure why we&apos;d need to fetch them separately.  That sounds like a bug.&lt;/p&gt;

&lt;p&gt;Any chance you can provide a testcase?  I could at least verify what I&apos;ve added for this JIRA hasn&apos;t broken anything.&lt;/p&gt;</comment>
                            <comment id="13262737" author="struberg" created="Thu, 26 Apr 2012 17:54:28 +0100"  >&lt;p&gt;txs, I&apos;ll create a new issue.&lt;/p&gt;</comment>
                            <comment id="13262746" author="struberg" created="Thu, 26 Apr 2012 18:02:02 +0100"  >&lt;p&gt;I&apos;ve now created &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2179&quot; title=&quot;&amp;#39;distinct&amp;#39; and &amp;#39;join&amp;#39; combinations lead lots of unneccessary sub-queries for @Embedded and @Lob fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2179&quot;&gt;OPENJPA-2179&lt;/a&gt; for this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 24 Feb 2012 13:44:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>229225</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7pzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>289180</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>