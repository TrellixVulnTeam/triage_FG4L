<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:41:24 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1097/OPENJPA-1097.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1097] Detachment processing of our proxied mutable types (Date, Timestamp, etc) needs to be consistent</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1097</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Per the discussion on our forums &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, there seems to some consistent issues with how we perform detachment processing of the mutable types such as Date, Timestamp, etc.  There seems to be a couple of issues (at least)...&lt;/p&gt;

&lt;p&gt;o  Detachment processing is not consistent between the detach() method and the clear() method.&lt;br/&gt;
o  Tracking of changes on a detached entity, but still allow it to be serialized without requiring the openjpa jar file.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;  &lt;a href=&quot;http://n2.nabble.com/Date-Problem-td2943310.html#a2943310&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://n2.nabble.com/Date-Problem-td2943310.html#a2943310&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12426020">OPENJPA-1097</key>
            <summary>Detachment processing of our proxied mutable types (Date, Timestamp, etc) needs to be consistent</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="drwoods">Donald Woods</assignee>
                                    <reporter username="kwsutter">Kevin Sutter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 May 2009 14:45:28 +0100</created>
                <updated>Mon, 5 Apr 2010 16:45:42 +0100</updated>
                            <resolved>Mon, 22 Mar 2010 19:04:02 +0000</resolved>
                                    <version>1.2.2</version>
                    <version>1.3.0</version>
                    <version>2.0.0-M1</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-beta3</fixVersion>
                                    <component>jpa</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12841490" author="drwoods" created="Thu, 4 Mar 2010 20:17:19 +0000"  >&lt;p&gt;some tests showing how detach() and clear() do not unproxy the entities - &lt;/p&gt;

&lt;p&gt;160  test  INFO   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Tests - e20.sqlDate = org.apache.openjpa.util.java$sql$Date$proxy&lt;br/&gt;
160  test  INFO   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Tests - e20.sqlTime = org.apache.openjpa.util.java$sql$Time$proxy&lt;br/&gt;
160  test  INFO   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Tests - e20.sqlTimestamp = org.apache.openjpa.util.java$sql$Timestamp$proxy&lt;/p&gt;

&lt;p&gt;but detachCopy() does -&lt;/p&gt;

&lt;p&gt;161  test  INFO   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Tests - after detach e20copy&lt;br/&gt;
161  test  INFO   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Tests - e20.sqlDate = java.sql.Date&lt;br/&gt;
161  test  INFO   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Tests - e20.sqlTime = java.sql.Time&lt;br/&gt;
161  test  INFO   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; Tests - e20.sqlTimestamp = java.sql.Timestamp&lt;/p&gt;</comment>
                            <comment id="12841546" author="drwoods" created="Thu, 4 Mar 2010 21:47:24 +0000"  >&lt;p&gt;968 contains some important details, like the change in method signature/behavior of detach() in 2.0 (as required in the JPA 2.0 Spec) vs what was shipping in OpenJPA 1.x (value-add and not Spec defined.)&lt;br/&gt;
We do have some questionable behavior when detachAll() or clear() are called, in that in DetachManager.java the _copy is forced to false when _full is being set.&lt;br/&gt;
Also, calling detach(Entity) and then detachCopy(Entity) does not return an unproxied Entity as expected (if detachCopy is called first it works), but the same in-place entity from the earlier detach() call, as it was located in the _detached Map.&lt;/p&gt;</comment>
                            <comment id="12841880" author="curtisr7" created="Fri, 5 Mar 2010 14:38:48 +0000"  >&lt;p&gt;Sorry I didn&apos;t have much time this morning to look through the entire UT, but I think this should fix the problem. &lt;/p&gt;</comment>
                            <comment id="12842034" author="drwoods" created="Fri, 5 Mar 2010 21:41:43 +0000"  >&lt;p&gt;New tests and DetachManager updates from Rick Curtis back ported to 1.3.x.&lt;/p&gt;</comment>
                            <comment id="12842038" author="drwoods" created="Fri, 5 Mar 2010 21:54:56 +0000"  >&lt;p&gt;Minor patch updates for 13x.&lt;/p&gt;</comment>
                            <comment id="12842059" author="drwoods" created="Fri, 5 Mar 2010 22:13:05 +0000"  >&lt;p&gt;Updated patch that includes fixes for some failing proxy tests.&lt;/p&gt;</comment>
                            <comment id="12842074" author="drwoods" created="Fri, 5 Mar 2010 22:44:14 +0000"  >&lt;p&gt;Latest patch for trunk based on DetachManager changes from Rick Curtis.&lt;/p&gt;</comment>
                            <comment id="12842168" author="drwoods" created="Sat, 6 Mar 2010 03:24:44 +0000"  >&lt;p&gt;Updated trunk patch&lt;/p&gt;</comment>
                            <comment id="12842178" author="drwoods" created="Sat, 6 Mar 2010 04:10:47 +0000"  >&lt;p&gt;Initial patch for 1.2.x to fix clear() not unproxying JavaTypes.OBJECT fields.&lt;/p&gt;</comment>
                            <comment id="12842251" author="drwoods" created="Sat, 6 Mar 2010 12:38:29 +0000"  >&lt;p&gt;Patch for 1.2.x which includes the new junits.&lt;/p&gt;</comment>
                            <comment id="12842669" author="drwoods" created="Mon, 8 Mar 2010 14:16:36 +0000"  >&lt;p&gt;1.3.x - the 1.0b TCK passed with the integrated patches&lt;br/&gt;
trunk - the 1.0b and 2.0 TCK passed with the integrated patches&lt;/p&gt;

&lt;p&gt;Will leave it to Mike to determine if the 1.2.x patch should be applied to the 1.2.3 release.&lt;/p&gt;</comment>
                            <comment id="12842679" author="drwoods" created="Mon, 8 Mar 2010 14:44:07 +0000"  >&lt;p&gt;Basically, the patch fixed the clear() behavior, in that JavaType.OBJECT fields were not being unproxied and added junits to verify the following behavior by using an Entity20 class that contains the following fields -&lt;br/&gt;
    @Temporal(TemporalType.DATE) java.sql.Date&lt;br/&gt;
    @Temporal(TemporalType.TIME) java.sql.Time&lt;br/&gt;
    @Temporal(TemporalType.TIMESTAMP) java.sql.Timestamp&lt;/p&gt;

&lt;p&gt;For trunk (when using the 2.0 default compatibility settings and the new JPA 2.0 Spec required in-place detach and no return values, which differs from the OpenJPA 1.x value-added detach()/detachAll() methods):&lt;br/&gt;
1) find() - entity uses the proxied classes before and after serialization&lt;br/&gt;
2) after in-place detach() - entity does NOT use proxied classes before or after serialization&lt;br/&gt;
3) after in-place detachAll() - none of the entities use proxied classes before or after serialization&lt;br/&gt;
4) detachCopy() - returns an entity that does NOT use proxied classes before or after serialization&lt;br/&gt;
5) clear() - existing entity instances after EM.clear() do NOT use proxied classes before or after serialization&lt;/p&gt;

&lt;p&gt;For 1.3.x (same for proposed 1.2.x changes):&lt;br/&gt;
1) find() - entity uses the proxied classes before and after serialization&lt;br/&gt;
2) detach() returns a copy of the original entity that does NOT use proxied classes before or after serialization, but the original entity instance still uses proxies and returns FALSE for isDetached()&lt;br/&gt;
3) detachAll() returns copies of the original entities that do NOT use proxied classes before or after serialization, but the original entity instances still use proxies and returns FALSE for isDetached()&lt;br/&gt;
4) there is no tests for detachCopy() as this was added in 2.0.0 because JPA 2.0 Spec required in-place detach() and no return value&lt;br/&gt;
5) clear() - existing entity instances after EM.clear() do NOT use proxied classes before or after serialization&lt;/p&gt;</comment>
                            <comment id="12845499" author="drwoods" created="Mon, 15 Mar 2010 20:21:09 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1571&quot; title=&quot;The change in the element collection is not persisted to the database during merging a detached entity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1571&quot;&gt;&lt;del&gt;OPENJPA-1571&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12845975" author="drwoods" created="Tue, 16 Mar 2010 16:25:18 +0000"  >&lt;p&gt;Updated patch that reverts some earlier DetachManager changes that broke the TestProxyCollection junits and updates the Proxies class to always remove $proxy classes on serialization if the entity is detachable.&lt;/p&gt;</comment>
                            <comment id="12846137" author="drwoods" created="Tue, 16 Mar 2010 21:39:46 +0000"  >&lt;p&gt;Tests showing how detach()/detachAll()/clear() are currently working in 1.2.x, where entities serialized after calling clear() still contain our OpenJPA $proxy class wrappers.&lt;/p&gt;</comment>
                            <comment id="12846593" author="drwoods" created="Wed, 17 Mar 2010 21:15:11 +0000"  >&lt;p&gt;Variation on previous patch, which I&apos;m not planning on committing, but for historical purposes:&lt;br/&gt;
1) when an entity is serialized after a find() but before a detach()/detachAll()/detachCopy()/clear(), then it will always contain the $proxy wrapper classes&lt;br/&gt;
2) after detach/detachAll/detachCopy/clear, the $proxy classes will be removed at serialization&lt;/p&gt;</comment>
                            <comment id="12847569" author="drwoods" created="Fri, 19 Mar 2010 20:45:48 +0000"  >&lt;p&gt;Long saga of this code change....  Capturing a version of the fully commented/debug code here in case we have to revisit this....  Not to commit as-is, but for historical purposes.&lt;/p&gt;</comment>
                            <comment id="12848144" author="drwoods" created="Mon, 22 Mar 2010 14:21:46 +0000"  >&lt;p&gt;Mike, the &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1097&quot; title=&quot;Detachment processing of our proxied mutable types (Date, Timestamp, etc) needs to be consistent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1097&quot;&gt;&lt;del&gt;OPENJPA-1097&lt;/del&gt;&lt;/a&gt;-12x-code.patch is for 1.2.3, which backports the code changes from 1.3.x/trunk and updates the TestDetachNoProxy.testClear() to verify that there is no $proxy usage after EM.clear() and the entity is serialized.&lt;/p&gt;</comment>
                            <comment id="12848287" author="drwoods" created="Mon, 22 Mar 2010 19:04:02 +0000"  >&lt;p&gt;Updated code and docs in 1.3.x and 2.0.0.&lt;br/&gt;
Attached patch for 1.2.3 if we ever want to include it there.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12460114">OPENJPA-1597</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12459108">OPENJPA-1571</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12416434">OPENJPA-968</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12438974" name="OPENJPA-1097-12x-tests.diff" size="29715" author="drwoods" created="Tue, 16 Mar 2010 21:39:46 +0000"/>
                            <attachment id="12437923" name="OPENJPA-1097-tests.diff" size="10905" author="drwoods" created="Thu, 4 Mar 2010 20:17:17 +0000"/>
                            <attachment id="12438076" name="OPENJPA-1097-trunk.diff" size="18712" author="drwoods" created="Sat, 6 Mar 2010 03:24:44 +0000"/>
                            <attachment id="12438933" name="OPENJPA-1097.1-trunk.patch" size="11135" author="drwoods" created="Tue, 16 Mar 2010 16:25:18 +0000"/>
                            <attachment id="12439081" name="OPENJPA-1097.2-trunk.patch" size="3945" author="drwoods" created="Wed, 17 Mar 2010 21:15:11 +0000"/>
                            <attachment id="12438014" name="OPENJPA-1097.patch" size="3127" author="curtisr7" created="Fri, 5 Mar 2010 14:38:48 +0000"/>
                            <attachment id="12439327" name="Proxies.java" size="7379" author="drwoods" created="Fri, 19 Mar 2010 20:45:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 4 Mar 2010 20:17:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161385</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt4ef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203893</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>