<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:37:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-918/OPENJPA-918.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-918] Stored procedures not handling returns properly</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-918</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Stored procedures with output parameters are not being handled properly.  Patch will be attached shortly with test cases.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12414495">OPENJPA-918</key>
            <summary>Stored procedures not handling returns properly</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bjreed">B.J. Reed</assignee>
                                    <reporter username="bjreed">B.J. Reed</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Feb 2009 15:20:56 +0000</created>
                <updated>Tue, 9 Mar 2010 18:31:09 +0000</updated>
                            <resolved>Thu, 17 Sep 2009 20:07:54 +0100</resolved>
                                    <version>2.0.0-M2</version>
                                    <fixVersion>2.0.0-M3</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12674034" author="bjreed" created="Mon, 16 Feb 2009 18:55:04 +0000"  >&lt;p&gt;After futher testing...&lt;/p&gt;

&lt;p&gt;It appears that procedures that return no data work properly when called by:&lt;/p&gt;

&lt;p&gt;Query query = em.createNativeQuery(sql);&lt;br/&gt;
query.executeUpdate();&lt;/p&gt;

&lt;p&gt;Procedures that return one ResultSet of data also seem to work properly when the kind of object is defined when creating the Query.&lt;/p&gt;

&lt;p&gt;Query query = em.createNativeQuery(sql, Applicant.class);&lt;br/&gt;
List&amp;lt;Applicant&amp;gt; appList = query.getResultList();&lt;/p&gt;

&lt;p&gt;(query.getSingleResult() works similar to getResultList())&lt;/p&gt;

&lt;p&gt;However, stored procedures also have the ability to return multiple types of objects in separate ResultSet of data.  When trying to get a ResultList(), I use &lt;/p&gt;

&lt;p&gt;Query query = em.createNativeQuery(sql);&lt;br/&gt;
List&amp;lt;Applicant&amp;gt; appList = query.getResultList();&lt;/p&gt;

&lt;p&gt;and get:&lt;/p&gt;

&lt;p&gt;Statement.executeQuery() cannot be called with a statement that returns a row count.  Odd message since a row count is not being returned, but multiple ResultSets&lt;/p&gt;
</comment>
                            <comment id="12674069" author="clr" created="Mon, 16 Feb 2009 21:25:29 +0000"  >&lt;p&gt;&amp;gt; However, stored procedures also have the ability to return multiple types of objects in separate ResultSet of data. &lt;/p&gt;

&lt;p&gt;This use case is not covered by the specification. The only cases covered are getResultList() and getSingleResult() that expect the query to return a ResultSet, and executeUpdate(), that expects an int returned from the query. &lt;/p&gt;

&lt;p&gt;So, getResultList() and getSingleResult() are mapped to a Statement.executeQuery(), and executeUpdate() is mapped to executeUpdate().&lt;/p&gt;

&lt;p&gt;&amp;gt; When trying to get a ResultList(), I use &lt;/p&gt;

&lt;p&gt;&amp;gt; Query query = em.createNativeQuery(sql); &lt;br/&gt;
&amp;gt; List&amp;lt;Applicant&amp;gt; appList = query.getResultList(); &lt;/p&gt;

&lt;p&gt;&amp;gt; and get: &lt;/p&gt;

&lt;p&gt;&amp;gt; Statement.executeQuery() cannot be called with a statement that returns a row count. Odd message since a row count is not being returned, but multiple ResultSets &lt;/p&gt;

&lt;p&gt;Considering that the error description for Statement.executeQuery() says &quot;if a database access error occurs; this method is called on a closed PreparedStatement or the SQL statement does not return a ResultSet object&quot;, the error message might better read &quot;Statement.executeQuery() cannot be called with a statement that does not return a ResultSet object&quot;. &lt;/p&gt;

&lt;p&gt;But in any case, I don&apos;t see how to handle a native query that returns multiple result sets without changing the specification to deal with it.&lt;/p&gt;

</comment>
                            <comment id="12674218" author="bjreed" created="Tue, 17 Feb 2009 14:08:09 +0000"  >&lt;p&gt;Thanks Craig for the info.  I&apos;ll remove the last two test cases and add other DB support and resubmit the patch to have better test case coverage.&lt;/p&gt;</comment>
                            <comment id="12676392" author="bjreed" created="Tue, 24 Feb 2009 19:58:08 +0000"  >&lt;p&gt;I&apos;ve narrowed the problem down a little further.  Not sure if this is something that OpenJPA is supposed to (or planning on) support or not...&lt;/p&gt;

&lt;p&gt;I have attached TestOracleRefCursor.java as TORC.patch&lt;/p&gt;

&lt;p&gt;The Oracle function is a function that returns a SYS_REFCURSOR&lt;/p&gt;

&lt;p&gt;create or replace function selectAllApplicants  &lt;br/&gt;
return SYS_REFCURSOR  &lt;br/&gt;
as  &lt;br/&gt;
cuApplicants SYS_REFCURSOR;  &lt;br/&gt;
begin  &lt;br/&gt;
open cuApplicants for  &lt;br/&gt;
select id, name from applicant;  &lt;br/&gt;
return cuApplicants;  &lt;br/&gt;
end selectAllApplicants;  &lt;br/&gt;
/ &lt;/p&gt;

&lt;p&gt;When I get the ResultList from the NativeQuery, I get an exception:&lt;br/&gt;
Missing IN or OUT parameter at index:: 1 {callstmnt 32580443 { ? = call selectAllApplicants() }} &lt;span class=&quot;error&quot;&gt;&amp;#91;code=17041, state=null&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;When I try the NativeQuery without the ? = , I get an exception that the procedure doesn&apos;t exist.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12400292" name="OPENJPA-918-test.patch" size="33413" author="bjreed" created="Mon, 16 Feb 2009 18:55:04 +0000"/>
                            <attachment id="12400878" name="TORC.patch" size="4498" author="bjreed" created="Tue, 24 Feb 2009 19:58:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 16 Feb 2009 21:25:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33630</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyst3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202064</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>