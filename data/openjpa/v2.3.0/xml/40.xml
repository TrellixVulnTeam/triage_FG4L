<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:46:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-40/OPENJPA-40.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-40] Testing OpenJPA and Spring integration fails</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-40</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;I have attached a test case including jar files and a build script.  src/repository-config.xml contains the Spring configuration and switching to the TopLink vendor adapter does not show any issues - the test runs fine.  Using the current OpenJPA vendor adapter (Spring sandbox source is included in src directory) causes this failure:&lt;/p&gt;

&lt;p&gt;First the version info:&lt;/p&gt;

&lt;p&gt;samoa:~/Projects/testOpenJpa trisberg$ ant openjpa-version&lt;br/&gt;
Buildfile: build.xml&lt;/p&gt;

&lt;p&gt;openjpa-version:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; OpenJPA 0.9.0-incubating-SNAPSHOT&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; version id: 0.9.0-incubating-SNAPSHOT-r0&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; revision: 0&lt;/p&gt;

&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; os.name: Mac OS X&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; os.version: 10.4.7&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; os.arch: ppc&lt;/p&gt;

&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; java.version: 1.5.0_06&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; java.vendor: Apple Computer, Inc.&lt;/p&gt;

&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; java.class.path:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/commons-collections-3.2.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/commons-lang-2.1.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/commons-logging-1.0.4.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/commons-pool-1.3.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/geronimo-j2ee-connector_1.5_spec-1.0.1.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/geronimo-jta_1.0.1B_spec-1.0.1.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/hsqldb.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/openjpa-jdbc-0.9.0-incubating-SNAPSHOT.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/openjpa-jdbc-5-0.9.0-incubating-SNAPSHOT.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/openjpa-kernel-0.9.0-incubating-SNAPSHOT.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/openjpa-kernel-5-0.9.0-incubating-SNAPSHOT.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/openjpa-lib-0.9.0-incubating-SNAPSHOT.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/openjpa-persistence-0.9.0-incubating-SNAPSHOT.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/openjpa-persistence-jdbc-0.9.0-incubating-SNAPSHOT.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/openjpa-xmlstore-0.9.0-incubating-SNAPSHOT.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/persistence-api-1.0.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/serp-1.11.0.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/spring-jpa.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/spring-sandbox.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/spring.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/lib/toplink-essentials.jar&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /Users/trisberg/Projects/testOpenJpa/classes&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     /System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Classes/.compatibility/14compatibility.jar&lt;/p&gt;

&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; user.dir: /Users/trisberg/Projects/testOpenJpa&lt;/p&gt;

&lt;p&gt;BUILD SUCCESSFUL&lt;br/&gt;
Total time: 3 seconds&lt;/p&gt;


&lt;p&gt;And now the runtime error:&lt;/p&gt;

&lt;p&gt;samoa:~/Projects/testOpenJpa trisberg$ ant run-test&lt;br/&gt;
Buildfile: build.xml&lt;/p&gt;

&lt;p&gt;run-test:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; TestApp!&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Sep 6, 2006 1:11:02 PM org.springframework.core.CollectionFactory &amp;lt;clinit&amp;gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; INFO: JDK 1.4+ collections available&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Sep 6, 2006 1:11:02 PM org.springframework.core.CollectionFactory &amp;lt;clinit&amp;gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; INFO: Commons Collections 3.x available&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Sep 6, 2006 1:11:02 PM org.springframework.beans.factory.xml.XmlBeanDefinitionReader loadBeanDefinitions&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; INFO: Loading XML bean definitions from class path resource &lt;span class=&quot;error&quot;&gt;&amp;#91;repository-config.xml&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Sep 6, 2006 1:11:03 PM org.springframework.context.support.AbstractRefreshableApplicationContext refreshBeanFactory&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; INFO: Bean factory for application context &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.context.support.ClassPathXmlApplicationContext;hashCode=85537&amp;#93;&lt;/span&gt;: org.springframework.beans.factory.support.DefaultListableBeanFactory defining beans &lt;span class=&quot;error&quot;&gt;&amp;#91;entityManagerFactory,transactionManager,transactionTemplate,dataSource&amp;#93;&lt;/span&gt;; root of BeanFactory hierarchy&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Sep 6, 2006 1:11:03 PM org.springframework.context.support.AbstractApplicationContext refresh&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; INFO: 4 beans defined in application context &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.context.support.ClassPathXmlApplicationContext;hashCode=85537&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Sep 6, 2006 1:11:03 PM org.springframework.context.support.AbstractApplicationContext initMessageSource&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; INFO: Unable to locate MessageSource with name &apos;messageSource&apos;: using default &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.context.support.DelegatingMessageSource@87e9bf&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Sep 6, 2006 1:11:03 PM org.springframework.context.support.AbstractApplicationContext initApplicationEventMulticaster&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; INFO: Unable to locate ApplicationEventMulticaster with name &apos;applicationEventMulticaster&apos;: using default &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.context.event.SimpleApplicationEventMulticaster@ad97f5&amp;#93;&lt;/span&gt;&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Sep 6, 2006 1:11:03 PM org.springframework.beans.factory.support.DefaultListableBeanFactory preInstantiateSingletons&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; INFO: Pre-instantiating singletons in factory [org.springframework.beans.factory.support.DefaultListableBeanFactory defining beans &lt;span class=&quot;error&quot;&gt;&amp;#91;entityManagerFactory,transactionManager,transactionTemplate,dataSource&amp;#93;&lt;/span&gt;; root of BeanFactory hierarchy]&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Sep 6, 2006 1:11:04 PM org.springframework.jdbc.datasource.DriverManagerDataSource setDriverClassName&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; INFO: Loaded JDBC driver: org.hsqldb.jdbcDriver&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Sep 6, 2006 1:11:04 PM org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean createNativeEntityManagerFactory&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; INFO: Allowing redeployment of EntityManagerFactory with name &apos;main&apos; &lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Sep 6, 2006 1:11:05 PM org.springframework.beans.factory.support.DefaultSingletonBeanRegistry destroySingletons&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; INFO: Destroying singletons in &lt;/p&gt;
{org.springframework.beans.factory.support.DefaultListableBeanFactory defining beans [entityManagerFactory,transactionManager,transactionTemplate,dataSource]; root of BeanFactory hierarchy}
&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Exception in thread &quot;main&quot; org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;entityManagerFactory&apos; defined in class path resource &lt;span class=&quot;error&quot;&gt;&amp;#91;repository-config.xml&amp;#93;&lt;/span&gt;: Invocation of init method failed; nested exception is &amp;lt;4|true|0.9.0-incubating-SNAPSHOT&amp;gt; org.apache.openjpa.persistence.ArgumentException: Could not invoke the static newInstance method on the named factory class &quot;class org.apache.openjpa.jdbc.kernel.JDBCBrokerFactory&quot;.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Caused by: &amp;lt;4|true|0.9.0-incubating-SNAPSHOT&amp;gt; org.apache.openjpa.persistence.ArgumentException: Could not invoke the static newInstance method on the named factory class &quot;class org.apache.openjpa.jdbc.kernel.JDBCBrokerFactory&quot;.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.openjpa.kernel.Bootstrap.newBrokerFactory(Bootstrap.java:71)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.openjpa.persistence.PersistenceProviderImpl.createContainerEntityManagerFactory(PersistenceProviderImpl.java:84)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:262)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:227)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:957)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:924)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:415)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:242)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:141)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:239)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:155)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:297)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:346)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.context.support.ClassPathXmlApplicationContext.&amp;lt;init&amp;gt;(ClassPathXmlApplicationContext.java:92)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.context.support.ClassPathXmlApplicationContext.&amp;lt;init&amp;gt;(ClassPathXmlApplicationContext.java:77)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.springframework.context.support.ClassPathXmlApplicationContext.&amp;lt;init&amp;gt;(ClassPathXmlApplicationContext.java:68)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at springdeveloper.TestApp.run(TestApp.java:57)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at springdeveloper.TestApp.main(TestApp.java:31)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; Caused by: java.lang.NoSuchMethodException: org.apache.openjpa.jdbc.kernel.JDBCBrokerFactory.newInstance(org.apache.openjpa.lib.conf.ConfigurationProvider)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at java.lang.Class.getMethod(Class.java:1581)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.openjpa.kernel.Bootstrap.newBrokerFactory(Bootstrap.java:62)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     ... 17 more&lt;/p&gt;

&lt;p&gt;BUILD FAILED&lt;br/&gt;
/Users/trisberg/Projects/testOpenJpa/build.xml:37: Java returned: 1&lt;/p&gt;

&lt;p&gt;Total time: 7 seconds&lt;/p&gt;

</description>
                <environment>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[java] os.name: Mac OS X&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[java] os.version: 10.4.7&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[java] os.arch: ppc&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[java] java.version: 1.5.0_06&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;[java] java.vendor: Apple Computer, Inc.&lt;br/&gt;
&lt;br/&gt;
OpenJPA built from SVN (revision 440460)&lt;br/&gt;
</environment>
        <key id="12349322">OPENJPA-40</key>
            <summary>Testing OpenJPA and Spring integration fails</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mprudhom">Marc Prud&apos;hommeaux</assignee>
                                    <reporter username="trisberg">Thomas Risberg</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Sep 2006 18:19:25 +0100</created>
                <updated>Tue, 9 Mar 2010 18:32:28 +0000</updated>
                            <resolved>Thu, 1 Feb 2007 06:47:21 +0000</resolved>
                                                    <fixVersion>0.9.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12432975" author="mprudhom" created="Wed, 6 Sep 2006 22:42:35 +0100"  >&lt;p&gt;Fix the ClassLoader issue by falling back to the parameter&apos;s ClassLoader in the event of a NoSuchMethodError. I am seeing a subsequent ClassCircularityError from the test case, but that might be a platform issue (I am using OS X). I&apos;d be interested in seeing if the error occurs for the reporter: if so, please re-open this JIRA issue or else make a new one.&lt;/p&gt;</comment>
                            <comment id="12432979" author="trisberg" created="Wed, 6 Sep 2006 23:03:16 +0100"  >&lt;p&gt;Marc,&lt;/p&gt;

&lt;p&gt;Thanks for the quick fix - we are at least one step closer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m also running under OS X and I do get the exception you mentioned - &lt;br/&gt;
  java.lang.ClassCircularityError: springdeveloper/domain/Manager&lt;/p&gt;

&lt;p&gt;Not sure if this is a Spring or OpenJPA issue yet though.  I&apos;ll reopen this case if we need to.&lt;/p&gt;

&lt;p&gt;Thanks again.&lt;/p&gt;</comment>
                            <comment id="12433028" author="costin" created="Thu, 7 Sep 2006 06:52:57 +0100"  >&lt;p&gt;I don&apos;t think it&apos;s Spring here. Spring LoadTimeWeaver helps implement the JPA transformation contract - allow transformers to be registered and offer two classloaders for loading classes - one which loads them in pure form (the ThrowawayClassloader) and one to load them enhanced.&lt;br/&gt;
By looking at the stacktrace, I think that either the appropriate classloader is not used or the transformation is applied twice (maybe because it is registered twice).&lt;/p&gt;</comment>
                            <comment id="12433168" author="mprudhom" created="Thu, 7 Sep 2006 17:58:44 +0100"  >&lt;p&gt;Re-opening.&lt;/p&gt;

&lt;p&gt;For the record, the exception I am seeing is:&lt;/p&gt;

&lt;p&gt;945  WARN   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Enhance - An exception was thrown while attempting to perform class file transformation on &quot;springdeveloper/domain/Manager&quot;:&lt;br/&gt;
java.lang.ClassCircularityError: springdeveloper/domain/Manager&lt;br/&gt;
  at java.lang.Class.getDeclaredFields0(Native Method)&lt;br/&gt;
  at java.lang.Class.privateGetDeclaredFields(Class.java:2232)&lt;br/&gt;
  at java.lang.Class.getDeclaredFields(Class.java:1715)&lt;br/&gt;
  at org.apache.openjpa.meta.AbstractMetaDataDefaults.populateFromReflection(AbstractMetaDataDefaults.java:178)&lt;br/&gt;
  at org.apache.openjpa.meta.AbstractMetaDataDefaults.populate(AbstractMetaDataDefaults.java:128)&lt;br/&gt;
  at org.apache.openjpa.persistence.PersistenceMetaDataDefaults.populate(PersistenceMetaDataDefaults.java:182)&lt;br/&gt;
  at org.apache.openjpa.meta.MetaDataRepository.addMetaData(MetaDataRepository.java:736)&lt;br/&gt;
  at org.apache.openjpa.persistence.XMLPersistenceMetaDataParser.startClass(XMLPersistenceMetaDataParser.java:720)&lt;br/&gt;
  at org.apache.openjpa.lib.meta.CFMetaDataParser.startElement(CFMetaDataParser.java:101)&lt;br/&gt;
  at org.apache.openjpa.lib.meta.XMLMetaDataParser.startElement(XMLMetaDataParser.java:427)&lt;br/&gt;
  at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.startElement(AbstractSAXParser.java:533)&lt;br/&gt;
  at com.sun.org.apache.xerces.internal.impl.xs.XMLSchemaValidator.startElement(XMLSchemaValidator.java:708)&lt;br/&gt;
  at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.scanStartElement(XMLNSDocumentScannerImpl.java:330)&lt;br/&gt;
  at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(XMLDocumentFragmentScannerImpl.java:1693)&lt;br/&gt;
  at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:368)&lt;br/&gt;
  at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:834)&lt;br/&gt;
  at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:764)&lt;br/&gt;
  at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:148)&lt;br/&gt;
  at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1242)&lt;br/&gt;
  at javax.xml.parsers.SAXParser.parse(SAXParser.java:375)&lt;br/&gt;
  at org.apache.openjpa.lib.meta.XMLMetaDataParser.parseNewResource(XMLMetaDataParser.java:371)&lt;br/&gt;
  at org.apache.openjpa.lib.meta.XMLMetaDataParser.parse(XMLMetaDataParser.java:312)&lt;br/&gt;
  at org.apache.openjpa.lib.meta.XMLMetaDataParser.parse(XMLMetaDataParser.java:289)&lt;br/&gt;
  at org.apache.openjpa.lib.meta.XMLMetaDataParser.parse(XMLMetaDataParser.java:263)&lt;br/&gt;
  at org.apache.openjpa.persistence.PersistenceMetaDataFactory.parseXML(PersistenceMetaDataFactory.java:237)&lt;br/&gt;
  at org.apache.openjpa.persistence.PersistenceMetaDataFactory.load(PersistenceMetaDataFactory.java:188)&lt;br/&gt;
  at org.apache.openjpa.meta.MetaDataRepository.getMetaDataInternal(MetaDataRepository.java:432)&lt;br/&gt;
  at org.apache.openjpa.meta.MetaDataRepository.getMetaData(MetaDataRepository.java:287)&lt;br/&gt;
  at org.apache.openjpa.enhance.PCEnhancer.&amp;lt;init&amp;gt;(PCEnhancer.java:164)&lt;br/&gt;
  at org.apache.openjpa.enhance.PCClassFileTransformer.transform(PCClassFileTransformer.java:115)&lt;br/&gt;
  at org.apache.openjpa.persistence.PersistenceProviderImpl$ClassTransformerImpl.transform(PersistenceProviderImpl.java:132)&lt;br/&gt;
  at org.springframework.orm.jpa.ClassFileTransformerAdapter.transform(ClassFileTransformerAdapter.java:56)&lt;br/&gt;
  at org.springframework.instrument.classloading.WeavingTransformer.transformIfNecessary(WeavingTransformer.java:102)&lt;br/&gt;
  at org.springframework.instrument.classloading.WeavingTransformer.transformIfNecessary(WeavingTransformer.java:83)&lt;br/&gt;
  at org.springframework.instrument.classloading.SimpleInstrumentableClassLoader.transformIfNecessary(SimpleInstrumentableClassLoader.java:56)&lt;br/&gt;
  at org.springframework.instrument.classloading.AbstractOverridingClassLoader.loadClass(AbstractOverridingClassLoader.java:95)&lt;br/&gt;
  at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
  at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319)&lt;br/&gt;
  at java.lang.Class.forName0(Native Method)&lt;br/&gt;
  at java.lang.Class.forName(Class.java:242)&lt;br/&gt;
  at org.apache.openjpa.meta.MetaDataRepository.classForName(MetaDataRepository.java:1156)&lt;br/&gt;
  at org.apache.openjpa.meta.MetaDataRepository.loadPersistentTypes(MetaDataRepository.java:1144)&lt;br/&gt;
  at org.apache.openjpa.kernel.AbstractBrokerFactory.loadPersistentTypes(AbstractBrokerFactory.java:218)&lt;br/&gt;
  at org.apache.openjpa.kernel.AbstractBrokerFactory.newBroker(AbstractBrokerFactory.java:175)&lt;br/&gt;
  at org.apache.openjpa.kernel.DelegatingBrokerFactory.newBroker(DelegatingBrokerFactory.java:139)&lt;br/&gt;
  at org.apache.openjpa.persistence.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:171)&lt;br/&gt;
  at org.apache.openjpa.persistence.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:124)&lt;br/&gt;
  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
  at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
  at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean$ManagedEntityManagerFactoryInvocationHandler.invoke(AbstractEntityManagerFactoryBean.java:354)&lt;br/&gt;
  at $Proxy0.createEntityManager(Unknown Source)&lt;br/&gt;
  at springdeveloper.TestApp.run(TestApp.java:60)&lt;br/&gt;
  at springdeveloper.TestApp.main(TestApp.java:31)&lt;/p&gt;</comment>
                            <comment id="12433659" author="mprudhom" created="Sun, 10 Sep 2006 04:42:53 +0100"  >&lt;p&gt;This is a pretty hairy problem. The ClassCircularityError is coming from the fact that there are two different ClassLoaders in place: a org.springframework.instrument.classloading.SimpleThrowawayClassLoader, which is being used for temporary loading in the premain, and a org.springframework.instrument.classloading.SimpleInstrumentableClassLoader, which is being used to actually load the post-enhanced classes. The Manager and Client classes have a dependency on each other, and when Manager is loaded by SimpleThrowawayClassLoader, its metadata gets parsed, which causes Client to be transitively loaded. However, the XMLPersistenceMetaDataParser being used by our PersistenceMetaDataFactory is being configured with setClassLoader() using the SimpleInstrumentableClassLoader, rather than the SimpleThrowawayClassLoader. When Client&apos;s metadata is parsed, it then tries to load Manager in the SimpleInstrumentableClassLoader, which causes a re-entrant attempt to load Manager in SimpleThrowawayClassLoader, which is what I believe is causing the ClassCircularityError.&lt;/p&gt;

&lt;p&gt;This can be fixed by changing &quot;xmlParser.setClassLoader(loader)&quot; to instead call &quot;xmlParser.setClassLoader(envLoader)&quot;. However, if that happens, then the PersistenceCapable interface itself winds up getting loaded by the SimpleInstrumentableClassLoader, which later causes a mismatch with the interface with other classes (like ClassMetaData) that are loaded using the system AppClassLoader.&lt;/p&gt;

&lt;p&gt;Has Spring been tested with any other JPA implementations that use bytecode enhancement at runtime? On one hand, OpenJPA is working fine with Glassfish, on the other hand, the Glassfish samples we have tested against use annotation mappings, rather than XML mappings, so the problem might lie there.&lt;/p&gt;</comment>
                            <comment id="12433660" author="mprudhom" created="Sun, 10 Sep 2006 04:49:56 +0100"  >&lt;p&gt;I just tested using entity-only annotations, and the same problem exists: the org.apache.openjpa.enhance.PersistenceCapable interface that the enhanced springdeveloper.domain.Client classes uses is being loaded by org.springframework.instrument.classloading.SimpleInstrumentableClassLoader, but the classloader that the PersistenceCapable interface referenced by core OpenJPA classes (like ClassMetaData) uses is a sun.misc.Launcher$AppClassLoader. It is almost like SimpleInstrumentableClassLoader is not delegating to the parent classloader or something.&lt;/p&gt;</comment>
                            <comment id="12433744" author="mprudhom" created="Mon, 11 Sep 2006 00:12:36 +0100"  >&lt;p&gt;I&apos;ve committed the class loading fix. In addition to that, we need some way to exclude the openjpa classes from being instrumented. The only way I could think of doing that is to write a OpenJpaLoadTimeWeaver to do it, which I&apos;ve attached to this issue. If you include it in the repository-config.xml as follows:&lt;/p&gt;

&lt;p&gt;    &amp;lt;property name=&quot;loadTimeWeaver&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;!-- &amp;lt;bean class=&quot;org.springframework.instrument.classloading.SimpleLoadTimeWeaver&quot;/&amp;gt; --&amp;gt;&lt;br/&gt;
        &amp;lt;bean class=&quot;org.springframework.orm.jpa.vendor.OpenJpaLoadTimeWeaver&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;then the class loading should work.&lt;/p&gt;

&lt;p&gt;Finally, there is an error in the orm.xml mapping file that OpenJPA has problems with: the &quot;attribute-override&quot; mapping for Manager says to override the &quot;description&quot; mapping, but &quot;description&quot; is defined in Manager, not in any mapped superclass of Manager. AFAIK, attribute-override is only supposed to be used to override superclass mappings, not mappings in the entity itself.&lt;/p&gt;

&lt;p&gt;So, in summary, I&apos;ve gotten the sample to work by doing the following:&lt;/p&gt;

&lt;p&gt;1. Put OpenJpaLoadTimeWeaver.java in the src/org/springframework/orm/jpa/vendor/ directory&lt;br/&gt;
2. Add OpenJpaLoadTimeWeaver as the &quot;loadTimeWeaver&quot; in repository-config.xml&lt;br/&gt;
3. Remove the  &quot;attribute-override&quot; element from src/META-INF/orm.xml&lt;/p&gt;

&lt;p&gt;Once all these are done, the sample runs for me. I&apos;ll be interested in seing if it works for you, and what your opinion is on whether the OpenJpaLoadTimeWeaver is the best way to resolve the class loading issue.&lt;/p&gt;</comment>
                            <comment id="12433878" author="trisberg" created="Mon, 11 Sep 2006 16:20:22 +0100"  >&lt;p&gt;I made the changes you suggested and I can now run the test relying only on annotations.  As soon as I involve an orm.xml in combination with the annotations I see errors - see &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-42&quot; title=&quot;Simple orm.xml file causes exception (NPE)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-42&quot;&gt;&lt;del&gt;OPENJPA-42&lt;/del&gt;&lt;/a&gt; for specific error I get.  Once those errors are resoved I&apos;ll come back to this issue to retest it.&lt;/p&gt;

&lt;p&gt;Thanks. &lt;/p&gt;</comment>
                            <comment id="12469347" author="pcl" created="Thu, 1 Feb 2007 06:47:22 +0000"  >&lt;p&gt;To my knowledge, this has been resolved.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12340279" name="ASF.LICENSE.NOT.GRANTED--testOpenJpa.zip" size="8889813" author="trisberg" created="Wed, 6 Sep 2006 18:19:25 +0100"/>
                            <attachment id="12340535" name="OpenJpaLoadTimeWeaver.java" size="2301" author="mprudhom" created="Mon, 11 Sep 2006 00:13:44 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 6 Sep 2006 21:42:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160377</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysvm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202470</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>