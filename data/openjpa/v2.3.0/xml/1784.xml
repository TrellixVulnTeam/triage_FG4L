<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:32:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1784/OPENJPA-1784.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1784] Map value updates not flushed</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1784</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;I have an entity with a map element collection where the map value is an Embeddable.&lt;/p&gt;

&lt;p&gt;@Embeddable&lt;br/&gt;
public class LocalizedString &lt;/p&gt;
{

    private String language;
    private String string;

    // getters and setters omitted
}



&lt;p&gt;@Entity&lt;br/&gt;
public class MultilingualString &lt;/p&gt;
{

    @Id
    private long id;

    @ElementCollection(fetch=FetchType.EAGER)
    private Map&amp;lt;String, LocalizedString&amp;gt; map = new HashMap&amp;lt;String, LocalizedString&amp;gt;();
}


&lt;p&gt;Given a persistent instance m of my entity, I update a member of a given map value and then merge the modified entity:&lt;/p&gt;

&lt;p&gt;    EntityManager em = ...;&lt;br/&gt;
    em.getTransaction().begin();&lt;br/&gt;
    m.getMap().get(&quot;en&quot;).setString(&quot;foo&quot;);&lt;br/&gt;
    em.merge(m)&lt;br/&gt;
    em.getTransaction().commit();&lt;/p&gt;

&lt;p&gt;The problem is, the state change of the map does not get saved to the database. With DEBUG logging on, I can see that the flush on commit does not trigger any SQL UPDATE.&lt;/p&gt;

&lt;p&gt;To force the update, I have to put a new value into the map instead of just changing the existing one.&lt;/p&gt;

&lt;p&gt;    EntityManager em = ...;&lt;br/&gt;
    em.getTransaction().begin();&lt;br/&gt;
    m.getMap().put(&quot;en&quot;), new LocalizedString(&quot;en&quot;, &quot;foo&quot;));&lt;br/&gt;
    em.merge(m)&lt;br/&gt;
    em.getTransaction().commit();&lt;/p&gt;

&lt;p&gt;After this change, I do see the expected UPDATE.&lt;/p&gt;

&lt;p&gt;My Embeddable does have hashCode() and equals() implemented such that the changed map is not equal() to the former version in either case.&lt;/p&gt;

&lt;p&gt;This looks like a bug in the dirty-checking logic in OpenJPA.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12473570">OPENJPA-1784</key>
            <summary>Map value updates not flushed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="faywang">Fay Wang</assignee>
                                    <reporter username="hwellmann">Harald Wellmann</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Sep 2010 14:31:29 +0100</created>
                <updated>Thu, 13 Jan 2011 16:45:35 +0000</updated>
                            <resolved>Fri, 10 Sep 2010 16:36:48 +0100</resolved>
                                    <version>2.0.1</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12907210" author="hwellmann" created="Wed, 8 Sep 2010 14:34:38 +0100"  >&lt;p&gt;The attachment MapUpdate.patch contains a unit test exhibiting the problem. A test which updates a map key passes. Another test which only update the map value fails.&lt;/p&gt;</comment>
                            <comment id="12907277" author="faywang" created="Wed, 8 Sep 2010 16:59:34 +0100"  >&lt;p&gt;Change in persistent map are detected by OpenJPA when the the put/remove method is called. In the example, the get method is called to retrieve the value. Currently there is no way for the persistent map to know whether the value is modified or not. A new mechanism needs to be added to detect the change. &lt;/p&gt;</comment>
                            <comment id="12981350" author="mikedd" created="Thu, 13 Jan 2011 16:45:35 +0000"  >&lt;p&gt;Closing issue which has been resolved for some time. If you believe the issue is not resolved please reopen or open a new issue. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12454105" name="MapUpdate.patch" size="8787" author="hwellmann" created="Wed, 8 Sep 2010 14:34:38 +0100"/>
                            <attachment id="12454183" name="OPENJPA-1784.patch" size="12196" author="faywang" created="Thu, 9 Sep 2010 05:40:32 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Sep 2010 15:59:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>162026</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysygn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202931</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>