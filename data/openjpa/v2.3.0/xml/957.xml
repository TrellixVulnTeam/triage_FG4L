<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:42:15 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-957/OPENJPA-957.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-957] Support lock timeout hint on applicable methods</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-957</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;This task is to provide support for the lock timeout hint on applicable interface methods.  OpenJPA currently supports the openjpa.LockTimeout property.  This support will be extended to allow more granular configuration at the method level, where applicable.  The pattern used for specifying lock modes at a method level should be considered for extension or as a guide.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12416217">OPENJPA-957</key>
            <summary>Support lock timeout hint on applicable methods</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12416215">OPENJPA-956</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="allee8285">Albert Lee</assignee>
                                    <reporter username="techhusky">Jeremy Bauer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Mar 2009 16:55:38 +0000</created>
                <updated>Tue, 9 Mar 2010 18:31:10 +0000</updated>
                            <resolved>Mon, 6 Apr 2009 15:55:51 +0100</resolved>
                                    <version>2.0.0-M2</version>
                                    <fixVersion>2.0.0-M2</fixVersion>
                                    <component>jpa</component>
                        <due>Fri, 3 Apr 2009 07:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12680251" author="drwoods" created="Mon, 9 Mar 2009 20:00:33 +0000"  >&lt;p&gt;Looks like the existing implementation (not defined in JPA 1.0 Spec and OpenJPA specific) is using setQueryTimeout() in PessimisticLockManager, which is a client side JDBC timeout function, while lock timeouts are implemented in the DB server. See -&lt;br/&gt;
DB2 - &lt;a href=&quot;http://publib.boulder.ibm.com/infocenter/db2luw/v8/index.jsp?topic=/com.ibm.db2.udb.doc/admin/r0011874.htm&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://publib.boulder.ibm.com/infocenter/db2luw/v8/index.jsp?topic=/com.ibm.db2.udb.doc/admin/r0011874.htm&lt;/a&gt;&lt;br/&gt;
MS SQL - &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/aa213032(SQL.80).aspx&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://msdn.microsoft.com/en-us/library/aa213032(SQL.80).aspx&lt;/a&gt;&lt;br/&gt;
Derby - config property - &lt;a href=&quot;http://db.apache.org/derby/docs/dev/devguide/cdevconcepts16400.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/dev/devguide/cdevconcepts16400.html&lt;/a&gt;&lt;br/&gt;
Oracle - LOCKWAIT on the connection or on the DB&lt;br/&gt;
Also, the following discussion gives a good overview of the two and why apps should use both to handle unreliable network conditions -&lt;br/&gt;
&lt;a href=&quot;http://social.msdn.microsoft.com/Forums/en-US/sqldataaccess/thread/95755534-bbef-4c2c-afa4-b80ca2a2c333/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://social.msdn.microsoft.com/Forums/en-US/sqldataaccess/thread/95755534-bbef-4c2c-afa4-b80ca2a2c333/&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="12680263" author="drwoods" created="Mon, 9 Mar 2009 20:35:28 +0000"  >&lt;p&gt;Do we need to support the old behavior of using setQueryTimeout() for lock timeout as a compatibility option?&lt;/p&gt;</comment>
                            <comment id="12680865" author="drwoods" created="Wed, 11 Mar 2009 13:07:55 +0000"  >&lt;p&gt;For Oracle tables/schemas - &lt;a href=&quot;http://www.oracle.com/technology/pub/articles/oracle-database-11g-top-features/11g-schemamanagement.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.oracle.com/technology/pub/articles/oracle-database-11g-top-features/11g-schemamanagement.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12680866" author="drwoods" created="Wed, 11 Mar 2009 13:13:50 +0000"  >&lt;p&gt;DB2 uses &quot;SET CURRENT LOCK TIMEOUT = &amp;lt;secs&amp;gt;&quot; for all statements on the current connection.&lt;/p&gt;</comment>
                            <comment id="12681077" author="allee8285" created="Wed, 11 Mar 2009 22:59:52 +0000"  >&lt;p&gt;FYI... I find the following in the Derby reference.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://db.apache.org/derby/docs/10.1/ref/refderby.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://db.apache.org/derby/docs/10.1/ref/refderby.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY&lt;br/&gt;
Use the SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY system procedure to set or delete the value of a property of the database on the current connection. If &quot;VALUE&quot; is not null, then the property with key value &quot;KEY&quot; is set to &quot;VALUE&quot;. If &quot;VALUE&quot; is null, then the property with key value &quot;KEY&quot; is deleted from the database property set.&lt;/p&gt;

&lt;p&gt;Syntax&lt;br/&gt;
SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY(IN KEY VARCHAR(128),IN VALUE VARCHAR(32672))&lt;br/&gt;
This procedure does not return any results.&lt;br/&gt;
JDBC example&lt;br/&gt;
Set the derby.locks.deadlockTimeout property to a value of 10:&lt;/p&gt;

&lt;p&gt;CallableStatement cs = conn.prepareCall&lt;br/&gt;
(&quot;CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY(?, ?)&quot;);&lt;br/&gt;
cs.setString(1, &quot;derby.locks.deadlockTimeout&quot;);&lt;br/&gt;
cs.setString(2, &quot;10&quot;);&lt;br/&gt;
cs.execute();&lt;br/&gt;
cs.close();&lt;/p&gt;

&lt;p&gt;SQL example&lt;br/&gt;
Set the derby.locks.deadlockTimeout property to a value of 10:&lt;br/&gt;
CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY&lt;br/&gt;
(&apos;derby.locks.deadlockTimeout&apos;, &apos;10&apos;);&lt;/p&gt;

&lt;p&gt;java.sql.Statement&lt;br/&gt;
Derby does not implement the following JDBC 1.2 methods of java.sql.Statement:&lt;br/&gt;
&#8226; cancel&lt;br/&gt;
&#8226; setEscapeProcessing&lt;br/&gt;
&#8226; setQueryTimeout&lt;/p&gt;</comment>
                            <comment id="12681109" author="ppoddar@apache.org" created="Thu, 12 Mar 2009 00:18:36 +0000"  >&lt;p&gt;How about refactoring setTimeout() from Select to to DBDictionary?&lt;br/&gt;
Then we can add database specific details incremental way as Albert&apos;s &amp;amp; Donald&apos;s (and others) research solidifies the exact techniques for each database.&lt;/p&gt;</comment>
                            <comment id="12681143" author="drwoods" created="Thu, 12 Mar 2009 02:14:59 +0000"  >&lt;p&gt;Albert, Derby 10.2 has full support for Statement.setQueryTimeout() and I have verified that it is working as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-878&quot; title=&quot;Support default query hint for query timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-878&quot;&gt;&lt;del&gt;OPENJPA-878&lt;/del&gt;&lt;/a&gt; (can&apos;t say the same for DB2 9.5.3a on WinXp....)&lt;/p&gt;</comment>
                            <comment id="12681331" author="allee8285" created="Thu, 12 Mar 2009 14:28:36 +0000"  >&lt;p&gt;It would be good to support the lock timeout the way it is supposed to work. To do this properly, it will be db specific and hence DBDictionary needs to reflect this capability, if supported by the db.&lt;/p&gt;

&lt;p&gt;Donald, thanks for verifying the timeout feature in 10.2.   We need to update the &quot;Supported Databases&quot;  section in the manual, either: bump up the support level to 10.2 or add a known limitation describe the query timeout will NOT work if 10.1 is used.&lt;/p&gt;

&lt;p&gt;Albert Lee.&lt;/p&gt;</comment>
                            <comment id="12688985" author="allee8285" created="Wed, 25 Mar 2009 03:27:20 +0000"  >&lt;p&gt;Initial code drop to support hints in FetchConfiguration and FetchPlan, which are used by em interface methods that take a Map of hints/properties apply only to the the method invocation.&lt;/p&gt;</comment>
                            <comment id="12689140" author="allee8285" created="Wed, 25 Mar 2009 15:43:27 +0000"  >&lt;p&gt;This is a summary of the design points for the Query/EntityManager hint supports :&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Based on property Map&amp;lt;String,Object&amp;gt; definition, value of appropriate types and corresponding plugin aliases are valid property hint values. (E.g.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;	props.put(&quot;openjpa.FetchPlan.Isolation&quot;, &quot;serializable&quot;);&lt;br/&gt;
	props.put(&quot;openjpa.FetchPlan.Isolation&quot;, Connection.TRANSACTION_READ_UNCOMMITTED);&lt;br/&gt;
	props.put(&quot;openjpa.FetchPlan.Isolation&quot;, String.valueOf(Connection.TRANSACTION_READ_UNCOMMITTED));&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Hints specified in Query or EntityManager interface methods become effective when the corresponding functions are applied not when the hint is being set..  This means semantics (e.g. transaction) requirements for a hint to be compliant is verified when the function is applied not when the hint is set.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FetchPlan processes hints that is specific to FetchPlan interface (E.g. LockMode to LockLevel type conversion) and passes the rest to FetchConfiguration for processing. FetchConfiguration handles type conversion and alias processing.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Query.setHint() will not throw exception if hint is not recognized and is silently ignored.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Hints specified in different run-time configuration follow the rules defined in &quot;2.  Runtime Configuration&quot; (&lt;a href=&quot;http://openjpa.apache.org/builds/latest/docs/manual/ref_guide_conf_specify.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://openjpa.apache.org/builds/latest/docs/manual/ref_guide_conf_specify.html&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If multiple hints with different prefixes of similar property are specified in the same property map in the Query and EntityManager interface methods (i.e. openjpa.&lt;b&gt;, openjpa.jdbc.&lt;/b&gt;, openjpa.FetchPlan.* and javax.persistence.* ) the following precedence (from high to low) applies:&lt;br/&gt;
1,  javax.persistence.* &lt;br/&gt;
2. openjpa.FetchPlan.* &lt;br/&gt;
3. openjpa.jdbc.* &lt;br/&gt;
4. openjpa.*&lt;br/&gt;
        (e.g. javax.persistence.lock.timeout overrides openjpa.FetchPlan.LockTimeout overrides openjpa.LockTimeout)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Albert Lee.&lt;/p&gt;</comment>
                            <comment id="12690108" author="allee8285" created="Fri, 27 Mar 2009 21:17:19 +0000"  >&lt;p&gt;Add more clean up, refactoring and test paths.&lt;/p&gt;</comment>
                            <comment id="12695672" author="allee8285" created="Sat, 4 Apr 2009 06:35:49 +0100"  >&lt;p&gt;Rework based on code review comments and suggestions.&lt;/p&gt;

&lt;p&gt;Albert Lee.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12417320">OPENJPA-991</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12413544">OPENJPA-878</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12404623" name="OPENJPA-957.patch" size="180629" author="allee8285" created="Sat, 4 Apr 2009 07:38:15 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 9 Mar 2009 20:00:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161254</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt4lr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203926</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>