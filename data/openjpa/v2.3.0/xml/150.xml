<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:33:32 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-150/OPENJPA-150.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-150] @Column in @AttributeOverride not honoring table attribute that maps to a secondary table in mappedsuperclass entity</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-150</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;I have the following scenario mapping entity to 2 tables:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a mapped super class that has a field&lt;/li&gt;
	&lt;li&gt;a subclass with a pk and a field.&lt;/li&gt;
	&lt;li&gt;trying to map all the fields (except the pk (id) ) to a secondary table (SEC_TABLE2MSC)&lt;/li&gt;
	&lt;li&gt;use @Column in the sub-class to override (name) to the secondary table&lt;/li&gt;
	&lt;li&gt;use @AttributeOverride to override the field (street) in the mapped super class to the secondary table.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;===============&lt;br/&gt;
@MappedSuperclass&lt;br/&gt;
public abstract class AnnMSCMultiTable&lt;br/&gt;
implements IMultiTableEntity&lt;br/&gt;
{&lt;br/&gt;
    // @Column(table=&quot;SEC_TABLE2MSC&quot;)&lt;br/&gt;
    private String street;&lt;br/&gt;
    public String getStreet() &lt;/p&gt;
{
        return street;
    }
&lt;p&gt;   public void setStreet(String street) &lt;/p&gt;
{
        this.street = street;
    }
&lt;p&gt;}&lt;br/&gt;
===============&lt;br/&gt;
@Entity&lt;br/&gt;
@SecondaryTable(name=&quot;SEC_TABLE2MSC&quot;, pkJoinColumns=@PrimaryKeyJoinColumn(name=&quot;id&quot;))&lt;br/&gt;
@AttributeOverrides(&lt;br/&gt;
        &lt;/p&gt;
{
            @AttributeOverride(name=&quot;street&quot;, column=@Column(name=&quot;street&quot;, table=&quot;SEC_TABLE2MSC&quot;)),
        }
&lt;p&gt;)&lt;br/&gt;
public class AnnMSCMultiTableEnt&lt;br/&gt;
extends AnnMSCMultiTable&lt;br/&gt;
{&lt;br/&gt;
    @Id&lt;br/&gt;
    private int id;&lt;/p&gt;

&lt;p&gt;    @Column(name=&quot;name2&quot;, table=&quot;SEC_TABLE2MSC&quot;)&lt;br/&gt;
    private String name;&lt;br/&gt;
}&lt;br/&gt;
===============&lt;/p&gt;

&lt;p&gt;From examining JPA spec, there is no specific in the @Column and @AttributeOverride that this should not be allow. So I believe this is a valid scenario.&lt;/p&gt;

&lt;p&gt;Using the MappingTool, the attribute override does not map the street field to the SEC_TABLE2MSC as I would expect:&lt;/p&gt;

&lt;p&gt;CREATE TABLE AnnMSCMultiTableEnt (id INTEGER NOT NULL, street VARCHAR(254), PRIMARY KEY (id));&lt;br/&gt;
CREATE TABLE SEC_TABLE2MSC (id INTEGER, name2 VARCHAR(254));&lt;br/&gt;
CREATE INDEX I_SC_TMSC_ID ON SEC_TABLE2MSC (id);&lt;/p&gt;

&lt;p&gt;I experiment this a little bit and the only way I can map the street field to SEC_TABLE2MSC is&lt;br/&gt;
to add the @Column against the &quot;street&quot; attribute in the super class. (the commented @Column in the example).&lt;br/&gt;
The expected SQL are:&lt;/p&gt;

&lt;p&gt;CREATE TABLE AnnMSCMultiTableEnt (id INTEGER NOT NULL, PRIMARY KEY (id));&lt;br/&gt;
CREATE TABLE SEC_TABLE2MSC (id INTEGER, street VARCHAR(254), name2 VARCHAR(254));&lt;br/&gt;
CREATE INDEX I_SC_TMSC_ID ON SEC_TABLE2MSC (id);&lt;/p&gt;

&lt;p&gt;I tried to create the tables manually using the expected layout, but the runtime still using the incorrect tables structure. I would suspect the MappingTool and the runtime are using the same mapping strategy.&lt;/p&gt;

&lt;p&gt;Albert Lee,&lt;/p&gt;</description>
                <environment>Any</environment>
        <key id="12362925">OPENJPA-150</key>
            <summary>@Column in @AttributeOverride not honoring table attribute that maps to a secondary table in mappedsuperclass entity</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="allee8285">Albert Lee</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Feb 2007 14:38:15 +0000</created>
                <updated>Tue, 30 Oct 2007 14:45:48 +0000</updated>
                            <resolved>Tue, 20 Feb 2007 17:38:06 +0000</resolved>
                                                    <fixVersion>0.9.7</fixVersion>
                                    <component>jdbc</component>
                    <component>sql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12473784" author="allee8285" created="Fri, 16 Feb 2007 18:38:20 +0000"  >&lt;p&gt;I investigated into this problem and the following changes has corrected the problem scenarios:&lt;/p&gt;

&lt;p&gt;public class org.apache.openjpa.persistence.jdbc.AnnotationPersistenceMappingParser&lt;br/&gt;
{&lt;br/&gt;
    .......&lt;br/&gt;
    private void parseAttributeOverrides(ClassMapping cm,&lt;br/&gt;
        AttributeOverride... attrs) {&lt;br/&gt;
        .......&lt;br/&gt;
        for (AttributeOverride attr : attrs) {&lt;br/&gt;
            ...........&lt;br/&gt;
//            unique = (scol.unique()) ? TRUE : FALSE;&lt;br/&gt;
//            setColumns(sup, sup.getValueInfo(), Arrays.asList&lt;br/&gt;
//                (new Column[]&lt;/p&gt;
{ newColumn(scol) }
&lt;p&gt;), unique);&lt;br/&gt;
            // *** Replace the above statements by parseColumns()&lt;br/&gt;
            parseColumns( sup, scol);&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    private void parseAttributeOverrides(FieldMapping fm,&lt;br/&gt;
        AttributeOverride... attrs) {&lt;br/&gt;
        ..........&lt;br/&gt;
        for (AttributeOverride attr : attrs) {&lt;br/&gt;
            ...........&lt;br/&gt;
//            unique = (ecol.unique()) ? TRUE : FALSE;&lt;br/&gt;
//            setColumns(efm, efm.getValueInfo(), Arrays.asList&lt;br/&gt;
//                (new Column[]&lt;/p&gt;
{ newColumn(ecol) }
&lt;p&gt;), unique);&lt;br/&gt;
            // *** Replace the above statements by parseColumns()&lt;br/&gt;
            parseColumns( efm, ecol);&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Basically, the changes are to re-use the parseColumns() method to process the @Column defintion(s) in @AttributeOverride to handle all the @Column attributes.&lt;/p&gt;

&lt;p&gt;I ran some basic tests and there is no regression.&lt;/p&gt;

&lt;p&gt;I am new to the openjpa code base and still have a long way to fully understand all the the ins and outs. &lt;/p&gt;

&lt;p&gt;Can someone, who has more thorough knowledge of this code path, review these changes to ensure I am not &quot;way-off&quot;?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
Albert Lee.&lt;/p&gt;</comment>
                            <comment id="12474506" author="awhite" created="Tue, 20 Feb 2007 17:38:06 +0000"  >&lt;p&gt;Committed suggested changes (with very minor modifications) in revision 509674.  Thanks for the fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 20 Feb 2007 17:38:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>41969</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysz0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203021</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>