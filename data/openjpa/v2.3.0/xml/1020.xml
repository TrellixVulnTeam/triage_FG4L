<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:37:33 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1020/OPENJPA-1020.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1020] eager fetching of PersistentCollection of a primitive type fails</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1020</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;When a PersistentCollection of primitives like String.class are persisted, if the collection is marked as eager fetching. An exception is thrown upon loading the collection :&lt;/p&gt;

&lt;p&gt;Attached is a patch file to the 2.0.0 trunk&apos;s junit test which illustrates the collection working with lazy and failing with eager. This also happens in 1.2.1&lt;/p&gt;



&lt;p&gt;Exception below:&lt;br/&gt;
--------------------&lt;/p&gt;

&lt;p&gt;junit.framework.AssertionFailedError: java.lang.String cannot be cast to org.apache.openjpa.enhance.PersistenceCapable&lt;br/&gt;
	at junit.framework.Assert.fail(Assert.java:47)&lt;br/&gt;
	at org.apache.openjpa.persistence.annotations.TestPersistentCollection.testPersistentCollectionStringsEager(TestPersistentCollection.java:169)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:154)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:127)&lt;br/&gt;
	at org.apache.openjpa.persistence.test.PersistenceTestCase.runBare(PersistenceTestCase.java:455)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:118)&lt;br/&gt;
	at org.apache.openjpa.persistence.test.PersistenceTestCase.run(PersistenceTestCase.java:182)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:203)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.maven.surefire.junit.JUnitTestSet.execute(JUnitTestSet.java:213)&lt;br/&gt;
	at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:140)&lt;br/&gt;
	at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:127)&lt;br/&gt;
	at org.apache.maven.surefire.Surefire.run(Surefire.java:177)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:334)&lt;br/&gt;
	at org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:980)&lt;/p&gt;</description>
                <environment>Linux deltoid-r61 2.6.27.12-170.2.5.fc10.i686 #1 SMP Wed Jan 21 02:09:37 EST 2009 i686 i686 i386 GNU/Linux&lt;br/&gt;
java version &amp;quot;1.6.0_12&amp;quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_12-b04)&lt;br/&gt;
Java HotSpot(TM) Server VM (build 11.2-b01, mixed mode)&lt;br/&gt;
</environment>
        <key id="12421989">OPENJPA-1020</key>
            <summary>eager fetching of PersistentCollection of a primitive type fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mcconne">Tim McConnell</assignee>
                                    <reporter username="tedman@sfu.ca">Ted Leung</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Apr 2009 18:18:23 +0100</created>
                <updated>Tue, 9 Mar 2010 18:31:13 +0000</updated>
                            <resolved>Tue, 9 Mar 2010 14:36:29 +0000</resolved>
                                    <version>1.2.1</version>
                    <version>2.0.0-M2</version>
                                    <fixVersion>2.0.0-beta</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="12695507" author="tedman@sfu.ca" created="Fri, 3 Apr 2009 18:19:46 +0100"  >&lt;p&gt;a patch to the junit tests illustrating the problem&lt;/p&gt;</comment>
                            <comment id="12695555" author="tedman@sfu.ca" created="Fri, 3 Apr 2009 21:10:42 +0100"  >&lt;p&gt;a fix for the problem, it was my best guess and I&apos;m not that familiar with the code so please read it over to make sure it makes sense.&lt;/p&gt;</comment>
                            <comment id="12695558" author="tedman@sfu.ca" created="Fri, 3 Apr 2009 21:14:33 +0100"  >&lt;p&gt;It appears that in the JDBC Store Manager it assumes that the item in the collections is an entity or a persist capable object. In the case of PersistentCollections, I don&apos;t think that&apos;s true as you can store Strings,Enums etc... so I added a check in the loop to make sure it&apos;s a persist capable object before trying to cast and assign a reverse mapping.&lt;/p&gt;

&lt;p&gt;It&apos;s entirely possible that the setInverseRelation() should never have been called at all for that collection... but I&apos;m not sure. The patch I submitted just checked each element in the collection at the time of setting the inverse.&lt;/p&gt;</comment>
                            <comment id="12700071" author="dleangen" created="Fri, 17 Apr 2009 09:21:59 +0100"  >&lt;p&gt;This patch seems to work ok for me, too.&lt;/p&gt;</comment>
                            <comment id="12839874" author="faywang" created="Mon, 1 Mar 2010 21:38:46 +0000"  >&lt;p&gt;The fix and the test case have been checked into trunk level code. It is not ported to openjpa 1.2 yet.&lt;/p&gt;</comment>
                            <comment id="12839915" author="kwsutter" created="Mon, 1 Mar 2010 23:23:35 +0000"  >&lt;p&gt;Marking the fix versions since this was integrated back on 01/04/2010.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12404581" name="openjpa_jdbc_patch.zip" size="577" author="tedman@sfu.ca" created="Fri, 3 Apr 2009 21:10:42 +0100"/>
                            <attachment id="12404567" name="openjpa_junit_patch.zip" size="1523" author="tedman@sfu.ca" created="Fri, 3 Apr 2009 18:19:46 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 17 Apr 2009 08:21:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161314</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt68v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204192</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>