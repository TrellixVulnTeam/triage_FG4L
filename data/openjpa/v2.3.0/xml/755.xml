<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:37:23 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-755/OPENJPA-755.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-755] OpenJPA thows EntityExistsException trying persist a preexisting, detached entity</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-755</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;I have a CustomerInventory entity that has a reference to an Item entity. The cascade property for Item is set to ALL. I create a new CustomerInventory, and attach to it an Item that was previously found and detached (by closing the em). I add the CustomerInventory to an existing Customer, and merge in the updated Customer. &lt;/p&gt;

&lt;p&gt;At commit time, OpenJPA tries to persist Item, leading to this exception:&lt;/p&gt;

&lt;p&gt;&amp;lt;openjpa-2.0.0-SNAPSHOT-runknown fatal store error&amp;gt; org.apache.openjpa.persistence.RollbackException: Attempt to persist detached object &quot;org.apache.openjpa.persistence.detachment.model.DMItem-org.apache.openjpa.persistence.detachment.model.DMItem-1225343083922&quot;.  If this is a new instance, make sure any version and/or auto-generated primary key fields are null/default when persisting.&lt;br/&gt;
	at org.apache.openjpa.persistence.EntityManagerImpl.commit(EntityManagerImpl.java:523)&lt;br/&gt;
	at org.apache.openjpa.persistence.detachment.TestDetachedEntityCascadePersist.testDetachedEntityCascadePersist(TestDetachedEntityCascadePersist.java:73)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:154)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:127)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:118)&lt;br/&gt;
	at org.apache.openjpa.persistence.test.PersistenceTestCase.run(PersistenceTestCase.java:143)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:203)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)&lt;br/&gt;
Caused by: &amp;lt;openjpa-2.0.0-SNAPSHOT-runknown nonfatal store error&amp;gt; org.apache.openjpa.persistence.EntityExistsException: Attempt to persist detached object &quot;org.apache.openjpa.persistence.detachment.model.DMItem-org.apache.openjpa.persistence.detachment.model.DMItem-1225343083922&quot;.  If this is a new instance, make sure any version and/or auto-generated primary key fields are null/default when persisting.&lt;br/&gt;
FailedObject: org.apache.openjpa.persistence.detachment.model.DMItem-org.apache.openjpa.persistence.detachment.model.DMItem-1225343083922&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.persist(BrokerImpl.java:2422)&lt;br/&gt;
	at org.apache.openjpa.kernel.SingleFieldManager.preFlushPC(SingleFieldManager.java:759)&lt;br/&gt;
	at org.apache.openjpa.kernel.SingleFieldManager.preFlush(SingleFieldManager.java:594)&lt;br/&gt;
	at org.apache.openjpa.kernel.SingleFieldManager.preFlush(SingleFieldManager.java:562)&lt;br/&gt;
	at org.apache.openjpa.kernel.SingleFieldManager.preFlush(SingleFieldManager.java:478)&lt;br/&gt;
	at org.apache.openjpa.kernel.StateManagerImpl.preFlush(StateManagerImpl.java:2832)&lt;br/&gt;
	at org.apache.openjpa.kernel.PNewState.beforeFlush(PNewState.java:39)&lt;br/&gt;
	at org.apache.openjpa.kernel.StateManagerImpl.beforeFlush(StateManagerImpl.java:960)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.flushTransAdditions(BrokerImpl.java:2089)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.flushAdditions(BrokerImpl.java:2068)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.flush(BrokerImpl.java:1950)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.flushSafe(BrokerImpl.java:1909)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.beforeCompletion(BrokerImpl.java:1827)&lt;br/&gt;
	at org.apache.openjpa.kernel.LocalManagedRuntime.commit(LocalManagedRuntime.java:81)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.commit(BrokerImpl.java:1351)&lt;br/&gt;
	at org.apache.openjpa.kernel.DelegatingBroker.commit(DelegatingBroker.java:877)&lt;br/&gt;
	at org.apache.openjpa.persistence.EntityManagerImpl.commit(EntityManagerImpl.java:512)&lt;br/&gt;
	... 20 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12407487">OPENJPA-755</key>
            <summary>OpenJPA thows EntityExistsException trying persist a preexisting, detached entity</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dinkar">Dinkar Rao</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Oct 2008 05:19:16 +0000</created>
                <updated>Tue, 9 Mar 2010 18:31:02 +0000</updated>
                            <resolved>Fri, 14 Nov 2008 00:11:03 +0000</resolved>
                                                    <fixVersion>1.2.1</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-M2</fixVersion>
                                    <component>kernel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12643749" author="dinkar" created="Thu, 30 Oct 2008 05:40:36 +0000"  >&lt;p&gt;There is a check for a not-new, detached entity in SingleFieldManager:&lt;/p&gt;

&lt;p&gt;if (!_broker.isDetachedNew() &amp;amp;&amp;amp; _broker.isDetached(obj))&lt;br/&gt;
                return; // allow but ignore&lt;/p&gt;

&lt;p&gt;but this was done only for the ValueMetaData.CASCADE_NONE case. Where the preexisting, detached Item entity is encountered, the case is  ValueMetaData.CASCADE_IMMEDIATE. The check above should also be done for this condition. The runtime code path already goes through this check for Item in another place - in SingleFieldManager.persist(), when Customer is being merged. &lt;/p&gt;

&lt;p&gt;This patch adds this check for the code path through the commit() call.&lt;/p&gt;
</comment>
                            <comment id="12643751" author="dinkar" created="Thu, 30 Oct 2008 06:00:51 +0000"  >&lt;p&gt;Adding a test to verify the fix. Patch has the following files:&lt;/p&gt;

&lt;p&gt;org.apache.openjpa.persistence.detachment.model.DMItem.java&lt;br/&gt;
org.apache.openjpa.persistence.detachment.model.DMCustomerInventory.java&lt;br/&gt;
org.apache.openjpa.persistence.detachment.model.DMCustomer.java&lt;br/&gt;
org.apache.openjpa.persistence.detachment.model.TestDetachedEntityCascadePersist.java&lt;/p&gt;

&lt;p&gt;Ran the OpenJPA regression tests and also the TCK - all pass.&lt;/p&gt;</comment>
                            <comment id="12644394" author="techhusky" created="Fri, 31 Oct 2008 18:41:08 +0000"  >&lt;p&gt;Committed to trunk in r709527.&lt;/p&gt;</comment>
                            <comment id="12647479" author="fancy" created="Fri, 14 Nov 2008 00:11:03 +0000"  >&lt;p&gt;Fix applied to 1.2.x branch under r713858.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12393033" name="OPENJPA-755-test.patch" size="8801" author="dinkar" created="Thu, 30 Oct 2008 06:00:51 +0000"/>
                            <attachment id="12393032" name="OPENJPA-755.patch" size="1336" author="dinkar" created="Thu, 30 Oct 2008 05:40:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 31 Oct 2008 18:41:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161063</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt4xj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203979</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>