<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:41:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1092/OPENJPA-1092.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1092] enable test case for jpql</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1092</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Currently TestEJBQueryInterface is excluded.&lt;/p&gt;

&lt;p&gt;To enable it, just a little change is needed: invoking em.flush() after every em.persist().&lt;/p&gt;

&lt;p&gt;The test case wants to get the result depends on the order of the creation of the entity instance. but we (as well as most other JPA implementations) don&apos;t care about the creation order of java instances because the insertion happens when the transaction is committed or flush is invoked. So adding &quot;em.flush()&quot; after &quot;em.persist()&quot; will resolve the problem.&lt;/p&gt;</description>
                <environment>OS: windows XP professional &lt;br/&gt;
java version 1.5.0_14 </environment>
        <key id="12425708">OPENJPA-1092</key>
            <summary>enable test case for jpql</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikedd">Michael Dick</assignee>
                                    <reporter username="amy">Amy Yang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 May 2009 07:50:42 +0100</created>
                <updated>Thu, 2 May 2013 03:29:24 +0100</updated>
                            <resolved>Wed, 27 May 2009 15:28:16 +0100</resolved>
                                    <version>1.1.0</version>
                    <version>1.2.1</version>
                                    <fixVersion>1.2.2</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-M2</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12710298" author="amy" created="Mon, 18 May 2009 08:41:57 +0100"  >&lt;p&gt;patch attached.&lt;/p&gt;</comment>
                            <comment id="12710364" author="drwoods" created="Mon, 18 May 2009 14:36:12 +0100"  >&lt;p&gt;Amy, which branch was used to create the patch - 1.1.x, 1.2.x, trunk, ...?&lt;/p&gt;</comment>
                            <comment id="12710583" author="amy" created="Tue, 19 May 2009 03:06:58 +0100"  >&lt;p&gt;Hi Donald, i created the patch on branch 1.1.x&lt;/p&gt;</comment>
                            <comment id="12711456" author="mikedd" created="Thu, 21 May 2009 04:22:03 +0100"  >&lt;p&gt;Hi Amy, &lt;/p&gt;

&lt;p&gt;The test passes as is for me on 1.2.x, and trunk. &lt;/p&gt;

&lt;p&gt;This is with the Java 1.5 (IBM and Sun) on 64 bit Linux (x86 fwiw). Is anyone else able to reproduce this problem? &lt;/p&gt;</comment>
                            <comment id="12711938" author="amy" created="Fri, 22 May 2009 04:37:09 +0100"  >&lt;p&gt;Hi Michael,&lt;br/&gt;
The error on 1.1.x is like:&lt;br/&gt;
Tests run: 5, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 18.453 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
testSetFirstResults(org.apache.openjpa.persistence.jpql.clauses.TestEJBQueryInterface)  Time elapsed: 0.359 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
junit.framework.ComparisonFailure: expected:&amp;lt;...3&amp;gt; but was:&amp;lt;...0&amp;gt;&lt;br/&gt;
	at junit.framework.Assert.assertEquals(Assert.java:81)&lt;br/&gt;
	at junit.framework.Assert.assertEquals(Assert.java:87)&lt;br/&gt;
	at org.apache.openjpa.persistence.jpql.clauses.TestEJBQueryInterface.testSetFirstResults(TestEJBQueryInterface.java:124)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:154)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:127)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:118)&lt;br/&gt;
	at org.apache.openjpa.persistence.test.PersistenceTestCase.run(PersistenceTestCase.java:127)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:203)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
	at org.apache.maven.surefire.junit.JUnitTestSet.execute(JUnitTestSet.java:213)&lt;br/&gt;
	at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:140)&lt;br/&gt;
	at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:127)&lt;br/&gt;
	at org.apache.maven.surefire.Surefire.run(Surefire.java:177)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
	at org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:334)&lt;br/&gt;
	at org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:980)&lt;/p&gt;

&lt;p&gt;the insertion order seems random so the error changes every time.&lt;/p&gt;

&lt;p&gt;I also tried on trunk but can&apos;t reproduce the error. Do we maintain the order of the creation of java instances somewhere? &lt;/p&gt;</comment>
                            <comment id="12712148" author="kwsutter" created="Fri, 22 May 2009 17:15:52 +0100"  >&lt;p&gt;I wonder if this isn&apos;t related to the statement batching support introduced in the 1.2.x branch?  As Mike has pointed out, this works on everything past 1.2.x.  And, the statement batching support definitely affects the order of the statements being pushed out to the database.&lt;/p&gt;

&lt;p&gt;Although putting the em.flush() into the testcase may resolve this issue on 1.1.x, we would be implicitly disabling statement batching since now we&apos;re pushing out every insert to the database when first persisted.  This might accidentally cover up other useful test scenarios.  Of couse, if we just limit this testcase update to the 1.1.x branch, then that would be safer.  But, I don&apos;t like to do that just to get a testcase to pass.&lt;/p&gt;

&lt;p&gt;Instead of just modifying the testcase, I think the root cause of the problem on 1.1.x needs to be determined.  If, after that investigation, it&apos;s determined that the testcase is incorrect and needs to changed, then we have the proper background and reasons.&lt;/p&gt;

&lt;p&gt;End of my two cents worth...&lt;br/&gt;
Kevin&lt;/p&gt;</comment>
                            <comment id="12712192" author="mikedd" created="Fri, 22 May 2009 19:22:38 +0100"  >&lt;p&gt;I&apos;m guessing it&apos;s actually &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-817&quot; title=&quot;Order of inserts lost when using ConstraintUpdateManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-817&quot;&gt;&lt;del&gt;OPENJPA-817&lt;/del&gt;&lt;/a&gt; which preserves the order of statements when using constraint update manager. Absent any other information to the contrary we&apos;ll execute in the order we were called (deletes, updates, and inserts are grouped - but it&apos;s still better than no ordering). &lt;/p&gt;</comment>
                            <comment id="12712663" author="amy" created="Mon, 25 May 2009 10:05:20 +0100"  >&lt;p&gt;Hi Kevin &amp;amp; Michael,&lt;br/&gt;
thank you very much for comments.&lt;br/&gt;
I tried to merge fix of &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-817&quot; title=&quot;Order of inserts lost when using ConstraintUpdateManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-817&quot;&gt;&lt;del&gt;OPENJPA-817&lt;/del&gt;&lt;/a&gt; to branch 1.1.x and it works fine for TestEJBQueryInterface. Anyway LinkedHashMap is utilized instead of HashMap in RowManagerImpl, etc.&lt;br/&gt;
I&apos;m not sure why the fix utilizes LinkedHashSet instead of ArrayList in BrokerImpl. Michael, is it for better performance?&lt;/p&gt;</comment>
                            <comment id="12713025" author="mikedd" created="Tue, 26 May 2009 15:31:12 +0100"  >&lt;p&gt;Hi Amy,&lt;/p&gt;

&lt;p&gt;ArrayList allows duplicates, we needed an ordered collection that doesn&apos;t store the same StateManager twice.&lt;/p&gt;

&lt;p&gt;I&apos;m guessing you applied the patch from trunk (BrokerImpl.java wasn&apos;t changed in 1.2.x, or 1.0.x) but was in trunk due to &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-732&quot; title=&quot;Updates to entities via Lifecycle callback methods &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-732&quot;&gt;&lt;del&gt;OPENJPA-732&lt;/del&gt;&lt;/a&gt; (which moved from ArrayList to HashSet). &lt;/p&gt;
</comment>
                            <comment id="12713363" author="amy" created="Wed, 27 May 2009 02:37:39 +0100"  >&lt;p&gt;Hi Michael,&lt;br/&gt;
thank you very much. Got it.&lt;/p&gt;

&lt;p&gt;my last question: is it feasible to merge fix of &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-817&quot; title=&quot;Order of inserts lost when using ConstraintUpdateManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-817&quot;&gt;&lt;del&gt;OPENJPA-817&lt;/del&gt;&lt;/a&gt; to branch 1.1.x? if statement batching support is introduced in the 1.2.x branch, maybe it&apos;s ok to let the test case disabled in 1.1.x. &lt;/p&gt;</comment>
                            <comment id="12713380" author="mikedd" created="Wed, 27 May 2009 03:36:07 +0100"  >&lt;p&gt;Hi Amy,&lt;/p&gt;

&lt;p&gt;Patrick or Abe would be the person (people) to ask about merging &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-817&quot; title=&quot;Order of inserts lost when using ConstraintUpdateManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-817&quot;&gt;&lt;del&gt;OPENJPA-817&lt;/del&gt;&lt;/a&gt; to 1.1.x - they&apos;re the release managers for that branch. It would be a change in behavior and 1.1.0 was released a long time ago, it might be a bit risky to introduce at this time.&lt;/p&gt;

&lt;p&gt;I&apos;d be okay with leaving the testcase disabled too, but it&apos;s really their call. &lt;/p&gt;</comment>
                            <comment id="12713587" author="mikedd" created="Wed, 27 May 2009 15:28:16 +0100"  >&lt;p&gt;I&apos;ve enabled the testcase in all the releases that have &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-817&quot; title=&quot;Order of inserts lost when using ConstraintUpdateManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-817&quot;&gt;&lt;del&gt;OPENJPA-817&lt;/del&gt;&lt;/a&gt;, so I&apos;m marking the issue as resolved. &lt;/p&gt;

&lt;p&gt;Amy if you&apos;d like to ensure this testcase executes on 1.1, please re-open and I&apos;ll assign it to Abe / David Ezzio and let them take a look. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12405004">OPENJPA-732</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12410103">OPENJPA-817</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12408359" name="OPENJPA-1092.patch" size="1406" author="amy" created="Mon, 18 May 2009 08:41:57 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 18 May 2009 13:36:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161380</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7mzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288696</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>