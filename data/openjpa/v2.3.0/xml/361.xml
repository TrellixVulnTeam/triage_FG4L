<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:32:18 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-361/OPENJPA-361.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-361] Incorrect GREG_OFFSET offset or inconsistent usage in UUIDGenerator</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-361</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;In UUIDGenerator, GREG_OFFSET is defined as&lt;/p&gt;

&lt;p&gt;    // offset to move from 1/1/1970, which is 0-time for Java, to gregorian&lt;br/&gt;
    // 0-time 10/15/1582, and multiplier to go from 100nsec to msec units&lt;br/&gt;
    private static final long GREG_OFFSET = 0x01b21dd213814000L;&lt;/p&gt;

&lt;p&gt;This constant is used as:&lt;/p&gt;

&lt;p&gt;        // calculate time as current millis plus offset times 100 ns ticks&lt;br/&gt;
        long currentTime = (_currentMillis + GREG_OFFSET) * MILLI_MULT;&lt;/p&gt;

&lt;p&gt;Based of the usage, GREG_OFFSET should be in msec unit and this value should be&lt;/p&gt;

&lt;p&gt;    (1970-1582) * 365.25 * 24 * 3600 * 1000 (ms) = 12,219,292,800,000 (ms) = 0xB1D 069B 5400 (ms)&lt;/p&gt;

&lt;p&gt;The defined constant value 0x1b21dd213814000L is the last value in 100ns unit not ms. &lt;/p&gt;

&lt;p&gt;This also offsets the currentTime calculation off by a factor of 10**4.&lt;/p&gt;

&lt;p&gt;To correct the discrepency, either:&lt;/p&gt;

&lt;p&gt;1) GREG_OFFSET should assign the value of 0xB1D 069B 5400L instead of 0x1b2 1dd2 1381 4000L, or&lt;br/&gt;
2) long currentTime = (_currentMillis * MILLI_MULT ) + GREG_OFFSET ;&lt;/p&gt;

&lt;p&gt;Since UUID is an arbituary value, therefore I don&apos;t believe the current implementation is &quot;incorrect&quot; but just inconsistent in its implementation description. &lt;/p&gt;

&lt;p&gt;Please comment on if:&lt;br/&gt;
1) the suggested change will have any undesirable side-effect for UUID&lt;br/&gt;
2) there is any legacy/backward compatibility problem&lt;br/&gt;
3) this is worth to change at all.&lt;/p&gt;

&lt;p&gt;If there is no objection, I&apos;ll correct the &quot;problem&quot; early next week.&lt;/p&gt;

&lt;p&gt;Albert Lee.&lt;/p&gt;</description>
                <environment>All platforms</environment>
        <key id="12377845">OPENJPA-361</key>
            <summary>Incorrect GREG_OFFSET offset or inconsistent usage in UUIDGenerator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="allee8285">Albert Lee</assignee>
                                    <reporter username="allee8285">Albert Lee</reporter>
                        <labels>
                    </labels>
                <created>Sun, 9 Sep 2007 15:06:10 +0100</created>
                <updated>Tue, 30 Oct 2007 14:43:02 +0000</updated>
                            <resolved>Tue, 11 Sep 2007 14:30:01 +0100</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>lib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12526178" author="allee8285" created="Mon, 10 Sep 2007 17:02:41 +0100"  >&lt;p&gt;Change GREG_OFFSET value to match the description.&lt;/p&gt;</comment>
                            <comment id="12526250" author="kwsutter" created="Mon, 10 Sep 2007 21:09:07 +0100"  >&lt;p&gt;Looks like a good catch, Albert.  I went back and looked at the Apache Sandbox code that this implementation was based off of and, sure enough, the constant for GREG_OFFSET should have been 12,219,292,800,000 (ms) or 0xB1D 069B 5400 (ms).  We should go ahead with this change.&lt;/p&gt;</comment>
                            <comment id="12526251" author="pcl" created="Mon, 10 Sep 2007 21:16:10 +0100"  >&lt;p&gt;I&apos;m concerned about the backward-compat issue, but haven&apos;t done any analysis of it.&lt;/p&gt;</comment>
                            <comment id="12526296" author="kwsutter" created="Tue, 11 Sep 2007 00:00:43 +0100"  >&lt;p&gt;&amp;gt; I&apos;m concerned about the backward-compat issue, but haven&apos;t done any analysis of it.&lt;/p&gt;

&lt;p&gt;I don&apos;t think we have anything to worry about.  Looking at the incorrect value that was being used for the Gregorian Offset, we were basically adding somewhere around 380 years to the current time.  So, the possibility of someday matching up a new generated UUID (with the correct Gregorian offset) with an old one is next to nil.  Especially when you bring the other aspects of the UUID into play (IP, clock sequence, etc).&lt;/p&gt;

&lt;p&gt;I&apos;m going to go ahead with this commit.&lt;/p&gt;

&lt;p&gt;Kevin&lt;/p&gt;</comment>
                            <comment id="12526299" author="pcl" created="Tue, 11 Sep 2007 00:09:26 +0100"  >&lt;p&gt;Ok. But in 380 years, I&apos;m going to refer all bug reports about this to you.&lt;/p&gt;</comment>
                            <comment id="12526452" author="kwsutter" created="Tue, 11 Sep 2007 14:30:01 +0100"  >&lt;p&gt;Resolved in both trunk and the 1.0.x branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12365482" name="OPENJPA-361.patch" size="516" author="allee8285" created="Mon, 10 Sep 2007 17:02:41 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 10 Sep 2007 20:09:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160684</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7kpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288325</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>