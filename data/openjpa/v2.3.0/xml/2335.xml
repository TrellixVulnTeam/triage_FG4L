<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:44:25 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-2335/OPENJPA-2335.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-2335] Constrained foreign key column value setting needs to be flexible </title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-2335</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Should allow setting a column from default value to a non-default value. The logic had a bug.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12633067">OPENJPA-2335</key>
            <summary>Constrained foreign key column value setting needs to be flexible </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ppoddar@apache.org">Pinaki Poddar</assignee>
                                    <reporter username="ppoddar@apache.org">Pinaki Poddar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Feb 2013 20:27:56 +0000</created>
                <updated>Mon, 16 Mar 2015 21:45:45 +0000</updated>
                            <resolved>Mon, 18 Nov 2013 05:42:17 +0000</resolved>
                                                    <fixVersion>2.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13581599" author="jira-bot" created="Tue, 19 Feb 2013 20:33:15 +0000"  >&lt;p&gt;Commit 1447906 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ppoddar%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;ppoddar@apache.org&quot;&gt;Pinaki Poddar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1447906&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1447906&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2335&quot; title=&quot;Constrained foreign key column value setting needs to be flexible &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2335&quot;&gt;&lt;del&gt;OPENJPA-2335&lt;/del&gt;&lt;/a&gt;: Set non-default value to a foreign key contrained column&lt;/p&gt;</comment>
                            <comment id="13812493" author="struberg" created="Sun, 3 Nov 2013 21:19:23 +0000"  >&lt;p&gt;The change seems broken, it makes a few of my apps blow up.&lt;/p&gt;

&lt;p&gt;I do not really get the whole change. The bug description doesn&apos;t tell me why this change got done and there is also no unit test for this change to tell me what you did like to fix. &lt;/p&gt;

&lt;p&gt;I can give you my use case which is now broken&lt;/p&gt;

&lt;p&gt;Car -&amp;gt; n Inspections&lt;br/&gt;
with @OrderColumn(name = &quot;POSITION&quot;)&lt;/p&gt;

&lt;p&gt;Car c = new Car();&lt;br/&gt;
Inspection i1 = new Inspection(1, c); //Inspection adds itself to car.inspections&lt;br/&gt;
Inspection i2 = new Inspection(2, c);&lt;br/&gt;
em.persist(c).&lt;/p&gt;

&lt;p&gt;This currently blurps out with &lt;/p&gt;

&lt;p&gt;Caused by: &amp;lt;openjpa-2.3.0-r422266:1538090M fatal user error&amp;gt; org.apache.openjpa.persistence.InvalidStateException: Attempt to set column &quot;Inspection.POSITION&quot; to two different values: (class java.lang.Integer)&quot;1&quot;, (class java.lang.Integer)&quot;0&quot; This can occur when you fail to set both sides of a two-sided relation between objects, or when you map different fields to the same column, but you do not keep the values of these fields in synch.&lt;br/&gt;
        at org.apache.openjpa.jdbc.sql.PrimaryRow.setObject(PrimaryRow.java:344)&lt;br/&gt;
        at org.apache.openjpa.jdbc.sql.RowImpl.setInt(RowImpl.java:442)&lt;br/&gt;
        at org.apache.openjpa.jdbc.meta.strats.PrimitiveFieldStrategy.update(PrimitiveFieldStrategy.java:164)&lt;br/&gt;
        at org.apache.openjpa.jdbc.meta.strats.PrimitiveFieldStrategy.insert(PrimitiveFieldStrategy.java:124)&lt;br/&gt;
        at org.apache.openjpa.jdbc.meta.FieldMapping.insert(FieldMapping.java:623)&lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.insert(AbstractUpdateManager.java:238)&lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.populateRowManager(AbstractUpdateManager.java:165)&lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.flush(AbstractUpdateManager.java:96)&lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.flush(AbstractUpdateManager.java:77)&lt;/p&gt;


&lt;p&gt;It seems that the @OrderColumn is the issue in this case. Your change looks fine for primary keys, but OrderColumns and all other stuff which gets auto-managed by OpenJPA also use the same code. &lt;/p&gt;

&lt;p&gt;Maybe we should only do these checks in case of real primary or foreign keys?&lt;/p&gt;
</comment>
                            <comment id="13812497" author="jira-bot" created="Sun, 3 Nov 2013 21:28:32 +0000"  >&lt;p&gt;Commit 1538463 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=struberg&quot; class=&quot;user-hover&quot; rel=&quot;struberg&quot;&gt;Mark Struberg&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1538463&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1538463&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;rollback of openjpa 2.3.0 release&lt;/p&gt;

&lt;p&gt;We first need to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2335&quot; title=&quot;Constrained foreign key column value setting needs to be flexible &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2335&quot;&gt;&lt;del&gt;OPENJPA-2335&lt;/del&gt;&lt;/a&gt; before we can continue&lt;/p&gt;</comment>
                            <comment id="13812527" author="jira-bot" created="Mon, 4 Nov 2013 00:01:14 +0000"  >&lt;p&gt;Commit 1538480 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=struberg&quot; class=&quot;user-hover&quot; rel=&quot;struberg&quot;&gt;Mark Struberg&lt;/a&gt; in branch &apos;openjpa/branches/2.3.x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1538480&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1538480&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2335&quot; title=&quot;Constrained foreign key column value setting needs to be flexible &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2335&quot;&gt;&lt;del&gt;OPENJPA-2335&lt;/del&gt;&lt;/a&gt; add a unit test for demonstrating the bug&lt;/p&gt;</comment>
                            <comment id="13812530" author="struberg" created="Mon, 4 Nov 2013 00:12:03 +0000"  >&lt;p&gt;The issue happens if an @OrderColumn on the @OneToMany side references a (read-only) attribute in the entity. I&apos;m not really sure if this is allowed by the spec though: &lt;br/&gt;
&quot; The order column is not visible as part of the state of the entity or embeddable class.&quot;&lt;/p&gt;

&lt;p&gt;It used to work without problems in openjpa-2.2.2 though. &lt;/p&gt;

&lt;p&gt;This also seems to work fine in hibernate&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/2956171/jpa-2-0-ordercolumn-annotation-in-hibernate-3-5&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://stackoverflow.com/questions/2956171/jpa-2-0-ordercolumn-annotation-in-hibernate-3-5&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="13818070" author="jira-bot" created="Sat, 9 Nov 2013 08:21:23 +0000"  >&lt;p&gt;Commit 1540277 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=struberg&quot; class=&quot;user-hover&quot; rel=&quot;struberg&quot;&gt;Mark Struberg&lt;/a&gt; in branch &apos;openjpa/branches/2.3.x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1540277&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1540277&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2335&quot; title=&quot;Constrained foreign key column value setting needs to be flexible &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2335&quot;&gt;&lt;del&gt;OPENJPA-2335&lt;/del&gt;&lt;/a&gt; only handle key columns very restrictive&lt;/p&gt;

&lt;p&gt;There is no reason to forbid updates to other Columns like OrderColumn, etc&lt;/p&gt;</comment>
                            <comment id="13818245" author="jira-bot" created="Sat, 9 Nov 2013 19:26:48 +0000"  >&lt;p&gt;Commit 1540371 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=struberg&quot; class=&quot;user-hover&quot; rel=&quot;struberg&quot;&gt;Mark Struberg&lt;/a&gt; in branch &apos;openjpa/branches/2.3.x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1540371&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1540371&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2335&quot; title=&quot;Constrained foreign key column value setting needs to be flexible &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2335&quot;&gt;&lt;del&gt;OPENJPA-2335&lt;/del&gt;&lt;/a&gt; review test case and update checks&lt;/p&gt;</comment>
                            <comment id="14364021" author="jira-bot" created="Mon, 16 Mar 2015 21:45:45 +0000"  >&lt;p&gt;Commit 1667136 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=struberg&quot; class=&quot;user-hover&quot; rel=&quot;struberg&quot;&gt;Mark Struberg&lt;/a&gt; in branch &apos;openjpa/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1667136&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1667136&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2335&quot; title=&quot;Constrained foreign key column value setting needs to be flexible &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2335&quot;&gt;&lt;del&gt;OPENJPA-2335&lt;/del&gt;&lt;/a&gt; only handle key columns very restrictive&lt;/p&gt;

&lt;p&gt;There is no reason to forbid updates to other Columns like OrderColumn, etc&lt;br/&gt;
Ported over from 2.3.x&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12782204">OPENJPA-2573</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Feb 2013 20:33:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313563</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzbym7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313908</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>