<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:33:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1491/OPENJPA-1491.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1491] org.apache.openjpa.kernel.Bootstrap uses the application classloader to load OpenJPA internals</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1491</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;When attempting to create an EntityManagerFactory in an OSGi environment the org.apache.openjpa.kernel.Bootstrap class attempts to instantiate a BrokerFactory using reflection. When the Bootstrap class attempts to load this class it only ever uses the ClassLoader passed in by the PersistenceUnitInfo. This means that the default broker (contained within OpenJPA) can never be loaded. The client bundle should not have to import the internals of OpenJPA to make this work, so OpenJPA should attempt to load the class using its own bundle classloader. This is the expected behaviour for an OSGi bundle.&lt;/p&gt;

&lt;p&gt;Additionally, the implementation uses Class.forName() which should be used carefully in an OSGi envrionment (to see why read &lt;a href=&quot;http://blog.bjhargrave.com/2007/09/classforname-caches-defined-class-in.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://blog.bjhargrave.com/2007/09/classforname-caches-defined-class-in.html&lt;/a&gt; ). It should be fine here because the variant that takes a ClassLoader is used.&lt;/p&gt;

&lt;p&gt;The following exception is generated when OpenJPA attempts to use the application classloader to load an internal class.&lt;/p&gt;

&lt;p&gt;&amp;lt;openjpa-2.0.0-SNAPSHOT-r422266:905001 fatal user error&amp;gt; org.apache.openjpa.persistence.ArgumentException: Could not invoke the static newInstance method on the named factory class &quot;&amp;lt;&amp;lt;openjpa-2.0.0-SNAPSHOT-r422266:905001 fatal user error&amp;gt; org.apache.openjpa.util.UserException: The named BrokerFactory &quot;org.apache.openjpa.jdbc.kernel.JDBCBrokerFactory&quot; is not valid.&amp;gt;&quot;.&lt;br/&gt;
	at org.apache.openjpa.kernel.Bootstrap.newBrokerFactory(Bootstrap.java:70)&lt;br/&gt;
	at org.apache.openjpa.persistence.PersistenceProviderImpl.getBrokerFactory(PersistenceProviderImpl.java:145)&lt;br/&gt;
	at org.apache.openjpa.persistence.PersistenceProviderImpl.createContainerEntityManagerFactory(PersistenceProviderImpl.java:180)&lt;br/&gt;
	at org.apache.openjpa.persistence.PersistenceProviderImpl.createContainerEntityManagerFactory(PersistenceProviderImpl.java:62)&lt;br/&gt;
	at org.apache.aries.jpa.container.impl.EntityManagerFactoryManager.createEntityManagerFactories(EntityManagerFactoryManager.java:227)&lt;br/&gt;
	at org.apache.aries.jpa.container.impl.EntityManagerFactoryManager.bundleStateChange(EntityManagerFactoryManager.java:121)&lt;br/&gt;
	at org.apache.aries.jpa.container.impl.PersistenceBundleManager.modifiedBundle(PersistenceBundleManager.java:197)&lt;br/&gt;
	at org.apache.aries.util.tracker.MultiBundleTracker$InternalBundleTracker.modifiedBundle(MultiBundleTracker.java:108)&lt;br/&gt;
	at org.osgi.util.tracker.BundleTracker$Tracked.customizerModified(BundleTracker.java:453)&lt;br/&gt;
	at org.osgi.util.tracker.AbstractTracked.track(AbstractTracked.java:237)&lt;br/&gt;
	at org.osgi.util.tracker.BundleTracker$Tracked.bundleChanged(BundleTracker.java:413)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.BundleContextImpl.dispatchEvent(BundleContextImpl.java:916)&lt;br/&gt;
	at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:220)&lt;br/&gt;
	at org.eclipse.osgi.framework.eventmgr.ListenerQueue.dispatchEventSynchronous(ListenerQueue.java:149)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.Framework.publishBundleEventPrivileged(Framework.java:1350)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.Framework.publishBundleEvent(Framework.java:1301)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker(BundleHost.java:490)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.AbstractBundle.suspend(AbstractBundle.java:546)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.Framework.suspendBundle(Framework.java:1098)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.PackageAdminImpl.suspendBundle(PackageAdminImpl.java:314)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.PackageAdminImpl.processDelta(PackageAdminImpl.java:460)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.PackageAdminImpl.doResolveBundles(PackageAdminImpl.java:241)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.PackageAdminImpl$1.run(PackageAdminImpl.java:176)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:735)&lt;br/&gt;
Caused by: &amp;lt;openjpa-2.0.0-SNAPSHOT-r422266:905001 fatal user error&amp;gt; org.apache.openjpa.persistence.ArgumentException: The named BrokerFactory &quot;org.apache.openjpa.jdbc.kernel.JDBCBrokerFactory&quot; is not valid.&lt;br/&gt;
	at org.apache.openjpa.kernel.Bootstrap.getFactoryClass(Bootstrap.java:159)&lt;br/&gt;
	at org.apache.openjpa.kernel.Bootstrap.invokeFactory(Bootstrap.java:111)&lt;br/&gt;
	at org.apache.openjpa.kernel.Bootstrap.newBrokerFactory(Bootstrap.java:62)&lt;br/&gt;
	... 23 more&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: org.apache.openjpa.jdbc.kernel.JDBCBrokerFactory&lt;br/&gt;
	at java.lang.Class.forName(Class.java:169)&lt;br/&gt;
	at org.apache.openjpa.kernel.Bootstrap.getFactoryClass(Bootstrap.java:157)&lt;br/&gt;
	... 25 more&lt;/p&gt;</description>
                <environment>OSGi</environment>
        <key id="12454958">OPENJPA-1491</key>
            <summary>org.apache.openjpa.kernel.Bootstrap uses the application classloader to load OpenJPA internals</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="drwoods">Donald Woods</assignee>
                                    <reporter username="timothyjward">Timothy Ward</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Feb 2010 17:15:35 +0000</created>
                <updated>Tue, 11 Nov 2014 14:52:00 +0000</updated>
                            <resolved>Fri, 12 Mar 2010 21:01:18 +0000</resolved>
                                    <version>2.0.0-beta</version>
                                    <fixVersion>2.0.0-beta3</fixVersion>
                                    <component>osgi</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12844614" author="drwoods" created="Fri, 12 Mar 2010 18:57:16 +0000"  >&lt;p&gt;proposed changes to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/ARIES-158&quot; title=&quot;Undo workaround for OPENJPA-1491&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ARIES-158&quot;&gt;&lt;del&gt;ARIES-158&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12844678" author="drwoods" created="Fri, 12 Mar 2010 21:01:18 +0000"  >&lt;p&gt;trunk r922397&lt;/p&gt;</comment>
                            <comment id="12878559" author="jeanphi" created="Mon, 14 Jun 2010 13:50:29 +0100"  >&lt;p&gt;Issue seems closed and fixed in v2.0.0, but I experience this problem in the v2.0.0 relase:&lt;br/&gt;
Caused by: &amp;lt;openjpa-2.0.0-r422266:935683 fatal user error&amp;gt; org.apache.openjpa.persistence.ArgumentException: The named BrokerFactory &quot;org.apache.openjpa.jdbc.ke&lt;br/&gt;
rnel.JDBCBrokerFactory&quot; is not valid.&lt;br/&gt;
        at org.apache.openjpa.kernel.Bootstrap.getFactoryClass(Bootstrap.java:159)&lt;br/&gt;
        at org.apache.openjpa.kernel.Bootstrap.invokeFactory(Bootstrap.java:111)&lt;br/&gt;
        at org.apache.openjpa.kernel.Bootstrap.newBrokerFactory(Bootstrap.java:62)&lt;br/&gt;
        ... 30 more&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: org.apache.openjpa.jdbc.kernel.JDBCBrokerFactory&lt;br/&gt;
        at java.net.URLClassLoader$1.run(URLClassLoader.java:202)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at java.net.URLClassLoader.findClass(URLClassLoader.java:190)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:307)&lt;br/&gt;
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:248)&lt;br/&gt;
        at java.lang.Class.forName0(Native Method)&lt;br/&gt;
        at java.lang.Class.forName(Class.java:247)&lt;br/&gt;
        at org.apache.openjpa.kernel.Bootstrap.getFactoryClass(Bootstrap.java:157)&lt;br/&gt;
        ... 32 more&lt;/p&gt;

&lt;p&gt;Is this problem really fixed, or does a workaround exist?&lt;/p&gt;</comment>
                            <comment id="12878596" author="drwoods" created="Mon, 14 Jun 2010 15:42:54 +0100"  >&lt;p&gt;This fix only applies to OSGi environments where Apache Aries JPA 0.1-incubating is being used.&lt;br/&gt;
Are you trying to run OpenJPA as an OSGi bundle?  If so, are you using Apache Aries in a custom assembly or the latest Apache Geronimo 3.0-SNAPSHOT builds?&lt;/p&gt;

&lt;p&gt;To be more specific - OpenJPA does not include support for the OSGi Enterprise Specification r4 v4.2 section 127 JPA Service Specification, but relies on Apache Aries JPA (&lt;a href=&quot;http://incubator.apache.org/aries/jpaproject.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://incubator.apache.org/aries/jpaproject.html&lt;/a&gt;) which wrappers OpenJPA to deliver that support.&lt;/p&gt;</comment>
                            <comment id="12878609" author="jeanphi" created="Mon, 14 Jun 2010 16:13:55 +0100"  >&lt;p&gt;Well, I&apos;m not too sure. I&apos;m using Felix Karaf which does not come with JPA. I&apos;m using OpenJPA to provide both API and implementation of JPA.&lt;/p&gt;

&lt;p&gt;To be clear on the top of Karaf, I&apos;m putting those bundles:&lt;br/&gt;
+ OpenJPA Aggregate Jar (2.0.0)&lt;br/&gt;
+ Apache Geronimo JSR-317 JPA 2.0 Spec API (1.0)&lt;br/&gt;
+ Commons Collections (3.2.1)&lt;br/&gt;
+ Commons Lang (2.5)&lt;br/&gt;
+ Commons Pool (1.5.3)&lt;/p&gt;
</comment>
                            <comment id="12903432" author="drwoods" created="Fri, 27 Aug 2010 15:43:03 +0100"  >&lt;p&gt;You need Aries JPA + OpenJPA to support JPA on Felix - &lt;a href=&quot;http://incubator.apache.org/aries/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://incubator.apache.org/aries/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12754473">OPENJPA-2542</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12456133">ARIES-158</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12438631" name="OPENJPA-1491-trunk.patch" size="17902" author="drwoods" created="Fri, 12 Mar 2010 18:57:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 12 Mar 2010 18:57:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161755</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt6cv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204210</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>