<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:37:38 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-604/OPENJPA-604.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-604] Log spec sets in persistence unit&apos;s property fail with exception when run in different locale</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-604</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;When an application sets the Log property in a persistence unit (persistence.xml) or passes in through map during createEntityManager&lt;span class=&quot;error&quot;&gt;&amp;#91;Factory&amp;#93;&lt;/span&gt; using one locale,  this setting will fail when runs in a different locale.&lt;/p&gt;

&lt;p&gt;It is caused by the LogImpl:&lt;/p&gt;

&lt;p&gt;1) retrieve the *_STR from the localizer.properties&lt;/p&gt;

&lt;p&gt;    public static final String TRACE_STR = _loc.get(&quot;log-trace&quot;).getMessage();&lt;br/&gt;
    public static final String INFO_STR = _loc.get(&quot;log-info&quot;).getMessage();&lt;br/&gt;
    public static final String WARN_STR = _loc.get(&quot;log-warn&quot;).getMessage();&lt;br/&gt;
    public static final String ERROR_STR = _loc.get(&quot;log-error&quot;).getMessage();&lt;br/&gt;
    public static final String FATAL_STR = _loc.get(&quot;log-fatal&quot;).getMessage();&lt;/p&gt;

&lt;p&gt;2) compare only the current locale *_STR values;&lt;/p&gt;

&lt;p&gt;    public static short getLevel(String str) &lt;/p&gt;
{
        str = str.toUpperCase().trim();
        short val = TRACE_STR.equals(str) ? Log.TRACE :
            INFO_STR.equals(str) ? Log.INFO :
                WARN_STR.equals(str) ? Log.WARN :
                    ERROR_STR.equals(str) ? Log.ERROR :
                        FATAL_STR.equals(str) ? Log.FATAL : -1;

        if (val == -1)
            throw new IllegalArgumentException
                (_loc.get(&quot;log-bad-constant&quot;, str).getMessage());

        return val;
    }

&lt;p&gt;I understand the intention is to match the Log setting using the same locale, however if the Log string is set in an application&apos;s persistence unit (persistence.xml) or business logic (createEntityManagerFactory( ...., map)), the application will fail.&lt;/p&gt;

&lt;p&gt;I see two alternatives:&lt;br/&gt;
1) Since Log is part of the property and configuration framework, none of these property settings are local sensitive.  We can make Log property NOT locale sensitive, i.e. always use TRACE, INFO, WARN, ERROR and FATAL as the Log values.&lt;/p&gt;

&lt;p&gt;2) Access both English (as in alternative 1) and also whatever current locale Log values. I.e. English only Log values will work when set in persistence.xml and business logic  regardless of the current locale setting but locale specific settings ONLY work in the same current locale.&lt;/p&gt;

&lt;p&gt;Personally, the second option is more attractive and also backward compatible with existing application that uses locale specific behavior.&lt;/p&gt;

&lt;p&gt;Please comment on your preference!&lt;br/&gt;
Albert Lee.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12396325">OPENJPA-604</key>
            <summary>Log spec sets in persistence unit&apos;s property fail with exception when run in different locale</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="allee8285">Albert Lee</assignee>
                                    <reporter username="allee8285">Albert Lee</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 May 2008 16:45:50 +0100</created>
                <updated>Tue, 30 Sep 2008 17:26:14 +0100</updated>
                            <resolved>Wed, 21 May 2008 16:03:41 +0100</resolved>
                                    <version>1.0.3</version>
                    <version>1.1.0</version>
                    <version>1.2.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>lib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12598310" author="mikedd" created="Tue, 20 May 2008 15:45:55 +0100"  >&lt;p&gt;I&apos;m not sure there&apos;s a compelling use case for translated log levels. I&apos;d lean towards option 1 for code clarity and documentation purposes. &lt;/p&gt;</comment>
                            <comment id="12598332" author="clr" created="Tue, 20 May 2008 16:44:49 +0100"  >&lt;p&gt;Without having a use-case in front of me, I don&apos;t understand the value of having localized Log properties. I&apos;d prefer #1.&lt;/p&gt;</comment>
                            <comment id="12598340" author="allee8285" created="Tue, 20 May 2008 16:57:58 +0100"  >&lt;p&gt;I have the same feeling at the first glance and it was also my first choice. &lt;/p&gt;

&lt;p&gt;After some thought, I was worried about if there is any existing application that actually uses locale specific Log spec in their p.xml or Map passed to createEntityManager&lt;span class=&quot;error&quot;&gt;&amp;#91;Factory&amp;#93;&lt;/span&gt;, option 1 will break their application. Option 2 is a compromise to avoid any back compatibility breakage but still support option 1, which is the preferred behavior.&lt;/p&gt;

&lt;p&gt;If there are any strong opinions that backward compatibility is NOT a concern, I can go for option 1.&lt;/p&gt;

&lt;p&gt;Albert Lee.&lt;/p&gt;</comment>
                            <comment id="12598437" author="allee8285" created="Tue, 20 May 2008 20:54:20 +0100"  >&lt;p&gt;I shall commit option 2 patch tomorrow morning , if I don&apos;t hear any objection to this solution.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Albert Lee.&lt;/p&gt;</comment>
                            <comment id="12598654" author="allee8285" created="Wed, 21 May 2008 15:24:44 +0100"  >&lt;p&gt;The consensus is to take option 1 for its simplicity and intuitive usage.&lt;/p&gt;

&lt;p&gt;Thanks for all the input.&lt;br/&gt;
Albert Lee.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12382395" name="OPENJPA-604.opt1.patch" size="2035" author="allee8285" created="Tue, 20 May 2008 18:58:11 +0100"/>
                            <attachment id="12382396" name="OPENJPA-604.opt2.patch" size="3544" author="allee8285" created="Tue, 20 May 2008 18:58:11 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 20 May 2008 14:45:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160920</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7llb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288468</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>