<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:38:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1699/OPENJPA-1699.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1699] Streaming Lob support in DB2</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1699</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Streaming Lob support in DB2&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466929">OPENJPA-1699</key>
            <summary>Streaming Lob support in DB2</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="faywang">Fay Wang</assignee>
                                    <reporter username="faywang">Fay Wang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Jun 2010 21:35:02 +0100</created>
                <updated>Thu, 13 Jan 2011 22:09:48 +0000</updated>
                            <resolved>Thu, 13 Jan 2011 22:09:48 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>1.2.3</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12878733" author="faywang" created="Mon, 14 Jun 2010 21:35:59 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-130&quot; title=&quot;Streaming LOB support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-130&quot;&gt;&lt;del&gt;OPENJPA-130&lt;/del&gt;&lt;/a&gt;-DB2-2.patch is attached in &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-130&quot; title=&quot;Streaming LOB support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-130&quot;&gt;&lt;del&gt;OPENJPA-130&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12879480" author="milosz" created="Wed, 16 Jun 2010 20:58:10 +0100"  >&lt;p&gt;Now the patch looks much better to me. I am just still curious why the instanceof checks are needed, I don&apos;t remember seeing them in other dictionaries which support LOB streaming.&lt;/p&gt;</comment>
                            <comment id="12887491" author="faywang" created="Mon, 12 Jul 2010 20:55:04 +0100"  >&lt;p&gt;In the case of very large lob, DB2 JCC driver will automatically use progressive streaming to retrieve the Lob data. With progressiveStreaming, the inputStream retrieved (see red below) must be materialized before the next iteration of call to rs.next().&lt;/p&gt;

&lt;p&gt;ResultSet rs = pstmt.executeQuery(...);&lt;br/&gt;
while (rs.next()) &lt;/p&gt;
{
    InputStream is = rs.getBinaryInputStream(1);
    writeToFile(is);
}
&lt;p&gt;rs.close();&lt;/p&gt;

&lt;p&gt;However, in OpenJPA, we iterate through the whole resultSet and set the InputStream to respective entities:&lt;br/&gt;
ResultSet rs = pstmt.executeQuery(...);&lt;br/&gt;
while (rs.next()) &lt;/p&gt;
{
    InputStream is = rs.getBinaryInputStream(1);
    entity.setInputStream(is);
}
&lt;p&gt;rs.close();&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;	Once the entity is returned from OpenJPA, the application will get Lob Closed exception when trying to process the InputStream:&lt;/p&gt;

&lt;p&gt;writeToFile(entity.getInputStream()); &amp;lt;== Lob is closed Exception&lt;/p&gt;

&lt;p&gt;The work around is to  force fullyMaterializedLobData to true (see below) in the url, so that the DB2 JCC driver will materialize the whole Lob data into memory before returning to the application:&lt;/p&gt;

&lt;p&gt;&amp;lt;property name=&quot;openjpa.ConnectionProperties&quot;&lt;br/&gt;
value=&quot;DriverClassName=com.ibm.db2.jcc.DB2Driver,Url=jdbc:db2://localhost:50000/demodb:fullyMaterializeLobData=true;progressiveStreaming=NO;,Username=db2user,Password=passw0rd&quot; /&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12920241" author="jpaheath" created="Tue, 12 Oct 2010 16:55:45 +0100"  >&lt;p&gt;I&apos;m attaching patch named &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1699&quot; title=&quot;Streaming Lob support in DB2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1699&quot;&gt;&lt;del&gt;OPENJPA-1699&lt;/del&gt;&lt;/a&gt;-DB2-1.2.x.patch which is for 1.2.x. This is basically a back port of the changes made in truck via OJ-130, with one additional fix to LobFieldStrategy for 1.2.x.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Heath &lt;/p&gt;</comment>
                            <comment id="12920263" author="jpaheath" created="Tue, 12 Oct 2010 18:20:47 +0100"  >&lt;p&gt;I&apos;m attaching patch named &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1699&quot; title=&quot;Streaming Lob support in DB2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1699&quot;&gt;&lt;del&gt;OPENJPA-1699&lt;/del&gt;&lt;/a&gt;-DB2-2.0.x.patch which is for 2.0.x. This is basically a back port of the changes made in truck via OJ-130.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Heath&lt;/p&gt;</comment>
                            <comment id="12920804" author="jpaheath" created="Thu, 14 Oct 2010 00:18:44 +0100"  >&lt;p&gt;I&apos;m attaching patch named &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1699&quot; title=&quot;Streaming Lob support in DB2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1699&quot;&gt;&lt;del&gt;OPENJPA-1699&lt;/del&gt;&lt;/a&gt;-DB2-1.3.x.patch which is for 1.3.x. This is basically a back port of the changes made in truck via OJ-130.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Heath &lt;/p&gt;</comment>
                            <comment id="12920825" author="mikedd" created="Thu, 14 Oct 2010 02:18:59 +0100"  >&lt;p&gt;Thanks for the patches Fay and Heath. &lt;/p&gt;</comment>
                            <comment id="12924328" author="milosz" created="Sun, 24 Oct 2010 16:26:19 +0100"  >&lt;p&gt;The fullyMaterializedLobData trick should be documented under &quot;Known issues with DB2&quot; section, like it is done with other database-specific LOB streaming limitations (Oracle and MySQL for example).&lt;/p&gt;</comment>
                            <comment id="12981510" author="mikedd" created="Thu, 13 Jan 2011 22:09:48 +0000"  >&lt;p&gt;Thanks for catching the inconsistency in the docs Milosz. I&apos;ve added a bullet (tried to keep it brief) to the manual. Re-closing the issue. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12362233">OPENJPA-130</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12478933">OPENJPA-1869</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12456974" name="OPENJPA-1699-DB2-1.2.x.patch" size="4458" author="jpaheath" created="Tue, 12 Oct 2010 16:55:45 +0100"/>
                            <attachment id="12457110" name="OPENJPA-1699-DB2-1.3.x.patch" size="3106" author="jpaheath" created="Thu, 14 Oct 2010 00:18:43 +0100"/>
                            <attachment id="12456984" name="OPENJPA-1699-DB2-2.0.x.patch" size="3497" author="jpaheath" created="Tue, 12 Oct 2010 18:20:47 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Jun 2010 19:58:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161950</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysxhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202772</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>