<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:40:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1536/OPENJPA-1536.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1536] SQL with outer join cannot handle null columns when inheritance is involved</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1536</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Have the following entities:&lt;/p&gt;

&lt;p&gt;@Entity&lt;br/&gt;
@Table(name=&quot;CEmployee&quot;)&lt;br/&gt;
@Inheritance(strategy=InheritanceType.JOINED)&lt;br/&gt;
@DiscriminatorColumn(name=&quot;EMP_TYPEL&quot;, discriminatorType=DiscriminatorType.INTEGER)&lt;br/&gt;
public class Employee &lt;/p&gt;
{
    @Id
    private int id;
    
    private String lastName;
    private String firstName;

    private int vacationDays;
    
    @ManyToOne
    private Manager manager;
    
    @ManyToOne
    private Department department;
    
    @OneToOne(cascade=CascadeType.ALL)
    private CommentBlock commentBlock;
    
    @Version
    private long version;
...

}

&lt;p&gt;@Entity&lt;br/&gt;
@Table(name=&quot;CDepartment&quot;)&lt;br/&gt;
public class Department &lt;/p&gt;
{
    @Id
    private int id;
    
    private String departmentName;
    
    @ManyToOne
    private Manager departmentManager;
    
    @OneToMany(mappedBy=&quot;department&quot;)
    private List&amp;lt;Employee&amp;gt; employeeList;
...
}

&lt;p&gt;@Entity&lt;br/&gt;
@DiscriminatorValue(&quot;2&quot;)&lt;br/&gt;
public class FTEmployee extends Employee {&lt;br/&gt;
    private double salary;&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;@Entity&lt;br/&gt;
@DiscriminatorValue(&quot;3&quot;)&lt;br/&gt;
public class Manager extends FTEmployee &lt;/p&gt;
{
    @OneToMany(mappedBy=&quot;manager&quot;)
    private List&amp;lt;Employee&amp;gt; managesList;
...
}

&lt;p&gt;In the test, three departments, and 11 employees are created - 3 employees are managers, each which own a department.  Two of the managers have Manager(id=1) as their manager.&lt;br/&gt;
Manager(id=1) is the CEO so it has no manager (this value is set null.)  &lt;/p&gt;

&lt;p&gt;The problem is that a simple find for Employee(id=1) (which should return Manager(id=1)) returns null, the criteria of the SELECT fails to locate the correct row.  The SQL generated by the find is as follows:&lt;/p&gt;

&lt;p&gt;SELECT t2.EMP_TYPEL, t2.version, t3.id, t3.version, t3.lastUpdate, t4.id, t7.id, &lt;br/&gt;
t7.EMP_TYPEL, t7.version, t7.COMMENTBLOCK_ID, t7.DEPARTMENT_ID, t7.firstName, &lt;br/&gt;
t7.lastName, t7.vacationDays, t6.salary, t4.departmentName, t2.firstName, &lt;br/&gt;
t2.lastName, t10.id, t10.EMP_TYPEL, t10.version, t10.COMMENTBLOCK_ID, &lt;br/&gt;
t10.DEPARTMENT_ID, t10.firstName, t10.lastName, t10.vacationDays, t9.salary, &lt;br/&gt;
t2.vacationDays, t1.salary &lt;br/&gt;
FROM Manager t0 &lt;br/&gt;
INNER JOIN FTEmployee t1 ON t0.id = t1.id &lt;br/&gt;
INNER JOIN CEmployee t2 ON t1.id = t2.id &lt;br/&gt;
LEFT OUTER JOIN CCommentBlock t3 ON t2.COMMENTBLOCK_ID = t3.id &lt;br/&gt;
LEFT OUTER JOIN CDepartment t4 ON t2.DEPARTMENT_ID = t4.id &lt;br/&gt;
LEFT OUTER JOIN Manager t8 ON t2.MANAGER_ID = t8.id &lt;br/&gt;
LEFT OUTER JOIN Manager t5 ON t4.DEPARTMENTMANAGER_ID = t5.id &lt;br/&gt;
LEFT OUTER JOIN FTEmployee t9 ON t8.id = t9.id &lt;br/&gt;
LEFT OUTER JOIN FTEmployee t6 ON t5.id = t6.id &lt;br/&gt;
LEFT OUTER JOIN CEmployee t10 ON t9.id = t10.id &lt;br/&gt;
LEFT OUTER JOIN CEmployee t7 ON t6.id = t7.id &lt;br/&gt;
WHERE t2.EMP_TYPEL = ? AND &lt;br/&gt;
      t7.EMP_TYPEL = ? AND &lt;br/&gt;
      t10.EMP_TYPEL = ? AND &lt;br/&gt;
      t0.id = ?  optimize for 1 row &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 3, (int) 3, (int) 3, (int) 1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This 0-result sql is caused by the retrieval of the eager toOne field, Manager. &lt;br/&gt;
Note that the LEFT OUTER JOIN betweent t2 and t8 is to retrieve the Manager.&lt;br/&gt;
LEFT OUTER JOIN already takes care of possible null manager case. However, &lt;br/&gt;
the where clause did not consider the possible null manager case. &lt;br/&gt;
The correct clause should be: &lt;/p&gt;

&lt;p&gt;WHERE t2.EMP_TYPEL = ? AND &lt;br/&gt;
      (t7.EMP_TYPEL = ? OR t7.EMP_TYPEL IS NULL) AND &lt;br/&gt;
     (t10.EMP_TYPEL = ? OR t10.EMP_TYPEL IS NULL) AND &lt;br/&gt;
      t0.id = ?  optimize for 1 row &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 3, (int) 3, (int) 3, (int) 1&amp;#93;&lt;/span&gt;&lt;/p&gt;






</description>
                <environment></environment>
        <key id="12457359">OPENJPA-1536</key>
            <summary>SQL with outer join cannot handle null columns when inheritance is involved</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="faywang">Fay Wang</assignee>
                                    <reporter username="faywang">Fay Wang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Feb 2010 22:55:52 +0000</created>
                <updated>Tue, 23 Mar 2010 18:33:58 +0000</updated>
                            <resolved>Thu, 25 Feb 2010 05:08:20 +0000</resolved>
                                    <version>2.0.0-beta</version>
                    <version>2.0.0-beta2</version>
                                    <fixVersion>2.0.0-beta3</fixVersion>
                                    <component>sql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12838079" author="fancy" created="Wed, 24 Feb 2010 23:20:33 +0000"  >&lt;p&gt;Fay,&lt;br/&gt;
I have reviewed your patch, and it looks good to me.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12436918" name="OPENJPA-1536.patch" size="904" author="faywang" created="Wed, 24 Feb 2010 22:58:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 24 Feb 2010 23:20:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161799</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysxr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202816</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>