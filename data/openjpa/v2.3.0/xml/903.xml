<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:38:05 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-903/OPENJPA-903.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-903] org.apache.openjpa.persistence.exception.TestException hangs when run using PostgreSQL 8.3 database </title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-903</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Seems to be hanging in the testThrowsOptimisticException() testcase &amp;#8211; see below:&lt;/p&gt;

&lt;p&gt;-------------------------------------------------------&lt;br/&gt;
 T E S T S&lt;br/&gt;
-------------------------------------------------------&lt;br/&gt;
Running org.apache.openjpa.persistence.exception.TestException&lt;br/&gt;
31  test  INFO   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Runtime - Starting OpenJPA 2.0.0-SNAPSHOT&lt;br/&gt;
484  test  INFO   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.jdbc.JDBC - Using dictionary class &quot;org.apache.openjpa.jdbc.sql.PostgresDictionary&quot; (PostgreSQL 8.3.5 ,PostgreSQL Native Driver PostgreSQL 8.3 JDBC3 with SSL (build 603)).&lt;/p&gt;</description>
                <environment>Windows 2003 Server, maven 2.0.9, Java 1.5.0.15, PostgreSQL 8.3.5</environment>
        <key id="12414166">OPENJPA-903</key>
            <summary>org.apache.openjpa.persistence.exception.TestException hangs when run using PostgreSQL 8.3 database </summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12414167">OPENJPA-904</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mcconne">Tim McConnell</assignee>
                                    <reporter username="mcconne">Tim McConnell</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Feb 2009 01:06:46 +0000</created>
                <updated>Tue, 9 Mar 2010 18:31:08 +0000</updated>
                            <resolved>Mon, 2 Mar 2009 19:33:51 +0000</resolved>
                                    <version>2.0.0-M2</version>
                                    <fixVersion>2.0.0-M2</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12671118" author="milosz" created="Fri, 6 Feb 2009 13:15:33 +0000"  >&lt;p&gt;Tim, I remember it also hanging with some other databases, at least with Oracle (10g Express/Linux). Maybe DB2 also.&lt;/p&gt;

&lt;p&gt;It might be that it can be overcome by setting some database/driver property related to timeout or deadlock.&lt;/p&gt;
</comment>
                            <comment id="12675429" author="mcconne" created="Fri, 20 Feb 2009 18:31:45 +0000"  >&lt;p&gt;Patch attached to commit the first transaction before flushing and then committing the second transaction. This will fix the testThrowsOptimisticException testcase and prevent hangs during the maven build. Now works on Derby, DB2, Oracle, and PostgreSQL databases. &lt;/p&gt;</comment>
                            <comment id="12675725" author="allee8285" created="Sun, 22 Feb 2009 23:35:35 +0000"  >&lt;p&gt;Tim,&lt;/p&gt;

&lt;p&gt;From posting in &lt;a href=&quot;http://archives.postgresql.org/pgsql-jdbc/2002-03/msg00170.php&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://archives.postgresql.org/pgsql-jdbc/2002-03/msg00170.php&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It looks like PostgreSQL does not support query timeout. If this is true, the PostgresDictionary needs to update the &lt;br/&gt;
        supportsQueryTimeout = false;&lt;br/&gt;
in its constructor to reflect this behavior. (like the InformixDictionary)&lt;/p&gt;

&lt;p&gt;The test case is trying to validate the scenario that em2 should be blocked and time out on flush and hence the OptimisticLockException. Of course, replace the flush with commit will cause the commit to commit and therefore em2.flush will NOT block and the UPDATE statement with the same version update will result with the expected OptimisticLockException but that is not the intent of the test case.&lt;/p&gt;

&lt;p&gt;I ran TestException against DB2 on the trunk release and it works with a timeout and the expected OptLockEx..&lt;/p&gt;

&lt;p&gt;I suggest :&lt;br/&gt;
1) to validate the Postgre&apos;s query timeout behavior first and update PostgresDictionary as needed.&lt;br/&gt;
2) to figure out what databases are and are not working/hanging and correlated the queryTimeout support for each of the db.&lt;br/&gt;
3) if the condition is the test case hangs due to no timeout on executing the UPDATE, then test case can be changed to conditionally run if the db support querytimeout by testing this dictionary capability.&lt;/p&gt;

&lt;p&gt;Hope this help.&lt;br/&gt;
Albert Lee&lt;/p&gt;</comment>
                            <comment id="12675727" author="mcconne" created="Mon, 23 Feb 2009 00:12:58 +0000"  >&lt;p&gt;Hi Albert, yes it does help. Thanks much for reviewing....&lt;/p&gt;</comment>
                            <comment id="12676499" author="mcconne" created="Wed, 25 Feb 2009 04:20:28 +0000"  >&lt;p&gt;Ok, I finally see what&apos;s happening here. For this testcase to work across multiple databases, two things have to be configured correctly for each database. They are:&lt;/p&gt;

&lt;p&gt;1. A locking timeout has to be available and set for each database (or database server). For example, the default setting for Derby is derby.locks.waitTimeout=60 (i.e., 60 seconds), which is at the server level. For DB2, it can be set at a database level, but the default is LOCKTIMEOUT=-1, which disables it. Likewise for PostgreSQL the setting is at a server, not database, granularity, etc...&lt;/p&gt;

&lt;p&gt;2. The sql-error-state-codes.xml file has to be properly populated with the appropriate lock and optimistic key values that correlate the database-dependent SQL codes and states to an optimistic lock. &lt;/p&gt;

&lt;p&gt;I&apos;ll provide another patch tomorrow. Thanks&lt;/p&gt;</comment>
                            <comment id="12676854" author="mcconne" created="Thu, 26 Feb 2009 02:12:53 +0000"  >&lt;p&gt;Two patches: one for Trunk and one for the 1.2.x branch are attached to fix the problem with this testcase hanging on databases that do not support a locking timout.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12400978" name="OPENJPA-903-12x.patch" size="3507" author="mcconne" created="Thu, 26 Feb 2009 00:04:58 +0000"/>
                            <attachment id="12400984" name="OPENJPA-903-TRUNK.patch" size="2759" author="mcconne" created="Thu, 26 Feb 2009 02:12:53 +0000"/>
                            <attachment id="12400618" name="OPENJPA-903.patch" size="847" author="mcconne" created="Fri, 20 Feb 2009 18:31:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 Feb 2009 13:15:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161203</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysxan:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202742</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>