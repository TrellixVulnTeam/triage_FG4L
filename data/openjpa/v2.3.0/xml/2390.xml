<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:36:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-2390/OPENJPA-2390.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-2390] HSQLDB SELECT NEXT VALUE FOR Sequence will skip 1 sequence value if allocation size is 1</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-2390</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;The HSQLDictionary sets the DBDictionary.nextSequenceQuery to &quot;SELECT NEXT VALUE FOR &lt;/p&gt;
{0} FROM INFORMATION_SCHEMA.SYSTEM_SEQUENCES&quot; when the HSQLDictionary is initialized.&lt;br/&gt;
&lt;br/&gt;
The NativeJDBCSeq uses&lt;br/&gt;
 _select = MessageFormat.format(format, new Object[]{name, String.valueOf(_allocate * _increment)});&lt;br/&gt;
to build the select next value sql. The format is pased 2 arguments &quot;name&quot; and &quot;_allocate * _increment&quot;&lt;br/&gt;
but the second is not honored by the nextSequenceQuery.&lt;br/&gt;
&lt;br/&gt;
So when the allocation size is set to 1 the hsqldb nextSequenceQuery statement will return 2 next values&lt;br/&gt;
anyway. That is why always one next value will be skipped... 1, 3, 5, 7, and so on.&lt;br/&gt;
&lt;br/&gt;
The nextSequenceQuery should be set with an limit. E.g.&lt;br/&gt;
&quot;SELECT NEXT VALUE FOR {0}
&lt;p&gt; FROM INFORMATION_SCHEMA.SYSTEM_SEQUENCES LIMIT &lt;/p&gt;
{1}
&lt;p&gt;&quot;&lt;/p&gt;

&lt;p&gt;I will attatch an unit test that uses in memory hsqldb to show the problem soon.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12649901">OPENJPA-2390</key>
            <summary>HSQLDB SELECT NEXT VALUE FOR Sequence will skip 1 sequence value if allocation size is 1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="allee8285">Albert Lee</assignee>
                                    <reporter username="rene.link">Ren&#233; Link</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 May 2013 13:40:07 +0100</created>
                <updated>Mon, 24 Jun 2013 18:11:55 +0100</updated>
                            <resolved>Mon, 24 Jun 2013 18:11:55 +0100</resolved>
                                    <version>2.2.1</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13669197" author="rene.link" created="Wed, 29 May 2013 13:41:11 +0100"  >&lt;p&gt;The attatched tests shows the problem I described in the Issue.&lt;/p&gt;</comment>
                            <comment id="13688364" author="dlau" created="Wed, 19 Jun 2013 20:52:03 +0100"  >&lt;p&gt;Problem is fixed by adding LIMIT 1 to the nextSequenceQuery String in HSQLDictionary. This force the sequence to hand back only 1 value at a time. &lt;/p&gt;

&lt;p&gt;Any version that is lower than 2.1.0 does not need to add LIMIT 1. The older versions do not have the skipping problem.&lt;/p&gt;

&lt;p&gt;To make the code more compatible, I added some conditions in HSQLDictionary to check the HSQL versions so that only version 2.1.0 and beyond will add LIMIT 1 to the nextSequenceQuery.&lt;/p&gt;

&lt;p&gt;Uploadded is my patch file. In this file, I added two test cases that use allocationSize=1 and allocationSize=2 to demonstrate the problem.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13692148" author="jira-bot" created="Mon, 24 Jun 2013 18:05:05 +0100"  >&lt;p&gt;Commit 1496124 from allee8285@apache.org&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1496124&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1496124&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2390&quot; title=&quot;HSQLDB SELECT NEXT VALUE FOR Sequence will skip 1 sequence value if allocation size is 1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2390&quot;&gt;&lt;del&gt;OPENJPA-2390&lt;/del&gt;&lt;/a&gt; - commit patch contributed by Di Lau.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12585191" name="HSQLSequenceTest.java" size="1912" author="rene.link" created="Wed, 29 May 2013 13:41:11 +0100"/>
                            <attachment id="12588671" name="OPENJPA-2390.patch" size="12172" author="dlau" created="Wed, 19 Jun 2013 20:52:03 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 19 Jun 2013 19:52:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>330228</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzetcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>330562</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>