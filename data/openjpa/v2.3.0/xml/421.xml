<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:40:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-421/OPENJPA-421.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-421] OpenJPA generates bad SQL before configuration fully populated</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-421</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;When openjpa.jdbc.DBDictionary is set in persistence.xml file, OpenJPA creates a new DBDictionary instance by loading the class specified in the properties without trying to connect to database.   It leaves version related configuration unset until the first connection to the database and creates the window of referencing partial properties in the DBDictionary.  The problem happens when the first sql statement gets constructed within this window with lack of the knowledge of the version of the database.&lt;/p&gt;

&lt;p&gt;For example, with the setting that described below, BIGINT was generated in the&lt;br/&gt;
SQL statement to be run on DB2 z/OS V8 and failed to execute because BIGINT was not supported on that version of z/OS DB2.&lt;/p&gt;

&lt;p&gt;1. commenting out the setting of &quot;openjpa.jdbc.SynchronizeMappings&quot;.&lt;br/&gt;
2. configure the connection properties to a z/OS database&lt;br/&gt;
3. issuing a statement similar to the following to generate SQL statement with&lt;br/&gt;
   &quot;CAST(? AS BIGINT)&quot;.&lt;/p&gt;

&lt;p&gt;Here is the testcase that I use to create the problem:&lt;br/&gt;
{&lt;br/&gt;
    EntityManagerFactory emf1 = &lt;br/&gt;
        Persistence.createEntityManagerFactory(&quot;demo&quot;);&lt;br/&gt;
    EntityManager em1 = emf1.createEntityManager();&lt;br/&gt;
    em1.getTransaction().begin();&lt;br/&gt;
    Order o3 = (Order) em1.createQuery(&lt;br/&gt;
        &quot;select o from Order o where o.oid = 68&quot;).getSingleResult();&lt;br/&gt;
    ...&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;==&amp;gt;&lt;br/&gt;
  SELECT t0.oid, t0.version, t0.amount, t0.delivered FROM Order t0&lt;br/&gt;
    WHERE (t0.oid = CAST(? AS BIGINT)) optimize for 1 row &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(long) 68&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12381285">OPENJPA-421</key>
            <summary>OpenJPA generates bad SQL before configuration fully populated</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dtlee">Daniel Lee</assignee>
                                    <reporter username="dtlee">Daniel Lee</reporter>
                        <labels>
                    </labels>
                <created>Sat, 27 Oct 2007 01:35:24 +0100</created>
                <updated>Tue, 9 Mar 2010 18:32:41 +0000</updated>
                            <resolved>Mon, 29 Oct 2007 20:13:42 +0000</resolved>
                                    <version>1.0.0</version>
                    <version>1.0.1</version>
                    <version>1.1.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12538157" author="dtlee" created="Sat, 27 Oct 2007 01:46:25 +0100"  >&lt;p&gt;This patch applies to both trunk and branch.&lt;/p&gt;</comment>
                            <comment id="12538244" author="clr" created="Sat, 27 Oct 2007 20:00:50 +0100"  >&lt;p&gt;Minor formatting issue.&lt;br/&gt;
+                conn = ds.getConnection(conf.getConnectionUserName()&lt;br/&gt;
+                        , conf.getConnectionPassword());&lt;br/&gt;
+            else&lt;br/&gt;
+                conn = ds.getConnection(conf.getConnection2UserName()&lt;br/&gt;
+                        , conf.getConnection2Password());&lt;/p&gt;

&lt;p&gt;should be&lt;br/&gt;
+                conn = ds.getConnection(conf.getConnectionUserName(),&lt;br/&gt;
+                        conf.getConnectionPassword());&lt;br/&gt;
+            else&lt;br/&gt;
+                conn = ds.getConnection(conf.getConnection2UserName(),&lt;br/&gt;
+                        conf.getConnection2Password());&lt;/p&gt;

&lt;p&gt;I&apos;d like to see a comment when swallowing a possible exception closing the connection. Since swallowing exceptions generally is bad practice, it would help to comment...&lt;br/&gt;
+                try &lt;/p&gt;
{
+                    conn.close();
+                }
&lt;p&gt; catch (SQLException se) &lt;/p&gt;
{
// ignore any exception since the connection is not going to be used anyway
+                }</comment>
                            <comment id="12538501" author="kwsutter" created="Mon, 29 Oct 2007 13:37:35 +0000"  >&lt;p&gt;Something seems to be wrong with this patch...  Not sure how Craig can see it okay.  It&apos;s formatted funny.  And, when I attempt to apply it to my project, I get an &quot;invalid patch format&quot; error.&lt;/p&gt;</comment>
                            <comment id="12538531" author="mikedd" created="Mon, 29 Oct 2007 16:06:32 +0000"  >&lt;p&gt;I think I&apos;ve fixed the patch (it works for me on Linux at least). Attaching the updated patch.&lt;/p&gt;</comment>
                            <comment id="12538533" author="kwsutter" created="Mon, 29 Oct 2007 16:19:31 +0000"  >&lt;p&gt;Okay, I was able to cut-and-paste my way to happiness with this patch...  But, in the future, we need to ensure that patches posted to JIRA issues are readable and appliable.  Thanks.  I will be committing the changes soon...&lt;/p&gt;</comment>
                            <comment id="12538541" author="dtlee" created="Mon, 29 Oct 2007 16:54:42 +0000"  >&lt;p&gt;notepad reads it okay but not emacs.  emacs will be used in addition to verify the patch in the future.&lt;/p&gt;</comment>
                            <comment id="12538542" author="dtlee" created="Mon, 29 Oct 2007 16:55:16 +0000"  >&lt;p&gt;Thanks for the correction.&lt;/p&gt;</comment>
                            <comment id="12538573" author="kwsutter" created="Mon, 29 Oct 2007 20:13:42 +0000"  >&lt;p&gt;Resolved via SVN #589723 for 1.0.1 and 1.1.0 branches.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12368609" name="OPENJPA-421.patch" size="2631" author="mikedd" created="Mon, 29 Oct 2007 16:06:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 27 Oct 2007 19:00:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160743</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyszc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203073</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>