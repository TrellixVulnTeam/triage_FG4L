<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:37:30 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1025/OPENJPA-1025.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1025] AbstractResultList.subList throws UnsupportedOperationException</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1025</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;AbstractResultList implements the basics for readonly result lists. When calling the subList(int,int) method, the following exception is raised:&lt;/p&gt;

&lt;p&gt;    java.lang.UnsupportedOperationException&lt;br/&gt;
    at org.apache.openjpa.lib.rop.AbstractResultList.subList(AbstractResultList.java:84)&lt;br/&gt;
    at org.apache.openjpa.kernel.DelegatingResultList.subList(DelegatingResultList.java:308)&lt;br/&gt;
    ...&lt;/p&gt;

&lt;p&gt;Since the subList() method contract is to create a new List from the ResultList, this operation does not modify the original list: it only provides a &lt;b&gt;view&lt;/b&gt; on the original list (see &lt;a href=&quot;http://java.sun.com/docs/books/tutorial/collections/interfaces/list.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/docs/books/tutorial/collections/interfaces/list.html&lt;/a&gt; ). &lt;/p&gt;

&lt;p&gt;This problem is also found by other users: &lt;a href=&quot;http://n2.nabble.com/DelegatingResultList.subList-not-implemented--td210389.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://n2.nabble.com/DelegatingResultList.subList-not-implemented--td210389.html&lt;/a&gt;&lt;br/&gt;
They found the (bad) workaround to build a new List (bad because this is not the same as calling subList()):&lt;/p&gt;

&lt;p&gt;    List mySubList = new ArrayList(openjpaList).subList(from, to);&lt;/p&gt;

&lt;p&gt;The AbstractResultList class should be modified by one of this solution (sorted by decreasing preference order):&lt;br/&gt;
1) the AbstractResultList class should extends java.util.AbstractList and the subList() method should be removed (because implemented by AbstractList)&lt;br/&gt;
2) the subList() method should be implemented to return a view on the original list. See java.util.AbstractList for an implementation (&lt;a href=&quot;http://www.koders.com/java/fidCFCB47A1819AB345234CC04B6A1EA7554C2C17C0.aspx?s=iso+3166&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.koders.com/java/fidCFCB47A1819AB345234CC04B6A1EA7554C2C17C0.aspx?s=iso+3166&lt;/a&gt; )&lt;br/&gt;
3) the subList() method should throw the exception with the message &quot;this method is not yet implemented. Workaround: new ArrayList(openjpaList).subList(from, to)&quot;&lt;/p&gt;</description>
                <environment>&lt;a href=&quot;http://svn.apache.org/viewvc/openjpa/trunk/openjpa-lib/src/main/java/org/apache/openjpa/lib/rop/AbstractResultList.java?revision=757278&amp;view=markup,&quot;&gt;http://svn.apache.org/viewvc/openjpa/trunk/openjpa-lib/src/main/java/org/apache/openjpa/lib/rop/AbstractResultList.java?revision=757278&amp;amp;view=markup,&lt;/a&gt;&lt;br/&gt;
Seam 2.0, OpenJPA 1.2.1</environment>
        <key id="12422203">OPENJPA-1025</key>
            <summary>AbstractResultList.subList throws UnsupportedOperationException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bjreed">B.J. Reed</assignee>
                                    <reporter username="jkronegg">Julien Kronegg</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Apr 2009 08:13:37 +0100</created>
                <updated>Tue, 9 Mar 2010 18:31:13 +0000</updated>
                            <resolved>Thu, 30 Apr 2009 16:45:38 +0100</resolved>
                                    <version>1.2.1</version>
                    <version>1.3.0</version>
                    <version>2.0.0-M2</version>
                                    <fixVersion>1.0.4</fixVersion>
                    <fixVersion>1.2.2</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-beta</fixVersion>
                                    <component>lib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <timeoriginalestimate seconds="14400">4h</timeoriginalestimate>
                            <timeestimate seconds="14400">4h</timeestimate>
                                        <comments>
                            <comment id="12700876" author="bjreed" created="Mon, 20 Apr 2009 18:35:33 +0100"  >&lt;p&gt;Attaching patch &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1025&quot; title=&quot;AbstractResultList.subList throws UnsupportedOperationException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1025&quot;&gt;&lt;del&gt;OPENJPA-1025&lt;/del&gt;&lt;/a&gt;.patch.  Update AbstractResultList to not implement subList, which forces subclasses to implement subList.  Update 3 classes that extend AbstractResultList to implement subList and return the proper List.&lt;/p&gt;</comment>
                            <comment id="12701067" author="jkronegg" created="Tue, 21 Apr 2009 07:02:37 +0100"  >&lt;p&gt;I&apos;m not sure about the patch content for AbstractNonSequentialResultList ( &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12405947/OPENJPA-1025.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12405947/OPENJPA-1025.patch&lt;/a&gt; ). In this class, the workaround &quot;new ArrayList()&quot; is used.&lt;br/&gt;
The List.subList(int,int) contract is to provide a view on the original list, not a shallow copy (see &quot;Range-View Operation&quot; section in &lt;a href=&quot;http://java.sun.com/docs/books/tutorial/collections/interfaces/list.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/docs/books/tutorial/collections/interfaces/list.html&lt;/a&gt; ). Thus, operations on the subList are in fact done on the original List.&lt;/p&gt;

&lt;p&gt;Let&apos;s try with the following code:&lt;/p&gt;

&lt;p&gt;    myAbstractNonSequentialResultList.subList(first, last).add(myElement);&lt;/p&gt;

&lt;p&gt;If the AbstractNonSequentialResultList class implements the List.subList contract correctly, this should raise an exception because the underlying AbstractResultList is read only (this is the expected result). But with the patch, the above code works correctly and the programmer may think that the underlying List has been modified, while it has still the same number of elements.&lt;/p&gt;

&lt;p&gt;So IMHO, the patch is correct, except for class AbstractNonSequentialResultList which should use a true view of the original List and not a shallow copy. For this class, I see 3 solutions:&lt;br/&gt;
1) the subList method return a true &lt;b&gt;view&lt;/b&gt; of the original List and not a shallow copy: this would be the best solution (See java.util.AbstractList for an implementation)&lt;br/&gt;
2) the subList method throws a &quot;not implemented exception&quot;: this would be a quickfix (I&apos;m not sure it would solve the issue)&lt;br/&gt;
3) the subList method return a shallow copy of the original List (i.e. new ArrayList()): this solution is not desirable because it does not respect the List.subList contract as described above.&lt;/p&gt;
</comment>
                            <comment id="12701154" author="bjreed" created="Tue, 21 Apr 2009 14:41:32 +0100"  >&lt;p&gt;Thanks for the quick review Julien.&lt;/p&gt;

&lt;p&gt;Attaching &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1025&quot; title=&quot;AbstractResultList.subList throws UnsupportedOperationException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1025&quot;&gt;&lt;del&gt;OPENJPA-1025&lt;/del&gt;&lt;/a&gt;b.patch.  For the AbstractNonSequentialResultList case, I think we&apos;re going to have to just throw a &quot;not implemented exception&quot;.  The concrete classes for this use Object[] underneath in stead of a List.  I don&apos;t know of a way to create a List &quot;view&quot; on to an Object[] and I agree that an exception would be better than returning a modifiable List.  Also, logically, I really wasn&apos;t sure that getting a sub list on an object that is &quot;non sequential&quot; was really a good idea - doesn&apos;t seem like the data would be consistently returned.&lt;/p&gt;</comment>
                            <comment id="12701178" author="bjreed" created="Tue, 21 Apr 2009 16:28:11 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1025&quot; title=&quot;AbstractResultList.subList throws UnsupportedOperationException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1025&quot;&gt;&lt;del&gt;OPENJPA-1025&lt;/del&gt;&lt;/a&gt;-withTest.patch includes the code changes from 1025b.patch and an update to the ResultListTest to verify if subList is a supported method or not for each kind of AbstractResultList.&lt;/p&gt;</comment>
                            <comment id="12701495" author="jkronegg" created="Wed, 22 Apr 2009 12:52:21 +0100"  >&lt;p&gt;I applied &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12406031/OPENJPA-1025b.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12406031/OPENJPA-1025b.patch&lt;/a&gt; : the UnsupportedOperationException is not raised anymore when using subList in my application (Seam CRUD application&apos;s EntityList.xhtml).&lt;br/&gt;
Thanks B.J., you can apply the patch as a solution.&lt;/p&gt;</comment>
                            <comment id="12704651" author="mikedd" created="Thu, 30 Apr 2009 15:45:47 +0100"  >&lt;p&gt;I&apos;m not sure removing the method from AbstractList is the best solution for released versions since we could break downstream consumers. Merely overriding the subList method in the appropriate subclasses seems like a better solution in this case. &lt;/p&gt;</comment>
                            <comment id="12704911" author="jkronegg" created="Fri, 1 May 2009 08:28:29 +0100"  >&lt;p&gt;I agree. The subList method can be kept in AbstractResultList (BTW it&apos;s not AbstractList) and the subclasses overriden subList method will be called.&lt;br/&gt;
This is a more &quot;backward compatible&quot; fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12406035" name="OPENJPA-1025-withTest.patch" size="6150" author="bjreed" created="Tue, 21 Apr 2009 16:28:10 +0100"/>
                            <attachment id="12405947" name="OPENJPA-1025.patch" size="3022" author="bjreed" created="Mon, 20 Apr 2009 18:35:33 +0100"/>
                            <attachment id="12406031" name="OPENJPA-1025b.patch" size="2845" author="bjreed" created="Tue, 21 Apr 2009 14:41:32 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 20 Apr 2009 17:35:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161319</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt69r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204196</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>