<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:41:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-677/OPENJPA-677.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-677] Single Table Inheritance Strategy causes entity identity issues</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-677</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Entity objects that are pulled out from the database using bean methods (get*()) are not the same objects that are pulled out using using other methods(find(), getReference()). &lt;/p&gt;

&lt;p&gt;This occurs only when using Single Table Inheritance.&lt;/p&gt;

&lt;p&gt;This works on 0.9.7, in other versions Exception is thrown (&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-494&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OPENJPA-494&lt;/a&gt;) , in latest version from trunk test fails.&lt;/p&gt;</description>
                <environment>IBM Java 1.5</environment>
        <key id="12401800">OPENJPA-677</key>
            <summary>Single Table Inheritance Strategy causes entity identity issues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ppoddar@apache.org">Pinaki Poddar</assignee>
                                    <reporter username="corp">Przemek Koprowski</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Aug 2008 17:14:28 +0100</created>
                <updated>Wed, 21 Sep 2011 16:09:07 +0100</updated>
                            <resolved>Wed, 21 Sep 2011 16:09:07 +0100</resolved>
                                    <version>1.1.0</version>
                    <version>1.1.1</version>
                    <version>1.2.0</version>
                    <version>1.2.1</version>
                    <version>1.3.0</version>
                                    <fixVersion>1.2.3</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-M1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12620302" author="corp" created="Wed, 6 Aug 2008 17:15:41 +0100"  >&lt;p&gt;In order to run tests:&lt;br/&gt;
1. Add OpenJPA libraries to the build path.&lt;br/&gt;
2. Change the path in the build.properties file.&lt;br/&gt;
3. Run the enchanceWorkspaceAndDeleteDB task from build.xml.&lt;/p&gt;</comment>
                            <comment id="12620858" author="ppoddar@apache.org" created="Fri, 8 Aug 2008 07:46:26 +0100"  >&lt;p&gt;The bug is reproducible.&lt;/p&gt;

&lt;p&gt;The workaround is to change RegularUsr.admin field from lazily loaded to eagerly loaded.&lt;/p&gt;

&lt;p&gt;The bug seems to be how OpenJPA determines the concrete type of a relation from the record row data and the discrimnator column. In this case&lt;br/&gt;
mysql&amp;gt; select * from computeruser;&lt;br/&gt;
---------------------------------------&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; oid   DTYPE    ADMIN_OID &lt;br/&gt;
---------------------------------------&lt;br/&gt;
 101     admin       NULL &lt;br/&gt;
 102     user           101 &lt;br/&gt;
---------------------------------------&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;During load of row 102, i.e. &apos;102 &apos;user&apos; 101&apos;, OpenJPA tries to store a FK (pointing to Admin) for the row 102 (which represents a RegularUser).&lt;br/&gt;
However, because the row&apos;s discrimnator value is &apos;user&apos;, OpenJPA wrongly assumes that 101 is identifier for RegularUser and that is the oid is store intermediately in RegularUser-102&apos;s admin field.&lt;/p&gt;

&lt;p&gt;Later when OpenJPA reads the full row 101, (say for find()) it does construct a Admin-102 instance but that other identifier has created a different Admin object  and hence the error.&lt;/p&gt;

&lt;p&gt;Eager loading gets rid of the problem because then both the rows are read in a single query and the ambiguity of discriminator value  does not arise.&lt;/p&gt;</comment>
                            <comment id="12620874" author="ppoddar@apache.org" created="Fri, 8 Aug 2008 09:11:52 +0100"  >&lt;p&gt;This is an intermediate (and inaccurate) fix for the problem.&lt;br/&gt;
This will only work when the most-derived class is target of a relation.&lt;br/&gt;
For example, declared type of RegularUser.admin is Admin which is the most-derived class in this case and hence only the fix works. Otherwise, most likely it will show the same error.&lt;/p&gt;

&lt;p&gt;Will attempt to put a more comprehensive fix &lt;/p&gt;</comment>
                            <comment id="12620879" author="ppoddar@apache.org" created="Fri, 8 Aug 2008 10:00:37 +0100"  >&lt;p&gt;The later fix is more general. Please confirm if this fix resolves the reported issue or not.&lt;/p&gt;</comment>
                            <comment id="12621987" author="corp" created="Tue, 12 Aug 2008 22:25:15 +0100"  >&lt;p&gt;Thank you.&lt;/p&gt;</comment>
                            <comment id="13011253" author="mikedd" created="Fri, 25 Mar 2011 16:02:59 +0000"  >&lt;p&gt;Trunk was 1.3.0-SNAPSHOT when this was committed. &lt;/p&gt;</comment>
                            <comment id="13109563" author="mikedd" created="Wed, 21 Sep 2011 16:09:07 +0100"  >&lt;p&gt;Closing issues which have code changes and have not been modified for a while. &lt;/p&gt;

&lt;p&gt;If there is more work to be done for this issue please check whether it has already been included in an OpenJPA release. &lt;/p&gt;

&lt;p&gt;If the changes are in an OpenJPA release please open a new issue and link to this one. &lt;/p&gt;

&lt;p&gt;If the changes are not in an OpenJPA release you may reopen this issue or create a new issue. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12387654" name="TestJPAIdentityWhenSingleTable.zip" size="12966" author="corp" created="Wed, 6 Aug 2008 17:15:41 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 8 Aug 2008 06:46:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59913</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysvh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202447</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>