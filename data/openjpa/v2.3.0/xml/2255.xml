<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:45:32 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-2255/OPENJPA-2255.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-2255] Couldn&apos;t load the referencedColumn definition when create the JoinTable</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-2255</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;The JoinColumn couldn&apos;t have the referencedColumn&apos;s definition which includes the length definition. and it&apos;s length  should be assigned to the default value 255. &lt;/p&gt;


&lt;p&gt;@Entity &lt;br/&gt;
public class Student { &lt;br/&gt;
  @Id @Column(name=&quot;id&quot;, length=128, nullable=false) private String id; &lt;br/&gt;
  @Column(name=&quot;sName&quot;, length=255) private String sName; &lt;br/&gt;
  @ManyToMany &lt;br/&gt;
  @JoinTable( &lt;br/&gt;
    name=&quot;student_course_map&quot;, &lt;br/&gt;
    joinColumns=&lt;/p&gt;
{@JoinColumn(name=&quot;student_id&quot;, referencedColumnName=&quot;id&quot;, nullable=false)}
&lt;p&gt;, &lt;br/&gt;
    inverseJoinColumns=&lt;/p&gt;
{@JoinColumn(name=&quot;course_id&quot;, referencedColumnName=&quot;id&quot;, nullable=false)}
&lt;p&gt; &lt;br/&gt;
  ) &lt;br/&gt;
  public Collection getCourses() &lt;/p&gt;

&lt;p&gt;  ... &lt;br/&gt;
} &lt;/p&gt;

&lt;p&gt;@Entity &lt;br/&gt;
public class Courses&lt;/p&gt;
{ 
  @Id @Column(name=&quot;id&quot;, length=128, nullable=false) private String id; 
  @Column(name=&quot;cName&quot;, length=255) private String cName; 

  ... 
}
&lt;p&gt; &lt;/p&gt;

&lt;p&gt;We can see the student id length has been defined to 128. And there is no definition length in the JoinColumn student_id. The JoinColumn should be set to the default value 255. &lt;/p&gt;

&lt;p&gt;The warning message will occur like this &lt;/p&gt;

&lt;p&gt;WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;Schema&amp;#93;&lt;/span&gt; Existing column &quot;student_id&quot; on table &quot;test.student_course_map&quot; is incompatible with the same column in the given schema definition. Existing column: &lt;br/&gt;
Full Name: student_course_map.student_id &lt;br/&gt;
Type: varchar &lt;br/&gt;
Size: 128 &lt;br/&gt;
Default: null &lt;br/&gt;
Not Null: true &lt;br/&gt;
Given column: &lt;br/&gt;
Full Name: student_course_map.student_id &lt;br/&gt;
Type: varchar &lt;br/&gt;
Size: 255 &lt;br/&gt;
Default: null &lt;br/&gt;
Not Null: true &lt;/p&gt;</description>
                <environment></environment>
        <key id="12605631">OPENJPA-2255</key>
            <summary>Couldn&apos;t load the referencedColumn definition when create the JoinTable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="allee8285">Albert Lee</assignee>
                                    <reporter username="gary">xiezhi</reporter>
                        <labels>
                            <label>documentation</label>
                            <label>patch</label>
                    </labels>
                <created>Fri, 31 Aug 2012 02:15:52 +0100</created>
                <updated>Tue, 11 Sep 2012 16:16:35 +0100</updated>
                            <resolved>Tue, 11 Sep 2012 16:16:35 +0100</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>jpa</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13446431" author="allee8285" created="Fri, 31 Aug 2012 23:06:34 +0100"  >&lt;p&gt;This problem only happens when &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@JoinTable is specified in the entity.&lt;/li&gt;
	&lt;li&gt;String type entity identity field&lt;/li&gt;
	&lt;li&gt;database table is created with join column id with length other than the database specific column length.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This problem also affects the Mapping tool creating database table operation, always assume database defect VARCHAR/CHAR length define in the database dictionary.&lt;/p&gt;

&lt;p&gt;Attached a patch for trunk. Please try if this has resolved your issue. &lt;/p&gt;

&lt;p&gt;For fix/commit for 2.2.x, 2.1.x and 2.0.x releases, you will need to work with IBM service channel to get this fix in these releases.&lt;/p&gt;

&lt;p&gt;Albert Lee.&lt;/p&gt;</comment>
                            <comment id="13448409" author="gary" created="Wed, 5 Sep 2012 03:39:05 +0100"  >&lt;p&gt;Thanks,Albert. I got your patch, and apply it into my server (geronimo-tomcat7-javaee6-3.0.0), The warning message mentioned in the jira did disappear, but another message occurred. Same message, same problem. But the difference is the column is defined in ManyToOne annotation.&lt;/p&gt;

&lt;p&gt;The source is below.&lt;/p&gt;

&lt;p&gt; @ManyToOne(optional=true, cascade=&lt;/p&gt;
{CascadeType.PERSIST, CascadeType.MERGE}
&lt;p&gt;) @JoinColumn(name=&quot;classField&quot;) private Location schoolField;&lt;/p&gt;

&lt;p&gt;The message is below.&lt;/p&gt;

&lt;p&gt;2012-09-05 09:19:58,293 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;Schema&amp;#93;&lt;/span&gt; Existing column &quot;classField&quot; on table &quot;test.classField&quot; is incompatible with the same column in the&lt;br/&gt;
 given schema definition. Existing column:&lt;br/&gt;
Full Name: classes.classField&lt;br/&gt;
Type: varchar&lt;br/&gt;
Size: 255&lt;br/&gt;
Default: null&lt;br/&gt;
Not Null: false&lt;br/&gt;
Given column:&lt;br/&gt;
Full Name: classes.classField&lt;br/&gt;
Type: varchar&lt;br/&gt;
Size: 128&lt;br/&gt;
Default: null&lt;br/&gt;
Not Null: false&lt;/p&gt;</comment>
                            <comment id="13449132" author="allee8285" created="Wed, 5 Sep 2012 22:04:57 +0100"  >&lt;p&gt;XieZhi,&lt;/p&gt;

&lt;p&gt;Can you provide a more concrete test case and the conditions reproducing the failure?&lt;/p&gt;
</comment>
                            <comment id="13449778" author="allee8285" created="Thu, 6 Sep 2012 17:25:16 +0100"  >&lt;p&gt;I don&apos;t think the new message is in error.&lt;/p&gt;

&lt;p&gt;What the message saying is the classField in the database has column length 255 and whereas the id field of the @OneToMany side has column length 128. This means OpenJPA recognized the length=128 set on the id field. Before the patch, join column did not pick up the id column length and defaulted to 255, therefore this message did not happened. Either the id column has to match the join column length or the join column length need to match the id length.  &lt;/p&gt;

&lt;p&gt;This is just the reverse of the original scenario.&lt;/p&gt;

&lt;p&gt;Albert Lee.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12543347" name="OPENJPA-2255.patch" size="716" author="allee8285" created="Fri, 31 Aug 2012 22:54:38 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 31 Aug 2012 22:06:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>240111</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hxurxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3344</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>