<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:32:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-367/OPENJPA-367.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-367] PCEnhancer does not find meta data for entities using pure XML annotation</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-367</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;When an entity is defined using pure XML (i.e. no annotation in the entity class), the enhancer does not recognized the meta data and no enhancing will take place: E.g.&lt;/p&gt;

&lt;p&gt;-----------------------------------------&lt;br/&gt;
C:\temp\test&amp;gt;runPcEnhancer.bat&lt;/p&gt;

&lt;p&gt;C:\temp\test&amp;gt;java -cp C:\temp\test\;C:\temp\test\openjpa-1.1.0-SNAPSHOT.jar;C:\temp\test\utils.jar;C:\temp\test\geronimo-jpa_3.0_spec-1.0.jar;C:\temp\test\geronimo-jta_1.1_spec-1.1.jar org.apache.openjpa.enhance.PCEnhancer&lt;br/&gt;
15  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Runtime - Setting the following properties from &quot;file:/C:/temp/test/META-INF/persistence.xml&quot; into configuration: &lt;/p&gt;
{openjpa.Id=EntityUnit_JSE, openjpa.Log=DefaultLevel=TRACE, openjpa.MetaDataFactory=jpa(Resources=META-INF/jpamappings.xml, Types=test.XMLDatatypeSupportTestEntity)}&lt;br/&gt;
31  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Runtime - No cache marshaller found for id org.apache.openjpa.conf.MetaDataCacheMaintenance.&lt;br/&gt;
47  EntityUnit_JSE  INFO   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Tool - No targets were given.  Running on all classes in your persistent classes list, or all metadata files in classpath directories if you have not listed your persistent classes.  Use -help to display tool usage information.&lt;br/&gt;
62  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Scanning resource &quot;META-INF/jpamappings.xml&quot; for persistent types.&lt;br/&gt;
62  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Scan of &quot;META-INF/jpamappings.xml&quot; found persistent types [Ljava.lang.String;@3a183a18.&lt;br/&gt;
62  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Mapping resource location &quot;file:/C:/temp/test/META-INF/jpamappings.xml&quot; to persistent types &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;test.XMLDatatypeSupportTestEntity&amp;#93;&lt;/span&gt;&quot;.&lt;br/&gt;
62  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Scanning resource &quot;META-INF/orm.xml&quot; for persistent types.&lt;br/&gt;
62  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - parsePersistentTypeNames() found &lt;span class=&quot;error&quot;&gt;&amp;#91;test.XMLDatatypeSupportTestEntity&amp;#93;&lt;/span&gt;.&lt;br/&gt;
62  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Found 1 classes with metadata in 15 milliseconds.&lt;br/&gt;
62  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Tool - Enhancer running on type &quot;test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
93  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Loading metadata for &quot;class test.XMLDatatypeSupportTestEntity&quot; under mode &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;META&amp;#93;&lt;/span&gt;&quot;.&lt;br/&gt;
125  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Parsing resource &quot;file:/C:/temp/test/META-INF/jpamappings.xml&quot;.&lt;br/&gt;
156  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Parsing class &quot;test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
172  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Generating default metadata for type &quot;test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
172  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Using reflection for metadata generation.&lt;br/&gt;
187  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Parsing class &quot;test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
187  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Parsing package &quot;test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
187  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Finished parsing metadata resource &quot;file:/C:/temp/test/META-INF/jpamappings.xml&quot;.&lt;br/&gt;
187  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Parsing class &quot;test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
187  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Enhance - Enhancing type &quot;class test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
203  EntityUnit_JSE  WARN   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Enhance - Type &quot;class test.XMLDatatypeSupportTestEntity&quot; has no metadata; enhancing as persistence aware. If you intended for &quot;class test.XMLDatatypeSupportTestEntity&quot; to be persistence-capable, then this means that OpenJPA could not find any metadata for &quot;class test.XMLDatatypeSupportTestEntity&quot;. This can happen if the directory containing your metadata is not in your CLASSPATH, or if your metadata files are not named properly. See the documentation on metadata placement for more information.&lt;br/&gt;
203  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Tool - The class does not have metadata - enhanced as persistence-aware.&lt;br/&gt;
-----------------------------------------&lt;br/&gt;
&lt;br/&gt;
However if the target is specified, the enhancement will occur, E.g.&lt;br/&gt;
&lt;br/&gt;
-----------------------------------------&lt;br/&gt;
C:\temp\test&amp;gt;runPcEnhancer.bat test.XMLDatatypeSupportTestEntity&lt;br/&gt;
&lt;br/&gt;
C:\temp\test&amp;gt;java -cp C:\temp\test\;C:\temp\test\openjpa-1.1.0-SNAPSHOT.jar;C:\temp\test\utils.jar;C:\temp\test\geronimo-jpa_3.0_spec-1.0.jar;C:\temp\test\geronimo-jta_1.1_spec-1.1.jar org.apache.openjpa.enhance.PCEnhancer test.XMLDatatypeSupportTestEntity&lt;br/&gt;
15  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Runtime - Setting the following properties from &quot;file:/C:/temp/test/META-INF/persistence.xml&quot; into configuration: {openjpa.Id=EntityUnit_JSE, openjpa.Log=DefaultLevel=TRACE, openjpa.MetaDataFactory=jpa(Resources=META-INF/jpamappings.xml, Types=test.XMLDatatypeSupportTestEntity)}
&lt;p&gt;47  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Runtime - No cache marshaller found for id org.apache.openjpa.conf.MetaDataCacheMaintenance.&lt;br/&gt;
78  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Runtime - No cache marshaller found for id org.apache.openjpa.conf.MetaDataCacheMaintenance.&lt;br/&gt;
94  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Tool - Enhancer running on type &quot;class test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
125  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Loading metadata for &quot;class test.XMLDatatypeSupportTestEntity&quot; under mode &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;META&amp;#93;&lt;/span&gt;&quot;.&lt;br/&gt;
125  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Scanning resource &quot;META-INF/jpamappings.xml&quot; for persistent types.&lt;br/&gt;
125  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Scan of &quot;META-INF/jpamappings.xml&quot; found persistent types [Ljava.lang.String;@20962096.&lt;br/&gt;
140  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Mapping resource location &quot;file:/C:/temp/test/META-INF/jpamappings.xml&quot; to persistent types &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;test.XMLDatatypeSupportTestEntity&amp;#93;&lt;/span&gt;&quot;.&lt;br/&gt;
140  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Scanning resource &quot;META-INF/orm.xml&quot; for persistent types.&lt;br/&gt;
140  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - parsePersistentTypeNames() found &lt;span class=&quot;error&quot;&gt;&amp;#91;test.XMLDatatypeSupportTestEntity&amp;#93;&lt;/span&gt;.&lt;br/&gt;
140  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Found 1 classes with metadata in 15 milliseconds.&lt;br/&gt;
156  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Parsing resource &quot;file:/C:/temp/test/META-INF/jpamappings.xml&quot;.&lt;br/&gt;
187  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Parsing class &quot;test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
187  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Generating default metadata for type &quot;test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
187  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Using reflection for metadata generation.&lt;br/&gt;
203  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Parsing class &quot;test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
219  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Finished parsing metadata resource &quot;file:/C:/temp/test/META-INF/jpamappings.xml&quot;.&lt;br/&gt;
219  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Set persistence-capable superclass of &quot;test.XMLDatatypeSupportTestEntity&quot; to &quot;null&quot;.&lt;br/&gt;
219  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Resolving metadata for &quot;test.XMLDatatypeSupportTestEntity@1259490066&quot;.&lt;br/&gt;
219  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData -   Resolving field &quot;test.XMLDatatypeSupportTestEntity@1259490066.byteAttrDefault&quot;.&lt;br/&gt;
219  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData -   Resolving field &quot;test.XMLDatatypeSupportTestEntity@1259490066.id&quot;.&lt;br/&gt;
250  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Preparing mapping for &quot;test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
250  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Resolving mapping for &quot;test.XMLDatatypeSupportTestEntity@1259490066&quot;.&lt;br/&gt;
250  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Enhance - Enhancing type &quot;class test.XMLDatatypeSupportTestEntity&quot;.&lt;br/&gt;
312  EntityUnit_JSE  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.MetaData - Clearing metadata repository &quot;org.apache.openjpa.meta.MetaDataRepository@518c518c&quot;.&lt;br/&gt;
-----------------------------------------&lt;/p&gt;</description>
                <environment>All platforms</environment>
        <key id="12378065">OPENJPA-367</key>
            <summary>PCEnhancer does not find meta data for entities using pure XML annotation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="allee8285">Albert Lee</assignee>
                                    <reporter username="allee8285">Albert Lee</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Sep 2007 17:30:38 +0100</created>
                <updated>Tue, 15 Apr 2008 19:10:43 +0100</updated>
                            <resolved>Tue, 30 Oct 2007 16:04:19 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.0.2</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>kernel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12526844" author="allee8285" created="Wed, 12 Sep 2007 17:33:55 +0100"  >&lt;p&gt;Attached jar contains all the artifacts to reproduce the problem.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;unzip the jar to c:\temp&lt;/li&gt;
	&lt;li&gt;run tests with&lt;br/&gt;
    runPcEnhancer.bat&lt;br/&gt;
       or&lt;br/&gt;
    runPcEnhancer.bat test.XMLDatatypeSupportTestEntity&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12526849" author="allee8285" created="Wed, 12 Sep 2007 17:48:41 +0100"  >&lt;p&gt;From initial investigation, here is the call stack that shows the call path to CFMetaDataParser.classForName()&lt;/p&gt;

&lt;p&gt;  CFMetaDataParser.classForName(String, String, boolean, ClassLoader) line: 307&lt;br/&gt;
  XMLPersistenceMetaDataParser(CFMetaDataParser).classForName(String, boolean) line: 285	&lt;br/&gt;
  XMLPersistenceMetaDataParser.classForName(String) line: 1679	&lt;br/&gt;
  XMLPersistenceMetaDataParser.startClass(String, Attributes) line: 727	&lt;br/&gt;
  XMLPersistenceMetaDataParser(CFMetaDataParser).startElement(String, Attributes) line: 108	&lt;br/&gt;
  XMLPersistenceMetaDataParser(XMLMetaDataParser).startElement(String, String, String, Attributes) line: 432	&lt;br/&gt;
  SAXParserImpl$JAXPSAXParser(AbstractSAXParser).startElement(QName, XMLAttributes, Augmentations) line: not available	&lt;br/&gt;
  XMLSchemaValidator.startElement(QName, XMLAttributes, Augmentations) line: not available	&lt;br/&gt;
  XMLNSDocumentScannerImpl.scanStartElement() line: not available	&lt;br/&gt;
  XMLNSDocumentScannerImpl$NSContentDispatcher(XMLDocumentFragmentScannerImpl$FragmentContentDispatcher).dispatch(boolean) line: not available	&lt;br/&gt;
  XMLNSDocumentScannerImpl(XMLDocumentFragmentScannerImpl).scanDocument(boolean) line: not available	&lt;br/&gt;
  XIncludeAwareParserConfiguration(XML11Configuration).parse(boolean) line: not available	&lt;br/&gt;
  XIncludeAwareParserConfiguration(XML11Configuration).parse(XMLInputSource) line: not available	&lt;br/&gt;
  SAXParserImpl$JAXPSAXParser(XMLParser).parse(XMLInputSource) line: not available	&lt;br/&gt;
  SAXParserImpl$JAXPSAXParser(AbstractSAXParser).parse(InputSource) line: not available	&lt;br/&gt;
  SAXParserImpl.parse(InputSource, DefaultHandler) line: not available	&lt;br/&gt;
  XMLPersistenceMetaDataParser(XMLMetaDataParser).parseNewResource(Reader, String) line: 376	&lt;br/&gt;
  XMLPersistenceMetaDataParser(XMLMetaDataParser).parse(MetaDataIterator, boolean) line: 318	&lt;br/&gt;
  XMLPersistenceMetaDataParser(XMLMetaDataParser).parse(MetaDataIterator) line: 295	&lt;br/&gt;
  XMLPersistenceMetaDataParser(XMLMetaDataParser).parse(URL) line: 268	&lt;br/&gt;
  PersistenceMetaDataFactory.parseXML(URL, Class, int, ClassLoader) line: 247	&lt;br/&gt;
  PersistenceMetaDataFactory.load(Class, int, ClassLoader) line: 198	&lt;br/&gt;
  MetaDataRepository.getMetaDataInternal(Class, ClassLoader) line: 470	&lt;br/&gt;
  MetaDataRepository.getMetaData(Class, ClassLoader, boolean) line: 290	&lt;br/&gt;
  PCEnhancer.&amp;lt;init&amp;gt;(OpenJPAConfiguration, BCClass, MetaDataRepository, ClassLoader) line: 242	&lt;br/&gt;
  PCEnhancer.run(OpenJPAConfiguration, String[], PCEnhancer$Flags, MetaDataRepository, BytecodeWriter, ClassLoader) line: 4349	&lt;br/&gt;
  PCEnhancer.run(OpenJPAConfiguration, String[], Options) line: 4296	&lt;br/&gt;
  PCEnhancer.main(String[]) line: 4268	&lt;/p&gt;

&lt;p&gt;In the failing case, serp.Strings.toClass() method returns a different Class object from the Class object used by the MetaDataRepository, as a result, the look up of the meta data from the MetaDataRepository._meta map will not find the meta data, even there is one in the _meta map with a different Class object key.&lt;/p&gt;

&lt;p&gt;If a target is passed to the enhencer, serp.Strings.toClass() returns the same Class object, hence the look up in the MetaDataRepository succeeded. &lt;/p&gt;

&lt;p&gt;This implies serp returns a entity Class object using a different classloader.  From what I notice, both calls (pass &amp;amp; fail cases) to the serp.Strings.toClass() method uses the same TemporaryClassLoader.&lt;/p&gt;

&lt;p&gt;Since I have no access to the Serp code, I don&apos;t know what Serp does and what is the difference that cause the failure.&lt;/p&gt;

&lt;p&gt;I am looking for someone who can shred some light into this problem.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
Albert Lee.&lt;/p&gt;</comment>
                            <comment id="12526858" author="pcl" created="Wed, 12 Sep 2007 18:17:16 +0100"  >&lt;p&gt;FTR, the serp source code is available at &lt;a href=&quot;http://serp.sourceforge.net&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://serp.sourceforge.net&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12526887" author="allee8285" created="Wed, 12 Sep 2007 20:46:33 +0100"  >&lt;p&gt;Patrick, thanks for the pointer to the serp code. It helps a lot.  This problem has nothing to do with Serp.&lt;/p&gt;

&lt;p&gt;The scope of the problem is:&lt;/p&gt;

&lt;p&gt;1) When pcEnhancer is invoked with a target (i.e. test.XMLDatatypeSupportTestEntity), the ClassArgParser.parseTypes() is called to process the arguments and indirectly the entity is loaded using the TemporaryClassLoader. Subsequently, when the orm.xml is parsed, the same TemporaryClassLoader is used as the key to the meta data repository map.&lt;/p&gt;

&lt;p&gt;    TemporaryClassLoader.loadClass(String, boolean) line: 78	&lt;br/&gt;
    TemporaryClassLoader.loadClass(String) line: 44	&lt;br/&gt;
    ClassLoader.defineClassImpl(String, byte[], int, int, Object) line: not available &lt;span class=&quot;error&quot;&gt;&amp;#91;native method&amp;#93;&lt;/span&gt;	&lt;br/&gt;
    TemporaryClassLoader(ClassLoader).defineClass(String, byte[], int, int, ProtectionDomain) line: 224	&lt;br/&gt;
    TemporaryClassLoader(ClassLoader).defineClass(String, byte[], int, int) line: 163	&lt;br/&gt;
    TemporaryClassLoader.loadClass(String, boolean) line: 78	&lt;br/&gt;
    TemporaryClassLoader.loadClass(String) line: 44	&lt;br/&gt;
    Class&amp;lt;T&amp;gt;.forNameImpl(String, boolean, ClassLoader) line: not available &lt;span class=&quot;error&quot;&gt;&amp;#91;native method&amp;#93;&lt;/span&gt;	&lt;br/&gt;
    Class&amp;lt;T&amp;gt;.forName(String, boolean, ClassLoader) line: 164	&lt;br/&gt;
    Strings.toClass(String, boolean, ClassLoader) line: 162	&lt;br/&gt;
    Strings.toClass(String, ClassLoader) line: 108	&lt;br/&gt;
    ClassArgParser.parseTypes(String) line: 164	&lt;br/&gt;
    PCEnhancer.run(OpenJPAConfiguration, String[], PCEnhancer$Flags, MetaDataRepository, BytecodeWriter, ClassLoader) line: 4333	&lt;br/&gt;
    PCEnhancer.run(OpenJPAConfiguration, String[], Options) line: 4296	&lt;br/&gt;
    PCEnhancer.main(String[]) line: 4268	&lt;/p&gt;

&lt;p&gt;2) When no target is specified, the argument process is skipped and proceed to meta-data processing. The first step to do is to load entity class using serp.Project.  Currently, the project&apos;s loadClass() method is called without a classloader, therefore Project uses a default, which is the application context classloader (Thread.currentThread().getContextClassLoader()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
However, the remaining meta-data processing follow the exactly the same path as the successfully scenario and use the TemporaryClassLoader to load the entity class. This later entity Class object is used as the key to the meta-data repository map.  When all the processing is finished, MetaDataRepository.getMetaDataInternal( entityClass_from_applCtxtClassLoader) is called to lookup the meta data and was not found.&lt;/p&gt;

&lt;p&gt;--------------------------------&lt;br/&gt;
  PCEnhancer.java&lt;br/&gt;
        for (Iterator itr = classes.iterator(); itr.hasNext()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; {&lt;br/&gt;
            Object o = itr.next();&lt;br/&gt;
            if (log.isTraceEnabled())&lt;br/&gt;
                log.trace(_loc.get(&quot;enhance-running&quot;, o));&lt;/p&gt;

&lt;p&gt;            if (o instanceof String)&lt;br/&gt;
                bc = project.loadClass((String) o, loader); //&amp;lt;&amp;lt;&amp;lt;&amp;lt;  loader is added to resolve the observed problem&lt;br/&gt;
            else&lt;br/&gt;
                bc = project.loadClass((Class) o);&lt;br/&gt;
            enhancer = new PCEnhancer(conf, bc, repos, loader);&lt;br/&gt;
--------------------------------&lt;br/&gt;
  serp.Project.java&lt;br/&gt;
      public BCClass loadClass(String name) &lt;/p&gt;
{
        return loadClass(name, null);
    }
&lt;p&gt;--------------------------------&lt;br/&gt;
    public BCClass loadClass(String name, ClassLoader loader) {&lt;br/&gt;
        // convert to proper Class.forName() form&lt;br/&gt;
        name = _names.getExternalForm(name, false);&lt;/p&gt;

&lt;p&gt;        BCClass cached = checkCache(name);&lt;br/&gt;
        if (cached != null)&lt;br/&gt;
            return cached;&lt;/p&gt;

&lt;p&gt;        // check for existing type&lt;br/&gt;
        if (loader == null)&lt;br/&gt;
            loader = Thread.currentThread().getContextClassLoader();&lt;br/&gt;
        try &lt;/p&gt;
{
            return loadClass(Strings.toClass(name, loader));
        }
&lt;p&gt; catch (Exception e) {&lt;br/&gt;
        }&lt;br/&gt;
--------------------------------&lt;/p&gt;

&lt;p&gt;I modified PCEnhancer.run method and add the classloader parameter to the project.loadClass()  call to request Project to load the entity class using the TemporaryClassLoader. This seems to fix the problem.&lt;/p&gt;

&lt;p&gt;            if (o instanceof String)&lt;br/&gt;
                bc = project.loadClass((String) o, loader); //&amp;lt;&amp;lt;&amp;lt;&amp;lt;  loader is added to resolve the observed problem&lt;/p&gt;

&lt;p&gt;Is this the correct fix strategy for this problem?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Albert Lee&lt;/p&gt;</comment>
                            <comment id="12527171" author="allee8285" created="Thu, 13 Sep 2007 17:54:53 +0100"  >&lt;p&gt;Attached patch to add &quot;loader&quot; in PCEnhancer.run().&lt;/p&gt;

&lt;p&gt;            if (o instanceof String)&lt;br/&gt;
                bc = project.loadClass((String) o, loader);&lt;br/&gt;
            else&lt;br/&gt;
                bc = project.loadClass((Class) o);&lt;/p&gt;</comment>
                            <comment id="12527971" author="pcl" created="Mon, 17 Sep 2007 08:39:50 +0100"  >&lt;p&gt;That sounds like a valid fix to me.&lt;/p&gt;</comment>
                            <comment id="12528125" author="kwsutter" created="Mon, 17 Sep 2007 20:28:15 +0100"  >&lt;p&gt;Resolved for 1.1.0 (r576552) and 1.0.1 (r576564).&lt;/p&gt;</comment>
                            <comment id="12538816" author="pcl" created="Tue, 30 Oct 2007 15:44:32 +0000"  >&lt;p&gt;The test case for this issue was not checked in.&lt;/p&gt;</comment>
                            <comment id="12538823" author="allee8285" created="Tue, 30 Oct 2007 16:04:19 +0000"  >&lt;p&gt;Problem fixed. Need to check in test.&lt;/p&gt;</comment>
                            <comment id="12552265" author="sebasouza" created="Sun, 16 Dec 2007 18:27:36 +0000"  >&lt;p&gt;I have the same problem, and i am using openjpa 1.1. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12378307">OPENJPA-372</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12365748" name="OPENJPA-367.patch" size="708" author="allee8285" created="Thu, 13 Sep 2007 17:54:53 +0100"/>
                            <attachment id="12365647" name="OPENJPA-367.test.jar" size="3708108" author="allee8285" created="Wed, 12 Sep 2007 17:33:55 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 12 Sep 2007 17:17:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160690</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt1lz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203441</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>