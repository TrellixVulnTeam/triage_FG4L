<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:33:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1490/OPENJPA-1490.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1490] ClassNotFoundExceptions in an OSGi environment</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1490</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;OpenJPA is available packaged as an OSGi bundle, and specifies several optional package imports, for example the serp packages.&lt;/p&gt;

&lt;p&gt;When calling createContainerEntityManagerFactory() these imports are no longer optional, and NoClassDefFoundErrors are generated. These exceptions should be handled more gracefully, rather than simply being thrown back to the user.&lt;/p&gt;

&lt;p&gt;Examples follow:&lt;/p&gt;

&lt;p&gt;java.lang.NoClassDefFoundError: javax.transaction.Synchronization&lt;br/&gt;
	at java.lang.ClassLoader.defineClassImpl(Native Method)&lt;br/&gt;
	at java.lang.ClassLoader.defineClass(ClassLoader.java:265)&lt;br/&gt;
	at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.defineClass(DefaultClassLoader.java:183)&lt;br/&gt;
	at org.eclipse.osgi.baseadaptor.loader.ClasspathManager.defineClass(ClasspathManager.java:576)&lt;br/&gt;
	at org.eclipse.osgi.baseadaptor.loader.ClasspathManager.findClassImpl(ClasspathManager.java:546)&lt;br/&gt;
	at org.eclipse.osgi.baseadaptor.loader.ClasspathManager.findLocalClassImpl(ClasspathManager.java:477)&lt;br/&gt;
	at org.eclipse.osgi.baseadaptor.loader.ClasspathManager.findLocalClass_LockClassLoader(ClasspathManager.java:465)&lt;br/&gt;
	at org.eclipse.osgi.baseadaptor.loader.ClasspathManager.findLocalClass(ClasspathManager.java:445)&lt;br/&gt;
	at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.findLocalClass(DefaultClassLoader.java:211)&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findLocalClass(BundleLoader.java:376)&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClassInternal(BundleLoader.java:452)&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:405)&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:393)&lt;br/&gt;
	at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:105)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:609)&lt;br/&gt;
	at java.lang.ClassLoader.defineClassImpl(Native Method)&lt;br/&gt;
	at java.lang.ClassLoader.defineClass(ClassLoader.java:265)&lt;br/&gt;
	at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.defineClass(DefaultClassLoader.java:183)&lt;br/&gt;
	at org.eclipse.osgi.baseadaptor.loader.ClasspathManager.defineClass(ClasspathManager.java:576)&lt;br/&gt;
	at org.eclipse.osgi.baseadaptor.loader.ClasspathManager.findClassImpl(ClasspathManager.java:546)&lt;br/&gt;
	at org.eclipse.osgi.baseadaptor.loader.ClasspathManager.findLocalClassImpl(ClasspathManager.java:477)&lt;br/&gt;
	at org.eclipse.osgi.baseadaptor.loader.ClasspathManager.findLocalClass_LockClassLoader(ClasspathManager.java:465)&lt;br/&gt;
	at org.eclipse.osgi.baseadaptor.loader.ClasspathManager.findLocalClass(ClasspathManager.java:445)&lt;br/&gt;
	at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.findLocalClass(DefaultClassLoader.java:211)&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findLocalClass(BundleLoader.java:376)&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClassInternal(BundleLoader.java:452)&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:405)&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:393)&lt;br/&gt;
	at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:105)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:609)&lt;br/&gt;
	at java.lang.J9VMInternals.verifyImpl(Native Method)&lt;br/&gt;
	at java.lang.J9VMInternals.verify(J9VMInternals.java:72)&lt;br/&gt;
	at java.lang.J9VMInternals.initialize(J9VMInternals.java:134)&lt;br/&gt;
	at org.apache.openjpa.conf.OpenJPAConfigurationImpl.&amp;lt;init&amp;gt;(OpenJPAConfigurationImpl.java:221)&lt;br/&gt;
	at org.apache.openjpa.conf.OpenJPAConfigurationImpl.&amp;lt;init&amp;gt;(OpenJPAConfigurationImpl.java:195)&lt;br/&gt;
	at org.apache.openjpa.conf.OpenJPAConfigurationImpl.&amp;lt;init&amp;gt;(OpenJPAConfigurationImpl.java:186)&lt;br/&gt;
	at org.apache.openjpa.persistence.PersistenceProviderImpl.newConfigurationImpl(PersistenceProviderImpl.java:230)&lt;br/&gt;
	at org.apache.openjpa.persistence.PersistenceProviderImpl.createContainerEntityManagerFactory(PersistenceProviderImpl.java:166)&lt;br/&gt;
	at org.apache.openjpa.persistence.PersistenceProviderImpl.createContainerEntityManagerFactory(PersistenceProviderImpl.java:62)&lt;br/&gt;
	at org.apache.aries.jpa.container.impl.EntityManagerFactoryManager.createEntityManagerFactories(EntityManagerFactoryManager.java:227)&lt;br/&gt;
	at org.apache.aries.jpa.container.impl.EntityManagerFactoryManager.bundleStateChange(EntityManagerFactoryManager.java:121)&lt;br/&gt;
	at org.apache.aries.jpa.container.impl.PersistenceBundleManager.modifiedBundle(PersistenceBundleManager.java:197)&lt;br/&gt;
	at org.apache.aries.util.tracker.MultiBundleTracker$InternalBundleTracker.modifiedBundle(MultiBundleTracker.java:108)&lt;br/&gt;
	at org.osgi.util.tracker.BundleTracker$Tracked.customizerModified(BundleTracker.java:453)&lt;br/&gt;
	at org.osgi.util.tracker.AbstractTracked.track(AbstractTracked.java:237)&lt;br/&gt;
	at org.osgi.util.tracker.BundleTracker$Tracked.bundleChanged(BundleTracker.java:413)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.BundleContextImpl.dispatchEvent(BundleContextImpl.java:916)&lt;br/&gt;
	at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:220)&lt;br/&gt;
	at org.eclipse.osgi.framework.eventmgr.ListenerQueue.dispatchEventSynchronous(ListenerQueue.java:149)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.Framework.publishBundleEventPrivileged(Framework.java:1350)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.Framework.publishBundleEvent(Framework.java:1301)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker(BundleHost.java:490)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.AbstractBundle.suspend(AbstractBundle.java:546)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.Framework.suspendBundle(Framework.java:1098)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.PackageAdminImpl.suspendBundle(PackageAdminImpl.java:314)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.PackageAdminImpl.processDelta(PackageAdminImpl.java:460)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.PackageAdminImpl.doResolveBundles(PackageAdminImpl.java:241)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.PackageAdminImpl$1.run(PackageAdminImpl.java:176)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:735)&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: javax.transaction.Synchronization&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClassInternal(BundleLoader.java:489)&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:405)&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:393)&lt;br/&gt;
	at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:105)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:609)&lt;br/&gt;
	... 59 more&lt;/p&gt;



&lt;p&gt;java.lang.NoClassDefFoundError: serp.util.Strings&lt;br/&gt;
	at org.apache.openjpa.lib.conf.Configurations.newInstance(Configurations.java:200)&lt;br/&gt;
	at org.apache.openjpa.lib.conf.ObjectValue.newInstance(ObjectValue.java:124)&lt;br/&gt;
	at org.apache.openjpa.lib.conf.PluginValue.instantiate(PluginValue.java:103)&lt;br/&gt;
	at org.apache.openjpa.lib.conf.ObjectValue.instantiate(ObjectValue.java:83)&lt;br/&gt;
	at org.apache.openjpa.lib.conf.ConfigurationImpl.getLogFactory(ConfigurationImpl.java:209)&lt;br/&gt;
	at org.apache.openjpa.lib.conf.ConfigurationImpl.getLog(ConfigurationImpl.java:226)&lt;br/&gt;
	at org.apache.openjpa.conf.OpenJPAConfigurationImpl.getConfigurationLog(OpenJPAConfigurationImpl.java:1600)&lt;br/&gt;
	at org.apache.openjpa.lib.conf.ConfigurationImpl.loadGlobals(ConfigurationImpl.java:191)&lt;br/&gt;
	at org.apache.openjpa.conf.OpenJPAConfigurationImpl.&amp;lt;init&amp;gt;(OpenJPAConfigurationImpl.java:584)&lt;br/&gt;
	at org.apache.openjpa.conf.OpenJPAConfigurationImpl.&amp;lt;init&amp;gt;(OpenJPAConfigurationImpl.java:195)&lt;br/&gt;
	at org.apache.openjpa.conf.OpenJPAConfigurationImpl.&amp;lt;init&amp;gt;(OpenJPAConfigurationImpl.java:186)&lt;br/&gt;
	at org.apache.openjpa.persistence.PersistenceProviderImpl.newConfigurationImpl(PersistenceProviderImpl.java:230)&lt;br/&gt;
	at org.apache.openjpa.persistence.PersistenceProviderImpl.createContainerEntityManagerFactory(PersistenceProviderImpl.java:166)&lt;br/&gt;
	at org.apache.openjpa.persistence.PersistenceProviderImpl.createContainerEntityManagerFactory(PersistenceProviderImpl.java:62)&lt;br/&gt;
	at org.apache.aries.jpa.container.impl.EntityManagerFactoryManager.createEntityManagerFactories(EntityManagerFactoryManager.java:227)&lt;br/&gt;
	at org.apache.aries.jpa.container.impl.EntityManagerFactoryManager.bundleStateChange(EntityManagerFactoryManager.java:121)&lt;br/&gt;
	at org.apache.aries.jpa.container.impl.PersistenceBundleManager.modifiedBundle(PersistenceBundleManager.java:197)&lt;br/&gt;
	at org.apache.aries.util.tracker.MultiBundleTracker$InternalBundleTracker.modifiedBundle(MultiBundleTracker.java:108)&lt;br/&gt;
	at org.osgi.util.tracker.BundleTracker$Tracked.customizerModified(BundleTracker.java:453)&lt;br/&gt;
	at org.osgi.util.tracker.AbstractTracked.track(AbstractTracked.java:237)&lt;br/&gt;
	at org.osgi.util.tracker.BundleTracker$Tracked.bundleChanged(BundleTracker.java:413)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.BundleContextImpl.dispatchEvent(BundleContextImpl.java:916)&lt;br/&gt;
	at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:220)&lt;br/&gt;
	at org.eclipse.osgi.framework.eventmgr.ListenerQueue.dispatchEventSynchronous(ListenerQueue.java:149)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.Framework.publishBundleEventPrivileged(Framework.java:1350)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.Framework.publishBundleEvent(Framework.java:1301)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.BundleHost.stopWorker(BundleHost.java:490)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.AbstractBundle.suspend(AbstractBundle.java:546)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.Framework.suspendBundle(Framework.java:1098)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.PackageAdminImpl.suspendBundle(PackageAdminImpl.java:314)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.PackageAdminImpl.processDelta(PackageAdminImpl.java:460)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.PackageAdminImpl.doResolveBundles(PackageAdminImpl.java:241)&lt;br/&gt;
	at org.eclipse.osgi.framework.internal.core.PackageAdminImpl$1.run(PackageAdminImpl.java:176)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:735)&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: serp.util.Strings&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClassInternal(BundleLoader.java:489)&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:405)&lt;br/&gt;
	at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:393)&lt;br/&gt;
	at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:105)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:609)&lt;br/&gt;
	... 34 more&lt;/p&gt;

&lt;p&gt;Obviously there is no problem if the package imports are satisfied, but it would be nice to have a clear error message indicating that no container-managed JPA is possible without these packages.&lt;/p&gt;</description>
                <environment>OSGi</environment>
        <key id="12454919">OPENJPA-1490</key>
            <summary>ClassNotFoundExceptions in an OSGi environment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="timothyjward">Timothy Ward</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Feb 2010 14:32:29 +0000</created>
                <updated>Wed, 24 Feb 2010 18:19:17 +0000</updated>
                                            <version>2.0.0-beta</version>
                                                    <component>diagnostics</component>
                    <component>osgi</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12828132" author="drwoods" created="Mon, 1 Feb 2010 15:15:10 +0000"  >&lt;p&gt;What exactly are you looking for?  The spec doesn&apos;t allow for wrapping exceptions in a PersistenceException for createCEMF() -&lt;/p&gt;

&lt;p&gt;/**&lt;br/&gt;
Called by the container when an EntityManagerFactory is to be created.&lt;br/&gt;
 @param info metadata for use by the persistence provider&lt;br/&gt;
 @param map a Map of integration-level properties for use by the persistence provider (may be null if no properties are specified).&lt;br/&gt;
If a Bean Validation provider is present in the classpath, the container must pass the ValidatorFactory instance in the map with the key &quot;javax.persistence.validation.factory&quot;.&lt;br/&gt;
@return EntityManagerFactory for the persistence unit specified by the metadata&lt;br/&gt;
*/&lt;br/&gt;
public EntityManagerFactory createContainerEntityManagerFactory(&lt;br/&gt;
PersistenceUnitInfo info, Map map);&lt;/p&gt;

&lt;p&gt;but does allow RuntimeExceptions to be thrown.&lt;/p&gt;</comment>
                            <comment id="12828199" author="timothyjward" created="Mon, 1 Feb 2010 17:58:34 +0000"  >&lt;p&gt;I&apos;m not looking for a PersistenceException, but it would be nice if the container could catch a RuntimeException rather than an Error as that is much easier (and safer) for the caller to handle.&lt;/p&gt;

&lt;p&gt;It would also be nice if the thrown Exception had an error message that said something like &quot;The package xxxx is required when using OpenJPA with a container in OSGi, but this package was not available&quot;. It should be relatively simple to check that packages are available when in an OSGi framework, so this could potentially be done ahead of time rather than waiting for the NoClassDefFoundError.&lt;/p&gt;

&lt;p&gt;As this is primarily a consumability problem, I made sure to raise it as a minor bug and understand that it may not be fixed immediately. My main concerns were (in order):&lt;/p&gt;

&lt;p&gt;a) to let you know about the restriction for any future OSGi work in OpenJPA&lt;br/&gt;
b) to get a change to the code so that a RuntimeException is thrown rather than a NoClassDefFoundError&lt;br/&gt;
c) to get a better error message when a package is unavailable&lt;/p&gt;

&lt;p&gt;If throwing a RuntimeException is a reasonably simple solution then I&apos;m happy with that, if not then I&apos;m open to other solutions.&lt;/p&gt;</comment>
                            <comment id="12837925" author="drwoods" created="Wed, 24 Feb 2010 18:19:17 +0000"  >&lt;p&gt;Here is a potential fix, but not one I&apos;m going to commit as it changes the existing behavior of createContainerEMF(), which could break upstream projects/products that use OpenJPA.&lt;/p&gt;

&lt;p&gt;Most Java EE containers use Errors to denote critical failures that should cause the container to stop loading.&lt;/p&gt;

&lt;p&gt;Why is Aries or Felix/Equinox OSGi container not catching a NoClassDefFoundError to mean a required bundle could not be found/loaded and cause the bundle being loaded (openjpa in this case) to stop loading???  Requiring providers to implement special error code for OSGi containers should either be handled by RFC143 or the OSGi framework.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12436881" name="OPENJPA-1490.diff" size="1359" author="drwoods" created="Wed, 24 Feb 2010 18:19:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Feb 2010 15:15:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161754</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7ngf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288770</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>