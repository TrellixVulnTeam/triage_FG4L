<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:39:34 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1910/OPENJPA-1910.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1910] openjpa uses application ClassLoader for resolving BrokerFactory (revisited)</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1910</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;We are using openjpa-2.0.1 with a thin wrapper inside apache-karaf.&lt;/p&gt;

&lt;p&gt;The wrapper essentially sets the context class loader to the class loader of the application bundle and then calls &lt;/p&gt;

&lt;p&gt;   PersistenceProvider.createEntityManagerFactory(String emName, Map map)&lt;/p&gt;

&lt;p&gt;on the service exported by openjpa.&lt;/p&gt;

&lt;p&gt;We get an exception like cited at the end of this report, which is pretty much the same issue than &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1491&quot; title=&quot;org.apache.openjpa.kernel.Bootstrap uses the application classloader to load OpenJPA internals&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1491&quot;&gt;&lt;del&gt;OPENJPA-1491&lt;/del&gt;&lt;/a&gt;, where the exception occurred in the alternate method&lt;/p&gt;

&lt;p&gt;    PersistenceProvider.createContainerEntityManagerFactory(PersistenceUnitInfo pui, Map m)&lt;/p&gt;

&lt;p&gt;The code in&lt;/p&gt;

&lt;p&gt; org.apache.openjpa.persistence.PersistenceProviderImpl.getBrokerFactory(PersistenceProviderImpl.java:148)&lt;/p&gt;

&lt;p&gt;reads&lt;/p&gt;

&lt;p&gt;            BrokerFactory factory = getBrokerFactory(cp, poolValue, null);&lt;/p&gt;

&lt;p&gt;, which is exactly the same issue as in &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1491&quot; title=&quot;org.apache.openjpa.kernel.Bootstrap uses the application classloader to load OpenJPA internals&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1491&quot;&gt;&lt;del&gt;OPENJPA-1491&lt;/del&gt;&lt;/a&gt;, because the null CLassLoader causes the underlying code to use the context class loader, which is set to the class loader of the application and not the class loader of the openjpa bundle.&lt;/p&gt;

&lt;p&gt;  Replacing the above mentioned line by&lt;/p&gt;

&lt;p&gt;            BrokerFactory factory = getBrokerFactory(cp, poolValue, BundleUtils.getBundleClassLoader());&lt;/p&gt;

&lt;p&gt;would fix this issue as in &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1491&quot; title=&quot;org.apache.openjpa.kernel.Bootstrap uses the application classloader to load OpenJPA internals&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1491&quot;&gt;&lt;del&gt;OPENJPA-1491&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;(remark: BundleUtils.getBundleClassLoader() return null outside OSGi contexts, so this code works outside OSGi, too....)&lt;/p&gt;

&lt;p&gt;  Best regards,&lt;/p&gt;

&lt;p&gt;   Wolfgang&lt;/p&gt;

&lt;p&gt;My stack trace is:&lt;/p&gt;

&lt;p&gt;org.osgi.service.blueprint.container.ComponentDefinitionException: Error when instantiating bean entityManagerFactory of class null&lt;br/&gt;
        at org.apache.aries.blueprint.container.BeanRecipe.getInstance(BeanRecipe.java:233)&lt;span class=&quot;error&quot;&gt;&amp;#91;7:org.apache.aries.blueprint:0.3.0.incubating-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.aries.blueprint.container.BeanRecipe.internalCreate(BeanRecipe.java:726)&lt;span class=&quot;error&quot;&gt;&amp;#91;7:org.apache.aries.blueprint:0.3.0.incubating-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.aries.blueprint.di.AbstractRecipe.create(AbstractRecipe.java:64)&lt;span class=&quot;error&quot;&gt;&amp;#91;7:org.apache.aries.blueprint:0.3.0.incubating-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.aries.blueprint.container.BlueprintRepository.createInstances(BlueprintRepository.java:219)[7:org.apache.aries.blueprint:0.3.0.incubating-SNAPS&lt;br/&gt;
HOT]&lt;br/&gt;
        at org.apache.aries.blueprint.container.BlueprintRepository.createAll(BlueprintRepository.java:147)&lt;span class=&quot;error&quot;&gt;&amp;#91;7:org.apache.aries.blueprint:0.3.0.incubating-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.aries.blueprint.container.BlueprintContainerImpl.instantiateEagerComponents(BlueprintContainerImpl.java:624)[7:org.apache.aries.blueprint:0.3.0&lt;br/&gt;
.incubating-SNAPSHOT]&lt;br/&gt;
        at org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:315)&lt;span class=&quot;error&quot;&gt;&amp;#91;7:org.apache.aries.blueprint:0.3.0.incubating-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:213)&lt;span class=&quot;error&quot;&gt;&amp;#91;7:org.apache.aries.blueprint:0.3.0.incubating-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:165)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:266)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:636)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: &amp;lt;openjpa-2.0.1-r422266:989424 fatal user error&amp;gt; org.apache.openjpa.persistence.ArgumentException: Could not invoke the static newInstance method on the na&lt;br/&gt;
med factory class &quot;&amp;lt;&amp;lt;openjpa-2.0.1-r422266:989424 fatal user error&amp;gt; org.apache.openjpa.util.UserException: The named BrokerFactory &quot;org.apache.openjpa.jdbc.kernel.JDBCBrokerFactory&quot; is not valid.&amp;gt;&quot;.&lt;br/&gt;
        at org.apache.openjpa.kernel.Bootstrap.newBrokerFactory(Bootstrap.java:70)&lt;br/&gt;
        at org.apache.openjpa.persistence.PersistenceProviderImpl.getBrokerFactory(PersistenceProviderImpl.java:148)&lt;br/&gt;
        at org.apache.openjpa.persistence.PersistenceProviderImpl.createEntityManagerFactory(PersistenceProviderImpl.java:94)&lt;br/&gt;
        at org.apache.openjpa.persistence.PersistenceProviderImpl.createEntityManagerFactory(PersistenceProviderImpl.java:154)&lt;br/&gt;
        at org.apache.openjpa.persistence.PersistenceProviderImpl.createEntityManagerFactory(PersistenceProviderImpl.java:65)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:616)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.aries.blueprint.container.AbstractServiceReferenceRecipe$JdkProxyFactory$1.invoke(AbstractServiceReferenceRecipe.java:632)&lt;br/&gt;
        at $Proxy48.createEntityManagerFactory(Unknown Source)&lt;br/&gt;
        at org.clazzes.util.jpa.provider.EntityManagerFactoryFactory.newEntityManagerFactory(EntityManagerFactoryFactory.java:67)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:616)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.aries.blueprint.utils.ReflectionUtils.invoke(ReflectionUtils.java:221)&lt;span class=&quot;error&quot;&gt;&amp;#91;7:org.apache.aries.blueprint:0.3.0.incubating-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.aries.blueprint.container.BeanRecipe.invoke(BeanRecipe.java:844)&lt;span class=&quot;error&quot;&gt;&amp;#91;7:org.apache.aries.blueprint:0.3.0.incubating-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.aries.blueprint.container.BeanRecipe.getInstance(BeanRecipe.java:231)&lt;span class=&quot;error&quot;&gt;&amp;#91;7:org.apache.aries.blueprint:0.3.0.incubating-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
        ... 15 more&lt;br/&gt;
Caused by: &amp;lt;openjpa-2.0.1-r422266:989424 fatal user error&amp;gt; org.apache.openjpa.persistence.ArgumentException: The named BrokerFactory &quot;org.apache.openjpa.jdbc.kernel.JDBCBrokerFactory&quot; is not valid.&lt;br/&gt;
        at org.apache.openjpa.kernel.Bootstrap.getFactoryClass(Bootstrap.java:159)&lt;br/&gt;
        at org.apache.openjpa.kernel.Bootstrap.invokeFactory(Bootstrap.java:111)&lt;br/&gt;
        at org.apache.openjpa.kernel.Bootstrap.newBrokerFactory(Bootstrap.java:62)&lt;br/&gt;
        ... 33 more&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: org.apache.openjpa.jdbc.kernel.JDBCBrokerFactory&lt;br/&gt;
        at java.net.URLClassLoader$1.run(URLClassLoader.java:217)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.net.URLClassLoader.findClass(URLClassLoader.java:205)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:321)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:294)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:266)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.Class.forName0(Native Method)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.Class.forName(Class.java:264)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.6.0_20&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.openjpa.kernel.Bootstrap.getFactoryClass(Bootstrap.java:157)&lt;br/&gt;
        ... 35 more&lt;/p&gt;</description>
                <environment>apache-karaf 2.1.0,  openjdk-1.6.0b18</environment>
        <key id="12494449">OPENJPA-1910</key>
            <summary>openjpa uses application ClassLoader for resolving BrokerFactory (revisited)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="curtisr7">Rick Curtis</assignee>
                                    <reporter username="wolfgang.glas@ev-i.at">Wolfgang Glas</reporter>
                        <labels>
                    </labels>
                <created>Sun, 2 Jan 2011 16:51:28 +0000</created>
                <updated>Thu, 2 Feb 2012 17:02:43 +0000</updated>
                            <resolved>Tue, 11 Jan 2011 19:30:39 +0000</resolved>
                                    <version>2.0.1</version>
                    <version>2.1.0</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.1.0</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>osgi</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12980278" author="curtisr7" created="Tue, 11 Jan 2011 19:30:39 +0000"  >&lt;p&gt;Committed changes to 2.1.x and trunk.&lt;/p&gt;</comment>
                            <comment id="13198957" author="allee8285" created="Thu, 2 Feb 2012 17:02:43 +0000"  >&lt;p&gt;Close issue in preparation for 2.2.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Jan 2011 19:30:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>162135</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysxmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202795</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>