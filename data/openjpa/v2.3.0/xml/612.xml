<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:38:45 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-612/OPENJPA-612.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-612] Add support for calculating update value in QueryImpl.updateInMemory</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-612</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Since Informix does not support update with in/exists subquery in the where clause, when doing the bulk update against informix, e.g., &lt;/p&gt;

&lt;p&gt;     &quot;update DeptBeanAno d set d.budget = (d.budget * ?1 + ?2) where d.reportsTo.no = ?3&quot;&lt;/p&gt;

&lt;p&gt;we encounter the error of &quot;only-update-primitives&quot; during updateInMemory. &lt;/p&gt;

&lt;p&gt;     The attached patch fixes this problem by beefing up the support for arithmetic calcuation of the update value for updateInMemory.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12396785">OPENJPA-612</key>
            <summary>Add support for calculating update value in QueryImpl.updateInMemory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="faywang">Fay Wang</reporter>
                        <labels>
                    </labels>
                <created>Sun, 25 May 2008 23:38:54 +0100</created>
                <updated>Tue, 9 Mar 2010 18:32:53 +0000</updated>
                            <resolved>Wed, 28 May 2008 23:27:21 +0100</resolved>
                                                    <fixVersion>1.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="12600204" author="allee8285" created="Tue, 27 May 2008 18:09:31 +0100"  >&lt;p&gt;I am wondering if evaluate() in the abstract base class should throw an exception rather than returning a null?&lt;/p&gt;

&lt;p&gt;Index: openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AbstractStoreQuery.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AbstractStoreQuery.java	(revision 659216)&lt;br/&gt;
+    &lt;br/&gt;
+    public Object evaluate(Object value, Object ob, Object[] params, &lt;br/&gt;
+        OpenJPAStateManager sm) &lt;/p&gt;
{
+        return null;
+    }
&lt;p&gt;    &lt;/p&gt;

&lt;p&gt;Otherwise, val will be null and could it cause undesirable/different behavior for AbstractStoreQuery subclass that has no implementation and/or NPE further on? &lt;/p&gt;

&lt;p&gt;Index: openjpa-kernel/src/main/java/org/apache/openjpa/kernel/QueryImpl.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; openjpa-kernel/src/main/java/org/apache/openjpa/kernel/QueryImpl.java	(revision 659216)&lt;br/&gt;
             } else {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw new UserException(_loc.get(&quot;only-update-primitives&quot;));&lt;br/&gt;
+                try 
{
+                    val = evaluate(value, ob, params, sm, q);
+                }
&lt;p&gt; catch (UnsupportedException e1) &lt;/p&gt;
{
+                    throw new UserException(_loc.get(&quot;fail-to-get-update-value&quot;));
+                }
&lt;p&gt;             }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Albert Lee.&lt;/p&gt;</comment>
                            <comment id="12600297" author="faywang" created="Tue, 27 May 2008 23:41:19 +0100"  >&lt;p&gt;This patch is per Albert&apos;s comments to throw UnsupportedException in AbstractStoreQuery.&lt;/p&gt;</comment>
                            <comment id="12600565" author="faywang" created="Wed, 28 May 2008 19:38:58 +0100"  >&lt;p&gt;I have streamlined the code and added string function supports to the updateInMemory. The following queries have been tested against Informix backend:&lt;/p&gt;

&lt;p&gt;query=&quot;update DeptBeanAno d set d.name = CONCAT(d.name, &apos;288&apos;) where d.reportsTo.no = ?1&quot;&lt;br/&gt;
query=&quot;update DeptBeanAno d set d.name = SUBSTRING(d.name, 1, LENGTH(d.name)) where d.reportsTo.no = ?1&quot;&lt;br/&gt;
query=&quot;update DeptBeanAno d set d.name = UPPER(d.name) where d.reportsTo.no = ?1&quot;&lt;br/&gt;
query=&quot;update DeptBeanAno d set d.name = LOWER(d.name) where d.reportsTo.no = ?1&quot;&lt;br/&gt;
query=&quot;update DeptBeanAno d set d.name = TRIM(LEADING &apos; &apos; FROM d.name) where d.reportsTo.no = ?1&quot;&lt;br/&gt;
query=&quot;update DeptBeanAno d set d.name = TRIM(TRAILING &apos; &apos; FROM d.name) where d.reportsTo.no = ?1&quot;&lt;br/&gt;
query=&quot;update DeptBeanAno d set d.name = TRIM(&apos; &apos; FROM d.name) where d.reportsTo.no = ?1&quot;&lt;br/&gt;
query=&quot;update DeptBeanAno d set d.name = SUBSTRING(d.name, 1, LOCATE(d.name, &apos;e&apos;, 1)) where d.reportsTo.no = ?1&quot;&lt;br/&gt;
query=&quot;update DeptBeanAno d set d.idx = LOCATE(d.name, &apos;e&apos;, 3) where d.reportsTo.no = ?1&quot;&lt;/p&gt;</comment>
                            <comment id="12600632" author="fancy" created="Wed, 28 May 2008 23:27:21 +0100"  >&lt;p&gt;InMemoryUpdate support for  Math function and String function evaluation are done.&lt;br/&gt;
The remaining work for functions returning numeric value such as ABS, SQRT, SIZE  etc. will be done on needed basis.&lt;br/&gt;
A subtask will be opened for that.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12382742" name="openjpa.patch" size="13006" author="faywang" created="Sun, 25 May 2008 23:39:39 +0100"/>
                            <attachment id="12382880" name="openjpa0526.patch" size="12509" author="faywang" created="Tue, 27 May 2008 23:41:19 +0100"/>
                            <attachment id="12382954" name="openjpa0528a.patch" size="22452" author="faywang" created="Wed, 28 May 2008 19:38:58 +0100"/>
                    </attachments>
                <subtasks>
                            <subtask id="12397030">OPENJPA-616</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 27 May 2008 17:09:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160928</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt1tz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203477</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>