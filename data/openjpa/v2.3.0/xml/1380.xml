<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:32:10 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1380/OPENJPA-1380.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1380] Query not getting evicted from QueryCache</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1380</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;I&apos;m running on OpenJPA 1.2.1&lt;/p&gt;

&lt;p&gt;The following query is added to the QueryCache:&lt;/p&gt;

&lt;p&gt;Query: org.apache.openjpa.kernel.QueryImpl@3afe3afe;&lt;br/&gt;
candidate class: class com.ibm.usmi.datamodel.system.OperatingSystem;&lt;br/&gt;
query: SELECT distinct&lt;br/&gt;
OPERATINGSYSTEM1.OID,OPERATINGSYSTEM1.Guid,OPERATINGSYSTEM1.ObjectType,OPERATINGSYSTEM1.Name,REMOTESERVICEACCESSPOINT1.OID,REMOTESERVICEACCESSPOINT1.Guid,REMOTESERVICEACCESSPOINT1.ObjectType,REMOTESERVICEACCESSPOINT1.Name&lt;br/&gt;
FROM OperatingSystem&lt;br/&gt;
OPERATINGSYSTEM1,System_accessedVia_RemoteServiceAccessPoint&lt;br/&gt;
SYSTEM_ACCESSEDVIA_REMOTESERVICEACCESSPOINT1,RemoteServiceAccessPoint&lt;br/&gt;
REMOTESERVICEACCESSPOINT1,RelationshipInfo RELATIONSHIPINFO1 WHERE&lt;br/&gt;
OPERATINGSYSTEM1.OID = SYSTEM_ACCESSEDVIA_REMOTESERVICEACCESSPOINT1.sourceId&lt;br/&gt;
AND REMOTESERVICEACCESSPOINT1.OID =&lt;br/&gt;
SYSTEM_ACCESSEDVIA_REMOTESERVICEACCESSPOINT1.targetId AND&lt;br/&gt;
(OPERATINGSYSTEM1.Guid = ?1) AND (OPERATINGSYSTEM1.OID = ?2) AND&lt;br/&gt;
((OPERATINGSYSTEM1.BuildNumber = ?3)) AND (REMOTESERVICEACCESSPOINT1.Guid =&lt;br/&gt;
?4) AND (REMOTESERVICEACCESSPOINT1.OID = ?5) AND&lt;br/&gt;
((REMOTESERVICEACCESSPOINT1.Port = ?6)) AND RELATIONSHIPINFO1.changedDate &amp;gt;&lt;br/&gt;
?7 and RELATIONSHIPINFO1.sourceOID=OPERATINGSYSTEM1.OID and&lt;br/&gt;
RELATIONSHIPINFO1.relationshipType = ?8 and&lt;br/&gt;
RELATIONSHIPINFO1.targetOID=REMOTESERVICEACCESSPOINT1.OID&lt;/p&gt;

&lt;p&gt;Later on, a record in RelationshipInfo is changed, which changes what should&lt;br/&gt;
be returned from this query.  I&apos;d expect this to cause the cached query to&lt;br/&gt;
get evicted from the QueryCache, but it is not.  If I get the&lt;br/&gt;
QueryResultCache, and evictAll RelationshipInfo.class, it still doesn&apos;t get&lt;br/&gt;
removed.  This seems to be because the AccessPath only contains&lt;br/&gt;
OperatingSystem.  I&apos;d expect this to contain all entities that this query&lt;br/&gt;
deals with:&lt;/p&gt;
                {OperatingSystem,
System_accessedVia_RemoteServiceAccessPoint, RemoteServiceAccessPoint,
RelationshipInfo}
&lt;p&gt;But the AccessPath only seems to contain the entity of what is returned from&lt;br/&gt;
the query.&lt;/p&gt;

&lt;p&gt;What do I need to do so this query gets evicted like I&apos;d expect.&lt;/p&gt;

&lt;p&gt;This problem can be easily reproduced by the following query:&lt;/p&gt;

&lt;p&gt;  String jpql = &quot;select p.name, c.name from OneOneParent p, OneOneChild c where &quot; + &lt;br/&gt;
            &quot;p.id = c.id and c.name = ?1&quot;;&lt;/p&gt;

&lt;p&gt;	The query cache key is:&lt;/p&gt;

&lt;p&gt;&quot;org.apache.openjpa.datacache.QueryKey@d11db9a4&lt;br/&gt;
[&lt;br/&gt;
    query:&lt;span class=&quot;error&quot;&gt;&amp;#91;select p.name, c.name from OneOneParent p, OneOneChild c where p.id = c.id and c.name = ?1&amp;#93;&lt;/span&gt;,&lt;br/&gt;
    access path:&lt;span class=&quot;error&quot;&gt;&amp;#91;queryCache.OneOneParent&amp;#93;&lt;/span&gt;,&lt;br/&gt;
    subs:true,&lt;br/&gt;
    ignoreChanges:false,&lt;br/&gt;
    startRange:0,&lt;br/&gt;
    endRange:9223372036854775807,timeout:-1&lt;br/&gt;
]&quot;.&lt;/p&gt;

&lt;p&gt;This problem can be resolved if access path in QueryKey also contains queryCache.OneOneChild.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12440367">OPENJPA-1380</key>
            <summary>Query not getting evicted from QueryCache</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="faywang">Fay Wang</assignee>
                                    <reporter username="fancy">Catalina Wei</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Nov 2009 00:54:42 +0000</created>
                <updated>Wed, 24 Feb 2010 14:02:30 +0000</updated>
                            <resolved>Thu, 12 Nov 2009 21:50:38 +0000</resolved>
                                    <version>1.2.1</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-beta</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161647</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt4cn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203885</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>