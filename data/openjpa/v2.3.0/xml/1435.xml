<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:44:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1435/OPENJPA-1435.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1435] Multi-1xm relation of same type in entity yields extra null in result collection</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1435</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;When multiple same 1xm relationship is defined in an entity, fetching the entity yields one extra null element in the collection.&lt;/p&gt;

&lt;p&gt;@Entity&lt;br/&gt;
public class Util1xmLf {&lt;br/&gt;
    private int id;&lt;br/&gt;
    private int version;&lt;br/&gt;
    public Collection&amp;lt;Util1xmRt&amp;gt; uniRightLzy = new HashSet&amp;lt;Util1xmRt&amp;gt;();&lt;br/&gt;
    public Collection&amp;lt;Util1xmRt&amp;gt; uniRightEgr = new HashSet&amp;lt;Util1xmRt&amp;gt;();&lt;/p&gt;

&lt;p&gt;    @Id public int getId() &lt;/p&gt;
{        return id;    }&lt;br/&gt;
    @Version public int getVersion() {        return version;    }&lt;br/&gt;
    @OneToMany// (fetch = FetchType.LAZY)&lt;br/&gt;
    public Collection&amp;lt;Util1xmRt&amp;gt; getUniRightLzy() {        return uniRightLzy;    }&lt;br/&gt;
    public void setUniRightLzy(Collection&amp;lt;Util1xmRt&amp;gt; uniRightLzy) {        this.uniRightLzy = uniRightLzy;    }&lt;br/&gt;
    public void addUniRightLzy(Util1xmRt uniRightLzy) {        getUniRightLzy().add(uniRightLzy);    }&lt;br/&gt;
    @OneToMany(fetch = FetchType.EAGER)&lt;br/&gt;
    public Collection&amp;lt;Util1xmRt&amp;gt; getUniRightEgr() {        return uniRightEgr;    }&lt;br/&gt;
    public void setUniRightEgr(Collection&amp;lt;Util1xmRt&amp;gt; uniRightEgr) {        this.uniRightEgr = uniRightEgr;    }&lt;br/&gt;
    public void addUniRightEgr(Util1xmRt uniRightEgr) {        getUniRightEgr().add(uniRightEgr);    }&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
@Entity&lt;br/&gt;
public class Util1xmRt {&lt;br/&gt;
    private int id;&lt;br/&gt;
    private int version;&lt;br/&gt;
&lt;br/&gt;
    @Id public int getId() {        return id;    }
&lt;p&gt;    @Version public int getVersion() &lt;/p&gt;
{        return version;    }
&lt;p&gt;    public String getLastName() &lt;/p&gt;
{        return lastName;    }
&lt;p&gt;    public void setLastName(String lastName) &lt;/p&gt;
{        this.lastName = lastName;    }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;    public void testLoadedOneToManyCount() &lt;/p&gt;
{
        EntityManager em = emf.createEntityManager();
        Util1xmLf e1 = em.find(Util1xmLf.class, TestUtil1xm_TestRow_Id);
        // SELECT t0.firstName, t1.UTIL1XMLF_ID, t2.id, t2.lastName FROM Util1xmLf t0 
        //      LEFT OUTER JOIN Util1xmLf_Util1xmRt t1 ON t0.id = t1.UTIL1XMLF_ID 
        //      LEFT OUTER JOIN Util1xmRt t2 ON t1.UNIRIGHTEGR_ID = t2.id WHERE t0.id = ? 
        //      [params=(int) 100]

        assertNotNull(&quot;Found Util1xmLf(id=&quot; + TestUtil1xm_TestRow_Id + &quot;)&quot;, e1);
        
        Collection&amp;lt;Util1xmRt&amp;gt; eRs = e1.getUniRightLzy();
        // SELECT t1.id, t1.lastName FROM Util1xmLf_Util1xmRt t0 
        //      INNER JOIN Util1xmRt t1 ON t0.UNIRIGHTLZY_ID = t1.id WHERE t0.UTIL1XMLF_ID = ? 
        //      [params=(int) 100]
        assertNotNull(&quot;Util1xmRt uniRightLzy != null&quot;, eRs);
        assertEquals(&quot;Util1xmRt uniRightLzy.size == 2&quot;, eRs.size(), 2);
        
        Collection&amp;lt;Util1xmRt&amp;gt; eEs = e1.getUniRightEgr();
        assertNotNull(&quot;Util1xmRt uniRightEgr != null&quot;, eEs);
        // Failing test: Getting 3 in eager collection, one null entry
        assertEquals(&quot;Util1xmRt uniRightEgr.size == 2&quot;, eEs.size(), 2); &amp;lt;&amp;lt;&amp;lt;&amp;lt; Failure returning 3 entries

        em.close();
    }

&lt;p&gt;Here are the SQLs issued&lt;br/&gt;
batching prepstmnt 800337844 INSERT INTO Util1xmRt (id, lastName) VALUES (?, ?) &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 411, (String) loaded lastName1&amp;#93;&lt;/span&gt;&lt;br/&gt;
batching prepstmnt 800337844 INSERT INTO Util1xmRt (id, lastName) VALUES (?, ?) &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 412, (String) loaded lastName2&amp;#93;&lt;/span&gt;&lt;br/&gt;
batching prepstmnt 800337844 INSERT INTO Util1xmRt (id, lastName) VALUES (?, ?) &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 421, (String) loaded eager lastName3&amp;#93;&lt;/span&gt;&lt;br/&gt;
batching prepstmnt 800337844 INSERT INTO Util1xmRt (id, lastName) VALUES (?, ?) &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 422, (String) loaded eager lastName4&amp;#93;&lt;/span&gt;&lt;br/&gt;
executing prepstmnt 1258900233 INSERT INTO Util1xmLf (id, firstName) VALUES (?, ?) &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 400, (String) loaded firstName&amp;#93;&lt;/span&gt;&lt;br/&gt;
batching prepstmnt 1396069174 INSERT INTO Util1xmLf_Util1xmRt (UTIL1XMLF_ID, UNIRIGHT_ID) VALUES (?, ?) &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 400, (int) 412&amp;#93;&lt;/span&gt;&lt;br/&gt;
batching prepstmnt 1396069174 INSERT INTO Util1xmLf_Util1xmRt (UTIL1XMLF_ID, UNIRIGHT_ID) VALUES (?, ?) &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 400, (int) 411&amp;#93;&lt;/span&gt;&lt;br/&gt;
batching prepstmnt 1771465110 INSERT INTO Util1xmLf_Util1xmRt (UTIL1XMLF_ID, UNIRIGHTEGR_ID) VALUES (?, ?) &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 400, (int) 422&amp;#93;&lt;/span&gt;&lt;br/&gt;
batching prepstmnt 1771465110 INSERT INTO Util1xmLf_Util1xmRt (UTIL1XMLF_ID, UNIRIGHTEGR_ID) VALUES (?, ?) &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 400, (int) 421&amp;#93;&lt;/span&gt;&lt;br/&gt;
executing prepstmnt 1429165359 SELECT t0.firstName, t1.UTIL1XMLF_ID, t2.id, t2.lastName FROM Util1xmLf t0 LEFT OUTER JOIN Util1xmLf_Util1xmRt t1 ON t0.id = t1.UTIL1XMLF_ID LEFT OUTER JOIN Util1xmRt t2 ON t1.UNIRIGHTEGR_ID = t2.id WHERE t0.id = ?  &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 400&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;In DB2 CLI,&lt;/p&gt;

&lt;p&gt;db2 =&amp;gt; SELECT t0.firstName, t1.UTIL1XMLF_ID, t2.id, t2.lastName FROM Util1xmLf t0 LEFT OUTER JOIN Util1xmLf_Util1xmRt t1 ON t0.id = t1.UTIL1XMLF_ID LEFT OUTER JOIN Util1xmRt t2 ON t1.UNIRIGHTEGR_ID = t2.id WHERE t0.id = 400&lt;/p&gt;

&lt;p&gt;FIRSTNAME                 UTIL1XMLF_ID ID          LASTNAME&lt;br/&gt;
------------------------- ------------ ----------- -------------------------&lt;br/&gt;
loaded firstName                   400           - -&lt;br/&gt;
loaded firstName                   400           - -&lt;br/&gt;
loaded firstName                   400         422 loaded eager lastName4&lt;br/&gt;
loaded firstName                   400         421 loaded eager lastName3&lt;/p&gt;

&lt;p&gt;  4 record(s) selected.&lt;/p&gt;

&lt;p&gt;Change the 2nd Left Outer Join to Right Outer Join yields&lt;/p&gt;

&lt;p&gt;db2 =&amp;gt; SELECT t0.firstName, t1.UTIL1XMLF_ID, t2.id, t2.lastName FROM Util1xmLf t0 LEFT OUTER JOIN Util1xmLf_Util1xmRt t1 ON t0.id = t1.UTIL1XMLF_ID RIGHT OUTER JOIN Util1xmRt t2 ON t1.UNIRIGHTEGR_ID = t2.id WHERE t0.id = 400&lt;/p&gt;

&lt;p&gt;FIRSTNAME                 UTIL1XMLF_ID ID          LASTNAME&lt;br/&gt;
------------------------- ------------ ----------- -------------------------&lt;br/&gt;
loaded firstName                   400         422 loaded eager lastName4&lt;br/&gt;
loaded firstName                   400         421 loaded eager lastName3&lt;/p&gt;

&lt;p&gt;  2 record(s) selected.&lt;/p&gt;

&lt;p&gt;db2 =&amp;gt;&lt;/p&gt;

&lt;p&gt;Noticed the force uniRightLzy fetch used the following SQL, which yielded the correct result:&lt;/p&gt;

&lt;p&gt;SELECT t1.id, t1.lastName FROM Util1xmLf_Util1xmRt t0 INNER JOIN Util1xmRt t1 ON t0.UNIRIGHT_ID = t1.id WHERE t0.UTIL1XMLF_ID = ?  &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(int) 400&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12443551">OPENJPA-1435</key>
            <summary>Multi-1xm relation of same type in entity yields extra null in result collection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="allee8285">Albert Lee</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Dec 2009 16:55:31 +0000</created>
                <updated>Wed, 24 Feb 2010 14:34:16 +0000</updated>
                            <resolved>Wed, 16 Dec 2009 20:36:27 +0000</resolved>
                                    <version>2.0.0-M3</version>
                                    <fixVersion>2.0.0-beta</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                        <attachments>
                            <attachment id="12428190" name="OPENJPA-1435.test.patch" size="9951" author="allee8285" created="Wed, 16 Dec 2009 17:04:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161700</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyszgv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203094</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>