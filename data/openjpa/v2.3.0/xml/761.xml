<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:41:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-761/OPENJPA-761.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-761] SchemaTool failed with a NPE in ForeignKey.join</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-761</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;A test used the SchemaTool to reflect &quot;all&quot; schema in a Oracle DB but run in a NPE as observed below:&lt;/p&gt;

&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 131  INFO   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.jdbc.JDBC - Using dictionary class &quot;com.ibm.ws.persistence.jdbc.sql.OracleDictionary&quot;.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 1127  INFO   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Tool - Reflecting on schemas &quot;all&quot;.  This process may take some time.  Enable the org.apache.openjpa.jdbc.Schema logging category to see messages about the collection of schema data.&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; Exception in thread &quot;main&quot; java.lang.NullPointerException&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 	at org.apache.openjpa.jdbc.schema.ForeignKey.join(ForeignKey.java:521)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 	at org.apache.openjpa.jdbc.schema.SchemaGenerator.generateForeignKeys(SchemaGenerator.java:794)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 	at org.apache.openjpa.jdbc.schema.SchemaGenerator.generateForeignKeys(SchemaGenerator.java:431)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 	at org.apache.openjpa.jdbc.schema.SchemaGenerator.generateSchemas(SchemaGenerator.java:278)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 	at org.apache.openjpa.jdbc.schema.SchemaGenerator.generateSchemas(SchemaGenerator.java:243)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 	at org.apache.openjpa.jdbc.schema.SchemaTool.run(SchemaTool.java:1433)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 	at org.apache.openjpa.jdbc.schema.SchemaTool.run(SchemaTool.java:1403)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 	at org.apache.openjpa.jdbc.schema.SchemaTool$1.run(SchemaTool.java:1348)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 	at org.apache.openjpa.lib.conf.Configurations.launchRunnable(Configurations.java:708)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 	at org.apache.openjpa.lib.conf.Configurations.runAgainstAllAnchors(Configurations.java:693)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 	at org.apache.openjpa.jdbc.schema.SchemaTool.main(SchemaTool.java:1343)&lt;/p&gt;

&lt;p&gt;Albert Lee&lt;/p&gt;</description>
                <environment></environment>
        <key id="12407802">OPENJPA-761</key>
            <summary>SchemaTool failed with a NPE in ForeignKey.join</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="allee8285">Albert Lee</assignee>
                                    <reporter username="allee8285">Albert Lee</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Nov 2008 18:02:13 +0000</created>
                <updated>Tue, 4 Nov 2008 21:58:44 +0000</updated>
                            <resolved>Tue, 4 Nov 2008 21:58:35 +0000</resolved>
                                    <version>1.0.4</version>
                    <version>1.1.1</version>
                    <version>1.2.1</version>
                    <version>1.3.0</version>
                    <version>2.0.0-M2</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-M2</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12645028" author="allee8285" created="Tue, 4 Nov 2008 18:07:50 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I run the SchemaTool against each individual schema in the Oracle db and all works except 2 schema, OM and PM, There are total of 37 schema in the database.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The problems exhibited  for these 2 schema looks like below which is different from the NPE. At least it posted a meaningful message.&lt;br/&gt;
4641  TRACE  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.jdbc.JDBC - &amp;lt;t 1183336072, conn 1139688430&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;0 ms&amp;#93;&lt;/span&gt; close&lt;br/&gt;
Exception in thread &quot;main&quot; java.lang.RuntimeException: java.sql.SQLException: Table &quot;OE.CUSTOMERS&quot; has a foreign key to table &quot;HR.EMPLOYEES&quot;&lt;br/&gt;
 that has not been generated.  You must run the schema generator on all inter-related tables at once.&lt;br/&gt;
        at org.apache.openjpa.lib.conf.Configurations.launchRunnable(Configurations.java:711)&lt;br/&gt;
        at org.apache.openjpa.lib.conf.Configurations.runAgainstAllAnchors(Configurations.java:693)&lt;br/&gt;
        at org.apache.openjpa.jdbc.schema.SchemaTool.main(SchemaTool.java:1343)&lt;br/&gt;
Caused by: java.sql.SQLException: Table &quot;OE.CUSTOMERS&quot; has a foreign key to table &quot;HR.EMPLOYEES&quot; that has not been generated.  You must run&lt;br/&gt;
the schema generator on all inter-related tables at once.&lt;br/&gt;
        at org.apache.openjpa.jdbc.schema.SchemaGenerator.generateForeignKeys(SchemaGenerator.java:772)&lt;br/&gt;
        at org.apache.openjpa.jdbc.schema.SchemaGenerator.generateForeignKeys(SchemaGenerator.java:431)&lt;br/&gt;
I re-run and debug the schemaTool against all the schema and I was able to reproduce the exception (NPE) condition. The table that is in question is OE.PURCHASERS.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Then I generated the DDL for the OE schema and I found that&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;CREATE TABLE OE.PURCHASEORDERS (&lt;br/&gt;
		SYS_NC_ROWINFO$ null&lt;br/&gt;
	);&lt;/p&gt;

&lt;p&gt;ALTER TABLE OE.PURCHASEORDERS ADD CONSTRAINT USER_IS_VALID FOREIGN KEY (null)&lt;br/&gt;
	REFERENCES HR.EMPLOYEES (EMPLOYEE_ID)&lt;br/&gt;
	ON DELETE RESTRICT&lt;br/&gt;
	ON UPDATE CASCADE;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Notice the funny &quot;SYS_NC_ROWINFO$ null&quot; column definition in OE.PURCHASEORDERS  and null in the FOREIGN KEY constraint definition.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I try to re-create the table using the same syntax and was rejected by the db.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I believe this table is abnormal and was create/modified in some ways that I don&apos;t know how it gets to this configuration. &lt;/p&gt;

&lt;p&gt;To improve serviceability, a null check of of the fk table column and a more meaningful would be appropriate.&lt;/p&gt;

&lt;p&gt;Albert Lee.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161068</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7lmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288474</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>