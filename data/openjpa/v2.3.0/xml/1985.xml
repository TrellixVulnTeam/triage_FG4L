<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:44:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1985/OPENJPA-1985.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1985] ClassCastException in max(Timestamp) function on PostgreSQL</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1985</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Works perfectly in OpenJPA 2.0.1.&lt;/p&gt;

&lt;p&gt;Regression in OpenJPA 2.1.0, 100% reproducible exception.&lt;/p&gt;

&lt;p&gt;Exception:&lt;br/&gt;
SEVERE: Failed to execute query &quot;select max(h.loadTimestamp) from Header h where h.code=?1 and h.period=?2&quot;. Check the query syntax for correctness. See nested exception for details. &lt;br/&gt;
&amp;lt;openjpa-2.1.0-r422266:1071316 nonfatal user error&amp;gt; &lt;br/&gt;
org.apache.openjpa.persistence.ArgumentException: Failed to execute query &quot;select max(h.loadTimestamp) from Header h where h.code=?1 and h.period=?2&quot;. Check the query syntax for correctness. See nested &lt;br/&gt;
exception for details. &lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:872) &lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:794) &lt;br/&gt;
        at org.apache.openjpa.kernel.DelegatingQuery.execute(DelegatingQuery.java:542) &lt;br/&gt;
        at org.apache.openjpa.persistence.QueryImpl.execute(QueryImpl.java:305) &lt;br/&gt;
        at org.apache.openjpa.persistence.QueryImpl.getResultList(QueryImpl.java:319) &lt;br/&gt;
        at org.apache.openjpa.persistence.QueryImpl.getSingleResult(QueryImpl.java:343) &lt;br/&gt;
        ... my code ... &lt;br/&gt;
Caused by: java.lang.ClassCastException: Cannot convert object &lt;br/&gt;
&quot;2011-04-25 15:48:31+02&quot; of type &quot;class org.postgresql.util.PGobject&quot; &lt;br/&gt;
into an instance of &quot;class java.sql.Timestamp&quot;. &lt;br/&gt;
        at org.apache.openjpa.kernel.Filters.convert(Filters.java:336) &lt;br/&gt;
        at org.apache.openjpa.kernel.Filters.convert(Filters.java:265) &lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.exps.UnaryOp.load(UnaryOp.java:125) &lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.ProjectionResultObjectProvider.getResultObject(ProjectionResultObjectProvider.java:78) &lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl$PackingResultObjectProvider.getResultObject(QueryImpl.java:2075) &lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.singleResult(QueryImpl.java:1330) &lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.toResult(QueryImpl.java:1242) &lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:1007) &lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:863) &lt;br/&gt;
        ... 12 more &lt;/p&gt;

&lt;p&gt;Entity:&lt;br/&gt;
@Entity &lt;br/&gt;
@Table(name = &quot;headers&quot;) &lt;br/&gt;
@DataCache(enabled = false) &lt;br/&gt;
public class Header &lt;/p&gt;
{ 
    @Id 
    @GeneratedValue 
    private long id; 

    @Column(nullable = false) 
    private String code; 

    @Column(nullable = false) 
    private int period; 

    @Column(nullable = false) 
    @Temporal(TemporalType.TIMESTAMP) 
    private Timestamp loadTimestamp; 
... 
}
&lt;p&gt; &lt;/p&gt;

&lt;p&gt;Table (autogenerated by OpenJPA 2.0.1):&lt;br/&gt;
create table public.headers (&lt;br/&gt;
  id int8 not null,&lt;br/&gt;
  loadtimestamp abstime not null,&lt;br/&gt;
  period int4 not null,&lt;br/&gt;
  code varchar(255) not null,&lt;br/&gt;
  primary key (id)&lt;br/&gt;
);&lt;/p&gt;</description>
                <environment>Windows 7 x64, Java 1.6.0_25, PostgreSQL 9.0.4 x64, PostgreSQL Native Driver PostgreSQL 9.0 JDBC4 (build 801)</environment>
        <key id="12505188">OPENJPA-1985</key>
            <summary>ClassCastException in max(Timestamp) function on PostgreSQL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikedd">Michael Dick</assignee>
                                    <reporter username="s.mironov">Stanislav Mironov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Apr 2011 13:42:28 +0100</created>
                <updated>Wed, 13 Jul 2011 17:11:23 +0100</updated>
                            <resolved>Wed, 27 Apr 2011 21:56:28 +0100</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>jdbc</component>
                    <component>kernel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13025585" author="mikedd" created="Wed, 27 Apr 2011 04:29:53 +0100"  >&lt;p&gt;The short answer here is that the table was generated incorrectly on OpenJPA 2.0.1. &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1726&quot; title=&quot;Clean up OpenJPA test case failures for PostgreSQL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1726&quot;&gt;&lt;del&gt;OPENJPA-1726&lt;/del&gt;&lt;/a&gt; changed the default timestamp type from ASBTIME to TIMESTAMP (ABSTIME was deprecated). &lt;/p&gt;

&lt;p&gt;As a quick workaround you can either change the table definition (ugly), or add the following property to persistence.xml :&lt;br/&gt;
        &amp;lt;property name=&quot;openjpa.jdbc.DBDictionary&quot; value=&quot;postgres(timestampTypeName=ABSTIME)&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;The real fix will likely be to treat ABSTIME and TIMESTAMP identically.  &lt;/p&gt;</comment>
                            <comment id="13026002" author="mikedd" created="Wed, 27 Apr 2011 21:56:28 +0100"  >&lt;p&gt;Should be fixed now. The latest nightly snapshots should be available tomorrow morning and will have this change. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12468078">OPENJPA-1710</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12469301">OPENJPA-1726</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Apr 2011 03:29:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2342</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyspwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>201544</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>