<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:34:29 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-231/OPENJPA-231.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-231] Incorrect handling of cascading bidirectional collections during merge/attach</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-231</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;As posted on open-jpa-dev mailing list:&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;I&apos;m having a problem merging an entity, here&apos;s the simplified structure:&lt;/p&gt;

&lt;p&gt;Class A {     @OneToMany(cascade=CascadeType.ALL, mappedBy=&quot;parent&quot;)&lt;br/&gt;
   Set&amp;lt;B&amp;gt; b_set;&lt;br/&gt;
   ...&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Class B {&lt;br/&gt;
   @ManyToOne&lt;br/&gt;
   A parent;&lt;/p&gt;

&lt;p&gt;   @OneToMany(cascade=CascadeType.ALL, mappedBy=&quot;parent&quot;)&lt;br/&gt;
   Set&amp;lt;C&amp;gt; c_set;&lt;br/&gt;
   ...&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Class C {&lt;br/&gt;
   @ManyToOne&lt;br/&gt;
   B parent;&lt;br/&gt;
   ...&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;New instances of A,B,C are persisted correctly. However when I retrieve A, add some entries to A.b_set (with some of the new B entries have attached C&apos;s), em.merge(A) fails:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If A is detached:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    org.apache.openjpa.persistence.ArgumentException: Encountered new object &quot;B@...&quot; in persistent field &quot;C.parent&quot; of managed object &quot;C@...&quot; during attach.  However, this field does not allow cascade attach.  You cannot attach a reference to a new object without cascading.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If A is not detached:&lt;br/&gt;
                 C instances are inserted before B instances, resulting in a foreign key violation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Setting openjpa.jdbc.SchemaFactory to &apos;native(ForeignKeys=true)&apos; does not seem to have an effect.&lt;/p&gt;

&lt;hr /&gt;</description>
                <environment>platform-independent</environment>
        <key id="12368352">OPENJPA-231</key>
            <summary>Incorrect handling of cascading bidirectional collections during merge/attach</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gergul">Gokhan Ergul</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 May 2007 02:07:29 +0100</created>
                <updated>Tue, 9 Mar 2010 18:32:34 +0000</updated>
                            <resolved>Mon, 12 May 2008 06:43:18 +0100</resolved>
                                    <version>0.9.7</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>kernel</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12492829" author="gergul" created="Tue, 1 May 2007 02:08:46 +0100"  >&lt;p&gt;Attaching test-case to reproduce the issue and suggested patch.&lt;/p&gt;</comment>
                            <comment id="12492830" author="gergul" created="Tue, 1 May 2007 02:11:38 +0100"  >&lt;p&gt;Note that the patch is developed against a nightly-snapshot of 0.9.7. &lt;/p&gt;

&lt;p&gt;Bug is reproducible both with released 0.9.7 and latest 0.9.8-snapshot.&lt;/p&gt;</comment>
                            <comment id="12493193" author="gergul" created="Wed, 2 May 2007 21:01:06 +0100"  >&lt;p&gt;Further testing reveals that the patch I submitted solves only detached object merge case. Persisting and later merging in a single EntityManager session produces unreliable results, sometimes insert statements of C precede insert statements of B resulting in a FK violation, other times the statements are executed in the correct order --I have no idea as to why the order would change in different test runs with identical configuration. &lt;/p&gt;</comment>
                            <comment id="12514006" author="kwsutter" created="Thu, 19 Jul 2007 22:29:37 +0100"  >&lt;p&gt;Just curious...  If you put the CascadeType.ALL on the ManyToOne annotations, does your merge processing work okay?  That should not be required, but I am wondering whether we are dealing with similar problems.  Thanks.&lt;/p&gt;</comment>
                            <comment id="12514072" author="gergul" created="Fri, 20 Jul 2007 02:42:34 +0100"  >&lt;p&gt;Kevin, &lt;/p&gt;

&lt;p&gt;Just reran tests against latest svn with CascadeType.ALL on ManyToOne annotations, detached testcase fails with duplicate key exceptions, attached testcase passes --openjpa-friendly version of testcases are at &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12360321/merge-testcases.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12360321/merge-testcases.patch&lt;/a&gt; in case you want to run them yourself. Also see &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-255&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OPENJPA-255&lt;/a&gt; for a similar issue with detached objects, it&apos;s basically a different manifestation of the same problem.&lt;/p&gt;</comment>
                            <comment id="12514075" author="m_fuchs" created="Fri, 20 Jul 2007 02:56:54 +0100"  >&lt;p&gt;I propose a slight change to Gokhan&apos;s patch, please see openjpa-231.patch.&lt;/p&gt;</comment>
                            <comment id="12514084" author="gergul" created="Fri, 20 Jul 2007 04:11:57 +0100"  >&lt;p&gt;That&apos;ll do too, but still we&apos;d need the isManaged() check to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-255&quot; title=&quot;Inconsistent behavior during merge with cascade=none&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-255&quot;&gt;&lt;del&gt;OPENJPA-255&lt;/del&gt;&lt;/a&gt; as well, see &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12359302/openjpa-jira-255.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12359302/openjpa-jira-255.patch&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12594402" author="xiaoqinfeng2000" created="Tue, 6 May 2008 00:45:09 +0100"  >&lt;p&gt;I added TestNoCascadeOneToManyMerge.java based on the test case provided in this bug.&lt;br/&gt;
The attached patch includes both tests and fixes for open-231 and open-255.&lt;/p&gt;</comment>
                            <comment id="12595863" author="xiaoqinfeng2000" created="Sat, 10 May 2008 23:46:48 +0100"  >&lt;p&gt;This fix is for openjpa1.1.x branch. Test case is also included in this patch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12371293">OPENJPA-255</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12356555" name="jira-test-case.zip" size="5259" author="gergul" created="Tue, 1 May 2007 02:08:46 +0100"/>
                            <attachment id="12381828" name="openjpa-231-1.1.x.patch" size="17329" author="xiaoqinfeng2000" created="Sat, 10 May 2008 23:46:48 +0100"/>
                            <attachment id="12362189" name="openjpa-231.patch" size="815" author="m_fuchs" created="Fri, 20 Jul 2007 02:56:54 +0100"/>
                            <attachment id="12381461" name="openjpa-jira-231-255-new.patch" size="19261" author="xiaoqinfeng2000" created="Tue, 6 May 2008 00:45:08 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 19 Jul 2007 21:29:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160562</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysw3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202550</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>