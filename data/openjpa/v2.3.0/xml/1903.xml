<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:38:23 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1903/OPENJPA-1903.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1903] Some queries only work the first time they are executed</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1903</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;I have a problem in my application where a query that sometimes returns data and sometimes not.&lt;/p&gt;

&lt;p&gt;I have reduced it to the code as much as I could into an Eclipse project available at &lt;a href=&quot;http://ubuntuone.com/p/S9n/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ubuntuone.com/p/S9n/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This happens with OpenJPA 2.0.1 as well as the daily snapshot from 2010-12-05 and an out-of-process Derby database.&lt;/p&gt;

&lt;p&gt;Basically I have two Entities which both use multiple Ids to produce the Primary Key, &quot;Preis&quot; contains a foreign key on &quot;Website&quot;:&lt;/p&gt;

&lt;p&gt;@Entity&lt;br/&gt;
@IdClass(MandantAndNameIdentity.class)&lt;br/&gt;
public class Website &lt;/p&gt;
{
    @Id
    private String mandant;
   
    @Id
    private String name;
...
}

&lt;p&gt;@Entity&lt;br/&gt;
@IdClass(WebsiteProduktDatumIdentity.class)&lt;br/&gt;
public class Preis &lt;/p&gt;
{
    @Id
    @ManyToOne(cascade = CascadeType.MERGE)
    private Website website;

    @Id
    @Basic
    private String datum;
...
}

&lt;p&gt;I use the following to set up a website and a Preis:&lt;/p&gt;

&lt;p&gt;        em.getTransaction().begin();&lt;/p&gt;

&lt;p&gt;        Website website = em.merge(new Website(&quot;Mandant&quot;, &quot;Website&quot;));&lt;/p&gt;

&lt;p&gt;        em.merge(new Preis(website, DATUM));&lt;/p&gt;

&lt;p&gt;        em.getTransaction().commit();&lt;/p&gt;

&lt;p&gt;Afterwards, if I run the query as follows:&lt;/p&gt;

&lt;p&gt;       TypedQuery&amp;lt;Preis&amp;gt; q = em.createQuery(&lt;br/&gt;
                &quot;select m from Preis m &quot; +&lt;br/&gt;
                &quot;where m.website.name = :website &quot;, Preis.class);&lt;br/&gt;
       q.setParameter(&quot;website&quot;, website.getName());&lt;/p&gt;

&lt;p&gt;this query works all the time, note that it uses website.name for matching, not the full Website-object.&lt;/p&gt;

&lt;p&gt;However if I put the query as&lt;/p&gt;

&lt;p&gt;        TypedQuery&amp;lt;Preis&amp;gt; q = em.createQuery(&lt;br/&gt;
                &quot;select m from Preis m &quot; +&lt;br/&gt;
                &quot;where m.website = :website &quot;, Preis.class);&lt;br/&gt;
        q.setParameter(&quot;website&quot;, website);&lt;/p&gt;

&lt;p&gt;it only works ONCE and then does not return any results any more!! See testcase DataAccessVerifyTest for details.&lt;/p&gt;

&lt;p&gt;Discussion on the mailinglist seems to indicate that this is a bug. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12492529">OPENJPA-1903</key>
            <summary>Some queries only work the first time they are executed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ppoddar@apache.org">Pinaki Poddar</assignee>
                                    <reporter username="centic">Dominik Stadler</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Dec 2010 19:05:34 +0000</created>
                <updated>Fri, 3 Feb 2012 19:28:58 +0000</updated>
                            <resolved>Fri, 3 Feb 2012 19:28:54 +0000</resolved>
                                    <version>2.0.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12968428" author="centic" created="Mon, 6 Dec 2010 21:57:11 +0000"  >&lt;p&gt;setting a query-hint to disable caching makes the query run correctly multiple times:&lt;/p&gt;

&lt;p&gt;		q.setHint(QueryHints.HINT_IGNORE_PREPARED_QUERY, queryString); &lt;/p&gt;</comment>
                            <comment id="12968430" author="centic" created="Mon, 6 Dec 2010 21:58:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1750&quot; title=&quot;Prepared query with enum parameter fails when query is cached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1750&quot;&gt;OPENJPA-1750&lt;/a&gt; discusses a similar issue, but the issue here is not fixed by using latest 2.1.0 snapshot builds.&lt;/p&gt;</comment>
                            <comment id="12969059" author="ppoddar@apache.org" created="Tue, 7 Dec 2010 22:50:45 +0000"  >&lt;p&gt;If your environment permits, try recent SVN commit r1043221 &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; on trunk.&lt;br/&gt;
If it does not, will suggest alternative, non-kosher way to test if the proposed change resolves the reported probiem.&lt;br/&gt;
It is a bug.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://openjpa.208410.n2.nabble.com/svn-commit-r1043221-openjpa-trunk-openjpa-jdbc-src-main-java-org-apache-openjpa-jdbc-kernel-Prepareda-td5813517.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://openjpa.208410.n2.nabble.com/svn-commit-r1043221-openjpa-trunk-openjpa-jdbc-src-main-java-org-apache-openjpa-jdbc-kernel-Prepareda-td5813517.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12969900" author="centic" created="Thu, 9 Dec 2010 19:48:19 +0000"  >&lt;p&gt;I tried todays snapshot build labeled openjpa-2.2.0-20101209.084750-4.jar but my standalone testcase still fails with the same error. &lt;/p&gt;

&lt;p&gt;I also tried to check out the source and add a testcase to the exsiting TestQueryCache testcase. Strangely there it works, although I use the same settings in the Entities and the same test-code! What could be the difference here? I see the following warning when running TestQueryCache, which might be related but which I cannot make much sense of: &lt;/p&gt;

&lt;p&gt;&quot;Query &quot;select m from Child m where m.parent = :parent &quot; is removed from cache  excluded permanently. Query &quot;select m from Child m where m.parent = :parent &quot; is not cached because its result is not obtained by executing a select statement. This can happen if the query was evaluated in-memory. The result was provided by org.apache.openjpa.datacache.QueryCacheStoreQuery$CachingResultObjectProvider.  .&quot;&lt;/p&gt;</comment>
                            <comment id="13199963" author="allee8285" created="Fri, 3 Feb 2012 19:28:54 +0000"  >&lt;p&gt;Confirmed with Pinaki, this issues is completed and can be closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12470426">OPENJPA-1750</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 7 Dec 2010 22:50:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59916</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7oxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>289010</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>