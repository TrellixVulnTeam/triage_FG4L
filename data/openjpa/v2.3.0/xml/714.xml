<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:42:26 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-714/OPENJPA-714.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-714] &quot;Encountered unmanaged object in persistent field&quot; error while merging object tree</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-714</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;I get following error while merging a persisted entity A after adding new child entities to it.  The following relation exists between entities:  A -&amp;gt; (many to many) B -&amp;gt; (one to many) C. If I add &quot;cascade= &lt;/p&gt;
{CascadeType.MERGE, CascadeType.PERSIST}
&lt;p&gt;&quot; to ChainEntityC.chainEntityB field It works.&lt;/p&gt;

&lt;p&gt;My opinion is the cascade type on entity C should not be necessary because C is the last entity in the chain and should be cascaded from A to B to C. Cascade from C to B does not sound logical. The information is already given using foreignkey and cascase annotation. &lt;/p&gt;

&lt;p&gt;The test code is attached and works if you copy it to openjpa-persistence-jdbc test module. &lt;/p&gt;

&lt;p&gt;Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 3.62 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
testChainEntities(org.apache.openjpa.persistence.relations.TestChainEntities)  Time elapsed: 3.561 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
&amp;lt;openjpa-1.1.0-r422266:659716 nonfatal user error&amp;gt; org.apache.openjpa.persistence.InvalidStateException: Encountered unmanaged object in persistent field &quot;org.apache.openjpa.persistence.relations.ChainEntityC.chainEntityB&quot; during flush.  However, this field does not allow cascade persist. Set the cascade attribute for this field to CascadeType.PERSIST or CascadeType.ALL (JPA annotations) or &quot;persist&quot; or &quot;all&quot; (JPA orm.xml), or enable cascade-persist globally, or manually persist the related field value prior to flushing. You cannot flush unmanaged objects or graphs that have persistent associations to unmanaged objects.&lt;br/&gt;
FailedObject: org.apache.openjpa.persistence.relations.ChainEntityB@42a818&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlushPC(SingleFieldManager.java:753)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlush(SingleFieldManager.java:594)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlush(SingleFieldManager.java:562)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlush(SingleFieldManager.java:478)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.preFlush(StateManagerImpl.java:2819)&lt;br/&gt;
        at org.apache.openjpa.kernel.PNewProvisionalState.nonprovisional(PNewProvisionalState.java:44)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.nonprovisional(StateManagerImpl.java:1130)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlushPC(SingleFieldManager.java:772)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlushPCs(SingleFieldManager.java:735)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlush(SingleFieldManager.java:637)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlush(SingleFieldManager.java:562)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlush(SingleFieldManager.java:478)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.preFlush(StateManagerImpl.java:2819)&lt;br/&gt;
        at org.apache.openjpa.kernel.PNewProvisionalState.nonprovisional(PNewProvisionalState.java:44)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.nonprovisional(StateManagerImpl.java:1130)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlushPC(SingleFieldManager.java:772)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlushPCs(SingleFieldManager.java:735)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlush(SingleFieldManager.java:637)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlush(SingleFieldManager.java:562)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.preFlush(SingleFieldManager.java:478)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.preFlush(StateManagerImpl.java:2819)&lt;br/&gt;
        at org.apache.openjpa.kernel.PDirtyState.beforeFlush(PDirtyState.java:37)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.beforeFlush(StateManagerImpl.java:957)&lt;br/&gt;
        at org.apache.openjpa.kernel.BrokerImpl.flush(BrokerImpl.java:1945)&lt;br/&gt;
        at org.apache.openjpa.kernel.BrokerImpl.flushSafe(BrokerImpl.java:1905)&lt;br/&gt;
        at org.apache.openjpa.kernel.BrokerImpl.beforeCompletion(BrokerImpl.java:1823)&lt;br/&gt;
        at org.apache.openjpa.kernel.LocalManagedRuntime.commit(LocalManagedRuntime.java:81)&lt;br/&gt;
        at org.apache.openjpa.kernel.BrokerImpl.commit(BrokerImpl.java:1347)&lt;br/&gt;
        at org.apache.openjpa.kernel.DelegatingBroker.commit(DelegatingBroker.java:877)&lt;br/&gt;
        at org.apache.openjpa.persistence.EntityManagerImpl.commit(EntityManagerImpl.java:512)&lt;br/&gt;
        at org.apache.openjpa.persistence.relations.TestChainEntities.chainUpdate(TestChainEntities.java:59)&lt;br/&gt;
        at org.apache.openjpa.persistence.relations.TestChainEntities.testChainEntities(TestChainEntities.java:27)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at junit.framework.TestCase.runTest(TestCase.java:154)&lt;br/&gt;
        at junit.framework.TestCase.runBare(TestCase.java:127)&lt;br/&gt;
        at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
        at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
        at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
        at junit.framework.TestCase.run(TestCase.java:118)&lt;br/&gt;
        at org.apache.openjpa.persistence.test.PersistenceTestCase.run(PersistenceTestCase.java:122)&lt;br/&gt;
        at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
        at junit.framework.TestSuite.run(TestSuite.java:203)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.apache.maven.surefire.junit.JUnitTestSet.execute(JUnitTestSet.java:213)&lt;br/&gt;
        at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:140)&lt;br/&gt;
        at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:127)&lt;br/&gt;
        at org.apache.maven.surefire.Surefire.run(Surefire.java:177)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:334)&lt;br/&gt;
        at org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:980)&lt;/p&gt;


&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests in error:&lt;br/&gt;
  testChainEntities(org.apache.openjpa.persistence.relations.TestChainEntities)&lt;/p&gt;

&lt;p&gt;Tests run: 1, Failures: 0, Errors: 1, Skipped: 0&lt;/p&gt;</description>
                <environment>Fedora Linux 6&lt;br/&gt;
java version &amp;quot;1.5.0_11&amp;quot;</environment>
        <key id="12403675">OPENJPA-714</key>
            <summary>&quot;Encountered unmanaged object in persistent field&quot; error while merging object tree</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikedd">Michael Dick</assignee>
                                    <reporter username="ekinsokmen">Ekin Sokmen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Sep 2008 13:37:58 +0100</created>
                <updated>Tue, 9 Mar 2010 18:31:01 +0000</updated>
                            <resolved>Tue, 12 Jan 2010 19:35:01 +0000</resolved>
                                    <version>1.1.0</version>
                    <version>1.2.0</version>
                                    <fixVersion>1.2.2</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-beta</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12628327" author="ekinsokmen" created="Thu, 4 Sep 2008 13:41:02 +0100"  >&lt;p&gt;The test code is attached and works if you copy it into openjpa-persistence-jdbc module. &lt;/p&gt;

&lt;p&gt;Error output get using command:&lt;br/&gt;
mvn test -Dtest=TestChainEntities&lt;/p&gt;</comment>
                            <comment id="12628652" author="techhusky" created="Fri, 5 Sep 2008 16:27:55 +0100"  >&lt;p&gt;Adding my original response from the user mailing list (below) for documentation purposes.  Arguably, I think OpenJPA is behaving within the spec, but it does seem like there should be enough information to do the merge.  I have your test running and will take a more in-depth look at this issue.&lt;/p&gt;

&lt;p&gt;On Wed, Jul 9, 2008 at 7:52 PM, Jeremy Bauer &amp;lt;techhusky@gmail.com&amp;gt; wrote:&lt;/p&gt;

&lt;p&gt;&amp;gt; I ran into a similar issue last week while using the merge operation.&lt;br/&gt;
&amp;gt; I found that since I had a bi-directional relationship with unmanaged&lt;br/&gt;
&amp;gt; entities (B &amp;lt;---&amp;gt; C in your case), OpenJPA needed both PERSIST and&lt;br/&gt;
&amp;gt; MERGE cascade enabled in order to maintain both sides of the&lt;br/&gt;
&amp;gt; relationship.  That way, new related entities can be persisted and&lt;br/&gt;
&amp;gt; existing entities can be merged from either side of the relationship.&lt;br/&gt;
&amp;gt; This behavior does not appear to be specifically defined by section&lt;br/&gt;
&amp;gt; 3.2.4.1 of the JPA spec, but it is also in my opinion, not&lt;br/&gt;
&amp;gt; contradictory to the requirements which are defined.  I could be&lt;br/&gt;
&amp;gt; totally off, but I was able to twist my own arm hard enough to&lt;br/&gt;
&amp;gt; convince myself that OpenJPA is working as expected.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; Besides adding adding the cascade options to C, if you make the B ---&amp;gt;&lt;br/&gt;
&amp;gt; C relationship uni-directional or merge B (making it managed) before&lt;br/&gt;
&amp;gt; relating it to C (and vice-versa), the test also worked for me without&lt;br/&gt;
&amp;gt; problems.&lt;/p&gt;
</comment>
                            <comment id="12790806" author="fyrewyld" created="Tue, 15 Dec 2009 16:33:47 +0000"  >&lt;p&gt;Updated the junit tests for this patch&lt;/p&gt;</comment>
                            <comment id="12798095" author="jpaheath" created="Fri, 8 Jan 2010 17:48:34 +0000"  >&lt;p&gt;See comments for description of changes.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12428053" name="OpenJPA_1.2.x.patch" size="13802" author="fyrewyld" created="Tue, 15 Dec 2009 16:33:47 +0000"/>
                            <attachment id="12389495" name="testcase_jira714.zip" size="2984" author="ekinsokmen" created="Thu, 4 Sep 2008 13:41:02 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 5 Sep 2008 15:27:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161024</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyswwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202680</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>