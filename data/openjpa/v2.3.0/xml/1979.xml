<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:32:48 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1979/OPENJPA-1979.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1979] Regression for non-standard joins with constant column values </title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1979</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;The non-standard join can use constant column values by enclosing them in single-quote character. This behavior is regressed. The likely cause of this regression is new delimiting support for schema elements introduced in JPA 2.0. The constant column value used to be detected during schema definition based on the assumption of the name being enclosed in single-quote. Due to introduction of delimiting capability, the constant value is now enclosed in double-quote followed by a single-quote.   &lt;/p&gt;

&lt;p&gt;The visible effect is failure to define schema for non-standard join with constant values.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12504099">OPENJPA-1979</key>
            <summary>Regression for non-standard joins with constant column values </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ppoddar@apache.org">Pinaki Poddar</assignee>
                                    <reporter username="ppoddar@apache.org">Pinaki Poddar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Apr 2011 21:33:39 +0100</created>
                <updated>Fri, 16 May 2014 04:25:26 +0100</updated>
                            <resolved>Thu, 28 Mar 2013 15:26:20 +0000</resolved>
                                    <version>2.0.0-M1</version>
                    <version>2.0.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>jdbc</component>
                    <component>kernel</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13019024" author="ppoddar@apache.org" created="Tue, 12 Apr 2011 21:37:55 +0100"  >&lt;p&gt;The test case uses non-standard join for schema definition.&lt;br/&gt;
The domain classes will fail to define database schema&lt;/p&gt;</comment>
                            <comment id="13019029" author="ppoddar@apache.org" created="Tue, 12 Apr 2011 21:45:24 +0100"  >&lt;p&gt;This is a patch to fix the problem. &lt;br/&gt;
WARNING: Only partially tested.&lt;/p&gt;</comment>
                            <comment id="13019040" author="techhusky" created="Tue, 12 Apr 2011 22:00:28 +0100"  >&lt;p&gt;Hey Pinaki.  Your patch looks good to me.  We may need to look at the XML mapping parser as well.  It looks like we were sorely lacking a jUnit for this scenario...&lt;/p&gt;</comment>
                            <comment id="13019067" author="ppoddar@apache.org" created="Tue, 12 Apr 2011 22:45:21 +0100"  >&lt;p&gt;&amp;gt; XML mapping parser as well. &lt;br/&gt;
Yes, of course.&lt;/p&gt;

&lt;p&gt;&amp;gt; lacking a jUnit f&lt;br/&gt;
The test case patch has ASF license granted. One can consider including it. The test case does not conform setUp() routine though.&lt;/p&gt;

&lt;p&gt;Another couple of points:&lt;br/&gt;
a)   There are few more rules to determine whether a specification denotes constant-valued column (ref: MappingInfo.meregColumn(...) and assignment of the local boolean variable named &apos;constant&apos;). The quick patch does not work out those rules.&lt;/p&gt;

&lt;p&gt;b) The downstream effect of changing DBIdentifierType to CONSTANT instead of usual COLUMN not investigated. It was just done to stop the columnName being delimited. &lt;/p&gt;</comment>
                            <comment id="13121919" author="mspiro" created="Thu, 6 Oct 2011 14:17:37 +0100"  >&lt;p&gt;I opened a duplicate issue &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2054&quot; title=&quot;Constant join fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2054&quot;&gt;&lt;del&gt;OPENJPA-2054&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Pinaki, your patch handles only the case with a string constant but doesn`t handle numeric constants (beginning with a digit, a dot or a minus sign). &quot;Null&quot; should also be considered a constant. Shouldn&apos;t this be added? I think the parsing logic should be the same as in MappingInfo.mergeJoinColumn().&lt;/p&gt;</comment>
                            <comment id="13280090" author="thirion" created="Mon, 21 May 2012 12:23:10 +0100"  >&lt;p&gt;Hi.&lt;/p&gt;

&lt;p&gt;I checked out version 2.2.0 and found that this patch wasn&apos;t applied yet.&lt;br/&gt;
Based on Micael&apos;s question, I modified the method as follows and I can confirm that it worked with constant values as numbers and text:&lt;/p&gt;

&lt;p&gt;private Column newColumn(JoinColumn join) {&lt;br/&gt;
        Column col = new Column();&lt;br/&gt;
        if (!StringUtils.isEmpty(join.name()))&lt;br/&gt;
            col.setIdentifier(DBIdentifier.newColumn(join.name(), delimit()));&lt;br/&gt;
        if (!StringUtils.isEmpty(join.columnDefinition()))&lt;br/&gt;
            col.setTypeIdentifier(DBIdentifier.newColumnDefinition(join.columnDefinition()));&lt;br/&gt;
//        if (!StringUtils.isEmpty(join.referencedColumnName())) //f fix from openjpa-1979&lt;br/&gt;
//            col.setTargetIdentifier(DBIdentifier.newColumn(join.referencedColumnName(), delimit()));&lt;br/&gt;
        String joinColumnName = join.referencedColumnName();&lt;br/&gt;
        if (!StringUtils.isEmpty(joinColumnName)) {&lt;br/&gt;
            boolean isConstant = joinColumnName.charAt(0) == &apos;\&apos;&apos;;&lt;br/&gt;
            if(!isConstant){&lt;br/&gt;
                if (joinColumnName.charAt(0) == &apos;-&apos;&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; joinColumnName.charAt(0) == &apos;.&apos;&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Character.isDigit(joinColumnName.charAt(0))) {&lt;br/&gt;
                    isConstant = true;&lt;br/&gt;
                    try 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {                        if (joinColumnName.indexOf(&amp;#39;.&amp;#39;) == -1){
                            new Integer(joinColumnName);
                        } else{
                            new Double(joinColumnName);
                        }                    }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; catch (NumberFormatException nfe) &lt;/p&gt;
{
                        throw new RuntimeException(&quot;Constant Join Column is not a Valid Number: &quot; + joinColumnName
                                + &quot;, Join: &quot; + join);
                    }
&lt;p&gt;                } else if (&quot;null&quot;.equalsIgnoreCase(joinColumnName))&lt;/p&gt;
{
                    isConstant = true;
                }
&lt;p&gt;            }&lt;/p&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;            if (isConstant) &lt;/p&gt;
{
                col.setTargetIdentifier(DBIdentifier.newConstant(joinColumnName));
            }
&lt;p&gt; else &lt;/p&gt;
{
                col.setTargetIdentifier(DBIdentifier.newColumn(joinColumnName, delimit()));
            }
&lt;p&gt;        }&lt;br/&gt;
        col.setNotNull(!join.nullable());&lt;br/&gt;
        col.setFlag(Column.FLAG_UNINSERTABLE, !join.insertable());&lt;br/&gt;
        col.setFlag(Column.FLAG_UNUPDATABLE, !join.updatable());&lt;br/&gt;
        return col;&lt;br/&gt;
    }&lt;/p&gt;</comment>
                            <comment id="13283824" author="david minor" created="Sat, 26 May 2012 00:50:29 +0100"  >&lt;p&gt;A similar fix is also needed for &apos;private static Column newColumn(ElementJoinColumn join, boolean delimit)&apos;, and possibly the other join annotations if they used to support constant joins.&lt;/p&gt;</comment>
                            <comment id="13529006" author="pat_mccabe" created="Tue, 11 Dec 2012 14:31:20 +0000"  >&lt;p&gt;Hello.  Is there any update on if/when this fix will be available ? &lt;/p&gt;</comment>
                            <comment id="13615681" author="jira-bot" created="Wed, 27 Mar 2013 20:05:28 +0000"  >&lt;p&gt;Commit 1461833 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ppoddar%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;ppoddar@apache.org&quot;&gt;Pinaki Poddar&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1461833&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1461833&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1979&quot; title=&quot;Regression for non-standard joins with constant column values &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1979&quot;&gt;&lt;del&gt;OPENJPA-1979&lt;/del&gt;&lt;/a&gt;: reference column name starting with single-quote &lt;b&gt;not&lt;/b&gt; delimited as they have special semantics for non-standard constant join&lt;/p&gt;</comment>
                            <comment id="13661601" author="jira-bot" created="Sun, 19 May 2013 18:06:18 +0100"  >&lt;p&gt;Commit 1484313 from hthomann&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1484313&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1484313&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1979&quot; title=&quot;Regression for non-standard joins with constant column values &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1979&quot;&gt;&lt;del&gt;OPENJPA-1979&lt;/del&gt;&lt;/a&gt;: Regression for non-standard joins with constant column values - back ported to 2.1.x Pinaki Poddar&apos;s trunk changes.&lt;/p&gt;</comment>
                            <comment id="13661608" author="jira-bot" created="Sun, 19 May 2013 18:53:43 +0100"  >&lt;p&gt;Commit 1484322 from hthomann&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1484322&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1484322&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1979&quot; title=&quot;Regression for non-standard joins with constant column values &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1979&quot;&gt;&lt;del&gt;OPENJPA-1979&lt;/del&gt;&lt;/a&gt;: Regression for non-standard joins with constant column values - back ported to 2.2.1.x Pinaki Poddar&apos;s trunk changes.&lt;/p&gt;</comment>
                            <comment id="13661615" author="jira-bot" created="Sun, 19 May 2013 19:02:57 +0100"  >&lt;p&gt;Commit 1484326 from hthomann&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1484326&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1484326&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1979&quot; title=&quot;Regression for non-standard joins with constant column values &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1979&quot;&gt;&lt;del&gt;OPENJPA-1979&lt;/del&gt;&lt;/a&gt;: Regression for non-standard joins with constant column values - back ported to 2.2.x Pinaki Poddar&apos;s trunk changes.&lt;/p&gt;</comment>
                            <comment id="13999161" author="byoder" created="Thu, 15 May 2014 20:44:52 +0100"  >&lt;p&gt;I think it may still not be working for constant numeric values.  Maybe you fixed for constant string values, but I am still getting errors in 2.3.0 using hardcoded numbers:&lt;/p&gt;

&lt;p&gt;&amp;lt;openjpa-2.3.0-r422266:1540826 fatal user error&amp;gt; org.apache.openjpa.persistence.ArgumentException: &quot;com.sscims.im.entity.IMSObject.refObject&quot; defines a target of &quot;&quot;14&quot;&quot; for column &quot;entity_type_id&quot;, but that target does not exist in table &quot;dbo.im_ims_obj&quot;.&lt;/p&gt;

&lt;p&gt;@ManyToOne(fetch=FetchType.LAZY)&lt;br/&gt;
@JoinTable(&lt;br/&gt;
        name=&quot;im_ref&quot;,&lt;br/&gt;
        joinColumns=&lt;/p&gt;
{
            @JoinColumn(name=&quot;entity_type_id&quot;, referencedColumnName=&quot;14&quot;),
            @JoinColumn(name=&quot;entity_id&quot;, referencedColumnName=&quot;obj_type_id&quot;)
        }
&lt;p&gt;    )	&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12714698">OPENJPA-2503</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12525332">OPENJPA-2054</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12525332">OPENJPA-2054</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12476166" name="OPENJPA-1979.patch.1.txt" size="1478" author="ppoddar@apache.org" created="Tue, 12 Apr 2011 21:45:24 +0100"/>
                            <attachment id="12476160" name="Test-1979.zip" size="10438" author="ppoddar@apache.org" created="Tue, 12 Apr 2011 21:37:55 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Apr 2011 21:00:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2348</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyyfu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234908</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>