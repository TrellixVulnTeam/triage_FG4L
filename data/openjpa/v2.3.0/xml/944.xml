<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:43:36 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-944/OPENJPA-944.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-944] FetchAttribute.recursionDepth = -1 does not load properly self referenced entities in a complex relation</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-944</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;A problem with loading recursively referenced entities was found when there is a complex relation of the following kind:&lt;br/&gt;
Leaf &amp;lt;&lt;del&gt;&amp;gt; BranchConnection &amp;lt;&lt;/del&gt;&amp;gt; Branch(1) &amp;lt;- Branch(2) &amp;lt;- ...&lt;br/&gt;
where Branch has a self reference to itself.&lt;/p&gt;

&lt;p&gt;Using a FetchPlan with a fetch group that has a fetch attribute with recursionDepth=-1 does not produce the expected result and only the first of the Branch nodes is loaded. &lt;br/&gt;
Loading a Leaf with 5 branches in a row and traversing through them fails right on level 3 (starting from 5 downwards) which leads to the thought that OpenJPA loads only the first element (along with its direct parent).&lt;/p&gt;</description>
                <environment>JDK: Sun 1.5&lt;br/&gt;
Database: Derby 10.2.2.0&lt;br/&gt;
OS: Windows XP </environment>
        <key id="12415697">OPENJPA-944</key>
            <summary>FetchAttribute.recursionDepth = -1 does not load properly self referenced entities in a complex relation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ppoddar@apache.org">Pinaki Poddar</assignee>
                                    <reporter username="yzhivkov">Yanko Zhivkov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Feb 2009 18:58:03 +0000</created>
                <updated>Tue, 9 Mar 2010 18:31:10 +0000</updated>
                            <resolved>Mon, 18 Jan 2010 21:36:05 +0000</resolved>
                                    <version>1.0.0</version>
                    <version>1.0.1</version>
                    <version>1.0.2</version>
                    <version>1.0.3</version>
                    <version>1.1.0</version>
                    <version>1.2.0</version>
                                    <fixVersion>2.0.0-beta</fixVersion>
                                    <component>jdbc</component>
                    <component>kernel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12677102" author="yzhivkov" created="Thu, 26 Feb 2009 18:59:35 +0000"  >&lt;p&gt;Attached a test case that shows the error. I tried the test case with 1.0.0, 1.0.1, 1.0.3, 1.1.0 and 1.2.0 and even with the latest trunk code but neither of them work.&lt;/p&gt;

&lt;p&gt;For running the test case unzip the zip file and execute from a shell:&lt;br/&gt;
  mvn install&lt;/p&gt;

&lt;p&gt;The provided test case extends SingleEMFTestCase and can directly be copied into openjpa-persistence-jdbc/src/test for being executed within there as well.&lt;/p&gt;</comment>
                            <comment id="12677108" author="yzhivkov" created="Thu, 26 Feb 2009 19:20:06 +0000"  >&lt;p&gt;Could be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-911&quot; title=&quot;Issue with FetchAttribute recursionDepth &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-911&quot;&gt;OPENJPA-911&lt;/a&gt;. The only difference is that the attached to this bug test case works for release 1.0.0 whilst my test case does not work for any released version of OpenJPA.&lt;/p&gt;</comment>
                            <comment id="12700993" author="yzhivkov" created="Tue, 21 Apr 2009 01:07:26 +0100"  >&lt;p&gt;Attached patch files for fixing that issue for OpenJPA versions 1.0.1 and 1.2.1. The same changes could be used for the other versions as well.&lt;/p&gt;

&lt;p&gt;I think the problem is that the recursion depth is not calculated properly. When the FetchConfiguration is created for every field-to-field relation only the type of the FieldMetaData is taken into consideration. This causes a confusion of what the real recursion depth is. &lt;br/&gt;
For example if the field BranchConnection.branch refers to Branch and Branch.parent has a reference to Branch then there is the following field metadata:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Field &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; From Type &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Recursion Depth &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; branch &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Branch &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; parent &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Branch &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; -1 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;When the mappings are built and OpenJPA gets to BranchConnection.branch - &amp;gt; Branch.parent and tries to add the new field Branch.parent it will try to find an already existing limit and will compare the From Type of the new field to the From Type of the existing mappings (parents of the new mapping).&lt;br/&gt;
As the second mapping in the table has not been created yet it will grab the first one which is not what we expect and will set recursion depth 1. This prevents from getting the real recursion depth and only the first parent of the Branch connected to BranchConnection will be loaded.&lt;/p&gt;

&lt;p&gt;For fixing this behavior a new check for the field name was added. This makes sure that when the recursion depth is being determined only the mappings that are of the same kind (fromField and fromType) will be taken into consideration.&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12414274">OPENJPA-911</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12405970" name="fix_recursive_entity_loading-OPENJPA-944-openjpa1.0.1.patch" size="1948" author="yzhivkov" created="Tue, 21 Apr 2009 01:07:26 +0100"/>
                            <attachment id="12405971" name="fix_recursive_entity_loading-OPENJPA-944-openjpa1.2.1.patch" size="1979" author="yzhivkov" created="Tue, 21 Apr 2009 01:07:26 +0100"/>
                            <attachment id="12401060" name="openjpa_complex_relation_recursion_test.zip" size="16613" author="yzhivkov" created="Thu, 26 Feb 2009 18:59:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161242</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysqr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>201682</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>