<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:30:49 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-680/OPENJPA-680.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-680] Flush followed by refresh on a new instance returns an instance with all fields but id cleared</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-680</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;This looks to be resolved.  I&apos;ll mark the fix versions according to the commits and then resolve it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12401950">OPENJPA-680</key>
            <summary>Flush followed by refresh on a new instance returns an instance with all fields but id cleared</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ssegu">Srinivasa</assignee>
                                    <reporter username="ssegu">Srinivasa</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Aug 2008 02:12:24 +0100</created>
                <updated>Thu, 11 Mar 2010 14:26:31 +0000</updated>
                            <resolved>Wed, 3 Mar 2010 18:33:10 +0000</resolved>
                                    <version>1.2.0</version>
                    <version>1.2.1</version>
                    <version>1.3.0</version>
                                    <fixVersion>1.1.1</fixVersion>
                    <fixVersion>1.2.2</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-M1</fixVersion>
                                    <component>kernel</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12620801" author="ssegu" created="Fri, 8 Aug 2008 02:13:06 +0100"  >&lt;p&gt;Testcase&lt;/p&gt;</comment>
                            <comment id="12621995" author="allee8285" created="Tue, 12 Aug 2008 22:40:16 +0100"  >&lt;p&gt;This patch has regressed the TCK in trunk and 1.2.x branch. The errors reported in openjpa-tck.log are:&lt;/p&gt;

&lt;p&gt;------------------------------------------&lt;br/&gt;
********************************************************************************&lt;br/&gt;
Beginning Test:  com.sun.ts.tests.ejb30.persistence.callback.listener.Client.postLoadMultiTest_from_standalone&lt;br/&gt;
********************************************************************************&lt;br/&gt;
08-12-2008 04:52:05:  Harness - harness.executeMode is set to &quot;0&quot;&lt;br/&gt;
08-12-2008 04:52:05:  Harness - sClassPathFromExecProps = &lt;br/&gt;
command: com.sun.ts.lib.harness.ExecTSTestCmd CLASSPATH=../classes:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/classes:/root/.m2/repository/org/apache/derby/derby/10.2.1.6/derby-10.2.1.6.jar:/root/.m2/repository/javax/persistence/persistence-api/1.0b/persistence-api-1.0b.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-kernel/target/classes:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-lib/target/openjpa-lib-1.3.0-SNAPSHOT.jar:/root/.m2/repository/commons-logging/commons-logging/1.0.4/commons-logging-1.0.4.jar:/root/.m2/repository/log4j/log4j/1.2.13/log4j-1.2.13.jar:/root/.m2/repository/commons-lang/commons-lang/2.1/commons-lang-2.1.jar:/root/.m2/repository/ant/ant/1.6.5/ant-1.6.5.jar:/root/.m2/repository/commons-collections/commons-collections/3.2/commons-collections-3.2.jar:/root/.m2/repository/net/sourceforge/serp/serp/1.13.1/serp-1.13.1.jar:/root/.m2/repository/org/apache/geronimo/specs/geronimo-jms_1.1_spec/1.0.1/geronimo-jms_1.1_spec-1.0.1.jar:/root/.m2/repository/org/apache/geronimo/specs/geronimo-jta_1.1_spec/1.1/geronimo-jta_1.1_spec-1.1.jar:/root/.m2/repository/commons-pool/commons-pool/1.3/commons-pool-1.3.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/ant_sun.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/apiCheck.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/javatest.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/jaxen-core.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/jaxen-jdom.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/jdom.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/saxpath.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/sigtest.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/tsharness.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/tspackager.jar:/opt/jetbrains/TeamCity/plugins/maven-2.0.8/boot/classworlds-1.1.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/:../lib/tsharness.jar:../lib/sigtest.jar:../classes:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/classes:/root/.m2/repository/org/apache/derby/derby/10.2.1.6/derby-10.2.1.6.jar:/root/.m2/repository/javax/persistence/persistence-api/1.0b/persistence-api-1.0b.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-kernel/target/classes:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-lib/target/openjpa-lib-1.3.0-SNAPSHOT.jar:/root/.m2/repository/commons-logging/commons-logging/1.0.4/commons-logging-1.0.4.jar:/root/.m2/repository/log4j/log4j/1.2.13/log4j-1.2.13.jar:/root/.m2/repository/commons-lang/commons-lang/2.1/commons-lang-2.1.jar:/root/.m2/repository/ant/ant/1.6.5/ant-1.6.5.jar:/root/.m2/repository/commons-collections/commons-collections/3.2/commons-collections-3.2.jar:/root/.m2/repository/net/sourceforge/serp/serp/1.13.1/serp-1.13.1.jar:/root/.m2/repository/org/apache/geronimo/specs/geronimo-jms_1.1_spec/1.0.1/geronimo-jms_1.1_spec-1.0.1.jar:/root/.m2/repository/org/apache/geronimo/specs/geronimo-jta_1.1_spec/1.1/geronimo-jta_1.1_spec-1.1.jar:/root/.m2/repository/commons-pool/commons-pool/1.3/commons-pool-1.3.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/ant_sun.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/apiCheck.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/javatest.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/jaxen-core.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/jaxen-jdom.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/jdom.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/saxpath.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/sigtest.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/tsharness.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/lib/tspackager.jar:/opt/jetbrains/TeamCity/plugins/maven-2.0.8/boot/classworlds-1.1.jar:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/:../lib/javatest.jar:../tools/ant/lib/ant.jar:/opt/jetbrains/jdk/sun/jdk5/jre/../lib/tools.jar:DISPLAY=:0.0:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-integration/tck/target/tck/jpatck/src/../dist/com/sun/ts/tests/ejb30/persistence/callback/listener/ejb3_pm_callback_listener.jar HOME=/root windir= SYSTEMROOT= /opt/jetbrains/jdk/sun/jdk5/jre/bin/java -Dcts.tmp=../tmp -Djava.security.policy=../bin/harness.policy -Ddeliverable.class=com.sun.ts.lib.deliverable.jpa.JPADeliverable -javaagent:/opt/jetbrains/TeamCity/work/98561997f875f84e/openjpa-all/target/openjpa-1.3.0-SNAPSHOT.jar -Dopenjpa.MetaDataFactory=jpa(DefaultAccessType=PROPERTY) com.sun.ts.tests.common.vehicle.VehicleClient -p ../tmp/tstest.jte -t postLoadMultiTest -vehicle standalone&lt;br/&gt;
************************************************************&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;props file set to &quot;/tmp/root-cts-props.txt&quot;&lt;br/&gt;
************************************************************&lt;br/&gt;
setup&lt;br/&gt;
platform.mode is set to standalone, so tests are running in J2SE environment standalone mode.persistence.unit.name is set to JPATCK&lt;br/&gt;
persistence unit properites from user: 
{openjpa.jdbc.DBDictionary=StoreCharsAsNumbers=false, openjpa.FetchBatchSize=-1, openjpa.Compatibility=StrictIdentityValues=true, javax.persistence.provider=org.apache.openjpa.persistence.PersistenceProviderImpl, openjpa.ConnectionURL=jdbc:derby:derby-database;create=true, openjpa.Sequence=time, openjpa.ConnectionDriverName=org.apache.derby.jdbc.EmbeddedDriver, openjpa.Log=DefaultLevel=WARN, openjpa.ConnectionUserName=nousername, openjpa.jdbc.SchemaFactory=native(ForeignKeys=true), openjpa.ConnectionPassword=nopassword}
&lt;p&gt;persistence unit properites verified: &lt;/p&gt;
{openjpa.jdbc.DBDictionary=StoreCharsAsNumbers=false, openjpa.FetchBatchSize=-1, openjpa.Compatibility=StrictIdentityValues=true, javax.persistence.provider=org.apache.openjpa.persistence.PersistenceProviderImpl, openjpa.ConnectionURL=jdbc:derby:derby-database;create=true, openjpa.Sequence=time, openjpa.ConnectionDriverName=org.apache.derby.jdbc.EmbeddedDriver, openjpa.Log=DefaultLevel=WARN, openjpa.ConnectionUserName=nousername, openjpa.jdbc.SchemaFactory=native(ForeignKeys=true), openjpa.ConnectionPassword=nopassword}
&lt;p&gt;Product: In prePersist in class com.sun.ts.tests.ejb30.persistence.callback.common.ListenerA@c8c7d6&lt;br/&gt;
Product: In prePersist in class com.sun.ts.tests.ejb30.persistence.callback.common.ListenerB@18c5e67&lt;br/&gt;
Product: In prePersist in class com.sun.ts.tests.ejb30.persistence.callback.common.ListenerC@89c116&lt;br/&gt;
Product: In postPersist.com.sun.ts.tests.ejb30.persistence.callback.common.ListenerA@1c79dfc&lt;br/&gt;
Product: In postPersist.com.sun.ts.tests.ejb30.persistence.callback.common.ListenerB@553763&lt;br/&gt;
Product: In postPersist.com.sun.ts.tests.ejb30.persistence.callback.common.ListenerC@a75737&lt;br/&gt;
Product: In postLoad.com.sun.ts.tests.ejb30.persistence.callback.common.ListenerA@7f3b8a&lt;br/&gt;
Product: In postLoad.com.sun.ts.tests.ejb30.persistence.callback.common.ListenerB@11e1bbf&lt;br/&gt;
Product: In postLoad.com.sun.ts.tests.ejb30.persistence.callback.common.ListenerC@1afd9cc&lt;br/&gt;
Product: In postLoad.com.sun.ts.tests.ejb30.persistence.callback.common.ListenerA@3e926&lt;br/&gt;
Product: In postLoad.com.sun.ts.tests.ejb30.persistence.callback.common.ListenerB@bfd66a&lt;br/&gt;
Product: In postLoad.com.sun.ts.tests.ejb30.persistence.callback.common.ListenerC@95f290&lt;br/&gt;
org.apache.openjpa.kernel.DelegatingResultList@1566a6c&lt;br/&gt;
08-12-2008 04:52:11:  ERROR: Expecting result list: &lt;span class=&quot;error&quot;&gt;&amp;#91;ListenerA, ListenerB, ListenerC&amp;#93;&lt;/span&gt;, but actual: &lt;span class=&quot;error&quot;&gt;&amp;#91;ListenerA, ListenerB, ListenerC, ListenerA, ListenerB, ListenerC&amp;#93;&lt;/span&gt;&lt;br/&gt;
08-12-2008 04:52:11:  ERROR: Exception at: &lt;br/&gt;
08-12-2008 04:52:11:  ERROR: com.sun.ts.lib.harness.EETest$Fault: Expecting result list: &lt;span class=&quot;error&quot;&gt;&amp;#91;ListenerA, ListenerB, ListenerC&amp;#93;&lt;/span&gt;, but actual: &lt;span class=&quot;error&quot;&gt;&amp;#91;ListenerA, ListenerB, ListenerC, ListenerA, ListenerB, ListenerC&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.sun.ts.tests.ejb30.common.helper.Helper.compareResultList(Helper.java:30)&lt;br/&gt;
	at com.sun.ts.tests.ejb30.common.helper.Helper.compareResultList(Helper.java:36)&lt;br/&gt;
	at com.sun.ts.tests.ejb30.persistence.callback.listener.Client.postLoadMultiTest(Client.java:565)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
	at com.sun.ts.lib.harness.EETest.run(EETest.java:495)&lt;br/&gt;
	at com.sun.ts.lib.harness.ServiceEETest.run(ServiceEETest.java:112)&lt;br/&gt;
	at com.sun.ts.tests.common.vehicle.EmptyVehicleRunner.run(EmptyVehicleRunner.java:30)&lt;br/&gt;
	at com.sun.ts.lib.harness.ServiceEETest.run(ServiceEETest.java:102)&lt;br/&gt;
	at com.sun.ts.lib.harness.EETest.getPropsReady(EETest.java:392)&lt;br/&gt;
	at com.sun.ts.lib.harness.ServiceEETest.run(ServiceEETest.java:209)&lt;br/&gt;
	at com.sun.ts.lib.harness.EETest.run(EETest.java:204)&lt;br/&gt;
	at com.sun.ts.tests.common.vehicle.VehicleClient.main(VehicleClient.java:27)&lt;br/&gt;
Find All Products&lt;br/&gt;
Find All Orders&lt;br/&gt;
Find All LineItems&lt;br/&gt;
Cleanup done, calling super.cleanup&lt;br/&gt;
STATUS:Failed.Test case throws exception: com.sun.ts.lib.harness.EETest$Fault: Expecting result list: &lt;span class=&quot;error&quot;&gt;&amp;#91;ListenerA, ListenerB, ListenerC&amp;#93;&lt;/span&gt;, but actual: &lt;span class=&quot;error&quot;&gt;&amp;#91;ListenerA, ListenerB, ListenerC, ListenerA, ListenerB, ListenerC&amp;#93;&lt;/span&gt;&lt;br/&gt;
********************************************************************************&lt;br/&gt;
Finished Test:  FAILED........com.sun.ts.tests.ejb30.persistence.callback.listener.Client.postLoadMultiTest_from_standalone&lt;br/&gt;
********************************************************************************&lt;br/&gt;
Number of tests completed:  22 (21 passed, 1 failed, 0 with errors)&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;There are 3 more similar failures in:&lt;/p&gt;

&lt;p&gt;Finished Test:  FAILED........com.sun.ts.tests.ejb30.persistence.callback.listeneroverride.Client.postLoadMultiTest_from_standalone&lt;br/&gt;
Finished Test:  FAILED........com.sun.ts.tests.ejb30.persistence.callback.method.Client.postLoadMultiTest_from_standalone&lt;br/&gt;
Finished Test:  FAILED........com.sun.ts.tests.ejb30.persistence.callback.methodoverride.Client.postLoadMultiTest_from_standalone&lt;/p&gt;

&lt;p&gt;I have verified this by removing the patch in both trunk and 1.2.x and TCK is passing again.&lt;/p&gt;

&lt;p&gt;I am going revert the change out of trunk and 1.2.x.&lt;/p&gt;

&lt;p&gt;Albert Lee.&lt;/p&gt;</comment>
                            <comment id="12625010" author="ssegu" created="Sat, 23 Aug 2008 02:19:04 +0100"  >&lt;p&gt;after load and after refresh callbacks of openjpa were each resulting in a post load call resulting in the duplicates. Patch addressing the same and re-introducing the original fix.&lt;/p&gt;</comment>
                            <comment id="12840761" author="no1uno" created="Wed, 3 Mar 2010 17:53:30 +0000"  >&lt;p&gt;From the JPA 2.0 specification, section 3.2.5, &quot;If &lt;span class=&quot;error&quot;&gt;&amp;#91;entity&amp;#93;&lt;/span&gt; X is a new, detached, or removed entity, the IllegalArgumentException is thrown&quot;.&lt;/p&gt;

&lt;p&gt;This does not appear to be the case under OpenJPA 1.2.2:&lt;/p&gt;

&lt;p&gt;		SimpleEntity e = new SimpleEntity();&lt;br/&gt;
		em.persist(e);&lt;br/&gt;
		em.refresh(e);&lt;br/&gt;
		return e;&lt;/p&gt;

&lt;p&gt;I realize that OpenJPA 1.2.x is based on OpenJPA 1.0.  That specification is ambiguous as to what behavior would be expected.&lt;/p&gt;</comment>
                            <comment id="12840765" author="no1uno" created="Wed, 3 Mar 2010 18:03:32 +0000"  >&lt;p&gt;Seeing the same behavior with OpenJPA 2.0.0-beta.&lt;/p&gt;</comment>
                            <comment id="12840783" author="kwsutter" created="Wed, 3 Mar 2010 18:30:58 +0000"  >&lt;p&gt;Jerry,&lt;br/&gt;
In your example, SimpleEntity e is no longer &quot;new&quot; once you called persist(e).  At that point, e is now a managed instance and is a member of the persistence context.  So, the IllegalArgumentException would not be expected in this case.&lt;/p&gt;

&lt;p&gt;Kevin&lt;/p&gt;</comment>
                            <comment id="12843881" author="no1uno" created="Thu, 11 Mar 2010 02:44:23 +0000"  >&lt;p&gt;Thanks, Kevin.  It took a bit of thought, but I&apos;ve come to understand the error of my ways.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12388785" name="OPENJPA-680.patch" size="2230" author="ssegu" created="Sat, 23 Aug 2008 02:19:04 +0100"/>
                            <attachment id="12387791" name="testcase.zip" size="1390" author="ssegu" created="Fri, 8 Aug 2008 02:13:06 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 Aug 2008 21:40:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160992</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7lcv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288430</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>