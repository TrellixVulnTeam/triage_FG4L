<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:38:28 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-851/OPENJPA-851.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-851] Support for enhanced map collection (and corresponding annotations)</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-851</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description></description>
                <environment></environment>
        <key id="12411831">OPENJPA-851</key>
            <summary>Support for enhanced map collection (and corresponding annotations)</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12409670">OPENJPA-807</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="faywang">Fay Wang</assignee>
                                    <reporter username="faywang">Fay Wang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Jan 2009 03:42:51 +0000</created>
                <updated>Tue, 9 Mar 2010 18:31:06 +0000</updated>
                            <resolved>Fri, 23 Jan 2009 01:37:43 +0000</resolved>
                                                    <fixVersion>2.0.0-M2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12661431" author="faywang" created="Wed, 7 Jan 2009 03:45:16 +0000"  >&lt;p&gt;This subtask will cover the following items:&lt;/p&gt;

&lt;p&gt;(1) Enhanced map collection support 2.7 &lt;br/&gt;
(2) Support @MapKeyClass annotation and XML 10.1.27, 10.1.26 &lt;br/&gt;
(3) Support @MapKeyColumn annotation and XML 10.1.28, 2.7.1 &lt;br/&gt;
(4) Support @MapKeyJoinColumn annotation and XML 10.1.29 &lt;br/&gt;
(5) Support @MapKeyJoinColumns annotation and XML 10.1.30 &lt;br/&gt;
(6) Support @MappedById annotation and XML 10.1.31 &lt;br/&gt;
(7) Support orphanRemoval attribute on relationships 2.9, 10.1.33, 10.1.34 &lt;/p&gt;</comment>
                            <comment id="12663618" author="faywang" created="Wed, 14 Jan 2009 04:12:59 +0000"  >&lt;p&gt;Enhance map support (spec 2.7, 10.1.26, 10.1.27, 10.1.28, 10.1.29, 10.1.30) is committed r-734319.&lt;/p&gt;</comment>
                            <comment id="12664022" author="faywang" created="Thu, 15 Jan 2009 07:06:51 +0000"  >&lt;p&gt;More map support is committed r-734617 for bi-directional map in update operation&lt;/p&gt;</comment>
                            <comment id="12664421" author="faywang" created="Fri, 16 Jan 2009 06:51:55 +0000"  >&lt;p&gt;Xml orm support for MapKeyClass, MapKeyColumn, MayKeyJoinColumn is checked in r-734926.&lt;/p&gt;</comment>
                            <comment id="12665731" author="faywang" created="Wed, 21 Jan 2009 06:52:37 +0000"  >&lt;p&gt;ManyToMany Map support is checked in r-736245.&lt;/p&gt;</comment>
                            <comment id="12666384" author="faywang" created="Fri, 23 Jan 2009 01:37:25 +0000"  >&lt;p&gt;Completed:&lt;br/&gt;
==========&lt;br/&gt;
Item (1) - (6).&lt;/p&gt;

&lt;p&gt;Deferred:&lt;br/&gt;
========&lt;br/&gt;
Item (7) and (8) .&lt;/p&gt;

&lt;p&gt;Limitation:&lt;br/&gt;
=========&lt;br/&gt;
Bi-directional one-to-many/may-to-one map will not able to accommodate same map value with different map key.&lt;/p&gt;

&lt;p&gt;	Spec 2.7.1 indicates that for a bi-directional one-to-many/may-to-one map, by default, the map is mapped in the table of the entity that is the value of the map. Considering the following example:&lt;/p&gt;

&lt;p&gt;@Entity&lt;br/&gt;
public class Company &lt;/p&gt;
{
    @Id
    int id;
    
    @OneToMany(mappedBy=&quot;co&quot;)
    Map&amp;lt;Division, VicePresident&amp;gt; organization = new HashMap&amp;lt;Division, VicePresident&amp;gt;();

...
}

&lt;p&gt;@Entity&lt;br/&gt;
public class VicePresident &lt;/p&gt;
{
    @Id
    int id;
    
    String name;
  
    @ManyToOne
    Company co;
}


&lt;p&gt;The table of the VicePresident have the following columns: id, name, CO_ID, KEY_ID. Suppose the map &quot;organization&quot; has the following entries:&lt;br/&gt;
		   key	 value&lt;br/&gt;
                --------     ---------&lt;br/&gt;
                   Div1      VP1&lt;br/&gt;
                   Div2      VP2&lt;br/&gt;
                   Div3      VP3&lt;br/&gt;
                   Div4      VP1         &lt;/p&gt;

&lt;p&gt;Note that VP1 appears twice in the map table with different keys. However, due to primary key constraint, the VicePresident table can only have the following entries: &lt;/p&gt;

&lt;p&gt;        id       name      CO_ID    KEY_ID&lt;br/&gt;
       -----    -----------  -----------   -----------&lt;br/&gt;
    	1        VP1            1            Div1&lt;br/&gt;
	2        VP2            1            Div2&lt;br/&gt;
	3        VP3            1            Div3&lt;/p&gt;

&lt;p&gt;The limitation is therefore clear that for bi-directional map, it is impossible to have multiple entries with the same map value.&lt;/p&gt;


&lt;p&gt;Open Issues:&lt;br/&gt;
===========&lt;br/&gt;
Problem with AttributeOverrides on map key/value when any of them are embeddable.&lt;/p&gt;

&lt;p&gt;On page 36 of the Spec, AttributeOverride can be used when map key/value is embeddable. The following examples illustrates the problem of using AttributeOverride when both map key and value are embeddable. &lt;/p&gt;

&lt;p&gt;(1) case 1:&lt;/p&gt;

&lt;p&gt;    @ElementCollection&lt;br/&gt;
    @AttributeOverrides(&lt;/p&gt;
{
        @AttributeOverride(name=&quot;intVal1&quot;, column=@Column(name=&quot;intVal1_colA&quot;)),
        @AttributeOverride(name=&quot;intVal2&quot;, column=@Column(name=&quot;intVal2_colA&quot;))
    })&lt;br/&gt;
    Map&amp;lt;EmbeddableA, EmbeddableB&amp;gt; phoneNumbers = new HashMap&amp;lt;AFullPhoneName, PhoneNumber&amp;gt;(); &lt;br/&gt;
	&lt;br/&gt;
&lt;br/&gt;
(1) case 2:&lt;br/&gt;
    @ElementCollection&lt;br/&gt;
    @AttributeOverrides({
        @AttributeOverride(name=&quot;intVal1&quot;, column=@Column(name=&quot;intVal1_colA&quot;)),
        @AttributeOverride(name=&quot;intVal2&quot;, column=@Column(name=&quot;intVal2_colA&quot;))
    }
&lt;p&gt;)&lt;br/&gt;
    @AttributeOverrides(&lt;/p&gt;
{
        @AttributeOverride(name=&quot;intVal1&quot;, column=@Column(name=&quot;intVal1_colB&quot;)),
        @AttributeOverride(name=&quot;intVal2&quot;, column=@Column(name=&quot;intVal2_colB&quot;))
    }
&lt;p&gt;)&lt;br/&gt;
    Map&amp;lt;EmbeddableA, EmbeddableB&amp;gt; phoneNumbers = new HashMap&amp;lt;AFullPhoneName, PhoneNumber&amp;gt;(); &lt;/p&gt;

&lt;p&gt;	In both case, there is no way to know which embeddable the AttributeOverride applies to. One proposal is to create @EmbeddedKey and @EmbeddedValue annotations to distinguish these situations as follows:&lt;/p&gt;

&lt;p&gt;    @EmbeddedKey&lt;br/&gt;
    @AttributeOverrides(&lt;/p&gt;
{
        @AttributeOverride(name=&quot;intVal1&quot;, column=@Column(name=&quot;intVal1_colA&quot;)),
        @AttributeOverride(name=&quot;intVal2&quot;, column=@Column(name=&quot;intVal2_colA&quot;))
    }
&lt;p&gt;)&lt;/p&gt;

&lt;p&gt;     This feature can not be implemented until this issue is resolved.&lt;/p&gt;

&lt;p&gt;     Without the support of AttributeOverrides, the default column names for the embeddables are derived from the field or property names of the embeddable class. In the above example, if EmbeddableA and EmbeddableB have the same field names, there will be column name clashes, causing lost information or sql error.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161154</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysrjj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>201810</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>