<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:34:53 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-932/OPENJPA-932.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-932] Runtime enhancer doesn&apos;t work propery if there is a trailing persistence.xml file on the classpath.</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-932</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;I have an application where I am using runtime class enhancement via the javaagent and I set openjpa.RuntimeUnenhancedClasses=unsupported. My application works fine when running on 1.1.0 but when I moved to 1.2.0 (and 2.0.0) I started getting errors because my classes aren&apos;t being enhanced. &lt;/p&gt;

&lt;p&gt;After debugging I determined that I had a jar on the end of my classpath that had a META-INF/persistence.xml file in it. The extra persistence.xml file has no PUs defined, and should have been ignored. When I removed that jar from my classpath things starting working again. It also works if I put my META-INF/persistence.xml file on the end of my classpath.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12415255">OPENJPA-932</key>
            <summary>Runtime enhancer doesn&apos;t work propery if there is a trailing persistence.xml file on the classpath.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikedd">Michael Dick</assignee>
                                    <reporter username="curtisr7">Rick Curtis</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Feb 2009 19:50:11 +0000</created>
                <updated>Tue, 9 Mar 2010 18:31:10 +0000</updated>
                            <resolved>Tue, 16 Jun 2009 18:46:16 +0100</resolved>
                                    <version>1.2.0</version>
                    <version>2.0.0-M1</version>
                    <version>2.0.0-M2</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-M3</fixVersion>
                                    <component>kernel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12678152" author="curtisr7" created="Mon, 2 Mar 2009 23:10:16 +0000"  >&lt;p&gt;The bug is that we parse all URLs matching the provided resource name, but only return the PU names from the last URL that was parsed. We should be saving the results after each time we parse a URL and returning ALL results.&lt;/p&gt;

&lt;p&gt;In addition to the bug fix I added some error detection. If there are persistence unit name collisions for the provided resource name, a WARNING message will be logged.  See below for a snippet from a test run.&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; 297  WARN   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; openjpa.Persistence - The persistence unit &quot;jpa.connection-pool&quot; was found in the following resources &quot;[file:/C:/jpa/workspace-samples/projects/j&lt;br/&gt;
pa.connection.pool/bin/META-INF/persistence.xml, jar:&lt;a href=&quot;file:/C:/jpa/workspace-samples/projects/lib/test-bad.jar!/META-INF/persistence.xml&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/C:/jpa/workspace-samples/projects/lib/test-bad.jar!/META-INF/persistence.xml&lt;/a&gt;]&quot;. Please correct the problem as it may&lt;br/&gt;
have unexpected results.&lt;br/&gt;
...&lt;/p&gt;</comment>
                            <comment id="12679247" author="curtisr7" created="Thu, 5 Mar 2009 17:10:38 +0000"  >&lt;p&gt;Updated the patch to get a logger in a different manner. This patch is for trunk.&lt;/p&gt;</comment>
                            <comment id="12679636" author="curtisr7" created="Fri, 6 Mar 2009 16:24:48 +0000"  >&lt;p&gt;Changed the way I obtained a logger once again. &lt;/p&gt;</comment>
                            <comment id="12679652" author="mikedd" created="Fri, 6 Mar 2009 17:01:01 +0000"  >&lt;p&gt;Hi Rick,&lt;/p&gt;

&lt;p&gt;The current patch will &lt;b&gt;always&lt;/b&gt; log to StdErr. I think we&apos;d be better off saving the fact that there was a name collision and logging it after we&apos;ve parsed the configuration.&lt;/p&gt;

&lt;p&gt;I&apos;m also not sure we need a new logging level for this issue. Wouldn&apos;t one of the other levels, ie Runtime have sufficed? &lt;/p&gt;</comment>
                            <comment id="12679657" author="techhusky" created="Fri, 6 Mar 2009 17:26:02 +0000"  >&lt;p&gt;Comments on patch dated 2009-03-06 08:24 AM:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I don&apos;t think a new trace group should be added specifically for this warning.  (OpenJPA trace groups are well documented in the manual, so if a new group would need to be doc&apos;d if consensus is that a new group should be added.).  While this exception shows up during enhancement, it is in product derivation code so openjpa.Runtime may be better?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I&apos;m still struggling a bit with constructing a new config to get a logger, but OpenJPA doesn&apos;t really have anything configured at this point and I can&apos;t think of a cleaner way to get this important warning out there without other potentially messy changes.  The null check is good, IMHO.  The comment regarding its necessity can be removed.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The error message isn&apos;t completely clear as to what the problem is or how to fix it.  I think wording which includes the notion that &quot;persistence unit names should be unique&quot; may help.  (I&apos;d say must, but as this problem points out, we don&apos;t enforce it)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12680489" author="curtisr7" created="Tue, 10 Mar 2009 14:49:03 +0000"  >&lt;p&gt;The new patch has the following updates:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Removed the Persistence trace group.&lt;/li&gt;
	&lt;li&gt;The previous PU name collision detection and logging was removed as it would only detect collisions when using the PCEnhancerAgent.&lt;/li&gt;
	&lt;li&gt;PU name collisions are now detected and saved away, but not logged until an EMF is created for that PU.  The capability to make a PU name collision a fatal error exists, but I decided that course action is a bit extreme. I think new message is verbose enough that a user should be able to figure out what&apos;s going on if they&apos;re having problems.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;One question - Do I need a separate Jira for the PU name collision detection/logging since it is pretty much separate from the bug that this Jira was opened for?&lt;/p&gt;

&lt;p&gt;-Rick&lt;/p&gt;</comment>
                            <comment id="12680882" author="curtisr7" created="Wed, 11 Mar 2009 14:42:37 +0000"  >&lt;p&gt;For the unit test I needed to have multiple META-INF/persistence.xml files on my classpath and the test validates that all PUs are found that exist in those xml files. I wasn&apos;t quite sure what the &apos;proper&apos; way was to do this, but what I posted works... Please correct me if there is a better way.&lt;/p&gt;

&lt;p&gt;Note: The attached jar file needs to be expanded into openjpa-parent\openjpa-persistence\src\test.&lt;/p&gt;

&lt;p&gt;-Rick&lt;/p&gt;</comment>
                            <comment id="12680890" author="curtisr7" created="Wed, 11 Mar 2009 15:41:54 +0000"  >&lt;p&gt;Modified slightly to build the bad-persistence.jar rather than check it into svn.&lt;/p&gt;</comment>
                            <comment id="12681373" author="techhusky" created="Thu, 12 Mar 2009 16:13:24 +0000"  >&lt;p&gt;Comments on patches dated 2009-03-10 07:49 AM and 2009-03-11 08:41 AM.&lt;/p&gt;

&lt;p&gt;1) PUNameCollision and related methods in ProductDerivations should be moved to PersistenceProductDerivation to keep openjpa-lib free of persistence artifacts.&lt;/p&gt;

&lt;p&gt;2) Creating a jar is much preferred to checking one in, but I&apos;m not sold on that yet either since (unless I&apos;m mistaken) it is always in the classpath when running tests.  Anyone have other ideas for testing this scenario?&lt;/p&gt;</comment>
                            <comment id="12681478" author="curtisr7" created="Thu, 12 Mar 2009 20:25:59 +0000"  >&lt;ul&gt;
	&lt;li&gt;Refactored the code in response to comment one from above.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12700293" author="techhusky" created="Fri, 17 Apr 2009 20:17:20 +0100"  >&lt;p&gt;Rick - I applied this patch and have a few comments/issues.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I&apos;m OK with loading an additional jar to the test classpath in the openjpa-persistence sub-project since there are very few tests that run in that package.  The code is only testing a warning path and shouldn&apos;t affect the behavior of those tests.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I could not force the production of the new warning message using the provided code (which I think is the intent of bad-persistence.xml) since the persistence.xml&apos;s all use unique pu names.  Also, there was no test code to drive the code where the warning is logged.  Is one of the names used in bad-persistence supposed to be a duplicate?  Based on the code changes, the warning does not get logged unless one tries to create an emf with pu name that is a duplicate.  I created a simple test program to force the condition and it worked fine, but I think a test needs to be provided in order to produce and validate the warning condition, if possible.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12702484" author="curtisr7" created="Fri, 24 Apr 2009 19:52:57 +0100"  >&lt;p&gt;Looks like I forgot add my test case to SVN when I built the previous patch. &lt;/p&gt;</comment>
                            <comment id="12704293" author="techhusky" created="Wed, 29 Apr 2009 20:59:41 +0100"  >&lt;p&gt;Committed patch(es) for Rick to trunk under revision 769901.&lt;/p&gt;</comment>
                            <comment id="12708179" author="curtisr7" created="Mon, 11 May 2009 21:03:24 +0100"  >&lt;p&gt;The attached file removes changes I introduced in the pom.xml to test this patch. All of the &lt;b&gt;magic&lt;/b&gt; is now contained within the test.&lt;/p&gt;</comment>
                            <comment id="12708970" author="techhusky" created="Wed, 13 May 2009 16:28:11 +0100"  >&lt;p&gt;OPENJPA932.test.patch committed for Rick under revision 774393.  Nice work, Rick.  The code you&apos;ve added to dynamically create and load a persistence jar on the fly would be a great addition to a general test utility.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12406383" name="OPENJPA-932.patch" size="12462" author="curtisr7" created="Fri, 24 Apr 2009 19:52:57 +0100"/>
                            <attachment id="12402084" name="OPENJPA-932.patch" size="10565" author="curtisr7" created="Thu, 12 Mar 2009 20:25:59 +0000"/>
                            <attachment id="12407807" name="OPENJPA932.test.patch" size="6677" author="curtisr7" created="Mon, 11 May 2009 21:03:24 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 Mar 2009 17:01:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161230</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt587:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204027</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>