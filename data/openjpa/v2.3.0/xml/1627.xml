<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:33:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1627/OPENJPA-1627.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1627] ORderBy with @ElementJoinColumn and EmbeddedId uses wrong columns in SQL</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1627</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Typical bank example, Account with Transactions. It is a legacy db so Transaction has compound key - represented by TransactionId class.&lt;/p&gt;

&lt;p&gt;The problem is that the order by in the generated SQL is for columns mapped in the transaction entity NOT the TransacionId as expected.&lt;/p&gt;

&lt;p&gt;So the Account class has the following fragment....&lt;/p&gt;

&lt;p&gt;	@OneToMany(fetch = FetchType.LAZY, cascade = &lt;/p&gt;
{CascadeType.PERSIST}
&lt;p&gt;)&lt;br/&gt;
	@ElementJoinColumn(name=&quot;maccno&quot;, referencedColumnName=&quot;maccno&quot;)&lt;br/&gt;
	@OrderBy(value = &quot;_id._processDate ASC, _id._tranSequenceNumber ASC&quot;)&lt;br/&gt;
	private LinkedList&amp;lt;Transaction&amp;gt; _transactions;&lt;/p&gt;


&lt;p&gt;_processDate and _tranSequenceNumber are defined in the TransactionId class.&lt;/p&gt;

&lt;p&gt;Transaction has the following fragment....&lt;/p&gt;

&lt;p&gt;	@EmbeddedId&lt;br/&gt;
	private TransactionId _id;&lt;/p&gt;

&lt;p&gt;	@Column(name = &quot;mtrancde&quot;)&lt;br/&gt;
	private int _transactionCode;&lt;/p&gt;

&lt;p&gt;	@Column(name = &quot;mamount&quot;)&lt;br/&gt;
	private BigDecimal _amount;&lt;/p&gt;

&lt;p&gt;	@Column(name = &quot;mdesc&quot;)&lt;br/&gt;
	private String _description;&lt;/p&gt;


&lt;p&gt;	@Column(name = &quot;mactdate&quot;)&lt;br/&gt;
	private Date _actualDate;&lt;/p&gt;

&lt;p&gt;	@Column(name = &quot;mbranch&quot;)&lt;br/&gt;
	private int _branch;&lt;/p&gt;


&lt;p&gt;And TransactionId defines the primary key columns....&lt;/p&gt;

&lt;p&gt;@Embeddable&lt;br/&gt;
public class TransactionId {&lt;/p&gt;

&lt;p&gt;	@Column(name = &quot;maccno&quot;)&lt;br/&gt;
	private String _accountNumber;&lt;/p&gt;

&lt;p&gt;	@Column(name = &quot;mprocdate&quot;)&lt;br/&gt;
	private Date _processDate;&lt;/p&gt;

&lt;p&gt;	@Column(name = &quot;mtranseqno&quot;)&lt;br/&gt;
	private int _tranSequenceNumber;&lt;/p&gt;



&lt;p&gt;However the generated SQL is doing order by on columns mapped in Transaction:&lt;/p&gt;

&lt;p&gt;executing prepstmnt 23188098 SELECT t0.maccno, t0.mprocdate, t0.mtranseqno, t0.mactdate, t0.mamount, t0.mbranch, t0.mchqcash, t0.mdesc,&lt;br/&gt;
 t0.mtmnlno, t0.mtrancde, t0.mtrnfeed &lt;br/&gt;
FROM transaction t0 &lt;br/&gt;
WHERE t0.maccno = ? &lt;br/&gt;
ORDER BY t0.mamount ASC, t0.mbranch ASC &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(String) 000734123&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;(no idea why it chose mamount, mbranch)&lt;br/&gt;
The last line should be:&lt;/p&gt;

&lt;p&gt;ORDER BY t0.mprocdate ASC, t0.mtranseqno ASC &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(String) 000734123&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Michael&lt;/p&gt;</description>
                <environment>Windows 7 32 bit / Oracle XE</environment>
        <key id="12461804">OPENJPA-1627</key>
            <summary>ORderBy with @ElementJoinColumn and EmbeddedId uses wrong columns in SQL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="faywang">Fay Wang</assignee>
                                    <reporter username="mmcgovern">Michael McGovern</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Apr 2010 11:21:13 +0100</created>
                <updated>Wed, 12 Jan 2011 22:41:26 +0000</updated>
                            <resolved>Wed, 12 Jan 2011 22:41:26 +0000</resolved>
                                    <version>2.0.0-beta3</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>sql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12856140" author="faywang" created="Mon, 12 Apr 2010 20:46:47 +0100"  >&lt;p&gt;Hi Mike, can you test if the attached patch fix your problem? Thanks.&lt;/p&gt;
</comment>
                            <comment id="12858525" author="mmcgovern" created="Mon, 19 Apr 2010 15:47:21 +0100"  >

&lt;p&gt;Fay - thanks - that works very well.&lt;/p&gt;



&lt;p&gt;_________________________________________________________________&lt;br/&gt;
Need a new place to live? Find it on Domain.com.au&lt;br/&gt;
&lt;a href=&quot;http://clk.atdmt.com/NMN/go/157631292/direct/01/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://clk.atdmt.com/NMN/go/157631292/direct/01/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12858592" author="drwoods" created="Mon, 19 Apr 2010 17:57:41 +0100"  >&lt;p&gt;the fix has been checked into trunk (2.1)&lt;br/&gt;
will decide later if we want this in 2.0.1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12441536" name="ASF.LICENSE.NOT.GRANTED--OPENJPA-1627.patch" size="1803" author="faywang" created="Mon, 12 Apr 2010 20:46:47 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 12 Apr 2010 19:46:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161886</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysyd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202915</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>