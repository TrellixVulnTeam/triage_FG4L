<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:43:20 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-339/OPENJPA-339.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-339] Java 2 security Access denied in File.toURL() call</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-339</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Encounter the following access denial exception when Java 2 security is enabled in application server environment.&lt;/p&gt;

&lt;p&gt;File.toURL() is not documented which requires security check, however indirectly, the File.isDirectory() is invoked, which required security permission.&lt;/p&gt;

&lt;p&gt;Exception = java.security.AccessControlException&lt;br/&gt;
Source = com.ibm.ws.security.core.SecurityManager&lt;br/&gt;
probeid = 180&lt;br/&gt;
Stack Dump = java.security.AccessControlException: Access denied (java.io.FilePermission C:\WAS3\profiles\AppSrv01\installedApps\javajoeNode01Cell\EJB3JPACallbackBeanApp.ear\EJB3JPACallbackWebApp.war\WEB-INF\classes\suite\r70\base\jpaspec\callback\entities\AbstractCallbackEntity.class read)&lt;br/&gt;
        at java.security.AccessController.checkPermission(AccessController.java:104)&lt;br/&gt;
        at java.lang.SecurityManager.checkPermission(SecurityManager.java:547)&lt;br/&gt;
        at com.ibm.ws.security.core.SecurityManager.checkPermission(SecurityManager.java:189)&lt;br/&gt;
        at java.lang.SecurityManager.checkRead(SecurityManager.java:886)&lt;br/&gt;
        at java.io.File.isDirectory(File.java:747)&lt;br/&gt;
        at java.io.File.toURL(File.java:620)&lt;br/&gt;
        at org.apache.openjpa.lib.meta.FileMetaDataIterator.next(FileMetaDataIterator.java:114)&lt;br/&gt;
        at org.apache.openjpa.lib.meta.ClassArgParser.mapTypeNames(ClassArgParser.java:283)&lt;br/&gt;
        at org.apache.openjpa.meta.AbstractCFMetaDataFactory.scan(AbstractCFMetaDataFactory.java:778)&lt;br/&gt;
        at org.apache.openjpa.meta.AbstractCFMetaDataFactory.parsePersistentTypeNames(AbstractCFMetaDataFactory.java:637)&lt;br/&gt;
        at org.apache.openjpa.meta.AbstractCFMetaDataFactory.getPersistentTypeNames(AbstractCFMetaDataFactory.java:605)&lt;br/&gt;
        at org.apache.openjpa.meta.MetaDataRepository.getPersistentTypeNames(MetaDataRepository.java:1214)&lt;br/&gt;
        at org.apache.openjpa.meta.MetaDataRepository.loadPersistentTypes(MetaDataRepository.java:1231)&lt;br/&gt;
        at org.apache.openjpa.kernel.AbstractBrokerFactory.loadPersistentTypes(AbstractBrokerFactory.java:245)&lt;br/&gt;
        at org.apache.openjpa.kernel.AbstractBrokerFactory.newBroker(AbstractBrokerFactory.java:197)&lt;br/&gt;
        at org.apache.openjpa.kernel.DelegatingBrokerFactory.newBroker(DelegatingBrokerFactory.java:142)&lt;br/&gt;
        at org.apache.openjpa.persistence.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:190)&lt;br/&gt;
        at com.ibm.ws.persistence.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:37)&lt;br/&gt;
        at com.ibm.ws.persistence.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:28)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12376942">OPENJPA-339</key>
            <summary>Java 2 security Access denied in File.toURL() call</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="allee8285">Albert Lee</assignee>
                                    <reporter username="allee8285">Albert Lee</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Aug 2007 18:21:57 +0100</created>
                <updated>Tue, 30 Oct 2007 14:44:09 +0000</updated>
                            <resolved>Mon, 17 Sep 2007 23:25:31 +0100</resolved>
                                    <version>0.9.7</version>
                                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>lib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12523102" author="allee8285" created="Mon, 27 Aug 2007 22:04:30 +0100"  >&lt;p&gt;Find another failing security scenario that needs to fix:&lt;/p&gt;

&lt;p&gt;Exception = java.security.AccessControlException&lt;br/&gt;
Source = com.ibm.ws.security.core.SecurityManager&lt;br/&gt;
probeid = 180&lt;br/&gt;
Stack Dump = java.security.AccessControlException: Access denied (java.lang.RuntimePermission getClassLoader)&lt;br/&gt;
        at java.security.AccessController.checkPermission(AccessController.java:104)&lt;br/&gt;
        at java.lang.SecurityManager.checkPermission(SecurityManager.java:547)&lt;br/&gt;
        at com.ibm.ws.security.core.SecurityManager.checkPermission(SecurityManager.java:189)&lt;br/&gt;
        at java.lang.Thread.getContextClassLoader(Thread.java:488)&lt;br/&gt;
        at serp.bytecode.Project.loadClass(Project.java:116)&lt;br/&gt;
        at serp.bytecode.Project.loadClass(Project.java:86)&lt;br/&gt;
        at org.apache.openjpa.util.ProxyManagerImpl.generateProxyBeanBytecode(ProxyManagerImpl.java:629)&lt;br/&gt;
        at org.apache.openjpa.util.ProxyManagerImpl.getFactoryProxyBean(ProxyManagerImpl.java:452)&lt;br/&gt;
        at org.apache.openjpa.util.ProxyManagerImpl.newCustomProxy(ProxyManagerImpl.java:311)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.proxy(SingleFieldManager.java:126)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.storeObjectField(StateManagerImpl.java:2413)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.storeField(StateManagerImpl.java:2510)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.storeField(StateManagerImpl.java:769)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.store(StateManagerImpl.java:765)&lt;br/&gt;
        at org.apache.openjpa.jdbc.meta.strats.HandlerFieldStrategy.load(HandlerFieldStrategy.java:174)&lt;br/&gt;
        at org.apache.openjpa.jdbc.meta.FieldMapping.load(FieldMapping.java:789)&lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.JDBCStoreManager.load(JDBCStoreManager.java:833)&lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.JDBCStoreManager.load(JDBCStoreManager.java:785)&lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.JDBCStoreManager.initializeState(JDBCStoreManager.java:336)&lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.JDBCStoreManager.initialize(JDBCStoreManager.java:255)&lt;br/&gt;
        at org.apache.openjpa.kernel.DelegatingStoreManager.initialize(DelegatingStoreManager.java:111)&lt;br/&gt;
        at org.apache.openjpa.kernel.ROPStoreManager.initialize(ROPStoreManager.java:57)&lt;br/&gt;
        at org.apache.openjpa.kernel.BrokerImpl.initialize(BrokerImpl.java:878)&lt;br/&gt;
        at org.apache.openjpa.kernel.BrokerImpl.find(BrokerImpl.java:836)&lt;br/&gt;
        at org.apache.openjpa.kernel.BrokerImpl.find(BrokerImpl.java:753)&lt;br/&gt;
        at org.apache.openjpa.kernel.DelegatingBroker.find(DelegatingBroker.java:172)&lt;br/&gt;
        at org.apache.openjpa.persistence.EntityManagerImpl.find(EntityManagerImpl.java:349)&lt;br/&gt;
        at suite.r70.acommon.servicesupport.AbstractServiceClass.findIEntity(AbstractServiceClass.java:111)&lt;/p&gt;</comment>
                            <comment id="12523110" author="allee8285" created="Mon, 27 Aug 2007 22:19:07 +0100"  >&lt;p&gt;Add corrective doPriv() in appropriate call-outs.&lt;/p&gt;</comment>
                            <comment id="12523563" author="kwsutter" created="Wed, 29 Aug 2007 14:07:51 +0100"  >&lt;p&gt;Resolved via svn revision #570288.&lt;/p&gt;</comment>
                            <comment id="12523728" author="allee8285" created="Thu, 30 Aug 2007 00:12:22 +0100"  >&lt;p&gt;More testing discovers other paths in ProxyManagerImpl causes other access violations.&lt;/p&gt;</comment>
                            <comment id="12523955" author="allee8285" created="Thu, 30 Aug 2007 23:28:52 +0100"  >&lt;p&gt;The other path which caused security violations are:&lt;/p&gt;

&lt;p&gt;Stack Dump = java.security.AccessControlException: Access denied (java.lang.RuntimePermission getClassLoader)&lt;br/&gt;
        at java.security.AccessController.checkPermission(AccessController.java:104)&lt;br/&gt;
        at java.lang.SecurityManager.checkPermission(SecurityManager.java:547)&lt;br/&gt;
        at com.ibm.ws.security.core.SecurityManager.checkPermission(SecurityManager.java:189)&lt;br/&gt;
        at java.lang.Thread.getContextClassLoader(Thread.java:488)&lt;br/&gt;
        at serp.bytecode.BCClass.getClassLoader(BCClass.java:1670)&lt;br/&gt;
        at serp.bytecode.BCMember.getClassLoader(BCMember.java:326)&lt;br/&gt;
        at serp.bytecode.Attribute.getClassLoader(Attribute.java:85)&lt;br/&gt;
        at serp.bytecode.Instruction.getClassLoader(Instruction.java:141)&lt;br/&gt;
        at serp.bytecode.TypedInstruction.getType(TypedInstruction.java:76)&lt;br/&gt;
        at serp.bytecode.Code.calculateMaxLocals(Code.java:191)&lt;br/&gt;
        at org.apache.openjpa.util.ProxyManagerImpl.addProxyBeanMethods(ProxyManagerImpl.java:1173)&lt;br/&gt;
        at org.apache.openjpa.util.ProxyManagerImpl.generateProxyBeanBytecode(ProxyManagerImpl.java:640)&lt;br/&gt;
        at org.apache.openjpa.util.ProxyManagerImpl.getFactoryProxyBean(ProxyManagerImpl.java:452)&lt;br/&gt;
        at org.apache.openjpa.util.ProxyManagerImpl.newCustomProxy(ProxyManagerImpl.java:311)&lt;br/&gt;
        at org.apache.openjpa.kernel.SingleFieldManager.proxy(SingleFieldManager.java:129)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.proxyFields(StateManagerImpl.java:2721)&lt;br/&gt;
        at org.apache.openjpa.kernel.PNonTransState.initialize(PNonTransState.java:44)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.setPCState(StateManagerImpl.java:216)&lt;br/&gt;
        at org.apache.openjpa.kernel.StateManagerImpl.commit(StateManagerImpl.java:1005)&lt;br/&gt;
        at org.apache.openjpa.kernel.BrokerImpl.endTransaction(BrokerImpl.java:2177)&lt;br/&gt;
        at org.apache.openjpa.kernel.BrokerImpl.afterCompletion(BrokerImpl.java:1782)&lt;br/&gt;
        at com.ibm.ws.uow.ComponentContextSynchronizationWrapper.afterCompletion(ComponentContextSynchronizationWrapper.java:84)&lt;br/&gt;
        at com.ibm.ws.Transaction.JTA.RegisteredSyncs.distributeAfter(RegisteredSyncs.java:424)&lt;br/&gt;
        at com.ibm.ws.Transaction.JTA.TransactionImpl.distributeAfter(TransactionImpl.java:3883)&lt;br/&gt;
        at com.ibm.ws.Transaction.JTA.TransactionImpl.postCompletion(TransactionImpl.java:3862)&lt;br/&gt;
        at com.ibm.ws.Transaction.JTA.TransactionImpl.commitXAResources(TransactionImpl.java:2518)&lt;br/&gt;
        at com.ibm.ws.Transaction.JTA.TransactionImpl.stage1CommitProcessing(TransactionImpl.java:1635)&lt;br/&gt;
        at com.ibm.ws.Transaction.JTA.TransactionImpl.processCommit(TransactionImpl.java:1595)&lt;br/&gt;
        at com.ibm.ws.Transaction.JTA.TransactionImpl.commit(TransactionImpl.java:1530)&lt;br/&gt;
        at com.ibm.ws.Transaction.JTA.TranManagerImpl.commit(TranManagerImpl.java:237)&lt;br/&gt;
        at com.ibm.ws.Transaction.JTA.TranManagerSet.commit(TranManagerSet.java:162)&lt;br/&gt;
        at com.ibm.ws.Transaction.JTA.UserTransactionImpl.commit(UserTransactionImpl.java:292)&lt;br/&gt;
        at com.ibm.ejs.container.UserTransactionWrapper.commit(UserTransactionWrapper.java:264)&lt;br/&gt;
        at suite.r70.acommon.transactionservice.JTATransactionService.commitTransaction(JTATransactionService.java:39)&lt;/p&gt;

&lt;p&gt; and &lt;/p&gt;

&lt;p&gt;Caused by: java.security.AccessControlException: Access denied (java.lang.RuntimePermission modifyThreadGroup)&lt;br/&gt;
        at java.security.AccessController.checkPermission(AccessController.java:104)&lt;br/&gt;
        at java.lang.SecurityManager.checkPermission(SecurityManager.java:547)&lt;br/&gt;
        at com.ibm.ws.security.core.SecurityManager.checkPermission(SecurityManager.java:189)&lt;br/&gt;
        at com.ibm.ws.security.core.SecurityManager.checkAccess(SecurityManager.java:309)&lt;br/&gt;
        at java.lang.ThreadGroup.checkAccess(ThreadGroup.java:222)&lt;br/&gt;
        at java.lang.Thread.initialize(Thread.java:342)&lt;br/&gt;
        at java.lang.Thread.&amp;lt;init&amp;gt;(Thread.java:276)&lt;br/&gt;
        at java.lang.Thread.&amp;lt;init&amp;gt;(Thread.java:168)&lt;br/&gt;
        at org.apache.openjpa.datacache.DataCacheScheduler.scheduleEviction(DataCacheScheduler.java:100)&lt;br/&gt;
        at org.apache.openjpa.datacache.AbstractDataCache.initialize(AbstractDataCache.java:89)&lt;br/&gt;
        at org.apache.openjpa.datacache.ConcurrentDataCache.initialize(ConcurrentDataCache.java:91)&lt;br/&gt;
        at org.apache.openjpa.datacache.DataCacheManagerImpl.initialize(DataCacheManagerImpl.java:51)&lt;br/&gt;
        at org.apache.openjpa.conf.OpenJPAConfigurationImpl.getDataCacheManagerInstance(OpenJPAConfigurationImpl.java:602)&lt;br/&gt;
        at org.apache.openjpa.kernel.AbstractBrokerFactory.newBroker(AbstractBrokerFactory.java:181)&lt;/p&gt;

&lt;p&gt;I have created a patch and am running more tests before posting it to this report.&lt;/p&gt;</comment>
                            <comment id="12524098" author="allee8285" created="Fri, 31 Aug 2007 15:45:16 +0100"  >&lt;p&gt;Attached patch for the 2 new permission denials.&lt;/p&gt;

&lt;p&gt;The &quot;new Thread&quot; scenario is straight forward and needs no explaination.&lt;/p&gt;

&lt;p&gt;For the ProxyManagerImpl case, I have in-line the new PrivilegeAction instead of putting them in J2DoPrivHelper because generateProxyBeanBytecode() is protected qualified, therefore it can not be call from an action in J2DoPrivHelper. There are also many methods being called to the Code instance in generateProxyBeanBytecode() that may potentially need the doPriv . So instead of putting many individual doPriv for Code, the doPriv is moved up to generateProxyBeanBytecode()  and this only needs one instead.&lt;/p&gt;</comment>
                            <comment id="12528178" author="kwsutter" created="Mon, 17 Sep 2007 23:25:31 +0100"  >&lt;p&gt;Resolved in trunk (1.1.0).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12364894" name="OPENJPA-339.1.patch" size="5177" author="allee8285" created="Fri, 31 Aug 2007 15:45:16 +0100"/>
                            <attachment id="12364641" name="OPENJPA-339.patch" size="9828" author="allee8285" created="Mon, 27 Aug 2007 22:19:06 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 29 Aug 2007 13:07:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160664</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7ksn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288339</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>