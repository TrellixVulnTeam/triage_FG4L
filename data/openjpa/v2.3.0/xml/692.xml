<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:31:50 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-692/OPENJPA-692.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-692] Bi-directional One-to-Many mapping with a JoinTable fails for Update or Delete operation</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-692</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Originally reported in user group message &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; by Frank Schwarz &lt;/p&gt;

&lt;p&gt;If&lt;br/&gt;
a) Entities A and B that are related in a one-to-many and many-to-one bi-directional relation (typical Parent-Child pattern)&lt;br/&gt;
b) mapped using a JoinTable instead of conventional mappedBy &lt;/p&gt;

&lt;p&gt;then&lt;br/&gt;
update/delete operation fails with OptimisticException (which itself is a catch-all and sometimes misleading). &lt;/p&gt;


&lt;p&gt;Typical mapping that encounters this error:&lt;/p&gt;

&lt;p&gt;public class Person {&lt;br/&gt;
	@Id&lt;br/&gt;
	private long ssn;&lt;/p&gt;

&lt;p&gt;	@OneToMany(cascade=CascadeType.ALL)&lt;br/&gt;
	@JoinTable(name=&quot;J_PERSON_ADDRESSES&quot;,&lt;br/&gt;
			joinColumns               = @JoinColumn(name=&quot;PERSON_SSN&quot;,    referencedColumnName=&quot;SSN&quot;),&lt;br/&gt;
			inverseJoinColumns = @JoinColumn(name=&quot;ADDRESS_PHONE&quot;, referencedColumnName=&quot;PHONE&quot;))&lt;br/&gt;
    private Set&amp;lt;Address&amp;gt; addresses = new HashSet&amp;lt;Address&amp;gt;();&lt;/p&gt;

&lt;p&gt;public class Address {&lt;br/&gt;
   @Id&lt;br/&gt;
   private String phone;&lt;/p&gt;

&lt;p&gt;    @ManyToOne&lt;br/&gt;
    @JoinColumn(table=&quot;J_PERSON_ADDRESSES&quot;, referencedColumnName=&quot;SSN&quot;)&lt;br/&gt;
    private Person person;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://n2.nabble.com/bidirectional-one-to-many-relationship-with-join-table-tc678479.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://n2.nabble.com/bidirectional-one-to-many-relationship-with-join-table-tc678479.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12402066">OPENJPA-692</key>
            <summary>Bi-directional One-to-Many mapping with a JoinTable fails for Update or Delete operation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ppoddar@apache.org">Pinaki Poddar</assignee>
                                    <reporter username="ppoddar@apache.org">Pinaki Poddar</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Aug 2008 20:13:09 +0100</created>
                <updated>Thu, 22 Apr 2010 21:32:46 +0100</updated>
                            <resolved>Mon, 25 Aug 2008 15:06:06 +0100</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12621217" author="fs5" created="Sun, 10 Aug 2008 09:09:32 +0100"  >&lt;p&gt;I did some additional testing with Hibernate3. It seems that Hibernate is very robust on this topic.&lt;/p&gt;

&lt;p&gt;The following mappings worked as expected:&lt;br/&gt;
1.&lt;br/&gt;
@Entity&lt;br/&gt;
public class Person &lt;/p&gt;
{

	@Id
	@GeneratedValue(strategy = GenerationType.SEQUENCE)
	private long id;

	@OneToMany(mappedBy = &quot;person&quot;, cascade = CascadeType.ALL)
	@JoinTable(name=&quot;PERSON_ADDRESS&quot;,
                  joinColumns=@JoinColumn(name=&quot;PERSON_ID&quot;, referencedColumnName=&quot;ID&quot;),
                  inverseJoinColumns=@JoinColumn(name=&quot;ADDRESS_ID&quot;, referencedColumnName=&quot;ID&quot;))
	private Set&amp;lt;Address&amp;gt; addresses = new HashSet&amp;lt;Address&amp;gt;();
}

&lt;p&gt;@Entity&lt;br/&gt;
@SecondaryTable(name=&quot;PERSON_ADDRESS&quot;, pkJoinColumns=@PrimaryKeyJoinColumn(name=&quot;ADDRESS_ID&quot;))&lt;br/&gt;
public class Address &lt;/p&gt;
{

	@Id
	@GeneratedValue(strategy = GenerationType.SEQUENCE)
	private long id;

	@ManyToOne
	@JoinColumn(table=&quot;PERSON_ADDRESS&quot;, referencedColumnName=&quot;ID&quot;)
	private Person person;
}
&lt;p&gt;-----&lt;del&gt;%&amp;lt;&lt;/del&gt;---------------&lt;/p&gt;

&lt;p&gt;2.&lt;br/&gt;
@Entity&lt;br/&gt;
public class Person &lt;/p&gt;
{

	@Id
	@GeneratedValue(strategy = GenerationType.SEQUENCE)
	private long id;

	@OneToMany(mappedBy = &quot;person&quot;, cascade = CascadeType.ALL)
	private Set&amp;lt;Address&amp;gt; addresses = new HashSet&amp;lt;Address&amp;gt;();
}&lt;br/&gt;
&lt;br/&gt;
@Entity&lt;br/&gt;
@SecondaryTable(name=&quot;PERSON_ADDRESS&quot;, pkJoinColumns=@PrimaryKeyJoinColumn(name=&quot;ADDRESS_ID&quot;))&lt;br/&gt;
public class Address {

	@Id
	@GeneratedValue(strategy = GenerationType.SEQUENCE)
	private long id;

	@ManyToOne
	@JoinColumn(table=&quot;PERSON_ADDRESS&quot;) 
	private Person person;
}&lt;br/&gt;
-----&lt;del&gt;%&amp;lt;&lt;/del&gt;---------------&lt;br/&gt;
&lt;br/&gt;
3.&lt;br/&gt;
@Entity&lt;br/&gt;
public class Person {

	@Id
	@GeneratedValue(strategy = GenerationType.SEQUENCE)
	private long id;

	@OneToMany(mappedBy = &quot;person&quot;, cascade = CascadeType.ALL)
	private Set&amp;lt;Address&amp;gt; addresses = new HashSet&amp;lt;Address&amp;gt;();
}

&lt;p&gt;@Entity&lt;br/&gt;
public class Address &lt;/p&gt;
{

	@Id
	@GeneratedValue(strategy = GenerationType.SEQUENCE)
	private long id;

	@ManyToOne
	@JoinTable(name=&quot;PERSON_ADDRESS&quot;, joinColumns=@JoinColumn(name=&quot;ADDRESS_ID&quot;))
	private Person person;
}


&lt;p&gt;Not working with Hibernate is leaving out the &quot;mappedBy&quot; attribute of the Person.addresses field annotation in the first mapping example.&lt;/p&gt;

&lt;p&gt;Personally, I would like to see the third example mapping working. It uses minimal annotations but remains semantically understandable. And it conforms with the spirit of JSR220 disapproving additional annotations on a &quot;mapped-by&quot; field.&lt;/p&gt;</comment>
                            <comment id="12621361" author="ppoddar@apache.org" created="Mon, 11 Aug 2008 07:32:10 +0100"  >&lt;p&gt;With SVN Commit 68442, OpenJPA addresses the bi-directional mapping with a JoinTable when mapping is annotated is two independent mappings at both ends of the relationship i.e. no &apos;mappedBy&apos; attribute links the two ends.&lt;br/&gt;
Can you try that mapping with these latest changes to let us know whether that works for you? I have tested them and the check-in test cases are available with revision 68443.&lt;/p&gt;

&lt;p&gt;The other variants you have mentioned with @SecondaryTable annotations need to be tested with OpenJPA. &lt;/p&gt;</comment>
                            <comment id="12621390" author="fs5" created="Mon, 11 Aug 2008 10:34:47 +0100"  >&lt;p&gt;I tried the mapping as specified in the description field of this case.&lt;/p&gt;

&lt;p&gt;It works with current trunk (revision 684688/1.3.0-SNAPSHOT). Schema, SQL statements and runtime behavior are OK with one exception:&lt;/p&gt;

&lt;p&gt;Dissolving relationship, e.g.:&lt;br/&gt;
			Address address = person.getAddresses().iterator().next();&lt;br/&gt;
			person.getAddresses().remove(address);&lt;br/&gt;
			address.setPerson(null);&lt;/p&gt;

&lt;p&gt;leads to UPDATE PERSON_ADDRESS SET PERSON_SSN = ? WHERE ADDRESS_PHONE = ? &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(null) null, (long) 3&amp;#93;&lt;/span&gt;&lt;br/&gt;
Actually it has to be DELETE FROM PERSON_ADDRESS WHERE ADDRESS_PHONE = ? &lt;span class=&quot;error&quot;&gt;&amp;#91;params=(long) 3&amp;#93;&lt;/span&gt;. Otherwise the join-table will get filled with meaningless &amp;lt;NULL, ADDRESS_PHONE&amp;gt; tupels&lt;/p&gt;</comment>
                            <comment id="12621712" author="fs5" created="Tue, 12 Aug 2008 07:46:39 +0100"  >&lt;p&gt;With latest changes in trunk the dissolution of associations seems to work, i.e. an SQL delete statement is now used instead of an SQL update-set-null statement.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 10 Aug 2008 08:09:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161004</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt2f3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203572</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>