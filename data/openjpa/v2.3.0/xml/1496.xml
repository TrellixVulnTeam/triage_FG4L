<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:33:55 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1496/OPENJPA-1496.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1496] Fail to set temporal parameter</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1496</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;For an entity:&lt;/p&gt;

&lt;p&gt;@Entity&lt;br/&gt;
public class TimeEntity &lt;/p&gt;
{
	@Id
	@GeneratedValue
	private long id;
	
       String name;
    
       int value;
    
       @Temporal(TemporalType.TIMESTAMP)
       private java.util.Calendar cal2Timestamp;

...}


&lt;p&gt;an attempt to set parameter as below fails with IllegalArgumentException:&lt;br/&gt;
        String jpql = &quot;SELECT  COUNT(a) FROM TimeEntity a WHERE a.cal2Timestamp BETWEEN ?1 AND ?2&quot;;&lt;br/&gt;
        Calendar endTime = Calendar.getInstance();&lt;br/&gt;
        Calendar startTime = (Calendar)endTime.clone();&lt;br/&gt;
        startTime.add(14, -4);&lt;br/&gt;
        List results = em.createQuery(jpql).&lt;br/&gt;
            setParameter(1, startTime, TemporalType.TIMESTAMP).&lt;br/&gt;
            setParameter(2, endTime, TemporalType.TIMESTAMP).&lt;br/&gt;
            getResultList();&lt;/p&gt;

&lt;p&gt;java.lang.IllegalArgumentException: Parameter &quot;Parameter&amp;lt;Calendar&amp;gt;(2)&quot; declared in &quot;SELECT  COUNT(a) FROM TimeEntity a WHERE a.value = ?1 AND a.cal2Timestamp BETWEEN ?2 AND ?3&quot; is set to value of &quot;2/4/10 9:55 PM&quot; of type &quot;java.sql.Timestamp&quot;, but this parameter is bound to a field of type &quot;java.util.Calendar&quot;.&lt;br/&gt;
	at org.apache.openjpa.persistence.QueryImpl.assertValueAssignable(QueryImpl.java:1079)&lt;br/&gt;
	at org.apache.openjpa.persistence.QueryImpl.bindValue(QueryImpl.java:1036)&lt;br/&gt;
	at org.apache.openjpa.persistence.QueryImpl.setParameter(QueryImpl.java:640)&lt;br/&gt;
	at org.apache.openjpa.persistence.QueryImpl.setParameter(QueryImpl.java:653)&lt;br/&gt;
	at org.apache.openjpa.persistence.QueryImpl.setParameter(QueryImpl.java:1)&lt;br/&gt;
	at d637638.Test637638.testTemporalType(Test637638.java:36)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at junit.framework.TestCase.runTest(Unknown Source)&lt;br/&gt;
	at junit.framework.TestCase.runBare(Unknown Source)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(Unknown Source)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(Unknown Source)&lt;br/&gt;
	at junit.framework.TestResult.run(Unknown Source)&lt;br/&gt;
	at junit.framework.TestCase.run(Unknown Source)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(Unknown Source)&lt;br/&gt;
	at junit.framework.TestSuite.run(Unknown Source)&lt;br/&gt;
	at org.junit.internal.runners.OldTestClassRunner.run(OldTestClassRunner.java:35)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:45)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12455387">OPENJPA-1496</key>
            <summary>Fail to set temporal parameter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="faywang">Fay Wang</assignee>
                                    <reporter username="faywang">Fay Wang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Feb 2010 06:00:56 +0000</created>
                <updated>Mon, 8 Mar 2010 13:24:33 +0000</updated>
                            <resolved>Tue, 9 Feb 2010 18:40:26 +0000</resolved>
                                    <version>2.0.0-beta</version>
                                    <fixVersion>2.0.0-beta2</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12830466" author="faywang" created="Sat, 6 Feb 2010 05:09:31 +0000"  >&lt;p&gt;Current parameter processing is based on the assumption that each parameter is associated with one and only one class type. However, this is not true in the case of temporal data. Consider the following scenarios:&lt;/p&gt;

&lt;p&gt;@Entity&lt;br/&gt;
public class TimeEntity &lt;/p&gt;
{
      @Id
      @GeneratedValue
      private long id;

      String name;

       int value;
    
       @Temporal(TemporalType.TIMESTAMP)
       private java.util.Calendar cal2Timestamp;

...}
&lt;p&gt; &lt;/p&gt;

&lt;p&gt;String jpql = &quot;SELECT COUNT(a) FROM A a WHERE a.cal2Timestamp BETWEEN ?1 AND ?2&quot;;&lt;br/&gt;
Query q = em.createQuery(jpql);&lt;br/&gt;
Calendar endTime = Calendar.getInstance();&lt;br/&gt;
Calendar startTime = (Calendar)endTime.clone();&lt;br/&gt;
startTime.add(14, -4);&lt;/p&gt;

&lt;p&gt;(1)&lt;br/&gt;
        q.setParameter(1, startTime, TemporalType.TIMESTAMP);&lt;br/&gt;
        q.setParameter(2, endTime, TemporalType.TIMESTAMP);&lt;/p&gt;

&lt;p&gt;(2) &lt;br/&gt;
       q.setParameter(1, startTime);&lt;br/&gt;
        q.setParameter(2, endTime);&lt;/p&gt;

&lt;p&gt;In case (1), the parameterType of the two parameters should be Timestamp, which is based on the @Temporal annotation of the Calendar field, cal2Timestamp. &lt;/p&gt;

&lt;p&gt;In Case (2), the parameter type of the two parameters should be Calendar. &lt;/p&gt;

&lt;p&gt;In order to support both cases, the attached patch stores both types in the ordered parameter map, and uses the type depending on which setParameter method is called. &lt;/p&gt;


</comment>
                            <comment id="12831161" author="faywang" created="Mon, 8 Feb 2010 22:25:07 +0000"  >&lt;p&gt;A different approach to solve this problem.&lt;/p&gt;</comment>
                            <comment id="12831336" author="faywang" created="Tue, 9 Feb 2010 07:46:19 +0000"  >&lt;p&gt;This patch assumes any temporal types (Date, Time, Timestamp) are assignable to each other. However, with this patch, two test cases fail: TestTemporalTypeQueryParameterBinding.testNamedParameterWithMismatchedValue&lt;br/&gt;
and&lt;br/&gt;
TestTemporalTypeQueryParameterBinding.testPositionalParameterWithMismatchedValue  &lt;/p&gt;

&lt;p&gt;These two test cases suggest strong type checking for the temporal types.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12435217" name="OPENJPA-1496-2.patch" size="30322" author="faywang" created="Mon, 8 Feb 2010 22:25:07 +0000"/>
                            <attachment id="12435263" name="OPENJPA-1496-3.patch" size="10649" author="faywang" created="Tue, 9 Feb 2010 07:47:32 +0000"/>
                            <attachment id="12435061" name="OPENJPA-1496.patch" size="39121" author="faywang" created="Sat, 6 Feb 2010 05:12:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161760</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysy6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202885</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>