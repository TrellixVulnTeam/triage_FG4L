<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:31:35 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1966/OPENJPA-1966.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1966] Entity graphs containing bi-directional references may not merge correctly if an entity does not contain a state manager</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1966</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;An entity graph (with cascade) containing bi-directional relationships or circular references may fail to merge properly if one or more of the entities in the graph do not have a state manager - either an active or detached state manager.  The result is that one or more of the merged entities may end up with a reference to a detached object.  This may not be immediately evident and could cause problems in subsequent operations. It can even affect the ordering of SQL statements since foreign keys may not be properly associated with the detached entities.&lt;/p&gt;

&lt;p&gt;For example:  A &amp;lt;- OneToOne -&amp;gt; B&lt;br/&gt;
em.clear()&lt;br/&gt;
Detached graph:  B &amp;lt;--&amp;gt; A&lt;br/&gt;
A: Is detached, has DetachedStateManager&lt;br/&gt;
B: Is detached, No state manager, only detached state field.  (ie. @DetachedState Object state)&lt;br/&gt;
Merge: B&lt;br/&gt;
After merge:  B&apos; --&amp;gt; A&apos; --&amp;gt; B (detached)&lt;/p&gt;

&lt;p&gt;If B contains a state manager the result of the merge is correct: B&apos; &amp;lt;--&amp;gt; A&apos;&lt;/p&gt;

&lt;p&gt;The source of the problem is that the &quot;no state manager&quot; attachment path creates a new PC + state manager and assigns this state manager to the detached instance so that it can be used to attach all its fields.  During a cascade, this detached entity (with borrowed state manager) looks persistent, so it can get attached into the resulting merge graph.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12502421">OPENJPA-1966</key>
            <summary>Entity graphs containing bi-directional references may not merge correctly if an entity does not contain a state manager</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="techhusky">Jeremy Bauer</assignee>
                                    <reporter username="techhusky">Jeremy Bauer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Mar 2011 21:23:07 +0000</created>
                <updated>Wed, 11 Jun 2014 20:18:28 +0100</updated>
                                            <version>1.0.4</version>
                    <version>1.2.2</version>
                    <version>2.0.1</version>
                    <version>2.1.0</version>
                                                    <component>kernel</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13011432" author="techhusky" created="Fri, 25 Mar 2011 21:33:19 +0000"  >&lt;p&gt;Attaching a patch and simple jUnit.  The patch queries the attach cache before the using the broker to determine what to use for a pc reference during attachment.  More jUnits will be provided.&lt;/p&gt;</comment>
                            <comment id="13013577" author="techhusky" created="Wed, 30 Mar 2011 19:51:57 +0100"  >&lt;p&gt;Updated patch with additional test variations.&lt;/p&gt;</comment>
                            <comment id="13214596" author="slowstrider" created="Thu, 23 Feb 2012 12:46:40 +0000"  >&lt;p&gt;We are experiencing exactly this problem with all our cascading relations of the form A &amp;lt;- OneToMany -&amp;gt; B. We prefer using detached entities without a state manager because we have a client-server system where the client may insert/update entities with a remote method call to the server.&lt;br/&gt;
What we get on merging A is A&apos; -&amp;gt; B&apos;_i, with B&apos;_i -&amp;gt; A. &lt;br/&gt;
An easy workaround for us is to manually set the reference from each B&apos;_i  to A&apos; after detaching.&lt;br/&gt;
However it would be very nice if this bug is fixed because this is easy to forget when working with a new entity.&lt;/p&gt;</comment>
                            <comment id="14027797" author="slowstrider" created="Wed, 11 Jun 2014 15:12:07 +0100"  >&lt;p&gt;Perhaps the following is related so I am adding it here.&lt;br/&gt;
I have an entity with a reference named &quot;parent&quot; and a reference named &quot;link&quot; to an entity of the same type. I have a structure like:&lt;/p&gt;

&lt;p&gt;A.parent = B&lt;br/&gt;
B.parent = C&lt;br/&gt;
A.link = C&lt;/p&gt;

&lt;p&gt;First I persist/merge grandparent C, then B and then A.&lt;/p&gt;

&lt;p&gt;After doing a find I get:&lt;br/&gt;
A.parent = B&lt;br/&gt;
B.parent = C&lt;br/&gt;
A.link = C&apos;&lt;/p&gt;

&lt;p&gt;With C&apos; a copy of C but referring to another object.&lt;br/&gt;
Problem does not occur for:&lt;/p&gt;

&lt;p&gt;A.parent = B&lt;br/&gt;
(B.parent = C)&lt;br/&gt;
A.link = B&lt;/p&gt;</comment>
                            <comment id="14028253" author="curtisr7" created="Wed, 11 Jun 2014 20:18:28 +0100"  >&lt;p&gt;Have you tried the attached patch to see if it resolves your issue?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12474991" name="OPENJPA-1966.patch" size="30461" author="techhusky" created="Wed, 30 Mar 2011 19:51:57 +0100"/>
                            <attachment id="12474666" name="OPENJPA-1966.patch" size="12421" author="techhusky" created="Fri, 25 Mar 2011 21:33:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 23 Feb 2012 12:46:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2362</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7p3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>289038</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>