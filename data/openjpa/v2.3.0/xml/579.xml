<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:44:47 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-579/OPENJPA-579.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-579] JDO Projection query with for a complex object with a clob field fails</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-579</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;The following test case calls setResult on the Query interface to retrieve only the QueryTest2 var with a ordering clause. The generated SQL has an inner select distinct from which the final results are selected by the outer statement. &lt;/p&gt;

&lt;p&gt;        PersistenceManager pm = getPM();&lt;br/&gt;
        Query q = newQuery(pm, QueryTest4.class);&lt;br/&gt;
        q.declareVariables(&quot;QueryTest2 var&quot;);&lt;br/&gt;
        q.setResult(&quot;oneToOne2, var&quot;);&lt;br/&gt;
        q.setOrdering(&quot;var.num ascending&quot;);&lt;br/&gt;
        q.setFilter(&quot;manyToMany3.contains (var)&quot;);&lt;/p&gt;

&lt;p&gt;Here is the SQL generated to retrieve the result.&lt;/p&gt;

&lt;p&gt;SELECT s.t3_ID, s.t3_TYP, s.t3_VERSN, s.t3_BOOL, s.t3_CHARACTER0, s.t3_CLOBFIELD, s.t3_DATE0, s.t3_DECIMAL0, s.t3_NUM, s.t3_STRING FROM (SELECT DISTINCT t0.ID AS t0_ID, t3.ID AS t3_ID, t3.TYP AS t3_TYP, t3.VERSN AS t3_VERSN, t3.BOOL AS t3_BOOL, t3.CHARACTER0 AS t3_CHARACTER0, t3.DATE0 AS t3_DATE0, t3.DECIMAL0 AS t3_DECIMAL0, t3.NUM AS t3_NUM, t3.STRING AS t3_STRING, t3.ONETOONE AS t3_ONETOONE, t3.NUM2 AS t3_NUM2 FROM querytest4 t0 INNER JOIN query_manytomany3 t1 ON t0.ID = t1.ID LEFT OUTER JOIN querytest1 t3 ON t0.ONETOONE2 = t3.ID INNER JOIN querytest1 t2 ON t1.ELEMENT = t2.ID) s ORDER BY s.t2_NUM ASC&lt;/p&gt;

&lt;p&gt;The generated field in the outer statement s.t3_CLOBFIELD is not present in the distinct clause and leads to the failure exception below.&lt;/p&gt;

&lt;p&gt;1) testMultipleSameTypedObjectProjection(kodo.jdbc.query.TestJDBCProjections)&amp;lt;openjpa-1.1.0-SNAPSHOT-r422266:647033 nonfatal store error&amp;gt; kodo.jdo.DataStoreException: Unknown column &apos;s.t3_CLOBFIELD&apos; in &apos;field list&apos;&lt;/p&gt;

&lt;p&gt;        at org.apache.openjpa.jdbc.sql.SQLExceptions.narrow(SQLExceptions.java:146)&lt;br/&gt;
        at org.apache.openjpa.jdbc.sql.DBDictionary.newStoreException(DBDictionary.java:4107)&lt;br/&gt;
        at org.apache.openjpa.jdbc.sql.SQLExceptions.getStore(SQLExceptions.java:102)&lt;br/&gt;
        at org.apache.openjpa.jdbc.sql.SQLExceptions.getStore(SQLExceptions.java:88)&lt;br/&gt;
        at org.apache.openjpa.jdbc.sql.SQLExceptions.getStore(SQLExceptions.java:64)&lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.SelectResultObjectProvider.handleCheckedException(SelectResultObjectProvider.java:155)&lt;br/&gt;
        at org.apache.openjpa.lib.rop.EagerResultList.&amp;lt;init&amp;gt;(EagerResultList.java:40)&lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.toResult(QueryImpl.java:1222)&lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:989)&lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:804)&lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:774)&lt;br/&gt;
        at kodo.kernel.KodoQuery.execute(KodoQuery.java:43)&lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:770)&lt;br/&gt;
        at kodo.kernel.KodoQuery.execute(KodoQuery.java:39)&lt;br/&gt;
        at org.apache.openjpa.kernel.DelegatingQuery.execute(DelegatingQuery.java:517)&lt;br/&gt;
        at kodo.jdo.QueryImpl.execute(QueryImpl.java:98)&lt;br/&gt;
        at kodo.query.ProjectionsTestCase.testMultipleSameTypedObjectProjection(ProjectionsTestCase.java:439)&lt;br/&gt;
        at kodo.jdbc.query.TestJDBCProjections.testMultipleSameTypedObjectProjection(TestJDBCProjections.java:137)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;/p&gt;

&lt;p&gt;NestedThrowablesStackTrace:&lt;br/&gt;
com.mysql.jdbc.exceptions.MySQLSyntaxErrorException: Unknown column &apos;s.t3_CLOBFIELD&apos; in &apos;field list&apos;&lt;br/&gt;
        at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:930)&lt;br/&gt;
        at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:2864)&lt;br/&gt;
        at com.mysql.jdbc.MysqlIO.sendCommand(MysqlIO.java:1567)&lt;br/&gt;
        at com.mysql.jdbc.MysqlIO.sqlQueryDirect(MysqlIO.java:1659)&lt;br/&gt;
        at com.mysql.jdbc.Connection.execSQL(Connection.java:3118)&lt;br/&gt;
        at com.mysql.jdbc.PreparedStatement.executeInternal(PreparedStatement.java:1143)&lt;br/&gt;
        at com.mysql.jdbc.PreparedStatement.executeQuery(PreparedStatement.java:1256)&lt;br/&gt;
        at org.apache.openjpa.lib.jdbc.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:264)&lt;br/&gt;
        at com.solarmetric.jdbc.PoolConnection$PoolPreparedStatement.executeQuery(PoolConnection.java:260)&lt;br/&gt;
        at org.apache.openjpa.lib.jdbc.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:262)&lt;br/&gt;
        at org.apache.openjpa.lib.jdbc.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:262)&lt;br/&gt;
        at org.apache.openjpa.lib.jdbc.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:262)&lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.JDBCStoreManager$CancelPreparedStatement.executeQuery(JDBCStoreManager.java:1407)&lt;br/&gt;
        at org.apache.openjpa.lib.jdbc.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:252)&lt;br/&gt;
        at org.apache.openjpa.jdbc.sql.SelectImpl.executeQuery(SelectImpl.java:449)&lt;br/&gt;
        at org.apache.openjpa.jdbc.sql.SelectImpl.execute(SelectImpl.java:360)&lt;br/&gt;
        at kodo.jdbc.sql.KodoSelectImpl.execute(KodoSelectImpl.java:28)&lt;br/&gt;
        at org.apache.openjpa.jdbc.sql.SelectImpl.execute(SelectImpl.java:319)&lt;br/&gt;
        at org.apache.openjpa.jdbc.kernel.SelectResultObjectProvider.open(SelectResultObjectProvider.java:94)&lt;br/&gt;
        at org.apache.openjpa.lib.rop.EagerResultList.&amp;lt;init&amp;gt;(EagerResultList.java:34)&lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.toResult(QueryImpl.java:1222)&lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:989)&lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:804)&lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:774)&lt;br/&gt;
        at kodo.kernel.KodoQuery.execute(KodoQuery.java:43)&lt;br/&gt;
        at org.apache.openjpa.kernel.QueryImpl.execute(QueryImpl.java:770)&lt;br/&gt;
        at kodo.kernel.KodoQuery.execute(KodoQuery.java:39)&lt;br/&gt;
        at org.apache.openjpa.kernel.DelegatingQuery.execute(DelegatingQuery.java:517)&lt;br/&gt;
        at kodo.jdo.QueryImpl.execute(QueryImpl.java:98)&lt;br/&gt;
        at kodo.query.ProjectionsTestCase.testMultipleSameTypedObjectProjection(ProjectionsTestCase.java:439)&lt;br/&gt;
        at kodo.jdbc.query.TestJDBCProjections.testMultipleSameTypedObjectProjection(TestJDBCProjections.java:137)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;/p&gt;

&lt;p&gt;The fix for the above is in the HandlerFieldStrategy class. In the select distinct constructor the clobfield is being skipped but for the outer select it was getting included so adding condition to honor the eager mode fixes the problem. I will attach the patch shortly.&lt;/p&gt;</description>
                <environment>OpenJPA 1.1.0-SNAPSHOT&lt;br/&gt;
version id: openjpa-1.1.0-SNAPSHOT-r422266:647033&lt;br/&gt;
Apache svn revision: 422266:647033&lt;br/&gt;
&lt;br/&gt;
os.name: Windows XP&lt;br/&gt;
os.version: 5.1&lt;br/&gt;
os.arch: x86&lt;br/&gt;
&lt;br/&gt;
java.version: 1.6.0_05&lt;br/&gt;
java.vendor: BEA Systems, Inc.</environment>
        <key id="12394469">OPENJPA-579</key>
            <summary>JDO Projection query with for a complex object with a clob field fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sandeeps@bea.com">Sandeep Shrivastava</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Apr 2008 20:42:01 +0100</created>
                <updated>Tue, 9 Mar 2010 18:32:50 +0000</updated>
                            <resolved>Sat, 3 May 2008 04:17:18 +0100</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="12591018" author="sandeeps@bea.com" created="Mon, 21 Apr 2008 20:49:52 +0100"  >&lt;p&gt;Fix to the HandlerStrategy class.&lt;/p&gt;</comment>
                            <comment id="12591208" author="pcl" created="Tue, 22 Apr 2008 07:01:47 +0100"  >&lt;p&gt;Resolved in 1.1.x with r650217.&lt;/p&gt;</comment>
                            <comment id="12592692" author="pcl" created="Sun, 27 Apr 2008 23:53:22 +0100"  >&lt;p&gt;This was made obsolete by another fix.&lt;/p&gt;</comment>
                            <comment id="12593775" author="sandeeps@bea.com" created="Fri, 2 May 2008 14:17:09 +0100"  >&lt;p&gt;Reapply the patch to the MaxEmbeddedLobFieldStrategy class.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12380636" name="openjpa-1.1.0-SNAPSHOT-r422266-647033.patch" size="781" author="sandeeps@bea.com" created="Mon, 21 Apr 2008 20:49:52 +0100"/>
                            <attachment id="12381309" name="openjpa-1.1.0-SNAPSHOT-r422266-650703.patch" size="802" author="sandeeps@bea.com" created="Fri, 2 May 2008 14:17:09 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 22 Apr 2008 06:01:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160895</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt1z3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203500</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>