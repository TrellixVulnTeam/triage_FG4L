<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:31:25 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-2056/OPENJPA-2056.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-2056] Postgres V9.1 issue with LIKE clause and Escape Strings</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-2056</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Noticed an issue with the Postgres DBDictionary definition after updating Postgres from version 8.4 to 9.1:-&lt;/p&gt;

&lt;p&gt;Here&apos;s what you get in the Postgres trace file when executing some JPA driven queries where an SQL LIKE is involved:-&lt;/p&gt;

&lt;p&gt;2011-09-30 14:29:41 BST ERROR:  invalid escape string&lt;br/&gt;
2011-09-30 14:29:41 BST HINT:  Escape string must be empty or one character.&lt;br/&gt;
2011-09-30 14:29:41 BST STATEMENT:  SELECT t0.id, t0.identificationMask, t0.productName FROM DBTYPE t0 WHERE (t0.identificationMask LIKE $1 ESCAPE &apos;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&apos;)&lt;br/&gt;
2011-09-30 14:29:41 BST ERROR:  current transaction is aborted, commands ignored until end of transaction block&lt;/p&gt;

&lt;p&gt;This appears to be down to a change the Postgres project have made to escape string handling:-&lt;br/&gt;
  &lt;a href=&quot;http://www.postgresql.org/docs/9.1/static/release-9-1.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.postgresql.org/docs/9.1/static/release-9-1.html&lt;/a&gt; (see section E.2.2.1)&lt;/p&gt;

&lt;p&gt;You appear to be able to override the default DBDictionary setting for this as follows to get things working again:-&lt;br/&gt;
&amp;lt;property name=&quot;openjpa.jdbc.DBDictionary&quot; value=&quot;postgres(SearchStringEscape=&amp;#41;&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;So, does this mean OpenJPA needs a version dependent dictionary definition for Postgres from now on? Anybody got any better solutions or care to confirm what I&apos;m seeing?&lt;/p&gt;

&lt;p&gt;I&apos;ve also posted this to the Postgres JDBC mailing list in case they have any comments. &lt;/p&gt;</description>
                <environment>Running against a Postgres database at version 9.1</environment>
        <key id="12525645">OPENJPA-2056</key>
            <summary>Postgres V9.1 issue with LIKE clause and Escape Strings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="milosz">Milosz Tylenda</assignee>
                                    <reporter username="gbjbaaha">Andrew Hastie</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Oct 2011 11:41:39 +0100</created>
                <updated>Thu, 2 Feb 2012 17:14:27 +0000</updated>
                            <resolved>Sun, 9 Oct 2011 12:17:35 +0100</resolved>
                                    <version>2.0.0</version>
                    <version>2.0.1</version>
                    <version>2.1.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                                    <component>jdbc</component>
                    <component>sql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13120000" author="gbjbaaha" created="Tue, 4 Oct 2011 11:52:51 +0100"  >&lt;p&gt;I think there are several solutions to this problem, but ideally we need something that is backwards compatible with previous Postgres releases. I&apos;m no expect on the internals of OpenJPA, but here are some suggestions:&lt;/p&gt;

&lt;p&gt;1. Determine from the current connection the setting of &quot;standard_conforming_strings&quot; (Needs SQL statement &quot;SHOW standard_conforming_strings;&quot;). This can then be used to influence the escape string to being either &quot;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&quot; or &quot;\\\\&quot; in the Dictionary impl as required. ASFAIK Postgres at V9.1 returns &quot;ON&quot; and earlier releases return &quot;OFF&quot;.&lt;/p&gt;

&lt;p&gt;Here are some links to the Postgres documentation covering this topic:-&lt;br/&gt;
  &lt;a href=&quot;http://www.postgresql.org/docs/9.1/interactive/runtime-config-compatible.html#GUC-STANDARD-CONFORMING-STRINGS&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.postgresql.org/docs/9.1/interactive/runtime-config-compatible.html#GUC-STANDARD-CONFORMING-STRINGS&lt;/a&gt;&lt;br/&gt;
  &lt;a href=&quot;http://www.postgresql.org/docs/9.1/interactive/sql-syntax-lexical.html#SQL-SYNTAX-STRINGS-ESCAPE&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.postgresql.org/docs/9.1/interactive/sql-syntax-lexical.html#SQL-SYNTAX-STRINGS-ESCAPE&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2. Use an explicitly escaped string like E&apos;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&apos; to force escape interpretation, making the string independent of the standards_conforming_strings param.&lt;/p&gt;

&lt;p&gt;Until this is fixed, there are several workarounds for the problem:-&lt;/p&gt;

&lt;p&gt;1. Set a property in the persistence.xml as follows to override the default PGDictionary setting:-&lt;br/&gt;
    &amp;lt;property name=&quot;openjpa.jdbc.DBDictionary&quot; value=&quot;postgres(SearchStringEscape=&amp;#41;&quot;/&amp;gt;&lt;br/&gt;
2. In the Postgres configuration file (postgresql.conf) make the setting under &quot;VERSION/PLATFORM COMPATIBILITY&quot; :-&lt;br/&gt;
  standard_conforming_strings = off&lt;/p&gt;

&lt;p&gt;Option 1 is preferred as not all users may have access to the Postgres configuration files.&lt;/p&gt;</comment>
                            <comment id="13120590" author="ringerc" created="Wed, 5 Oct 2011 00:50:17 +0100"  >&lt;p&gt;Note that standard_conforming_strings was introduced in PostgreSQL 8.2. While this is the oldest release still supported by the PostgreSQL team, and will be exiting support in December this year, people seem to routinely run old and unsupported releases. Questions about PostgreSQL 7.4 are not uncommon on the mailing list. On prior versions, &quot;SHOW standard_conforming_strings&quot; will report an error.&lt;/p&gt;

&lt;p&gt;It&apos;s not particularly likely that people running such ancient versions of PostgreSQL will upgrade OpenJPA, but in an org where DBA/sysadmin is very separate from dev, or where legacy and actively maintained apps coexist in the same DBs, it&apos;s not impossible. It&apos;s worth handling.&lt;/p&gt;

&lt;p&gt;I think the escape string syntax E&apos;&apos; was introduced in PostgreSQL 8.1, but haven&apos;t tested to verify that. You should probably not rely on it if people using ancient versions is a realistic possibility.&lt;/p&gt;

&lt;p&gt;The best answer will probably be to always escape strings. Just &quot;SELECT version()&quot; to decide whether the explicit escape-string syntax should be used, or if, as older versions that lack standard_conforming_strings, all strings should be assumed to be subject to escape processing. That makes OpenJPA independent of the standard_conforming_strings parameter.&lt;/p&gt;

&lt;p&gt;It&apos;s also important to be aware of the backslash_quote parameter, which is another compatibility option that can cause pain. Escape single quotes by doubling them, not by using \&apos;, to avoid issues with this. backslash_quote exists as far back as at least PostgreSQL 7.4, as does support for SQL-standard &apos;&apos; style quote escapes. If OpenJPA currently escapes quotes using \&apos; this should be changed to avoid another potential bug.&lt;/p&gt;

&lt;p&gt;I know all this is ugly; transitioning toward better standards conformance often is in cases where no 100%-compatible approach can exist. Unfortunately, standard_conforming_strings will be a wart for quite a long time and it is a setting people DO mess with, so it&apos;s important to handle it.&lt;/p&gt;</comment>
                            <comment id="13123664" author="milosz" created="Sun, 9 Oct 2011 12:28:43 +0100"  >&lt;p&gt;Hi Andrew &amp;amp; Craig. Thanks for the extensive information. The escape string now depends on PostgreSQL version:&lt;br/&gt;
1. 9.0 and older use &apos;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&apos;.&lt;br/&gt;
2. 9.1 and later use &apos;\&apos;.&lt;/p&gt;

&lt;p&gt;I expect this to be a good solution for the vast majority of users. Those with PostgreSQL 9.0 and older who have set standard_conforming_strings to ON can use the SearchStringEscape property workaround proposed by Andrew. Also, setting a DBDictionary property called RequiresSearchStringEscapeForLike to false might help in such cases.&lt;/p&gt;</comment>
                            <comment id="13198986" author="allee8285" created="Thu, 2 Feb 2012 17:14:27 +0000"  >&lt;p&gt;Close issue in preparation for 2.2.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 4 Oct 2011 23:50:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>44266</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7phz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>289101</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>