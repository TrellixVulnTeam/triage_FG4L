<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:36:02 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-927/OPENJPA-927.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-927] Fix definition of javax.persistence.query.timeout property</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-927</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;This was originally reported by Pinaki in &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-849&quot; title=&quot;Add metadata-type getter methods to EntityManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-849&quot;&gt;&lt;del&gt;OPENJPA-849&lt;/del&gt;&lt;/a&gt;. It is being moved to this new JIRA. Here&apos;s Pinaki&apos;s original comment:&lt;/p&gt;


&lt;p&gt;        queryTimeout.setLoadKey(&quot;javax.persistence.query.timeout&quot;);&lt;br/&gt;
        queryTimeout.setDefault(&quot;-1&quot;);&lt;br/&gt;
        queryTimeout.set(-1);&lt;br/&gt;
        queryTimeout.setDynamic(true);&lt;/p&gt;

&lt;p&gt;does not seem kosher for the following reason:&lt;/p&gt;

&lt;p&gt;1. loadKey is the key with which a property is loaded from configuration artifacts. At this point of execution, no property has been &lt;b&gt;actually&lt;/b&gt; loaded, they are merely being declared to exist. Hence we should not be setting load key.&lt;br/&gt;
2. configuration declares a Value. But does not assign its value. So setting its value to -1 does not look alright. Setting default value is OK.&lt;/p&gt;

&lt;p&gt;These issues gain significance in the light of the fact the configuration&apos;s hashcode is the key to a factory in JNDI. And computation of hashcode depends on the actual value of the Values.&lt;br/&gt;
As an extreme example, assume two Configuration C1 and C2 nearly identical but differs &lt;b&gt;only&lt;/b&gt; in their query.timeout value. The requirement is hash code for C1 and C2 must not be equal. And that is what Configuration.hashCode() ensures. But, because we are setting query timeout to -1 (that is not what the user&apos;s p.xml sets) and it is marked as dynamic, in both cases Configuration hashcode will treat query.timeout value to be -1 and will end up computing same hashcode for C1 and C2.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12415069">OPENJPA-927</key>
            <summary>Fix definition of javax.persistence.query.timeout property</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dianner">Dianne Richards</assignee>
                                    <reporter username="dianner">Dianne Richards</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Feb 2009 16:18:45 +0000</created>
                <updated>Thu, 2 May 2013 03:29:20 +0100</updated>
                            <resolved>Fri, 6 Mar 2009 18:20:20 +0000</resolved>
                                    <version>2.0.0-M2</version>
                                    <fixVersion>2.0.0-M2</fixVersion>
                                    <component>kernel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12674680" author="dianner" created="Wed, 18 Feb 2009 16:21:54 +0000"  >&lt;p&gt;Thanks for checking this out Pinaki.&lt;/p&gt;

&lt;p&gt;&amp;gt;1. loadKey is the key with which a property is loaded from configuration artifacts. At this point of execution, no property has been &amp;gt;&lt;b&gt;actually&lt;/b&gt; loaded, they are merely being declared to exist. Hence we should not be setting load key.&lt;/p&gt;

&lt;p&gt;I now understand this and will change it. But, we have to solve a problem if we don&apos;t do this. The getProperties() methods return all defined properties, even if they have not been explicitly set. This calls the Configuration .toProperties() method which calls the setValue() method. By default, if we don&apos;t do anything, the value javax.persistence.query.timeout will be prefixed with &quot;openjpa.&quot;, which is not good. We can get around this doing a setEquivalentKey() instead. But, now I&apos;m wondering what we&apos;ll get with the getSupportedProperties() with this change. I&apos;ll have to investigat that. But, if that&apos;s ok, is this a reasonable alternative? Or, should I figure out something else?&lt;/p&gt;

&lt;p&gt;The other option is to define a new openjpa property, such as openjpa.QueryTimeout. I was trying to avoid that option. I&apos;m not sure we want to define a new openjpa property for every new spec property.&lt;/p&gt;

&lt;p&gt;&amp;gt;2. configuration declares a Value. But does not assign its value. So setting its value to -1 does not look alright. Setting default &amp;gt;value is OK.&lt;/p&gt;

&lt;p&gt;ok - But, I modeled this after the openjpa.LockTimeout definition. So, does this one need to be corrected too?&lt;/p&gt;</comment>
                            <comment id="12675502" author="dianner" created="Fri, 20 Feb 2009 23:02:26 +0000"  >&lt;p&gt;Here&apos;s a patch that does the following:&lt;/p&gt;

&lt;p&gt;1 - Changes the setLoadKey() for javax.persistence.query.timeout to setEquivalentKey()&lt;br/&gt;
2 - Removes the set(-1) for the query timeout and lock timeout properties&lt;br/&gt;
3 - Removes from the EM getProperties Map the Connection2Password property&lt;/p&gt;</comment>
                            <comment id="12676002" author="drwoods" created="Mon, 23 Feb 2009 18:26:43 +0000"  >&lt;p&gt;Thanks Dianne.  Here is a version of the unmodified patch for non-Eclipse users.&lt;/p&gt;</comment>
                            <comment id="12676003" author="drwoods" created="Mon, 23 Feb 2009 18:29:43 +0000"  >&lt;p&gt;Note:  my patch is a lot larger, as it removes the Windows ^M chars off every line of EntityManagerImpl.java, since I have my svn config properties setup as suggested by the ASF....&lt;/p&gt;</comment>
                            <comment id="12678071" author="drwoods" created="Mon, 2 Mar 2009 19:34:48 +0000"  >&lt;p&gt;Dianne, your patch is working for me.  Can you commit it?&lt;/p&gt;</comment>
                            <comment id="12678868" author="techhusky" created="Wed, 4 Mar 2009 19:36:30 +0000"  >&lt;p&gt;Committed Dianne&apos;s patch (with modifications) under revisions 750112 750113 750115 750117.&lt;/p&gt;</comment>
                            <comment id="12679678" author="drwoods" created="Fri, 6 Mar 2009 18:17:35 +0000"  >&lt;p&gt;Dianne, can this be marked as resolved now?&lt;/p&gt;</comment>
                            <comment id="12737110" author="alan_raison" created="Thu, 30 Jul 2009 15:09:08 +0100"  >&lt;p&gt;The test org.apache.openjpa.persistence.simple.TestPropertiesMethods contains a derby connection string.  This is problematic if Derby is not being used to test.&lt;/p&gt;

&lt;p&gt;I think removing the setting of the openjpa.ConnectionURL property will fix this - but I&apos;m not sure if this nullifies the test!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12413544">OPENJPA-878</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12400783" name="OPENJPA-927-trunk.patch" size="106342" author="drwoods" created="Mon, 23 Feb 2009 18:26:43 +0000"/>
                            <attachment id="12400635" name="patch.txt" size="7467" author="dianner" created="Fri, 20 Feb 2009 23:02:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 23 Feb 2009 18:26:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161225</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7mmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288636</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>