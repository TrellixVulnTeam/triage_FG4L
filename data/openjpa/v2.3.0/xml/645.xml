<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:43:14 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-645/OPENJPA-645.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-645] Date millisecond precision lost for Informix IDS and SQLServer</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-645</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;An entity has an attribute of type java.util.Date, annotated with @Temporal(TemporalType.TIMESTAMP):&lt;/p&gt;

&lt;p&gt;@Temporal(TemporalType.TIMESTAMP)&lt;br/&gt;
public Date udate;&lt;/p&gt;

&lt;p&gt;This gets mapped in Informix to a column of type:&lt;/p&gt;

&lt;p&gt;udate DATETIME YEAR TO FRACTION (3)&lt;/p&gt;

&lt;p&gt;and in SQLServer to &lt;/p&gt;

&lt;p&gt;udate DATETIME&lt;/p&gt;

&lt;p&gt;When the udate attribute is assigned a value with millisecond precision, say &quot;12:34:56:789&quot;, OpenJPA chops off the millisecond fractional part when it generates the INSERT statement.&lt;/p&gt;

&lt;p&gt;In DBDictionary, for this type, we come to setDate() with the &apos;val&apos; parameter set to the correct java.util.Date value &quot;12:34:56:789&quot;. (The millisecond value is stored in the (Gregorian.Date) cdate.millis attribute of java.util.Date). setDate() then calls setTimestamp() - the last else - with a new instance of java.sql.Timestamp:&lt;/p&gt;

&lt;p&gt;setTimestamp(stmnt, idx, new Timestamp(val.getTime()), null, col);&lt;/p&gt;

&lt;p&gt;java.sql.Timestamp is made up of 2 parts - a date part that stores the time upto seconds, and a separate attribute, called nanos, that stores everything that is fractional of seconds. &lt;/p&gt;

&lt;p&gt;So the new Timestamp value that is sent to setTimestamp() has this:&lt;/p&gt;

&lt;p&gt;(Gregorian.Date) cdate = 12:34:56&lt;br/&gt;
nanos = 789000000&lt;/p&gt;

&lt;p&gt;In setTimestamp() there is a check for supportsTimestampNanos. Because in the InformixDictionary and SQLServer dictionaries this is set to false, the code then zeros out the nanos field:&lt;/p&gt;

&lt;p&gt;if (supportsTimestampNanos)&lt;br/&gt;
    val.setNanos(nanos);&lt;br/&gt;
else&lt;br/&gt;
    val.setNanos(0);&lt;/p&gt;

&lt;p&gt;Consequently, all fractional seconds information is lost for these 2 database types from the INSERT statement for this timestamp value. &lt;/p&gt;

&lt;p&gt;The nanos field in java.sql.Timestamp does not really mean that only nanoseconds are stored there - it means that any fractional value, after seconds  will be stored there.This problem happens not only with the Date field in the entity, but also with java.util.Calendar and java.sql.Timestamp. The solution is to always set the nanoseconds value in the (java.sql.Timestamp)val field. The check for supportsTimestampNanos, as well as the flag itself, is not needed, because both IDS and SQLServer do allow fractional seconds.&lt;/p&gt;

&lt;p&gt;Will attach a patch ASAP. Albert has reviewed the proposed solution.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12399111">OPENJPA-645</key>
            <summary>Date millisecond precision lost for Informix IDS and SQLServer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dinkar">Dinkar Rao</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Jun 2008 21:01:07 +0100</created>
                <updated>Wed, 10 Mar 2010 03:32:45 +0000</updated>
                            <resolved>Thu, 26 Jun 2008 21:22:32 +0100</resolved>
                                    <version>1.0.3</version>
                    <version>1.1.0</version>
                                    <fixVersion>1.0.4</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-M1</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12608569" author="fancy" created="Thu, 26 Jun 2008 21:22:32 +0100"  >&lt;p&gt;fix checked in under r672017&lt;/p&gt;</comment>
                            <comment id="12745038" author="bjreed" created="Wed, 19 Aug 2009 13:50:17 +0100"  >&lt;p&gt;In 1.0.x, SQL Server has already been updated to allow the fractional portion of seconds to be stored.  The &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-645&quot; title=&quot;Date millisecond precision lost for Informix IDS and SQLServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-645&quot;&gt;&lt;del&gt;OPENJPA-645&lt;/del&gt;&lt;/a&gt;-1.0.x patch does the same for InformixDictionary and removes the flag from DBDictionary.&lt;/p&gt;</comment>
                            <comment id="12843421" author="mikedd" created="Wed, 10 Mar 2010 03:32:45 +0000"  >&lt;p&gt;The changes predate 1.2.0 (1.2.x branch created under revision 680507). It&apos;s missed the release notes though and is certainly fixed in 2.0.0M1. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12417014" name="OPENJPA-645-1.0.x.patch" size="1711" author="bjreed" created="Wed, 19 Aug 2009 13:50:17 +0100"/>
                            <attachment id="12384787" name="patch-645.txt" size="2366" author="dinkar" created="Thu, 26 Jun 2008 21:05:45 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 26 Jun 2008 20:22:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160959</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7lg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288445</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>