<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:33:13 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-536/OPENJPA-536.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-536] getMetaData() causes OutOfMemoryError under some cases</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-536</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;There are 3 classes: Item, Artist and Person. Artist extends Person. &lt;br/&gt;
Invoking JPAFacadeHelper.getMetaData(emf, Item.class) will cause OutOfMemoryError thrown by org.apache.openjpa.meta.MetaDataRepository.processBuffer().&lt;/p&gt;
</description>
                <environment>Sun JDK 5</environment>
        <key id="12390908">OPENJPA-536</key>
            <summary>getMetaData() causes OutOfMemoryError under some cases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="amy">Amy Yang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Mar 2008 03:14:29 +0000</created>
                <updated>Thu, 29 Jan 2009 21:14:14 +0000</updated>
                            <resolved>Sun, 27 Apr 2008 23:47:54 +0100</resolved>
                                    <version>1.0.2</version>
                    <version>1.0.3</version>
                                    <fixVersion>0.9.7-r547073</fixVersion>
                    <fixVersion>1.0.4</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>jpa</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12578154" author="amy" created="Thu, 13 Mar 2008 05:26:49 +0000"  >&lt;p&gt;It is because when constructing the TreeSet, the Item will be the root. The handling order will be Item, Person, Artist.&lt;br/&gt;
The the comparator will report Artist &amp;lt; Item and Person &amp;gt; Item. So the TreeSet will be &lt;br/&gt;
    Item&lt;br/&gt;
  /         \&lt;br/&gt;
Artist   Person&lt;/p&gt;

&lt;p&gt;Then when traversing the TreeSet and pop the first one, after Item is removed, the TreeSet will be &lt;br/&gt;
    Person&lt;br/&gt;
   /&lt;br/&gt;
Artist&lt;br/&gt;
The comparator will report Person &amp;lt; Artist so the TreeSet is incorrect.&lt;/p&gt;</comment>
                            <comment id="12578156" author="amy" created="Thu, 13 Mar 2008 05:36:53 +0000"  >&lt;p&gt;The test case can be extracted and run under openjpa-persistence-jdbc\src\test\java\org\apache\openjpa\meta&lt;/p&gt;</comment>
                            <comment id="12578159" author="amy" created="Thu, 13 Mar 2008 05:55:15 +0000"  >&lt;p&gt;In InheritanceComparator.java, assign Object.class to _base can make the test case pass. But it will break TestMetaDataInheritanceComparator&lt;/p&gt;</comment>
                            <comment id="12578628" author="amy" created="Fri, 14 Mar 2008 07:14:11 +0000"  >&lt;p&gt;Here is a better fix, I think. It can pass both my test case and TestMetaDataInheritanceComparator.&lt;br/&gt;
Basically the comparator doesn&apos;t have problem. But when comparing classes, the base class is needed to be set. Otherwise it might only compares the class name.&lt;/p&gt;</comment>
                            <comment id="12578629" author="amy" created="Fri, 14 Mar 2008 07:16:25 +0000"  >&lt;p&gt;I mean, the changes in MetaDataRepository.diff should be better than InheritanceComparator.diff, though it is not fully reviewed and tested.&lt;/p&gt;</comment>
                            <comment id="12583511" author="amy" created="Mon, 31 Mar 2008 02:18:35 +0100"  >&lt;p&gt;Patch including changed source and test case.&lt;/p&gt;</comment>
                            <comment id="12583970" author="allee8285" created="Tue, 1 Apr 2008 02:57:24 +0100"  >&lt;p&gt;Amy,&lt;/p&gt;

&lt;p&gt;First of all, thank you of your contribution to the solution of this problem.&lt;/p&gt;

&lt;p&gt;I assume the last patch (i.e. 364202.patch) contains ALL the artifacts including the solutions and the test case for verification.&lt;/p&gt;

&lt;p&gt;From looking at 364202.patch, it is very difficult to figure out what are the changes in MetaDataRepository.java due to formating differences between the before and after files. If you can submit a patch that shows only the necessary changes, it would greatly speed up the code review process for the committer to help you to commit the change.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Albert Lee.&lt;/p&gt;</comment>
                            <comment id="12583975" author="allee8285" created="Tue, 1 Apr 2008 03:06:07 +0100"  >&lt;p&gt;Following the instructions ( &lt;a href=&quot;http://openjpa.apache.org/get-involved.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://openjpa.apache.org/get-involved.html&lt;/a&gt; ) and the coding standard ( &lt;a href=&quot;http://openjpa.apache.org/coding-standards.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://openjpa.apache.org/coding-standards.html&lt;/a&gt; ) help to eliminate the situation you ran into.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Albert Lee.&lt;/p&gt;

</comment>
                            <comment id="12583982" author="amy" created="Tue, 1 Apr 2008 04:17:33 +0100"  >&lt;p&gt;Thank you Albert.&lt;br/&gt;
I generated another patch which is the output of &quot;svn diff openjpa-kernel\src\main\java\org\apache\openjpa\meta\MetaDataRepository.java&quot;. Hope you can review it. &lt;br/&gt;
And I executed &quot;svn add&quot; for test cases:&lt;br/&gt;
svn add openjpa-persistence-jdbc\src\test\java\org\apache\openjpa\meta\Person.java openjpa-persistence-jdbc\src\test\java\org\apache\openjpa\meta\Item.java openjpa-persistence-jdbc\src\test\java\org\apache\openjpa\meta\Artist.java openjpa-persistence-jdbc\src\test\java\org\apache\openjpa\meta\TestGetMetaData.java&lt;br/&gt;
A         openjpa-persistence-jdbc\src\test\java\org\apache\openjpa\meta\Person.java&lt;br/&gt;
A         openjpa-persistence-jdbc\src\test\java\org\apache\openjpa\meta\Item.java&lt;br/&gt;
A         openjpa-persistence-jdbc\src\test\java\org\apache\openjpa\meta\Artist.java&lt;br/&gt;
A         openjpa-persistence-jdbc\src\test\java\org\apache\openjpa\meta\TestGetMetaData.java&lt;/p&gt;

&lt;p&gt;Please correct me if anything is wrong.&lt;/p&gt;</comment>
                            <comment id="12583983" author="amy" created="Tue, 1 Apr 2008 04:18:47 +0100"  >&lt;p&gt;try to set the base of comparator.&lt;/p&gt;</comment>
                            <comment id="12583984" author="amy" created="Tue, 1 Apr 2008 04:19:40 +0100"  >&lt;p&gt;try to set the base of comparator&lt;/p&gt;</comment>
                            <comment id="12583985" author="amy" created="Tue, 1 Apr 2008 04:21:22 +0100"  >&lt;p&gt;oops. pasted MetaDataRepository.java. Please ignore it. only &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-536&quot; title=&quot;getMetaData() causes OutOfMemoryError under some cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-536&quot;&gt;&lt;del&gt;OPENJPA-536&lt;/del&gt;&lt;/a&gt;.patch is ok, I think.&lt;/p&gt;

&lt;p&gt;Why can&apos;t I delete the attachments? :-P&lt;/p&gt;</comment>
                            <comment id="12583988" author="ppoddar@apache.org" created="Tue, 1 Apr 2008 04:39:40 +0100"  >&lt;p&gt;Amy,&lt;br/&gt;
  Thanks for this critical patch. &lt;/p&gt;

&lt;p&gt;  It may by useful to name your patch as OPENJPA-XYZ.n.patch&lt;br/&gt;
  where XYZ is the JIRA issue number&lt;br/&gt;
              n is the serial number of the patch as often multiple patches are submitted by the same/different developer(s)&lt;/p&gt;</comment>
                            <comment id="12584203" author="amy" created="Tue, 1 Apr 2008 17:26:35 +0100"  >&lt;p&gt;Thank you Pinaki.&lt;br/&gt;
I&apos;ll remember the serial number.&lt;/p&gt;

&lt;p&gt;Hope the fix is right. Will you review it?&lt;/p&gt;</comment>
                            <comment id="12584316" author="amy" created="Tue, 1 Apr 2008 22:23:43 +0100"  >&lt;p&gt;patch including source code diff and test case&lt;/p&gt;</comment>
                            <comment id="12584902" author="amy" created="Thu, 3 Apr 2008 00:05:03 +0100"  >&lt;p&gt;This version of patch can pass both my test case and the remote test on TeamCity.&lt;br/&gt;
Please help to review it.&lt;/p&gt;</comment>
                            <comment id="12584929" author="pcl" created="Thu, 3 Apr 2008 01:05:20 +0100"  >&lt;p&gt;Resolved with r644115. For the record, I&apos;m not in love with the statefulness involved in this algorithm, but that predates this issue.&lt;/p&gt;</comment>
                            <comment id="12589778" author="amy" created="Thu, 17 Apr 2008 00:59:31 +0100"  >&lt;p&gt;My previous fix doesn&apos;t resolve the problem completely.&lt;/p&gt;

&lt;p&gt;I&apos;ll paste another one.&lt;/p&gt;</comment>
                            <comment id="12589813" author="amy" created="Thu, 17 Apr 2008 03:49:19 +0100"  >&lt;p&gt;This is the latest fix.&lt;br/&gt;
Please help to review it.&lt;/p&gt;</comment>
                            <comment id="12590267" author="amy" created="Fri, 18 Apr 2008 02:52:39 +0100"  >&lt;p&gt;this is the patch under branch 1.1.x.&lt;/p&gt;

&lt;p&gt;it&apos;s a little weird that my subversion is a Chinese version. I don&apos;t know if the patch can be applied... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12590729" author="amy" created="Sun, 20 Apr 2008 02:10:43 +0100"  >&lt;p&gt;a newer patch for 1.1.x&lt;/p&gt;</comment>
                            <comment id="12591161" author="amy" created="Tue, 22 Apr 2008 02:39:18 +0100"  >&lt;p&gt;Modification of the patch:&lt;br/&gt;
1. use an internal LinkedList instead of involving a new class&lt;br/&gt;
2. add a private method addToBuffer() to MetaDataRepository to enable MetaDataInheritanceComparator.compare() when adding to buffer&lt;br/&gt;
3. use default remove() of LinkedList&lt;br/&gt;
4. set the default value of InheritanceComparator._base to Object.class&lt;br/&gt;
5. add one test case testGetMetaData. delete 2 test methods from TestMetaDataInheritanceComparator: testInheritanceComparatorWithoutBase() and testMetaDataInheritanceComparatorWithoutBase().&lt;/p&gt;

&lt;p&gt;Please help to review.&lt;/p&gt;</comment>
                            <comment id="12591221" author="amy" created="Tue, 22 Apr 2008 07:43:02 +0100"  >&lt;p&gt;modified patch.&lt;/p&gt;</comment>
                            <comment id="12591381" author="awhite" created="Tue, 22 Apr 2008 18:35:43 +0100"  >&lt;p&gt;Latest patch looks pretty good.  Two minor details:&lt;br/&gt;
1. The class should just be InheritanceOrderMetaDataList, not InheritanceOrderMetaDataList&amp;lt;ClassMetaData&amp;gt;.&lt;br/&gt;
2. You don&apos;t need all the &quot;if (buffer != null)&quot; checks.  buffer is never null.  In fact you could make it final.&lt;/p&gt;</comment>
                            <comment id="12591483" author="amy" created="Wed, 23 Apr 2008 00:47:52 +0100"  >&lt;p&gt;a little improvement&lt;/p&gt;</comment>
                            <comment id="12592691" author="pcl" created="Sun, 27 Apr 2008 23:47:54 +0100"  >&lt;p&gt;I think that we can put this one to rest finally.&lt;/p&gt;</comment>
                            <comment id="12668518" author="fyrewyld" created="Thu, 29 Jan 2009 16:59:46 +0000"  >&lt;p&gt;Patch to bring this bugfix back into the 1.0.x stream.&lt;/p&gt;</comment>
                            <comment id="12668602" author="mikedd" created="Thu, 29 Jan 2009 21:02:36 +0000"  >&lt;p&gt;Thanks for the patch Joe.&lt;/p&gt;</comment>
                            <comment id="12668606" author="mikedd" created="Thu, 29 Jan 2009 21:14:14 +0000"  >&lt;p&gt;Closing this issue on Amy&apos;s behalf. It&apos;s fixed in all applicable releases.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12378914" name="364202.patch" size="154648" author="amy" created="Mon, 31 Mar 2008 02:18:35 +0100"/>
                            <attachment id="12377752" name="InheritanceComparator.diff" size="470" author="amy" created="Thu, 13 Mar 2008 05:55:15 +0000"/>
                            <attachment id="12377876" name="MetaDataRepository.diff" size="1614" author="amy" created="Fri, 14 Mar 2008 07:14:11 +0000"/>
                            <attachment id="12399021" name="OPENJPA-536-1.0.x.patch" size="17646" author="fyrewyld" created="Thu, 29 Jan 2009 16:59:46 +0000"/>
                            <attachment id="12380739" name="OPENJPA-536-2.patch" size="772" author="amy" created="Wed, 23 Apr 2008 00:47:52 +0100"/>
                            <attachment id="12380667" name="OPENJPA-536.patch" size="9611" author="amy" created="Tue, 22 Apr 2008 07:43:02 +0100"/>
                            <attachment id="12380658" name="OPENJPA-536.patch" size="7628" author="amy" created="Tue, 22 Apr 2008 02:39:18 +0100"/>
                            <attachment id="12380572" name="OPENJPA-536.patch" size="9728" author="amy" created="Sun, 20 Apr 2008 02:10:43 +0100"/>
                            <attachment id="12380460" name="OPENJPA-536.patch" size="11583" author="amy" created="Fri, 18 Apr 2008 02:52:39 +0100"/>
                            <attachment id="12380358" name="OPENJPA-536.patch" size="10734" author="amy" created="Thu, 17 Apr 2008 03:49:19 +0100"/>
                            <attachment id="12379202" name="OPENJPA-536.patch" size="12824" author="amy" created="Thu, 3 Apr 2008 00:05:03 +0100"/>
                            <attachment id="12379068" name="OPENJPA-536.patch" size="16345" author="amy" created="Tue, 1 Apr 2008 22:23:43 +0100"/>
                            <attachment id="12379001" name="OPENJPA-536.patch" size="1490" author="amy" created="Tue, 1 Apr 2008 04:19:40 +0100"/>
                            <attachment id="12377751" name="meta_testcase.zip" size="3578" author="amy" created="Thu, 13 Mar 2008 05:36:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Apr 2008 01:57:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160853</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysq1r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>201568</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>