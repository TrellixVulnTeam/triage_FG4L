<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:41:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-9/OPENJPA-9.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-9] PCEnhancer not processing multiple PU&apos;s defined within a single persistence.xml file</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-9</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;From a discussion with Patrick on the dev mailing list...&lt;/p&gt;

&lt;p&gt;=========================================================================&lt;br/&gt;
Me:  According to the JPA spec, we can define multiple persistence-units in a single persistence.xml file.  But, when I try to use this persistence.xml file as input to the PCEnhancer, it is only processing the first persistence-unit that is defined.  I traced through the code and found that this is the case.  When the persistence.xml file is processed, a &quot;null&quot; name is passed in for the desired persistence-unit (in the ConfigurationProviderImpl.load method) and, thus, only the first one defined is returned and used by the PCEnhancer.&lt;/p&gt;

&lt;p&gt;Patrick:  IMO, the correct behavior should be:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;PCEnhancer run with no arguments should load all the PUs in the&lt;br/&gt;
classpath, find the OpenJPA (or unspecified) PUs, and run against all&lt;br/&gt;
the classes defined by those PUs (including auto-scanning for PUs so&lt;br/&gt;
configured).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The developer should not need to specify META-INF/persistence.xml when&lt;br/&gt;
invoking the PCEnhancer.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We may want to provide a means to specify specific PUs to process. For&lt;br/&gt;
example:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; java ...PCEnhancer -p META-INF/persistence.xml#foo&lt;/p&gt;

&lt;p&gt;or maybe just&lt;/p&gt;

&lt;p&gt; java ...PCEnhancer -p #foo&lt;/p&gt;

&lt;p&gt;for shorthand.&lt;/p&gt;

&lt;p&gt;Regardless, the current behavior seems wrong, and it seems that the best&lt;br/&gt;
initial change would be to make PCEnhancer load all the PUs (the first&lt;br/&gt;
bullet above), which means manually loading the META-INF/persistence.xml&lt;br/&gt;
resources and finding the ones that are OpenJPA PUs, rather than relying&lt;br/&gt;
on the javax.persistence.Persistence helper method to load them.&lt;br/&gt;
=========================================================================&lt;/p&gt;

&lt;p&gt;Writing this bug report so as not to lose track of this problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12347611">OPENJPA-9</key>
            <summary>PCEnhancer not processing multiple PU&apos;s defined within a single persistence.xml file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kwsutter">Kevin Sutter</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Aug 2006 16:03:51 +0100</created>
                <updated>Mon, 9 Jul 2012 11:18:41 +0100</updated>
                            <resolved>Fri, 16 Nov 2007 01:16:46 +0000</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>jpa</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12542923" author="pcl" created="Fri, 16 Nov 2007 01:16:46 +0000"  >&lt;p&gt;I changed a number of other command-line scripts to loop over multiple PUs as well. I have not exhaustively tested all the command-line scripts.&lt;/p&gt;</comment>
                            <comment id="13121901" author="mspiro" created="Thu, 6 Oct 2011 13:56:17 +0100"  >&lt;p&gt;Is this issue really fixed? I&apos;m using the PCEnhancerTask with Ant and OpenJPA version 2.1.0 and the bug is still there. This line:&lt;/p&gt;

&lt;p&gt;        PersistenceUnitInfoImpl pinfo = parseResources(parser, urls, name, loader);&lt;/p&gt;

&lt;p&gt;(Class PersistenceProductDerivation , line 525) seems to be the point where it begins to go wrong. This following method (beginning in the line 554) generates an internal list of all persistence units, but returns only one of them losing infromation about the rest:&lt;/p&gt;

&lt;p&gt;    private PersistenceUnitInfoImpl parseResources(ConfigurationParser parser,&lt;br/&gt;
        List&amp;lt;URL&amp;gt; urls, String name, ClassLoader loader)&lt;br/&gt;
        throws IOException {&lt;br/&gt;
        List&amp;lt;PersistenceUnitInfoImpl&amp;gt; pinfos = new ArrayList&amp;lt;PersistenceUnitInfoImpl&amp;gt;();&lt;br/&gt;
        for (URL url : urls) &lt;/p&gt;
{
            parser.parse(url);
            pinfos.addAll((List&amp;lt;PersistenceUnitInfoImpl&amp;gt;) parser.getResults());
        }
&lt;p&gt;        return findUnit(pinfos, name, loader);&lt;br/&gt;
    }&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 16 Nov 2007 01:16:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49598</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7jiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288133</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>