<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:39:42 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-866/OPENJPA-866.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-866] DBDictionary.maxTableNameLength is not checked when using SynchronizeMappings</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-866</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Per Alan Raison&apos;s post to the dev mailing list there appears to be a problem with trimming table names when SynchronizeMappings is used. &lt;/p&gt;

&lt;p&gt;Here&apos;s the email that started the conversation : &lt;br/&gt;
I have been writing a DBDictionary for the Ingres database and have been running the test cases.  Ingres supports 32 character table names, and this has been set in the dictionary.  However some tests have hit an error whereby the table name is too long for the database.&lt;/p&gt;

&lt;p&gt;I notice in the DBDictionary class there is a method called &quot;getValidTableName&quot; but this clearly isn&apos;t being used since it is trying to use a table name which is too long.  Other databases (such as Oracle) also have quite a short maximum length for table names, so this problem must be able to overcome, but I can&apos;t see anything in other Dictionary classes.&lt;/p&gt;

&lt;p&gt;Is there anything special I should be doing to run the tests?  I am currently running through mvn test.&lt;/p&gt;

&lt;p&gt;My draft DBDictionary class is attached along with a sample surefire report (with my username and password removed!)&lt;/p&gt;

&lt;p&gt;The full thread can be seen here : &lt;a href=&quot;http://n2.nabble.com/OpenJPA-1.2.0-Test-Cases---Table-Name-too-Long-td2197132.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://n2.nabble.com/OpenJPA-1.2.0-Test-Cases---Table-Name-too-Long-td2197132.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12413092">OPENJPA-866</key>
            <summary>DBDictionary.maxTableNameLength is not checked when using SynchronizeMappings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mcconne">Tim McConnell</assignee>
                                    <reporter username="alan_raison">Alan Raison</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Jan 2009 14:53:51 +0000</created>
                <updated>Wed, 14 Jul 2010 16:57:05 +0100</updated>
                            <resolved>Thu, 12 Mar 2009 21:32:55 +0000</resolved>
                                    <version>1.2.0</version>
                    <version>1.3.0</version>
                    <version>2.0.0-M2</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-M2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12677884" author="mcconne" created="Mon, 2 Mar 2009 04:05:10 +0000"  >&lt;p&gt;Adding a patch to check that the table name is valid before adding it to the schema. This fixes the problem for Oracle, which has only a 30-character maximum table length name, but should work for Ingres as well. I&apos;ll install and test with Ingres tomorrow just to be sure.&lt;/p&gt;</comment>
                            <comment id="12677959" author="alan_raison" created="Mon, 2 Mar 2009 11:20:42 +0000"  >&lt;p&gt;You&apos;ll need the Ingres DBDictionary, which can be found at &lt;a href=&quot;http://code.ingres.com/apps/openjpa/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://code.ingres.com/apps/openjpa/&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure that&apos;s 100% up to date, however, so I&apos;ll run on my own machine and let you know.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Alan&lt;/p&gt;</comment>
                            <comment id="12678029" author="alan_raison" created="Mon, 2 Mar 2009 16:12:35 +0000"  >&lt;p&gt;I&apos;ve just tried to run the test &quot;org.apache.openjpa.enhance.TestDataCachingAndUnenhancedPropertyAccess&quot; with the patched sources, but I still get:&lt;/p&gt;

&lt;p&gt;Table name &quot;UnenhancedIdentityIdPropertyAccess&quot; is 34-character long. The database allows maximum 32-character for a table name.&lt;/p&gt;

&lt;p&gt;How did you test the patch?  Let me know and I will try to replicate that.&lt;/p&gt;</comment>
                            <comment id="12679045" author="mcconne" created="Thu, 5 Mar 2009 02:54:06 +0000"  >&lt;p&gt;Attaching another patch to check the length of the table and column names when dynamically creating the database schema. It also includes a JUnit testcase to demonstrate the failure on multiple databases.&lt;/p&gt;</comment>
                            <comment id="12679048" author="mcconne" created="Thu, 5 Mar 2009 03:05:00 +0000"  >&lt;p&gt;Hi Alan, I&apos;ve been testing this failure on the following databases: MySQL, PostgreSQL, DB2, Derby, and Oracle. Unfortunately, I&apos;ve haven&apos;t been able to get the Ingres database working with OpenJPA using your dictionary. This second patch improves the maven build very significantly with the Oracle database, which has only a 30-character table and column limit. BTW, did you know that you have the maxColumnNameLength defined twice in your IngreDictionary class ??&lt;/p&gt;</comment>
                            <comment id="12679170" author="alan_raison" created="Thu, 5 Mar 2009 11:59:58 +0000"  >&lt;p&gt;Tim&lt;/p&gt;

&lt;p&gt;I&apos;ve tried your patch and although it improves things somewhat, in that there are no more &quot;table name too long&quot; errors, I still get a number of schema-related errors.  For example, with the aforementioned TestDataCachingAndUnenhancedPropertyAccess test, I get errors along the lines of:&lt;/p&gt;

&lt;p&gt;Table &apos;unenhancedidentityidpropertyacc1&apos; does not exist or is not owned by you. &lt;/p&gt;
{DELETE FROM UNENHANCEDIDENTITYIDPROPERTYACC1}

&lt;p&gt;I am, however getting some previously failing tests to pass; org.apache.openjpa.enhance.TestUnenhancedCompoundPK.testCompoundPKFieldAccessOpenJPADefined passes whereas the other three in that class do not.&lt;/p&gt;

&lt;p&gt;BTW apologies for claiming that your first patch did nothing; the problem was with maven/eclipse.&lt;/p&gt;</comment>
                            <comment id="12679252" author="mcconne" created="Thu, 5 Mar 2009 17:30:45 +0000"  >&lt;p&gt;Hi Alan, thanks for the feedback. I&apos;ll look at your remaining problem(s) later today/tonight to see if I can figure out what&apos;s going on.....&lt;/p&gt;</comment>
                            <comment id="12679253" author="alan_raison" created="Thu, 5 Mar 2009 17:38:19 +0000"  >&lt;p&gt;It appears that the table has beenn created with the name &quot;UNENHANCEDIDENTITYIDPROPERTYACCE&quot; but OpenJPA is trying to access it as &quot;UNENHANCEDIDENTITYIDPROPERTYACC1&quot; (one letter shorter with a digit added)&lt;/p&gt;</comment>
                            <comment id="12679302" author="mikedd" created="Thu, 5 Mar 2009 18:58:44 +0000"  >&lt;p&gt;Regarding the entity for the testcase could we change the field names to be something shorter (ie under the 80 column limit) and use the @Column annotation if they need to be longer (which can be split across multiple lines). &lt;/p&gt;</comment>
                            <comment id="12679318" author="mcconne" created="Thu, 5 Mar 2009 19:35:38 +0000"  >&lt;p&gt;Sure Michael, I&apos;ll take care of that in the next patch once I get Alan&apos;s remaining problem(s) fixed......&lt;/p&gt;</comment>
                            <comment id="12679820" author="mcconne" created="Sat, 7 Mar 2009 03:40:04 +0000"  >&lt;p&gt;Here is the final (hopefully) patch to fix this problem. It basically checks the dictionary before adding tables to dynamic schemas and columns to those tables. If either exceeds the maximum length specified in the dictionary the table/column names are made valid using the same dictionary. There are still problems related to reserved words for table/column names but I&apos;ll address that problem with another patch for that JIRA. &lt;/p&gt;</comment>
                            <comment id="12680126" author="alan_raison" created="Mon, 9 Mar 2009 11:00:37 +0000"  >&lt;p&gt;Tim - thanks for that, it works a treat.&lt;/p&gt;</comment>
                            <comment id="12680872" author="allee8285" created="Wed, 11 Mar 2009 14:03:47 +0000"  >&lt;p&gt;I tried apply the patch against the trunk but mvn clean install consistently failied in:&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests in error:&lt;br/&gt;
  testCacheMarshallerEndToEnd(org.apache.openjpa.conf.TestCacheMarshallerEndToEnd)&lt;/p&gt;

&lt;p&gt;Tests run: 1374, Failures: 0, Errors: 1, Skipped: 0&lt;/p&gt;

&lt;p&gt;I ran the with and without the patch twice and still failed the same say.&lt;/p&gt;

&lt;p&gt;Can you take a look and see what may be causing the problem ?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Albert Lee.&lt;/p&gt;</comment>
                            <comment id="12681174" author="mcconne" created="Thu, 12 Mar 2009 06:10:27 +0000"  >&lt;p&gt;Hi Albert, This was my fault. I will attach another patch tomorrow and will be more thorough in testing my patches. Thanks much....&lt;/p&gt;</comment>
                            <comment id="12681428" author="mcconne" created="Thu, 12 Mar 2009 18:20:12 +0000"  >&lt;p&gt;Another patch which to fixex the serialization problem. The DynamicTable inner class is now non-static like the DynamicColumn inner class in DynamicSchemaFactory. All JUnit testcases in the build (i.e., Derby database) work fine now....&lt;/p&gt;</comment>
                            <comment id="12713037" author="drwoods" created="Tue, 26 May 2009 15:52:34 +0100"  >&lt;p&gt;also included in 1.3.x as Rev778727&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12469241">OPENJPA-1725</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12402071" name="OPENJPA-866_4.patch" size="17090" author="mcconne" created="Thu, 12 Mar 2009 18:20:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 2 Mar 2009 04:05:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161168</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysrlr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>201820</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>