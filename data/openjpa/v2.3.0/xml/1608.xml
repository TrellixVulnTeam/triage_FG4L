<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:32:48 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1608/OPENJPA-1608.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1608] PESSIMISTIC_WRITE is not working in Informix</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1608</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;The following call:&lt;/p&gt;

&lt;p&gt;	district = em.find(DistrictJPA.class, key, LockModeType.PESSIMISTIC_WRITE);&lt;/p&gt;

&lt;p&gt;	generates SELECT ... FOR UPDATE .&lt;/p&gt;

&lt;p&gt;	However, in the default isolation level (read committed). Informix does not lock the row, causing a lot of duplicate key errors. The work around is for the application to explicitly set the property below in the persistence.xml:&lt;/p&gt;

&lt;p&gt;	&amp;lt;property name=&quot;openjpa.jdbc.TransactionIsolation&quot; value=&quot;repeatable-read&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;	According to the spec 3.4.4, footnote:&lt;/p&gt;

&lt;p&gt;	For example, a persistence provider may use an underlying database platform&apos;s SELECT FOR UPDATE statements to implement pessimistic locking if that construct provides appropriate semantics, or the provider may use an isolation level of repeatable read.&lt;/p&gt;

&lt;p&gt;	It appears that the persistence provider must implements PESSIMISTIC_WRITE semantics transparently to the application. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12460960">OPENJPA-1608</key>
            <summary>PESSIMISTIC_WRITE is not working in Informix</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="faywang">Fay Wang</assignee>
                                    <reporter username="faywang">Fay Wang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Apr 2010 18:26:18 +0100</created>
                <updated>Fri, 20 Feb 2015 21:10:47 +0000</updated>
                            <resolved>Mon, 5 Apr 2010 17:00:40 +0100</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12852532" author="faywang" created="Thu, 1 Apr 2010 21:19:45 +0100"  >&lt;p&gt;Changing the isolation level to repeatable read globally can reduce the concurrency. Changing it in the middle when PESSIMISTIC LOCK is specified is not allowed in the XA transaction. Another workaround for informix is to execute &quot;SET ENVIRONMENT RETAINUPDATELOCKS &apos;ALL&apos;&quot; statement before executing the &quot;SELECT ... FOR UPDATE&quot; as show below:&lt;/p&gt;

&lt;p&gt;    public static void main (String a[]) throws Exception {&lt;br/&gt;
        Connection conn = getConnection();&lt;br/&gt;
        conn.setAutoCommit(false);&lt;br/&gt;
        conn.setTransactionIsolation(   Connection.TRANSACTION_READ_UNCOMMITTED);&lt;br/&gt;
         String retainLocks = &quot;SET ENVIRONMENT RETAINUPDATELOCKS &apos;ALL&apos;&quot;;&lt;br/&gt;
         PreparedStatement pstmt2 = conn.prepareStatement(retainLocks);&lt;br/&gt;
         pstmt2.executeUpdate();&lt;/p&gt;

&lt;p&gt;         String sql = &quot;select version from STOCK where S_I_ID = 8808 and S_W_ID = 9 for update&quot;;&lt;br/&gt;
         PreparedStatement pstmt1 = conn.prepareStatement(sql);&lt;br/&gt;
         ResultSet rs1 = pstmt1.executeQuery();&lt;/p&gt;

&lt;p&gt;         while (rs1.next()) &lt;/p&gt;
{
                int version = rs1.getInt(1);
                System.out.println(&quot;version = &quot; + version);
         }
&lt;p&gt;         rs1.close();&lt;br/&gt;
         conn.commit();&lt;br/&gt;
      } &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://publib.boulder.ibm.com/infocenter/idshelp/v115/index.jsp?topic=/com.ibm.sqls.doc/ids_sqs_2038.htm&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://publib.boulder.ibm.com/infocenter/idshelp/v115/index.jsp?topic=/com.ibm.sqls.doc/ids_sqs_2038.htm&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="12852866" author="mikedd" created="Fri, 2 Apr 2010 18:06:06 +0100"  >&lt;p&gt;Patch looks good Fay, go for it. &lt;/p&gt;</comment>
                            <comment id="12853416" author="faywang" created="Mon, 5 Apr 2010 17:00:26 +0100"  >&lt;p&gt;The pessimistic write lock can still be a potential problem for other databases where select for update is only effective in certain isolation levels. The current patch is to fix informix only.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12775972">OPENJPA-2570</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12440550" name="OPENJPA-1608.patch" size="2604" author="faywang" created="Thu, 1 Apr 2010 23:30:45 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 2 Apr 2010 17:06:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38568</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt42n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203840</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>