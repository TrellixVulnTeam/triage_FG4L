<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:32:09 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1387/OPENJPA-1387.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1387] Unique colums automatically defined as non-nullable</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1387</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Any unique constraint declared with OpenJPA implicitly sets the respective columns to be non-null. This is a problem if OpenJPA&apos;s mapping tool is used to create the database schema. Even if something like @Column(nullable=true) is explicitly stated, the columns will always be created by OpenJPA as not null.&lt;/p&gt;

&lt;p&gt;Modifying the database schema manually to make the columns nullable is a possible workaround. It does not seem to cause any problems with either OpenJPA or the databases.&lt;/p&gt;

&lt;p&gt;I would suggest to drop the marking of unique columns as not nullable. This is done by removing the corresponding code lines in org.apache.openjpa.jdbc.schema.Unique (trivial patch appended to this issue). If someone wants a unique column to be not nullable, this can be specified explicitly with @Column(nullable=false) as usual.&lt;/p&gt;

&lt;p&gt;I can only speculate about the reason this strange coupling of unique and nullable had been introduced into OpenJPA. To my knowledge, it is perfectly legal use to have unique contraints on nullable columns. In effect this means that there may be multiple rows with null values, whilst all rows with non-null values have to be unique. ANSI SQL-92 also explicitly mentions nullable unique columns and states that this is a crucial difference between PRIMARY KEY columns and UNIQUE columns: the former are always not nullable, the latter may be nullable.&lt;/p&gt;

&lt;p&gt;This issue also pops up again and again in the user discussions, without (to my knowledge) a single authorative answer to why this behaviour is as it is in OpenJPA. Two examples:&lt;br/&gt;
My question, which remained unanswered:&lt;br/&gt;
&lt;a href=&quot;http://n2.nabble.com/Unique-colums-automatically-made-NOT-NULL-td2827809.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://n2.nabble.com/Unique-colums-automatically-made-NOT-NULL-td2827809.html&lt;/a&gt;&lt;br/&gt;
Another users question, about a month later:&lt;br/&gt;
&lt;a href=&quot;http://n2.nabble.com/Nullable-unique-constraints-td3161182.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://n2.nabble.com/Nullable-unique-constraints-td3161182.html&lt;/a&gt;&lt;/p&gt;
</description>
                <environment>Error happens in every environment.</environment>
        <key id="12440619">OPENJPA-1387</key>
            <summary>Unique colums automatically defined as non-nullable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jpaheath">Heath Thomann</assignee>
                                    <reporter username="dirichs">Martin Dirichs</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Nov 2009 14:50:35 +0000</created>
                <updated>Wed, 23 Jan 2013 23:41:40 +0000</updated>
                            <resolved>Wed, 23 Jan 2013 23:41:40 +0000</resolved>
                                    <version>1.2.3</version>
                    <version>2.0.0-M3</version>
                                    <fixVersion>1.2.3</fixVersion>
                    <fixVersion>2.0.0-beta</fixVersion>
                                    <component>sql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12778287" author="dirichs" created="Mon, 16 Nov 2009 10:26:17 +0000"  >&lt;p&gt;Just noticed that there exists an exceptional database not capable of unique contraints on nullable fields: Apache Derby, versions up to 10.4.1.3. In 10.4.1.3, this shortcoming was fixed, see here:&lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/browse/DERBY-3330&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/DERBY-3330&lt;/a&gt;&lt;br/&gt;
OpenJPA currently uses Derby 10.2.2.0 for its test cases. Thus, there are build failures after applying this patch. There are three possibilities of how to deal with this:&lt;br/&gt;
1. Eliminate the problem by updating to a more recent Derby version.&lt;br/&gt;
2. Modify the test cases so that @Column(nullable=false) is explicitly stated where necessary.&lt;br/&gt;
3. Continue to label columns implicitly as non-nullable as database-specific logic. Do it for Derby &amp;lt; 10.4.1.3 and maybe some other database out there I am not aware of, leave it for all others (default).&lt;/p&gt;</comment>
                            <comment id="12864267" author="struberg" created="Wed, 5 May 2010 11:41:01 +0100"  >&lt;p&gt;it seems that this bug is still not fixed (tested with latest from SVN).&lt;/p&gt;

&lt;p&gt;This test project will show the problems.&lt;/p&gt;

&lt;p&gt;There are 2 issues which are not yet resolved&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Unique columns doesn&apos;t need to be mandatory (currently they are &lt;em&gt;always&lt;/em&gt; generated as NOT NULL)&lt;/li&gt;
	&lt;li&gt;NOT NULL columns of type String which are not filled will get stored as empty string (instead of throwing an Exception). See &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-525&quot; title=&quot;Inserts new entity with NULL value for Clob column actually inserts empty string&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-525&quot;&gt;&lt;del&gt;OPENJPA-525&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12864359" author="ppoddar@apache.org" created="Wed, 5 May 2010 16:24:20 +0100"  >&lt;p&gt;Reopening as per further discussion.&lt;/p&gt;</comment>
                            <comment id="12864365" author="struberg" created="Wed, 5 May 2010 16:33:48 +0100"  >&lt;p&gt;A few tips on my sample project:&lt;br/&gt;
The NOT NULL can be checked by simply executing&lt;br/&gt;
$&amp;gt; mvn openjpa:sql&lt;br/&gt;
which generates the database creation SQL script in&lt;br/&gt;
./target/database.sql&lt;/p&gt;

&lt;p&gt;to execute the project you need to create the database upfront in MySQL with &lt;br/&gt;
create database TestDb;&lt;br/&gt;
user &apos;root&apos; with no password is assumed (persistence.xml)&lt;/p&gt;

&lt;p&gt;After&lt;br/&gt;
$&amp;gt; mvn clean install&lt;br/&gt;
you will see the myString column as empty string instead of NULL when doing a&lt;br/&gt;
mysql&amp;gt; select * from NullFieldTable;&lt;br/&gt;
&lt;ins&gt;---&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;---------+&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; PK &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; myString &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;&lt;ins&gt;---&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;---------+&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  1 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;&lt;ins&gt;---&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;---------+&lt;br/&gt;
1 row in set (0.00 sec)&lt;/p&gt;</comment>
                            <comment id="12864372" author="mikedd" created="Wed, 5 May 2010 16:49:22 +0100"  >&lt;p&gt;Once the issue has been marked as fixed in the release notes it&apos;s confusing to have it show up again. Rather than using the same issue I&apos;ve created  a new JIRA (&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1651&quot; title=&quot;Unique colums automatically defined as non-nullable (part 2)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1651&quot;&gt;&lt;del&gt;OPENJPA-1651&lt;/del&gt;&lt;/a&gt;) to discuss the new variation.. &lt;/p&gt;

&lt;p&gt;I&apos;m re-closing this one. Sorry for the noise. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12463784">OPENJPA-1651</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12463784">OPENJPA-1651</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12466193">OPENJPA-1682</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12424852" name="OpenJPA-Trunk_OJ1387.patch" size="714" author="dirichs" created="Fri, 13 Nov 2009 14:55:28 +0000"/>
                            <attachment id="12443704" name="openjpa-test.zip" size="8384" author="struberg" created="Wed, 5 May 2010 11:41:01 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 5 May 2010 10:41:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161654</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt6br:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204205</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>