<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:29:47 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-2318/OPENJPA-2318.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-2318] Left outer join is not generated when specifien using Criteria API</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-2318</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Entities&lt;br/&gt;
@Entity&lt;br/&gt;
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)&lt;br/&gt;
public class DiscoveryObjectImpl {&lt;br/&gt;
	@Id&lt;br/&gt;
	private String id;&lt;br/&gt;
	public String getId() &lt;/p&gt;
{
		return id;
	}

&lt;p&gt;	public void setId(String id) &lt;/p&gt;
{
		this.id = id;
	}

&lt;p&gt;	@ManyToOne(cascade = CascadeType.ALL)&lt;br/&gt;
	private DiscoveryObjectImpl parent;&lt;/p&gt;


&lt;p&gt;	public DiscoveryObjectImpl getParent() &lt;/p&gt;
{		
		return parent;
	}

&lt;p&gt;	public void setParent(DiscoveryObjectImpl parent) &lt;/p&gt;
{
		this.parent = parent;  

	}
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;@Entity&lt;br/&gt;
public class ColumnFormatImpl extends DiscoveryObjectImpl &lt;/p&gt;
{
	@Basic
	String formatName; 
}

&lt;p&gt;@Entity&lt;br/&gt;
public class ColumnImpl extends DiscoveryObjectImpl &lt;/p&gt;
{
@OneToMany(mappedBy=&quot;parent&quot;)
private List&amp;lt;ColumnFormatImpl&amp;gt; formats = new ArrayList&amp;lt;ColumnFormatImpl&amp;gt;();

}

&lt;p&gt;@Entity&lt;br/&gt;
public class VirtualTableImpl extends DiscoveryObjectImpl &lt;/p&gt;
{
@OneToMany(mappedBy=&quot;parent&quot;)
	private List&amp;lt;ColumnImpl&amp;gt; columns = new ArrayList&amp;lt;ColumnImpl&amp;gt;();
}

&lt;p&gt;persistence.xml&lt;br/&gt;
&amp;lt;persistence xmlns=&quot;http://java.sun.com/xml/ns/persistence&quot;&lt;br/&gt;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;br/&gt;
    xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/persistence &lt;a href=&quot;http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd&lt;/a&gt;&quot;&lt;br/&gt;
    version=&quot;1.0&quot;&amp;gt;&lt;br/&gt;
 &amp;lt;persistence-unit name=&quot;Test&quot; transaction-type=&quot;RESOURCE_LOCAL&quot;&amp;gt;&lt;br/&gt;
 	&amp;lt;provider&amp;gt;org.apache.openjpa.persistence.PersistenceProviderImpl&amp;lt;/provider&amp;gt;&lt;br/&gt;
 	&amp;lt;class&amp;gt;com.ibm.infosphere.test.model.interfaces.impl.DiscoveryObjectImpl&amp;lt;/class&amp;gt;&lt;br/&gt;
 	&amp;lt;class&amp;gt;com.ibm.infosphere.test.model.interfaces.impl.VirtualTableImpl&amp;lt;/class&amp;gt;&lt;br/&gt;
 	&amp;lt;class&amp;gt;com.ibm.infosphere.test.model.interfaces.impl.ColumnImpl&amp;lt;/class&amp;gt;&lt;br/&gt;
 	&amp;lt;class&amp;gt;com.ibm.infosphere.test.model.interfaces.impl.ColumnFormatImpl&amp;lt;/class&amp;gt; 	&lt;br/&gt;
 	&amp;lt;exclude-unlisted-classes&amp;gt;true&amp;lt;/exclude-unlisted-classes&amp;gt; 			&lt;br/&gt;
	&amp;lt;properties&amp;gt;&lt;br/&gt;
			&amp;lt;property name=&quot;openjpa.Log&quot; value=&quot;DefaultLevel=ERROR, Runtime=ERROR, Tool=ERROR, SQL=TRACE, MetaData=ERROR&quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;property name=&quot;openjpa.DynamicEnhancementAgent&quot;  value=&quot;false&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;property name=&quot;openjpa.RuntimeUnenhancedClasses&quot; value=&quot;supported&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;property name=&quot;openjpa.jdbc.SynchronizeMappings&quot; value=&quot;buildSchema(ForeignKeys=true)&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;property name=&quot;openjpa.InitializeEagerly&quot; value=&quot;true&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;property name=&quot;openjpa.jdbc.DBDictionary&quot; value=&quot;oracle&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;property name=&quot;openjpa.jdbc.DBDictionary&quot; value=&quot;MaxTableNameLength=61&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;property name=&quot;openjpa.jdbc.DBDictionary&quot; value=&quot;useWildCardForCount=true&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;property name=&quot;openjpa.jdbc.DBDictionary&quot; value=&quot;JoinSyntax=sql92&quot;/&amp;gt;&lt;br/&gt;
 			&amp;lt;property name=&quot;openjpa.ConnectionURL&quot; value=&quot;jdbc:oracle:thin:@localhost:1521:orcl&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;    		&amp;lt;property name=&quot;openjpa.ConnectionDriverName&quot; value=&quot;oracle.jdbc.driver.OracleDriver&quot;/&amp;gt; &lt;br/&gt;
      		&amp;lt;property name=&quot;openjpa.ConnectionUserName&quot; value=&quot;lev&quot;/&amp;gt;&lt;br/&gt;
      		&amp;lt;property name=&quot;openjpa.ConnectionPassword&quot; value=&quot;lev&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;            &amp;lt;property name=&quot;openjpa.ConnectionFactoryProperties&quot;    value=&quot;PrettyPrint=true, PrettyPrintLineLength=80, PrintParameters=true&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;property name=&quot;openjpa.DataCache&quot;                value=&quot;true&quot;/&amp;gt;        &lt;br/&gt;
            &amp;lt;property name=&quot;openjpa.RemoteCommitProvider&quot;     value=&quot;sjvm&quot;/&amp;gt;            &lt;br/&gt;
            &amp;lt;property name=&quot;openjpa.jdbc.QuerySQLCache&quot;       value=&quot;true(EnableStatistics=true)&quot;/&amp;gt;            &lt;br/&gt;
		&amp;lt;/properties&amp;gt;&lt;br/&gt;
&amp;lt;/persistence-unit&amp;gt;&lt;br/&gt;
&amp;lt;/persistence&amp;gt;&lt;/p&gt;

&lt;p&gt;Test code:&lt;br/&gt;
public void test() &lt;/p&gt;
{
        CriteriaQuery&amp;lt;ColumnImpl&amp;gt; cri = cb.createQuery(ColumnImpl.class);
        Root&amp;lt;VirtualTableImpl&amp;gt; tbl = cri.from(VirtualTableImpl.class);
        Join&amp;lt;VirtualTableImpl, ColumnImpl&amp;gt; col = tbl.join(&quot;columns&quot;);
        Join&amp;lt;ColumnImpl, ColumnFormatImpl&amp;gt; format = col.join(&quot;formats&quot;, JoinType.LEFT);
        cri.where(cb.equal(format.get(&quot;formatName&quot;), &quot;ABC&quot;));
        cri.select(col);
        em.createQuery(cri).getResultList();
}

&lt;p&gt;Generated SQL:&lt;br/&gt;
SELECT t1.id, t1.PARENT_ID &lt;br/&gt;
    FROM VirtualTableImpl t0 INNER JOIN ColumnImpl t1 ON t0.id = t1.PARENT_ID INNER &lt;br/&gt;
        JOIN ColumnFormatImpl t2 ON t1.id = t2.PARENT_ID &lt;br/&gt;
    WHERE (t2.formatName = ? AND 1 = 1) &lt;/p&gt;

&lt;p&gt;As you can see the secong JOIN is INNER instead of LEFT OUTER&lt;/p&gt;

</description>
                <environment>Windows/Oracle</environment>
        <key id="12626144">OPENJPA-2318</key>
            <summary>Left outer join is not generated when specifien using Criteria API</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ppoddar@apache.org">Pinaki Poddar</assignee>
                                    <reporter username="levtse">Lev</reporter>
                        <labels>
                    </labels>
                <created>Sat, 5 Jan 2013 00:50:14 +0000</created>
                <updated>Thu, 25 Sep 2014 16:27:33 +0100</updated>
                            <resolved>Fri, 16 Aug 2013 19:26:15 +0100</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.2.1.1</fixVersion>
                    <fixVersion>2.2.3</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>criteria</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13658240" author="slowstrider" created="Wed, 15 May 2013 11:56:29 +0100"  >&lt;p&gt;I&apos;m having exacly the same issue. When printing the internally generated &quot;JPQL&quot; using (OpenJPACriteriaQuery) q).toCQL() it does show a LEFT JOIN, but the actual generated SQL has an inner join.&lt;br/&gt;
The manually written equivalent JPQL does generate SQL with &quot;LEFT OUTER JOIN&quot;.&lt;/p&gt;

&lt;p&gt;The problem does not happen when the query has only one join.&lt;/p&gt;</comment>
                            <comment id="13658248" author="slowstrider" created="Wed, 15 May 2013 12:09:47 +0100"  >&lt;p&gt;Not 100% sure but this may have to do with inheritance.&lt;/p&gt;

&lt;p&gt;My structure is like Order 1..* OrderLine 1..1 Product *..1 Category. Category is optional so when I select from Order I (should) get inner joins followed by a left join.&lt;br/&gt;
My Order class extends from another abstract entity class using TABLE_PER_CLASS.&lt;br/&gt;
When I leave out Order and select from OrderLine I do get an inner join followed by a left outer join.&lt;/p&gt;</comment>
                            <comment id="13658255" author="slowstrider" created="Wed, 15 May 2013 12:30:05 +0100"  >&lt;p&gt;Same issue when leaving out Category and making OrderLine 1 .. 1 Product optional (= 3 tables, 2 joins just like the example of this issue).&lt;/p&gt;</comment>
                            <comment id="13658265" author="slowstrider" created="Wed, 15 May 2013 12:48:36 +0100"  >&lt;p&gt;I reproduced the problem for another query with 3 entities that have no superclasses (except for @MappedSuperclass). I select from an inner join followed by a left join and get the exact same issue. (A 1..* B *..1 C)&lt;/p&gt;</comment>
                            <comment id="13658292" author="slowstrider" created="Wed, 15 May 2013 13:18:45 +0100"  >&lt;p&gt;I created an (almost) official OpenJPA test case that reproduces the issue.&lt;br/&gt;
I took the CriteriaTest TestJPQLSubquery.testSubqueries6 as a starting point to create the test. It reuses the existing structure&lt;/p&gt;

&lt;p&gt;Customer 1..* accounts 1..1 owner&lt;/p&gt;

&lt;p&gt;    public void testLeftJoinAfterInnerJoin() &lt;/p&gt;
{
        String jpql = &quot;SELECT c FROM Customer c INNER JOIN c.accounts a LEFT JOIN a.owner o&quot;;
        String expectedSQL = &quot;SELECT t0.id, t0.accountNum, t4.id, t4.city, t4.country, t4.county, t4.state, &quot; +
        		&quot;t4.street, t5.userid, t5.DTYPE, t5.age, t5.compName, t5.creditRating, t5.name, t4.zipCode, &quot; +
        		&quot;t0.balanceOwed, t0.creditRating, t0.filledOrderCount, t0.firstName, t0.lastName, t0.name, t0.status &quot; +
        		&quot;FROM CR_CUST t0 &quot; +
        		&quot;INNER JOIN CR_CUST_CR_ACCT t1 ON t0.id = t1.CUSTOMER_ID &quot; +
        		&quot;LEFT OUTER JOIN CR_ADDR t4 ON t0.ADDRESS_ID = t4.id &quot; +
        		&quot;INNER JOIN CR_ACCT t2 ON t1.ACCOUNTS_ID = t2.id &quot; +
        		&quot;LEFT OUTER JOIN CompUser t5 ON t4.id = t5.ADD_ID &quot; +
        		&quot;LEFT OUTER JOIN CR_PSN t3 ON t2.OWNER_ID = t3.id&quot;;

        executeAndCompareSQL(jpql, expectedSQL);
        
        CriteriaQuery&amp;lt;Customer&amp;gt; q = cb.createQuery(Customer.class);
        Root&amp;lt;Customer&amp;gt; c = q.from(Customer.class);
        Join&amp;lt;Customer,Account&amp;gt; a = c.join(Customer_.accounts);
        Join&amp;lt;Account, Person&amp;gt; o = a.join(Account_.owner, JoinType.LEFT);
        q.select(c);
        
        assertEquivalence(q, jpql);
    }

&lt;p&gt;Simply copy/paste into TestJPQLSubquery and run.&lt;br/&gt;
You will get a nice assertion error that compares the SQL for the JPQL query with the SQL for the Criteria query and you can see that only the last part of the query differs. JPQL has &quot;LEFT OUTER JOIN&quot; while Criteria has &quot;INNER JOIN&quot;.&lt;/p&gt;

&lt;p&gt;Can an OpenJPA committer look into this? I think I have now done the necessary work I can do to pinpoint the issue.&lt;/p&gt;</comment>
                            <comment id="13658316" author="slowstrider" created="Wed, 15 May 2013 13:43:20 +0100"  >&lt;p&gt;I found the cause of the problem!&lt;/p&gt;

&lt;p&gt;By simply following the call chain of join I found that this test can be made to pass by changing line 210 of org.apache.openjpa.persistence.criteria.Joins from&lt;/p&gt;

&lt;p&gt;path.get(_member.fmd, false);&lt;/p&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;p&gt;path.get(_member.fmd, allowNull);&lt;/p&gt;

&lt;p&gt;This is the code that translates the join into an openJPA kernal expression and somehow fills in false for allowNull while it should be true according to&lt;br/&gt;
allowNull = joinType != JoinType.INNER&lt;/p&gt;

&lt;p&gt;There is also another call to path.get using the literal value of false.&lt;/p&gt;

&lt;p&gt;I believe an OpenJPA committer should be able to quickly fix this issue now. (Note that I have no clue of the consequences of this change, perhaps the literal value of false was deliberate and perhaps it breaks other tests.)&lt;/p&gt;</comment>
                            <comment id="13742268" author="wizman" created="Fri, 16 Aug 2013 15:36:43 +0100"  >&lt;p&gt;Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2318&quot; title=&quot;Left outer join is not generated when specifien using Criteria API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2318&quot;&gt;&lt;del&gt;OPENJPA-2318&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13742495" author="jira-bot" created="Fri, 16 Aug 2013 19:25:24 +0100"  >&lt;p&gt;Commit 1514833 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ppoddar%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;ppoddar@apache.org&quot;&gt;Pinaki Poddar&lt;/a&gt; in branch &apos;openjpa/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1514833&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1514833&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2318&quot; title=&quot;Left outer join is not generated when specifien using Criteria API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2318&quot;&gt;&lt;del&gt;OPENJPA-2318&lt;/del&gt;&lt;/a&gt;: Left outer join is not generated because allowNull was not passed correctly&lt;/p&gt;</comment>
                            <comment id="13840334" author="jira-bot" created="Thu, 5 Dec 2013 17:52:01 +0000"  >&lt;p&gt;Commit 1548222 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fyrewyld&quot; class=&quot;user-hover&quot; rel=&quot;fyrewyld&quot;&gt;Jody Grassel&lt;/a&gt; in branch &apos;openjpa/branches/2.2.1.x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1548222&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1548222&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2318&quot; title=&quot;Left outer join is not generated when specifien using Criteria API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2318&quot;&gt;&lt;del&gt;OPENJPA-2318&lt;/del&gt;&lt;/a&gt;: Left outer join is not generated when specified using Criteria API&lt;/p&gt;</comment>
                            <comment id="13840400" author="jira-bot" created="Thu, 5 Dec 2013 18:49:16 +0000"  >&lt;p&gt;Commit 1548238 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fyrewyld&quot; class=&quot;user-hover&quot; rel=&quot;fyrewyld&quot;&gt;Jody Grassel&lt;/a&gt; in branch &apos;openjpa/branches/2.2.x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1548238&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1548238&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2318&quot; title=&quot;Left outer join is not generated when specifien using Criteria API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2318&quot;&gt;&lt;del&gt;OPENJPA-2318&lt;/del&gt;&lt;/a&gt;: Left outer join is not generated when specified using Criteria API&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12626127">OPENJPA-2317</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12598475" name="OPENJPA-2318-TEST.patch" size="4875" author="wizman" created="Fri, 16 Aug 2013 15:36:43 +0100"/>
                            <attachment id="12598474" name="OPENJPA-2318.patch" size="3520" author="wizman" created="Fri, 16 Aug 2013 15:36:43 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 15 May 2013 10:56:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>302727</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz0zlj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249777</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>