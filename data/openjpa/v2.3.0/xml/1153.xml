<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:33:04 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1153/OPENJPA-1153.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1153] Test suite speed-up outside SingleEMFTestCase</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1153</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;From the developer list &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;:&lt;/p&gt;

&lt;p&gt;We have groups of tests which do not inherit from SingleEMFTestCase and use common persistence.xml files to do their setUp()s. Each persistence.xml contains all entities used by the group. An individual test uses its group&apos;s persistence.xml to set itself up although the test usually uses one or two entities. Not surprisingly getting database metadata and issuing DELETE TABLE statements often takes much more time than the actual test itself.&lt;/p&gt;

&lt;p&gt;The most notable example is a group of tests located in openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/kernel/. Their openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/persistence/kernel/common/apps/META-INF/persistence.xml contains almost 100 entities. I measured how long does it take to run TestDateQueries which uses only one entity but sets itself up with that persistence xml. I ran the test suite with -Dtest=TestDateQueries and the necessary tables were already in the database:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Derby: 20 secs&lt;/li&gt;
	&lt;li&gt;MySQL: 12 secs&lt;/li&gt;
	&lt;li&gt;PostgreSQL: 46 secs&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Then I modified the persistence.xml to include only the entity used by the test. The timings for all databases dropped to around 4 seconds.&lt;/p&gt;

&lt;p&gt;My idea is to modify these tests (at least the ones taking the most time) and their superclass(-es) to not use persistence.xml but specify used entities as setUp() parameters, similarly to what SingleEMFTestCase. It looks like we would save at least a few minutes on a test suite run. &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://n2.nabble.com/Test-suite-speed-up-outside-SingleEMFTestCase-td3169383.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://n2.nabble.com/Test-suite-speed-up-outside-SingleEMFTestCase-td3169383.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12429311">OPENJPA-1153</key>
            <summary>Test suite speed-up outside SingleEMFTestCase</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="milosz">Milosz Tylenda</assignee>
                                    <reporter username="milosz">Milosz Tylenda</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Jul 2009 18:57:57 +0100</created>
                <updated>Tue, 9 Mar 2010 18:31:18 +0000</updated>
                            <resolved>Sun, 27 Dec 2009 10:17:52 +0000</resolved>
                                    <version>1.1.0</version>
                    <version>1.2.1</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-beta</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12754678" author="milosz" created="Sun, 13 Sep 2009 11:28:30 +0100"  >&lt;p&gt;I have added setUp(Object... props) to AbstractTestCase one can use to specify entities used by the test. I have made 6 tests inheriting from BaseKernelTest use this new method, will update more if don&apos;t hear about problems.&lt;/p&gt;

&lt;p&gt;I have also removed some unused casts from the tests.&lt;/p&gt;</comment>
                            <comment id="12755000" author="drwoods" created="Mon, 14 Sep 2009 15:33:55 +0100"  >&lt;p&gt;Changes look OK so far, as there were no regressions found with the nightly automated builds/junits on Derby, DB2, MSSQL, MySql or Oracle.&lt;/p&gt;</comment>
                            <comment id="12755002" author="drwoods" created="Mon, 14 Sep 2009 15:34:35 +0100"  >&lt;p&gt;setting Fix version, as code has been checked into trunk.&lt;/p&gt;</comment>
                            <comment id="12755013" author="ppoddar@apache.org" created="Mon, 14 Sep 2009 16:07:41 +0100"  >&lt;p&gt;Thanks Milosz for raising this issue. The current usage of SingleEMFTestCase is a misnomer &amp;#8211; we essentially create a new EMF on every test method of every test. In Criteria tests we had used a different scheme where a single EMF instance is used for all test cases that are using the same set of domain entities. The performance speed up with this strategy is remarkable. &lt;br/&gt;
Further improvement is possible with a smarter scheme that can determine whether to reuse or create EMF based on the domain entities used by a test. Currently without that automatic decision, we just partitioned the Criteria tests into 3-4 buckets &amp;#8211; where all the tests in a bucket tests work with the same set of domain entities. &lt;/p&gt;</comment>
                            <comment id="12764450" author="milosz" created="Sun, 11 Oct 2009 14:39:09 +0100"  >&lt;p&gt;With the changes so far, I can see a ca. 4-minute speed-up when running the test suite in my environment.&lt;/p&gt;</comment>
                            <comment id="12794871" author="xiaoqinfeng2000" created="Mon, 28 Dec 2009 18:52:32 +0000"  >&lt;p&gt;I am on vacation from 12/20/2009 &#194;&#160;to 12/26/2009.&lt;/p&gt;

&lt;p&gt;If you have any question on deployment and JEE bugs, please contact Saurabh Arora or my manager Maruthi Nuthikattu.&lt;/p&gt;

&lt;p&gt;For emergency, contact me at 925-209-5517.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Sep 2009 14:33:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161436</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7mtb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288666</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>