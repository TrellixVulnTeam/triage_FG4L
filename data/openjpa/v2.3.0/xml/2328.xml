<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:45:16 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-2328/OPENJPA-2328.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-2328] NPE caused by one too many calls on the iterator inside the library.</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-2328</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;We have just discovered a critical bug in the library preventing our program from operating. The problem comes from an NPE generated when there is one too many calls on the iterator of a collection, causing this type of stack trace:&lt;/p&gt;

&lt;p&gt;&amp;lt;openjpa-2.2.1-r422266:1396819 fatal store error&amp;gt; org.apache.openjpa.persistence.RollbackException: null&lt;br/&gt;
	at org.apache.openjpa.persistence.EntityManagerImpl.commit(EntityManagerImpl.java:594)&lt;br/&gt;
	at com.qualiformed.qualinax.platform.dao.GenericDAO.update(GenericDAO.java:136)&lt;br/&gt;
	at com.qualiformed.qualinax.platform.dao.SettingDAO.persist(SettingDAO.java:54)&lt;br/&gt;
	at com.qualiformed.qualinax.application.QualinaxConfig.save(QualinaxConfig.java:509)&lt;br/&gt;
	at com.qualiformed.qualinax.application.model.LancerQualimagiQModel.supprimerSettingsQualimagiQ(LancerQualimagiQModel.java:103)&lt;br/&gt;
	at com.qualiformed.qualinax.application.controller.QualimagiqController.setupAnalysis(QualimagiqController.java:371)&lt;br/&gt;
	at com.qualiformed.qualinax.application.controller.QualimagiqProcessor$8$1.doInBackground(QualimagiqProcessor.java:449)&lt;br/&gt;
	at com.qualiformed.qualinax.application.controller.QualimagiqProcessor$8$1.doInBackground(QualimagiqProcessor.java:446)&lt;br/&gt;
	at javax.swing.SwingWorker$1.call(SwingWorker.java:277)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
	at javax.swing.SwingWorker.run(SwingWorker.java:316)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
Caused by: &amp;lt;openjpa-2.2.1-r422266:1396819 nonfatal general error&amp;gt; org.apache.openjpa.persistence.PersistenceException: null&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.beforeCompletion(BrokerImpl.java:2000)&lt;br/&gt;
	at org.apache.openjpa.kernel.LocalManagedRuntime.commit(LocalManagedRuntime.java:81)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.commit(BrokerImpl.java:1516)&lt;br/&gt;
	at org.apache.openjpa.kernel.DelegatingBroker.commit(DelegatingBroker.java:933)&lt;br/&gt;
	at org.apache.openjpa.persistence.EntityManagerImpl.commit(EntityManagerImpl.java:570)&lt;br/&gt;
	... 14 more&lt;br/&gt;
Caused by: java.util.NoSuchElementException&lt;br/&gt;
	at java.util.HashMap$HashIterator.nextEntry(HashMap.java:796)&lt;br/&gt;
	at java.util.HashMap$KeyIterator.next(HashMap.java:828)&lt;br/&gt;
	at org.apache.openjpa.jdbc.meta.strats.HandlerRelationMapTableFieldStrategy.update(HandlerRelationMapTableFieldStrategy.java:320)&lt;br/&gt;
	at org.apache.openjpa.jdbc.meta.FieldMapping.update(FieldMapping.java:699)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.update(AbstractUpdateManager.java:343)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.update(AbstractUpdateManager.java:370)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.populateRowManager(AbstractUpdateManager.java:174)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.flush(AbstractUpdateManager.java:97)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.flush(AbstractUpdateManager.java:78)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.JDBCStoreManager.flush(JDBCStoreManager.java:735)&lt;br/&gt;
	at org.apache.openjpa.kernel.DelegatingStoreManager.flush(DelegatingStoreManager.java:131)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.flush(BrokerImpl.java:2176)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.flushSafe(BrokerImpl.java:2074)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.beforeCompletion(BrokerImpl.java:1992)&lt;br/&gt;
	... 18 more&lt;/p&gt;

&lt;p&gt;We have created a patch to correct the problem, but I haven&apos;t had the time to create the unitary test to reproduce it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12630095">OPENJPA-2328</key>
            <summary>NPE caused by one too many calls on the iterator inside the library.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="curtisr7">Rick Curtis</assignee>
                                    <reporter username="gchauvet">Guillaume Chauvet</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Jan 2013 08:44:50 +0000</created>
                <updated>Mon, 5 Aug 2013 19:51:33 +0100</updated>
                            <resolved>Tue, 19 Feb 2013 22:55:32 +0000</resolved>
                                    <version>2.1.1</version>
                    <version>2.2.0</version>
                    <version>2.2.1</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13567693" author="kwsutter" created="Thu, 31 Jan 2013 14:56:11 +0000"  >&lt;p&gt;Nice catch, nice debugging, and nice patch.  It looks like this patch not only prevents the NPE, but it&apos;s also correcting the expected processing for this value handler strategy.  It looks like OpenJPA was accidentally skipping items via this iterator processing.  I am surprised that this wasn&apos;t discovered previously just due to incorrect results...  Thanks again.&lt;/p&gt;

&lt;p&gt;If you can provide a junit test case for this condition, it would be icing on the cake...&lt;/p&gt;</comment>
                            <comment id="13567719" author="gchauvet" created="Thu, 31 Jan 2013 15:27:31 +0000"  >&lt;p&gt;Yes, I intend to send you a unit test soon (within 3 days, over the weekend)&lt;/p&gt;</comment>
                            <comment id="13570714" author="gchauvet" created="Mon, 4 Feb 2013 22:47:07 +0000"  >&lt;p&gt;The expected unitary test.&lt;/p&gt;</comment>
                            <comment id="13580848" author="gchauvet" created="Mon, 18 Feb 2013 21:48:02 +0000"  >&lt;p&gt;Please, can someone may check the correctness of our patch ? (fix + junit)&lt;/p&gt;</comment>
                            <comment id="13580887" author="curtisr7" created="Mon, 18 Feb 2013 23:09:10 +0000"  >&lt;p&gt;I&apos;ll try to take a look tomorrow.&lt;/p&gt;</comment>
                            <comment id="13581719" author="jira-bot" created="Tue, 19 Feb 2013 22:54:36 +0000"  >&lt;p&gt;Commit 1447955 from curtisr7&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1447955&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/r1447955&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2328&quot; title=&quot;NPE caused by one too many calls on the iterator inside the library.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2328&quot;&gt;&lt;del&gt;OPENJPA-2328&lt;/del&gt;&lt;/a&gt;: Fix NoSuchElementException when using HandlerRelationMapTableFieldStrategy. Patch contributed by Guillaume Chauvet.&lt;/p&gt;</comment>
                            <comment id="13581720" author="curtisr7" created="Tue, 19 Feb 2013 22:55:04 +0000"  >&lt;p&gt;Committed revision 1447955 to trunk. Thanks for the patch Guillaume!&lt;/p&gt;</comment>
                            <comment id="13581721" author="curtisr7" created="Tue, 19 Feb 2013 22:55:32 +0000"  >&lt;p&gt;Committed a UT and bug fix to trunk.&lt;/p&gt;</comment>
                            <comment id="13649375" author="allee8285" created="Sun, 5 May 2013 18:24:41 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2378&quot; title=&quot;TestHandlerStrategy.testIssue_OPENJPA2328 failed with Oracle&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2378&quot;&gt;&lt;del&gt;OPENJPA-2378&lt;/del&gt;&lt;/a&gt; opened to address test case failure introduced by this commit for Oracle.&lt;/p&gt;</comment>
                            <comment id="13729806" author="dlau" created="Mon, 5 Aug 2013 19:51:33 +0100"  >&lt;p&gt;The reason is: Oracle does not support auto assign, so we need to exclude Oracle from the test. I post a patch for this change on &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-2378&quot; title=&quot;TestHandlerStrategy.testIssue_OPENJPA2328 failed with Oracle&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-2378&quot;&gt;&lt;del&gt;OPENJPA-2378&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12567900" name="OPENJPA-2328-JUNIT.patch" size="6378" author="gchauvet" created="Mon, 4 Feb 2013 22:47:07 +0000"/>
                            <attachment id="12567318" name="OPENJPA-2328.patch" size="779" author="gchauvet" created="Thu, 31 Jan 2013 08:46:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 31 Jan 2013 14:56:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310591</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hzbga7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310936</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>