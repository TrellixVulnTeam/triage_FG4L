<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:44:52 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1424/OPENJPA-1424.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1424] Out of bounds exception using fetch plan</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1424</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Hello, I&apos;m getting the following:&lt;/p&gt;

&lt;p&gt;java.lang.ArrayIndexOutOfBoundsException: 2&lt;br/&gt;
at org.apache.openjpa.meta.ClassMetaData.getExtraFieldDataIndex(ClassMetaData.java:859)&lt;br/&gt;
at org.apache.openjpa.jdbc.kernel.JDBCStoreManager.initializeState(JDBCStoreManager.java:358)&lt;br/&gt;
at org.apache.openjpa.jdbc.kernel.JDBCStoreManager.initialize(JDBCStoreManager.java:278)&lt;br/&gt;
at org.apache.openjpa.kernel.DelegatingStoreManager.initialize(DelegatingStoreManager.java:111)&lt;br/&gt;
at org.apache.openjpa.kernel.ROPStoreManager.initialize(ROPStoreManager.java:57)&lt;br/&gt;
at org.apache.openjpa.kernel.BrokerImpl.initialize(BrokerImpl.java:894)&lt;br/&gt;
at org.apache.openjpa.kernel.BrokerImpl.find(BrokerImpl.java:852)&lt;br/&gt;
at org.apache.openjpa.kernel.BrokerImpl.find(BrokerImpl.java:774)&lt;br/&gt;
at org.apache.openjpa.jdbc.kernel.JDBCStoreManager.load(JDBCStoreManager.java:982)&lt;br/&gt;
at org.apache.openjpa.jdbc.sql.AbstractResult.load(AbstractResult.java:278)&lt;br/&gt;
at org.apache.openjpa.jdbc.sql.SelectImpl$SelectResult.load(SelectImpl.java:2400)&lt;br/&gt;
at org.apache.openjpa.jdbc.meta.strats.RelationFieldStrategy.loadEagerJoin(RelationFieldStrategy.java:541)&lt;br/&gt;
at org.apache.openjpa.jdbc.meta.FieldMapping.loadEagerJoin(FieldMapping.java:807)-- &lt;/p&gt;

&lt;p&gt;I&apos;ve attached a unit test that exposes it. I&apos;ve done my best to pare things down but it seems anything else I remove makes it go away (there are several things that could be removed to make it go away). The unit test passes when the exception is thrown. &lt;/p&gt;

&lt;p&gt;In short, this works:&lt;/p&gt;

&lt;p&gt;Query query = em.createQuery(&quot;select o from Case as o&quot; +&lt;br/&gt;
    &quot; left join fetch o.scheduledAssignments&quot; +&lt;br/&gt;
    &quot; where o.scheduleDay = :sd&quot;);&lt;br/&gt;
query.setParameter(&quot;sd&quot;, sd);&lt;br/&gt;
List&amp;lt;Case&amp;gt; allCases = query.getResultList();&lt;/p&gt;

&lt;p&gt;But this doesn&apos;t:&lt;/p&gt;

&lt;p&gt;Query query = em.createQuery(&quot;select o from Case as o&quot; +&lt;br/&gt;
    &quot; where o.scheduleDay = :sd&quot;);&lt;br/&gt;
query.setParameter(&quot;sd&quot;, sd);&lt;br/&gt;
FetchPlan fetchPlan = ((QueryImpl) query).getFetchPlan();&lt;br/&gt;
fetchPlan.addField(Case.class, &quot;scheduledAssignments&quot;);&lt;br/&gt;
List&amp;lt;Case&amp;gt; allCases = query.getResultList();&lt;/p&gt;

&lt;p&gt;The test case runs against PostgreSQL. I would really appreciate it if someone could verify the test passes under some other database or if it fails, under PostgreSQL. Of course it would be even better if an OpenJPA expert could find the problem.&lt;/p&gt;

&lt;p&gt;I will also accept suggestions for building a better unit test package.&lt;/p&gt;

&lt;p&gt;Thanks for your help.&lt;/p&gt;</description>
                <environment>Mac OSX, Java 1.5, Tomcat 5, PostgreSQL 8.4</environment>
        <key id="12443011">OPENJPA-1424</key>
            <summary>Out of bounds exception using fetch plan</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikedd">Michael Dick</assignee>
                                    <reporter username="dastultz">Daryl Stultz</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Dec 2009 18:33:30 +0000</created>
                <updated>Mon, 20 Sep 2010 16:39:50 +0100</updated>
                            <resolved>Mon, 3 May 2010 20:27:30 +0100</resolved>
                                    <version>1.2.1</version>
                                    <fixVersion>1.2.3</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.1</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>kernel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12788827" author="dastultz" created="Thu, 10 Dec 2009 18:39:34 +0000"  >&lt;p&gt;Unit test. Probably not a well-written one. I&apos;m open to suggestions to improve it.&lt;/p&gt;

&lt;p&gt;I run against PostgreSQL. The file database/create_jpa.sql can be used to build the database (called from the file database/build.sh).&lt;/p&gt;</comment>
                            <comment id="12800235" author="mikedd" created="Thu, 14 Jan 2010 15:42:07 +0000"  >&lt;p&gt;Tentatively targeting for 1.3.0 and 1.2.3. &lt;/p&gt;</comment>
                            <comment id="12897569" author="jpaheath" created="Thu, 12 Aug 2010 05:08:25 +0100"  >&lt;p&gt;I&apos;m attaching a patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1424&quot; title=&quot;Out of bounds exception using fetch plan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1424&quot;&gt;&lt;del&gt;OPENJPA-1424&lt;/del&gt;&lt;/a&gt;-1.2.x.patch.txt) for 1.2.x.  This patch contains:&lt;/p&gt;

&lt;p&gt;1) A back port of ClassMedaData from the trunk version of the fix.  This is the only change from trunk which I back ported.....the other change doesn&apos;t easily port and the initial test case passes with the ClassMetaData changes.&lt;br/&gt;
2) A stripped down version of the initial test case provided by Daryl.  I think I&apos;ve stripped down the test as far as I can (any further and I couldn&apos;t reproduce the issue).  &lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Heath&lt;/p&gt;</comment>
                            <comment id="12898946" author="mikedd" created="Mon, 16 Aug 2010 15:15:33 +0100"  >&lt;p&gt;Technically this was fixed in 2.0.0 - but it missed the release notes. I&apos;ve targeted for 2.0.1, and 2.1.0 - so it&apos;ll be picked up in their release notes and changes.txt. &lt;/p&gt;</comment>
                            <comment id="12912505" author="mikedd" created="Mon, 20 Sep 2010 16:39:50 +0100"  >&lt;p&gt;Closing issues which have been resolved for some time. If the problem persists, please reopen. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12451859" name="OPENJPA-1424-1.2.x.patch.txt" size="11759" author="jpaheath" created="Thu, 12 Aug 2010 05:08:25 +0100"/>
                            <attachment id="12427620" name="test.zip" size="32215" author="dastultz" created="Thu, 10 Dec 2009 18:39:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 14 Jan 2010 15:42:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161691</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt6cf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204208</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>