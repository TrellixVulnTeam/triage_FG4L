<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:35:40 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-14/OPENJPA-14.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-14] PCEnhancer ant task requires openjpa jars to be on the system classpath or passed into ant with &apos;-lib&apos;</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-14</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Ideally, one should be able to run &apos;ant openjpac&apos;  (openjpac would be a target defined in the build script that would use the PCEnhancer task) without having to put the openjpa jars on the system classpath or having to pass them into ant vie the &apos;-lib&apos; argument.  Currently this is not possible.  The root of the issue can be seen from by looking at the public static String[] getImplementors(String serviceName, ClassLoader loader) method of the Services class. Basically, the call to &lt;/p&gt;

&lt;p&gt;loader = Thread.currentThread().getContextClassLoader();&lt;/p&gt;

&lt;p&gt;returns a ClassLoader with the $ANT_HOME\lib&amp;#42;.jar and $JAVA_HOME\lib\tools.jar in it... which obviously doesn&apos;t contain &apos;META-INF/services/org.apache.openjpa.conf.ProductDerivation&apos;&lt;/p&gt;

&lt;p&gt;The exception seen when encountering this issue:&lt;/p&gt;

&lt;p&gt;java.lang.ExceptionInInitializerError&lt;br/&gt;
        at org.apache.openjpa.conf.OpenJPAConfigurationImpl.&amp;lt;init&amp;gt;(OpenJPAConfigurationImpl.java:510)&lt;br/&gt;
        at org.apache.openjpa.conf.OpenJPAConfigurationImpl.&amp;lt;init&amp;gt;(OpenJPAConfigurationImpl.java:160)&lt;br/&gt;
        at org.apache.openjpa.conf.OpenJPAConfigurationImpl.&amp;lt;init&amp;gt;(OpenJPAConfigurationImpl.java:151)&lt;br/&gt;
        at org.apache.openjpa.ant.PCEnhancerTask.newConfiguration(PCEnhancerTask.java:77)&lt;br/&gt;
        at org.apache.openjpa.lib.ant.AbstractTask.execute(AbstractTask.java:170)&lt;br/&gt;
        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)&lt;br/&gt;
        at org.apache.tools.ant.Task.perform(Task.java:364)&lt;br/&gt;
        at org.apache.tools.ant.Target.execute(Target.java:341)&lt;br/&gt;
        at org.apache.tools.ant.Target.performTasks(Target.java:369)&lt;br/&gt;
        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1216)&lt;br/&gt;
        at org.apache.tools.ant.Project.executeTarget(Project.java:1185)&lt;br/&gt;
        at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:40)&lt;br/&gt;
        at org.apache.tools.ant.Project.executeTargets(Project.java:1068)&lt;br/&gt;
        at org.apache.tools.ant.Main.runBuild(Main.java:668)&lt;br/&gt;
        at org.apache.tools.ant.Main.startAnt(Main.java:187)&lt;br/&gt;
        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:251)&lt;br/&gt;
        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:72)&lt;br/&gt;
Caused by: java.util.MissingResourceException: Your system is missing product derivations.  Product derivations provide configuration options for supported data stores and specifications.  You must have a META-INF/services/org.apache.openjpa.conf.ProductDerivation file in your classpath listing the available derivation classes, and some listed class must be instantiable.  Typically this file is bundled as part of the distribution.  Have you unbundled it, or unbundled its listed classes?&lt;br/&gt;
        at org.apache.openjpa.conf.ProductDerivations.&amp;lt;clinit&amp;gt;(ProductDerivations.java:53)&lt;br/&gt;
        ... 17 more&lt;/p&gt;</description>
                <environment>Windows XP</environment>
        <key id="12348082">OPENJPA-14</key>
            <summary>PCEnhancer ant task requires openjpa jars to be on the system classpath or passed into ant with &apos;-lib&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pcl">Patrick Linskey</assignee>
                                    <reporter username="bnoll">Bryan Noll</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Aug 2006 18:44:33 +0100</created>
                <updated>Fri, 25 Aug 2006 08:39:54 +0100</updated>
                            <resolved>Thu, 24 Aug 2006 19:21:44 +0100</resolved>
                                                                    <component>lib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12428809" author="bnoll" created="Thu, 17 Aug 2006 23:14:29 +0100"  >&lt;p&gt;Attaching patch named: &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-14&quot; title=&quot;PCEnhancer ant task requires openjpa jars to be on the system classpath or passed into ant with &amp;#39;-lib&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-14&quot;&gt;&lt;del&gt;OPENJPA-14&lt;/del&gt;&lt;/a&gt;.patch1&lt;/p&gt;

&lt;p&gt;So, the issue reported originally was not a problem with the code, but a known problem with ant, as can be seen here: &lt;a href=&quot;http://ant.apache.org/faq.html#delegating-classloader-1.6&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ant.apache.org/faq.html#delegating-classloader-1.6&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The real fix for this is better documentation, which I will throw together.  I updated the &apos;no-product-derivations&apos; in the &apos;openjpa-kernel/src/main/resources/org/apache/openjpa/conf/localizer.properties&apos; file to provide a hint to people who would&apos;ve run into the same issue I did.&lt;/p&gt;


&lt;p&gt;The rest of the patch is to deal with another issue in the same realm as this one, ant that is the fact that the PCEnhancerTask would throw a NPE if you didn&apos;t have &apos;META-INF/persistence.xml&apos; on your system classpath, in $ANT_HOME/lib or supply the dir it was in via the &apos;ant -lib&apos; argument.  To resolve this, I created a new required attribute for the PCEnhancerTask, named &apos;configFile&apos;... that allows the location of the config file to be declared when running the task.&lt;/p&gt;

&lt;p&gt;Please provide feedback on the patch if you think I didn&apos;t grasp the context of what was going on at a higher level and potentially screwed something else up.&lt;/p&gt;</comment>
                            <comment id="12428810" author="bnoll" created="Thu, 17 Aug 2006 23:21:13 +0100"  >&lt;p&gt;Attaching patch named: &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-14&quot; title=&quot;PCEnhancer ant task requires openjpa jars to be on the system classpath or passed into ant with &amp;#39;-lib&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-14&quot;&gt;&lt;del&gt;OPENJPA-14&lt;/del&gt;&lt;/a&gt;.patch2&lt;/p&gt;

&lt;p&gt;Ignore &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-14&quot; title=&quot;PCEnhancer ant task requires openjpa jars to be on the system classpath or passed into ant with &amp;#39;-lib&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-14&quot;&gt;&lt;del&gt;OPENJPA-14&lt;/del&gt;&lt;/a&gt;.patch1 &apos;, I forgot to make the test class I added as part of it.  That&apos;s the only difference between this one and that.&lt;/p&gt;</comment>
                            <comment id="12428813" author="pcl" created="Thu, 17 Aug 2006 23:27:23 +0100"  >&lt;p&gt;Why is the new ant task attribute a required task setting (instead of optional)? It would seem that it&apos;s only necessary when the system does not have a persistence unit available, or to narrow the choice when there are multiple persistence units available whose settings conflict.&lt;/p&gt;</comment>
                            <comment id="12428815" author="awhite" created="Thu, 17 Aug 2006 23:34:24 +0100"  >&lt;p&gt;Note that we already have an available way to set the config file or resource location:&lt;/p&gt;

&lt;p&gt;&amp;lt;any-openjpa-task&amp;gt;&lt;br/&gt;
    &amp;lt;config propertiesFile=&quot;...&quot;/&amp;gt;&lt;br/&gt;
    &amp;#8211; or &amp;#8211;&lt;br/&gt;
    &amp;lt;config properties=&quot;...&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/any-openjpa-task&amp;gt;&lt;/p&gt;

&lt;p&gt;The &amp;lt;config&amp;gt; element also lets you specify any property directly, like:&lt;br/&gt;
&amp;lt;config connectionURL=&quot;...&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;This works b/c our AbstractTask has a createConfig() method that returns the Configuration instance (in this case, an OpenJPAConfiguration or JDBCConfiguration subclass instance depending on the task), so all bean methods are settable. &lt;/p&gt;

&lt;p&gt;The &amp;lt;config&amp;gt; element isn&apos;t required, but I agree with Patrick that it shouldn&apos;t be, given that we&apos;ll detect persistence.xml if it&apos;s available in the classpath.  IMO, it would be better to fix the NPE to have a good error message than to require an explicit config file declaration.&lt;/p&gt;</comment>
                            <comment id="12428817" author="bnoll" created="Thu, 17 Aug 2006 23:39:30 +0100"  >&lt;p&gt;I thought about making it optional, but it just seemed odd to me that you&apos;d have to have &apos;META-INF/persistence.xml&apos; in one of the places I mentioned earlier...&lt;/p&gt;

&lt;p&gt;1) system classpath&lt;br/&gt;
2)$ANT_HOME/lib&lt;br/&gt;
3) ant -lib dir_where_META_INF_is&lt;br/&gt;
4) I forgot about this before... but a 4th would be $&lt;/p&gt;
{user.home}
&lt;p&gt;/.ant/lib&lt;/p&gt;

&lt;p&gt;...in particular, the first two options seem like a round peg in a square hole.  Making it optional would be easy, but I just thought making it required would save users the problem of having to get that on their classpath.&lt;/p&gt;

&lt;p&gt;Maybe I&apos;m not seeing the use case?  Like I said though, changing it to optional is trivial.&lt;/p&gt;</comment>
                            <comment id="12428820" author="bnoll" created="Thu, 17 Aug 2006 23:54:23 +0100"  >&lt;p&gt;Attaching patch file: &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-14&quot; title=&quot;PCEnhancer ant task requires openjpa jars to be on the system classpath or passed into ant with &amp;#39;-lib&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-14&quot;&gt;&lt;del&gt;OPENJPA-14&lt;/del&gt;&lt;/a&gt;.patch3&lt;/p&gt;

&lt;p&gt;Ignore patch1 and patch2....&lt;/p&gt;

&lt;p&gt;Thanks for pointing out the &apos;properties&apos; and &apos;propertiesFile&apos; values... that&apos;s exactly what I thought was missing and what I needed.  The patch is a simple update to give someone a hint about where their jars need to go so they don&apos;t get the original MissingResourceException.&lt;/p&gt;</comment>
                            <comment id="12428826" author="bnoll" created="Fri, 18 Aug 2006 00:17:12 +0100"  >&lt;p&gt;Attaching patch: &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-14&quot; title=&quot;PCEnhancer ant task requires openjpa jars to be on the system classpath or passed into ant with &amp;#39;-lib&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-14&quot;&gt;&lt;del&gt;OPENJPA-14&lt;/del&gt;&lt;/a&gt;.patch4&lt;/p&gt;

&lt;p&gt;This throws a MetaDataException now instead of an NPE.&lt;/p&gt;</comment>
                            <comment id="12430304" author="awhite" created="Thu, 24 Aug 2006 19:21:44 +0100"  >&lt;p&gt;Applied patch (with minor corrections). &lt;/p&gt;</comment>
                            <comment id="12430422" author="pcl" created="Fri, 25 Aug 2006 08:39:54 +0100"  >&lt;p&gt;Use the class&apos;s classloader in environments when service lookups should be looking in the OpenJPA distribution. This imposes the restriction that OpenJPA will only find services in the same classloader as the OpenJPA jars themselves, which is a much better restriction than requiring that the classes be in the thread&apos;s context classloader.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12339052" name="OPENJPA-14.patch1" size="5957" author="bnoll" created="Thu, 17 Aug 2006 23:14:29 +0100"/>
                            <attachment id="12339053" name="OPENJPA-14.patch2" size="7892" author="bnoll" created="Thu, 17 Aug 2006 23:21:13 +0100"/>
                            <attachment id="12339057" name="OPENJPA-14.patch3" size="937" author="bnoll" created="Thu, 17 Aug 2006 23:54:23 +0100"/>
                            <attachment id="12339058" name="OPENJPA-14.patch4" size="2539" author="bnoll" created="Fri, 18 Aug 2006 00:17:12 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Aug 2006 22:27:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160352</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyt41r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203836</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>