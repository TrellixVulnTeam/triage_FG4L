<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:32:21 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-386/OPENJPA-386.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-386] org.apache.openjpa.meta.ClassMetaData.validateAppIdClass() does not take @MappedSuperclass into account</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-386</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;We have a @MappedSuperclass that is the base for all of our entity bean classes.  This class contains the @Version (and @Column for the version field) that all of our entity beans use.  But, in ClassMetaData.validateAppIdClass(), if an entity bean class has a superclass, and the entity bean has an @IdClass, it expects that superclass to have an @IdClass also.  All of our entity beans have an @IdClass (even if they only have a single part key), but our @MappedSuperclass does not have an @IdClass.  This scenario works under JBoss 4.2.0 and Sun AS 9, but produces a NullPointerException in OpenJPA at:&lt;/p&gt;

&lt;p&gt;        if (_super != null) {&lt;br/&gt;
            // concrete superclass oids must match or be parent of ours&lt;br/&gt;
            ClassMetaData sup = getPCSuperclassMetaData();&lt;br/&gt;
            if (!sup.getObjectIdType().isAssignableFrom(_objectId))  // &amp;lt;--- NullPointerException here&lt;/p&gt;</description>
                <environment>BEA WebLogic 10.0 under Windows XP SP1</environment>
        <key id="12379198">OPENJPA-386</key>
            <summary>org.apache.openjpa.meta.ClassMetaData.validateAppIdClass() does not take @MappedSuperclass into account</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fyrewyld">Jody Grassel</assignee>
                                    <reporter username="mschwickerath@ultramain.com">Matthew L. Schwickerath</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Sep 2007 15:26:06 +0100</created>
                <updated>Tue, 9 Mar 2010 18:31:00 +0000</updated>
                            <resolved>Thu, 27 Aug 2009 21:07:52 +0100</resolved>
                                    <version>0.9.7</version>
                    <version>1.0.0</version>
                    <version>1.0.2</version>
                    <version>1.1.0</version>
                    <version>1.2.1</version>
                                    <fixVersion>1.1.1</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0-M3</fixVersion>
                                    <component>kernel</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12568728" author="chrisarnett" created="Wed, 13 Feb 2008 22:09:04 +0000"  >&lt;p&gt;Any updates on this?  We&apos;re having the same problem.  These are legacy tables and we don&apos;t have the luxury of changing the schema.  We also can&apos;t use an EmbeddedId (which seems to work in this case) because one of the fields is generated while the other is not (an unsupported case for EmbeddedId).&lt;/p&gt;

&lt;p&gt;Unless this is fixed in the Feb 15th release, we&apos;ll probably have to override WL10&apos;s JPA implementation with Hibernate (if that&apos;s even possible).&lt;/p&gt;</comment>
                            <comment id="12595067" author="tsandor" created="Wed, 7 May 2008 23:23:19 +0100"  >&lt;p&gt;Matthew,&lt;br/&gt;
We have the same problem (and situation for storing @Version). It&apos;s great that I found this entry.&lt;/p&gt;

&lt;p&gt;Here&apos;s a workaround that worked for me:&lt;br/&gt;
@MappedSuperclass&lt;br/&gt;
@IdClass(Object.class)&lt;/p&gt;

&lt;p&gt;This way PCEnhancer will enhance the superclassed entities with their special @IdClass().&lt;/p&gt;

&lt;p&gt;However, normally it should work without this extra line (Hibernate does not need that).&lt;br/&gt;
Please vote for this bug to be solved in the next release.&lt;/p&gt;</comment>
                            <comment id="12746273" author="fyrewyld" created="Fri, 21 Aug 2009 23:05:47 +0100"  >&lt;p&gt;The problem was how ClassMetaData.hasConcretePCSuperclass() handled mapped superclasses.  Let&apos;s say we have the following classes:&lt;/p&gt;

&lt;p&gt;@MappedSuperclass&lt;br/&gt;
public class MSC&lt;/p&gt;

&lt;p&gt;@Entity&lt;br/&gt;
@IdClass(MyIdClass.class)&lt;br/&gt;
public class EntityA extends MSC&lt;/p&gt;

&lt;p&gt;(Note that the @MappedSuperclass type &quot;MSC&quot; is not abstract, which is perfectly legal with the JPA Spec.)&lt;/p&gt;

&lt;p&gt;Now, when an entity extending the MSC is annotated with @IdClass, the metadata processing notes that there are PC-enhanced superclasses, and needs to analyze them to check if they declare any identity elements, in order to ensure that the @IdClass specified will address them.  It uses this method in ClassMetaData to check if it has a PC superclass that is concrete (effectively, any entity class types that are further up the inheritance tree.:&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Return true if this class has a concrete persistent superclass.&lt;br/&gt;
     */&lt;br/&gt;
    private boolean hasConcretePCSuperclass() 
{
        if (_super == null)
            return false;
        if (!Modifier.isAbstract(_super.getModifiers())))
            return true;
        return getPCSuperclassMetaData().hasConcretePCSuperclass();
    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The line: if (!Modifier.isAbstract(_super.getModifiers()))) is responsible for detecting @MappedSuperclasses, however it relies exclusively on the class being abstract, something that, while recommended, is not required by the JPA Spec.  So it will incorrectly treat a @MappedSuperclass as a regular entity, resulting in this Exception:&lt;/p&gt;

&lt;p&gt;org.apache.openjpa.util.MetaDataException: Field &quot;testcase.EntityA.id&quot; cannot be a primary key.  Primary key fields can only be declared in base persistent classes that also declare their identity type- to be &quot;application&quot;.&lt;br/&gt;
     at org.apache.openjpa.meta.ClassMetaData.validateNoPKFields(ClassMetaData.java:2025)&lt;br/&gt;
     at org.apache.openjpa.meta.ClassMetaData.validateAppIdClass(ClassMetaData.java:1905)&lt;br/&gt;
     at org.apache.openjpa.meta.ClassMetaData.validateIdentity(ClassMetaData.java:1851)&lt;br/&gt;
     at org.apache.openjpa.meta.ClassMetaData.validateMeta(ClassMetaData.java:1768)&lt;br/&gt;
     at org.apache.openjpa.meta.ClassMetaData.resolve(ClassMetaData.java:1641)&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;The solution was to simply add another check for the @MappedSuperclass.  This is already done with the ClassMetaData.isAbstract() method in trunk (which is set true if a class type explicitly is annotated with @MappedSuperclass, or is defined as a mapped-superclass by ORM XML), which was brought down to 1.2.x and 1.3.x in &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1061&quot; title=&quot;Entities extending from a Mapped Superclass that defines the ID fields share the same ObjectID type parameter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1061&quot;&gt;&lt;del&gt;OPENJPA-1061&lt;/del&gt;&lt;/a&gt;.  With the following change:&lt;/p&gt;

&lt;p&gt;private boolean hasConcretePCSuperclass() &lt;/p&gt;
{
        if (_super == null)
            return false;
        if (!Modifier.isAbstract(_super.getModifiers()) &amp;amp;&amp;amp; 
        		(!getPCSuperclassMetaData().isAbstract()))
            return true;
        return getPCSuperclassMetaData().hasConcretePCSuperclass();
    }

&lt;p&gt;With the above change, a @MappedSuperclass can now be identified whether or not its class type is actually a Java abstract class or not.&lt;/p&gt;</comment>
                            <comment id="12748546" author="mikedd" created="Thu, 27 Aug 2009 21:07:52 +0100"  >&lt;p&gt;Thanks for the patch Jody. Patch applied to 1.3.x, and trunk. &lt;/p&gt;</comment>
                            <comment id="12789047" author="dezzio" created="Fri, 11 Dec 2009 00:15:13 +0000"  >&lt;p&gt;Applied Jody&apos;s patch to 1.1.x branch at rev 889476.  &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12417322" name="OPENJPA-386_1.0.x.patch" size="11485" author="fyrewyld" created="Fri, 21 Aug 2009 23:06:20 +0100"/>
                            <attachment id="12417323" name="OPENJPA-386_1.1.x.patch" size="12101" author="fyrewyld" created="Fri, 21 Aug 2009 23:06:20 +0100"/>
                            <attachment id="12417324" name="OPENJPA-386_1.2.x.patch" size="8995" author="fyrewyld" created="Fri, 21 Aug 2009 23:06:20 +0100"/>
                            <attachment id="12417325" name="OPENJPA-386_1.3.x.patch" size="8995" author="fyrewyld" created="Fri, 21 Aug 2009 23:06:37 +0100"/>
                            <attachment id="12417326" name="OPENJPA-386_trunk.patch" size="8979" author="fyrewyld" created="Fri, 21 Aug 2009 23:06:37 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 13 Feb 2008 22:09:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160708</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyswhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202610</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>