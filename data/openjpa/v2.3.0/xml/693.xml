<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:42:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-693/OPENJPA-693.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-693] Can not persist Parent-Child mapping when child refers to parent via parent&apos;s primary identity (and not parent&apos;s object reference) and parent uses database sequence for its own identity</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-693</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;The following use case is reported in the users&apos; group &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;A typical Parent-Child (Address has many Phones) relationship. But Phone refers to Address by its primary key. And database assigns the primary key of the Address.&lt;br/&gt;
When and how to set the child&apos;s reference field to its parent?&lt;/p&gt;

&lt;p&gt;Approach A:&lt;br/&gt;
1. Remove all children from Parent, but remember them&lt;br/&gt;
2. flush() the Parent.&lt;br/&gt;
3. Database will now assign identity to Parent&lt;br/&gt;
4. Add the children back and set each child&apos;s identifier to the newly assigned identifier of the Parent&lt;br/&gt;
5. commit&lt;/p&gt;

&lt;p&gt;The other approach B which is cleaner&lt;br/&gt;
1. Add a @PostPersist method to Parent.java as follows&lt;br/&gt;
     @PostPersist&lt;br/&gt;
     public void postPersist() &lt;/p&gt;
{
           if (children== null) return;
           for (Child child : children)
               parent.setParentId(this.getId());
     }

&lt;p&gt;2. commit()&lt;/p&gt;

&lt;p&gt;Unfortunately Approach B does not work as expected with existing OpenJPA because it prohibits Phone.addressId value to be reassigned during a flush cycle as resulted from Address.postPersist() method.&lt;/p&gt;

&lt;p&gt;I have added a fix to relax that prohibition under some circumstances but I am concerned whether this relaxing of restriction will now allow other truly invalid use cases those the original restriction was duly imposing. &lt;/p&gt;

&lt;p&gt;The fix passes the OpenJPA test corpus &amp;#8211; but that is also not proof enough of its robustness.&lt;/p&gt;

&lt;p&gt;Comments/thoughts?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12402261">OPENJPA-693</key>
            <summary>Can not persist Parent-Child mapping when child refers to parent via parent&apos;s primary identity (and not parent&apos;s object reference) and parent uses database sequence for its own identity</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ppoddar@apache.org">Pinaki Poddar</assignee>
                                    <reporter username="ppoddar@apache.org">Pinaki Poddar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Aug 2008 02:08:41 +0100</created>
                <updated>Thu, 22 Apr 2010 21:32:47 +0100</updated>
                            <resolved>Mon, 25 Aug 2008 15:40:18 +0100</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161005</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyszof:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203128</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>