<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:29:45 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-347/OPENJPA-347.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-347] Performance Issue with Lazy Loaded Foreign Keys</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-347</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;We&apos;re hitting a performance regression with the latest OpenJPA code when specifying LAZY fetch type with OneToOne and ManyToOne relationships.  It seems that we&apos;re loading more than just the foreign key (normal LAZY behavior) and processing them like an EAGER fetch type.  Here&apos;s some example SQL codes:&lt;/p&gt;

&lt;p&gt;Previous version of OpenJPA generates the following:&lt;/p&gt;

&lt;p&gt;SELECT t0.PROFILE_USERID, t0.BALANCE, t0.CREATIONDATE, t0.LASTLOGIN, t0.LOGINCOUNT, t0.LOGOUTCOUNT, t0.OPENBALANCE FROM ACCOUNTEJB t0 WHERE t0.ACCOUNTID = ?  optimize for 1 row&lt;/p&gt;

&lt;p&gt;With latest OpenJPA, we see the following being generated:&lt;/p&gt;

&lt;p&gt;SELECT t1.USERID, t2.ACCOUNTID, t2.BALANCE, t2.CREATIONDATE, t2.LASTLOGIN, t2.LOGINCOUNT, t2.LOGOUTCOUNT, t2.OPENBALANCE, t1.ADDRESS, t1.CREDITCARD, t1.EMAIL, t1.FULLNAME, t1.PASSWD, t0.BA&lt;br/&gt;
LANCE, t0.CREATIONDATE, t0.LASTLOGIN, t0.LOGINCOUNT, t0.LOGOUTCOUNT, t0.OPENBALANCE FROM ACCOUNTEJB t0 LEFT OUTER JOIN ACCOUNTPROFILEEJB t1 ON t0.PROFILE_USERID = t1.USERID LEFT OUTER JOIN ACCOUNTEJB t2 ON t1.USERID = t2.PROFI&lt;br/&gt;
LE_USERID WHERE t0.ACCOUNTID = ?  optimize for 1 row&lt;/p&gt;

&lt;p&gt;It looks like the regression is due to the introduction of the fix I provided for &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-281&quot; title=&quot;EAGER not the default fetch type without the @Basic annotation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-281&quot;&gt;&lt;del&gt;OPENJPA-281&lt;/del&gt;&lt;/a&gt; where the @Basic types were not eagerly being loaded by default.  In this test scenario, the field types used for the foreign keys were Serializable.  Thus, the test in isInDefaultFetchGroup() would incorrectly put the whole relationship in the default fetch group (making it eager).&lt;/p&gt;

&lt;p&gt;As I was debugging this problem, I learned that OpenJPA loads the foreign key fields eagerly regardless of the setting of the LAZY fetch type.  Our customers would most likely expect this behavior and it doesn&apos;t cost anything (or next to nothing) to load these additional fields.  It just becomes a problem when we traverse the relationship when it&apos;s marked LAZY...&lt;/p&gt;

&lt;p&gt;It looks like the problem can be easily resolved by just moving my check for Serializable in isInDefaultFetchGroup() to just the JavaTypes.OBJECT type and not the JavaTypes.PC type.  This makes more sense since the intent of the @Basic eager change was for basic simple attribute types, not relationships.  And, foreign key fields would fall into the JavaTypes.PC (Persistence Capable) type.&lt;/p&gt;

&lt;p&gt;We&apos;re testing this theory with the performance run right now.  So far, it looks good.  And, I have modified the TestEagerBidiSQL test to test for this condition (the current versions of BidiChild and BidiParent were not Serializable and, thus, we didn&apos;t hit this problem when I did the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-281&quot; title=&quot;EAGER not the default fetch type without the @Basic annotation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-281&quot;&gt;&lt;del&gt;OPENJPA-281&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;If anybody has any further thoughts on this problem, please post.  Thanks.&lt;/p&gt;

&lt;p&gt;Kevin&lt;/p&gt;</description>
                <environment></environment>
        <key id="12377191">OPENJPA-347</key>
            <summary>Performance Issue with Lazy Loaded Foreign Keys</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kwsutter">Kevin Sutter</assignee>
                                    <reporter username="kwsutter">Kevin Sutter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Aug 2007 22:18:44 +0100</created>
                <updated>Tue, 9 Mar 2010 18:32:38 +0000</updated>
                            <resolved>Fri, 31 Aug 2007 21:11:34 +0100</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>kernel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12523946" author="kwsutter" created="Thu, 30 Aug 2007 23:05:27 +0100"  >&lt;p&gt;Proposed patch and testcase update for this problem.&lt;/p&gt;</comment>
                            <comment id="12524178" author="kwsutter" created="Fri, 31 Aug 2007 21:11:34 +0100"  >&lt;p&gt;Resolved for both the 1.1.0 and 1.0.1 snapshot releases.&lt;/p&gt;</comment>
                            <comment id="12532439" author="pcl" created="Thu, 4 Oct 2007 15:26:43 +0100"  >&lt;p&gt;&amp;gt; OpenJPA loads the foreign key fields eagerly regardless of the setting &lt;br/&gt;
&amp;gt; of the LAZY fetch type. Our customers would most likely expect this &lt;br/&gt;
&amp;gt; behavior and it doesn&apos;t cost anything (or next to nothing) to load these &lt;br/&gt;
&amp;gt; additional fields. It just becomes a problem when we traverse the &lt;br/&gt;
&amp;gt; relationship when it&apos;s marked LAZY&lt;/p&gt;

&lt;p&gt;Does your patch preserve this described behavior?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12364850" name="OPENJPA-347.patch" size="2725" author="kwsutter" created="Thu, 30 Aug 2007 23:05:26 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 4 Oct 2007 14:26:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>41875</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7krb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288333</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>