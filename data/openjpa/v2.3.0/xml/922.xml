<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:36:00 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-922/OPENJPA-922.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-922] setByteArrayInputStream being used in stead of setBytes</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-922</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;I have an Entity and one of its fields is defined as CHAR(16) FOR BIT DATA NOT NULL.&lt;/p&gt;

&lt;p&gt;When trying to persist the entity, I get the following error:&lt;/p&gt;

&lt;p&gt;   Error: SQLCODE=-301, SQLSTATE=07006, SQLERRMC=1, DRIVER=3.50.152  &lt;/p&gt;
   {prepstmnt 1386959531 INSERT INTO NULLID.TESTTBL (tkiid) VALUES (?)  
   [params=(InputStream) java.io.ByteArrayInputStream@75947594]}

&lt;p&gt;It seems that the wrong kind of set is being used to set the parameter on the prepared statement.&lt;/p&gt;</description>
                <environment>DB2 on Windows</environment>
        <key id="12414883">OPENJPA-922</key>
            <summary>setByteArrayInputStream being used in stead of setBytes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikedd">Michael Dick</assignee>
                                    <reporter username="bjreed">B.J. Reed</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Feb 2009 16:38:58 +0000</created>
                <updated>Tue, 9 Mar 2010 18:31:09 +0000</updated>
                            <resolved>Thu, 23 Jul 2009 00:09:17 +0100</resolved>
                                    <version>1.2.0</version>
                    <version>2.0.0-M2</version>
                                    <fixVersion>2.0.0-M3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12673929" author="bjreed" created="Mon, 16 Feb 2009 16:41:46 +0000"  >&lt;p&gt;For DB2, the DBDictionary useSetBytesForBlobs field is set to false.  Within setBytes, if this flag is true, setBinaryStream() is called regardless of what kind of column we really have (BYTES or BLOB_OBJECT).  Patch includes change to the if statement to also check the column type before using the setBinaryStream and a simple test case.&lt;/p&gt;

&lt;p&gt;Please apply to both 1.2.x and trunk&lt;/p&gt;</comment>
                            <comment id="12676403" author="bjreed" created="Tue, 24 Feb 2009 20:29:26 +0000"  >&lt;p&gt;Was premature with the patch.  The &quot;fix&quot; breaks BLOBs so it&apos;s no good.  Basically, both unserialized BLOBS and byte arrays go through the ByteArrayValueHandler in stead of the BlobValueHandler (determined in MappingHandler.defaultHandler()) so the jdbc layer doesn&apos;t know there is a difference between the 2 and can&apos;t make the correct call to set the data....the use of ByteArrayValueHandler for both also happened on Derby so we need a way to differentiate between the two different kinds of byte[] (BLOBs and char for bit data) so that we know which method to use to set the data in the DB.&lt;/p&gt;</comment>
                            <comment id="12678131" author="bjreed" created="Mon, 2 Mar 2009 22:08:50 +0000"  >&lt;p&gt;I have attached &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-922&quot; title=&quot;setByteArrayInputStream being used in stead of setBytes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-922&quot;&gt;&lt;del&gt;OPENJPA-922&lt;/del&gt;&lt;/a&gt;-B.patch as a second attempt to fix this problem (also includes the test case).  Basically, the DB2Dictionary needs to override the DBDictionary setBytes and getBytes methods.  For setBytes, it can check the Column definition to use the proper set, for getBytes, the Column is nowhere to be found so it just tries the original getBlob, but if that fails, then it tries to getBytes as a last resort.  I&apos;m sure there&apos;s a better way for the get, but I haven&apos;t stumbled across it yet.&lt;/p&gt;</comment>
                            <comment id="12678274" author="milosz" created="Tue, 3 Mar 2009 10:01:55 +0000"  >&lt;p&gt;Since the test case is likely to fail on databases other then DB2 (specific columnDefinition), it is a good idea to run it only when DB2 is connected. A few ideas:&lt;br/&gt;
1. Use the annotation described in &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-942&quot; title=&quot;Allow test to specify target database platform&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-942&quot;&gt;OPENJPA-942&lt;/a&gt;.&lt;br/&gt;
2. Test whether DBDictionary is an instance of DB2Dictionary. Some other tests already use that approach.&lt;/p&gt;
</comment>
                            <comment id="12678343" author="bjreed" created="Tue, 3 Mar 2009 15:14:51 +0000"  >&lt;p&gt;Thanks Milosz.  I was so worried about the fix not breaking other DBs that I forgot about the test breaking other DBs.  Have attached the &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-922&quot; title=&quot;setByteArrayInputStream being used in stead of setBytes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-922&quot;&gt;&lt;del&gt;OPENJPA-922&lt;/del&gt;&lt;/a&gt;-C.patch to fix this.  When the annotation in &lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-942&quot; title=&quot;Allow test to specify target database platform&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-942&quot;&gt;OPENJPA-942&lt;/a&gt; is working, it would probably be better to use that.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12401318" name="OPENJPA-922-C.patch" size="9463" author="bjreed" created="Tue, 3 Mar 2009 15:14:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 3 Mar 2009 10:01:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161220</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysxbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202745</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>