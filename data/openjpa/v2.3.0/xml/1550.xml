<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:33:06 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1550/OPENJPA-1550.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1550] When batchLimit=-1 or &gt;1 and an exception is caused, the params and failedObject are missing from the resultant exception.</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1550</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Exception reporting is different depending on the value of batchLimit.  To describe and demonstration this problem, lets take the following Entitiy:&lt;/p&gt;

&lt;p&gt;@Entity&lt;br/&gt;
public class Ent1 &lt;/p&gt;
{
    @Id
    private int pk;    
    private String name;
.....
}

&lt;p&gt;As a test, lets assume that we have an Ent1 with pk=200 already defined in the DB and our test will attempt to create and persist another Ent1 with pk=200 (i.e. a duplicate key).  In so doing we get the following exception as indicated by the batchLimit settings:&lt;/p&gt;

&lt;p&gt;batchLimit=0 or batchLimit=1&lt;br/&gt;
Caused by: &amp;lt;openjpa-1.2.2-SNAPSHOT-r422266:889769M nonfatal store error&amp;gt; org.apache.openjpa.persistence.EntityExistsException: The statement was aborted because it would have caused a duplicate key value in a unique or primary key constraint or unique index identified by &apos;SQL100301111328870&apos; defined on &apos;ENT1&apos;. &lt;/p&gt;
{prepstmnt 33038075 INSERT INTO Ent1 (pk, name) VALUES (?, ?) [params=(int) 200, (String) twohundred]}
&lt;p&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;code=20000, state=23505&amp;#93;&lt;/span&gt;&lt;br/&gt;
FailedObject: siemens75007.Ent1@19d0e0b&lt;/p&gt;


&lt;p&gt;when batchLimit=-1 or &amp;gt;1&lt;br/&gt;
Caused by: &amp;lt;openjpa-1.2.2-SNAPSHOT-r422266:889769M nonfatal store error&amp;gt; org.apache.openjpa.persistence.EntityExistsException: The statement was aborted because it would have caused a duplicate key value in a unique or primary key constraint or unique index identified by &apos;SQL100301111328870&apos; defined on &apos;ENT1&apos;.&lt;br/&gt;
FailedObject: prepstmnt 33038075 INSERT INTO Ent1 (pk, name) VALUES (?, ?) &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.openjpa.jdbc.kernel.JDBCStoreManager$CancelPreparedStatement&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;Notice that when batchLimit=&lt;span class=&quot;error&quot;&gt;&amp;#91;0,1&amp;#93;&lt;/span&gt;, the exception lists the prepared statement used along with the params which caused the failure, as well as the &apos;FailedObject&apos;.  Furthermore, calling &apos;getFailedObject&apos; on the resultant exception will give the caller the entity which caused the failure.  In contrast, when batchLimit=-1 or a value greater than 1, we can see that the exception message is missing the prepared statement info, however, it is presented in the &apos;FailedObject&apos;.  The params are also missing from the prepared statement.  A call to &apos;getFailedObject&apos; on the resultant exception will NOT give the caller the entity which caused the exception.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12458202">OPENJPA-1550</key>
            <summary>When batchLimit=-1 or &gt;1 and an exception is caused, the params and failedObject are missing from the resultant exception.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="drwoods">Donald Woods</assignee>
                                    <reporter username="jpaheath">Heath Thomann</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Mar 2010 03:32:48 +0000</created>
                <updated>Thu, 22 Apr 2010 21:30:06 +0100</updated>
                            <resolved>Thu, 25 Mar 2010 03:57:10 +0000</resolved>
                                    <version>1.2.2</version>
                    <version>1.3.0</version>
                    <version>2.0.0-beta2</version>
                                    <fixVersion>1.2.3</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>jdbc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12841693" author="jpaheath" created="Fri, 5 Mar 2010 03:55:36 +0000"  >&lt;p&gt;Proposed code changes for this issue.&lt;/p&gt;</comment>
                            <comment id="12843276" author="drwoods" created="Tue, 9 Mar 2010 20:32:33 +0000"  >&lt;p&gt;Updated patch for 1.3.x branch&lt;/p&gt;</comment>
                            <comment id="12843306" author="drwoods" created="Tue, 9 Mar 2010 21:34:24 +0000"  >&lt;p&gt;updated patch that can be applied to trunk.  waiting for all junits and TCKs to finish before committing.&lt;/p&gt;</comment>
                            <comment id="12843335" author="drwoods" created="Tue, 9 Mar 2010 22:29:45 +0000"  >&lt;p&gt;Applied to 13x and trunk.&lt;/p&gt;</comment>
                            <comment id="12843420" author="drwoods" created="Wed, 10 Mar 2010 03:17:42 +0000"  >&lt;p&gt;Heath will be adding a testcase patch and Mike will be pulling into 1.2.3.&lt;/p&gt;</comment>
                            <comment id="12846034" author="jpaheath" created="Tue, 16 Mar 2010 17:56:28 +0000"  >&lt;p&gt;Attaching the final version of the code changes and a test case.  The patch contains both code changes and test case.&lt;/p&gt;</comment>
                            <comment id="12846751" author="jpaheath" created="Thu, 18 Mar 2010 05:25:13 +0000"  >&lt;p&gt;Adding updated patch for 1.3.x and truck which contains code changes and a new test case.&lt;/p&gt;</comment>
                            <comment id="12846920" author="drwoods" created="Thu, 18 Mar 2010 14:14:49 +0000"  >&lt;p&gt;Mike has already applied the patches to 1.2.x branch.&lt;br/&gt;
Updated 1.3.x patch applied as r924766.&lt;br/&gt;
Working on trunk updates now, but seeing 6 test failures in the new TestBatchLimitException.&lt;/p&gt;</comment>
                            <comment id="12849488" author="jpaheath" created="Wed, 24 Mar 2010 22:09:41 +0000"  >&lt;p&gt;Adding code to allow the &apos;failed object&apos; to percolate up to the RollbackException.&lt;/p&gt;</comment>
                            <comment id="12849514" author="jpaheath" created="Wed, 24 Mar 2010 22:55:11 +0000"  >&lt;p&gt;Let me comments on the patches I just attached:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1550&quot; title=&quot;When batchLimit=-1 or &amp;gt;1 and an exception is caused, the params and failedObject are missing from the resultant exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1550&quot;&gt;&lt;del&gt;OPENJPA-1550&lt;/del&gt;&lt;/a&gt;v2.diff.txt is for 1.2.x. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1550&quot; title=&quot;When batchLimit=-1 or &amp;gt;1 and an exception is caused, the params and failedObject are missing from the resultant exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1550&quot;&gt;&lt;del&gt;OPENJPA-1550&lt;/del&gt;&lt;/a&gt;-13x-v2.diff.txt is for 1.3.x&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1550&quot; title=&quot;When batchLimit=-1 or &amp;gt;1 and an exception is caused, the params and failedObject are missing from the resultant exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1550&quot;&gt;&lt;del&gt;OPENJPA-1550&lt;/del&gt;&lt;/a&gt;-trunk-testcase.patch.txt is for trunk.&lt;/p&gt;

&lt;p&gt;These patches add code to allow the &apos;failed object&apos; to percolate up to the RollbackException which results in the use case.&lt;br/&gt;
In addition, the trunk version of the patch fixes the test failures as outline by Donald.&lt;/p&gt;

&lt;p&gt;For history sake, let me comment on the other patches already committed:&lt;/p&gt;

&lt;p&gt;These patches are for 1.3.x:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1550&quot; title=&quot;When batchLimit=-1 or &amp;gt;1 and an exception is caused, the params and failedObject are missing from the resultant exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1550&quot;&gt;&lt;del&gt;OPENJPA-1550&lt;/del&gt;&lt;/a&gt;-13x.patch - this is the initial code change committed.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1550&quot; title=&quot;When batchLimit=-1 or &amp;gt;1 and an exception is caused, the params and failedObject are missing from the resultant exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1550&quot;&gt;&lt;del&gt;OPENJPA-1550&lt;/del&gt;&lt;/a&gt;-13x-testcase.patch.txt - this one adds some additional code plus the test case.&lt;/p&gt;

&lt;p&gt;This patch is for trunk:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1550&quot; title=&quot;When batchLimit=-1 or &amp;gt;1 and an exception is caused, the params and failedObject are missing from the resultant exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1550&quot;&gt;&lt;del&gt;OPENJPA-1550&lt;/del&gt;&lt;/a&gt;-trunk.patch - this is the initial code change committed.&lt;/p&gt;

&lt;p&gt;And this patch is for 1.2.x:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-1550&quot; title=&quot;When batchLimit=-1 or &amp;gt;1 and an exception is caused, the params and failedObject are missing from the resultant exception.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-1550&quot;&gt;&lt;del&gt;OPENJPA-1550&lt;/del&gt;&lt;/a&gt;.diff.txt - this is the initial code change committed plus the test case.&lt;/p&gt;</comment>
                            <comment id="12849582" author="mikedd" created="Thu, 25 Mar 2010 02:58:49 +0000"  >&lt;p&gt;Thanks for the patches Heath. I&apos;ve committed to 1.3.x, with the other releases coming when the sanity builds complete. &lt;/p&gt;</comment>
                            <comment id="12849587" author="mikedd" created="Thu, 25 Mar 2010 03:57:10 +0000"  >&lt;p&gt;Committed Heath&apos;s latest patch on trunk, 2.0.x and 1.2.x. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12439116" name="OPENJPA-1550-13x-testcase.patch.txt" size="27896" author="jpaheath" created="Thu, 18 Mar 2010 05:25:13 +0000"/>
                            <attachment id="12439719" name="OPENJPA-1550-13x-v2.diff.txt" size="4494" author="jpaheath" created="Wed, 24 Mar 2010 22:09:41 +0000"/>
                            <attachment id="12438323" name="OPENJPA-1550-13x.patch" size="13497" author="drwoods" created="Tue, 9 Mar 2010 20:32:33 +0000"/>
                            <attachment id="12439720" name="OPENJPA-1550-trunk-testcase.patch.txt" size="30087" author="jpaheath" created="Wed, 24 Mar 2010 22:09:41 +0000"/>
                            <attachment id="12438328" name="OPENJPA-1550-trunk.patch" size="13637" author="drwoods" created="Tue, 9 Mar 2010 21:34:24 +0000"/>
                            <attachment id="12438943" name="OPENJPA-1550.diff.txt" size="29695" author="jpaheath" created="Tue, 16 Mar 2010 17:56:28 +0000"/>
                            <attachment id="12439718" name="OPENJPA-1550v2.diff.txt" size="4600" author="jpaheath" created="Wed, 24 Mar 2010 22:09:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 9 Mar 2010 20:32:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161813</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7o07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>288859</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>