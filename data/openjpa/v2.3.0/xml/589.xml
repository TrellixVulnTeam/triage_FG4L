<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:44:01 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-589/OPENJPA-589.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-589] Can not retrieve M-to-M data when DataCache is on</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-589</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;When DataCahe is on, the retrieval of M-to-M data will fail with the following exception:&lt;/p&gt;

&lt;p&gt;&amp;lt;openjpa-1.0.1-r420667:592145 fatal user error&amp;gt; org.apache.openjpa.persistence.ArgumentException: Could not locate metadata for the class using oid &quot;10=10&quot; of type &quot;class java.util.HashMap$Entry&quot;.  Registered oid type mappings: &quot;&lt;/p&gt;
{class org.apache.openjpa.util.IntId=class dw.EntityB, class java.util.HashMap$Entry=null}
&lt;p&gt;&quot;&lt;br/&gt;
FailedObject: 10=10 &lt;span class=&quot;error&quot;&gt;&amp;#91;java.util.HashMap$Entry&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.openjpa.meta.MetaDataRepository.getMetaData(MetaDataRepository.java:986)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.newStateManagerImpl(BrokerImpl.java:1121)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.findAll(BrokerImpl.java:913)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.findAll(BrokerImpl.java:862)&lt;br/&gt;
	at org.apache.openjpa.kernel.AbstractPCData.toRelationFields(AbstractPCData.java:214)&lt;br/&gt;
	at org.apache.openjpa.kernel.AbstractPCData.toNestedFields(AbstractPCData.java:181)&lt;br/&gt;
	at org.apache.openjpa.kernel.AbstractPCData.toField(AbstractPCData.java:95)&lt;br/&gt;
	at org.apache.openjpa.kernel.PCDataImpl.loadField(PCDataImpl.java:197)&lt;br/&gt;
	at org.apache.openjpa.kernel.PCDataImpl.load(PCDataImpl.java:167)&lt;br/&gt;
	at org.apache.openjpa.datacache.DataCacheStoreManager.load(DataCacheStoreManager.java:373)&lt;br/&gt;
	at org.apache.openjpa.kernel.DelegatingStoreManager.load(DelegatingStoreManager.java:116)&lt;br/&gt;
	at org.apache.openjpa.kernel.ROPStoreManager.load(ROPStoreManager.java:78)&lt;br/&gt;
	at org.apache.openjpa.kernel.StateManagerImpl.loadFields(StateManagerImpl.java:2867)&lt;br/&gt;
	at org.apache.openjpa.kernel.StateManagerImpl.loadField(StateManagerImpl.java:2945)&lt;br/&gt;
	at org.apache.openjpa.kernel.StateManagerImpl.beforeAccessField(StateManagerImpl.java:1449)&lt;br/&gt;
	at org.apache.openjpa.kernel.StateManagerImpl.accessingField(StateManagerImpl.java:1434)&lt;br/&gt;
	at dw.EntityE.pcGetentityf(EntityE.java)&lt;br/&gt;
	at dw.EntityE.print(EntityE.java:32)&lt;br/&gt;
	at dw.Test3.main(Test3.java:49)&lt;/p&gt;

&lt;p&gt;The test case to reproduce this error is:&lt;/p&gt;

&lt;p&gt;			EntityManagerFactory emf = Persistence&lt;br/&gt;
					.createEntityManagerFactory(&quot;Test1&quot;);&lt;/p&gt;

&lt;p&gt;			EntityManager em = emf.createEntityManager();&lt;br/&gt;
			em.getTransaction().begin();&lt;/p&gt;

&lt;p&gt;			EntityE e1 = new EntityE();&lt;br/&gt;
			e1.setId(1);&lt;br/&gt;
			e1.setName(&quot;ABC&quot;);&lt;br/&gt;
			em.persist(e1);&lt;br/&gt;
			EntityE e2 = new EntityE();&lt;br/&gt;
			e2.setId(2);&lt;br/&gt;
			e2.setName(&quot;DEF&quot;);&lt;br/&gt;
			em.persist(e2);&lt;/p&gt;

&lt;p&gt;			EntityF f1 = new EntityF();&lt;br/&gt;
			f1.setId(10);&lt;br/&gt;
			em.persist(f1);&lt;br/&gt;
			EntityF f2 = new EntityF();&lt;br/&gt;
			f2.setId(20);&lt;br/&gt;
			em.persist(f2);&lt;/p&gt;

&lt;p&gt;			e1.getEntityF().put(f1.getId(), f1);&lt;br/&gt;
			e1.getEntityF().put(f2.getId(), f2);&lt;br/&gt;
			e2.getEntityF().put(f1.getId(), f1);&lt;br/&gt;
			e2.getEntityF().put(f2.getId(), f2);&lt;/p&gt;

&lt;p&gt;			f1.getEntityE().put(e1.getName(), e1);&lt;br/&gt;
			f1.getEntityE().put(e2.getName(), e2);&lt;br/&gt;
			f2.getEntityE().put(e1.getName(), e1);&lt;br/&gt;
			f2.getEntityE().put(e2.getName(), e2);&lt;br/&gt;
			e1.print();&lt;br/&gt;
			e2.print();&lt;br/&gt;
			f1.print();&lt;br/&gt;
			f2.print();&lt;br/&gt;
			em.getTransaction().commit();&lt;br/&gt;
			em.close();&lt;/p&gt;

&lt;p&gt;			em = emf.createEntityManager();&lt;br/&gt;
			EntityE e1a = em.find(EntityE.class, 1);&lt;br/&gt;
			e1a.getEntityf();                         &amp;lt;========= exception is thrown here&lt;br/&gt;
			EntityE e2a = em.find(EntityE.class, 2);&lt;br/&gt;
			e2a.getEntityf();&lt;br/&gt;
			EntityF f1a = em.find(EntityF.class, 10);&lt;br/&gt;
			f1a.getEntitye();&lt;br/&gt;
			EntityF f2a = em.find(EntityF.class, 20);&lt;br/&gt;
			f2a.getEntitye();&lt;/p&gt;

&lt;p&gt;Note that this test case created 4 entities:&lt;br/&gt;
EnityE: e1 (id = 1), e2 (id = 2), &lt;br/&gt;
EntityF: f1 (id = 10), f2 (id = 20)&lt;/p&gt;

&lt;p&gt;EntityE has a field entityf, which is a Map&amp;lt;Integer, EntityF&amp;gt;&lt;br/&gt;
EntityF has a field entitye, which is a Map&amp;lt;String, EntityE&amp;gt;&lt;/p&gt;

&lt;p&gt;In this test case, entityf of e1 contains &amp;lt;10, f1&amp;gt;, and &amp;lt;20, f2&amp;gt;. The same for entityf of e2. On the other hand, &lt;br/&gt;
entitye of f1 contains&amp;lt;&quot;ABC&quot;, e1&amp;gt;, and &amp;lt;&quot;DEF&quot;, e2&amp;gt;. The same for entitye of f2.&lt;/p&gt;

&lt;p&gt;When DataCache is on, e1, e2, f1, and f2 are all stored in the data cache. Note that for the field of entityf in e1 and e2,&lt;br/&gt;
the value of Map (&amp;lt;10, object id of f1&amp;gt;, &amp;lt;20, object id of f2&amp;gt; is store in the datacache. For the field of entitye in f1 and f2,&lt;br/&gt;
the value of Map(&amp;lt;&quot;ABC&quot;, object id of e1&amp;gt;, &amp;lt;&quot;DEF&quot;, object id of e2&amp;gt; is stored in the data cache. &lt;/p&gt;

&lt;p&gt;The cause of the exception shown above occurs when the value of the Map is to be retrieved from the data cache.&lt;br/&gt;
Specifically, it happens in AbstractPCData.toField. The keys of the Map are correctly retrieved while the values of the &lt;br/&gt;
Map are handled incorrectly. The attached patch fixes this problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12395269">OPENJPA-589</key>
            <summary>Can not retrieve M-to-M data when DataCache is on</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fancy">Catalina Wei</assignee>
                                    <reporter username="faywang">Fay Wang</reporter>
                        <labels>
                    </labels>
                <created>Sun, 4 May 2008 07:10:48 +0100</created>
                <updated>Tue, 11 May 2010 23:09:24 +0100</updated>
                            <resolved>Mon, 12 May 2008 23:51:31 +0100</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>datacache</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12594062" author="faywang" created="Sun, 4 May 2008 07:12:09 +0100"  >&lt;p&gt;The attached patch fixes this problem.&lt;/p&gt;</comment>
                            <comment id="12595439" author="fancy" created="Fri, 9 May 2008 01:35:03 +0100"  >&lt;p&gt;patch committed  under r654658&lt;/p&gt;</comment>
                            <comment id="12595610" author="mikedd" created="Fri, 9 May 2008 15:29:58 +0100"  >&lt;p&gt;Reopening so that a testcase can be added . It looks like Fay has included most of the code needed in the JIRA issue so adding one shouldn&apos;t be too much trouble. &lt;/p&gt;</comment>
                            <comment id="12595848" author="faywang" created="Sat, 10 May 2008 20:20:53 +0100"  >&lt;p&gt;This patch contains the test case for this JIRA.&lt;/p&gt;</comment>
                            <comment id="12596227" author="pcl" created="Mon, 12 May 2008 23:51:31 +0100"  >&lt;p&gt;Closing after committing the test cases to trunk.&lt;/p&gt;</comment>
                            <comment id="12596264" author="faywang" created="Tue, 13 May 2008 04:42:26 +0100"  >&lt;p&gt;This patch fixes test case problem.&lt;/p&gt;</comment>
                            <comment id="12761247" author="fyrewyld" created="Thu, 1 Oct 2009 16:53:33 +0100"  >&lt;p&gt;OpenJPA 1.0.x version patch for this JIRA issue&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12431715">OPENJPA-1205</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12444249" name="OPENJPA-589-1.0.x.patch.txt" size="10068" author="jpaheath" created="Tue, 11 May 2010 23:09:24 +0100"/>
                            <attachment id="12421029" name="OpenJPA_1.0.x_OJ589.patch" size="9951" author="fyrewyld" created="Thu, 1 Oct 2009 16:53:33 +0100"/>
                            <attachment id="12381920" name="openjpa.patch" size="1903" author="faywang" created="Tue, 13 May 2008 04:42:26 +0100"/>
                            <attachment id="12381825" name="openjpa.patch" size="6524" author="faywang" created="Sat, 10 May 2008 20:20:53 +0100"/>
                            <attachment id="12381384" name="openjpa.patch" size="1653" author="faywang" created="Sun, 4 May 2008 07:12:09 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 9 May 2008 00:35:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160905</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyszi7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>203100</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>