<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:44:57 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-738/OPENJPA-738.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-738] QueryCache Improvement</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-738</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;Hi All,&lt;/p&gt;

&lt;p&gt;      I have changed the jpa code to eliminate the scan of the jpa query cache to invalidate cached queries that is triggered by entity bean values changes. The problem with the current code is that whenever an entity bean value changes, the query cache needs to be scanned and all the queries that are related to the changed entity bean should be invalidated. This is resulting in poor performance when the querycache has too many queries in it. &lt;/p&gt;

&lt;p&gt;      The new approach is to track the timestamp of the query and the timestamp of last update for each entity class and compare the timestamps when retrieving the query for reuse.  If the timestamp of the query result is older than the last update time of any entity in the access path of the query,  the query result would not be reused and the query result would be evicted from the query cache. &lt;/p&gt;

&lt;p&gt;      I introduced a configurable attribute in the persistence.xml in QueryCache property &quot;evictOnTimestamp=true&quot;. Therefore the QueryCache property in persistence.xml file looks as follows:&lt;/p&gt;

&lt;p&gt;      &amp;lt;property name=&quot;openjpa.QueryCache&quot; value = &quot;CacheSize=1000, evictOnTimestamp=true&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;      If the &quot;evictOnTimestamp&quot; value is set to true in the xml file the new code is invoked otherwise the old code. The default behaviour would be the old code. That is the value for &quot;evictOnTimestamp&quot; is false by default so that if this property is not set persistence.xml, old code gets invoked. &lt;/p&gt;

&lt;p&gt;      In the process of changing the code to evict the queries using the timestamp, I had to introduce 4 methods in QueryCache interface. We want this change to be applied to JPA trunk and 1.2.x branch. Anyone who is extending the QueryCache that implements this interface would have to implement these 4 methods. Please respond as soon as possible if this interface change is an issue. &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12405867">OPENJPA-738</key>
            <summary>QueryCache Improvement</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikedd">Michael Dick</assignee>
                                    <reporter username="turagasandy">Sandhya</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Oct 2008 00:19:32 +0100</created>
                <updated>Mon, 20 Sep 2010 16:39:49 +0100</updated>
                            <resolved>Fri, 23 Jul 2010 21:35:55 +0100</resolved>
                                    <version>1.2.0</version>
                    <version>1.2.1</version>
                    <version>1.3.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                                    <component>datacache</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12637308" author="turagasandy" created="Tue, 7 Oct 2008 00:52:20 +0100"  >&lt;p&gt; I am  attaching the patch file that has all my changes to the code. &lt;br/&gt;
Your comments and suggestions will be very helpful. &lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Sandhya Turaga&lt;/p&gt;</comment>
                            <comment id="12638071" author="turagasandy" created="Wed, 8 Oct 2008 21:42:10 +0100"  >&lt;p&gt;Hi All,&lt;/p&gt;

&lt;p&gt;           Please find the updated patch file. In this one I have made some changes to the coding style that Mike has suggested and also added some code so that the entityTimestamp map can handle the synchronization issues.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Sandhya Turaga&lt;/p&gt;</comment>
                            <comment id="12638103" author="mikedd" created="Wed, 8 Oct 2008 22:39:02 +0100"  >&lt;p&gt;The biggest issue I have with the patch is the interface changes. Adding methods to an interface in trunk is acceptable, but introducing them into a service release (1.2.1 or 1.2.2) can cause too much churn for downstream consumers. &lt;/p&gt;

&lt;p&gt;Updating the abstract classes we include can lessen the impact to third party cache plugins. Extending the abstract classes is recommended but is not required - if we put the change as is into a service release we could break other L2 query caches. &lt;/p&gt;</comment>
                            <comment id="12639614" author="turagasandy" created="Tue, 14 Oct 2008 23:02:39 +0100"  >&lt;p&gt;Hi All,&lt;/p&gt;

&lt;p&gt;    Please find the updated patch file for the querycache improvement. This patch does not have any methods in the QueryCache interface.  Introduced 3 new methods in the AbstractQueryCache instead. If this looks fine this would be final copy which will be checked into trunk. Please post you comments if any&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Sandhya Turaga&lt;/p&gt;</comment>
                            <comment id="12641228" author="fancy" created="Tue, 21 Oct 2008 01:27:57 +0100"  >&lt;p&gt;Patch is committed in trunk r706481.&lt;br/&gt;
This issure remain open until documentation is updated for the new configurable property of Query TimestampEviction policy.&lt;/p&gt;</comment>
                            <comment id="12641383" author="kwsutter" created="Tue, 21 Oct 2008 14:56:55 +0100"  >&lt;p&gt;I had some earlier concerns with the patch that I had communicated to Sandhya privately.  So, I&apos;m not sure if this patch was ready to be committed.  I will touch base with Sandhya later today and find out the current status of this Issue.  Thanks.&lt;/p&gt;</comment>
                            <comment id="12641428" author="fancy" created="Tue, 21 Oct 2008 17:39:39 +0100"  >&lt;p&gt;The attached patch is from Sandhya Turaga which was commited under r706481.&lt;/p&gt;</comment>
                            <comment id="12641437" author="fancy" created="Tue, 21 Oct 2008 18:03:58 +0100"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-738&quot; title=&quot;QueryCache Improvement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-738&quot;&gt;&lt;del&gt;OPENJPA-738&lt;/del&gt;&lt;/a&gt;.6.patch does not have any interface changes, and the configurable property for query eviction policy is a String value so it is more extendable.&lt;/p&gt;</comment>
                            <comment id="12641471" author="turagasandy" created="Tue, 21 Oct 2008 19:32:12 +0100"  >&lt;p&gt;One of the comments regarding the naming of the method were too implementation specific. This patch has renamed methods. &lt;br/&gt;
The method &quot;getEntityTimestampFromMap&quot; is changed to &quot;getEntityTimestamp()&quot; and the method &quot;updateEntityTimestampMap()&quot; is changed to &quot;updateEntityTimestamp()&quot;.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Sandhya Turaga&lt;/p&gt;</comment>
                            <comment id="12641656" author="turagasandy" created="Tue, 21 Oct 2008 23:58:37 +0100"  >&lt;p&gt;This patch has some changes to the coding style and some clean up to the code by removing some string comparisons.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Sandhya Turaga&lt;/p&gt;</comment>
                            <comment id="12641918" author="turagasandy" created="Wed, 22 Oct 2008 18:47:44 +0100"  >&lt;p&gt;I have added documentation in this patch.&lt;/p&gt;</comment>
                            <comment id="12643095" author="turagasandy" created="Mon, 27 Oct 2008 23:20:42 +0000"  >&lt;p&gt;Just posting the final patch. This is has no changes from the previous patch(&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-738&quot; title=&quot;QueryCache Improvement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-738&quot;&gt;&lt;del&gt;OPENJPA-738&lt;/del&gt;&lt;/a&gt;.10).&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Sandhya&lt;/p&gt;</comment>
                            <comment id="12643611" author="faywang" created="Wed, 29 Oct 2008 19:09:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OPENJPA-738&quot; title=&quot;QueryCache Improvement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OPENJPA-738&quot;&gt;&lt;del&gt;OPENJPA-738&lt;/del&gt;&lt;/a&gt;.11.patch is committed in trunk r708980. &lt;/p&gt;</comment>
                            <comment id="12912502" author="mikedd" created="Mon, 20 Sep 2010 16:39:49 +0100"  >&lt;p&gt;Closing issues which have been resolved for some time. If the problem persists, please reopen. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12440211">OPENJPA-1379</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12392666" name="OPENJPA-738.10.patch" size="24205" author="turagasandy" created="Wed, 22 Oct 2008 18:47:44 +0100"/>
                            <attachment id="12392904" name="OPENJPA-738.11.patch" size="24869" author="turagasandy" created="Mon, 27 Oct 2008 23:20:42 +0000"/>
                            <attachment id="12391774" name="OPENJPA-738.2.patch" size="26019" author="turagasandy" created="Wed, 8 Oct 2008 21:42:10 +0100"/>
                            <attachment id="12392139" name="OPENJPA-738.3.patch" size="19961" author="turagasandy" created="Tue, 14 Oct 2008 23:02:39 +0100"/>
                            <attachment id="12392585" name="OPENJPA-738.6.patch" size="33423" author="fancy" created="Tue, 21 Oct 2008 17:39:39 +0100"/>
                            <attachment id="12392596" name="OPENJPA-738.7.patch" size="2321" author="turagasandy" created="Tue, 21 Oct 2008 19:32:12 +0100"/>
                            <attachment id="12392614" name="OPENJPA-738.8.patch" size="21773" author="turagasandy" created="Tue, 21 Oct 2008 23:58:37 +0100"/>
                            <attachment id="12391592" name="OPENJPA-738.patch" size="21997" author="turagasandy" created="Tue, 7 Oct 2008 00:52:20 +0100"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Oct 2008 21:39:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161047</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hyswzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>202692</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>