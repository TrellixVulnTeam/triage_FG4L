<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:36:56 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-1853/OPENJPA-1853.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-1853] iSeries DB2 problem with using @GeneratedValue(strategy=GenerationType.IDENTITY)</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-1853</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;I get the following error when I try to insert new row to a table that has a &quot;generated always Identity&quot; Column.&lt;/p&gt;


&lt;p&gt;Exception in thread &quot;main&quot; &amp;lt;openjpa-2.0.1-r422266:989424 fatal store error&amp;gt; org.apache.openjpa.persistence.RollbackException: An error occurred attempting to invoke JDBC 3 method.  Your driver or database may not support JDBC 3 features.&lt;br/&gt;
	at org.apache.openjpa.persistence.EntityManagerImpl.commit(EntityManagerImpl.java:584)&lt;br/&gt;
	at de.meyerwerft.qs.laborpruef.laborprobe.dbaccess.LaborprobeBean.crtTest(LaborprobeBean.java:38)&lt;br/&gt;
	at de.meyerwerft.test.JSE_Client.jlm_run(JSE_Client.java:35)&lt;br/&gt;
	at de.meyerwerft.test.JSE_Client.&amp;lt;init&amp;gt;(JSE_Client.java:10)&lt;br/&gt;
	at de.meyerwerft.test.JSE_Client.main(JSE_Client.java:17)&lt;br/&gt;
Caused by: &amp;lt;openjpa-2.0.1-r422266:989424 nonfatal general error&amp;gt; org.apache.openjpa.persistence.PersistenceException: An error occurred attempting to invoke JDBC 3 method.  Your driver or database may not support JDBC 3 features.&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.beforeCompletion(BrokerImpl.java:1963)&lt;br/&gt;
	at org.apache.openjpa.kernel.LocalManagedRuntime.commit(LocalManagedRuntime.java:81)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.commit(BrokerImpl.java:1479)&lt;br/&gt;
	at org.apache.openjpa.kernel.DelegatingBroker.commit(DelegatingBroker.java:925)&lt;br/&gt;
	at org.apache.openjpa.persistence.EntityManagerImpl.commit(EntityManagerImpl.java:560)&lt;br/&gt;
	... 4 more&lt;br/&gt;
Caused by: org.apache.commons.lang.exception.NestableRuntimeException: An error occurred attempting to invoke JDBC 3 method.  Your driver or database may not support JDBC 3 features.&lt;br/&gt;
	at org.apache.openjpa.lib.jdbc.DelegatingConnection.invokeJDBC3(DelegatingConnection.java:597)&lt;br/&gt;
	at org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:577)&lt;br/&gt;
	at org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator$LoggingConnection.prepareStatement(LoggingConnectionDecorator.java:571)&lt;br/&gt;
	at org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:571)&lt;br/&gt;
	at org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:571)&lt;br/&gt;
	at org.apache.openjpa.lib.jdbc.DelegatingConnection.prepareStatement(DelegatingConnection.java:563)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.PreparedStatementManagerImpl.prepareStatement(PreparedStatementManagerImpl.java:287)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.PreparedStatementManagerImpl.flushAndUpdate(PreparedStatementManagerImpl.java:112)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.BatchingPreparedStatementManagerImpl.flushAndUpdate(BatchingPreparedStatementManagerImpl.java:81)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.PreparedStatementManagerImpl.flushInternal(PreparedStatementManagerImpl.java:99)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.PreparedStatementManagerImpl.flush(PreparedStatementManagerImpl.java:87)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.ConstraintUpdateManager.flush(ConstraintUpdateManager.java:550)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.ConstraintUpdateManager.flush(ConstraintUpdateManager.java:106)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.BatchingConstraintUpdateManager.flush(BatchingConstraintUpdateManager.java:59)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.flush(AbstractUpdateManager.java:103)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.flush(AbstractUpdateManager.java:76)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.JDBCStoreManager.flush(JDBCStoreManager.java:731)&lt;br/&gt;
	at org.apache.openjpa.kernel.DelegatingStoreManager.flush(DelegatingStoreManager.java:131)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.flush(BrokerImpl.java:2139)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.flushSafe(BrokerImpl.java:2037)&lt;br/&gt;
	at org.apache.openjpa.kernel.BrokerImpl.beforeCompletion(BrokerImpl.java:1955)&lt;br/&gt;
	... 8 more&lt;br/&gt;
Caused by: java.lang.reflect.InvocationTargetException&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.openjpa.lib.jdbc.DelegatingConnection.invokeJDBC3(DelegatingConnection.java:593)&lt;br/&gt;
	... 28 more&lt;br/&gt;
Caused by: java.sql.SQLException: The driver does not support this function.&lt;br/&gt;
	at com.ibm.as400.access.JDError.throwSQLException(JDError.java:415)&lt;br/&gt;
	at com.ibm.as400.access.AS400JDBCConnection.prepareStatement(AS400JDBCConnection.java:2210)&lt;br/&gt;
	... 33 more&lt;/p&gt;



&lt;p&gt;I have the following in persistence.xml&lt;br/&gt;
...&lt;br/&gt;
&amp;lt;property name=&quot;openjpa.jdbc.DBDictionary&quot; value=&quot;db2&quot;/&amp;gt; &lt;br/&gt;
&amp;lt;property name=&quot;openjpa.ConnectionDriverName&quot; value=&quot;com.ibm.as400.access.AS400JDBCDriver&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;property name=&quot;openjpa.ConnectionURL&quot; value=&quot;jdbc:as400://myserver/myschema&quot;/&amp;gt;&lt;br/&gt;
...&lt;/p&gt;


&lt;p&gt;In Version 1.2.3 this function works fine.&lt;/p&gt;


&lt;p&gt;Thank you,&lt;br/&gt;
Andreas Tomik&lt;/p&gt;</description>
                <environment>DB2 on IBM iSeries V5R4, jt400.jar (JTOpen)</environment>
        <key id="12478171">OPENJPA-1853</key>
            <summary>iSeries DB2 problem with using @GeneratedValue(strategy=GenerationType.IDENTITY)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="techhusky">Jeremy Bauer</assignee>
                                    <reporter username="atomik">Andreas Tomik</reporter>
                        <labels>
                    </labels>
                <created>Sun, 24 Oct 2010 11:27:20 +0100</created>
                <updated>Wed, 23 Feb 2011 15:24:27 +0000</updated>
                            <resolved>Wed, 3 Nov 2010 14:00:05 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>2.0.1</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>sql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12924317" author="techhusky" created="Sun, 24 Oct 2010 15:36:35 +0100"  >&lt;p&gt;Hi Andreas.  I&apos;ve been looking at what looks to be the same issue - identity column id, iSeries toolbox driver with 2.1.0 snapshot, but haven&apos;t yet been able to reproduce it outside of an app server environment.  It looks to be caused by some odd sql getting generated.  If you could post a simple JSE test that would really help things along.&lt;/p&gt;</comment>
                            <comment id="12924343" author="atomik" created="Sun, 24 Oct 2010 17:13:06 +0100"  >&lt;p&gt;Hi Jeremy,&lt;br/&gt;
i attached a simple JSE Test. I hope this helps you.&lt;br/&gt;
Please do not hesitate to contact me if you have any further questions.&lt;/p&gt;</comment>
                            <comment id="12924401" author="techhusky" created="Mon, 25 Oct 2010 00:51:53 +0100"  >&lt;p&gt;Thanks so much for the test code.  I&apos;ll give it a try and let you know what I find.&lt;/p&gt;</comment>
                            <comment id="12924560" author="techhusky" created="Mon, 25 Oct 2010 14:30:11 +0100"  >&lt;p&gt;Unfortunately, your test ran successfully on my system. The iSeries is at OS level V7R1 though. I&apos;m trying to get access to a V5R4 system. Could you run on your system with toolbox jdbc trace turned on and post the output? There may be some clues in there.  &lt;/p&gt;

&lt;p&gt;&amp;lt;property name=&quot;openjpa.ConnectionURL&quot; value=&quot;jdbc:as400://myserver/myschema;trace=true;toolbox trace=jdbc&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;In addition, what type of entity enhancement are you using? The javaagent?&lt;/p&gt;</comment>
                            <comment id="12924591" author="techhusky" created="Mon, 25 Oct 2010 16:43:49 +0100"  >&lt;p&gt;In OpenJPA 2.x, a JDBC 3.0 enhancement for returning auto generated keys from a prepared statement was enabled by default based upon the JDBC driver level.  I&apos;ve found that the toolbox driver running against a V5R4 system does not support this functionality on the server side.  This function does exist on the server side on V7R1 (and possibly V6), but only seems to work with the non-XA driver.  That&apos;s why I&apos;ve been having issues only in an app server environment running against a V7R1 server.&lt;/p&gt;

&lt;p&gt;The good news is that there&apos;s a simple workaround.  Adding this property to your persistence.xml will go back to the &quot;old way&quot; of doing business.&lt;/p&gt;

&lt;p&gt;&amp;lt;property name=&quot;openjpa.jdbc.DBDictionary&quot; value=&quot;db2(supportsGetGeneratedKeys=false)&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll work on a code fix that checks the iSeries version in addition to the JDBC driver level and possibly whether the driver is XA (if that turns out to be a limitation rather than a bug) to determine how this value should be set.&lt;/p&gt;</comment>
                            <comment id="12924703" author="techhusky" created="Mon, 25 Oct 2010 21:20:01 +0100"  >&lt;p&gt;Auto generated keys are supported with OS V6R1 and later.  Although, toolbox/JTOpen appears to have a bug in this area when using an XA data source, but it won&apos;t affect non-XA users.  The JTOpen developers have been notified of the the XA issue and have been provided a simple test case to reproduce the problem.&lt;/p&gt;

&lt;p&gt;A simple change was committed to 2.1.x/trunk under revision 1027250 that reverts back to the OpenJPA 1.x.x method of getting generated ids for V5R4 and prior OS levels.&lt;/p&gt;</comment>
                            <comment id="12927857" author="techhusky" created="Wed, 3 Nov 2010 14:00:05 +0000"  >&lt;p&gt;Please verify that this problem is corrected in trunk/2.1.0 as of the noted revision.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 24 Oct 2010 14:36:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>162089</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hysnon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>201185</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>