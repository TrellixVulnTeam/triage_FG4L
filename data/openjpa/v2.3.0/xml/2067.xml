<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun May 17 04:44:41 UTC 2015

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/OPENJPA-2067/OPENJPA-2067.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[OPENJPA-2067] A &apos;length&apos; of &apos;-1&apos; passed to PreparedStatement.setBinaryStream can cause an exception on some, but not all, JDBC drivers.</title>
                <link>https://issues.apache.org/jira/browse/OPENJPA-2067</link>
                <project id="12310351" key="OPENJPA">OpenJPA</project>
                    <description>&lt;p&gt;I recently worked on an issue where a JDBC driver is throwing an exception when attempting to persists an InputStream:&lt;/p&gt;

&lt;p&gt;Caused by: &amp;lt;openjpa-1.2.3-SNAPSHOT-r422266:1152904 nonfatal general error&amp;gt; org.apache.openjpa.persistence.PersistenceException: String or buffer length not valid.&lt;br/&gt;
FailedObject: prepstmnt 1608671202 UPDATE PMYPJRK SET lastModificationDate = ?, fileLength = ?, fileName = ?, inputStream = ? WHERE id = ? &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.openjpa.jdbc.kernel.JDBCStoreManager$CancelPreparedStatement&amp;#93;&lt;/span&gt;&lt;br/&gt;
.........&lt;br/&gt;
Caused by: java.sql.SQLException: String or buffer length not valid.&lt;br/&gt;
	at com.ibm.as400.access.JDError.throwSQLException(JDError.java:415)&lt;br/&gt;
	at com.ibm.as400.access.AS400JDBCPreparedStatement.setBinaryStream(AS400JDBCPreparedStatement.java:2098)&lt;br/&gt;
	at com.ibm.ws.rsadapter.jdbc.WSJdbcPreparedStatement.setBinaryStream(WSJdbcPreparedStatement.java:1444)&lt;br/&gt;
	at org.apache.openjpa.lib.jdbc.DelegatingPreparedStatement.setBinaryStream(DelegatingPreparedStatement.java:340)&lt;br/&gt;
	at org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator$LoggingConnection$LoggingPreparedStatement.setBinaryStream(LoggingConnectionDecorator.java:1104)&lt;br/&gt;
	at org.apache.openjpa.lib.jdbc.DelegatingPreparedStatement.setBinaryStream(DelegatingPreparedStatement.java:340)&lt;br/&gt;
	at org.apache.openjpa.jdbc.sql.DBDictionary.setBinaryStream(DBDictionary.java:875)&lt;br/&gt;
	at org.apache.openjpa.jdbc.sql.DBDictionary.setTyped(DBDictionary.java:1244)&lt;br/&gt;
	at org.apache.openjpa.jdbc.sql.RowImpl.flush(RowImpl.java:890)&lt;br/&gt;
	at org.apache.openjpa.jdbc.sql.RowImpl.flush(RowImpl.java:850)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.BatchingPreparedStatementManagerImpl.flushSingleRow(BatchingPreparedStatementManagerImpl.java:249)&lt;br/&gt;
	at org.apache.openjpa.jdbc.kernel.BatchingPreparedStatementManagerImpl.flushBatch(BatchingPreparedStatementManagerImpl.java:157)&lt;br/&gt;
	... 138 more&lt;/p&gt;



&lt;p&gt;This exception occurs because the particular JDBC driver checks the value of the &apos;length&apos; variable passed to the &apos;PreparedStatement.setBinaryStream&apos; method:&lt;/p&gt;

&lt;p&gt;setBinaryStream(int parameterIndex, InputStream x, int length) &lt;/p&gt;

&lt;p&gt;The &apos;length&apos; parameter of method &apos;setBinaryStream&apos; is supposed to be the length of the InputStream parameter.  OpenJPA code is passing a value of &apos;-1&apos; for the length as the length is not known.  Some JDBC drivers allow this value.  Technically speaking the javadoc for &apos;PreparedStatement.setBinaryStream&apos; doesn&apos;t state that a negative value is not acceptable or what should happen when a negative length is passed to &apos;setBinaryStream&apos; (which is likely why some drivers allow a negative value and others do not).  On the other hand, it doesn&apos;t make sense for a length of an InputStream to be negative.  Given this, and the fact that OpenJPA is not aware of the length of the stream, I&apos;ll work on a solution which uses a JDBC 4.0 version of &apos;setBinaryStream&apos; which doesn&apos;t take a length.  The fix will of course require JDK 6 + JDBC 4.0 driver runtime.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12529315">OPENJPA-2067</key>
            <summary>A &apos;length&apos; of &apos;-1&apos; passed to PreparedStatement.setBinaryStream can cause an exception on some, but not all, JDBC drivers.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jpaheath">Heath Thomann</assignee>
                                    <reporter username="jpaheath">Heath Thomann</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Oct 2011 21:45:42 +0100</created>
                <updated>Fri, 1 Jun 2012 18:59:55 +0100</updated>
                            <resolved>Fri, 1 Jun 2012 18:59:47 +0100</resolved>
                                    <version>1.2.3</version>
                    <version>2.0.2</version>
                    <version>2.1.2</version>
                    <version>2.2.0</version>
                                    <fixVersion>1.2.3</fixVersion>
                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.1</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>jdbc</component>
                    <component>sql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>215175</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2|hz7pfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>289092</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>